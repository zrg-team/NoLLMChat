const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChatApplication-BTqDgBdS.js","assets/index-DOJp-o6r.js","assets/index-T6762bQa.css","assets/index-BuL5hh7u.js","assets/toNumber-Dwn4XrGG.js","assets/popover-NeqxWV3H.js","assets/index-9PdKTLnc.js","assets/chunk-DVECU-kD.js","assets/LLMIcon-BEwl4j-r.js","assets/dot-CdE4Hxu9.js","assets/createLucideIcon-DuxePKJa.js","assets/alert-dialog-C5iD3IIP.js","assets/index-BlxkAWqY.js","assets/EditorApplication-xfFljTgE.js","assets/VSLiteApplication-C2ncasre.js","assets/file-tree-DmBvtzpH.js","assets/Home-4HtxotAA.js","assets/index-CZTJef_n.js","assets/plate-editor-BT83_l6k.js","assets/DocumentViewer-DvcwPXYH.js","assets/index-C3D6_-8d.js","assets/SessionList-2QkCZMrZ.js"])))=>i.map(i=>d[i]);
var UN=Object.defineProperty;var zN=(Ht,ur,ia)=>ur in Ht?UN(Ht,ur,{enumerable:!0,configurable:!0,writable:!0,value:ia}):Ht[ur]=ia;var se=(Ht,ur,ia)=>zN(Ht,typeof ur!="symbol"?ur+"":ur,ia);import{r as m,z as Sb,t as xi,a9 as BN,a as ki,f as Ya,j as v,P as Ze,b as _e,h as Tr,u as mt,c as fe,v as Rl,a3 as yn,s as Xn,a4 as zh,aa as HN,a6 as Bh,L as Ye,S as WN,ab as GN,d as Ti,o as VN,Y as vn,y as Fl,T as Hh,V as Wh,p as qN,q as xb,e as ZN,Q as kb,ac as Tb,ad as JN,R as KN,W as Nl,ae as Ab,g as Xa,B as Gh,E as Ai,af as YN,ag as XN,a7 as Mb,a8 as QN,_ as Qa,D as eo,__tla as eP}from"./index-DOJp-o6r.js";let Vh,Qn,Wr,to,ro,ea,Be,no,ao,qh,Pl,Ol,Zh,Dt,Jh,oo,Il,Kh,Cl,Mi,Rb,Yh,Gr,Fb,Xh,Qh,ep,tp,io,rp,np,ap,jl,$t,op,Ll,ip,sp,Dl,$l,Nb,lp,cr,Ri,ta,Pb,Et,so,at,cp,dp,Fi,up,Ni,ot,hp,_n,pp,Ul,lo,zl,Pi,Oi,Bl,Hl,Ii,Ob,Ut,co,fp,Wl,mp,gp,yp,vp,_p,wp,bp,Ep,Sp,xp,kp,Tp,Ap,Mp,Rp,Gl,Vl,Fp,ql,Ci,ji,Zl,Np,Jl,Ib,Cb,Pp,Op,Ip,Cp,jb,wn,Lb,Db,uo,Kl,Yl,Xl,Ql,jp,ec,zt,Lp,Dp,$p,tc,Up,zp,Bp,rc,Hp,$b,nc,ac,oc,Wp,ic,sc,lc,cc,dc,bn,Gp,Li,Ub,zb,Pe,Vp,ho,dr,Bt,qp,Zp,Bb,Jp,Di,En,Hb,Kp,uc,Wb,po,ra,Gb,hc,Vb,K,qb,Yp,Xp,Zb,Qp,ef,tf,Jb,pc,Kb,Ie,rf,nf,af,$i,na,of,Yb,fc,mc,aa,He,oa,Sn,sf,gc,yc,lf,xn,Ui,gt,cf,vc,_c,wc,Vr,bc,Ec,Sc,zi,fo,tP=Promise.all([(()=>{try{return eP}catch{}})()]).then(async()=>{var Ht={},ur;function ia(){if(ur)return Ht;ur=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.parse=i,Ht.serialize=c;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,r=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,a=Object.prototype.toString,o=(()=>{const h=function(){};return h.prototype=Object.create(null),h})();function i(h,p){const f=new o,g=h.length;if(g<2)return f;const y=(p==null?void 0:p.decode)||d;let E=0;do{const k=h.indexOf("=",E);if(k===-1)break;const R=h.indexOf(";",E),O=R===-1?g:R;if(k>O){E=h.lastIndexOf(";",k-1)+1;continue}const b=s(h,E,k),U=l(h,k,b),H=h.slice(b,U);if(f[H]===void 0){let $=s(h,k+1,O),G=l(h,O,$);const ne=y(h.slice($,G));f[H]=ne}E=O+1}while(E<g);return f}function s(h,p,f){do{const g=h.charCodeAt(p);if(g!==32&&g!==9)return p}while(++p<f);return f}function l(h,p,f){for(;p>f;){const g=h.charCodeAt(--p);if(g!==32&&g!==9)return p+1}return f}function c(h,p,f){const g=(f==null?void 0:f.encode)||encodeURIComponent;if(!t.test(h))throw new TypeError(`argument name is invalid: ${h}`);const y=g(p);if(!e.test(y))throw new TypeError(`argument val is invalid: ${p}`);let E=h+"="+y;if(!f)return E;if(f.maxAge!==void 0){if(!Number.isInteger(f.maxAge))throw new TypeError(`option maxAge is invalid: ${f.maxAge}`);E+="; Max-Age="+f.maxAge}if(f.domain){if(!r.test(f.domain))throw new TypeError(`option domain is invalid: ${f.domain}`);E+="; Domain="+f.domain}if(f.path){if(!n.test(f.path))throw new TypeError(`option path is invalid: ${f.path}`);E+="; Path="+f.path}if(f.expires){if(!u(f.expires)||!Number.isFinite(f.expires.valueOf()))throw new TypeError(`option expires is invalid: ${f.expires}`);E+="; Expires="+f.expires.toUTCString()}if(f.httpOnly&&(E+="; HttpOnly"),f.secure&&(E+="; Secure"),f.partitioned&&(E+="; Partitioned"),f.priority)switch(typeof f.priority=="string"?f.priority.toLowerCase():void 0){case"low":E+="; Priority=Low";break;case"medium":E+="; Priority=Medium";break;case"high":E+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${f.priority}`)}if(f.sameSite)switch(typeof f.sameSite=="string"?f.sameSite.toLowerCase():f.sameSite){case!0:case"strict":E+="; SameSite=Strict";break;case"lax":E+="; SameSite=Lax";break;case"none":E+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${f.sameSite}`)}return E}function d(h){if(h.indexOf("%")===-1)return h;try{return decodeURIComponent(h)}catch{return h}}function u(h){return a.call(h)==="[object Date]"}return Ht}ia();var df="popstate";function Xb(t={}){function e(n,a){let{pathname:o,search:i,hash:s}=n.location;return sa("",{pathname:o,search:i,hash:s},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(n,a){return typeof a=="string"?a:Ar(a)}return hf(e,r,null,t)}function Qb(t={}){function e(a,o){let{pathname:i="/",search:s="",hash:l=""}=Mr(a.location.hash.substring(1));return!i.startsWith("/")&&!i.startsWith(".")&&(i="/"+i),sa("",{pathname:i,search:s,hash:l},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(a,o){let i=a.document.querySelector("base"),s="";if(i&&i.getAttribute("href")){let l=a.location.href,c=l.indexOf("#");s=c===-1?l:l.slice(0,c)}return s+"#"+(typeof o=="string"?o:Ar(o))}function n(a,o){tt(a.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(o)})`)}return hf(e,r,n,t)}function xe(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function tt(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function e0(){return Math.random().toString(36).substring(2,10)}function uf(t,e){return{usr:t.state,key:t.key,idx:e}}function sa(t,e,r=null,n){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Mr(e):e,state:r,key:e&&e.key||n||e0()}}function Ar({pathname:t="/",search:e="",hash:r=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Mr(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substring(r),t=t.substring(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substring(n),t=t.substring(0,n)),t&&(e.pathname=t)}return e}function hf(t,e,r,n={}){let{window:a=document.defaultView,v5Compat:o=!1}=n,i=a.history,s="POP",l=null,c=d();c==null&&(c=0,i.replaceState({...i.state,idx:c},""));function d(){return(i.state||{idx:null}).idx}function u(){s="POP";let y=d(),E=y==null?null:y-c;c=y,l&&l({action:s,location:g.location,delta:E})}function h(y,E){s="PUSH";let k=sa(g.location,y,E);r&&r(k,y),c=d()+1;let R=uf(k,c),O=g.createHref(k);try{i.pushState(R,"",O)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;a.location.assign(O)}o&&l&&l({action:s,location:g.location,delta:1})}function p(y,E){s="REPLACE";let k=sa(g.location,y,E);r&&r(k,y),c=d();let R=uf(k,c),O=g.createHref(k);i.replaceState(R,"",O),o&&l&&l({action:s,location:g.location,delta:0})}function f(y){let E=a.location.origin!=="null"?a.location.origin:a.location.href,k=typeof y=="string"?y:Ar(y);return k=k.replace(/ $/,"%20"),xe(E,`No window.location.(origin|href) available to create URL for href: ${k}`),new URL(k,E)}let g={get action(){return s},get location(){return t(a,i)},listen(y){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(df,u),l=y,()=>{a.removeEventListener(df,u),l=null}},createHref(y){return e(a,y)},createURL:f,encodeLocation(y){let E=f(y);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:h,replace:p,go(y){return i.go(y)}};return g}var t0=new Set(["lazy","caseSensitive","path","id","index","children"]);function r0(t){return t.index===!0}function Bi(t,e,r=[],n={}){return t.map((a,o)=>{let i=[...r,String(o)],s=typeof a.id=="string"?a.id:i.join("-");if(xe(a.index!==!0||!a.children,"Cannot specify children on an index route"),xe(!n[s],`Found a route id collision on id "${s}".  Route id's must be globally unique within Data Router usages`),r0(a)){let l={...a,...e(a),id:s};return n[s]=l,l}else{let l={...a,...e(a),id:s,children:void 0};return n[s]=l,a.children&&(l.children=Bi(a.children,e,i,n)),l}})}function qr(t,e,r="/"){return Hi(t,e,r,!1)}function Hi(t,e,r,n){let a=typeof e=="string"?Mr(e):e,o=Wt(a.pathname||"/",r);if(o==null)return null;let i=pf(t);a0(i);let s=null;for(let l=0;s==null&&l<i.length;++l){let c=m0(o);s=p0(i[l],c,n)}return s}function n0(t,e){let{route:r,pathname:n,params:a}=t;return{id:r.id,pathname:n,params:a,data:e[r.id],handle:r.handle}}function pf(t,e=[],r=[],n=""){let a=(o,i,s)=>{let l={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};l.relativePath.startsWith("/")&&(xe(l.relativePath.startsWith(n),`Absolute route path "${l.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(n.length));let c=hr([n,l.relativePath]),d=r.concat(l);o.children&&o.children.length>0&&(xe(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),pf(o.children,e,d,c)),!(o.path==null&&!o.index)&&e.push({path:c,score:u0(c,o.index),routesMeta:d})};return t.forEach((o,i)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))a(o,i);else for(let l of ff(o.path))a(o,i,l)}),e}function ff(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,a=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return a?[o,""]:[o];let i=ff(n.join("/")),s=[];return s.push(...i.map(l=>l===""?o:[o,l].join("/"))),a&&s.push(...i),s.map(l=>t.startsWith("/")&&l===""?"/":l)}function a0(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:h0(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}var o0=/^:[\w-]+$/,i0=3,s0=2,l0=1,c0=10,d0=-2,mf=t=>t==="*";function u0(t,e){let r=t.split("/"),n=r.length;return r.some(mf)&&(n+=d0),e&&(n+=s0),r.filter(a=>!mf(a)).reduce((a,o)=>a+(o0.test(o)?i0:o===""?l0:c0),n)}function h0(t,e){return t.length===e.length&&t.slice(0,-1).every((r,n)=>r===e[n])?t[t.length-1]-e[e.length-1]:0}function p0(t,e,r=!1){let{routesMeta:n}=t,a={},o="/",i=[];for(let s=0;s<n.length;++s){let l=n[s],c=s===n.length-1,d=o==="/"?e:e.slice(o.length)||"/",u=Wi({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},d),h=l.route;if(!u&&c&&r&&!n[n.length-1].route.index&&(u=Wi({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!u)return null;Object.assign(a,u.params),i.push({params:a,pathname:hr([o,u.pathname]),pathnameBase:v0(hr([o,u.pathnameBase])),route:h}),u.pathnameBase!=="/"&&(o=hr([o,u.pathnameBase]))}return i}function Wi(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=f0(t.path,t.caseSensitive,t.end),a=e.match(r);if(!a)return null;let o=a[0],i=o.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:n.reduce((l,{paramName:c,isOptional:d},u)=>{if(c==="*"){let p=s[u]||"";i=o.slice(0,o.length-p.length).replace(/(.)\/+$/,"$1")}const h=s[u];return d&&!h?l[c]=void 0:l[c]=(h||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:i,pattern:t}}function f0(t,e=!1,r=!0){tt(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,i,s)=>(n.push({paramName:i,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),n]}function m0(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return tt(!1,`The URL path "${t}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Wt(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function g0(t,e="/"){let{pathname:r,search:n="",hash:a=""}=typeof t=="string"?Mr(t):t;return{pathname:r?r.startsWith("/")?r:y0(r,e):e,search:_0(n),hash:w0(a)}}function y0(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function xc(t,e,r,n){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function gf(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function Gi(t){let e=gf(t);return e.map((r,n)=>n===e.length-1?r.pathname:r.pathnameBase)}function Vi(t,e,r,n=!1){let a;typeof t=="string"?a=Mr(t):(a={...t},xe(!a.pathname||!a.pathname.includes("?"),xc("?","pathname","search",a)),xe(!a.pathname||!a.pathname.includes("#"),xc("#","pathname","hash",a)),xe(!a.search||!a.search.includes("#"),xc("#","search","hash",a)));let o=t===""||a.pathname==="",i=o?"/":a.pathname,s;if(i==null)s=r;else{let u=e.length-1;if(!n&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),u-=1;a.pathname=h.join("/")}s=u>=0?e[u]:"/"}let l=g0(a,s),c=i&&i!=="/"&&i.endsWith("/"),d=(o||i===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(c||d)&&(l.pathname+="/"),l}var hr=t=>t.join("/").replace(/\/\/+/g,"/"),v0=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),_0=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,w0=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,qi=class{constructor(t,e,r,n=!1){this.status=t,this.statusText=e||"",this.internal=n,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function Zi(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var yf=["POST","PUT","PATCH","DELETE"],b0=new Set(yf),E0=["GET",...yf],S0=new Set(E0),x0=new Set([301,302,303,307,308]),k0=new Set([307,308]),kc={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},T0={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},mo={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},Tc=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,A0=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),vf="remix-router-transitions",_f=Symbol("ResetLoaderData");function wf(t){const e=t.window?t.window:typeof window<"u"?window:void 0,r=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u";xe(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let n=t.mapRouteProperties||A0,a={},o=Bi(t.routes,n,void 0,a),i,s=t.basename||"/",l=t.dataStrategy||P0,c=t.patchRoutesOnNavigation,d={...t.future},u=null,h=new Set,p=null,f=null,g=null,y=t.hydrationData!=null,E=qr(o,t.history.location,s),k=null;if(E==null&&!c){let F=Ft(404,{pathname:t.history.location.pathname}),{matches:D,route:z}=Pf(o);E=D,k={[z.id]:F}}E&&!t.hydrationData&&Zn(E,o,t.history.location.pathname).active&&(E=null);let R;if(E)if(E.some(F=>F.route.lazy))R=!1;else if(!E.some(F=>F.route.loader))R=!0;else{let F=t.hydrationData?t.hydrationData.loaderData:null,D=t.hydrationData?t.hydrationData.errors:null;if(D){let z=E.findIndex(q=>D[q.route.id]!==void 0);R=E.slice(0,z+1).every(q=>!Mc(q.route,F,D))}else R=E.every(z=>!Mc(z.route,F,D))}else{R=!1,E=[];let F=Zn(null,o,t.history.location.pathname);F.active&&F.matches&&(E=F.matches)}let O,b={historyAction:t.history.action,location:t.history.location,matches:E,initialized:R,navigation:kc,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||k,fetchers:new Map,blockers:new Map},U="POP",H=!1,$,G=!1,ne=new Map,he=null,S=!1,M=!1,x=new Set,_=new Map,B=0,N=-1,C=new Map,I=new Set,Y=new Map,ae=new Map,ce=new Set,be=new Map,Se,We=null;function vt(){if(u=t.history.listen(({action:F,location:D,delta:z})=>{if(Se){Se(),Se=void 0;return}tt(be.size===0||z!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let q=Za({currentLocation:b.location,nextLocation:D,historyAction:F});if(q&&z!=null){let oe=new Promise(ue=>{Se=ue});t.history.go(z*-1),qa(q,{state:"blocked",location:D,proceed(){qa(q,{state:"proceeding",proceed:void 0,reset:void 0,location:D}),oe.then(()=>t.history.go(z))},reset(){let ue=new Map(b.blockers);ue.set(q,mo),Ce({blockers:ue})}});return}return ft(F,D)}),r){H0(e,ne);let F=()=>W0(e,ne);e.addEventListener("pagehide",F),he=()=>e.removeEventListener("pagehide",F)}return b.initialized||ft("POP",b.location,{initialHydration:!0}),O}function Br(){u&&u(),he&&he(),h.clear(),$&&$.abort(),b.fetchers.forEach((F,D)=>Va(D)),b.blockers.forEach((F,D)=>Tl(D))}function Hr(F){return h.add(F),()=>h.delete(F)}function Ce(F,D={}){b={...b,...F};let z=[],q=[];b.fetchers.forEach((oe,ue)=>{oe.state==="idle"&&(ce.has(ue)?z.push(ue):q.push(ue))}),[...h].forEach(oe=>oe(b,{deletedFetchers:z,viewTransitionOpts:D.viewTransitionOpts,flushSync:D.flushSync===!0})),z.forEach(oe=>Va(oe)),q.forEach(oe=>b.fetchers.delete(oe))}function _t(F,D,{flushSync:z}={}){var ee,ve;let q=b.actionData!=null&&b.navigation.formMethod!=null&&Gt(b.navigation.formMethod)&&b.navigation.state==="loading"&&((ee=F.state)==null?void 0:ee._isRedirect)!==!0,oe;D.actionData?Object.keys(D.actionData).length>0?oe=D.actionData:oe=null:q?oe=b.actionData:oe=null;let ue=D.loaderData?Ff(b.loaderData,D.loaderData,D.matches||[],D.errors):b.loaderData,ye=b.blockers;ye.size>0&&(ye=new Map(ye),ye.forEach((ke,Ue)=>ye.set(Ue,mo)));let ie=H===!0||b.navigation.formMethod!=null&&Gt(b.navigation.formMethod)&&((ve=F.state)==null?void 0:ve._isRedirect)!==!0;i&&(o=i,i=void 0),S||U==="POP"||(U==="PUSH"?t.history.push(F,F.state):U==="REPLACE"&&t.history.replace(F,F.state));let le;if(U==="POP"){let ke=ne.get(b.location.pathname);ke&&ke.has(F.pathname)?le={currentLocation:b.location,nextLocation:F}:ne.has(F.pathname)&&(le={currentLocation:F,nextLocation:b.location})}else if(G){let ke=ne.get(b.location.pathname);ke?ke.add(F.pathname):(ke=new Set([F.pathname]),ne.set(b.location.pathname,ke)),le={currentLocation:b.location,nextLocation:F}}Ce({...D,actionData:oe,loaderData:ue,historyAction:U,location:F,initialized:!0,navigation:kc,revalidation:"idle",restoreScrollPosition:Al(F,D.matches||b.matches),preventScrollReset:ie,blockers:ye},{viewTransitionOpts:le,flushSync:z===!0}),U="POP",H=!1,G=!1,S=!1,M=!1,We==null||We.resolve(),We=null}async function qn(F,D){if(typeof F=="number"){t.history.go(F);return}let z=Ac(b.location,b.matches,s,F,D==null?void 0:D.fromRouteId,D==null?void 0:D.relative),{path:q,submission:oe,error:ue}=bf(!1,z,D),ye=b.location,ie=sa(b.location,q,D&&D.state);ie={...ie,...t.history.encodeLocation(ie)};let le=D&&D.replace!=null?D.replace:void 0,ee="PUSH";le===!0?ee="REPLACE":le===!1||oe!=null&&Gt(oe.formMethod)&&oe.formAction===b.location.pathname+b.location.search&&(ee="REPLACE");let ve=D&&"preventScrollReset"in D?D.preventScrollReset===!0:void 0,ke=(D&&D.flushSync)===!0,Ue=Za({currentLocation:ye,nextLocation:ie,historyAction:ee});if(Ue){qa(Ue,{state:"blocked",location:ie,proceed(){qa(Ue,{state:"proceeding",proceed:void 0,reset:void 0,location:ie}),qn(F,D)},reset(){let Ge=new Map(b.blockers);Ge.set(Ue,mo),Ce({blockers:Ge})}});return}await ft(ee,ie,{submission:oe,pendingError:ue,preventScrollReset:ve,replace:D&&D.replace,enableViewTransition:D&&D.viewTransition,flushSync:ke})}function Ba(){We||(We=G0()),Ga(),Ce({revalidation:"loading"});let F=We.promise;return b.navigation.state==="submitting"?F:b.navigation.state==="idle"?(ft(b.historyAction,b.location,{startUninterruptedRevalidation:!0}),F):(ft(U||b.historyAction,b.navigation.location,{overrideNavigation:b.navigation,enableViewTransition:G===!0}),F)}async function ft(F,D,z){$&&$.abort(),$=null,U=F,S=(z&&z.startUninterruptedRevalidation)===!0,jh(b.location,b.matches),H=(z&&z.preventScrollReset)===!0,G=(z&&z.enableViewTransition)===!0;let q=i||o,oe=z&&z.overrideNavigation,ue=qr(q,D,s),ye=(z&&z.flushSync)===!0,ie=Zn(ue,q,D.pathname);if(ie.active&&ie.matches&&(ue=ie.matches),!ue){let{error:Ne,notFoundMatches:wt,route:Ke}=Ja(D.pathname);_t(D,{matches:wt,loaderData:{},errors:{[Ke.id]:Ne}},{flushSync:ye});return}if(b.initialized&&!M&&D0(b.location,D)&&!(z&&z.submission&&Gt(z.submission.formMethod))){_t(D,{matches:ue},{flushSync:ye});return}$=new AbortController;let le=la(t.history,D,$.signal,z&&z.submission),ee;if(z&&z.pendingError)ee=[kn(ue).route.id,{type:"error",error:z.pendingError}];else if(z&&z.submission&&Gt(z.submission.formMethod)){let Ne=await fi(le,D,z.submission,ue,ie.active,{replace:z.replace,flushSync:ye});if(Ne.shortCircuited)return;if(Ne.pendingActionResult){let[wt,Ke]=Ne.pendingActionResult;if(St(Ke)&&Zi(Ke.error)&&Ke.error.status===404){$=null,_t(D,{matches:Ne.matches,loaderData:{},errors:{[wt]:Ke.error}});return}}ue=Ne.matches||ue,ee=Ne.pendingActionResult,oe=Nc(D,z.submission),ye=!1,ie.active=!1,le=la(t.history,le.url,le.signal)}let{shortCircuited:ve,matches:ke,loaderData:Ue,errors:Ge}=await Ct(le,D,ue,ie.active,oe,z&&z.submission,z&&z.fetcherSubmission,z&&z.replace,z&&z.initialHydration===!0,ye,ee);ve||($=null,_t(D,{matches:ke||ue,...Nf(ee),loaderData:Ue,errors:Ge}))}async function fi(F,D,z,q,oe,ue={}){Ga();let ye=z0(D,z);if(Ce({navigation:ye},{flushSync:ue.flushSync===!0}),oe){let ee=await Ka(q,D.pathname,F.signal);if(ee.type==="aborted")return{shortCircuited:!0};if(ee.type==="error"){let ve=kn(ee.partialMatches).route.id;return{matches:ee.partialMatches,pendingActionResult:[ve,{type:"error",error:ee.error}]}}else if(ee.matches)q=ee.matches;else{let{notFoundMatches:ve,error:ke,route:Ue}=Ja(D.pathname);return{matches:ve,pendingActionResult:[Ue.id,{type:"error",error:ke}]}}}let ie,le=go(q,D);if(!le.route.action&&!le.route.lazy)ie={type:"error",error:Ft(405,{method:F.method,pathname:D.pathname,routeId:le.route.id})};else if(ie=(await fn("action",b,F,[le],q,null))[le.route.id],F.signal.aborted)return{shortCircuited:!0};if(Tn(ie)){let ee;return ue&&ue.replace!=null?ee=ue.replace:ee=Af(ie.response.headers.get("Location"),new URL(F.url),s)===b.location.pathname+b.location.search,await nr(F,ie,!0,{submission:z,replace:ee}),{shortCircuited:!0}}if(St(ie)){let ee=kn(q,le.route.id);return(ue&&ue.replace)!==!0&&(U="PUSH"),{matches:q,pendingActionResult:[ee.route.id,ie]}}return{matches:q,pendingActionResult:[le.route.id,ie]}}async function Ct(F,D,z,q,oe,ue,ye,ie,le,ee,ve){let ke=oe||Nc(D,ue),Ue=ue||ye||jf(ke),Ge=!S&&!le;if(q){if(Ge){let bt=Ha(ve);Ce({navigation:ke,...bt!==void 0?{actionData:bt}:{}},{flushSync:ee})}let Ae=await Ka(z,D.pathname,F.signal);if(Ae.type==="aborted")return{shortCircuited:!0};if(Ae.type==="error"){let bt=kn(Ae.partialMatches).route.id;return{matches:Ae.partialMatches,loaderData:{},errors:{[bt]:Ae.error}}}else if(Ae.matches)z=Ae.matches;else{let{error:bt,notFoundMatches:kr,route:ze}=Ja(D.pathname);return{matches:kr,loaderData:{},errors:{[ze.id]:bt}}}}let Ne=i||o,[wt,Ke]=Sf(t.history,b,z,Ue,D,le===!0,M,x,ce,Y,I,Ne,s,ve);if(N=++B,wt.length===0&&Ke.length===0){let Ae=_i();return _t(D,{matches:z,loaderData:{},errors:ve&&St(ve[1])?{[ve[0]]:ve[1].error}:null,...Nf(ve),...Ae?{fetchers:new Map(b.fetchers)}:{}},{flushSync:ee}),{shortCircuited:!0}}if(Ge){let Ae={};if(!q){Ae.navigation=ke;let bt=Ha(ve);bt!==void 0&&(Ae.actionData=bt)}Ke.length>0&&(Ae.fetchers=Wa(Ke)),Ce(Ae,{flushSync:ee})}Ke.forEach(Ae=>{or(Ae.key),Ae.controller&&_.set(Ae.key,Ae.controller)});let Jn=()=>Ke.forEach(Ae=>or(Ae.key));$&&$.signal.addEventListener("abort",Jn);let{loaderResults:sr,fetcherResults:mn}=await gi(b,z,wt,Ke,F);if(F.signal.aborted)return{shortCircuited:!0};$&&$.signal.removeEventListener("abort",Jn),Ke.forEach(Ae=>_.delete(Ae.key));let Sr=Ji(sr);if(Sr)return await nr(F,Sr.result,!0,{replace:ie}),{shortCircuited:!0};if(Sr=Ji(mn),Sr)return I.add(Sr.key),await nr(F,Sr.result,!0,{replace:ie}),{shortCircuited:!0};let{loaderData:Ei,errors:lr}=Rf(b,z,sr,ve,Ke,mn);le&&b.errors&&(lr={...b.errors,...lr});let Kn=_i(),xr=wi(N),Yn=Kn||xr||Ke.length>0;return{matches:z,loaderData:Ei,errors:lr,...Yn?{fetchers:new Map(b.fetchers)}:{}}}function Ha(F){if(F&&!St(F[1]))return{[F[0]]:F[1].data};if(b.actionData)return Object.keys(b.actionData).length===0?null:b.actionData}function Wa(F){return F.forEach(D=>{let z=b.fetchers.get(D.key),q=yo(void 0,z?z.data:void 0);b.fetchers.set(D.key,q)}),new Map(b.fetchers)}async function pn(F,D,z,q){or(F);let oe=(q&&q.flushSync)===!0,ue=i||o,ye=Ac(b.location,b.matches,s,z,D,q==null?void 0:q.relative),ie=qr(ue,ye,s),le=Zn(ie,ue,ye);if(le.active&&le.matches&&(ie=le.matches),!ie){jt(F,D,Ft(404,{pathname:ye}),{flushSync:oe});return}let{path:ee,submission:ve,error:ke}=bf(!0,ye,q);if(ke){jt(F,D,ke,{flushSync:oe});return}let Ue=go(ie,ee),Ge=(q&&q.preventScrollReset)===!0;if(ve&&Gt(ve.formMethod)){await Er(F,D,ee,Ue,ie,le.active,oe,Ge,ve);return}Y.set(F,{routeId:D,path:ee}),await mi(F,D,ee,Ue,ie,le.active,oe,Ge,ve)}async function Er(F,D,z,q,oe,ue,ye,ie,le){Ga(),Y.delete(F);function ee(ze){if(!ze.route.action&&!ze.route.lazy){let gn=Ft(405,{method:le.formMethod,pathname:z,routeId:D});return jt(F,D,gn,{flushSync:ye}),!0}return!1}if(!ue&&ee(q))return;let ve=b.fetchers.get(F);ar(F,B0(le,ve),{flushSync:ye});let ke=new AbortController,Ue=la(t.history,z,ke.signal,le);if(ue){let ze=await Ka(oe,z,Ue.signal);if(ze.type==="aborted")return;if(ze.type==="error"){jt(F,D,ze.error,{flushSync:ye});return}else if(ze.matches){if(oe=ze.matches,q=go(oe,z),ee(q))return}else{jt(F,D,Ft(404,{pathname:z}),{flushSync:ye});return}}_.set(F,ke);let Ge=B,Ne=(await fn("action",b,Ue,[q],oe,F))[q.route.id];if(Ue.signal.aborted){_.get(F)===ke&&_.delete(F);return}if(ce.has(F)){if(Tn(Ne)||St(Ne)){ar(F,Zr(void 0));return}}else{if(Tn(Ne))if(_.delete(F),N>Ge){ar(F,Zr(void 0));return}else return I.add(F),ar(F,yo(le)),nr(Ue,Ne,!1,{fetcherSubmission:le,preventScrollReset:ie});if(St(Ne)){jt(F,D,Ne.error);return}}let wt=b.navigation.location||b.location,Ke=la(t.history,wt,ke.signal),Jn=i||o,sr=b.navigation.state!=="idle"?qr(Jn,b.navigation.location,s):b.matches;xe(sr,"Didn't find any matches after fetcher action");let mn=++B;C.set(F,mn);let Sr=yo(le,Ne.data);b.fetchers.set(F,Sr);let[Ei,lr]=Sf(t.history,b,sr,le,wt,!1,M,x,ce,Y,I,Jn,s,[q.route.id,Ne]);lr.filter(ze=>ze.key!==F).forEach(ze=>{let gn=ze.key,Ml=b.fetchers.get(gn),Si=yo(void 0,Ml?Ml.data:void 0);b.fetchers.set(gn,Si),or(gn),ze.controller&&_.set(gn,ze.controller)}),Ce({fetchers:new Map(b.fetchers)});let Kn=()=>lr.forEach(ze=>or(ze.key));ke.signal.addEventListener("abort",Kn);let{loaderResults:xr,fetcherResults:Yn}=await gi(b,sr,Ei,lr,Ke);if(ke.signal.aborted)return;ke.signal.removeEventListener("abort",Kn),C.delete(F),_.delete(F),lr.forEach(ze=>_.delete(ze.key));let Ae=Ji(xr);if(Ae)return nr(Ke,Ae.result,!1,{preventScrollReset:ie});if(Ae=Ji(Yn),Ae)return I.add(Ae.key),nr(Ke,Ae.result,!1,{preventScrollReset:ie});let{loaderData:bt,errors:kr}=Rf(b,sr,xr,void 0,lr,Yn);if(b.fetchers.has(F)){let ze=Zr(Ne.data);b.fetchers.set(F,ze)}wi(mn),b.navigation.state==="loading"&&mn>N?(xe(U,"Expected pending action"),$&&$.abort(),_t(b.navigation.location,{matches:sr,loaderData:bt,errors:kr,fetchers:new Map(b.fetchers)})):(Ce({errors:kr,loaderData:Ff(b.loaderData,bt,sr,kr),fetchers:new Map(b.fetchers)}),M=!1)}async function mi(F,D,z,q,oe,ue,ye,ie,le){let ee=b.fetchers.get(F);ar(F,yo(le,ee?ee.data:void 0),{flushSync:ye});let ve=new AbortController,ke=la(t.history,z,ve.signal);if(ue){let Ne=await Ka(oe,z,ke.signal);if(Ne.type==="aborted")return;if(Ne.type==="error"){jt(F,D,Ne.error,{flushSync:ye});return}else if(Ne.matches)oe=Ne.matches,q=go(oe,z);else{jt(F,D,Ft(404,{pathname:z}),{flushSync:ye});return}}_.set(F,ve);let Ue=B,Ge=(await fn("loader",b,ke,[q],oe,F))[q.route.id];if(_.get(F)===ve&&_.delete(F),!ke.signal.aborted){if(ce.has(F)){ar(F,Zr(void 0));return}if(Tn(Ge))if(N>Ue){ar(F,Zr(void 0));return}else{I.add(F),await nr(ke,Ge,!1,{preventScrollReset:ie});return}if(St(Ge)){jt(F,D,Ge.error);return}ar(F,Zr(Ge.data))}}async function nr(F,D,z,{submission:q,fetcherSubmission:oe,preventScrollReset:ue,replace:ye}={}){D.response.headers.has("X-Remix-Revalidate")&&(M=!0);let ie=D.response.headers.get("Location");xe(ie,"Expected a Location header on the redirect Response"),ie=Af(ie,new URL(F.url),s);let le=sa(b.location,ie,{_isRedirect:!0});if(r){let Ne=!1;if(D.response.headers.has("X-Remix-Reload-Document"))Ne=!0;else if(Tc.test(ie)){const wt=t.history.createURL(ie);Ne=wt.origin!==e.location.origin||Wt(wt.pathname,s)==null}if(Ne){ye?e.location.replace(ie):e.location.assign(ie);return}}$=null;let ee=ye===!0||D.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:ve,formAction:ke,formEncType:Ue}=b.navigation;!q&&!oe&&ve&&ke&&Ue&&(q=jf(b.navigation));let Ge=q||oe;if(k0.has(D.response.status)&&Ge&&Gt(Ge.formMethod))await ft(ee,le,{submission:{...Ge,formAction:ie},preventScrollReset:ue||H,enableViewTransition:z?G:void 0});else{let Ne=Nc(le,q);await ft(ee,le,{overrideNavigation:Ne,fetcherSubmission:oe,preventScrollReset:ue||H,enableViewTransition:z?G:void 0})}}async function fn(F,D,z,q,oe,ue){let ye,ie={};try{ye=await O0(l,F,D,z,q,oe,ue,a,n)}catch(le){return q.forEach(ee=>{ie[ee.route.id]={type:"error",error:le}}),ie}for(let[le,ee]of Object.entries(ye))if($0(ee)){let ve=ee.result;ie[le]={type:"redirect",response:j0(ve,z,le,oe,s)}}else ie[le]=await C0(ee);return ie}async function gi(F,D,z,q,oe){let ue=fn("loader",F,oe,z,D,null),ye=Promise.all(q.map(async ee=>{if(ee.matches&&ee.match&&ee.controller){let ve=(await fn("loader",F,la(t.history,ee.path,ee.controller.signal),[ee.match],ee.matches,ee.key))[ee.match.route.id];return{[ee.key]:ve}}else return Promise.resolve({[ee.key]:{type:"error",error:Ft(404,{pathname:ee.path})}})})),ie=await ue,le=(await ye).reduce((ee,ve)=>Object.assign(ee,ve),{});return{loaderResults:ie,fetcherResults:le}}function Ga(){M=!0,Y.forEach((F,D)=>{_.has(D)&&x.add(D),or(D)})}function ar(F,D,z={}){b.fetchers.set(F,D),Ce({fetchers:new Map(b.fetchers)},{flushSync:(z&&z.flushSync)===!0})}function jt(F,D,z,q={}){let oe=kn(b.matches,D);Va(F),Ce({errors:{[oe.route.id]:z},fetchers:new Map(b.fetchers)},{flushSync:(q&&q.flushSync)===!0})}function yi(F){return ae.set(F,(ae.get(F)||0)+1),ce.has(F)&&ce.delete(F),b.fetchers.get(F)||T0}function Va(F){let D=b.fetchers.get(F);_.has(F)&&!(D&&D.state==="loading"&&C.has(F))&&or(F),Y.delete(F),C.delete(F),I.delete(F),ce.delete(F),x.delete(F),b.fetchers.delete(F)}function kl(F){let D=(ae.get(F)||0)-1;D<=0?(ae.delete(F),ce.add(F)):ae.set(F,D),Ce({fetchers:new Map(b.fetchers)})}function or(F){let D=_.get(F);D&&(D.abort(),_.delete(F))}function vi(F){for(let D of F){let z=yi(D),q=Zr(z.data);b.fetchers.set(D,q)}}function _i(){let F=[],D=!1;for(let z of I){let q=b.fetchers.get(z);xe(q,`Expected fetcher: ${z}`),q.state==="loading"&&(I.delete(z),F.push(z),D=!0)}return vi(F),D}function wi(F){let D=[];for(let[z,q]of C)if(q<F){let oe=b.fetchers.get(z);xe(oe,`Expected fetcher: ${z}`),oe.state==="loading"&&(or(z),C.delete(z),D.push(z))}return vi(D),D.length>0}function bi(F,D){let z=b.blockers.get(F)||mo;return be.get(F)!==D&&be.set(F,D),z}function Tl(F){b.blockers.delete(F),be.delete(F)}function qa(F,D){let z=b.blockers.get(F)||mo;xe(z.state==="unblocked"&&D.state==="blocked"||z.state==="blocked"&&D.state==="blocked"||z.state==="blocked"&&D.state==="proceeding"||z.state==="blocked"&&D.state==="unblocked"||z.state==="proceeding"&&D.state==="unblocked",`Invalid blocker state transition: ${z.state} -> ${D.state}`);let q=new Map(b.blockers);q.set(F,D),Ce({blockers:q})}function Za({currentLocation:F,nextLocation:D,historyAction:z}){if(be.size===0)return;be.size>1&&tt(!1,"A router only supports one blocker at a time");let q=Array.from(be.entries()),[oe,ue]=q[q.length-1],ye=b.blockers.get(oe);if(!(ye&&ye.state==="proceeding")&&ue({currentLocation:F,nextLocation:D,historyAction:z}))return oe}function Ja(F){let D=Ft(404,{pathname:F}),z=i||o,{matches:q,route:oe}=Pf(z);return{notFoundMatches:q,route:oe,error:D}}function Ch(F,D,z){if(p=F,g=D,f=z||null,!y&&b.navigation===kc){y=!0;let q=Al(b.location,b.matches);q!=null&&Ce({restoreScrollPosition:q})}return()=>{p=null,g=null,f=null}}function ir(F,D){return f&&f(F,D.map(z=>n0(z,b.loaderData)))||F.key}function jh(F,D){if(p&&g){let z=ir(F,D);p[z]=g()}}function Al(F,D){if(p){let z=ir(F,D),q=p[z];if(typeof q=="number")return q}return null}function Zn(F,D,z){if(c)if(F){if(Object.keys(F[0].params).length>0)return{active:!0,matches:Hi(D,z,s,!0)}}else return{active:!0,matches:Hi(D,z,s,!0)||[]};return{active:!1,matches:null}}async function Ka(F,D,z){if(!c)return{type:"success",matches:F};let q=F;for(;;){let oe=i==null,ue=i||o,ye=a;try{await c({path:D,matches:q,patch:(ee,ve)=>{z.aborted||kf(ee,ve,ue,ye,n)}})}catch(ee){return{type:"error",error:ee,partialMatches:q}}finally{oe&&!z.aborted&&(o=[...o])}if(z.aborted)return{type:"aborted"};let ie=qr(ue,D,s);if(ie)return{type:"success",matches:ie};let le=Hi(ue,D,s,!0);if(!le||q.length===le.length&&q.every((ee,ve)=>ee.route.id===le[ve].route.id))return{type:"success",matches:null};q=le}}function Lh(F){a={},i=Bi(F,n,void 0,a)}function Dh(F,D){let z=i==null;kf(F,D,i||o,a,n),z&&(o=[...o],Ce({}))}return O={get basename(){return s},get future(){return d},get state(){return b},get routes(){return o},get window(){return e},initialize:vt,subscribe:Hr,enableScrollRestoration:Ch,navigate:qn,fetch:pn,revalidate:Ba,createHref:F=>t.history.createHref(F),encodeLocation:F=>t.history.encodeLocation(F),getFetcher:yi,deleteFetcher:kl,dispose:Br,getBlocker:bi,deleteBlocker:Tl,patchRoutes:Dh,_internalFetchControllers:_,_internalSetRoutes:Lh},O}function M0(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function Ac(t,e,r,n,a,o){let i,s;if(a){i=[];for(let c of e)if(i.push(c),c.route.id===a){s=c;break}}else i=e,s=e[e.length-1];let l=Vi(n||".",Gi(i),Wt(t.pathname,r)||t.pathname,o==="path");if(n==null&&(l.search=t.search,l.hash=t.hash),(n==null||n===""||n===".")&&s){let c=Fc(l.search);if(s.route.index&&!c)l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index";else if(!s.route.index&&c){let d=new URLSearchParams(l.search),u=d.getAll("index");d.delete("index"),u.filter(p=>p).forEach(p=>d.append("index",p));let h=d.toString();l.search=h?`?${h}`:""}}return r!=="/"&&(l.pathname=l.pathname==="/"?r:hr([r,l.pathname])),Ar(l)}function bf(t,e,r){if(!r||!M0(r))return{path:e};if(r.formMethod&&!U0(r.formMethod))return{path:e,error:Ft(405,{method:r.formMethod})};let n=()=>({path:e,error:Ft(400,{type:"invalid-body"})}),a=(r.formMethod||"get").toUpperCase(),o=Of(e);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Gt(a))return n();let d=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((u,[h,p])=>`${u}${h}=${p}
`,""):String(r.body);return{path:e,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:void 0,text:d}}}else if(r.formEncType==="application/json"){if(!Gt(a))return n();try{let d=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:e,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:d,text:void 0}}}catch{return n()}}}xe(typeof FormData=="function","FormData is not available in this environment");let i,s;if(r.formData)i=Rc(r.formData),s=r.formData;else if(r.body instanceof FormData)i=Rc(r.body),s=r.body;else if(r.body instanceof URLSearchParams)i=r.body,s=Mf(i);else if(r.body==null)i=new URLSearchParams,s=new FormData;else try{i=new URLSearchParams(r.body),s=Mf(i)}catch{return n()}let l={formMethod:a,formAction:o,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:s,json:void 0,text:void 0};if(Gt(l.formMethod))return{path:e,submission:l};let c=Mr(e);return t&&c.search&&Fc(c.search)&&i.append("index",""),c.search=`?${i}`,{path:Ar(c),submission:l}}function Ef(t,e,r=!1){let n=t.findIndex(a=>a.route.id===e);return n>=0?t.slice(0,r?n+1:n):t}function Sf(t,e,r,n,a,o,i,s,l,c,d,u,h,p){let f=p?St(p[1])?p[1].error:p[1].data:void 0,g=t.createURL(e.location),y=t.createURL(a),E=r;o&&e.errors?E=Ef(r,Object.keys(e.errors)[0],!0):p&&St(p[1])&&(E=Ef(r,p[0]));let k=p?p[1].statusCode:void 0,R=k&&k>=400,O=E.filter((U,H)=>{let{route:$}=U;if($.lazy)return!0;if($.loader==null)return!1;if(o)return Mc($,e.loaderData,e.errors);if(R0(e.loaderData,e.matches[H],U))return!0;let G=e.matches[H],ne=U;return xf(U,{currentUrl:g,currentParams:G.params,nextUrl:y,nextParams:ne.params,...n,actionResult:f,actionStatus:k,defaultShouldRevalidate:R?!1:i||g.pathname+g.search===y.pathname+y.search||g.search!==y.search||F0(G,ne)})}),b=[];return c.forEach((U,H)=>{if(o||!r.some(S=>S.route.id===U.routeId)||l.has(H))return;let $=qr(u,U.path,h);if(!$){b.push({key:H,routeId:U.routeId,path:U.path,matches:null,match:null,controller:null});return}let G=e.fetchers.get(H),ne=go($,U.path),he=!1;d.has(H)?he=!1:s.has(H)?(s.delete(H),he=!0):G&&G.state!=="idle"&&G.data===void 0?he=i:he=xf(ne,{currentUrl:g,currentParams:e.matches[e.matches.length-1].params,nextUrl:y,nextParams:r[r.length-1].params,...n,actionResult:f,actionStatus:k,defaultShouldRevalidate:R?!1:i}),he&&b.push({key:H,routeId:U.routeId,path:U.path,matches:$,match:ne,controller:new AbortController})}),[O,b]}function Mc(t,e,r){if(t.lazy)return!0;if(!t.loader)return!1;let n=e!=null&&e[t.id]!==void 0,a=r!=null&&r[t.id]!==void 0;return!n&&a?!1:typeof t.loader=="function"&&t.loader.hydrate===!0?!0:!n&&!a}function R0(t,e,r){let n=!e||r.route.id!==e.route.id,a=!t.hasOwnProperty(r.route.id);return n||a}function F0(t,e){let r=t.route.path;return t.pathname!==e.pathname||r!=null&&r.endsWith("*")&&t.params["*"]!==e.params["*"]}function xf(t,e){if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate(e);if(typeof r=="boolean")return r}return e.defaultShouldRevalidate}function kf(t,e,r,n,a){let o;if(t){let l=n[t];xe(l,`No route found to patch children into: routeId = ${t}`),l.children||(l.children=[]),o=l.children}else o=r;let i=e.filter(l=>!o.some(c=>Tf(l,c))),s=Bi(i,a,[t||"_","patch",String((o==null?void 0:o.length)||"0")],n);o.push(...s)}function Tf(t,e){return"id"in t&&"id"in e&&t.id===e.id?!0:t.index===e.index&&t.path===e.path&&t.caseSensitive===e.caseSensitive?(!t.children||t.children.length===0)&&(!e.children||e.children.length===0)?!0:t.children.every((r,n)=>{var a;return(a=e.children)==null?void 0:a.some(o=>Tf(r,o))}):!1}async function N0(t,e,r){if(!t.lazy)return;let n=await t.lazy();if(!t.lazy)return;let a=r[t.id];xe(a,"No route found in manifest");let o={};for(let i in n){let s=a[i]!==void 0&&i!=="hasErrorBoundary";tt(!s,`Route "${a.id}" has a static property "${i}" defined but its lazy function is also returning a value for this property. The lazy route property "${i}" will be ignored.`),!s&&!t0.has(i)&&(o[i]=n[i])}Object.assign(a,o),Object.assign(a,{...e(a),lazy:void 0})}async function P0({matches:t}){let e=t.filter(r=>r.shouldLoad);return(await Promise.all(e.map(r=>r.resolve()))).reduce((r,n,a)=>Object.assign(r,{[e[a].route.id]:n}),{})}async function O0(t,e,r,n,a,o,i,s,l,c){let d=o.map(p=>p.route.lazy?N0(p.route,l,s):void 0),u=o.map((p,f)=>{let g=d[f],y=a.some(E=>E.route.id===p.route.id);return{...p,shouldLoad:y,resolve:async E=>(E&&n.method==="GET"&&(p.route.lazy||p.route.loader)&&(y=!0),y?I0(e,n,p,g,E,c):Promise.resolve({type:"data",result:void 0}))}}),h=await t({matches:u,request:n,params:o[0].params,fetcherKey:i,context:c});try{await Promise.all(d)}catch{}return h}async function I0(t,e,r,n,a,o){let i,s,l=c=>{let d,u=new Promise((f,g)=>d=g);s=()=>d(),e.signal.addEventListener("abort",s);let h=f=>typeof c!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${t}" [routeId: ${r.route.id}]`)):c({request:e,params:r.params,context:o},...f!==void 0?[f]:[]),p=(async()=>{try{return{type:"data",result:await(a?a(f=>h(f)):h())}}catch(f){return{type:"error",result:f}}})();return Promise.race([p,u])};try{let c=r.route[t];if(n)if(c){let d,[u]=await Promise.all([l(c).catch(h=>{d=h}),n]);if(d!==void 0)throw d;i=u}else if(await n,c=r.route[t],c)i=await l(c);else if(t==="action"){let d=new URL(e.url),u=d.pathname+d.search;throw Ft(405,{method:e.method,pathname:u,routeId:r.route.id})}else return{type:"data",result:void 0};else if(c)i=await l(c);else{let d=new URL(e.url),u=d.pathname+d.search;throw Ft(404,{pathname:u})}}catch(c){return{type:"error",result:c}}finally{s&&e.signal.removeEventListener("abort",s)}return i}async function C0(t){var n,a,o,i;let{result:e,type:r}=t;if(Cf(e)){let s;try{let l=e.headers.get("Content-Type");l&&/\bapplication\/json\b/.test(l)?e.body==null?s=null:s=await e.json():s=await e.text()}catch(l){return{type:"error",error:l}}return r==="error"?{type:"error",error:new qi(e.status,e.statusText,s),statusCode:e.status,headers:e.headers}:{type:"data",data:s,statusCode:e.status,headers:e.headers}}if(r==="error"){if(If(e)){if(e.data instanceof Error)return{type:"error",error:e.data,statusCode:(n=e.init)==null?void 0:n.status};e=new qi(((a=e.init)==null?void 0:a.status)||500,void 0,e.data)}return{type:"error",error:e,statusCode:Zi(e)?e.status:void 0}}return If(e)?{type:"data",data:e.data,statusCode:(o=e.init)==null?void 0:o.status,headers:(i=e.init)!=null&&i.headers?new Headers(e.init.headers):void 0}:{type:"data",data:e}}function j0(t,e,r,n,a){let o=t.headers.get("Location");if(xe(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!Tc.test(o)){let i=n.slice(0,n.findIndex(s=>s.route.id===r)+1);o=Ac(new URL(e.url),i,a,o),t.headers.set("Location",o)}return t}function Af(t,e,r){if(Tc.test(t)){let n=t,a=n.startsWith("//")?new URL(e.protocol+n):new URL(n),o=Wt(a.pathname,r)!=null;if(a.origin===e.origin&&o)return a.pathname+a.search+a.hash}return t}function la(t,e,r,n){let a=t.createURL(Of(e)).toString(),o={signal:r};if(n&&Gt(n.formMethod)){let{formMethod:i,formEncType:s}=n;o.method=i.toUpperCase(),s==="application/json"?(o.headers=new Headers({"Content-Type":s}),o.body=JSON.stringify(n.json)):s==="text/plain"?o.body=n.text:s==="application/x-www-form-urlencoded"&&n.formData?o.body=Rc(n.formData):o.body=n.formData}return new Request(a,o)}function Rc(t){let e=new URLSearchParams;for(let[r,n]of t.entries())e.append(r,typeof n=="string"?n:n.name);return e}function Mf(t){let e=new FormData;for(let[r,n]of t.entries())e.append(r,n);return e}function L0(t,e,r,n=!1,a=!1){let o={},i=null,s,l=!1,c={},d=r&&St(r[1])?r[1].error:void 0;return t.forEach(u=>{if(!(u.route.id in e))return;let h=u.route.id,p=e[h];if(xe(!Tn(p),"Cannot handle redirect results in processLoaderData"),St(p)){let f=p.error;if(d!==void 0&&(f=d,d=void 0),i=i||{},a)i[h]=f;else{let g=kn(t,h);i[g.route.id]==null&&(i[g.route.id]=f)}n||(o[h]=_f),l||(l=!0,s=Zi(p.error)?p.error.status:500),p.headers&&(c[h]=p.headers)}else o[h]=p.data,p.statusCode&&p.statusCode!==200&&!l&&(s=p.statusCode),p.headers&&(c[h]=p.headers)}),d!==void 0&&r&&(i={[r[0]]:d},o[r[0]]=void 0),{loaderData:o,errors:i,statusCode:s||200,loaderHeaders:c}}function Rf(t,e,r,n,a,o){let{loaderData:i,errors:s}=L0(e,r,n);return a.forEach(l=>{let{key:c,match:d,controller:u}=l,h=o[c];if(xe(h,"Did not find corresponding fetcher result"),!(u&&u.signal.aborted))if(St(h)){let p=kn(t.matches,d==null?void 0:d.route.id);s&&s[p.route.id]||(s={...s,[p.route.id]:h.error}),t.fetchers.delete(c)}else if(Tn(h))xe(!1,"Unhandled fetcher revalidation redirect");else{let p=Zr(h.data);t.fetchers.set(c,p)}}),{loaderData:i,errors:s}}function Ff(t,e,r,n){let a=Object.entries(e).filter(([,o])=>o!==_f).reduce((o,[i,s])=>(o[i]=s,o),{});for(let o of r){let i=o.route.id;if(!e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&o.route.loader&&(a[i]=t[i]),n&&n.hasOwnProperty(i))break}return a}function Nf(t){return t?St(t[1])?{actionData:{}}:{actionData:{[t[0]]:t[1].data}}:{}}function kn(t,e){return(e?t.slice(0,t.findIndex(r=>r.route.id===e)+1):[...t]).reverse().find(r=>r.route.hasErrorBoundary===!0)||t[0]}function Pf(t){let e=t.length===1?t[0]:t.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Ft(t,{pathname:e,routeId:r,method:n,type:a,message:o}={}){let i="Unknown Server Error",s="Unknown @remix-run/router error";return t===400?(i="Bad Request",n&&e&&r?s=`You made a ${n} request to "${e}" but did not provide a \`loader\` for route "${r}", so there is no way to handle the request.`:a==="invalid-body"&&(s="Unable to encode submission body")):t===403?(i="Forbidden",s=`Route "${r}" does not match URL "${e}"`):t===404?(i="Not Found",s=`No route matches URL "${e}"`):t===405&&(i="Method Not Allowed",n&&e&&r?s=`You made a ${n.toUpperCase()} request to "${e}" but did not provide an \`action\` for route "${r}", so there is no way to handle the request.`:n&&(s=`Invalid request method "${n.toUpperCase()}"`)),new qi(t||500,i,new Error(s),!0)}function Ji(t){let e=Object.entries(t);for(let r=e.length-1;r>=0;r--){let[n,a]=e[r];if(Tn(a))return{key:n,result:a}}}function Of(t){let e=typeof t=="string"?Mr(t):t;return Ar({...e,hash:""})}function D0(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function $0(t){return Cf(t.result)&&x0.has(t.result.status)}function St(t){return t.type==="error"}function Tn(t){return(t&&t.type)==="redirect"}function If(t){return typeof t=="object"&&t!=null&&"type"in t&&"data"in t&&"init"in t&&t.type==="DataWithResponseInit"}function Cf(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function U0(t){return S0.has(t.toUpperCase())}function Gt(t){return b0.has(t.toUpperCase())}function Fc(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function go(t,e){let r=typeof e=="string"?Mr(e).search:e.search;if(t[t.length-1].route.index&&Fc(r||""))return t[t.length-1];let n=gf(t);return n[n.length-1]}function jf(t){let{formMethod:e,formAction:r,formEncType:n,text:a,formData:o,json:i}=t;if(!(!e||!r||!n)){if(a!=null)return{formMethod:e,formAction:r,formEncType:n,formData:void 0,json:void 0,text:a};if(o!=null)return{formMethod:e,formAction:r,formEncType:n,formData:o,json:void 0,text:void 0};if(i!==void 0)return{formMethod:e,formAction:r,formEncType:n,formData:void 0,json:i,text:void 0}}}function Nc(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function z0(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function yo(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function B0(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function Zr(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function H0(t,e){try{let r=t.sessionStorage.getItem(vf);if(r){let n=JSON.parse(r);for(let[a,o]of Object.entries(n||{}))o&&Array.isArray(o)&&e.set(a,new Set(o||[]))}}catch{}}function W0(t,e){if(e.size>0){let r={};for(let[n,a]of e)r[n]=[...a];try{t.sessionStorage.setItem(vf,JSON.stringify(r))}catch(n){tt(!1,`Failed to save applied view transitions in sessionStorage (${n}).`)}}}function G0(){let t,e,r=new Promise((n,a)=>{t=async o=>{n(o);try{await r}catch{}},e=async o=>{a(o);try{await r}catch{}}});return{promise:r,resolve:t,reject:e}}var An=m.createContext(null);An.displayName="DataRouter";var vo=m.createContext(null);vo.displayName="DataRouterState";var Pc=m.createContext({isTransitioning:!1});Pc.displayName="ViewTransition";var Lf=m.createContext(new Map);Lf.displayName="Fetchers";var V0=m.createContext(null);V0.displayName="Await";var Vt=m.createContext(null);Vt.displayName="Navigation";var Ki=m.createContext(null);Ki.displayName="Location";var Nt=m.createContext({outlet:null,matches:[],isDataRoute:!1});Nt.displayName="Route";var Oc=m.createContext(null);Oc.displayName="RouteError";function q0(t,{relative:e}={}){xe(ca(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:n}=m.useContext(Vt),{hash:a,pathname:o,search:i}=_o(t,{relative:e}),s=o;return r!=="/"&&(s=o==="/"?r:hr([r,o])),n.createHref({pathname:s,search:i,hash:a})}function ca(){return m.useContext(Ki)!=null}function pr(){return xe(ca(),"useLocation() may be used only in the context of a <Router> component."),m.useContext(Ki).location}var Df="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function $f(t){m.useContext(Vt).static||m.useLayoutEffect(t)}ta=function(){let{isDataRoute:t}=m.useContext(Nt);return t?sE():Z0()};function Z0(){xe(ca(),"useNavigate() may be used only in the context of a <Router> component.");let t=m.useContext(An),{basename:e,navigator:r}=m.useContext(Vt),{matches:n}=m.useContext(Nt),{pathname:a}=pr(),o=JSON.stringify(Gi(n)),i=m.useRef(!1);return $f(()=>{i.current=!0}),m.useCallback((s,l={})=>{if(tt(i.current,Df),!i.current)return;if(typeof s=="number"){r.go(s);return}let c=Vi(s,JSON.parse(o),a,l.relative==="path");t==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:hr([e,c.pathname])),(l.replace?r.replace:r.push)(c,l.state,l)},[e,r,o,a,t])}var J0=m.createContext(null);function K0(t){let e=m.useContext(Nt).outlet;return e&&m.createElement(J0.Provider,{value:t},e)}function Uf(){let{matches:t}=m.useContext(Nt),e=t[t.length-1];return e?e.params:{}}function _o(t,{relative:e}={}){let{matches:r}=m.useContext(Nt),{pathname:n}=pr(),a=JSON.stringify(Gi(r));return m.useMemo(()=>Vi(t,JSON.parse(a),n,e==="path"),[t,a,n,e])}function Y0(t,e,r,n){xe(ca(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=m.useContext(Vt),{matches:o}=m.useContext(Nt),i=o[o.length-1],s=i?i.params:{},l=i?i.pathname:"/",c=i?i.pathnameBase:"/",d=i&&i.route;{let y=d&&d.path||"";Hf(l,!d||y.endsWith("*")||y.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${y}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${y}"> to <Route path="${y==="/"?"*":`${y}/*`}">.`)}let u=pr(),h;h=u;let p=h.pathname||"/",f=p;if(c!=="/"){let y=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(y.length).join("/")}let g=qr(t,{pathname:f});return tt(d||g!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),tt(g==null||g[g.length-1].route.element!==void 0||g[g.length-1].route.Component!==void 0||g[g.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),rE(g&&g.map(y=>Object.assign({},y,{params:Object.assign({},s,y.params),pathname:hr([c,a.encodeLocation?a.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:hr([c,a.encodeLocation?a.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,r,n)}function X0(){let t=zf(),e=Zi(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:n},o={padding:"2px 4px",backgroundColor:n},i=null;return console.error("Error handled by React Router default ErrorBoundary:",t),i=m.createElement(m.Fragment,null,m.createElement("p",null,"\u{1F4BF} Hey developer \u{1F44B}"),m.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",m.createElement("code",{style:o},"ErrorBoundary")," or"," ",m.createElement("code",{style:o},"errorElement")," prop on your route.")),m.createElement(m.Fragment,null,m.createElement("h2",null,"Unexpected Application Error!"),m.createElement("h3",{style:{fontStyle:"italic"}},e),r?m.createElement("pre",{style:a},r):null,i)}var Q0=m.createElement(X0,null),eE=class extends m.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?m.createElement(Nt.Provider,{value:this.props.routeContext},m.createElement(Oc.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function tE({routeContext:t,match:e,children:r}){let n=m.useContext(An);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),m.createElement(Nt.Provider,{value:t},r)}function rE(t,e=[],r=null,n=null){if(t==null){if(!r)return null;if(r.errors)t=r.matches;else if(e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let a=t,o=r==null?void 0:r.errors;if(o!=null){let l=a.findIndex(c=>c.route.id&&(o==null?void 0:o[c.route.id])!==void 0);xe(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),a=a.slice(0,Math.min(a.length,l+1))}let i=!1,s=-1;if(r)for(let l=0;l<a.length;l++){let c=a[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(s=l),c.route.id){let{loaderData:d,errors:u}=r,h=c.route.loader&&!d.hasOwnProperty(c.route.id)&&(!u||u[c.route.id]===void 0);if(c.route.lazy||h){i=!0,s>=0?a=a.slice(0,s+1):a=[a[0]];break}}}return a.reduceRight((l,c,d)=>{let u,h=!1,p=null,f=null;r&&(u=o&&c.route.id?o[c.route.id]:void 0,p=c.route.errorElement||Q0,i&&(s<0&&d===0?(Hf("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,f=null):s===d&&(h=!0,f=c.route.hydrateFallbackElement||null)));let g=e.concat(a.slice(0,d+1)),y=()=>{let E;return u?E=p:h?E=f:c.route.Component?E=m.createElement(c.route.Component,null):c.route.element?E=c.route.element:E=l,m.createElement(tE,{match:c,routeContext:{outlet:l,matches:g,isDataRoute:r!=null},children:E})};return r&&(c.route.ErrorBoundary||c.route.errorElement||d===0)?m.createElement(eE,{location:r.location,revalidation:r.revalidation,component:p,error:u,children:y(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):y()},null)}function Ic(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nE(t){let e=m.useContext(An);return xe(e,Ic(t)),e}function aE(t){let e=m.useContext(vo);return xe(e,Ic(t)),e}function oE(t){let e=m.useContext(Nt);return xe(e,Ic(t)),e}function Cc(t){let e=oE(t),r=e.matches[e.matches.length-1];return xe(r.route.id,`${t} can only be used on routes that contain a unique "id"`),r.route.id}function iE(){return Cc("useRouteId")}function zf(){var n;let t=m.useContext(Oc),e=aE("useRouteError"),r=Cc("useRouteError");return t!==void 0?t:(n=e.errors)==null?void 0:n[r]}function sE(){let{router:t}=nE("useNavigate"),e=Cc("useNavigate"),r=m.useRef(!1);return $f(()=>{r.current=!0}),m.useCallback(async(n,a={})=>{tt(r.current,Df),r.current&&(typeof n=="number"?t.navigate(n):await t.navigate(n,{fromRouteId:e,...a}))},[t,e])}var Bf={};function Hf(t,e,r){!e&&!Bf[t]&&(Bf[t]=!0,tt(!1,r))}var Wf={};function Gf(t,e){!t&&!Wf[e]&&(Wf[e]=!0,console.warn(e))}function Vf(t){let e={hasErrorBoundary:t.hasErrorBoundary||t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&(t.element&&tt(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(e,{element:m.createElement(t.Component),Component:void 0})),t.HydrateFallback&&(t.hydrateFallbackElement&&tt(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(e,{hydrateFallbackElement:m.createElement(t.HydrateFallback),HydrateFallback:void 0})),t.ErrorBoundary&&(t.errorElement&&tt(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(e,{errorElement:m.createElement(t.ErrorBoundary),ErrorBoundary:void 0})),e}var lE=class{constructor(){this.status="pending",this.promise=new Promise((t,e)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",t(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",e(r))}})}};function cE({router:t,flushSync:e}){let[r,n]=m.useState(t.state),[a,o]=m.useState(),[i,s]=m.useState({isTransitioning:!1}),[l,c]=m.useState(),[d,u]=m.useState(),[h,p]=m.useState(),f=m.useRef(new Map),g=m.useCallback((R,{deletedFetchers:O,flushSync:b,viewTransitionOpts:U})=>{O.forEach($=>f.current.delete($)),R.fetchers.forEach(($,G)=>{$.data!==void 0&&f.current.set(G,$.data)}),Gf(b===!1||e!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let H=t.window!=null&&t.window.document!=null&&typeof t.window.document.startViewTransition=="function";if(Gf(U==null||H,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!U||!H){e&&b?e(()=>n(R)):m.startTransition(()=>n(R));return}if(e&&b){e(()=>{d&&(l&&l.resolve(),d.skipTransition()),s({isTransitioning:!0,flushSync:!0,currentLocation:U.currentLocation,nextLocation:U.nextLocation})});let $=t.window.document.startViewTransition(()=>{e(()=>n(R))});$.finished.finally(()=>{e(()=>{c(void 0),u(void 0),o(void 0),s({isTransitioning:!1})})}),e(()=>u($));return}d?(l&&l.resolve(),d.skipTransition(),p({state:R,currentLocation:U.currentLocation,nextLocation:U.nextLocation})):(o(R),s({isTransitioning:!0,flushSync:!1,currentLocation:U.currentLocation,nextLocation:U.nextLocation}))},[t.window,e,d,l]);m.useLayoutEffect(()=>t.subscribe(g),[t,g]),m.useEffect(()=>{i.isTransitioning&&!i.flushSync&&c(new lE)},[i]),m.useEffect(()=>{if(l&&a&&t.window){let R=a,O=l.promise,b=t.window.document.startViewTransition(async()=>{m.startTransition(()=>n(R)),await O});b.finished.finally(()=>{c(void 0),u(void 0),o(void 0),s({isTransitioning:!1})}),u(b)}},[a,l,t.window]),m.useEffect(()=>{l&&a&&r.location.key===a.location.key&&l.resolve()},[l,d,r.location,a]),m.useEffect(()=>{!i.isTransitioning&&h&&(o(h.state),s({isTransitioning:!0,flushSync:!1,currentLocation:h.currentLocation,nextLocation:h.nextLocation}),p(void 0))},[i.isTransitioning,h]);let y=m.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:R=>t.navigate(R),push:(R,O,b)=>t.navigate(R,{state:O,preventScrollReset:b==null?void 0:b.preventScrollReset}),replace:(R,O,b)=>t.navigate(R,{replace:!0,state:O,preventScrollReset:b==null?void 0:b.preventScrollReset})}),[t]),E=t.basename||"/",k=m.useMemo(()=>({router:t,navigator:y,static:!1,basename:E}),[t,y,E]);return m.createElement(m.Fragment,null,m.createElement(An.Provider,{value:k},m.createElement(vo.Provider,{value:r},m.createElement(Lf.Provider,{value:f.current},m.createElement(Pc.Provider,{value:i},m.createElement(fE,{basename:E,location:r.location,navigationType:r.historyAction,navigator:y},m.createElement(dE,{routes:t.routes,future:t.future,state:r})))))),null)}var dE=m.memo(uE);function uE({routes:t,future:e,state:r}){return Y0(t,void 0,r,e)}function hE({to:t,replace:e,state:r,relative:n}){xe(ca(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=m.useContext(Vt);tt(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=m.useContext(Nt),{pathname:i}=pr(),s=ta(),l=Vi(t,Gi(o),i,n==="path"),c=JSON.stringify(l);return m.useEffect(()=>{s(JSON.parse(c),{replace:e,state:r,relative:n})},[s,c,n,e,r]),null}function pE(t){return K0(t.context)}function Rr(t){xe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function fE({basename:t="/",children:e=null,location:r,navigationType:n="POP",navigator:a,static:o=!1}){xe(!ca(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let i=t.replace(/^\/*/,"/"),s=m.useMemo(()=>({basename:i,navigator:a,static:o,future:{}}),[i,a,o]);typeof r=="string"&&(r=Mr(r));let{pathname:l="/",search:c="",hash:d="",state:u=null,key:h="default"}=r,p=m.useMemo(()=>{let f=Wt(l,i);return f==null?null:{location:{pathname:f,search:c,hash:d,state:u,key:h},navigationType:n}},[i,l,c,d,u,h,n]);return tt(p!=null,`<Router basename="${i}"> is not able to match the URL "${l}${c}${d}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:m.createElement(Vt.Provider,{value:s},m.createElement(Ki.Provider,{children:e,value:p}))}function jc(t,e=[]){let r=[];return m.Children.forEach(t,(n,a)=>{if(!m.isValidElement(n))return;let o=[...e,a];if(n.type===m.Fragment){r.push.apply(r,jc(n.props.children,o));return}xe(n.type===Rr,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),xe(!n.props.index||!n.props.children,"An index route cannot have child routes.");let i={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=jc(n.props.children,o)),r.push(i)}),r}var mE=jc,Yi="get",Xi="application/x-www-form-urlencoded";function Qi(t){return t!=null&&typeof t.tagName=="string"}function gE(t){return Qi(t)&&t.tagName.toLowerCase()==="button"}function yE(t){return Qi(t)&&t.tagName.toLowerCase()==="form"}function vE(t){return Qi(t)&&t.tagName.toLowerCase()==="input"}function _E(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function wE(t,e){return t.button===0&&(!e||e==="_self")&&!_E(t)}var es=null;function bE(){if(es===null)try{new FormData(document.createElement("form"),0),es=!1}catch{es=!0}return es}var EE=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Lc(t){return t!=null&&!EE.has(t)?(tt(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Xi}"`),null):t}function SE(t,e){let r,n,a,o,i;if(yE(t)){let s=t.getAttribute("action");n=s?Wt(s,e):null,r=t.getAttribute("method")||Yi,a=Lc(t.getAttribute("enctype"))||Xi,o=new FormData(t)}else if(gE(t)||vE(t)&&(t.type==="submit"||t.type==="image")){let s=t.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||s.getAttribute("action");if(n=l?Wt(l,e):null,r=t.getAttribute("formmethod")||s.getAttribute("method")||Yi,a=Lc(t.getAttribute("formenctype"))||Lc(s.getAttribute("enctype"))||Xi,o=new FormData(s,t),!bE()){let{name:c,type:d,value:u}=t;if(d==="image"){let h=c?`${c}.`:"";o.append(`${h}x`,"0"),o.append(`${h}y`,"0")}else c&&o.append(c,u)}}else{if(Qi(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=Yi,n=null,a=Xi,i=t}return o&&a==="text/plain"&&(i=o,o=void 0),{action:n,method:r.toLowerCase(),encType:a,formData:o,body:i}}function Dc(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function xE(t,e){if(t.id in e)return e[t.id];try{let r=await import(t.module).then(async n=>(await n.__tla,n));return e[t.id]=r,r}catch(r){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function kE(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function TE(t,e,r){let n=await Promise.all(t.map(async a=>{let o=e.routes[a.route.id];if(o){let i=await xE(o,r);return i.links?i.links():[]}return[]}));return FE(n.flat(1).filter(kE).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function qf(t,e,r,n,a,o){let i=(l,c)=>r[c]?l.route.id!==r[c].route.id:!0,s=(l,c)=>{var d;return r[c].pathname!==l.pathname||((d=r[c].route.path)==null?void 0:d.endsWith("*"))&&r[c].params["*"]!==l.params["*"]};return o==="assets"?e.filter((l,c)=>i(l,c)||s(l,c)):o==="data"?e.filter((l,c)=>{var u;let d=n.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(i(l,c)||s(l,c))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:((u=r[0])==null?void 0:u.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function AE(t,e){return ME(t.map(r=>{let n=e.routes[r.route.id];if(!n)return[];let a=[n.module];return n.imports&&(a=a.concat(n.imports)),a}).flat(1))}function ME(t){return[...new Set(t)]}function RE(t){let e={},r=Object.keys(t).sort();for(let n of r)e[n]=t[n];return e}function FE(t,e){let r=new Set;return new Set(e),t.reduce((n,a)=>{let o=JSON.stringify(RE(a));return r.has(o)||(r.add(o),n.push({key:o,link:a})),n},[])}function NE(t){let e=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function PE(){let t=m.useContext(An);return Dc(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function OE(){let t=m.useContext(vo);return Dc(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var $c=m.createContext(void 0);$c.displayName="FrameworkContext";function Zf(){let t=m.useContext($c);return Dc(t,"You must render this element inside a <HydratedRouter> element"),t}function IE(t,e){let r=m.useContext($c),[n,a]=m.useState(!1),[o,i]=m.useState(!1),{onFocus:s,onBlur:l,onMouseEnter:c,onMouseLeave:d,onTouchStart:u}=e,h=m.useRef(null);m.useEffect(()=>{if(t==="render"&&i(!0),t==="viewport"){let g=E=>{E.forEach(k=>{i(k.isIntersecting)})},y=new IntersectionObserver(g,{threshold:.5});return h.current&&y.observe(h.current),()=>{y.disconnect()}}},[t]),m.useEffect(()=>{if(n){let g=setTimeout(()=>{i(!0)},100);return()=>{clearTimeout(g)}}},[n]);let p=()=>{a(!0)},f=()=>{a(!1),i(!1)};return r?t!=="intent"?[o,h,{}]:[o,h,{onFocus:wo(s,p),onBlur:wo(l,f),onMouseEnter:wo(c,p),onMouseLeave:wo(d,f),onTouchStart:wo(u,p)}]:[!1,h,{}]}function wo(t,e){return r=>{t&&t(r),r.defaultPrevented||e(r)}}function CE({page:t,...e}){let{router:r}=PE(),n=m.useMemo(()=>qr(r.routes,t,r.basename),[r.routes,t,r.basename]);return n?m.createElement(LE,{page:t,matches:n,...e}):(console.warn(`Tried to prefetch ${t} but no routes matched.`),null)}function jE(t){let{manifest:e,routeModules:r}=Zf(),[n,a]=m.useState([]);return m.useEffect(()=>{let o=!1;return TE(t,e,r).then(i=>{o||a(i)}),()=>{o=!0}},[t,e,r]),n}function LE({page:t,matches:e,...r}){let n=pr(),{manifest:a,routeModules:o}=Zf(),{loaderData:i,matches:s}=OE(),l=m.useMemo(()=>qf(t,e,s,a,n,"data"),[t,e,s,a,n]),c=m.useMemo(()=>qf(t,e,s,a,n,"assets"),[t,e,s,a,n]),d=m.useMemo(()=>{if(t===n.pathname+n.search+n.hash)return[];let p=new Set,f=!1;if(e.forEach(y=>{var k;let E=a.routes[y.route.id];!E||!E.hasLoader||(!l.some(R=>R.route.id===y.route.id)&&y.route.id in i&&((k=o[y.route.id])!=null&&k.shouldRevalidate)||E.hasClientLoader?f=!0:p.add(y.route.id))}),p.size===0)return[];let g=NE(t);return f&&p.size>0&&g.searchParams.set("_routes",e.filter(y=>p.has(y.route.id)).map(y=>y.route.id).join(",")),[g.pathname+g.search]},[i,n,a,l,e,t,o]),u=m.useMemo(()=>AE(c,a),[c,a]),h=jE(c);return m.createElement(m.Fragment,null,d.map(p=>m.createElement("link",{key:p,rel:"prefetch",as:"fetch",href:p,...r})),u.map(p=>m.createElement("link",{key:p,rel:"modulepreload",href:p,...r})),h.map(({key:p,link:f})=>m.createElement("link",{key:p,...f})))}function DE(...t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}var Jf=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Jf&&(window.__reactRouterVersion="7.0.2")}catch{}function Kf(t,e){return wf({basename:e==null?void 0:e.basename,future:e==null?void 0:e.future,history:Xb({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||Yf(),routes:t,mapRouteProperties:Vf,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function $E(t,e){return wf({basename:e==null?void 0:e.basename,future:e==null?void 0:e.future,history:Qb({window:e==null?void 0:e.window}),hydrationData:Yf(),routes:t,mapRouteProperties:Vf,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function Yf(){let t=window==null?void 0:window.__staticRouterHydrationData;return t&&t.errors&&(t={...t,errors:UE(t.errors)}),t}function UE(t){if(!t)return null;let e=Object.entries(t),r={};for(let[n,a]of e)if(a&&a.__type==="RouteErrorResponse")r[n]=new qi(a.status,a.statusText,a.data,a.internal===!0);else if(a&&a.__type==="Error"){if(a.__subType){let o=window[a.__subType];if(typeof o=="function")try{let i=new o(a.message);i.stack="",r[n]=i}catch{}}if(r[n]==null){let o=new Error(a.message);o.stack="",r[n]=o}}else r[n]=a;return r}var Xf=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Uc=m.forwardRef(function({onClick:t,discover:e="render",prefetch:r="none",relative:n,reloadDocument:a,replace:o,state:i,target:s,to:l,preventScrollReset:c,viewTransition:d,...u},h){let{basename:p}=m.useContext(Vt),f=typeof l=="string"&&Xf.test(l),g,y=!1;if(typeof l=="string"&&f&&(g=l,Jf))try{let $=new URL(window.location.href),G=l.startsWith("//")?new URL($.protocol+l):new URL(l),ne=Wt(G.pathname,p);G.origin===$.origin&&ne!=null?l=ne+G.search+G.hash:y=!0}catch{tt(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let E=q0(l,{relative:n}),[k,R,O]=IE(r,u),b=WE(l,{replace:o,state:i,target:s,preventScrollReset:c,relative:n,viewTransition:d});function U($){t&&t($),$.defaultPrevented||b($)}let H=m.createElement("a",{...u,...O,href:g||E,onClick:y||a?t:U,ref:DE(h,R),target:s,"data-discover":!f&&e==="render"?"true":void 0});return k&&!f?m.createElement(m.Fragment,null,H,m.createElement(CE,{page:E})):H});Uc.displayName="Link";var zE=m.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:r="",end:n=!1,style:a,to:o,viewTransition:i,children:s,...l},c){let d=_o(o,{relative:l.relative}),u=pr(),h=m.useContext(vo),{navigator:p,basename:f}=m.useContext(Vt),g=h!=null&&JE(d)&&i===!0,y=p.encodeLocation?p.encodeLocation(d).pathname:d.pathname,E=u.pathname,k=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;e||(E=E.toLowerCase(),k=k?k.toLowerCase():null,y=y.toLowerCase()),k&&f&&(k=Wt(k,f)||k);const R=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let O=E===y||!n&&E.startsWith(y)&&E.charAt(R)==="/",b=k!=null&&(k===y||!n&&k.startsWith(y)&&k.charAt(y.length)==="/"),U={isActive:O,isPending:b,isTransitioning:g},H=O?t:void 0,$;typeof r=="function"?$=r(U):$=[r,O?"active":null,b?"pending":null,g?"transitioning":null].filter(Boolean).join(" ");let G=typeof a=="function"?a(U):a;return m.createElement(Uc,{...l,"aria-current":H,className:$,ref:c,style:G,to:o,viewTransition:i},typeof s=="function"?s(U):s)});zE.displayName="NavLink";var BE=m.forwardRef(({discover:t="render",fetcherKey:e,navigate:r,reloadDocument:n,replace:a,state:o,method:i=Yi,action:s,onSubmit:l,relative:c,preventScrollReset:d,viewTransition:u,...h},p)=>{let f=qE(),g=ZE(s,{relative:c}),y=i.toLowerCase()==="get"?"get":"post",E=typeof s=="string"&&Xf.test(s),k=R=>{if(l&&l(R),R.defaultPrevented)return;R.preventDefault();let O=R.nativeEvent.submitter,b=(O==null?void 0:O.getAttribute("formmethod"))||i;f(O||R.currentTarget,{fetcherKey:e,method:b,navigate:r,replace:a,state:o,relative:c,preventScrollReset:d,viewTransition:u})};return m.createElement("form",{ref:p,method:y,action:g,onSubmit:n?l:k,...h,"data-discover":!E&&t==="render"?"true":void 0})});BE.displayName="Form";function HE(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Qf(t){let e=m.useContext(An);return xe(e,HE(t)),e}function WE(t,{target:e,replace:r,state:n,preventScrollReset:a,relative:o,viewTransition:i}={}){let s=ta(),l=pr(),c=_o(t,{relative:o});return m.useCallback(d=>{if(wE(d,e)){d.preventDefault();let u=r!==void 0?r:Ar(l)===Ar(c);s(t,{replace:u,state:n,preventScrollReset:a,relative:o,viewTransition:i})}},[l,s,c,r,n,e,t,a,o,i])}var GE=0,VE=()=>`__${String(++GE)}__`;function qE(){let{router:t}=Qf("useSubmit"),{basename:e}=m.useContext(Vt),r=iE();return m.useCallback(async(n,a={})=>{let{action:o,method:i,encType:s,formData:l,body:c}=SE(n,e);if(a.navigate===!1){let d=a.fetcherKey||VE();await t.fetch(d,r,a.action||o,{preventScrollReset:a.preventScrollReset,formData:l,body:c,formMethod:a.method||i,formEncType:a.encType||s,flushSync:a.flushSync})}else await t.navigate(a.action||o,{preventScrollReset:a.preventScrollReset,formData:l,body:c,formMethod:a.method||i,formEncType:a.encType||s,replace:a.replace,state:a.state,fromRouteId:r,flushSync:a.flushSync,viewTransition:a.viewTransition})},[t,e,r])}function ZE(t,{relative:e}={}){let{basename:r}=m.useContext(Vt),n=m.useContext(Nt);xe(n,"useFormAction must be used inside a RouteContext");let[a]=n.matches.slice(-1),o={..._o(t||".",{relative:e})},i=pr();if(t==null){o.search=i.search;let s=new URLSearchParams(o.search),l=s.getAll("index");if(l.some(c=>c==="")){s.delete("index"),l.filter(d=>d).forEach(d=>s.append("index",d));let c=s.toString();o.search=c?`?${c}`:""}}return(!t||t===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(o.pathname=o.pathname==="/"?r:hr([r,o.pathname])),Ar(o)}function JE(t,e={}){let r=m.useContext(Pc);xe(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=Qf("useViewTransitionState"),a=_o(t,{relative:e.relative});if(!r.isTransitioning)return!1;let o=Wt(r.currentLocation.pathname,n)||r.currentLocation.pathname,i=Wt(r.nextLocation.pathname,n)||r.nextLocation.pathname;return Wi(a.pathname,i)!=null||Wi(a.pathname,o)!=null}new TextEncoder;function KE(t){return m.createElement(cE,{flushSync:Sb.flushSync,...t})}var YE=BN.useId||(()=>{}),XE=0;Ut=function(t){const[e,r]=m.useState(YE());return xi(()=>{t||r(n=>n??String(XE++))},[t]),t||(e?`radix-${e}`:"")};let ts,em,tm,rs,zc;ts="Collapsible",[em,Ob]=ki(ts),[tm,rs]=em(ts),zc=m.forwardRef((t,e)=>{const{__scopeCollapsible:r,open:n,defaultOpen:a,disabled:o,onOpenChange:i,...s}=t,[l=!1,c]=Ya({prop:n,defaultProp:a,onChange:i});return v.jsx(tm,{scope:r,disabled:o,contentId:Ut(),open:l,onOpenToggle:m.useCallback(()=>c(d=>!d),[c]),children:v.jsx(Ze.div,{"data-state":Gc(l),"data-disabled":o?"":void 0,...s,ref:e})})}),zc.displayName=ts;var rm="CollapsibleTrigger",Bc=m.forwardRef((t,e)=>{const{__scopeCollapsible:r,...n}=t,a=rs(rm,r);return v.jsx(Ze.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":Gc(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...n,ref:e,onClick:_e(t.onClick,a.onOpenToggle)})});Bc.displayName=rm;var Hc="CollapsibleContent",Wc=m.forwardRef((t,e)=>{const{forceMount:r,...n}=t,a=rs(Hc,t.__scopeCollapsible);return v.jsx(Tr,{present:r||a.open,children:({present:o})=>v.jsx(QE,{...n,ref:e,present:o})})});Wc.displayName=Hc;var QE=m.forwardRef((t,e)=>{const{__scopeCollapsible:r,present:n,children:a,...o}=t,i=rs(Hc,r),[s,l]=m.useState(n),c=m.useRef(null),d=mt(e,c),u=m.useRef(0),h=u.current,p=m.useRef(0),f=p.current,g=i.open||s,y=m.useRef(g),E=m.useRef();return m.useEffect(()=>{const k=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(k)},[]),xi(()=>{const k=c.current;if(k){E.current=E.current||{transitionDuration:k.style.transitionDuration,animationName:k.style.animationName},k.style.transitionDuration="0s",k.style.animationName="none";const R=k.getBoundingClientRect();u.current=R.height,p.current=R.width,y.current||(k.style.transitionDuration=E.current.transitionDuration,k.style.animationName=E.current.animationName),l(n)}},[i.open,n]),v.jsx(Ze.div,{"data-state":Gc(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!g,...o,ref:d,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":f?`${f}px`:void 0,...t.style},children:g&&a})});function Gc(t){return t?"open":"closed"}rp=zc,Ib=Bc,Cb=Wc;const eS=rp,tS=Bc,rS=Wc,Vc=768;function nS(){const[t,e]=m.useState(void 0);return m.useEffect(()=>{const r=window.matchMedia(`(max-width: ${Vc-1}px)`),n=()=>{e(window.innerWidth<Vc)};return r.addEventListener("change",n),e(window.innerWidth<Vc),()=>r.removeEventListener("change",n)},[]),!!t}Np=Rl("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Wr=m.forwardRef(({className:t,variant:e,size:r,asChild:n=!1,...a},o)=>{const i=n?yn:"button";return v.jsx(i,{className:fe(Np({variant:e,size:r,className:t})),ref:o,...a})}),Wr.displayName="Button",ji=m.forwardRef(({className:t,type:e,...r},n)=>v.jsx("input",{type:e,className:fe("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...r})),ji.displayName="Input";var aS="Separator",nm="horizontal",oS=["horizontal","vertical"],am=m.forwardRef((t,e)=>{const{decorative:r,orientation:n=nm,...a}=t,o=iS(n)?n:nm,i=r?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return v.jsx(Ze.div,{"data-orientation":o,...i,...a,ref:e})});am.displayName=aS;function iS(t){return oS.includes(t)}tc=am,Ni=m.forwardRef(({className:t,orientation:e="horizontal",decorative:r=!0,...n},a)=>v.jsx(tc,{ref:a,decorative:r,orientation:e,className:fe("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...n})),Ni.displayName=tc.displayName;let ns,as,qc,om;ns="focusScope.autoFocusOnMount",as="focusScope.autoFocusOnUnmount",qc={bubbles:!1,cancelable:!0},om="FocusScope",Oi=m.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:a,onUnmountAutoFocus:o,...i}=t,[s,l]=m.useState(null),c=Xn(a),d=Xn(o),u=m.useRef(null),h=mt(e,g=>l(g)),p=m.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;m.useEffect(()=>{if(n){let g=function(R){if(p.paused||!s)return;const O=R.target;s.contains(O)?u.current=O:Jr(u.current,{select:!0})},y=function(R){if(p.paused||!s)return;const O=R.relatedTarget;O!==null&&(s.contains(O)||Jr(u.current,{select:!0}))},E=function(R){if(document.activeElement===document.body)for(const O of R)O.removedNodes.length>0&&Jr(s)};document.addEventListener("focusin",g),document.addEventListener("focusout",y);const k=new MutationObserver(E);return s&&k.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",y),k.disconnect()}}},[n,s,p.paused]),m.useEffect(()=>{if(s){lm.add(p);const g=document.activeElement;if(!s.contains(g)){const y=new CustomEvent(ns,qc);s.addEventListener(ns,c),s.dispatchEvent(y),y.defaultPrevented||(sS(hS(im(s)),{select:!0}),document.activeElement===g&&Jr(s))}return()=>{s.removeEventListener(ns,c),setTimeout(()=>{const y=new CustomEvent(as,qc);s.addEventListener(as,d),s.dispatchEvent(y),y.defaultPrevented||Jr(g??document.body,{select:!0}),s.removeEventListener(as,d),lm.remove(p)},0)}}},[s,c,d,p]);const f=m.useCallback(g=>{if(!r&&!n||p.paused)return;const y=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,E=document.activeElement;if(y&&E){const k=g.currentTarget,[R,O]=lS(k);R&&O?!g.shiftKey&&E===O?(g.preventDefault(),r&&Jr(R,{select:!0})):g.shiftKey&&E===R&&(g.preventDefault(),r&&Jr(O,{select:!0})):E===k&&g.preventDefault()}},[r,n,p.paused]);return v.jsx(Ze.div,{tabIndex:-1,...i,ref:h,onKeyDown:f})}),Oi.displayName=om;function sS(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if(Jr(n,{select:e}),document.activeElement!==r)return}function lS(t){const e=im(t),r=sm(e,t),n=sm(e.reverse(),t);return[r,n]}function im(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const a=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||a?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function sm(t,e){for(const r of t)if(!cS(r,{upTo:e}))return r}function cS(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function dS(t){return t instanceof HTMLInputElement&&"select"in t}function Jr(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&dS(t)&&e&&t.select()}}var lm=uS();function uS(){let t=[];return{add(e){const r=t[0];e!==r&&(r==null||r.pause()),t=cm(t,e),t.unshift(e)},remove(e){var r;t=cm(t,e),(r=t[0])==null||r.resume()}}}function cm(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function hS(t){return t.filter(e=>e.tagName!=="A")}var Zc=0;$l=function(){m.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??dm()),document.body.insertAdjacentElement("beforeend",t[1]??dm()),Zc++,()=>{Zc===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Zc--}},[])};function dm(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}$t=function(){return $t=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},$t.apply(this,arguments)},jl=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(r[n[a]]=t[n[a]]);return r},ip=function(t,e,r){if(r||arguments.length===2)for(var n=0,a=e.length,o;n<a;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))};var os="right-scroll-bar-position",is="width-before-scroll-bar",pS="with-scroll-bars-hidden",fS="--removed-body-scroll-bar-size";function Jc(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function mS(t,e){var r=m.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var a=r.value;a!==n&&(r.value=n,r.callback(n,a))}}}})[0];return r.callback=e,r.facade}var gS=typeof window<"u"?m.useLayoutEffect:m.useEffect,um=new WeakMap;function yS(t,e){var r=mS(null,function(n){return t.forEach(function(a){return Jc(a,n)})});return gS(function(){var n=um.get(r);if(n){var a=new Set(n),o=new Set(t),i=r.current;a.forEach(function(s){o.has(s)||Jc(s,null)}),o.forEach(function(s){a.has(s)||Jc(s,i)})}um.set(r,t)},[t]),r}function vS(t){return t}function _S(t,e){e===void 0&&(e=vS);var r=[],n=!1,a={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(o){var i=e(o,n);return r.push(i),function(){r=r.filter(function(s){return s!==i})}},assignSyncMedium:function(o){for(n=!0;r.length;){var i=r;r=[],i.forEach(o)}r={push:function(s){return o(s)},filter:function(){return r}}},assignMedium:function(o){n=!0;var i=[];if(r.length){var s=r;r=[],s.forEach(o),i=r}var l=function(){var d=i;i=[],d.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),r={push:function(d){i.push(d),c()},filter:function(d){return i=i.filter(d),r}}}};return a}ap=function(t){t===void 0&&(t={});var e=_S(null);return e.options=$t({async:!0,ssr:!1},t),e};var hm=function(t){var e=t.sideCar,r=jl(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return m.createElement(n,$t({},r))};hm.isSideCarExport=!0,sp=function(t,e){return t.useMedium(e),hm};var pm=ap(),Kc=function(){},ss=m.forwardRef(function(t,e){var r=m.useRef(null),n=m.useState({onScrollCapture:Kc,onWheelCapture:Kc,onTouchMoveCapture:Kc}),a=n[0],o=n[1],i=t.forwardProps,s=t.children,l=t.className,c=t.removeScrollBar,d=t.enabled,u=t.shards,h=t.sideCar,p=t.noIsolation,f=t.inert,g=t.allowPinchZoom,y=t.as,E=y===void 0?"div":y,k=t.gapMode,R=jl(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),O=h,b=yS([r,e]),U=$t($t({},R),a);return m.createElement(m.Fragment,null,d&&m.createElement(O,{sideCar:pm,removeScrollBar:c,shards:u,noIsolation:p,inert:f,setCallbacks:o,allowPinchZoom:!!g,lockRef:r,gapMode:k}),i?m.cloneElement(m.Children.only(s),$t($t({},U),{ref:b})):m.createElement(E,$t({},U,{className:l,ref:b}),s))});ss.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},ss.classNames={fullWidth:is,zeroRight:os},op=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function wS(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=op();return e&&t.setAttribute("nonce",e),t}function bS(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function ES(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}let fm,mm,gm,ls,ym,vm,_m,Mn,wm,Yc,bm,Em,cs;if(fm=function(){var t=0,e=null;return{add:function(r){t==0&&(e=wS())&&(bS(e,r),ES(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},mm=function(){var t=fm();return function(e,r){m.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},Ll=function(){var t=mm(),e=function(r){var n=r.styles,a=r.dynamic;return t(n,a),null};return e},gm={left:0,top:0,right:0,gap:0},ls=function(t){return parseInt(t||"",10)||0},ym=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],a=e[t==="padding"?"paddingRight":"marginRight"];return[ls(r),ls(n),ls(a)]},vm=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return gm;var e=ym(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},_m=Ll(),Mn="data-scroll-locked",wm=function(t,e,r,n){var a=t.left,o=t.top,i=t.right,s=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(pS,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(s,"px ").concat(n,`;
  }
  body[`).concat(Mn,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(s,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(os,` {
    right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(is,` {
    margin-right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(os," .").concat(os,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(is," .").concat(is,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Mn,`] {
    `).concat(fS,": ").concat(s,`px;
  }
`)},Yc=function(){var t=parseInt(document.body.getAttribute(Mn)||"0",10);return isFinite(t)?t:0},bm=function(){m.useEffect(function(){return document.body.setAttribute(Mn,(Yc()+1).toString()),function(){var t=Yc()-1;t<=0?document.body.removeAttribute(Mn):document.body.setAttribute(Mn,t.toString())}},[])},Em=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,a=n===void 0?"margin":n;bm();var o=m.useMemo(function(){return vm(a)},[a]);return m.createElement(_m,{styles:wm(o,!e,a,r?"":"!important")})},cs=!1,typeof window<"u")try{var ds=Object.defineProperty({},"passive",{get:function(){return cs=!0,!0}});window.addEventListener("test",ds,ds),window.removeEventListener("test",ds,ds)}catch{cs=!1}var da=cs?{passive:!1}:!1,SS=function(t){return t.tagName==="TEXTAREA"},Sm=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!SS(t)&&r[e]==="visible")},xS=function(t){return Sm(t,"overflowY")},kS=function(t){return Sm(t,"overflowX")},xm=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var a=km(t,n);if(a){var o=Tm(t,n),i=o[1],s=o[2];if(i>s)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},TS=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},AS=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},km=function(t,e){return t==="v"?xS(e):kS(e)},Tm=function(t,e){return t==="v"?TS(e):AS(e)},MS=function(t,e){return t==="h"&&e==="rtl"?-1:1},RS=function(t,e,r,n,a){var o=MS(t,window.getComputedStyle(e).direction),i=o*n,s=r.target,l=e.contains(s),c=!1,d=i>0,u=0,h=0;do{var p=Tm(t,s),f=p[0],g=p[1],y=p[2],E=g-y-o*f;(f||E)&&km(t,s)&&(u+=E,h+=f),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!l&&s!==document.body||l&&(e.contains(s)||e===s));return(d&&(Math.abs(u)<1||!a)||!d&&(Math.abs(h)<1||!a))&&(c=!0),c},us=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Am=function(t){return[t.deltaX,t.deltaY]},Mm=function(t){return t&&"current"in t?t.current:t},FS=function(t,e){return t[0]===e[0]&&t[1]===e[1]},NS=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},PS=0,ua=[];function OS(t){var e=m.useRef([]),r=m.useRef([0,0]),n=m.useRef(),a=m.useState(PS++)[0],o=m.useState(Ll)[0],i=m.useRef(t);m.useEffect(function(){i.current=t},[t]),m.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(a));var g=ip([t.lockRef.current],(t.shards||[]).map(Mm),!0).filter(Boolean);return g.forEach(function(y){return y.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),g.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(a))})}}},[t.inert,t.lockRef.current,t.shards]);var s=m.useCallback(function(g,y){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!i.current.allowPinchZoom;var E=us(g),k=r.current,R="deltaX"in g?g.deltaX:k[0]-E[0],O="deltaY"in g?g.deltaY:k[1]-E[1],b,U=g.target,H=Math.abs(R)>Math.abs(O)?"h":"v";if("touches"in g&&H==="h"&&U.type==="range")return!1;var $=xm(H,U);if(!$)return!0;if($?b=H:(b=H==="v"?"h":"v",$=xm(H,U)),!$)return!1;if(!n.current&&"changedTouches"in g&&(R||O)&&(n.current=b),!b)return!0;var G=n.current||b;return RS(G,y,g,G==="h"?R:O,!0)},[]),l=m.useCallback(function(g){var y=g;if(!(!ua.length||ua[ua.length-1]!==o)){var E="deltaY"in y?Am(y):us(y),k=e.current.filter(function(b){return b.name===y.type&&(b.target===y.target||y.target===b.shadowParent)&&FS(b.delta,E)})[0];if(k&&k.should){y.cancelable&&y.preventDefault();return}if(!k){var R=(i.current.shards||[]).map(Mm).filter(Boolean).filter(function(b){return b.contains(y.target)}),O=R.length>0?s(y,R[0]):!i.current.noIsolation;O&&y.cancelable&&y.preventDefault()}}},[]),c=m.useCallback(function(g,y,E,k){var R={name:g,delta:y,target:E,should:k,shadowParent:IS(E)};e.current.push(R),setTimeout(function(){e.current=e.current.filter(function(O){return O!==R})},1)},[]),d=m.useCallback(function(g){r.current=us(g),n.current=void 0},[]),u=m.useCallback(function(g){c(g.type,Am(g),g.target,s(g,t.lockRef.current))},[]),h=m.useCallback(function(g){c(g.type,us(g),g.target,s(g,t.lockRef.current))},[]);m.useEffect(function(){return ua.push(o),t.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",l,da),document.addEventListener("touchmove",l,da),document.addEventListener("touchstart",d,da),function(){ua=ua.filter(function(g){return g!==o}),document.removeEventListener("wheel",l,da),document.removeEventListener("touchmove",l,da),document.removeEventListener("touchstart",d,da)}},[]);var p=t.removeScrollBar,f=t.inert;return m.createElement(m.Fragment,null,f?m.createElement(o,{styles:NS(a)}):null,p?m.createElement(Em,{gapMode:t.gapMode}):null)}function IS(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const CS=sp(pm,OS);Pi=m.forwardRef(function(t,e){return m.createElement(ss,$t({},t,{ref:e,sideCar:CS}))}),Pi.classNames=ss.classNames;let Rm,Rn,bo,Eo,hs,Xc,Fm,Nm,ps,Qc,Pm,Pt,ed;Rm=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Rn=new WeakMap,bo=new WeakMap,Eo={},hs=0,Xc=function(t){return t&&(t.host||Xc(t.parentNode))},Fm=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=Xc(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},Nm=function(t,e,r,n){var a=Fm(e,Array.isArray(t)?t:[t]);Eo[r]||(Eo[r]=new WeakMap);var o=Eo[r],i=[],s=new Set,l=new Set(a),c=function(u){!u||s.has(u)||(s.add(u),c(u.parentNode))};a.forEach(c);var d=function(u){!u||l.has(u)||Array.prototype.forEach.call(u.children,function(h){if(s.has(h))d(h);else try{var p=h.getAttribute(n),f=p!==null&&p!=="false",g=(Rn.get(h)||0)+1,y=(o.get(h)||0)+1;Rn.set(h,g),o.set(h,y),i.push(h),g===1&&f&&bo.set(h,!0),y===1&&h.setAttribute(r,"true"),f||h.setAttribute(n,"true")}catch(E){console.error("aria-hidden: cannot operate on ",h,E)}})};return d(e),s.clear(),hs++,function(){i.forEach(function(u){var h=Rn.get(u)-1,p=o.get(u)-1;Rn.set(u,h),o.set(u,p),h||(bo.has(u)||u.removeAttribute(n),bo.delete(u)),p||u.removeAttribute(r)}),hs--,hs||(Rn=new WeakMap,Rn=new WeakMap,bo=new WeakMap,Eo={})}},Dl=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),a=Rm(t);return a?(n.push.apply(n,Array.from(a.querySelectorAll("[aria-live]"))),Nm(n,a,r,"aria-hidden")):function(){return null}},ps="Dialog",[Qc,qb]=ki(ps),[Pm,Pt]=Qc(ps),ed=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:a,onOpenChange:o,modal:i=!0}=t,s=m.useRef(null),l=m.useRef(null),[c=!1,d]=Ya({prop:n,defaultProp:a,onChange:o});return v.jsx(Pm,{scope:e,triggerRef:s,contentRef:l,contentId:Ut(),titleId:Ut(),descriptionId:Ut(),open:c,onOpenChange:d,onOpenToggle:m.useCallback(()=>d(u=>!u),[d]),modal:i,children:r})},ed.displayName=ps;var Om="DialogTrigger",Im=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(Om,r),o=mt(e,a.triggerRef);return v.jsx(Ze.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":nd(a.open),...n,ref:o,onClick:_e(t.onClick,a.onOpenToggle)})});Im.displayName=Om;var td="DialogPortal",[jS,Cm]=Qc(td,{forceMount:void 0}),jm=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:a}=t,o=Pt(td,e);return v.jsx(jS,{scope:e,forceMount:r,children:m.Children.map(n,i=>v.jsx(Tr,{present:r||o.open,children:v.jsx(Bh,{asChild:!0,container:a,children:i})}))})};jm.displayName=td;var fs="DialogOverlay",Lm=m.forwardRef((t,e)=>{const r=Cm(fs,t.__scopeDialog),{forceMount:n=r.forceMount,...a}=t,o=Pt(fs,t.__scopeDialog);return o.modal?v.jsx(Tr,{present:n||o.open,children:v.jsx(LS,{...a,ref:e})}):null});Lm.displayName=fs;var LS=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(fs,r);return v.jsx(Pi,{as:yn,allowPinchZoom:!0,shards:[a.contentRef],children:v.jsx(Ze.div,{"data-state":nd(a.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),Fn="DialogContent",Dm=m.forwardRef((t,e)=>{const r=Cm(Fn,t.__scopeDialog),{forceMount:n=r.forceMount,...a}=t,o=Pt(Fn,t.__scopeDialog);return v.jsx(Tr,{present:n||o.open,children:o.modal?v.jsx(DS,{...a,ref:e}):v.jsx($S,{...a,ref:e})})});Dm.displayName=Fn;var DS=m.forwardRef((t,e)=>{const r=Pt(Fn,t.__scopeDialog),n=m.useRef(null),a=mt(e,r.contentRef,n);return m.useEffect(()=>{const o=n.current;if(o)return Dl(o)},[]),v.jsx($m,{...t,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_e(t.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:_e(t.onPointerDownOutside,o=>{const i=o.detail.originalEvent,s=i.button===0&&i.ctrlKey===!0;(i.button===2||s)&&o.preventDefault()}),onFocusOutside:_e(t.onFocusOutside,o=>o.preventDefault())})}),$S=m.forwardRef((t,e)=>{const r=Pt(Fn,t.__scopeDialog),n=m.useRef(!1),a=m.useRef(!1);return v.jsx($m,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,s;(i=t.onCloseAutoFocus)==null||i.call(t,o),o.defaultPrevented||(n.current||((s=r.triggerRef.current)==null||s.focus()),o.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:o=>{var s,l;(s=t.onInteractOutside)==null||s.call(t,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=o.target;(l=r.triggerRef.current)!=null&&l.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),$m=m.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:o,...i}=t,s=Pt(Fn,r),l=m.useRef(null),c=mt(e,l);return $l(),v.jsxs(v.Fragment,{children:[v.jsx(Oi,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:o,children:v.jsx(zh,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":nd(s.open),...i,ref:c,onDismiss:()=>s.onOpenChange(!1)})}),v.jsxs(v.Fragment,{children:[v.jsx(Gm,{titleId:s.titleId}),v.jsx(qm,{contentRef:l,descriptionId:s.descriptionId})]})]})}),rd="DialogTitle",Um=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(rd,r);return v.jsx(Ze.h2,{id:a.titleId,...n,ref:e})});Um.displayName=rd;var zm="DialogDescription",Bm=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(zm,r);return v.jsx(Ze.p,{id:a.descriptionId,...n,ref:e})});Bm.displayName=zm;var Hm="DialogClose",Wm=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(Hm,r);return v.jsx(Ze.button,{type:"button",...n,ref:e,onClick:_e(t.onClick,()=>a.onOpenChange(!1))})});Wm.displayName=Hm;function nd(t){return t?"open":"closed"}let ad,od,Gm,Vm,qm;ad="DialogTitleWarning",[Fb,od]=HN(ad,{contentName:Fn,titleName:rd,docsSlug:"dialog"}),Gm=({titleId:t})=>{const e=od(ad),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return m.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},Vm="DialogDescriptionWarning",qm=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${od(Vm).contentName}}.`;return m.useEffect(()=>{var a;const n=(a=t.current)==null?void 0:a.getAttribute("aria-describedby");e&&n&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},Cl=ed,Rb=Im,Il=jm,oo=Lm,to=Dm,io=Um,ro=Bm,fc=Wm;const US=Cl,zS=Il,Zm=m.forwardRef(({className:t,...e},r)=>v.jsx(oo,{className:fe("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:r}));Zm.displayName=oo.displayName;const BS=Rl("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Jm=m.forwardRef(({side:t="right",className:e,children:r,...n},a)=>v.jsxs(zS,{children:[v.jsx(Zm,{}),v.jsxs(to,{ref:a,className:fe(BS({side:t}),e),...n,children:[r,v.jsxs(fc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[v.jsx(Ye,{name:"x",className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Jm.displayName=to.displayName;const HS=m.forwardRef(({className:t,...e},r)=>v.jsx(io,{ref:r,className:fe("text-lg font-semibold text-foreground",t),...e}));HS.displayName=io.displayName;const WS=m.forwardRef(({className:t,...e},r)=>v.jsx(ro,{ref:r,className:fe("text-sm text-muted-foreground",t),...e}));WS.displayName=ro.displayName;function Km({className:t,...e}){return v.jsx("div",{className:fe("animate-pulse rounded-md bg-muted",t),...e})}const GS=["top","right","bottom","left"],fr=Math.min,xt=Math.max,ms=Math.round,gs=Math.floor,Kr=t=>({x:t,y:t}),VS={left:"right",right:"left",bottom:"top",top:"bottom"},qS={start:"end",end:"start"};function id(t,e,r){return xt(t,fr(e,r))}function Fr(t,e){return typeof t=="function"?t(e):t}function Nr(t){return t.split("-")[0]}function ha(t){return t.split("-")[1]}function sd(t){return t==="x"?"y":"x"}function ld(t){return t==="y"?"height":"width"}function Yr(t){return["top","bottom"].includes(Nr(t))?"y":"x"}function cd(t){return sd(Yr(t))}function ZS(t,e,r){r===void 0&&(r=!1);const n=ha(t),a=cd(t),o=ld(a);let i=a==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(i=ys(i)),[i,ys(i)]}function JS(t){const e=ys(t);return[dd(t),e,dd(e)]}function dd(t){return t.replace(/start|end/g,e=>qS[e])}function KS(t,e,r){const n=["left","right"],a=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return r?e?a:n:e?n:a;case"left":case"right":return e?o:i;default:return[]}}function YS(t,e,r,n){const a=ha(t);let o=KS(Nr(t),r==="start",n);return a&&(o=o.map(i=>i+"-"+a),e&&(o=o.concat(o.map(dd)))),o}function ys(t){return t.replace(/left|right|bottom|top/g,e=>VS[e])}function XS(t){return{top:0,right:0,bottom:0,left:0,...t}}function Ym(t){return typeof t!="number"?XS(t):{top:t,right:t,bottom:t,left:t}}function vs(t){const{x:e,y:r,width:n,height:a}=t;return{width:n,height:a,top:r,left:e,right:e+n,bottom:r+a,x:e,y:r}}function Xm(t,e,r){let{reference:n,floating:a}=t;const o=Yr(e),i=cd(e),s=ld(i),l=Nr(e),c=o==="y",d=n.x+n.width/2-a.width/2,u=n.y+n.height/2-a.height/2,h=n[s]/2-a[s]/2;let p;switch(l){case"top":p={x:d,y:n.y-a.height};break;case"bottom":p={x:d,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:u};break;case"left":p={x:n.x-a.width,y:u};break;default:p={x:n.x,y:n.y}}switch(ha(e)){case"start":p[i]-=h*(r&&c?-1:1);break;case"end":p[i]+=h*(r&&c?-1:1);break}return p}const QS=async(t,e,r)=>{const{placement:n="bottom",strategy:a="absolute",middleware:o=[],platform:i}=r,s=o.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:a}),{x:d,y:u}=Xm(c,n,l),h=n,p={},f=0;for(let g=0;g<s.length;g++){const{name:y,fn:E}=s[g],{x:k,y:R,data:O,reset:b}=await E({x:d,y:u,initialPlacement:n,placement:h,strategy:a,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});d=k??d,u=R??u,p={...p,[y]:{...p[y],...O}},b&&f<=50&&(f++,typeof b=="object"&&(b.placement&&(h=b.placement),b.rects&&(c=b.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:a}):b.rects),{x:d,y:u}=Xm(c,h,l)),g=-1)}return{x:d,y:u,placement:h,strategy:a,middlewareData:p}};async function So(t,e){var r;e===void 0&&(e={});const{x:n,y:a,platform:o,rects:i,elements:s,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=Fr(e,t),f=Ym(p),g=s[h?u==="floating"?"reference":"floating":u],y=vs(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(g)))==null||r?g:g.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(s.floating)),boundary:c,rootBoundary:d,strategy:l})),E=u==="floating"?{x:n,y:a,width:i.floating.width,height:i.floating.height}:i.reference,k=await(o.getOffsetParent==null?void 0:o.getOffsetParent(s.floating)),R=await(o.isElement==null?void 0:o.isElement(k))?await(o.getScale==null?void 0:o.getScale(k))||{x:1,y:1}:{x:1,y:1},O=vs(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:E,offsetParent:k,strategy:l}):E);return{top:(y.top-O.top+f.top)/R.y,bottom:(O.bottom-y.bottom+f.bottom)/R.y,left:(y.left-O.left+f.left)/R.x,right:(O.right-y.right+f.right)/R.x}}const ex=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:a,rects:o,platform:i,elements:s,middlewareData:l}=e,{element:c,padding:d=0}=Fr(t,e)||{};if(c==null)return{};const u=Ym(d),h={x:r,y:n},p=cd(a),f=ld(p),g=await i.getDimensions(c),y=p==="y",E=y?"top":"left",k=y?"bottom":"right",R=y?"clientHeight":"clientWidth",O=o.reference[f]+o.reference[p]-h[p]-o.floating[f],b=h[p]-o.reference[p],U=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let H=U?U[R]:0;(!H||!await(i.isElement==null?void 0:i.isElement(U)))&&(H=s.floating[R]||o.floating[f]);const $=O/2-b/2,G=H/2-g[f]/2-1,ne=fr(u[E],G),he=fr(u[k],G),S=ne,M=H-g[f]-he,x=H/2-g[f]/2+$,_=id(S,x,M),B=!l.arrow&&ha(a)!=null&&x!==_&&o.reference[f]/2-(x<S?ne:he)-g[f]/2<0,N=B?x<S?x-S:x-M:0;return{[p]:h[p]+N,data:{[p]:_,centerOffset:x-_-N,...B&&{alignmentOffset:N}},reset:B}}}),tx=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:a,middlewareData:o,rects:i,initialPlacement:s,platform:l,elements:c}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:g=!0,...y}=Fr(t,e);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const E=Nr(a),k=Yr(s),R=Nr(s)===s,O=await(l.isRTL==null?void 0:l.isRTL(c.floating)),b=h||(R||!g?[ys(s)]:JS(s)),U=f!=="none";!h&&U&&b.push(...YS(s,g,f,O));const H=[s,...b],$=await So(e,y),G=[];let ne=((n=o.flip)==null?void 0:n.overflows)||[];if(d&&G.push($[E]),u){const x=ZS(a,i,O);G.push($[x[0]],$[x[1]])}if(ne=[...ne,{placement:a,overflows:G}],!G.every(x=>x<=0)){var he,S;const x=(((he=o.flip)==null?void 0:he.index)||0)+1,_=H[x];if(_)return{data:{index:x,overflows:ne},reset:{placement:_}};let B=(S=ne.filter(N=>N.overflows[0]<=0).sort((N,C)=>N.overflows[1]-C.overflows[1])[0])==null?void 0:S.placement;if(!B)switch(p){case"bestFit":{var M;const N=(M=ne.filter(C=>{if(U){const I=Yr(C.placement);return I===k||I==="y"}return!0}).map(C=>[C.placement,C.overflows.filter(I=>I>0).reduce((I,Y)=>I+Y,0)]).sort((C,I)=>C[1]-I[1])[0])==null?void 0:M[0];N&&(B=N);break}case"initialPlacement":B=s;break}if(a!==B)return{reset:{placement:B}}}return{}}}};function Qm(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function eg(t){return GS.some(e=>t[e]>=0)}const rx=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...a}=Fr(t,e);switch(n){case"referenceHidden":{const o=await So(e,{...a,elementContext:"reference"}),i=Qm(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:eg(i)}}}case"escaped":{const o=await So(e,{...a,altBoundary:!0}),i=Qm(o,r.floating);return{data:{escapedOffsets:i,escaped:eg(i)}}}default:return{}}}}};async function nx(t,e){const{placement:r,platform:n,elements:a}=t,o=await(n.isRTL==null?void 0:n.isRTL(a.floating)),i=Nr(r),s=ha(r),l=Yr(r)==="y",c=["left","top"].includes(i)?-1:1,d=o&&l?-1:1,u=Fr(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:f}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return s&&typeof f=="number"&&(p=s==="end"?f*-1:f),l?{x:p*d,y:h*c}:{x:h*c,y:p*d}}const ax=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:a,y:o,placement:i,middlewareData:s}=e,l=await nx(e,t);return i===((r=s.offset)==null?void 0:r.placement)&&(n=s.arrow)!=null&&n.alignmentOffset?{}:{x:a+l.x,y:o+l.y,data:{...l,placement:i}}}}},ox=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:a}=e,{mainAxis:o=!0,crossAxis:i=!1,limiter:s={fn:y=>{let{x:E,y:k}=y;return{x:E,y:k}}},...l}=Fr(t,e),c={x:r,y:n},d=await So(e,l),u=Yr(Nr(a)),h=sd(u);let p=c[h],f=c[u];if(o){const y=h==="y"?"top":"left",E=h==="y"?"bottom":"right",k=p+d[y],R=p-d[E];p=id(k,p,R)}if(i){const y=u==="y"?"top":"left",E=u==="y"?"bottom":"right",k=f+d[y],R=f-d[E];f=id(k,f,R)}const g=s.fn({...e,[h]:p,[u]:f});return{...g,data:{x:g.x-r,y:g.y-n}}}}},ix=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:a,rects:o,middlewareData:i}=e,{offset:s=0,mainAxis:l=!0,crossAxis:c=!0}=Fr(t,e),d={x:r,y:n},u=Yr(a),h=sd(u);let p=d[h],f=d[u];const g=Fr(s,e),y=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const R=h==="y"?"height":"width",O=o.reference[h]-o.floating[R]+y.mainAxis,b=o.reference[h]+o.reference[R]-y.mainAxis;p<O?p=O:p>b&&(p=b)}if(c){var E,k;const R=h==="y"?"width":"height",O=["top","left"].includes(Nr(a)),b=o.reference[u]-o.floating[R]+(O&&((E=i.offset)==null?void 0:E[u])||0)+(O?0:y.crossAxis),U=o.reference[u]+o.reference[R]+(O?0:((k=i.offset)==null?void 0:k[u])||0)-(O?y.crossAxis:0);f<b?f=b:f>U&&(f=U)}return{[h]:p,[u]:f}}}},sx=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){const{placement:r,rects:n,platform:a,elements:o}=e,{apply:i=()=>{},...s}=Fr(t,e),l=await So(e,s),c=Nr(r),d=ha(r),u=Yr(r)==="y",{width:h,height:p}=n.floating;let f,g;c==="top"||c==="bottom"?(f=c,g=d===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(g=c,f=d==="end"?"top":"bottom");const y=p-l.top-l.bottom,E=h-l.left-l.right,k=fr(p-l[f],y),R=fr(h-l[g],E),O=!e.middlewareData.shift;let b=k,U=R;if(u?U=d||O?fr(R,E):E:b=d||O?fr(k,y):y,O&&!d){const $=xt(l.left,0),G=xt(l.right,0),ne=xt(l.top,0),he=xt(l.bottom,0);u?U=h-2*($!==0||G!==0?$+G:xt(l.left,l.right)):b=p-2*(ne!==0||he!==0?ne+he:xt(l.top,l.bottom))}await i({...e,availableWidth:U,availableHeight:b});const H=await a.getDimensions(o.floating);return h!==H.width||p!==H.height?{reset:{rects:!0}}:{}}}};function pa(t){return tg(t)?(t.nodeName||"").toLowerCase():"#document"}function kt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Pr(t){var e;return(e=(tg(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function tg(t){return t instanceof Node||t instanceof kt(t).Node}function qt(t){return t instanceof Element||t instanceof kt(t).Element}function mr(t){return t instanceof HTMLElement||t instanceof kt(t).HTMLElement}function rg(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof kt(t).ShadowRoot}function xo(t){const{overflow:e,overflowX:r,overflowY:n,display:a}=Zt(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(a)}function lx(t){return["table","td","th"].includes(pa(t))}function _s(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function ud(t){const e=hd(),r=qt(t)?Zt(t):t;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function cx(t){let e=Xr(t);for(;mr(e)&&!fa(e);){if(ud(e))return e;if(_s(e))return null;e=Xr(e)}return null}function hd(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function fa(t){return["html","body","#document"].includes(pa(t))}function Zt(t){return kt(t).getComputedStyle(t)}function ws(t){return qt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Xr(t){if(pa(t)==="html")return t;const e=t.assignedSlot||t.parentNode||rg(t)&&t.host||Pr(t);return rg(e)?e.host:e}function ng(t){const e=Xr(t);return fa(e)?t.ownerDocument?t.ownerDocument.body:t.body:mr(e)&&xo(e)?e:ng(e)}function ko(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const a=ng(t),o=a===((n=t.ownerDocument)==null?void 0:n.body),i=kt(a);if(o){const s=pd(i);return e.concat(i,i.visualViewport||[],xo(a)?a:[],s&&r?ko(s):[])}return e.concat(a,ko(a,[],r))}function pd(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function ag(t){const e=Zt(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const a=mr(t),o=a?t.offsetWidth:r,i=a?t.offsetHeight:n,s=ms(r)!==o||ms(n)!==i;return s&&(r=o,n=i),{width:r,height:n,$:s}}function fd(t){return qt(t)?t:t.contextElement}function ma(t){const e=fd(t);if(!mr(e))return Kr(1);const r=e.getBoundingClientRect(),{width:n,height:a,$:o}=ag(e);let i=(o?ms(r.width):r.width)/n,s=(o?ms(r.height):r.height)/a;return(!i||!Number.isFinite(i))&&(i=1),(!s||!Number.isFinite(s))&&(s=1),{x:i,y:s}}const dx=Kr(0);function og(t){const e=kt(t);return!hd()||!e.visualViewport?dx:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function ux(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==kt(t)?!1:e}function Nn(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const a=t.getBoundingClientRect(),o=fd(t);let i=Kr(1);e&&(n?qt(n)&&(i=ma(n)):i=ma(t));const s=ux(o,r,n)?og(o):Kr(0);let l=(a.left+s.x)/i.x,c=(a.top+s.y)/i.y,d=a.width/i.x,u=a.height/i.y;if(o){const h=kt(o),p=n&&qt(n)?kt(n):n;let f=h,g=pd(f);for(;g&&n&&p!==f;){const y=ma(g),E=g.getBoundingClientRect(),k=Zt(g),R=E.left+(g.clientLeft+parseFloat(k.paddingLeft))*y.x,O=E.top+(g.clientTop+parseFloat(k.paddingTop))*y.y;l*=y.x,c*=y.y,d*=y.x,u*=y.y,l+=R,c+=O,f=kt(g),g=pd(f)}}return vs({width:d,height:u,x:l,y:c})}function hx(t){let{elements:e,rect:r,offsetParent:n,strategy:a}=t;const o=a==="fixed",i=Pr(n),s=e?_s(e.floating):!1;if(n===i||s&&o)return r;let l={scrollLeft:0,scrollTop:0},c=Kr(1);const d=Kr(0),u=mr(n);if((u||!u&&!o)&&((pa(n)!=="body"||xo(i))&&(l=ws(n)),mr(n))){const h=Nn(n);c=ma(n),d.x=h.x+n.clientLeft,d.y=h.y+n.clientTop}return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+d.x,y:r.y*c.y-l.scrollTop*c.y+d.y}}function px(t){return Array.from(t.getClientRects())}function ig(t){return Nn(Pr(t)).left+ws(t).scrollLeft}function fx(t){const e=Pr(t),r=ws(t),n=t.ownerDocument.body,a=xt(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),o=xt(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+ig(t);const s=-r.scrollTop;return Zt(n).direction==="rtl"&&(i+=xt(e.clientWidth,n.clientWidth)-a),{width:a,height:o,x:i,y:s}}function mx(t,e){const r=kt(t),n=Pr(t),a=r.visualViewport;let o=n.clientWidth,i=n.clientHeight,s=0,l=0;if(a){o=a.width,i=a.height;const c=hd();(!c||c&&e==="fixed")&&(s=a.offsetLeft,l=a.offsetTop)}return{width:o,height:i,x:s,y:l}}function gx(t,e){const r=Nn(t,!0,e==="fixed"),n=r.top+t.clientTop,a=r.left+t.clientLeft,o=mr(t)?ma(t):Kr(1),i=t.clientWidth*o.x,s=t.clientHeight*o.y,l=a*o.x,c=n*o.y;return{width:i,height:s,x:l,y:c}}function sg(t,e,r){let n;if(e==="viewport")n=mx(t,r);else if(e==="document")n=fx(Pr(t));else if(qt(e))n=gx(e,r);else{const a=og(t);n={...e,x:e.x-a.x,y:e.y-a.y}}return vs(n)}function lg(t,e){const r=Xr(t);return r===e||!qt(r)||fa(r)?!1:Zt(r).position==="fixed"||lg(r,e)}function yx(t,e){const r=e.get(t);if(r)return r;let n=ko(t,[],!1).filter(s=>qt(s)&&pa(s)!=="body"),a=null;const o=Zt(t).position==="fixed";let i=o?Xr(t):t;for(;qt(i)&&!fa(i);){const s=Zt(i),l=ud(i);!l&&s.position==="fixed"&&(a=null),(o?!l&&!a:!l&&s.position==="static"&&a&&["absolute","fixed"].includes(a.position)||xo(i)&&!l&&lg(t,i))?n=n.filter(c=>c!==i):a=s,i=Xr(i)}return e.set(t,n),n}function vx(t){let{element:e,boundary:r,rootBoundary:n,strategy:a}=t;const o=[...r==="clippingAncestors"?_s(e)?[]:yx(e,this._c):[].concat(r),n],i=o[0],s=o.reduce((l,c)=>{const d=sg(e,c,a);return l.top=xt(d.top,l.top),l.right=fr(d.right,l.right),l.bottom=fr(d.bottom,l.bottom),l.left=xt(d.left,l.left),l},sg(e,i,a));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function _x(t){const{width:e,height:r}=ag(t);return{width:e,height:r}}function wx(t,e,r){const n=mr(e),a=Pr(e),o=r==="fixed",i=Nn(t,!0,o,e);let s={scrollLeft:0,scrollTop:0};const l=Kr(0);if(n||!n&&!o)if((pa(e)!=="body"||xo(a))&&(s=ws(e)),n){const u=Nn(e,!0,o,e);l.x=u.x+e.clientLeft,l.y=u.y+e.clientTop}else a&&(l.x=ig(a));const c=i.left+s.scrollLeft-l.x,d=i.top+s.scrollTop-l.y;return{x:c,y:d,width:i.width,height:i.height}}function md(t){return Zt(t).position==="static"}function cg(t,e){return!mr(t)||Zt(t).position==="fixed"?null:e?e(t):t.offsetParent}function dg(t,e){const r=kt(t);if(_s(t))return r;if(!mr(t)){let a=Xr(t);for(;a&&!fa(a);){if(qt(a)&&!md(a))return a;a=Xr(a)}return r}let n=cg(t,e);for(;n&&lx(n)&&md(n);)n=cg(n,e);return n&&fa(n)&&md(n)&&!ud(n)?r:n||cx(t)||r}const bx=async function(t){const e=this.getOffsetParent||dg,r=this.getDimensions,n=await r(t.floating);return{reference:wx(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function Ex(t){return Zt(t).direction==="rtl"}const Sx={convertOffsetParentRelativeRectToViewportRelativeRect:hx,getDocumentElement:Pr,getClippingRect:vx,getOffsetParent:dg,getElementRects:bx,getClientRects:px,getDimensions:_x,getScale:ma,isElement:qt,isRTL:Ex};function xx(t,e){let r=null,n;const a=Pr(t);function o(){var s;clearTimeout(n),(s=r)==null||s.disconnect(),r=null}function i(s,l){s===void 0&&(s=!1),l===void 0&&(l=1),o();const{left:c,top:d,width:u,height:h}=t.getBoundingClientRect();if(s||e(),!u||!h)return;const p=gs(d),f=gs(a.clientWidth-(c+u)),g=gs(a.clientHeight-(d+h)),y=gs(c),E={rootMargin:-p+"px "+-f+"px "+-g+"px "+-y+"px",threshold:xt(0,fr(1,l))||1};let k=!0;function R(O){const b=O[0].intersectionRatio;if(b!==l){if(!k)return i();b?i(!1,b):n=setTimeout(()=>{i(!1,1e-7)},1e3)}k=!1}try{r=new IntersectionObserver(R,{...E,root:a.ownerDocument})}catch{r=new IntersectionObserver(R,E)}r.observe(t)}return i(!0),o}Kh=function(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=fd(t),d=a||o?[...c?ko(c):[],...ko(e)]:[];d.forEach(E=>{a&&E.addEventListener("scroll",r,{passive:!0}),o&&E.addEventListener("resize",r)});const u=c&&s?xx(c,r):null;let h=-1,p=null;i&&(p=new ResizeObserver(E=>{let[k]=E;k&&k.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var R;(R=p)==null||R.observe(e)})),r()}),c&&!l&&p.observe(c),p.observe(e));let f,g=l?Nn(t):null;l&&y();function y(){const E=Nn(t);g&&(E.x!==g.x||E.y!==g.y||E.width!==g.width||E.height!==g.height)&&r(),g=E,f=requestAnimationFrame(y)}return r(),()=>{var E;d.forEach(k=>{a&&k.removeEventListener("scroll",r),o&&k.removeEventListener("resize",r)}),u==null||u(),(E=p)==null||E.disconnect(),p=null,l&&cancelAnimationFrame(f)}};let ug;Lp=ax,Up=ox,Dp=tx,Bp=sx,ug=rx,rc=ex,zp=ix,$p=(t,e,r)=>{const n=new Map,a={platform:Sx,...r},o={...a.platform,_c:n};return QS(t,e,{...a,platform:o})};var bs=typeof document<"u"?m.useLayoutEffect:m.useEffect;function Es(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,a;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!Es(t[n],e[n]))return!1;return!0}if(a=Object.keys(t),r=a.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,a[n]))return!1;for(n=r;n--!==0;){const o=a[n];if(!(o==="_owner"&&t.$$typeof)&&!Es(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function hg(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function pg(t,e){const r=hg(t);return Math.round(e*r)/r}function fg(t){const e=m.useRef(t);return bs(()=>{e.current=t}),e}Jh=function(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:a,elements:{reference:o,floating:i}={},transform:s=!0,whileElementsMounted:l,open:c}=t,[d,u]=m.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=m.useState(n);Es(h,n)||p(n);const[f,g]=m.useState(null),[y,E]=m.useState(null),k=m.useCallback(N=>{N!==U.current&&(U.current=N,g(N))},[]),R=m.useCallback(N=>{N!==H.current&&(H.current=N,E(N))},[]),O=o||f,b=i||y,U=m.useRef(null),H=m.useRef(null),$=m.useRef(d),G=l!=null,ne=fg(l),he=fg(a),S=m.useCallback(()=>{if(!U.current||!H.current)return;const N={placement:e,strategy:r,middleware:h};he.current&&(N.platform=he.current),$p(U.current,H.current,N).then(C=>{const I={...C,isPositioned:!0};M.current&&!Es($.current,I)&&($.current=I,Sb.flushSync(()=>{u(I)}))})},[h,e,r,he]);bs(()=>{c===!1&&$.current.isPositioned&&($.current.isPositioned=!1,u(N=>({...N,isPositioned:!1})))},[c]);const M=m.useRef(!1);bs(()=>(M.current=!0,()=>{M.current=!1}),[]),bs(()=>{if(O&&(U.current=O),b&&(H.current=b),O&&b){if(ne.current)return ne.current(O,b,S);S()}},[O,b,S,ne,G]);const x=m.useMemo(()=>({reference:U,floating:H,setReference:k,setFloating:R}),[k,R]),_=m.useMemo(()=>({reference:O,floating:b}),[O,b]),B=m.useMemo(()=>{const N={position:r,left:0,top:0};if(!_.floating)return N;const C=pg(_.floating,d.x),I=pg(_.floating,d.y);return s?{...N,transform:"translate("+C+"px, "+I+"px)",...hg(_.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:C,top:I}},[r,s,_.floating,d.x,d.y]);return m.useMemo(()=>({...d,update:S,refs:x,elements:_,floatingStyles:B}),[d,S,x,_,B])};let mg;mg=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:a}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?rc({element:n.current,padding:a}).fn(r):{}:n?rc({element:n,padding:a}).fn(r):{}}}},Yh=(t,e)=>({...Lp(t),options:[t,e]}),Xh=(t,e)=>({...Up(t),options:[t,e]}),np=(t,e)=>({...zp(t),options:[t,e]}),Qh=(t,e)=>({...Dp(t),options:[t,e]}),ep=(t,e)=>({...Bp(t),options:[t,e]}),Vh=(t,e)=>({...ug(t),options:[t,e]}),tp=(t,e)=>({...mg(t),options:[t,e]});var kx="Arrow",gg=m.forwardRef((t,e)=>{const{children:r,width:n=10,height:a=5,...o}=t;return v.jsx(Ze.svg,{...o,ref:e,width:n,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:v.jsx("polygon",{points:"0,0 30,0 15,10"})})});gg.displayName=kx;var Tx=gg;function Ax(t,e=[]){let r=[];function n(o,i){const s=m.createContext(i),l=r.length;r=[...r,i];function c(u){const{scope:h,children:p,...f}=u,g=(h==null?void 0:h[t][l])||s,y=m.useMemo(()=>f,Object.values(f));return v.jsx(g.Provider,{value:y,children:p})}function d(u,h){const p=(h==null?void 0:h[t][l])||s,f=m.useContext(p);if(f)return f;if(i!==void 0)return i;throw new Error(`\`${u}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,d]}const a=()=>{const o=r.map(i=>m.createContext(i));return function(i){const s=(i==null?void 0:i[t])||o;return m.useMemo(()=>({[`__scope${t}`]:{...i,[t]:s}}),[i,s])}};return a.scopeName=t,[n,Mx(a,...e)]}function Mx(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=n.reduce((i,{useScope:s,scopeName:l})=>{const c=s(a)[`__scope${l}`];return{...i,...c}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}sf=function(t){const[e,r]=m.useState(void 0);return xi(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const o=a[0];let i,s;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,s=c.blockSize}else i=t.offsetWidth,s=t.offsetHeight;r({width:i,height:s})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e};let Ss,gd,yg,yd,vd;Ss="Popper",[gd,lo]=Ax(Ss),[yg,yd]=gd(Ss),vd=t=>{const{__scopePopper:e,children:r}=t,[n,a]=m.useState(null);return v.jsx(yg,{scope:e,anchor:n,onAnchorChange:a,children:r})},vd.displayName=Ss;var vg="PopperAnchor",_g=m.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...a}=t,o=yd(vg,r),i=m.useRef(null),s=mt(e,i);return m.useEffect(()=>{o.onAnchorChange((n==null?void 0:n.current)||i.current)}),n?null:v.jsx(Ze.div,{...a,ref:s})});_g.displayName=vg;var _d="PopperContent",[Rx,Fx]=gd(_d),wg=m.forwardRef((t,e)=>{var Br,Hr,Ce,_t,qn,Ba;const{__scopePopper:r,side:n="bottom",sideOffset:a=0,align:o="center",alignOffset:i=0,arrowPadding:s=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:d=0,sticky:u="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:f,...g}=t,y=yd(_d,r),[E,k]=m.useState(null),R=mt(e,ft=>k(ft)),[O,b]=m.useState(null),U=sf(O),H=(U==null?void 0:U.width)??0,$=(U==null?void 0:U.height)??0,G=n+(o!=="center"?"-"+o:""),ne=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},he=Array.isArray(c)?c:[c],S=he.length>0,M={padding:ne,boundary:he.filter(Px),altBoundary:S},{refs:x,floatingStyles:_,placement:B,isPositioned:N,middlewareData:C}=Jh({strategy:"fixed",placement:G,whileElementsMounted:(...ft)=>Kh(...ft,{animationFrame:p==="always"}),elements:{reference:y.anchor},middleware:[Yh({mainAxis:a+$,alignmentAxis:i}),l&&Xh({mainAxis:!0,crossAxis:!1,limiter:u==="partial"?np():void 0,...M}),l&&Qh({...M}),ep({...M,apply:({elements:ft,rects:fi,availableWidth:Ct,availableHeight:Ha})=>{const{width:Wa,height:pn}=fi.reference,Er=ft.floating.style;Er.setProperty("--radix-popper-available-width",`${Ct}px`),Er.setProperty("--radix-popper-available-height",`${Ha}px`),Er.setProperty("--radix-popper-anchor-width",`${Wa}px`),Er.setProperty("--radix-popper-anchor-height",`${pn}px`)}}),O&&tp({element:O,padding:s}),Ox({arrowWidth:H,arrowHeight:$}),h&&Vh({strategy:"referenceHidden",...M})]}),[I,Y]=Sg(B),ae=Xn(f);xi(()=>{N&&(ae==null||ae())},[N,ae]);const ce=(Br=C.arrow)==null?void 0:Br.x,be=(Hr=C.arrow)==null?void 0:Hr.y,Se=((Ce=C.arrow)==null?void 0:Ce.centerOffset)!==0,[We,vt]=m.useState();return xi(()=>{E&&vt(window.getComputedStyle(E).zIndex)},[E]),v.jsx("div",{ref:x.setFloating,"data-radix-popper-content-wrapper":"",style:{..._,transform:N?_.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:We,"--radix-popper-transform-origin":[(_t=C.transformOrigin)==null?void 0:_t.x,(qn=C.transformOrigin)==null?void 0:qn.y].join(" "),...((Ba=C.hide)==null?void 0:Ba.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:v.jsx(Rx,{scope:r,placedSide:I,onArrowChange:b,arrowX:ce,arrowY:be,shouldHideArrow:Se,children:v.jsx(Ze.div,{"data-side":I,"data-align":Y,...g,ref:R,style:{...g.style,animation:N?void 0:"none"}})})})});wg.displayName=_d;var bg="PopperArrow",Nx={top:"bottom",right:"left",bottom:"top",left:"right"},Eg=m.forwardRef(function(t,e){const{__scopePopper:r,...n}=t,a=Fx(bg,r),o=Nx[a.placedSide];return v.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:v.jsx(Tx,{...n,ref:e,style:{...n.style,display:"block"}})})});Eg.displayName=bg;function Px(t){return t!==null}var Ox=t=>({name:"transformOrigin",options:t,fn(e){var g,y,E;const{placement:r,rects:n,middlewareData:a}=e,o=((g=a.arrow)==null?void 0:g.centerOffset)!==0,i=o?0:t.arrowWidth,s=o?0:t.arrowHeight,[l,c]=Sg(r),d={start:"0%",center:"50%",end:"100%"}[c],u=(((y=a.arrow)==null?void 0:y.x)??0)+i/2,h=(((E=a.arrow)==null?void 0:E.y)??0)+s/2;let p="",f="";return l==="bottom"?(p=o?d:`${u}px`,f=`${-s}px`):l==="top"?(p=o?d:`${u}px`,f=`${n.floating.height+s}px`):l==="right"?(p=`${-s}px`,f=o?d:`${h}px`):l==="left"&&(p=`${n.floating.width+s}px`,f=o?d:`${h}px`),{data:{x:p,y:f}}}});function Sg(t){const[e,r="center"]=t.split("-");return[e,r]}let To,Ix,Ao,wd,xg,xs,kg,ks,bd;Ii=vd,zl=_g,Bl=wg,Hl=Eg,[To,Ix]=ki("Tooltip",[lo]),Ao=lo(),wd="TooltipProvider",xg=700,xs="tooltip.open",[kg,ks]=To(wd),bd=t=>{const{__scopeTooltip:e,delayDuration:r=xg,skipDelayDuration:n=300,disableHoverableContent:a=!1,children:o}=t,[i,s]=m.useState(!0),l=m.useRef(!1),c=m.useRef(0);return m.useEffect(()=>{const d=c.current;return()=>window.clearTimeout(d)},[]),v.jsx(kg,{scope:e,isOpenDelayed:i,delayDuration:r,onOpen:m.useCallback(()=>{window.clearTimeout(c.current),s(!1)},[]),onClose:m.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>s(!0),n)},[n]),isPointerInTransitRef:l,onPointerInTransitChange:m.useCallback(d=>{l.current=d},[]),disableHoverableContent:a,children:o})},bd.displayName=wd;var Ts="Tooltip",[Cx,Mo]=To(Ts),Tg=t=>{const{__scopeTooltip:e,children:r,open:n,defaultOpen:a=!1,onOpenChange:o,disableHoverableContent:i,delayDuration:s}=t,l=ks(Ts,t.__scopeTooltip),c=Ao(e),[d,u]=m.useState(null),h=Ut(),p=m.useRef(0),f=i??l.disableHoverableContent,g=s??l.delayDuration,y=m.useRef(!1),[E=!1,k]=Ya({prop:n,defaultProp:a,onChange:H=>{H?(l.onOpen(),document.dispatchEvent(new CustomEvent(xs))):l.onClose(),o==null||o(H)}}),R=m.useMemo(()=>E?y.current?"delayed-open":"instant-open":"closed",[E]),O=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,y.current=!1,k(!0)},[k]),b=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,k(!1)},[k]),U=m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{y.current=!0,k(!0),p.current=0},g)},[g,k]);return m.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),v.jsx(Ii,{...c,children:v.jsx(Cx,{scope:e,contentId:h,open:E,stateAttribute:R,trigger:d,onTriggerChange:u,onTriggerEnter:m.useCallback(()=>{l.isOpenDelayed?U():O()},[l.isOpenDelayed,U,O]),onTriggerLeave:m.useCallback(()=>{f?b():(window.clearTimeout(p.current),p.current=0)},[b,f]),onOpen:O,onClose:b,disableHoverableContent:f,children:r})})};Tg.displayName=Ts;var Ed="TooltipTrigger",Ag=m.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,a=Mo(Ed,r),o=ks(Ed,r),i=Ao(r),s=m.useRef(null),l=mt(e,s,a.onTriggerChange),c=m.useRef(!1),d=m.useRef(!1),u=m.useCallback(()=>c.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",u),[u]),v.jsx(zl,{asChild:!0,...i,children:v.jsx(Ze.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...n,ref:l,onPointerMove:_e(t.onPointerMove,h=>{h.pointerType!=="touch"&&!d.current&&!o.isPointerInTransitRef.current&&(a.onTriggerEnter(),d.current=!0)}),onPointerLeave:_e(t.onPointerLeave,()=>{a.onTriggerLeave(),d.current=!1}),onPointerDown:_e(t.onPointerDown,()=>{c.current=!0,document.addEventListener("pointerup",u,{once:!0})}),onFocus:_e(t.onFocus,()=>{c.current||a.onOpen()}),onBlur:_e(t.onBlur,a.onClose),onClick:_e(t.onClick,a.onClose)})})});Ag.displayName=Ed;var Sd="TooltipPortal",[jx,Lx]=To(Sd,{forceMount:void 0}),Mg=t=>{const{__scopeTooltip:e,forceMount:r,children:n,container:a}=t,o=Mo(Sd,e);return v.jsx(jx,{scope:e,forceMount:r,children:v.jsx(Tr,{present:r||o.open,children:v.jsx(Bh,{asChild:!0,container:a,children:n})})})};Mg.displayName=Sd;var ga="TooltipContent",Rg=m.forwardRef((t,e)=>{const r=Lx(ga,t.__scopeTooltip),{forceMount:n=r.forceMount,side:a="top",...o}=t,i=Mo(ga,t.__scopeTooltip);return v.jsx(Tr,{present:n||i.open,children:i.disableHoverableContent?v.jsx(Fg,{side:a,...o,ref:e}):v.jsx(Dx,{side:a,...o,ref:e})})}),Dx=m.forwardRef((t,e)=>{const r=Mo(ga,t.__scopeTooltip),n=ks(ga,t.__scopeTooltip),a=m.useRef(null),o=mt(e,a),[i,s]=m.useState(null),{trigger:l,onClose:c}=r,d=a.current,{onPointerInTransitChange:u}=n,h=m.useCallback(()=>{s(null),u(!1)},[u]),p=m.useCallback((f,g)=>{const y=f.currentTarget,E={x:f.clientX,y:f.clientY},k=Bx(E,y.getBoundingClientRect()),R=Hx(E,k),O=Wx(g.getBoundingClientRect()),b=Vx([...R,...O]);s(b),u(!0)},[u]);return m.useEffect(()=>()=>h(),[h]),m.useEffect(()=>{if(l&&d){const f=y=>p(y,d),g=y=>p(y,l);return l.addEventListener("pointerleave",f),d.addEventListener("pointerleave",g),()=>{l.removeEventListener("pointerleave",f),d.removeEventListener("pointerleave",g)}}},[l,d,p,h]),m.useEffect(()=>{if(i){const f=g=>{const y=g.target,E={x:g.clientX,y:g.clientY},k=(l==null?void 0:l.contains(y))||(d==null?void 0:d.contains(y)),R=!Gx(E,i);k?h():R&&(h(),c())};return document.addEventListener("pointermove",f),()=>document.removeEventListener("pointermove",f)}},[l,d,i,c,h]),v.jsx(Fg,{...t,ref:o})}),[$x,Ux]=To(Ts,{isInside:!1}),Fg=m.forwardRef((t,e)=>{const{__scopeTooltip:r,children:n,"aria-label":a,onEscapeKeyDown:o,onPointerDownOutside:i,...s}=t,l=Mo(ga,r),c=Ao(r),{onClose:d}=l;return m.useEffect(()=>(document.addEventListener(xs,d),()=>document.removeEventListener(xs,d)),[d]),m.useEffect(()=>{if(l.trigger){const u=h=>{var p;(p=h.target)!=null&&p.contains(l.trigger)&&d()};return window.addEventListener("scroll",u,{capture:!0}),()=>window.removeEventListener("scroll",u,{capture:!0})}},[l.trigger,d]),v.jsx(zh,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:u=>u.preventDefault(),onDismiss:d,children:v.jsxs(Bl,{"data-state":l.stateAttribute,...c,...s,ref:e,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[v.jsx(WN,{children:n}),v.jsx($x,{scope:r,isInside:!0,children:v.jsx(GN,{id:l.contentId,role:"tooltip",children:a||n})})]})})});Rg.displayName=ga;var Ng="TooltipArrow",zx=m.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,a=Ao(r);return Ux(Ng,r).isInside?null:v.jsx(Hl,{...a,...n,ref:e})});zx.displayName=Ng;function Bx(t,e){const r=Math.abs(e.top-t.y),n=Math.abs(e.bottom-t.y),a=Math.abs(e.right-t.x),o=Math.abs(e.left-t.x);switch(Math.min(r,n,a,o)){case o:return"left";case a:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function Hx(t,e,r=5){const n=[];switch(e){case"top":n.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":n.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":n.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":n.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return n}function Wx(t){const{top:e,right:r,bottom:n,left:a}=t;return[{x:a,y:e},{x:r,y:e},{x:r,y:n},{x:a,y:n}]}function Gx(t,e){const{x:r,y:n}=t;let a=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const s=e[o].x,l=e[o].y,c=e[i].x,d=e[i].y;l>n!=d>n&&r<(c-s)*(n-l)/(d-l)+s&&(a=!a)}return a}function Vx(t){const e=t.slice();return e.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),qx(e)}function qx(t){if(t.length<=1)return t.slice();const e=[];for(let n=0;n<t.length;n++){const a=t[n];for(;e.length>=2;){const o=e[e.length-1],i=e[e.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))e.pop();else break}e.push(a)}e.pop();const r=[];for(let n=t.length-1;n>=0;n--){const a=t[n];for(;r.length>=2;){const o=r[r.length-1],i=r[r.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))r.pop();else break}r.push(a)}return r.pop(),e.length===1&&r.length===1&&e[0].x===r[0].x&&e[0].y===r[0].y?e:e.concat(r)}Qp=bd,ef=Tg,tf=Ag,Jb=Mg,pc=Rg,mc=Qp,aa=ef,oa=tf,Sn=m.forwardRef(({className:t,sideOffset:e=4,...r},n)=>v.jsx(pc,{ref:n,sideOffset:e,className:fe("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})),Sn.displayName=pc.displayName;const Zx="sidebar:state",Jx=60*60*24*7,Kx="16rem",Yx="18rem",Xx="3rem",Qx="b",Pg=m.createContext(null);function Ro(){const t=m.useContext(Pg);if(!t)throw new Error("useSidebar must be used within a SidebarProvider.");return t}Pl=m.forwardRef(({defaultOpen:t=!0,open:e,onOpenChange:r,className:n,style:a,children:o,...i},s)=>{const l=nS(),[c,d]=m.useState(!1),[u,h]=m.useState(t),p=e??u,f=m.useCallback(k=>{const R=typeof k=="function"?k(p):k;r?r(R):h(R),document.cookie=`${Zx}=${R}; path=/; max-age=${Jx}`},[r,p]),g=m.useCallback(()=>l?d(k=>!k):f(k=>!k),[l,f,d]);m.useEffect(()=>{const k=R=>{R.key===Qx&&(R.metaKey||R.ctrlKey)&&(R.preventDefault(),g())};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[g]);const y=p?"expanded":"collapsed",E=m.useMemo(()=>({state:y,open:p,setOpen:f,isMobile:l,openMobile:c,setOpenMobile:d,toggleSidebar:g}),[y,p,f,l,c,d,g]);return v.jsx(Pg.Provider,{value:E,children:v.jsx(mc,{delayDuration:0,children:v.jsx("div",{style:{"--sidebar-width":Kx,"--sidebar-width-icon":Xx,...a},className:fe("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:s,...i,children:o})})})}),Pl.displayName="SidebarProvider",bc=m.forwardRef(({side:t="left",variant:e="sidebar",collapsible:r="offcanvas",className:n,children:a,...o},i)=>{const{isMobile:s,state:l,openMobile:c,setOpenMobile:d}=Ro();return r==="none"?v.jsx("div",{className:fe("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:i,...o,children:a}):s?v.jsx(US,{open:c,onOpenChange:d,...o,children:v.jsx(Jm,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":Yx},side:t,children:v.jsx("div",{className:"flex h-full w-full flex-col",children:a})})}):v.jsxs("div",{ref:i,className:"group peer hidden md:block text-sidebar-foreground","data-state":l,"data-collapsible":l==="collapsed"?r:"","data-variant":e,"data-side":t,children:[v.jsx("div",{className:fe("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",e==="floating"||e==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),v.jsx("div",{className:fe("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",t==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",e==="floating"||e==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...o,children:v.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:a})})]})}),bc.displayName="Sidebar";const Og=m.forwardRef(({className:t,onClick:e,...r},n)=>{const{toggleSidebar:a}=Ro();return v.jsx(Wr,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:fe("h-7 w-7",t),onClick:o=>{e==null||e(o),a()},...r,children:v.jsx(Ye,{size:32,name:"panel-left"})})});Og.displayName="SidebarTrigger";const Ig=m.forwardRef(({className:t,...e},r)=>{const{toggleSidebar:n}=Ro();return v.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:fe("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...e})});Ig.displayName="SidebarRail",Ol=m.forwardRef(({className:t,...e},r)=>v.jsx("main",{ref:r,className:fe("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...e})),Ol.displayName="SidebarInset";const ek=m.forwardRef(({className:t,...e},r)=>v.jsx(ji,{ref:r,"data-sidebar":"input",className:fe("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...e}));ek.displayName="SidebarInput";const tk=m.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"header",className:fe("flex flex-col gap-2 p-2",t),...e}));tk.displayName="SidebarHeader";const Cg=m.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"footer",className:fe("flex flex-col gap-2 p-2",t),...e}));Cg.displayName="SidebarFooter";const rk=m.forwardRef(({className:t,...e},r)=>v.jsx(Ni,{ref:r,"data-sidebar":"separator",className:fe("mx-2 w-auto bg-sidebar-border",t),...e}));rk.displayName="SidebarSeparator",Sc=m.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"content",className:fe("flex min-h-0 flex-1 flex-col gap-0 overflow-auto group-data-[collapsible=icon]:overflow-hidden",t),...e})),Sc.displayName="SidebarContent",zi=m.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"group",className:fe("relative flex w-full min-w-0 flex-col p-2",t),...e})),zi.displayName="SidebarGroup",Ec=m.forwardRef(({className:t,asChild:e=!1,...r},n)=>{const a=e?yn:"div";return v.jsx(a,{ref:n,"data-sidebar":"group-label",className:fe("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",t),...r})}),Ec.displayName="SidebarGroupLabel";const nk=m.forwardRef(({className:t,asChild:e=!1,...r},n)=>{const a=e?yn:"button";return v.jsx(a,{ref:n,"data-sidebar":"group-action",className:fe("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",t),...r})});nk.displayName="SidebarGroupAction";const ak=m.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"group-content",className:fe("w-full text-sm",t),...e}));ak.displayName="SidebarGroupContent",fo=m.forwardRef(({className:t,...e},r)=>v.jsx("ul",{ref:r,"data-sidebar":"menu",className:fe("flex w-full min-w-0 flex-col gap-1",t),...e})),fo.displayName="SidebarMenu",ea=m.forwardRef(({className:t,...e},r)=>v.jsx("li",{ref:r,"data-sidebar":"menu-item",className:fe("group/menu-item relative",t),...e})),ea.displayName="SidebarMenuItem";let jg;jg=Rl("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),no=m.forwardRef(({onClick:t,asChild:e=!1,isActive:r=!1,variant:n="default",size:a="default",tooltip:o,className:i,autoHide:s,...l},c)=>{const d=e?yn:"button",{isMobile:u,state:h,toggleSidebar:p}=Ro(),f=v.jsx(d,{ref:c,"data-sidebar":"menu-button","data-size":a,"data-active":r,className:fe(jg({variant:n,size:a}),i),onClick:s?g=>{t==null||t(g),p()}:t,...l});return o?(typeof o=="string"&&(o={children:o}),v.jsxs(aa,{children:[v.jsx(oa,{asChild:!0,children:f}),v.jsx(Sn,{side:"right",align:"center",hidden:h!=="collapsed"||u,...o})]})):f}),no.displayName="SidebarMenuButton";const ok=m.forwardRef(({className:t,asChild:e=!1,showOnHover:r=!1,...n},a)=>{const o=e?yn:"button";return v.jsx(o,{ref:a,"data-sidebar":"menu-action",className:fe("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",t),...n})});ok.displayName="SidebarMenuAction";const ik=m.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:fe("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...e}));ik.displayName="SidebarMenuBadge";const sk=m.forwardRef(({className:t,showIcon:e=!1,...r},n)=>{const a=m.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return v.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:fe("rounded-md h-8 flex gap-2 px-2 items-center",t),...r,children:[e&&v.jsx(Km,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),v.jsx(Km,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":a}})]})});sk.displayName="SidebarMenuSkeleton";const Lg=m.forwardRef(({className:t,...e},r)=>v.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:fe("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...e}));Lg.displayName="SidebarMenuSub";const Dg=m.forwardRef(({...t},e)=>v.jsx("li",{ref:e,...t}));Dg.displayName="SidebarMenuSubItem";const $g=m.forwardRef(({asChild:t=!1,size:e="md",isActive:r,className:n,...a},o)=>{const i=t?yn:"a";return v.jsx(i,{ref:o,"data-sidebar":"menu-sub-button","data-size":e,"data-active":r,className:fe("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",e==="sm"&&"text-xs",e==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",n),...a})});$g.displayName="SidebarMenuSubButton";let Ug,Pn,zg;Ug="hash",Pn={application:"/application/:applicationId?",whiteboard:"/whiteboard/:sessionId?",document:"/document/:documentId?",sessions:"/sessions"},at=(t,e)=>{let r=Pn[t];return e?r=Object.keys(e||{}).reduce((n,a)=>n.replace(`:${a}`,(e==null?void 0:e[a])||""),r):r=r.replace(/\/:[^/]+/g,""),r!=null&&r.endsWith("?")?r.slice(0,-1):r},zg=()=>{{const[,t]=window.location.hash.split("?");return new URLSearchParams(`?${t}`)}};function lk({items:t}){const{t:e}=Ti("documents");return v.jsxs(zi,{children:[v.jsx(Ec,{children:v.jsx("div",{className:"text-sm",children:e("title")})}),v.jsx(fo,{children:t.map(r=>{var n;return v.jsx(eS,{asChild:!0,defaultOpen:r.isActive,className:"group/collapsible",children:v.jsxs(ea,{children:[v.jsx(tS,{asChild:!0,children:v.jsxs(no,{className:"cursor-pointer",tooltip:e(r.title),children:[r.icon,v.jsx("span",{children:e(r.title)}),v.jsx(Ye,{name:"chevron-right",className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})}),v.jsx(rS,{children:v.jsx(Lg,{children:(n=r.items)==null?void 0:n.map(a=>v.jsx(Dg,{className:"cursor-pointer",children:v.jsx($g,{asChild:!0,children:v.jsx(Uc,{to:at("document",{documentId:a.id}),children:v.jsx("span",{children:e(a.title)})})})},e(a.title)))})})]})},r.title)})})]})}const ck=m.memo(({text:t,colors:e={first:"#9E7AFF",second:"#FE8BBB"},className:r,sparklesCount:n,...a})=>{n=n??10;const[o,i]=m.useState([]);return m.useEffect(()=>{const s=()=>{const u=`${Math.random()*100}%`,h=`${Math.random()*100}%`,p=Math.random()>.5?e.first:e.second,f=Math.random()*2,g=Math.random()*1+.3,y=Math.random()*10+5;return{id:`${u}-${h}-${Date.now()}`,x:u,y:h,color:p,delay:f,scale:g,lifespan:y}},l=()=>{const u=n?Array.from({length:n},s):[];i(u)},c=()=>{i(u=>u.map(h=>h.lifespan<=0?s():{...h,lifespan:h.lifespan-.1}))};l();const d=setInterval(c,100);return()=>clearInterval(d)},[e.first,e.second]),v.jsx("div",{className:fe("text-6xl",r),...a,style:{"--sparkles-first-color":`${e.first}`,"--sparkles-second-color":`${e.second}`},children:v.jsxs("span",{className:"relative inline-block",children:[o.map(s=>v.jsx(dk,{...s},s.id)),v.jsx("strong",{children:t})]})})},(t,e)=>t.text===e.text),dk=({id:t,x:e,y:r,color:n,delay:a,scale:o})=>v.jsx(VN.svg,{className:"pointer-events-none absolute z-20",initial:{opacity:0,left:e,top:r},animate:{opacity:[0,1,0],scale:[0,o,0],rotate:[75,120,150]},transition:{duration:.8,repeat:1/0,delay:a},width:"21",height:"21",viewBox:"0 0 21 21",children:v.jsx("path",{d:"M9.82531 0.843845C10.0553 0.215178 10.9446 0.215178 11.1746 0.843845L11.8618 2.72026C12.4006 4.19229 12.3916 6.39157 13.5 7.5C14.6084 8.60843 16.8077 8.59935 18.2797 9.13822L20.1561 9.82534C20.7858 10.0553 20.7858 10.9447 20.1561 11.1747L18.2797 11.8618C16.8077 12.4007 14.6084 12.3916 13.5 13.5C12.3916 14.6084 12.4006 16.8077 11.8618 18.2798L11.1746 20.1562C10.9446 20.7858 10.0553 20.7858 9.82531 20.1562L9.13819 18.2798C8.59932 16.8077 8.60843 14.6084 7.5 13.5C6.39157 12.3916 4.19225 12.4007 2.72023 11.8618L0.843814 11.1747C0.215148 10.9447 0.215148 10.0553 0.843814 9.82534L2.72023 9.13822C4.19225 8.59935 6.39157 8.60843 7.5 7.5C8.60843 6.39157 8.59932 4.19229 9.13819 2.72026L9.82531 0.843845Z",fill:n})},t);function Bg({icon:t,sparkles:e,bold:r,text:n,className:a,onClick:o}){return v.jsxs(no,{className:fe(a,"tw-w-full"),onClick:o,children:[v.jsx(Ye,{name:t}),v.jsx(ck,{text:n,sparklesCount:e?3:0,className:fe("text-sm",r?"font-bold":"font-normal")})]})}Be=(t=>(t.Toolbox="TOOLBOX",t.LLM="LLM",t.NewMessage="NEW_MESSAGE",t.Thread="THREAD",t.Message="MESSAGE",t.Prompt="PROMPT",t.SessionInfo="SESSION_INFO",t.Schema="SCHEMA",t.ToolDefinition="TOOL_DEFINITION",t.ToolHandler="TOOL_HANDLER",t.FewShotExample="FEW_SHOT_EXAMPLE",t.CSVData="CSV_DATA",t.DefaultEmbeddingModel="DEFAULT_EMBEDDING_MODEL",t.VectorDatabase="VECTOR_DATABASE",t.JSONLData="JSONL_DATA",t.ApplicationBar="APPLICATION_BAR",t.Shape="SHAPE",t.CircleShape="CIRCLE_SHAPE",t.TriangleShape="TRIANGLE_SHAPE",t.EditorApp="EDITOR_APP",t.PlaceHolder="PLACEHOLDER",t.VSLiteApp="VSLITE_APP",t.JSONData="JSON_DATA",t))(Be||{}),so=(t=>(t.Started="started",t.Done="done",t.Achieved="Achieved",t.Deleted="deleted",t))(so||{}),Et=(t=>(t.Whiteboard="Whiteboard",t.StandaloneApp="StandaloneApp",t))(Et||{}),lp=(t=>(t.Local="local",t.Remote="remote",t))(lp||{}),cr=(t=>(t.Voy="voy",t.Memory="memory",t))(cr||{}),Gr=(t=>(t.DataNode="DataNode",t.DatabaseNode="DatabaseNode",t.IndexedDB="IndexedDB",t))(Gr||{});let xd,Hg;xd={Thread:"threads",Message:"messages",LLM:"llms",FlowNode:"flow_nodes",FlowEdge:"flow_edges",Prompt:"prompts",PromptVariable:"prompt_variables",Session:"sessions",Schema:"schemas",SchemaItem:"schema_items",JSONData:"json_data",CSVData:"csv_data",ToolDefinition:"tool_definitions",VectorDatabase:"vector_databases",JSONLData:"jsonl_data",FlowNodeData:"flow_node_data",FlowNodePlaceholder:"flow_node_placeholders"},Pb={[Be.Toolbox]:void 0,[Be.SessionInfo]:void 0,[Be.DefaultEmbeddingModel]:void 0,[Be.ApplicationBar]:void 0,[Be.Shape]:void 0,[Be.CircleShape]:void 0,[Be.TriangleShape]:void 0,[Be.EditorApp]:void 0,[Be.VSLiteApp]:void 0,[Be.NewMessage]:void 0,[Be.ToolHandler]:void 0,[Be.FewShotExample]:void 0,[Be.JSONData]:"JSONData",[Be.LLM]:"LLM",[Be.Thread]:"Thread",[Be.Message]:"Message",[Be.Prompt]:"Prompt",[Be.Schema]:"Schema",[Be.CSVData]:"CSVData",[Be.ToolDefinition]:"ToolDefinition",[Be.VectorDatabase]:"VectorDatabase",[Be.JSONLData]:"JSONLData",[Be.PlaceHolder]:"FlowNodePlaceholder"},Hg="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Wg,Gg,Vg;Wg=t=>crypto.getRandomValues(new Uint8Array(t)),Gg=(t,e,r)=>{let n=(2<<Math.log(t.length-1)/Math.LN2)-1,a=-~(1.6*n*e/t.length);return(o=e)=>{let i="";for(;;){let s=r(a),l=a;for(;l--;)if(i+=t[s[l]&n]||"",i.length===o)return i}}},Vg=(t,e=21)=>Gg(t,e,Wg),Dt=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Hg[r[t]&63];return e};const qg="_WORKER_INIT_";async function gr(t,e,r,n,a={}){return t.postMessage({...a,type:e,messageId:r,payload:n})}const Zg=(t,e,r)=>{var s,l,c,d,u;const n=t.data.messageId;if(!n)return;const{resolve:a,reject:o,processInfo:i}=(e==null?void 0:e.get(n))||{};n===qg?(s=r==null?void 0:r.onWorkerInit)==null||s.call(r,t):["complete","error"].includes(t.data.type)?(t.data.type==="complete"&&typeof a=="function"?(a==null||a(t.data.payload),(l=r==null?void 0:r.onComplete)==null||l.call(r,t)):typeof o=="function"&&(o==null||o(new Error(JSON.stringify(t.data.payload))),(c=r==null?void 0:r.onError)==null||c.call(r,t)),e.delete(n),(d=r==null?void 0:r.onFinish)==null||d.call(r,t)):t.data.type==="inprogress"?(i&&typeof i=="object"&&"data"in i&&Array.isArray(i==null?void 0:i.data)&&i.data.push(t.data.payload),(u=r==null?void 0:r.onProgress)==null||u.call(r,t)):t.data.type==="started"||vn("[Unknown message type]",t.data)},Or=t=>{let e={};const r=new Promise((n,a)=>{if(e={resolve:n,reject:a},t)return t(n,a)});return e.promise=r,e},uk=t=>!!t&&typeof t=="object"&&"type"in t&&"@instanceof"in t,Fo=t=>{if(t==null||typeof t=="string"||typeof t=="number")return t;if(typeof t=="object"){if(Array.isArray(t))return t.map(r=>Fo(r));const e={};return Object.keys(t).forEach(r=>{const n=t[r];uk(n)?e[r]={"@instanceof":"FindOperator",type:n.type,value:n.value,useParameter:n.useParameter,multipleParameters:n.multipleParameters,getSql:typeof n.getSql=="function"?n.getSql.toString():void 0,objectLiteralParameters:n.objectLiteralParameters}:n&&typeof n=="object"&&n!==null?e[r]=Fo(n):e[r]=n}),e}return t};var kd=(t=>(t.INIT="init",t.REPOSITORY_EXECUTE="repository-execute",t.RAW_QUERY_EXECUTE="raw-query-execute",t))(kd||{});let ya,As,Td,Jg,Kg,On;ya=new Worker(new URL("/NoLLMChat/assets/database.worker-FjYjevk7.js",import.meta.url),{type:"module"}),As=new Map,Td=t=>Zg(t,As,{onWorkerInit:()=>{}}),Jg=async()=>{ya&&ya.removeEventListener("message",Td),ya.addEventListener("message",Td)},Kg=()=>{const t=Dt(),e=Or();return As.set(t,{promise:e.promise,resolve:e.resolve,reject:e.reject}),{promise:e.promise,messageId:t}},On=async(t,e,r)=>{let n="";try{if(!ya)throw new Error("Worker not initialized");const a=Kg();return n=a.messageId,gr(ya,kd.REPOSITORY_EXECUTE,n,[t,e,r]),a.promise}catch(a){throw vn(`Error executing ${kd.REPOSITORY_EXECUTE} action`,a),n&&As.delete(n),a}},He=t=>({find:e=>On(t,"find",Fo(e)),findOne:e=>On(t,"findOne",Fo(e)),count:e=>On(t,"count",Fo(e)),delete:e=>On(t,"delete",e),save:e=>On(t,"save",e),update:(e,r)=>On(t,"update",{id:e,update:r})}),Jg();class hk{constructor(){se(this,"sessionKeyProcess");se(this,"sessionKey");se(this,"loadded",!1);se(this,"sessionMemory",new Map);this.init()}async init(){if(this.loadded)return;this.sessionMemory=new Map;const e={name:"AES-GCM",length:256},r=["encrypt","decrypt"];this.sessionKeyProcess=window.crypto.subtle.generateKey(e,!0,r).then(n=>n),this.sessionKey=await this.sessionKeyProcess,this.loadded=!0,this.sessionKeyProcess=void 0}async reload(){this.loadded=!1,this.init()}async set(e,r){this.sessionKeyProcess&&await this.sessionKeyProcess;const n=await crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(12)},this.sessionKey,new TextEncoder().encode(r));this.sessionMemory.set(e,n)}async get(e){const r=this.sessionMemory.get(e);if(!r)return null;this.sessionKeyProcess&&await this.sessionKeyProcess;const n=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(12)},this.sessionKey,r);return new TextDecoder().decode(n)}async exists(e){return this.sessionMemory.has(e)}}let Yg,Xg,Qg,ey,Ad;Fp=new hk,Yg=(t,e)=>({setToDefaultSession:async r=>{const n=e().sessions;if(!(n!=null&&n.length)){const a=await He("Session").find({where:{status:so.Started,type:r||Et.Whiteboard},order:{updated_at:"DESC"},take:1});return e().setCurrentSession(a==null?void 0:a[0])}return e().setCurrentSession(n==null?void 0:n[0])},setCurrentSession:async r=>{const n=e().currentSession;if(!r||typeof r=="string"&&(n==null?void 0:n.id)===r||typeof r=="object"&&(n==null?void 0:n.id)===r.id&&n.passphrase===r.passphrase&&n.metadata===r.metadata)return n;if(await Fp.reload(),t({currentSession:void 0}),typeof r=="string"||!r)if(r=r||Fl.getState().selectedSessionId,r===(n==null?void 0:n.id)&&n)r=n;else{let i=await He("Session").findOne({where:{id:r}});i||(i=await He("Session").findOne({order:{updated_at:"DESC"}})),r=i}Fl.setState({selectedSessionId:r.id});const a=await He("FlowNode").findOne({where:{id:r.main_node_id}});r.main_node=a;let o=!1;if(r.type===Et.StandaloneApp){const i=e().applications.map(s=>s.id===r.id?(o=!0,r):s);t({currentSession:r,applications:o?i:[r,...e().applications]})}else{const i=e().sessions.map(s=>s.id===r.id?(o=!0,r):s);t({currentSession:r,sessions:o?i:[r,...e().sessions]})}return r},createSession:async r=>{const n=await He("Session").save({...r,name:`${r.name}`,status:so.Started,type:Et.Whiteboard});if(!n)throw new Error("Failed create.");return t({sessions:[n,...e().sessions]}),n},deleteSession:async r=>{const n=await He("Session").findOne({where:{id:r}});if(!n)throw new Error("Failed delete.");if(!await He("Session").delete(r))throw new Error("Failed delete.");const a=e().sessions,o=e().applications;if((n==null?void 0:n.type)===Et.Whiteboard){const i=a.filter(s=>s.id!==r);t({sessions:i,...(n==null?void 0:n.id)===r?{currentSession:(i==null?void 0:i[0])||(o==null?void 0:o[0])}:{}})}else{const i=o.filter(s=>s.id!==r);t({applications:i,...(n==null?void 0:n.id)===r?{currentSession:(i==null?void 0:i[0])||(a==null?void 0:a[0])}:{}})}},getSessions:async r=>{try{const n=await He("Session").find({where:(r==null?void 0:r.where)||{status:so.Started},order:{updated_at:"DESC"},take:20,relations:["main_node"],skip:r!=null&&r.page?(r.page-1)*20:0});n!=null&&n.length&&t({sessions:n})}catch{t({error:"No session"})}}}),Xg={currentSession:void 0,ready:!0,error:void 0,sessions:[],applications:[]},Vr=Hh()(Wh((t,e)=>({...Xg,...Yg(t,e)}))),Qg=()=>{const[t,e]=m.useState(!1),r=Vr(a=>a.createSession),n=m.useCallback(async a=>{try{return e(!0),await r(a)}finally{e(!1)}},[r]);return{loading:t,createSession:n}},cf=Cl,ey=Il,Ad=m.forwardRef(({className:t,...e},r)=>v.jsx(oo,{ref:r,className:fe("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e})),Ad.displayName=oo.displayName,vc=m.forwardRef(({className:t,children:e,...r},n)=>v.jsxs(ey,{children:[v.jsx(Ad,{}),v.jsxs(to,{ref:n,className:fe("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[e,v.jsxs(fc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[v.jsx(Ye,{name:"x",className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]})),vc.displayName=to.displayName,_c=({className:t,...e})=>v.jsx("div",{className:fe("flex flex-col space-y-1.5 text-center sm:text-left",t),...e}),_c.displayName="DialogHeader",Vl=({className:t,...e})=>v.jsx("div",{className:fe("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e}),Vl.displayName="DialogFooter",wc=m.forwardRef(({className:t,...e},r)=>v.jsx(io,{ref:r,className:fe("text-lg font-semibold leading-none tracking-tight",t),...e})),wc.displayName=io.displayName,Gl=m.forwardRef(({className:t,...e},r)=>v.jsx(ro,{ref:r,className:fe("text-sm text-muted-foreground",t),...e})),Gl.displayName=ro.displayName;var pk="Label",ty=m.forwardRef((t,e)=>v.jsx(Ze.label,{...t,ref:e,onMouseDown:r=>{var n;r.target.closest("button, input, select, textarea")||((n=t.onMouseDown)==null||n.call(t,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));ty.displayName=pk;var ry=ty;let ny;ny=Rl("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ci=m.forwardRef(({className:t,...e},r)=>v.jsx(ry,{ref:r,className:fe(ny(),t),...e})),Ci.displayName=ry.displayName,Op=qN(()=>{const t=xb(),{t:e}=Ti("dialogs"),[r,n]=m.useState(""),{toast:a}=ZN(),{loading:o,createSession:i}=Qg(),s=d=>{n(d.target.value)},l=async()=>{try{const d=await i({name:r});n(""),t.resolve(d.id),t.hide()}catch(d){a({variant:"destructive",description:e("create_session.errors.create_failed")}),t.reject(d)}},c=()=>{n(""),t.resolve(void 0),t.hide()};return v.jsx(cf,{open:t.visible,onOpenChange:c,children:v.jsxs(vc,{className:"sm:max-w-[425px]",children:[v.jsxs(_c,{children:[v.jsx(wc,{children:e("create_session.title")}),v.jsx(Gl,{children:e("create_session.description")})]}),v.jsx("div",{className:"grid gap-4 py-4",children:v.jsxs("div",{className:"flex flex-col space-y-1.5",children:[v.jsx(Ci,{className:"mb-2",htmlFor:"name",children:e("create_session.name")}),v.jsx(ji,{onChange:s,id:"name",value:r,placeholder:e("create_session.name_placeholder")})]})}),v.jsx(Vl,{children:v.jsx(Wr,{onClick:l,disabled:o||!r,type:"submit",children:e("create_session.create")})})]})})});function fk({currentSession:t}){const{t:e}=Ti("sidebar"),r=ta(),[n,a]=m.useState(),o=xb(Op),i=m.useCallback(async()=>{try{const l=await o.show({});l&&typeof l=="string"&&r(at("whiteboard",{sessionId:l}))}catch{}},[o,r]),s=m.useCallback(()=>{r(at("sessions"))},[r]);return m.useEffect(()=>{!n||n!==(t==null?void 0:t.id)||a(void 0)},[n,t==null?void 0:t.id]),v.jsx(zi,{className:"group-data-[collapsible=icon]:hidden pb-0",children:v.jsxs(fo,{children:[v.jsx(ea,{children:v.jsx(Bg,{icon:"layout-grid",onClick:s,className:"w-full",text:e("sessions")})}),v.jsx(ea,{children:v.jsx(Bg,{icon:"frame",onClick:i,className:"w-full",text:e("new_session"),bold:!0,sparkles:!0})})]})})}var mk=m.createContext(void 0);yc=function(t){const e=m.useContext(mk);return t||e||"ltr"};function gk(t,e=[]){let r=[];function n(o,i){const s=m.createContext(i),l=r.length;r=[...r,i];function c(u){const{scope:h,children:p,...f}=u,g=(h==null?void 0:h[t][l])||s,y=m.useMemo(()=>f,Object.values(f));return v.jsx(g.Provider,{value:y,children:p})}function d(u,h){const p=(h==null?void 0:h[t][l])||s,f=m.useContext(p);if(f)return f;if(i!==void 0)return i;throw new Error(`\`${u}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,d]}const a=()=>{const o=r.map(i=>m.createContext(i));return function(i){const s=(i==null?void 0:i[t])||o;return m.useMemo(()=>({[`__scope${t}`]:{...i,[t]:s}}),[i,s])}};return a.scopeName=t,[n,yk(a,...e)]}function yk(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=n.reduce((i,{useScope:s,scopeName:l})=>{const c=s(a)[`__scope${l}`];return{...i,...c}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}let Ms,ay,No,Rs,Md,oy,iy,sy,ly,Rd;Ms="rovingFocusGroup.onEntryFocus",ay={bubbles:!1,cancelable:!0},No="RovingFocusGroup",[Rs,Md,oy]=kb(No),[iy,gc]=gk(No,[oy]),[sy,ly]=iy(No),Rd=m.forwardRef((t,e)=>v.jsx(Rs.Provider,{scope:t.__scopeRovingFocusGroup,children:v.jsx(Rs.Slot,{scope:t.__scopeRovingFocusGroup,children:v.jsx(vk,{...t,ref:e})})})),Rd.displayName=No;var vk=m.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:a=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...u}=t,h=m.useRef(null),p=mt(e,h),f=yc(o),[g=null,y]=Ya({prop:i,defaultProp:s,onChange:l}),[E,k]=m.useState(!1),R=Xn(c),O=Md(r),b=m.useRef(!1),[U,H]=m.useState(0);return m.useEffect(()=>{const $=h.current;if($)return $.addEventListener(Ms,R),()=>$.removeEventListener(Ms,R)},[R]),v.jsx(sy,{scope:r,orientation:n,dir:f,loop:a,currentTabStopId:g,onItemFocus:m.useCallback($=>y($),[y]),onItemShiftTab:m.useCallback(()=>k(!0),[]),onFocusableItemAdd:m.useCallback(()=>H($=>$+1),[]),onFocusableItemRemove:m.useCallback(()=>H($=>$-1),[]),children:v.jsx(Ze.div,{tabIndex:E||U===0?-1:0,"data-orientation":n,...u,ref:p,style:{outline:"none",...t.style},onMouseDown:_e(t.onMouseDown,()=>{b.current=!0}),onFocus:_e(t.onFocus,$=>{const G=!b.current;if($.target===$.currentTarget&&G&&!E){const ne=new CustomEvent(Ms,ay);if($.currentTarget.dispatchEvent(ne),!ne.defaultPrevented){const he=O().filter(_=>_.focusable),S=he.find(_=>_.active),M=he.find(_=>_.id===g),x=[S,M,...he].filter(Boolean).map(_=>_.ref.current);uy(x,d)}}b.current=!1}),onBlur:_e(t.onBlur,()=>k(!1))})})}),cy="RovingFocusGroupItem",dy=m.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:a=!1,tabStopId:o,...i}=t,s=Ut(),l=o||s,c=ly(cy,r),d=c.currentTabStopId===l,u=Md(r),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return m.useEffect(()=>{if(n)return h(),()=>p()},[n,h,p]),v.jsx(Rs.ItemSlot,{scope:r,id:l,focusable:n,active:a,children:v.jsx(Ze.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...i,ref:e,onMouseDown:_e(t.onMouseDown,f=>{n?c.onItemFocus(l):f.preventDefault()}),onFocus:_e(t.onFocus,()=>c.onItemFocus(l)),onKeyDown:_e(t.onKeyDown,f=>{if(f.key==="Tab"&&f.shiftKey){c.onItemShiftTab();return}if(f.target!==f.currentTarget)return;const g=bk(f,c.orientation,c.dir);if(g!==void 0){if(f.metaKey||f.ctrlKey||f.altKey||f.shiftKey)return;f.preventDefault();let y=u().filter(E=>E.focusable).map(E=>E.ref.current);if(g==="last")y.reverse();else if(g==="prev"||g==="next"){g==="prev"&&y.reverse();const E=y.indexOf(f.currentTarget);y=c.loop?Ek(y,E+1):y.slice(E+1)}setTimeout(()=>uy(y))}})})})});dy.displayName=cy;var _k={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function wk(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function bk(t,e,r){const n=wk(t.key,r);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return _k[n]}function uy(t,e=!1){const r=document.activeElement;for(const n of t)if(n===r||(n.focus({preventScroll:e}),document.activeElement!==r))return}function Ek(t,e){return t.map((r,n)=>t[(e+n)%t.length])}let Fs,hy,Fd,py,fy,my,va,_a,gy,yy,Qr,wa,Nd,Pd,Ir,vy,ba,Od;lf=Rd,qh=dy,Fs=["Enter"," "],hy=["ArrowDown","PageUp","Home"],Fd=["ArrowUp","PageDown","End"],py=[...hy,...Fd],fy={ltr:[...Fs,"ArrowRight"],rtl:[...Fs,"ArrowLeft"]},my={ltr:["ArrowLeft"],rtl:["ArrowRight"]},va="Menu",[_a,gy,yy]=kb(va),[Qr,Wl]=ki(va,[yy,lo,gc]),wa=lo(),Nd=gc(),[Pd,Ir]=Qr(va),[vy,ba]=Qr(va),Od=t=>{const{__scopeMenu:e,open:r=!1,children:n,dir:a,onOpenChange:o,modal:i=!0}=t,s=wa(e),[l,c]=m.useState(null),d=m.useRef(!1),u=Xn(o),h=yc(a);return m.useEffect(()=>{const p=()=>{d.current=!0,document.addEventListener("pointerdown",f,{capture:!0,once:!0}),document.addEventListener("pointermove",f,{capture:!0,once:!0})},f=()=>d.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",f,{capture:!0}),document.removeEventListener("pointermove",f,{capture:!0})}},[]),v.jsx(Ii,{...s,children:v.jsx(Pd,{scope:e,open:r,onOpenChange:u,content:l,onContentChange:c,children:v.jsx(vy,{scope:e,onClose:m.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:h,modal:i,children:n})})})},Od.displayName=va;var Sk="MenuAnchor",Id=m.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t,a=wa(r);return v.jsx(zl,{...a,...n,ref:e})});Id.displayName=Sk;var Cd="MenuPortal",[xk,_y]=Qr(Cd,{forceMount:void 0}),wy=t=>{const{__scopeMenu:e,forceMount:r,children:n,container:a}=t,o=Ir(Cd,e);return v.jsx(xk,{scope:e,forceMount:r,children:v.jsx(Tr,{present:r||o.open,children:v.jsx(Bh,{asChild:!0,container:a,children:n})})})};wy.displayName=Cd;var Ot="MenuContent",[kk,jd]=Qr(Ot),by=m.forwardRef((t,e)=>{const r=_y(Ot,t.__scopeMenu),{forceMount:n=r.forceMount,...a}=t,o=Ir(Ot,t.__scopeMenu),i=ba(Ot,t.__scopeMenu);return v.jsx(_a.Provider,{scope:t.__scopeMenu,children:v.jsx(Tr,{present:n||o.open,children:v.jsx(_a.Slot,{scope:t.__scopeMenu,children:i.modal?v.jsx(Tk,{...a,ref:e}):v.jsx(Ak,{...a,ref:e})})})})}),Tk=m.forwardRef((t,e)=>{const r=Ir(Ot,t.__scopeMenu),n=m.useRef(null),a=mt(e,n);return m.useEffect(()=>{const o=n.current;if(o)return Dl(o)},[]),v.jsx(Ld,{...t,ref:a,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:_e(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),Ak=m.forwardRef((t,e)=>{const r=Ir(Ot,t.__scopeMenu);return v.jsx(Ld,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Ld=m.forwardRef((t,e)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:a,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:f,...g}=t,y=Ir(Ot,r),E=ba(Ot,r),k=wa(r),R=Nd(r),O=gy(r),[b,U]=m.useState(null),H=m.useRef(null),$=mt(e,H,y.onContentChange),G=m.useRef(0),ne=m.useRef(""),he=m.useRef(0),S=m.useRef(null),M=m.useRef("right"),x=m.useRef(0),_=f?Pi:m.Fragment,B=f?{as:yn,allowPinchZoom:!0}:void 0,N=I=>{var Br,Hr;const Y=ne.current+I,ae=O().filter(Ce=>!Ce.disabled),ce=document.activeElement,be=(Br=ae.find(Ce=>Ce.ref.current===ce))==null?void 0:Br.textValue,Se=ae.map(Ce=>Ce.textValue),We=$k(Se,Y,be),vt=(Hr=ae.find(Ce=>Ce.textValue===We))==null?void 0:Hr.ref.current;(function Ce(_t){ne.current=_t,window.clearTimeout(G.current),_t!==""&&(G.current=window.setTimeout(()=>Ce(""),1e3))})(Y),vt&&setTimeout(()=>vt.focus())};m.useEffect(()=>()=>window.clearTimeout(G.current),[]),$l();const C=m.useCallback(I=>{var Y,ae;return M.current===((Y=S.current)==null?void 0:Y.side)&&zk(I,(ae=S.current)==null?void 0:ae.area)},[]);return v.jsx(kk,{scope:r,searchRef:ne,onItemEnter:m.useCallback(I=>{C(I)&&I.preventDefault()},[C]),onItemLeave:m.useCallback(I=>{var Y;C(I)||((Y=H.current)==null||Y.focus(),U(null))},[C]),onTriggerLeave:m.useCallback(I=>{C(I)&&I.preventDefault()},[C]),pointerGraceTimerRef:he,onPointerGraceIntentChange:m.useCallback(I=>{S.current=I},[]),children:v.jsx(_,{...B,children:v.jsx(Oi,{asChild:!0,trapped:a,onMountAutoFocus:_e(o,I=>{var Y;I.preventDefault(),(Y=H.current)==null||Y.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:v.jsx(zh,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,children:v.jsx(lf,{asChild:!0,...R,dir:E.dir,orientation:"vertical",loop:n,currentTabStopId:b,onCurrentTabStopIdChange:U,onEntryFocus:_e(l,I=>{E.isUsingKeyboardRef.current||I.preventDefault()}),preventScrollOnEntryFocus:!0,children:v.jsx(Bl,{role:"menu","aria-orientation":"vertical","data-state":$y(y.open),"data-radix-menu-content":"",dir:E.dir,...k,...g,ref:$,style:{outline:"none",...g.style},onKeyDown:_e(g.onKeyDown,I=>{const Y=I.target.closest("[data-radix-menu-content]")===I.currentTarget,ae=I.ctrlKey||I.altKey||I.metaKey,ce=I.key.length===1;Y&&(I.key==="Tab"&&I.preventDefault(),!ae&&ce&&N(I.key));const be=H.current;if(I.target!==be||!py.includes(I.key))return;I.preventDefault();const Se=O().filter(We=>!We.disabled).map(We=>We.ref.current);Fd.includes(I.key)&&Se.reverse(),Lk(Se)}),onBlur:_e(t.onBlur,I=>{I.currentTarget.contains(I.target)||(window.clearTimeout(G.current),ne.current="")}),onPointerMove:_e(t.onPointerMove,Oo(I=>{const Y=I.target,ae=x.current!==I.clientX;if(I.currentTarget.contains(Y)&&ae){const ce=I.clientX>x.current?"right":"left";M.current=ce,x.current=I.clientX}}))})})})})})})});by.displayName=Ot;var Mk="MenuGroup",Dd=m.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return v.jsx(Ze.div,{role:"group",...n,ref:e})});Dd.displayName=Mk;var Rk="MenuLabel",Ey=m.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return v.jsx(Ze.div,{...n,ref:e})});Ey.displayName=Rk;var Ns="MenuItem",Sy="menu.itemSelect",Ps=m.forwardRef((t,e)=>{const{disabled:r=!1,onSelect:n,...a}=t,o=m.useRef(null),i=ba(Ns,t.__scopeMenu),s=jd(Ns,t.__scopeMenu),l=mt(e,o),c=m.useRef(!1),d=()=>{const u=o.current;if(!r&&u){const h=new CustomEvent(Sy,{bubbles:!0,cancelable:!0});u.addEventListener(Sy,p=>n==null?void 0:n(p),{once:!0}),JN(u,h),h.defaultPrevented?c.current=!1:i.onClose()}};return v.jsx(xy,{...a,ref:l,disabled:r,onClick:_e(t.onClick,d),onPointerDown:u=>{var h;(h=t.onPointerDown)==null||h.call(t,u),c.current=!0},onPointerUp:_e(t.onPointerUp,u=>{var h;c.current||((h=u.currentTarget)==null||h.click())}),onKeyDown:_e(t.onKeyDown,u=>{const h=s.searchRef.current!=="";r||h&&u.key===" "||Fs.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});Ps.displayName=Ns;var xy=m.forwardRef((t,e)=>{const{__scopeMenu:r,disabled:n=!1,textValue:a,...o}=t,i=jd(Ns,r),s=Nd(r),l=m.useRef(null),c=mt(e,l),[d,u]=m.useState(!1),[h,p]=m.useState("");return m.useEffect(()=>{const f=l.current;f&&p((f.textContent??"").trim())},[o.children]),v.jsx(_a.ItemSlot,{scope:r,disabled:n,textValue:a??h,children:v.jsx(qh,{asChild:!0,...s,focusable:!n,children:v.jsx(Ze.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:c,onPointerMove:_e(t.onPointerMove,Oo(f=>{n?i.onItemLeave(f):(i.onItemEnter(f),f.defaultPrevented||f.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:_e(t.onPointerLeave,Oo(f=>i.onItemLeave(f))),onFocus:_e(t.onFocus,()=>u(!0)),onBlur:_e(t.onBlur,()=>u(!1))})})})}),Fk="MenuCheckboxItem",ky=m.forwardRef((t,e)=>{const{checked:r=!1,onCheckedChange:n,...a}=t;return v.jsx(Fy,{scope:t.__scopeMenu,checked:r,children:v.jsx(Ps,{role:"menuitemcheckbox","aria-checked":Os(r)?"mixed":r,...a,ref:e,"data-state":zd(r),onSelect:_e(a.onSelect,()=>n==null?void 0:n(Os(r)?!0:!r),{checkForDefaultPrevented:!1})})})});ky.displayName=Fk;var Ty="MenuRadioGroup",[Nk,Pk]=Qr(Ty,{value:void 0,onValueChange:()=>{}}),Ay=m.forwardRef((t,e)=>{const{value:r,onValueChange:n,...a}=t,o=Xn(n);return v.jsx(Nk,{scope:t.__scopeMenu,value:r,onValueChange:o,children:v.jsx(Dd,{...a,ref:e})})});Ay.displayName=Ty;var My="MenuRadioItem",Ry=m.forwardRef((t,e)=>{const{value:r,...n}=t,a=Pk(My,t.__scopeMenu),o=r===a.value;return v.jsx(Fy,{scope:t.__scopeMenu,checked:o,children:v.jsx(Ps,{role:"menuitemradio","aria-checked":o,...n,ref:e,"data-state":zd(o),onSelect:_e(n.onSelect,()=>{var i;return(i=a.onValueChange)==null?void 0:i.call(a,r)},{checkForDefaultPrevented:!1})})})});Ry.displayName=My;var $d="MenuItemIndicator",[Fy,Ok]=Qr($d,{checked:!1}),Ny=m.forwardRef((t,e)=>{const{__scopeMenu:r,forceMount:n,...a}=t,o=Ok($d,r);return v.jsx(Tr,{present:n||Os(o.checked)||o.checked===!0,children:v.jsx(Ze.span,{...a,ref:e,"data-state":zd(o.checked)})})});Ny.displayName=$d;var Ik="MenuSeparator",Py=m.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return v.jsx(Ze.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});Py.displayName=Ik;var Ck="MenuArrow",Oy=m.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t,a=wa(r);return v.jsx(Hl,{...a,...n,ref:e})});Oy.displayName=Ck;var Ud="MenuSub",[jk,Iy]=Qr(Ud),Cy=t=>{const{__scopeMenu:e,children:r,open:n=!1,onOpenChange:a}=t,o=Ir(Ud,e),i=wa(e),[s,l]=m.useState(null),[c,d]=m.useState(null),u=Xn(a);return m.useEffect(()=>(o.open===!1&&u(!1),()=>u(!1)),[o.open,u]),v.jsx(Ii,{...i,children:v.jsx(Pd,{scope:e,open:n,onOpenChange:u,content:c,onContentChange:d,children:v.jsx(jk,{scope:e,contentId:Ut(),triggerId:Ut(),trigger:s,onTriggerChange:l,children:r})})})};Cy.displayName=Ud;var Po="MenuSubTrigger",jy=m.forwardRef((t,e)=>{const r=Ir(Po,t.__scopeMenu),n=ba(Po,t.__scopeMenu),a=Iy(Po,t.__scopeMenu),o=jd(Po,t.__scopeMenu),i=m.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:l}=o,c={__scopeMenu:t.__scopeMenu},d=m.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return m.useEffect(()=>d,[d]),m.useEffect(()=>{const u=s.current;return()=>{window.clearTimeout(u),l(null)}},[s,l]),v.jsx(Id,{asChild:!0,...c,children:v.jsx(xy,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":a.contentId,"data-state":$y(r.open),...t,ref:Tb(e,a.onTriggerChange),onClick:u=>{var h;(h=t.onClick)==null||h.call(t,u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:_e(t.onPointerMove,Oo(u=>{o.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!r.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),d()},100))})),onPointerLeave:_e(t.onPointerLeave,Oo(u=>{var p,f;d();const h=(p=r.content)==null?void 0:p.getBoundingClientRect();if(h){const g=(f=r.content)==null?void 0:f.dataset.side,y=g==="right",E=y?-5:5,k=h[y?"left":"right"],R=h[y?"right":"left"];o.onPointerGraceIntentChange({area:[{x:u.clientX+E,y:u.clientY},{x:k,y:h.top},{x:R,y:h.top},{x:R,y:h.bottom},{x:k,y:h.bottom}],side:g}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(u),u.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:_e(t.onKeyDown,u=>{var p;const h=o.searchRef.current!=="";t.disabled||h&&u.key===" "||fy[n.dir].includes(u.key)&&(r.onOpenChange(!0),(p=r.content)==null||p.focus(),u.preventDefault())})})})});jy.displayName=Po;var Ly="MenuSubContent",Dy=m.forwardRef((t,e)=>{const r=_y(Ot,t.__scopeMenu),{forceMount:n=r.forceMount,...a}=t,o=Ir(Ot,t.__scopeMenu),i=ba(Ot,t.__scopeMenu),s=Iy(Ly,t.__scopeMenu),l=m.useRef(null),c=mt(e,l);return v.jsx(_a.Provider,{scope:t.__scopeMenu,children:v.jsx(Tr,{present:n||o.open,children:v.jsx(_a.Slot,{scope:t.__scopeMenu,children:v.jsx(Ld,{id:s.contentId,"aria-labelledby":s.triggerId,...a,ref:c,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var u;i.isUsingKeyboardRef.current&&((u=l.current)==null||u.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:_e(t.onFocusOutside,d=>{d.target!==s.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:_e(t.onEscapeKeyDown,d=>{i.onClose(),d.preventDefault()}),onKeyDown:_e(t.onKeyDown,d=>{var p;const u=d.currentTarget.contains(d.target),h=my[i.dir].includes(d.key);u&&h&&(o.onOpenChange(!1),(p=s.trigger)==null||p.focus(),d.preventDefault())})})})})})});Dy.displayName=Ly;function $y(t){return t?"open":"closed"}function Os(t){return t==="indeterminate"}function zd(t){return Os(t)?"indeterminate":t?"checked":"unchecked"}function Lk(t){const e=document.activeElement;for(const r of t)if(r===e||(r.focus(),document.activeElement!==e))return}function Dk(t,e){return t.map((r,n)=>t[(e+n)%t.length])}function $k(t,e,r){const n=e.length>1&&Array.from(e).every(s=>s===e[0])?e[0]:e,a=r?t.indexOf(r):-1;let o=Dk(t,Math.max(a,0));n.length===1&&(o=o.filter(s=>s!==r));const i=o.find(s=>s.toLowerCase().startsWith(n.toLowerCase()));return i!==r?i:void 0}function Uk(t,e){const{x:r,y:n}=t;let a=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const s=e[o].x,l=e[o].y,c=e[i].x,d=e[i].y;l>n!=d>n&&r<(c-s)*(n-l)/(d-l)+s&&(a=!a)}return a}function zk(t,e){if(!e)return!1;const r={x:t.clientX,y:t.clientY};return Uk(r,e)}function Oo(t){return e=>e.pointerType==="mouse"?t(e):void 0}let Uy,Is,zy,Bk,it,By,Bd,Hd;Mp=Od,mp=Id,Rp=wy,gp=by,yp=Dd,vp=Ey,_p=Ps,wp=ky,bp=Ay,Ep=Ry,Sp=Ny,xp=Py,kp=Oy,Uy=Cy,Tp=jy,Ap=Dy,Is="DropdownMenu",[zy,Bk]=ki(Is,[Wl]),it=Wl(),[By,Bd]=zy(Is),Hd=t=>{const{__scopeDropdownMenu:e,children:r,dir:n,open:a,defaultOpen:o,onOpenChange:i,modal:s=!0}=t,l=it(e),c=m.useRef(null),[d=!1,u]=Ya({prop:a,defaultProp:o,onChange:i});return v.jsx(By,{scope:e,triggerId:Ut(),triggerRef:c,contentId:Ut(),open:d,onOpenChange:u,onOpenToggle:m.useCallback(()=>u(h=>!h),[u]),modal:s,children:v.jsx(Mp,{...l,open:d,onOpenChange:u,dir:n,modal:s,children:r})})},Hd.displayName=Is;var Hy="DropdownMenuTrigger",Wy=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...a}=t,o=Bd(Hy,r),i=it(r);return v.jsx(mp,{asChild:!0,...i,children:v.jsx(Ze.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...a,ref:Tb(e,o.triggerRef),onPointerDown:_e(t.onPointerDown,s=>{!n&&s.button===0&&s.ctrlKey===!1&&(o.onOpenToggle(),o.open||s.preventDefault())}),onKeyDown:_e(t.onKeyDown,s=>{n||(["Enter"," "].includes(s.key)&&o.onOpenToggle(),s.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});Wy.displayName=Hy;var Hk="DropdownMenuPortal",Gy=t=>{const{__scopeDropdownMenu:e,...r}=t,n=it(e);return v.jsx(Rp,{...n,...r})};Gy.displayName=Hk;var Vy="DropdownMenuContent",qy=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=Bd(Vy,r),o=it(r),i=m.useRef(!1);return v.jsx(gp,{id:a.contentId,"aria-labelledby":a.triggerId,...o,...n,ref:e,onCloseAutoFocus:_e(t.onCloseAutoFocus,s=>{var l;i.current||((l=a.triggerRef.current)==null||l.focus()),i.current=!1,s.preventDefault()}),onInteractOutside:_e(t.onInteractOutside,s=>{const l=s.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;(!a.modal||d)&&(i.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});qy.displayName=Vy;var Wk="DropdownMenuGroup",Zy=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(yp,{...a,...n,ref:e})});Zy.displayName=Wk;var Gk="DropdownMenuLabel",Jy=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(vp,{...a,...n,ref:e})});Jy.displayName=Gk;var Vk="DropdownMenuItem",Ky=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(_p,{...a,...n,ref:e})});Ky.displayName=Vk;var qk="DropdownMenuCheckboxItem",Yy=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(wp,{...a,...n,ref:e})});Yy.displayName=qk;var Zk="DropdownMenuRadioGroup",Xy=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(bp,{...a,...n,ref:e})});Xy.displayName=Zk;var Jk="DropdownMenuRadioItem",Qy=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(Ep,{...a,...n,ref:e})});Qy.displayName=Jk;var Kk="DropdownMenuItemIndicator",ev=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(Sp,{...a,...n,ref:e})});ev.displayName=Kk;var Yk="DropdownMenuSeparator",tv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(xp,{...a,...n,ref:e})});tv.displayName=Yk;var Xk="DropdownMenuArrow",Qk=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(kp,{...a,...n,ref:e})});Qk.displayName=Xk;var e1=t=>{const{__scopeDropdownMenu:e,children:r,open:n,onOpenChange:a,defaultOpen:o}=t,i=it(e),[s=!1,l]=Ya({prop:n,defaultProp:o,onChange:a});return v.jsx(Uy,{...i,open:s,onOpenChange:l,children:r})},t1="DropdownMenuSubTrigger",rv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(Tp,{...a,...n,ref:e})});rv.displayName=t1;var r1="DropdownMenuSubContent",nv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=it(r);return v.jsx(Ap,{...a,...n,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});nv.displayName=r1,Yp=Hd,Xp=Wy,Wp=Gy,nc=qy,Hp=Zy,dc=Jy,ic=Ky,sc=Yy,$b=Xy,cc=Qy,lc=ev,Jl=tv,Zb=e1,ac=rv,oc=nv;const n1=Yp,a1=Xp,o1=Hp,i1=m.forwardRef(({className:t,inset:e,children:r,...n},a)=>v.jsxs(ac,{ref:a,className:fe("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...n,children:[r,v.jsx(Ye,{name:"chevron-right",className:"ml-auto"})]}));i1.displayName=ac.displayName;const s1=m.forwardRef(({className:t,...e},r)=>v.jsx(oc,{ref:r,className:fe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e}));s1.displayName=oc.displayName;const av=m.forwardRef(({className:t,sideOffset:e=4,...r},n)=>v.jsx(Wp,{children:v.jsx(nc,{ref:n,sideOffset:e,className:fe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));av.displayName=nc.displayName;const ov=m.forwardRef(({className:t,inset:e,...r},n)=>v.jsx(ic,{ref:n,className:fe("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...r}));ov.displayName=ic.displayName;const l1=m.forwardRef(({className:t,children:e,checked:r,...n},a)=>v.jsxs(sc,{ref:a,className:fe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...n,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(lc,{children:v.jsx(Ye,{name:"check",className:"h-4 w-4"})})}),e]}));l1.displayName=sc.displayName;const c1=m.forwardRef(({className:t,children:e,...r},n)=>v.jsxs(cc,{ref:n,className:fe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(lc,{children:v.jsx(Ye,{name:"circle",className:"h-4 w-4"})})}),e]}));c1.displayName=cc.displayName;const d1=m.forwardRef(({className:t,inset:e,...r},n)=>v.jsx(dc,{ref:n,className:fe("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...r}));d1.displayName=dc.displayName;const u1=m.forwardRef(({className:t,...e},r)=>v.jsx(Jl,{ref:r,className:fe("-mx-1 my-1 h-px bg-muted",t),...e}));u1.displayName=Jl.displayName;function h1(){const{t}=Ti("sidebar"),{isMobile:e}=Ro();return v.jsx(fo,{children:v.jsx(ea,{children:v.jsxs(n1,{children:[v.jsx(a1,{asChild:!0,children:v.jsxs(no,{size:"lg",className:"data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[v.jsx("div",{children:v.jsx(Ye,{name:"settings",size:28,className:"pr-2"})}),v.jsx(Ye,{name:"chevrons-up-down",className:"ml-auto size-4"})]})}),v.jsx(av,{className:"w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg",side:e?"bottom":"right",align:"end",sideOffset:4,children:v.jsx(o1,{children:v.jsxs(ov,{children:[v.jsx(Ye,{name:"sparkles"}),t("contact")]})})})]})})})}const p1={navMain:[{title:"playground.title",icon:v.jsx(Ye,{name:"square-terminal"}),isActive:!0,items:[{title:"playground.nodes",id:"nodes"},{title:"playground.connections",id:"connections"}]},{title:"model.title",url:"#",icon:v.jsx(Ye,{name:"bot"}),items:[{title:"model.llm",id:"llm"},{title:"model.embedding",id:"embedding"}]},{title:"tutorial.title",icon:v.jsx(Ye,{name:"book-open"}),items:[{title:"tutorial.get_started",id:"get-started"},{title:"tutorial.simple_workflow",id:"simple-workflow"},{title:"tutorial.ai_structured_output",id:"ai-structured-output"},{title:"tutorial.standalone_chat_application",id:"chat-application"},{title:"tutorial.standalone_editor_application",id:"editor-application"},{title:"tutorial.tool_calling",id:"tool-calling"},{title:"tutorial.vector_database",id:"vector-database"}]},{title:"application.title",icon:v.jsx(Ye,{name:"settings-2"}),items:[{title:"application.chat",id:"chat"},{title:"application.editor",id:"editor"},{title:"application.vslite",id:"vslite"}]}]};function f1({currentSession:t,...e}){return v.jsxs(bc,{collapsible:"offcanvas",...e,children:[v.jsx("div",{className:"h-1"}),v.jsxs(Sc,{children:[v.jsx(fk,{currentSession:t}),v.jsx(lk,{items:p1.navMain})]}),v.jsx(Cg,{children:v.jsx(h1,{})}),v.jsx(Ig,{})]})}const iv=t=>Symbol.iterator in t,sv=t=>"entries"in t,lv=(t,e)=>{const r=t instanceof Map?t:new Map(t.entries()),n=e instanceof Map?e:new Map(e.entries());if(r.size!==n.size)return!1;for(const[a,o]of r)if(!Object.is(o,n.get(a)))return!1;return!0},m1=(t,e)=>{const r=t[Symbol.iterator](),n=e[Symbol.iterator]();let a=r.next(),o=n.next();for(;!a.done&&!o.done;){if(!Object.is(a.value,o.value))return!1;a=r.next(),o=n.next()}return!!a.done&&!!o.done};function g1(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!iv(t)||!iv(e)?lv({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):sv(t)&&sv(e)?lv(t,e):m1(t,e)}Pp=function(t){const e=KN.useRef();return r=>{const n=t(r);return g1(e.current,n)?e.current:e.current=n}},Zh=m.memo(t=>{const{loading:e,...r}=t;return v.jsx(Wr,{...r,disabled:t.disabled||e,children:e?v.jsx(Ye,{name:"loader-circle",className:"animate-spin"}):t.children})});function y1({className:t,onProcess:e=async()=>(await new Promise(a=>setTimeout(a,2e3)),Math.random()>.5),processDuration:r=2e3,...n}){const[a,o]=m.useState(!1),[i,s]=m.useState(null),[l,c]=m.useState(!1),[,d]=m.useState(0);m.useEffect(()=>{if(a){const h=Date.now(),p=setInterval(()=>{const f=(Date.now()-h)/r*100;f>=100?(clearInterval(p),d(100)):d(f)},10);return()=>clearInterval(p)}},[a,r]);async function u(){if(a)return;o(!0),s(null),d(0),await new Promise(p=>setTimeout(p,r));const h=e?await e():!0;s(h),o(!1),c(!0),setTimeout(()=>{s(null),d(0),c(!1)},2e3)}return v.jsx(Wr,{className:fe("relative group","transition-all duration-300",a&&"cursor-wait",t),variant:"ghost",onClick:u,disabled:a,...n,children:v.jsx("div",{className:fe("w-full flex items-center justify-center gap-2",l&&"animate-[scale_300ms_ease-in-out]"),children:i===null?v.jsx(v.Fragment,{children:v.jsx(Ye,{name:"forward",className:fe("w-4 h-4 transition-transform duration-200","group-hover:scale-110",a&&"animate-bounce")})}):i?v.jsx(v.Fragment,{children:v.jsx(Ye,{name:"check",className:"w-4 h-4 text-green-500"})}):v.jsx(v.Fragment,{children:v.jsx(Ye,{name:"x",className:"w-4 h-4 text-red-500"})})})})}const yr="NOLLM",v1="0123456789abcdef",_1=[8,4,4,4,12];Zl=function(){return _1.map(t=>Vg(v1,t)()).join("-")};const w1=()=>{const t=Vr(e=>e.currentSession);return{exportSession:m.useCallback(async()=>{if(!(t!=null&&t.id))return;const e={},r={},n=Object.keys(xd).filter(l=>l!=="Session");await Promise.all(n.map(l=>He(l).find({where:{session_id:t.id}}).then(c=>{c.map(d=>{r[d.id]=d.id}),e[l]=c}))),Object.keys(r).forEach(l=>{r[l]=`[ID_${Zl()}]`});let a=JSON.stringify({[yr]:{key:t.id,session:Object.entries(t).reduce((l,[c,d])=>((typeof d!="object"||d===null)&&(l[c]=d),d===void 0&&(l[c]=null),l),{}),ids:Object.keys(r)},...e});Object.keys(r).forEach(l=>{a=a.replace(new RegExp(l,"g"),r[l])}),a=a.replace(new RegExp(t.id,"g"),"[SESSION_ID]");const o=new Blob([a],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=`${t.name}_${new Date}.json`,s.click()},[t])}},b1=()=>{const[t,e]=m.useState(!1),r=ta(),n=m.useCallback((o,{idMap:i,newSessionId:s,replaceItem:l})=>{const c=o;return{...Object.keys(c).reduce((d,u)=>(c[u]&&typeof c[u]=="string"&&i[c[u]]?d[u]=i[c[u]]:u==="session_id"&&s?d[u]=s:d[u]=c[u],d),{}),...l||{}}},[]),a=m.useCallback(async o=>{try{e(!0);const i=Object.keys(xd).filter(u=>u!==yr);if(!Object.keys(o[yr]).length||typeof o[yr]!="object")throw new Error("Missing Metadata");if(!("session"in o[yr])||!o[yr].session)throw new Error("Missing Session Metadata");const s=o[yr].session;if(!("ids"in o[yr]))throw new Error("Missing Session ID");const l=o[yr].ids.reduce((u,h)=>(u[h]=Zl(),u),{}),c=Object.keys(o).filter(u=>u!==yr);if(!c.every(u=>i.includes(u)))throw new Error("Invalid JSON keys");if(!c.every(u=>Array.isArray(o[u])))throw new Error("Invalid JSON values");c.forEach(u=>{o[u].forEach(h=>{if("session_id"in h&&h.session_id!=="[SESSION_ID]")throw new Error("Invalid JSON values")})});const d=await He("Session").save(n(s,{idMap:l,newSessionId:"",replaceItem:{id:void 0}}));if(!d)throw new Error("Failed to import session");await Promise.all(i.map(u=>{const h=o[u];if(!h||!h.length)return Promise.resolve();const p=h.map(f=>n(f,{idMap:l,newSessionId:d.id}));return He(u).save(p)})),d.type===Et.Whiteboard?r(at("whiteboard",{sessionId:d.id})):d.type===Et.StandaloneApp&&r(at("application",{applicationId:d.id}))}finally{e(!1)}},[r,n]);return{loading:t,importSession:a}};function E1(){const{t}=Ti("tooltips"),e=pr(),r=Fl(h=>h.setTheme),n=Fl(h=>h.theme),{exportSession:a}=w1(),{loading:o,importSession:i}=b1(),s=m.useRef(null),l=m.useCallback(()=>{r(n==="dark"?"light":"dark")},[n,r]),c=m.useCallback(async()=>{try{return await a(),!0}catch(h){return Nl("Export Session",h),!1}},[a]),d=m.useCallback(async h=>{var p;try{const f=(p=h.target.files)==null?void 0:p[0];if(!f)return;const g=await new Promise((y,E)=>{const k=new FileReader;k.onload=R=>{var O;try{const b=(O=R.target)==null?void 0:O.result;y(JSON.parse(b))}catch(b){E(b)}},k.onerror=R=>{E(R)},k.readAsText(f)});await i(g)}catch(f){return Nl("Import Session",f),!1}},[i]),u=m.useMemo(()=>{if(e.pathname.includes(at("whiteboard")))return t("whiteboard");if(e.pathname.includes(at("application")))return t("apllication")},[e.pathname,t]);return v.jsxs("header",{className:"flex h-14 shrink-0 items-center gap-2 transition-[width,height] ease-linear justify-between",children:[v.jsxs("div",{className:"flex items-center gap-2 px-4",children:[v.jsx(Og,{}),v.jsx(Ci,{children:u})]}),v.jsx("div",{className:"flex items-center pl-4 pr-2",children:v.jsxs(mc,{children:[v.jsxs(aa,{children:[v.jsx(oa,{children:v.jsxs(Zh,{loading:o,variant:"ghost",onClick:()=>{var h;return(h=s.current)==null?void 0:h.click()},children:[v.jsx(Ye,{size:18,name:"import"}),v.jsx("input",{ref:s,type:"file",accept:".json",onChange:d,className:"hidden"},`${Date.now()}`)]})}),v.jsx(Sn,{children:v.jsx("p",{children:t("import")})})]}),v.jsxs(aa,{children:[v.jsx(oa,{children:v.jsx(y1,{onProcess:c})}),v.jsx(Sn,{children:v.jsx("p",{children:t("export")})})]}),v.jsxs(aa,{children:[v.jsx(oa,{children:v.jsx(Wr,{disabled:o,onClick:l,variant:"ghost",children:v.jsx(Ye,{size:18,name:n==="dark"?"moon":"sun"})})}),v.jsx(Sn,{children:v.jsx("p",{children:t("theme")})})]}),v.jsxs(aa,{children:[v.jsx(oa,{children:v.jsx(Wr,{variant:"link",children:v.jsx("a",{referrerPolicy:"no-referrer",target:"_blank",href:"https://github.com/zrg-team/NoLLMChat",children:v.jsx(Ye,{size:18,name:"github"})})})}),v.jsx(Sn,{children:v.jsx("p",{children:"https://github.com/zrg-team/NoLLMChat"})})]})]})})]})}function cv({requiredSession:t}){const e=Uf(),r=ta(),n=pr(),a=m.useRef(n),o=Vr(d=>d.currentSession),i=Vr(d=>d.setCurrentSession),s=Vr(d=>d.setToDefaultSession),{error:l,ready:c}=Vr(Pp(d=>({error:d.error,ready:d.ready})));return a.current=n,m.useEffect(()=>{!(o!=null&&o.id)||!t||(n.pathname.includes(at("whiteboard"))?e.sessionId?e.sessionId&&e.sessionId!==(o==null?void 0:o.id)&&i(e.sessionId):r(at("whiteboard",{sessionId:o==null?void 0:o.id})):n.pathname.includes(at("application"))&&(e.applicationId?e.applicationId&&e.applicationId!==(o==null?void 0:o.id)&&i(e.applicationId):r(at("application",{applicationId:o==null?void 0:o.id}))))},[o==null?void 0:o.id,n.pathname,r,e.applicationId,e.sessionId,t,i]),m.useEffect(()=>{t&&i(e.sessionId||e.applicationId).then(d=>{if(!d)return s(n.pathname.includes(at("whiteboard"))?Et.Whiteboard:Et.StandaloneApp);zg().has("flow")&&d.type===Et.StandaloneApp||(d.type===Et.StandaloneApp&&a.current.pathname.includes(at("whiteboard").replace("/",""))?r(at("application",{applicationId:d.id})):d.type===Et.Whiteboard&&a.current.pathname.includes(at("application").replace("/",""))&&r(at("whiteboard",{sessionId:d.id})))})},[r,e.applicationId,e.sessionId,t,i,s]),c?v.jsxs(Pl,{defaultOpen:!1,children:[v.jsx(f1,{currentSession:o}),v.jsxs(Ol,{className:"max-h-screen overflow-hidden",children:[v.jsx(E1,{}),v.jsx(Ni,{className:"shrink-0"}),v.jsx("div",{className:"flex flex-1 flex-col p-0 m-0 overflow-y-auto",children:l?v.jsx(Ab,{}):v.jsx(pE,{})})]})]}):null}xn=class{constructor(t){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=t.pageContent!==void 0?t.pageContent.toString():"",this.metadata=t.metadata??{},this.id=t.id}};var Fe;(function(t){t.assertEqual=a=>a;function e(a){}t.assertIs=e;function r(a){throw new Error}t.assertNever=r,t.arrayToEnum=a=>{const o={};for(const i of a)o[i]=i;return o},t.getValidEnumValues=a=>{const o=t.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),i={};for(const s of o)i[s]=a[s];return t.objectValues(i)},t.objectValues=a=>t.objectKeys(a).map(function(o){return a[o]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const o=[];for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&o.push(i);return o},t.find=(a,o)=>{for(const i of a)if(o(i))return i},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function n(a,o=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}t.joinValues=n,t.jsonStringifyReplacer=(a,o)=>typeof o=="bigint"?o.toString():o})(Fe||(Fe={}));var Wd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Wd||(Wd={}));const re=Fe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),en=t=>{switch(typeof t){case"undefined":return re.undefined;case"string":return re.string;case"number":return isNaN(t)?re.nan:re.number;case"boolean":return re.boolean;case"function":return re.function;case"bigint":return re.bigint;case"symbol":return re.symbol;case"object":return Array.isArray(t)?re.array:t===null?re.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?re.promise:typeof Map<"u"&&t instanceof Map?re.map:typeof Set<"u"&&t instanceof Set?re.set:typeof Date<"u"&&t instanceof Date?re.date:re.object;default:return re.unknown}},Z=Fe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),S1=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class Tt extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const r=e||function(o){return o.message},n={_errors:[]},a=o=>{for(const i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let s=n,l=0;for(;l<i.path.length;){const c=i.path[l];l===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(r(i))):s[c]=s[c]||{_errors:[]},s=s[c],l++}}};return a(this),n}static assert(e){if(!(e instanceof Tt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Fe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},n=[];for(const a of this.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(e(a))):n.push(e(a));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Tt.create=t=>new Tt(t);const Ea=(t,e)=>{let r;switch(t.code){case Z.invalid_type:t.received===re.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case Z.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Fe.jsonStringifyReplacer)}`;break;case Z.unrecognized_keys:r=`Unrecognized key(s) in object: ${Fe.joinValues(t.keys,", ")}`;break;case Z.invalid_union:r="Invalid input";break;case Z.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Fe.joinValues(t.options)}`;break;case Z.invalid_enum_value:r=`Invalid enum value. Expected ${Fe.joinValues(t.options)}, received '${t.received}'`;break;case Z.invalid_arguments:r="Invalid function arguments";break;case Z.invalid_return_type:r="Invalid function return type";break;case Z.invalid_date:r="Invalid date";break;case Z.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Fe.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case Z.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case Z.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case Z.custom:r="Invalid input";break;case Z.invalid_intersection_types:r="Intersection results could not be merged";break;case Z.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case Z.not_finite:r="Number must be finite";break;default:r=e.defaultError,Fe.assertNever(t)}return{message:r}};let dv=Ea;function x1(t){dv=t}function Cs(){return dv}const js=t=>{const{data:e,path:r,errorMaps:n,issueData:a}=t,o=[...r,...a.path||[]],i={...a,path:o};if(a.message!==void 0)return{...a,path:o,message:a.message};let s="";const l=n.filter(c=>!!c).slice().reverse();for(const c of l)s=c(i,{data:e,defaultError:s}).message;return{...a,path:o,message:s}},k1=[];function te(t,e){const r=Cs(),n=js({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Ea?void 0:Ea].filter(a=>!!a)});t.common.issues.push(n)}class lt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const a of r){if(a.status==="aborted")return ge;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){const n=[];for(const a of r){const o=await a.key,i=await a.value;n.push({key:o,value:i})}return lt.mergeObjectSync(e,n)}static mergeObjectSync(e,r){const n={};for(const a of r){const{key:o,value:i}=a;if(o.status==="aborted"||i.status==="aborted")return ge;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(n[o.value]=i.value)}return{status:e.value,value:n}}}const ge=Object.freeze({status:"aborted"}),Ls=t=>({status:"dirty",value:t}),dt=t=>({status:"valid",value:t}),Gd=t=>t.status==="aborted",Vd=t=>t.status==="dirty",Io=t=>t.status==="valid",Co=t=>typeof Promise<"u"&&t instanceof Promise;function Ds(t,e,r,n){if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function uv(t,e,r,n,a){if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r}var de;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(de||(de={}));var jo,Lo;class vr{constructor(e,r,n,a){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const hv=(t,e)=>{if(Io(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Tt(t.common.issues);return this._error=r,this._error}}};function we(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:n,description:a}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(o,i)=>{var s,l;const{message:c}=t;return o.code==="invalid_enum_value"?{message:c??i.defaultError}:typeof i.data>"u"?{message:(s=c??n)!==null&&s!==void 0?s:i.defaultError}:o.code!=="invalid_type"?{message:i.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:i.defaultError}},description:a}}class Ee{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return en(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:en(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:en(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(Co(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;const a={common:{issues:[],async:(n=r==null?void 0:r.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:en(e)},o=this._parseSync({data:e,path:a.path,parent:a});return hv(a,o)}async parseAsync(e,r){const n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:en(e)},a=this._parse({data:e,path:n.path,parent:n}),o=await(Co(a)?a:Promise.resolve(a));return hv(n,o)}refine(e,r){const n=a=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,o)=>{const i=e(a),s=()=>o.addIssue({code:Z.custom,...n(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(s(),!1)):i?!0:(s(),!1)})}refinement(e,r){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof r=="function"?r(n,a):r),!1))}_refinement(e){return new Yt({schema:this,typeName:K.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return zt.create(this,this._def)}nullable(){return on.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Kt.create(this,this._def)}promise(){return Ta.create(this,this._def)}or(e){return zo.create([this,e],this._def)}and(e){return Bo.create(this,e,this._def)}transform(e){return new Yt({...we(this._def),schema:this,typeName:K.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new qo({...we(this._def),innerType:this,defaultValue:r,typeName:K.ZodDefault})}brand(){return new Jd({typeName:K.ZodBranded,type:this,...we(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new Zo({...we(this._def),innerType:this,catchValue:r,typeName:K.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Jo.create(this,e)}readonly(){return Ko.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const T1=/^c[^\s-]{8,}$/i,A1=/^[0-9a-z]+$/,M1=/^[0-9A-HJKMNP-TV-Z]{26}$/,R1=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,F1=/^[a-z0-9_-]{21}$/i,N1=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,P1=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,O1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let qd;const I1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,C1=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,j1=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,pv="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",L1=new RegExp(`^${pv}$`);function fv(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function D1(t){return new RegExp(`^${fv(t)}$`)}function mv(t){let e=`${pv}T${fv(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function $1(t,e){return!!((e==="v4"||!e)&&I1.test(t)||(e==="v6"||!e)&&C1.test(t))}class Jt extends Ee{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==re.string){const a=this._getOrReturnCtx(e);return te(a,{code:Z.invalid_type,expected:re.string,received:a.parsedType}),ge}const r=new lt;let n;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),te(n,{code:Z.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),te(n,{code:Z.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const o=e.data.length>a.value,i=e.data.length<a.value;(o||i)&&(n=this._getOrReturnCtx(e,n),o?te(n,{code:Z.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):i&&te(n,{code:Z.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")P1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"email",code:Z.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(O1,"u")),qd.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"emoji",code:Z.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")R1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"uuid",code:Z.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")F1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"nanoid",code:Z.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")T1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"cuid",code:Z.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")A1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"cuid2",code:Z.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")M1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"ulid",code:Z.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),te(n,{validation:"url",code:Z.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"regex",code:Z.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),te(n,{code:Z.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),te(n,{code:Z.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),te(n,{code:Z.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?mv(a).test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{code:Z.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?L1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{code:Z.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?D1(a).test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{code:Z.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?N1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"duration",code:Z.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?$1(e.data,a.version)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"ip",code:Z.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?j1.test(e.data)||(n=this._getOrReturnCtx(e,n),te(n,{validation:"base64",code:Z.invalid_string,message:a.message}),r.dirty()):Fe.assertNever(a);return{status:r.value,value:e.data}}_regex(e,r,n){return this.refinement(a=>e.test(a),{validation:r,code:Z.invalid_string,...de.errToObj(n)})}_addCheck(e){return new Jt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...de.errToObj(e)})}url(e){return this._addCheck({kind:"url",...de.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...de.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...de.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...de.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...de.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...de.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...de.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...de.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...de.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(r=e==null?void 0:e.offset)!==null&&r!==void 0?r:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...de.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...de.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...de.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...de.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...de.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...de.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...de.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...de.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...de.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...de.errToObj(r)})}nonempty(e){return this.min(1,de.errToObj(e))}trim(){return new Jt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Jt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Jt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Jt.create=t=>{var e;return new Jt({checks:[],typeName:K.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...we(t)})};function U1(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=r>n?r:n,o=parseInt(t.toFixed(a).replace(".","")),i=parseInt(e.toFixed(a).replace(".",""));return o%i/Math.pow(10,a)}class tn extends Ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==re.number){const a=this._getOrReturnCtx(e);return te(a,{code:Z.invalid_type,expected:re.number,received:a.parsedType}),ge}let r;const n=new lt;for(const a of this._def.checks)a.kind==="int"?Fe.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),te(r,{code:Z.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),te(r,{code:Z.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),te(r,{code:Z.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?U1(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),te(r,{code:Z.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),te(r,{code:Z.not_finite,message:a.message}),n.dirty()):Fe.assertNever(a);return{status:n.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,de.toString(r))}gt(e,r){return this.setLimit("min",e,!1,de.toString(r))}lte(e,r){return this.setLimit("max",e,!0,de.toString(r))}lt(e,r){return this.setLimit("max",e,!1,de.toString(r))}setLimit(e,r,n,a){return new tn({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:de.toString(a)}]})}_addCheck(e){return new tn({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:de.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:de.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:de.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:de.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:de.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:de.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:de.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:de.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:de.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Fe.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}}tn.create=t=>new tn({checks:[],typeName:K.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...we(t)});class rn extends Ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==re.bigint){const a=this._getOrReturnCtx(e);return te(a,{code:Z.invalid_type,expected:re.bigint,received:a.parsedType}),ge}let r;const n=new lt;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),te(r,{code:Z.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),te(r,{code:Z.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),te(r,{code:Z.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):Fe.assertNever(a);return{status:n.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,de.toString(r))}gt(e,r){return this.setLimit("min",e,!1,de.toString(r))}lte(e,r){return this.setLimit("max",e,!0,de.toString(r))}lt(e,r){return this.setLimit("max",e,!1,de.toString(r))}setLimit(e,r,n,a){return new rn({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:de.toString(a)}]})}_addCheck(e){return new rn({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:de.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:de.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:de.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:de.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:de.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}rn.create=t=>{var e;return new rn({checks:[],typeName:K.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...we(t)})};class Do extends Ee{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==re.boolean){const r=this._getOrReturnCtx(e);return te(r,{code:Z.invalid_type,expected:re.boolean,received:r.parsedType}),ge}return dt(e.data)}}Do.create=t=>new Do({typeName:K.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...we(t)});class In extends Ee{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==re.date){const a=this._getOrReturnCtx(e);return te(a,{code:Z.invalid_type,expected:re.date,received:a.parsedType}),ge}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return te(a,{code:Z.invalid_date}),ge}const r=new lt;let n;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),te(n,{code:Z.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),te(n,{code:Z.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Fe.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new In({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:de.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:de.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}In.create=t=>new In({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:K.ZodDate,...we(t)});class $s extends Ee{_parse(e){if(this._getType(e)!==re.symbol){const r=this._getOrReturnCtx(e);return te(r,{code:Z.invalid_type,expected:re.symbol,received:r.parsedType}),ge}return dt(e.data)}}$s.create=t=>new $s({typeName:K.ZodSymbol,...we(t)});class $o extends Ee{_parse(e){if(this._getType(e)!==re.undefined){const r=this._getOrReturnCtx(e);return te(r,{code:Z.invalid_type,expected:re.undefined,received:r.parsedType}),ge}return dt(e.data)}}$o.create=t=>new $o({typeName:K.ZodUndefined,...we(t)});class Uo extends Ee{_parse(e){if(this._getType(e)!==re.null){const r=this._getOrReturnCtx(e);return te(r,{code:Z.invalid_type,expected:re.null,received:r.parsedType}),ge}return dt(e.data)}}Uo.create=t=>new Uo({typeName:K.ZodNull,...we(t)});class Sa extends Ee{constructor(){super(...arguments),this._any=!0}_parse(e){return dt(e.data)}}Sa.create=t=>new Sa({typeName:K.ZodAny,...we(t)});class Cn extends Ee{constructor(){super(...arguments),this._unknown=!0}_parse(e){return dt(e.data)}}Cn.create=t=>new Cn({typeName:K.ZodUnknown,...we(t)});class Cr extends Ee{_parse(e){const r=this._getOrReturnCtx(e);return te(r,{code:Z.invalid_type,expected:re.never,received:r.parsedType}),ge}}Cr.create=t=>new Cr({typeName:K.ZodNever,...we(t)});class Us extends Ee{_parse(e){if(this._getType(e)!==re.undefined){const r=this._getOrReturnCtx(e);return te(r,{code:Z.invalid_type,expected:re.void,received:r.parsedType}),ge}return dt(e.data)}}Us.create=t=>new Us({typeName:K.ZodVoid,...we(t)});class Kt extends Ee{_parse(e){const{ctx:r,status:n}=this._processInputParams(e),a=this._def;if(r.parsedType!==re.array)return te(r,{code:Z.invalid_type,expected:re.array,received:r.parsedType}),ge;if(a.exactLength!==null){const i=r.data.length>a.exactLength.value,s=r.data.length<a.exactLength.value;(i||s)&&(te(r,{code:i?Z.too_big:Z.too_small,minimum:s?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&r.data.length<a.minLength.value&&(te(r,{code:Z.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(te(r,{code:Z.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,s)=>a.type._parseAsync(new vr(r,i,r.path,s)))).then(i=>lt.mergeArray(n,i));const o=[...r.data].map((i,s)=>a.type._parseSync(new vr(r,i,r.path,s)));return lt.mergeArray(n,o)}get element(){return this._def.type}min(e,r){return new Kt({...this._def,minLength:{value:e,message:de.toString(r)}})}max(e,r){return new Kt({...this._def,maxLength:{value:e,message:de.toString(r)}})}length(e,r){return new Kt({...this._def,exactLength:{value:e,message:de.toString(r)}})}nonempty(e){return this.min(1,e)}}Kt.create=(t,e)=>new Kt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:K.ZodArray,...we(e)});function xa(t){if(t instanceof Ve){const e={};for(const r in t.shape){const n=t.shape[r];e[r]=zt.create(xa(n))}return new Ve({...t._def,shape:()=>e})}else return t instanceof Kt?new Kt({...t._def,type:xa(t.element)}):t instanceof zt?zt.create(xa(t.unwrap())):t instanceof on?on.create(xa(t.unwrap())):t instanceof _r?_r.create(t.items.map(e=>xa(e))):t}class Ve extends Ee{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=Fe.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==re.object){const l=this._getOrReturnCtx(e);return te(l,{code:Z.invalid_type,expected:re.object,received:l.parsedType}),ge}const{status:r,ctx:n}=this._processInputParams(e),{shape:a,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof Cr&&this._def.unknownKeys==="strip"))for(const l in n.data)o.includes(l)||i.push(l);const s=[];for(const l of o){const c=a[l],d=n.data[l];s.push({key:{status:"valid",value:l},value:c._parse(new vr(n,d,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof Cr){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of i)s.push({key:{status:"valid",value:c},value:{status:"valid",value:n.data[c]}});else if(l==="strict")i.length>0&&(te(n,{code:Z.unrecognized_keys,keys:i}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of i){const d=n.data[c];s.push({key:{status:"valid",value:c},value:l._parse(new vr(n,d,n.path,c)),alwaysSet:c in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of s){const d=await c.key,u=await c.value;l.push({key:d,value:u,alwaysSet:c.alwaysSet})}return l}).then(l=>lt.mergeObjectSync(r,l)):lt.mergeObjectSync(r,s)}get shape(){return this._def.shape()}strict(e){return de.errToObj,new Ve({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var a,o,i,s;const l=(i=(o=(a=this._def).errorMap)===null||o===void 0?void 0:o.call(a,r,n).message)!==null&&i!==void 0?i:n.defaultError;return r.code==="unrecognized_keys"?{message:(s=de.errToObj(e).message)!==null&&s!==void 0?s:l}:{message:l}}}:{}})}strip(){return new Ve({...this._def,unknownKeys:"strip"})}passthrough(){return new Ve({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ve({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ve({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:K.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new Ve({...this._def,catchall:e})}pick(e){const r={};return Fe.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new Ve({...this._def,shape:()=>r})}omit(e){const r={};return Fe.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new Ve({...this._def,shape:()=>r})}deepPartial(){return xa(this)}partial(e){const r={};return Fe.objectKeys(this.shape).forEach(n=>{const a=this.shape[n];e&&!e[n]?r[n]=a:r[n]=a.optional()}),new Ve({...this._def,shape:()=>r})}required(e){const r={};return Fe.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof zt;)a=a._def.innerType;r[n]=a}}),new Ve({...this._def,shape:()=>r})}keyof(){return gv(Fe.objectKeys(this.shape))}}Ve.create=(t,e)=>new Ve({shape:()=>t,unknownKeys:"strip",catchall:Cr.create(),typeName:K.ZodObject,...we(e)}),Ve.strictCreate=(t,e)=>new Ve({shape:()=>t,unknownKeys:"strict",catchall:Cr.create(),typeName:K.ZodObject,...we(e)}),Ve.lazycreate=(t,e)=>new Ve({shape:t,unknownKeys:"strip",catchall:Cr.create(),typeName:K.ZodObject,...we(e)});class zo extends Ee{_parse(e){const{ctx:r}=this._processInputParams(e),n=this._def.options;function a(o){for(const s of o)if(s.result.status==="valid")return s.result;for(const s of o)if(s.result.status==="dirty")return r.common.issues.push(...s.ctx.common.issues),s.result;const i=o.map(s=>new Tt(s.ctx.common.issues));return te(r,{code:Z.invalid_union,unionErrors:i}),ge}if(r.common.async)return Promise.all(n.map(async o=>{const i={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(a);{let o;const i=[];for(const l of n){const c={...r,common:{...r.common,issues:[]},parent:null},d=l._parseSync({data:r.data,path:r.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!o&&(o={result:d,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;const s=i.map(l=>new Tt(l));return te(r,{code:Z.invalid_union,unionErrors:s}),ge}}get options(){return this._def.options}}zo.create=(t,e)=>new zo({options:t,typeName:K.ZodUnion,...we(e)});const nn=t=>t instanceof Wo?nn(t.schema):t instanceof Yt?nn(t.innerType()):t instanceof Go?[t.value]:t instanceof an?t.options:t instanceof Vo?Fe.objectValues(t.enum):t instanceof qo?nn(t._def.innerType):t instanceof $o?[void 0]:t instanceof Uo?[null]:t instanceof zt?[void 0,...nn(t.unwrap())]:t instanceof on?[null,...nn(t.unwrap())]:t instanceof Jd||t instanceof Ko?nn(t.unwrap()):t instanceof Zo?nn(t._def.innerType):[];class zs extends Ee{_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==re.object)return te(r,{code:Z.invalid_type,expected:re.object,received:r.parsedType}),ge;const n=this.discriminator,a=r.data[n],o=this.optionsMap.get(a);return o?r.common.async?o._parseAsync({data:r.data,path:r.path,parent:r}):o._parseSync({data:r.data,path:r.path,parent:r}):(te(r,{code:Z.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ge)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){const a=new Map;for(const o of r){const i=nn(o.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of i){if(a.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,o)}}return new zs({typeName:K.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:a,...we(n)})}}function Zd(t,e){const r=en(t),n=en(e);if(t===e)return{valid:!0,data:t};if(r===re.object&&n===re.object){const a=Fe.objectKeys(e),o=Fe.objectKeys(t).filter(s=>a.indexOf(s)!==-1),i={...t,...e};for(const s of o){const l=Zd(t[s],e[s]);if(!l.valid)return{valid:!1};i[s]=l.data}return{valid:!0,data:i}}else if(r===re.array&&n===re.array){if(t.length!==e.length)return{valid:!1};const a=[];for(let o=0;o<t.length;o++){const i=t[o],s=e[o],l=Zd(i,s);if(!l.valid)return{valid:!1};a.push(l.data)}return{valid:!0,data:a}}else return r===re.date&&n===re.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Bo extends Ee{_parse(e){const{status:r,ctx:n}=this._processInputParams(e),a=(o,i)=>{if(Gd(o)||Gd(i))return ge;const s=Zd(o.value,i.value);return s.valid?((Vd(o)||Vd(i))&&r.dirty(),{status:r.value,value:s.data}):(te(n,{code:Z.invalid_intersection_types}),ge)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,i])=>a(o,i)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Bo.create=(t,e,r)=>new Bo({left:t,right:e,typeName:K.ZodIntersection,...we(r)});class _r extends Ee{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==re.array)return te(n,{code:Z.invalid_type,expected:re.array,received:n.parsedType}),ge;if(n.data.length<this._def.items.length)return te(n,{code:Z.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ge;!this._def.rest&&n.data.length>this._def.items.length&&(te(n,{code:Z.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const a=[...n.data].map((o,i)=>{const s=this._def.items[i]||this._def.rest;return s?s._parse(new vr(n,o,n.path,i)):null}).filter(o=>!!o);return n.common.async?Promise.all(a).then(o=>lt.mergeArray(r,o)):lt.mergeArray(r,a)}get items(){return this._def.items}rest(e){return new _r({...this._def,rest:e})}}_r.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new _r({items:t,typeName:K.ZodTuple,rest:null,...we(e)})};class Ho extends Ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==re.object)return te(n,{code:Z.invalid_type,expected:re.object,received:n.parsedType}),ge;const a=[],o=this._def.keyType,i=this._def.valueType;for(const s in n.data)a.push({key:o._parse(new vr(n,s,n.path,s)),value:i._parse(new vr(n,n.data[s],n.path,s)),alwaysSet:s in n.data});return n.common.async?lt.mergeObjectAsync(r,a):lt.mergeObjectSync(r,a)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof Ee?new Ho({keyType:e,valueType:r,typeName:K.ZodRecord,...we(n)}):new Ho({keyType:Jt.create(),valueType:e,typeName:K.ZodRecord,...we(r)})}}class Bs extends Ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==re.map)return te(n,{code:Z.invalid_type,expected:re.map,received:n.parsedType}),ge;const a=this._def.keyType,o=this._def.valueType,i=[...n.data.entries()].map(([s,l],c)=>({key:a._parse(new vr(n,s,n.path,[c,"key"])),value:o._parse(new vr(n,l,n.path,[c,"value"]))}));if(n.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const l of i){const c=await l.key,d=await l.value;if(c.status==="aborted"||d.status==="aborted")return ge;(c.status==="dirty"||d.status==="dirty")&&r.dirty(),s.set(c.value,d.value)}return{status:r.value,value:s}})}else{const s=new Map;for(const l of i){const c=l.key,d=l.value;if(c.status==="aborted"||d.status==="aborted")return ge;(c.status==="dirty"||d.status==="dirty")&&r.dirty(),s.set(c.value,d.value)}return{status:r.value,value:s}}}}Bs.create=(t,e,r)=>new Bs({valueType:e,keyType:t,typeName:K.ZodMap,...we(r)});class jn extends Ee{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==re.set)return te(n,{code:Z.invalid_type,expected:re.set,received:n.parsedType}),ge;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(te(n,{code:Z.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(te(n,{code:Z.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),r.dirty());const o=this._def.valueType;function i(l){const c=new Set;for(const d of l){if(d.status==="aborted")return ge;d.status==="dirty"&&r.dirty(),c.add(d.value)}return{status:r.value,value:c}}const s=[...n.data.values()].map((l,c)=>o._parse(new vr(n,l,n.path,c)));return n.common.async?Promise.all(s).then(l=>i(l)):i(s)}min(e,r){return new jn({...this._def,minSize:{value:e,message:de.toString(r)}})}max(e,r){return new jn({...this._def,maxSize:{value:e,message:de.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}jn.create=(t,e)=>new jn({valueType:t,minSize:null,maxSize:null,typeName:K.ZodSet,...we(e)});class ka extends Ee{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==re.function)return te(r,{code:Z.invalid_type,expected:re.function,received:r.parsedType}),ge;function n(s,l){return js({data:s,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Cs(),Ea].filter(c=>!!c),issueData:{code:Z.invalid_arguments,argumentsError:l}})}function a(s,l){return js({data:s,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Cs(),Ea].filter(c=>!!c),issueData:{code:Z.invalid_return_type,returnTypeError:l}})}const o={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof Ta){const s=this;return dt(async function(...l){const c=new Tt([]),d=await s._def.args.parseAsync(l,o).catch(h=>{throw c.addIssue(n(l,h)),c}),u=await Reflect.apply(i,this,d);return await s._def.returns._def.type.parseAsync(u,o).catch(h=>{throw c.addIssue(a(u,h)),c})})}else{const s=this;return dt(function(...l){const c=s._def.args.safeParse(l,o);if(!c.success)throw new Tt([n(l,c.error)]);const d=Reflect.apply(i,this,c.data),u=s._def.returns.safeParse(d,o);if(!u.success)throw new Tt([a(d,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ka({...this._def,args:_r.create(e).rest(Cn.create())})}returns(e){return new ka({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new ka({args:e||_r.create([]).rest(Cn.create()),returns:r||Cn.create(),typeName:K.ZodFunction,...we(n)})}}class Wo extends Ee{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}Wo.create=(t,e)=>new Wo({getter:t,typeName:K.ZodLazy,...we(e)});class Go extends Ee{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return te(r,{received:r.data,code:Z.invalid_literal,expected:this._def.value}),ge}return{status:"valid",value:e.data}}get value(){return this._def.value}}Go.create=(t,e)=>new Go({value:t,typeName:K.ZodLiteral,...we(e)});function gv(t,e){return new an({values:t,typeName:K.ZodEnum,...we(e)})}class an extends Ee{constructor(){super(...arguments),jo.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),n=this._def.values;return te(r,{expected:Fe.joinValues(n),received:r.parsedType,code:Z.invalid_type}),ge}if(Ds(this,jo)||uv(this,jo,new Set(this._def.values)),!Ds(this,jo).has(e.data)){const r=this._getOrReturnCtx(e),n=this._def.values;return te(r,{received:r.data,code:Z.invalid_enum_value,options:n}),ge}return dt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return an.create(e,{...this._def,...r})}exclude(e,r=this._def){return an.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}}jo=new WeakMap,an.create=gv;class Vo extends Ee{constructor(){super(...arguments),Lo.set(this,void 0)}_parse(e){const r=Fe.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==re.string&&n.parsedType!==re.number){const a=Fe.objectValues(r);return te(n,{expected:Fe.joinValues(a),received:n.parsedType,code:Z.invalid_type}),ge}if(Ds(this,Lo)||uv(this,Lo,new Set(Fe.getValidEnumValues(this._def.values))),!Ds(this,Lo).has(e.data)){const a=Fe.objectValues(r);return te(n,{received:n.data,code:Z.invalid_enum_value,options:a}),ge}return dt(e.data)}get enum(){return this._def.values}}Lo=new WeakMap,Vo.create=(t,e)=>new Vo({values:t,typeName:K.ZodNativeEnum,...we(e)});class Ta extends Ee{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==re.promise&&r.common.async===!1)return te(r,{code:Z.invalid_type,expected:re.promise,received:r.parsedType}),ge;const n=r.parsedType===re.promise?r.data:Promise.resolve(r.data);return dt(n.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}}Ta.create=(t,e)=>new Ta({type:t,typeName:K.ZodPromise,...we(e)});class Yt extends Ee{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===K.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:n}=this._processInputParams(e),a=this._def.effect||null,o={addIssue:i=>{te(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),a.type==="preprocess"){const i=a.transform(n.data,o);if(n.common.async)return Promise.resolve(i).then(async s=>{if(r.value==="aborted")return ge;const l=await this._def.schema._parseAsync({data:s,path:n.path,parent:n});return l.status==="aborted"?ge:l.status==="dirty"||r.value==="dirty"?Ls(l.value):l});{if(r.value==="aborted")return ge;const s=this._def.schema._parseSync({data:i,path:n.path,parent:n});return s.status==="aborted"?ge:s.status==="dirty"||r.value==="dirty"?Ls(s.value):s}}if(a.type==="refinement"){const i=s=>{const l=a.refinement(s,o);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(n.common.async===!1){const s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ge:(s.status==="dirty"&&r.dirty(),i(s.value),{status:r.value,value:s.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>s.status==="aborted"?ge:(s.status==="dirty"&&r.dirty(),i(s.value).then(()=>({status:r.value,value:s.value}))))}if(a.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Io(i))return i;const s=a.transform(i.value,o);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:s}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Io(i)?Promise.resolve(a.transform(i.value,o)).then(s=>({status:r.value,value:s})):i);Fe.assertNever(a)}}Yt.create=(t,e,r)=>new Yt({schema:t,typeName:K.ZodEffects,effect:e,...we(r)}),Yt.createWithPreprocess=(t,e,r)=>new Yt({schema:e,effect:{type:"preprocess",transform:t},typeName:K.ZodEffects,...we(r)}),zt=class extends Ee{_parse(t){return this._getType(t)===re.undefined?dt(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}},zt.create=(t,e)=>new zt({innerType:t,typeName:K.ZodOptional,...we(e)});class on extends Ee{_parse(e){return this._getType(e)===re.null?dt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}on.create=(t,e)=>new on({innerType:t,typeName:K.ZodNullable,...we(e)});class qo extends Ee{_parse(e){const{ctx:r}=this._processInputParams(e);let n=r.data;return r.parsedType===re.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}qo.create=(t,e)=>new qo({innerType:t,typeName:K.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...we(e)});class Zo extends Ee{_parse(e){const{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Co(a)?a.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Tt(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Tt(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Zo.create=(t,e)=>new Zo({innerType:t,typeName:K.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...we(e)});class Hs extends Ee{_parse(e){if(this._getType(e)!==re.nan){const r=this._getOrReturnCtx(e);return te(r,{code:Z.invalid_type,expected:re.nan,received:r.parsedType}),ge}return{status:"valid",value:e.data}}}Hs.create=t=>new Hs({typeName:K.ZodNaN,...we(t)});const z1=Symbol("zod_brand");class Jd extends Ee{_parse(e){const{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class Jo extends Ee{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ge:a.status==="dirty"?(r.dirty(),Ls(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ge:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,r){return new Jo({in:e,out:r,typeName:K.ZodPipeline})}}class Ko extends Ee{_parse(e){const r=this._def.innerType._parse(e),n=a=>(Io(a)&&(a.value=Object.freeze(a.value)),a);return Co(r)?r.then(a=>n(a)):n(r)}unwrap(){return this._def.innerType}}Ko.create=(t,e)=>new Ko({innerType:t,typeName:K.ZodReadonly,...we(e)});function yv(t,e={},r){return t?Sa.create().superRefine((n,a)=>{var o,i;if(!t(n)){const s=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,l=(i=(o=s.fatal)!==null&&o!==void 0?o:r)!==null&&i!==void 0?i:!0,c=typeof s=="string"?{message:s}:s;a.addIssue({code:"custom",...c,fatal:l})}}):Sa.create()}const B1={object:Ve.lazycreate};(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(K||(K={}));const H1=(t,e={message:`Input not instance of ${t.name}`})=>yv(r=>r instanceof t,e),vv=Jt.create,_v=tn.create,W1=Hs.create,G1=rn.create,wv=Do.create,V1=In.create,q1=$s.create,Z1=$o.create,J1=Uo.create,K1=Sa.create,Y1=Cn.create,X1=Cr.create,Q1=Us.create,eT=Kt.create,tT=Ve.create,rT=Ve.strictCreate,nT=zo.create,aT=zs.create,oT=Bo.create,iT=_r.create,sT=Ho.create,lT=Bs.create,cT=jn.create,dT=ka.create,uT=Wo.create,hT=Go.create,pT=an.create,fT=Vo.create,mT=Ta.create,bv=Yt.create,gT=zt.create,yT=on.create,vT=Yt.createWithPreprocess,_T=Jo.create,wT=()=>vv().optional(),bT=()=>_v().optional(),ET=()=>wv().optional(),ST={string:t=>Jt.create({...t,coerce:!0}),number:t=>tn.create({...t,coerce:!0}),boolean:t=>Do.create({...t,coerce:!0}),bigint:t=>rn.create({...t,coerce:!0}),date:t=>In.create({...t,coerce:!0})},xT=ge;let Aa,Kd,Yd,Ev;ra=Object.freeze({__proto__:null,defaultErrorMap:Ea,setErrorMap:x1,getErrorMap:Cs,makeIssue:js,EMPTY_PATH:k1,addIssueToContext:te,ParseStatus:lt,INVALID:ge,DIRTY:Ls,OK:dt,isAborted:Gd,isDirty:Vd,isValid:Io,isAsync:Co,get util(){return Fe},get objectUtil(){return Wd},ZodParsedType:re,getParsedType:en,ZodType:Ee,datetimeRegex:mv,ZodString:Jt,ZodNumber:tn,ZodBigInt:rn,ZodBoolean:Do,ZodDate:In,ZodSymbol:$s,ZodUndefined:$o,ZodNull:Uo,ZodAny:Sa,ZodUnknown:Cn,ZodNever:Cr,ZodVoid:Us,ZodArray:Kt,ZodObject:Ve,ZodUnion:zo,ZodDiscriminatedUnion:zs,ZodIntersection:Bo,ZodTuple:_r,ZodRecord:Ho,ZodMap:Bs,ZodSet:jn,ZodFunction:ka,ZodLazy:Wo,ZodLiteral:Go,ZodEnum:an,ZodNativeEnum:Vo,ZodPromise:Ta,ZodEffects:Yt,ZodTransformer:Yt,ZodOptional:zt,ZodNullable:on,ZodDefault:qo,ZodCatch:Zo,ZodNaN:Hs,BRAND:z1,ZodBranded:Jd,ZodPipeline:Jo,ZodReadonly:Ko,custom:yv,Schema:Ee,ZodSchema:Ee,late:B1,get ZodFirstPartyTypeKind(){return K},coerce:ST,any:K1,array:eT,bigint:G1,boolean:wv,date:V1,discriminatedUnion:aT,effect:bv,enum:pT,function:dT,instanceof:H1,intersection:oT,lazy:uT,literal:hT,map:lT,nan:W1,nativeEnum:fT,never:X1,null:J1,nullable:yT,number:_v,object:tT,oboolean:ET,onumber:bT,optional:gT,ostring:wT,pipeline:_T,preprocess:vT,promise:mT,record:sT,set:cT,strictObject:rT,string:vv,symbol:q1,transformer:bv,tuple:iT,undefined:Z1,union:nT,unknown:Y1,void:Q1,NEVER:xT,ZodIssueCode:Z,quotelessJson:S1,ZodError:Tt}),Aa={exports:{}},Kd={};function kT(){if(Ev)return Yd;Ev=1;function t(e,r){typeof r=="boolean"&&(r={forever:r}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=r||{},this._maxRetryTime=r&&r.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Yd=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var r=new Date().getTime();if(e&&r-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,r){this._fn=e,r&&(r.timeout&&(this._operationTimeout=r.timeout),r.cb&&(this._operationTimeoutCb=r.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},r=null,n=0,a=0;a<this._errors.length;a++){var o=this._errors[a],i=o.message,s=(e[i]||0)+1;e[i]=s,s>=n&&(r=o,n=s)}return r},Yd}var Sv;function TT(){return Sv||(Sv=1,function(t){var e=kT();t.operation=function(r){var n=t.timeouts(r);return new e(n,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},t.timeouts=function(r){if(r instanceof Array)return[].concat(r);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in r)n[a]=r[a];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],i=0;i<n.retries;i++)o.push(this.createTimeout(i,n));return r&&r.forever&&!o.length&&o.push(this.createTimeout(i,n)),o.sort(function(s,l){return s-l}),o},t.createTimeout=function(r,n){var a=n.randomize?Math.random()+1:1,o=Math.round(a*Math.max(n.minTimeout,1)*Math.pow(n.factor,r));return o=Math.min(o,n.maxTimeout),o},t.wrap=function(r,n,a){if(n instanceof Array&&(a=n,n=null),!a){a=[];for(var o in r)typeof r[o]=="function"&&a.push(o)}for(var i=0;i<a.length;i++){var s=a[i],l=r[s];r[s]=(function(c){var d=t.operation(n),u=Array.prototype.slice.call(arguments,1),h=u.pop();u.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),h.apply(this,arguments))}),d.attempt(function(){c.apply(r,u)})}).bind(r,l),r[s].options=n}}}(Kd)),Kd}var xv,kv;function AT(){return kv||(kv=1,xv=TT()),xv}var Tv;function MT(){if(Tv)return Aa.exports;Tv=1;const t=AT(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class r extends Error{constructor(s){super(),s instanceof Error?(this.originalError=s,{message:s}=s):(this.originalError=new Error(s),this.originalError.stack=this.stack),this.name="AbortError",this.message=s}}const n=(i,s,l)=>{const c=l.retries-(s-1);return i.attemptNumber=s,i.retriesLeft=c,i},a=i=>e.includes(i),o=(i,s)=>new Promise((l,c)=>{s={onFailedAttempt:()=>{},retries:10,...s};const d=t.operation(s);d.attempt(async u=>{try{l(await i(u))}catch(h){if(!(h instanceof Error)){c(new TypeError(`Non-error was thrown: "${h}". You should only throw errors.`));return}if(h instanceof r)d.stop(),c(h.originalError);else if(h instanceof TypeError&&!a(h.message))d.stop(),c(h);else{n(h,u,s);try{await s.onFailedAttempt(h)}catch(p){c(p);return}d.retry(h)||c(d.mainError())}}})});return Aa.exports=o,Aa.exports.default=o,Aa.exports.AbortError=r,Aa.exports}var RT=MT();const Ws=Xa(RT),FT=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Gs(t){return typeof t=="string"&&FT.test(t)}for(var st=[],Xd=0;Xd<256;++Xd)st.push((Xd+256).toString(16).slice(1));function NT(t,e=0){return(st[t[e+0]]+st[t[e+1]]+st[t[e+2]]+st[t[e+3]]+"-"+st[t[e+4]]+st[t[e+5]]+"-"+st[t[e+6]]+st[t[e+7]]+"-"+st[t[e+8]]+st[t[e+9]]+"-"+st[t[e+10]]+st[t[e+11]]+st[t[e+12]]+st[t[e+13]]+st[t[e+14]]+st[t[e+15]]).toLowerCase()}var Vs,PT=new Uint8Array(16);function OT(){if(!Vs&&(Vs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Vs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Vs(PT)}var IT=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Av={randomUUID:IT};function At(t,e,r){if(Av.randomUUID&&!e&&!t)return Av.randomUUID();t=t||{};var n=t.random||(t.rng||OT)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,NT(n)}let CT=class{getStore(){}run(t,e){return e()}};const Qd=Symbol.for("ls:tracing_async_local_storage"),jT=new CT;let LT=class{getInstance(){return globalThis[Qd]??jT}initializeGlobalInstance(t){globalThis[Qd]===void 0&&(globalThis[Qd]=t)}};const DT=new LT,$T=()=>{const t=DT.getInstance().getStore();if(t===void 0)throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return t};function eu(t){return typeof t=="function"&&"langsmith:traceable"in t}const UT=Object.prototype.hasOwnProperty;Cp=function(t,e){return UT.call(t,e)},Ip=function(t){if(Array.isArray(t)){const r=new Array(t.length);for(let n=0;n<r.length;n++)r[n]=""+n;return r}if(Object.keys)return Object.keys(t);let e=[];for(let r in t)Cp(t,r)&&e.push(r);return e},wn=function(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}};function tu(t){let e=0;const r=t.length;let n;for(;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}jb=function(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")};function zT(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function ru(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(ru(t[r]))return!0}else if(typeof t=="object"){const r=Ip(t),n=r.length;for(var e=0;e<n;e++)if(ru(t[r[e]]))return!0}}return!1}function Mv(t,e){const r=[t];for(const n in e){const a=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof a<"u"&&r.push(`${n}: ${a}`)}return r.join(`
`)}class BT extends Error{constructor(e,r,n,a,o){super(Mv(e,{name:r,index:n,operation:a,tree:o})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.setPrototypeOf(this,new.target.prototype),this.message=Mv(e,{name:r,index:n,operation:a,tree:o})}}const Qe=BT,Ma={add:function(t,e,r){return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){let n=nu(r,this.path);n&&(n=wn(n));const a=Yo(r,{op:"remove",path:this.from}).removed;return Yo(r,{op:"add",path:this.path,value:a}),{newDocument:r,removed:n}},copy:function(t,e,r){const n=nu(r,this.from);return Yo(r,{op:"add",path:this.path,value:wn(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:Zs(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}};var HT={add:function(t,e,r){return tu(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:Ma.move,copy:Ma.copy,test:Ma.test,_get:Ma._get};function nu(t,e){if(e=="")return t;var r={op:"_get",path:e};return Yo(t,r),r.value}function Yo(t,e,r=!1,n=!0,a=!0,o=0){if(r&&(typeof r=="function"?r(e,0,t,e.path):au(e,0)),e.path===""){let i={newDocument:t};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=t,i;if(e.op==="move"||e.op==="copy")return i.newDocument=nu(t,e.from),e.op==="move"&&(i.removed=t),i;if(e.op==="test"){if(i.test=Zs(t,e.value),i.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return i.newDocument=t,i}else{if(e.op==="remove")return i.removed=t,i.newDocument=null,i;if(e.op==="_get")return e.value=t,i;if(r)throw new Qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return i}}else{n||(t=wn(t));const i=(e.path||"").split("/");let s=t,l=1,c=i.length,d,u,h;for(typeof r=="function"?h=r:h=au;;){if(u=i[l],u&&u.indexOf("~")!=-1&&(u=zT(u)),a&&(u=="__proto__"||u=="prototype"&&l>0&&i[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(s[u]===void 0?d=i.slice(0,l).join("/"):l==c-1&&(d=e.path),d!==void 0&&h(e,0,t,d)),l++,Array.isArray(s)){if(u==="-")u=s.length;else{if(r&&!tu(u))throw new Qe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);tu(u)&&(u=~~u)}if(l>=c){if(r&&e.op==="add"&&u>s.length)throw new Qe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);const p=HT[e.op].call(e,s,u,t);if(p.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return p}}else if(l>=c){const p=Ma[e.op].call(e,s,u,t);if(p.test===!1)throw new Qe("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return p}if(s=s[u],r&&l<c&&(!s||typeof s!="object"))throw new Qe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,e,t)}}}function qs(t,e,r,n=!0,a=!0){if(r&&!Array.isArray(e))throw new Qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=wn(t));const o=new Array(e.length);for(let i=0,s=e.length;i<s;i++)o[i]=Yo(t,e[i],r,!0,a,i),t=o[i].newDocument;return o.newDocument=t,o}function au(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new Qe("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(Ma[t.op]){if(typeof t.path!="string")throw new Qe("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Qe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Qe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&ru(t.value))throw new Qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var a=t.path.split("/").length,o=n.split("/").length;if(a!==o+1&&a!==o)throw new Qe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new Qe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var i={op:"_get",path:t.from,value:void 0},s=WT([i],r);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new Qe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new Qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function WT(t,e,r){try{if(!Array.isArray(t))throw new Qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)qs(wn(e),wn(t),r||!0);else{r=r||au;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(a){if(a instanceof Qe)return a;throw a}}function Zs(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),a,o,i;if(r&&n){if(o=t.length,o!=e.length)return!1;for(a=o;a--!==0;)if(!Zs(t[a],e[a]))return!1;return!0}if(r!=n)return!1;var s=Object.keys(t);if(o=s.length,o!==Object.keys(e).length)return!1;for(a=o;a--!==0;)if(!e.hasOwnProperty(s[a]))return!1;for(a=o;a--!==0;)if(i=s[a],!Zs(t[i],e[i]))return!1;return!0}return t!==t&&e!==e}var Rv,Fv;function GT(){return Fv||(Fv=1,Rv=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Rv}var VT=GT();const qT=Xa(VT);var Js={exports:{}},Nv;function ZT(){if(Nv)return Js.exports;Nv=1;const t=/[\p{Lu}]/u,e=/[\p{Ll}]/u,r=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,o=new RegExp("^"+a.source),i=new RegExp(a.source+n.source,"gu"),s=new RegExp("\\d+"+n.source,"gu"),l=(h,p,f)=>{let g=!1,y=!1,E=!1;for(let k=0;k<h.length;k++){const R=h[k];g&&t.test(R)?(h=h.slice(0,k)+"-"+h.slice(k),g=!1,E=y,y=!0,k++):y&&E&&e.test(R)?(h=h.slice(0,k-1)+"-"+h.slice(k-1),E=y,y=!1,g=!0):(g=p(R)===R&&f(R)!==R,E=y,y=f(R)===R&&p(R)!==R)}return h},c=(h,p)=>(r.lastIndex=0,h.replace(r,f=>p(f))),d=(h,p)=>(i.lastIndex=0,s.lastIndex=0,h.replace(i,(f,g)=>p(g)).replace(s,f=>p(f))),u=(h,p)=>{if(!(typeof h=="string"||Array.isArray(h)))throw new TypeError("Expected the input to be `string | string[]`");if(p={pascalCase:!1,preserveConsecutiveUppercase:!1,...p},Array.isArray(h)?h=h.map(y=>y.trim()).filter(y=>y.length).join("-"):h=h.trim(),h.length===0)return"";const f=p.locale===!1?y=>y.toLowerCase():y=>y.toLocaleLowerCase(p.locale),g=p.locale===!1?y=>y.toUpperCase():y=>y.toLocaleUpperCase(p.locale);return h.length===1?p.pascalCase?g(h):f(h):(h!==f(h)&&(h=l(h,f,g)),h=h.replace(o,""),p.preserveConsecutiveUppercase?h=c(h,f):h=f(h),p.pascalCase&&(h=g(h.charAt(0))+h.slice(1)),d(h,g))};return Js.exports=u,Js.exports.default=u,Js.exports}ZT();function JT(t,e){return(e==null?void 0:e[t])||qT(t)}function KT(t,e,r){const n={};for(const a in t)Object.hasOwn(t,a)&&(n[e(a,r)]=t[a]);return n}function Pv(t){return Array.isArray(t)?[...t]:{...t}}function YT(t,e){const r=Pv(t);for(const[n,a]of Object.entries(e)){const[o,...i]=n.split(".").reverse();let s=r;for(const l of i.reverse()){if(s[l]===void 0)break;s[l]=Pv(s[l]),s=s[l]}s[o]!==void 0&&(s[o]={lc:1,type:"secret",id:[a]})}return r}function Ov(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}bn=class{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Ov(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(t,...e){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=t||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof bn||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const t={},e={},r=Object.keys(this.lc_kwargs).reduce((n,a)=>(n[a]=a in this?this[a]:this.lc_kwargs[a],n),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(t,Reflect.get(n,"lc_aliases",this)),Object.assign(e,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));return Object.keys(e).forEach(n=>{let a=this,o=r;const[i,...s]=n.split(".").reverse();for(const l of s.reverse()){if(!(l in a)||a[l]===void 0)return;(!(l in o)||o[l]===void 0)&&(typeof a[l]=="object"&&a[l]!=null?o[l]={}:Array.isArray(a[l])&&(o[l]=[])),a=a[l],o=o[l]}i in a&&a[i]!==void 0&&(o[i]=o[i]||a[i])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:KT(Object.keys(e).length?YT(r,e):r,JT,t)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function XT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Iv={exports:{}},Xe=Iv.exports={},wr,br;function ou(){throw new Error("setTimeout has not been defined")}function iu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?wr=setTimeout:wr=ou}catch{wr=ou}try{typeof clearTimeout=="function"?br=clearTimeout:br=iu}catch{br=iu}})();function Cv(t){if(wr===setTimeout)return setTimeout(t,0);if((wr===ou||!wr)&&setTimeout)return wr=setTimeout,setTimeout(t,0);try{return wr(t,0)}catch{try{return wr.call(null,t,0)}catch{return wr.call(this,t,0)}}}function QT(t){if(br===clearTimeout)return clearTimeout(t);if((br===iu||!br)&&clearTimeout)return br=clearTimeout,clearTimeout(t);try{return br(t)}catch{try{return br.call(null,t)}catch{return br.call(this,t)}}}var jr=[],Ra=!1,Ln,Ks=-1;function eA(){!Ra||!Ln||(Ra=!1,Ln.length?jr=Ln.concat(jr):Ks=-1,jr.length&&jv())}function jv(){if(!Ra){var t=Cv(eA);Ra=!0;for(var e=jr.length;e;){for(Ln=jr,jr=[];++Ks<e;)Ln&&Ln[Ks].run();Ks=-1,e=jr.length}Ln=null,Ra=!1,QT(t)}}Xe.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];jr.push(new Lv(t,e)),jr.length===1&&!Ra&&Cv(jv)};function Lv(t,e){this.fun=t,this.array=e}Lv.prototype.run=function(){this.fun.apply(null,this.array)},Xe.title="browser",Xe.browser=!0,Xe.env={},Xe.argv=[],Xe.version="",Xe.versions={};function Lr(){}Xe.on=Lr,Xe.addListener=Lr,Xe.once=Lr,Xe.off=Lr,Xe.removeListener=Lr,Xe.removeAllListeners=Lr,Xe.emit=Lr,Xe.prependListener=Lr,Xe.prependOnceListener=Lr,Xe.listeners=function(t){return[]},Xe.binding=function(t){throw new Error("process.binding is not supported")},Xe.cwd=function(){return"/"},Xe.chdir=function(t){throw new Error("process.chdir is not supported")},Xe.umask=function(){return 0};var tA=Iv.exports;gt=XT(tA);var su={};const rA=()=>typeof window<"u"&&typeof window.document<"u",nA=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",aA=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Dv=()=>typeof Deno<"u",oA=()=>typeof gt<"u"&&typeof gt.versions<"u"&&typeof gt.versions.node<"u"&&!Dv(),iA=()=>{let t;return rA()?t="browser":oA()?t="node":nA()?t="webworker":aA()?t="jsdom":Dv()?t="deno":t="other",t};let lu;async function sA(){return lu===void 0&&(lu={library:"langchain-js",runtime:iA()}),lu}_n=function(t){try{return typeof gt<"u"?su==null?void 0:su[t]:void 0}catch{return}};class lA{}class Xo extends lA{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Ov(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:_n("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return bn.prototype.toJSON.call(this)}toJSONNotImplemented(){return bn.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class r extends Xo{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:At()}),Object.assign(this,e)}}return new r}}function cu(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function cA(t){return t.replace(/[-:.]/g,"")}function dA(t,e,r){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return cA(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}function Qo(t){return typeof t._addRunToRunMap=="function"}class ei extends Xo{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,r){e.child_runs.push(r)}_addRunToRunMap(e){const r=dA(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const a=this.runMap.get(n.parent_run_id);a&&(this._addChildRun(a,n),a.child_execution_order=Math.max(a.child_execution_order,n.child_execution_order),n.trace_id=a.trace_id,a.dotted_order!==void 0&&(n.dotted_order=[a.dotted_order,r].join(".")))}else n.trace_id=n.id,n.dotted_order=r;return this.runMap.set(n.id,n),n}async _endTrace(e){var n;const r=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);r?r.child_execution_order=Math.max(r.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const r=e!==void 0&&this.runMap.get(e);return r?r.child_execution_order+1:1}_createRunForLLMStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),d=Date.now(),u=s?{...o,metadata:s}:o,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:r},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:i||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,r,n,a,o,i,s,l){var d,u;const c=this.runMap.get(n)??this._createRunForLLMStart(e,r,n,a,o,i,s,l);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((u=this.onLLMStart)==null?void 0:u.call(this,c)),c}_createRunForChatModelStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),d=Date.now(),u=s?{...o,metadata:s}:o,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:r},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:i||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,r,n,a,o,i,s,l){var d,u;const c=this.runMap.get(n)??this._createRunForChatModelStart(e,r,n,a,o,i,s,l);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((u=this.onLLMStart)==null?void 0:u.call(this,c)),c}async handleLLMEnd(e,r){var a;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onLLMEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleLLMError(e,r){var a;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onLLMError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}_createRunForChainStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),d=Date.now(),u={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:r,execution_order:c,child_execution_order:c,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(u)}async handleChainStart(e,r,n,a,o,i,s,l){var d,u;const c=this.runMap.get(n)??this._createRunForChainStart(e,r,n,a,o,i,s,l);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((u=this.onChainStart)==null?void 0:u.call(this,c)),c}async handleChainEnd(e,r,n,a,o){var s;const i=this.runMap.get(r);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=cu(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(i.inputs=cu(o.inputs,"input")),await((s=this.onChainEnd)==null?void 0:s.call(this,i)),await this._endTrace(i),i}async handleChainError(e,r,n,a,o){var s;const i=this.runMap.get(r);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(i.inputs=cu(o.inputs,"input")),await((s=this.onChainError)==null?void 0:s.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,r,n,a,o,i,s){const l=this._getExecutionOrder(a),c=Date.now(),d={id:n,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:r},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(d)}async handleToolStart(e,r,n,a,o,i,s){var c,d;const l=this.runMap.get(n)??this._createRunForToolStart(e,r,n,a,o,i,s);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((d=this.onToolStart)==null?void 0:d.call(this,l)),l}async handleToolEnd(e,r){var a;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleToolError(e,r){var a;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,r){var o;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const a=n;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((o=this.onAgentAction)==null?void 0:o.call(this,n))}async handleAgentEnd(e,r){var a;const n=this.runMap.get(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,n)))}_createRunForRetrieverStart(e,r,n,a,o,i,s){const l=this._getExecutionOrder(a),c=Date.now(),d={id:n,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:r},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(d)}async handleRetrieverStart(e,r,n,a,o,i,s){var c,d;const l=this.runMap.get(n)??this._createRunForRetrieverStart(e,r,n,a,o,i,s);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((d=this.onRetrieverStart)==null?void 0:d.call(this,l)),l}async handleRetrieverEnd(e,r){var a;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,r){var a;const n=this.runMap.get(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleText(e,r){var a;const n=this.runMap.get(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,n)))}async handleLLMNewToken(e,r,n,a,o,i){var l;const s=this.runMap.get(n);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:r,chunk:i==null?void 0:i.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,s,e,{chunk:i==null?void 0:i.chunk})),s}}var Ys={},$v={exports:{}},Uv;function uA(){return Uv||(Uv=1,function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function o(l,c,d,u,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new a(d,u||l,h),f=r?r+c:c;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],p]:l._events[f].push(p):(l._events[f]=p,l._eventsCount++),l}function i(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(r?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},s.prototype.listeners=function(l){var c=r?r+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,h=d.length,p=new Array(h);u<h;u++)p[u]=d[u].fn;return p},s.prototype.listenerCount=function(l){var c=r?r+l:l,d=this._events[c];return d?d.fn?1:d.length:0},s.prototype.emit=function(l,c,d,u,h,p){var f=r?r+l:l;if(!this._events[f])return!1;var g=this._events[f],y=arguments.length,E,k;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,d),!0;case 4:return g.fn.call(g.context,c,d,u),!0;case 5:return g.fn.call(g.context,c,d,u,h),!0;case 6:return g.fn.call(g.context,c,d,u,h,p),!0}for(k=1,E=new Array(y-1);k<y;k++)E[k-1]=arguments[k];g.fn.apply(g.context,E)}else{var R=g.length,O;for(k=0;k<R;k++)switch(g[k].once&&this.removeListener(l,g[k].fn,void 0,!0),y){case 1:g[k].fn.call(g[k].context);break;case 2:g[k].fn.call(g[k].context,c);break;case 3:g[k].fn.call(g[k].context,c,d);break;case 4:g[k].fn.call(g[k].context,c,d,u);break;default:if(!E)for(O=1,E=new Array(y-1);O<y;O++)E[O-1]=arguments[O];g[k].fn.apply(g[k].context,E)}}return!0},s.prototype.on=function(l,c,d){return o(this,l,c,d,!1)},s.prototype.once=function(l,c,d){return o(this,l,c,d,!0)},s.prototype.removeListener=function(l,c,d,u){var h=r?r+l:l;if(!this._events[h])return this;if(!c)return i(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!u||p.once)&&(!d||p.context===d)&&i(this,h);else{for(var f=0,g=[],y=p.length;f<y;f++)(p[f].fn!==c||u&&!p[f].once||d&&p[f].context!==d)&&g.push(p[f]);g.length?this._events[h]=g.length===1?g[0]:g:i(this,h)}return this},s.prototype.removeAllListeners=function(l){var c;return l?(c=r?r+l:l,this._events[c]&&i(this,c)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s}($v)),$v.exports}var ti={exports:{}},zv,Bv;function hA(){return Bv||(Bv=1,zv=(t,e)=>(e=e||(()=>{}),t.then(r=>new Promise(n=>{n(e())}).then(()=>r),r=>new Promise(n=>{n(e())}).then(()=>{throw r})))),zv}var Hv;function pA(){if(Hv)return ti.exports;Hv=1;const t=hA();class e extends Error{constructor(a){super(a),this.name="TimeoutError"}}const r=(n,a,o)=>new Promise((i,s)=>{if(typeof a!="number"||a<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(a===1/0){i(n);return}const l=setTimeout(()=>{if(typeof o=="function"){try{i(o())}catch(u){s(u)}return}const c=typeof o=="string"?o:`Promise timed out after ${a} milliseconds`,d=o instanceof Error?o:new e(c);typeof n.cancel=="function"&&n.cancel(),s(d)},a);t(n.then(i,s),()=>{clearTimeout(l)})});return ti.exports=r,ti.exports.default=r,ti.exports.TimeoutError=e,ti.exports}var Xs={},Qs={},Wv;function fA(){if(Wv)return Qs;Wv=1,Object.defineProperty(Qs,"__esModule",{value:!0});function t(e,r,n){let a=0,o=e.length;for(;o>0;){const i=o/2|0;let s=a+i;n(e[s],r)<=0?(a=++s,o-=i+1):o=i}return a}return Qs.default=t,Qs}var Gv;function mA(){if(Gv)return Xs;Gv=1,Object.defineProperty(Xs,"__esModule",{value:!0});const t=fA();class e{constructor(){this._queue=[]}enqueue(n,a){a=Object.assign({priority:0},a);const o={priority:a.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=a.priority){this._queue.push(o);return}const i=t.default(this._queue,o,(s,l)=>l.priority-s.priority);this._queue.splice(i,0,o)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(a=>a.priority===n.priority).map(a=>a.run)}get size(){return this._queue.length}}return Xs.default=e,Xs}var Vv;function gA(){if(Vv)return Ys;Vv=1,Object.defineProperty(Ys,"__esModule",{value:!0});const t=uA(),e=pA(),r=mA(),n=()=>{},a=new e.TimeoutError;class o extends t{constructor(s){var l,c,d,u;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,s=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:r.default},s),!(typeof s.intervalCap=="number"&&s.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(l=s.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""}\` (${typeof s.intervalCap})`);if(s.interval===void 0||!(Number.isFinite(s.interval)&&s.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(u=(d=s.interval)===null||d===void 0?void 0:d.toString())!==null&&u!==void 0?u:""}\` (${typeof s.interval})`);this._carryoverConcurrencyCount=s.carryoverConcurrencyCount,this._isIntervalIgnored=s.intervalCap===1/0||s.interval===0,this._intervalCap=s.intervalCap,this._interval=s.interval,this._queue=new s.queueClass,this._queueClass=s.queueClass,this.concurrency=s.concurrency,this._timeout=s.timeout,this._throwOnTimeout=s.throwOnTimeout===!0,this._isPaused=s.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const s=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-s;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const s=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),s&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(s){if(!(typeof s=="number"&&s>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${s}\` (${typeof s})`);this._concurrency=s,this._processQueue()}async add(s,l={}){return new Promise((c,d)=>{const u=async()=>{this._pendingCount++,this._intervalCount++;try{const h=this._timeout===void 0&&l.timeout===void 0?s():e.default(Promise.resolve(s()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&d(a)});c(await h)}catch(h){d(h)}this._next()};this._queue.enqueue(u,l),this._tryToStartAnother(),this.emit("add")})}async addAll(s,l){return Promise.all(s.map(async c=>this.add(c,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(s=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),s()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(s=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),s()}})}get size(){return this._queue.size}sizeBy(s){return this._queue.filter(s).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(s){this._timeout=s}}return Ys.default=o,Ys}var yA=gA();const Dr=Xa(yA),vA=(...t)=>fetch(...t),_A=Symbol.for("ls:fetch_implementation"),me=()=>globalThis[_A]??vA,wA=[400,401,403,404,405,406,407,408],bA=[409];let qv=class{constructor(t){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,"default"in Dr?this.queue=new Dr.default({concurrency:this.maxConcurrency}):this.queue=new Dr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=t==null?void 0:t.onFailedResponseHook}call(t,...e){const r=this.onFailedResponseHook;return this.queue.add(()=>Ws(()=>t(...e).catch(n=>{throw n instanceof Error?n:new Error(n)}),{async onFailedAttempt(n){if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.message.startsWith("AbortError")||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const a=n==null?void 0:n.response,o=a==null?void 0:a.status;if(o){if(wA.includes(+o))throw n;if(bA.includes(+o))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){return t.signal?Promise.race([this.call(e,...r),new Promise((n,a)=>{var o;(o=t.signal)==null||o.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(e,...r)}fetch(...t){return this.call(()=>me()(...t).then(e=>e.ok?e:Promise.reject(e)))}};function Zv(t){return typeof(t==null?void 0:t._getType)=="function"}function Jv(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}var ri={};let sn;const EA=()=>typeof window<"u"&&typeof window.document<"u",SA=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",xA=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Kv=()=>typeof Deno<"u",kA=()=>typeof gt<"u"&&typeof gt.versions<"u"&&typeof gt.versions.node<"u"&&!Kv(),TA=()=>sn||(EA()?sn="browser":kA()?sn="node":SA()?sn="webworker":xA()?sn="jsdom":Kv()?sn="deno":sn="other",sn);let du;async function Yv(){if(du===void 0){const t=TA(),e=RA();du={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:ew,...e}}return du}function AA(){const t=MA()||{},e={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[n,a]of Object.entries(t))n.startsWith("LANGCHAIN_")&&typeof a=="string"&&!r.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[n]=a);return e}function MA(){try{return typeof gt<"u"&&ri?Object.entries(ri).reduce((t,[e,r])=>(t[e]=String(r),t),{}):void 0}catch{return}}function Dn(t){try{return typeof gt<"u"?ri==null?void 0:ri[t]:void 0}catch{return}}function $n(t){return Dn(`LANGSMITH_${t}`)||Dn(`LANGCHAIN_${t}`)}let uu;function RA(){if(uu!==void 0)return uu;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const r of t){const n=Dn(r);n!==void 0&&(e[r]=n)}return uu=e,e}function Re(t,e){if(!Gs(t)){const r=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(r)}return t}const Xv={};function Qv(t){Xv[t]||(console.warn(t),Xv[t]=!0)}var hu={exports:{}},pu,e_;function el(){if(e_)return pu;e_=1;const t="2.0.0",e=256,r=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,a=e-6;return pu={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:r,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:t,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},pu}var fu,t_;function tl(){if(t_)return fu;t_=1;var t={};return fu=typeof gt=="object"&&t&&t.NODE_DEBUG&&/\bsemver\b/i.test(t.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},fu}var r_;function ni(){return r_||(r_=1,function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=el(),o=tl();e=t.exports={};const i=e.re=[],s=e.safeRe=[],l=e.src=[],c=e.t={};let d=0;const u="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",a],[u,n]],p=g=>{for(const[y,E]of h)g=g.split(`${y}*`).join(`${y}{0,${E}}`).split(`${y}+`).join(`${y}{1,${E}}`);return g},f=(g,y,E)=>{const k=p(y),R=d++;o(g,R,y),c[g]=R,l[R]=y,i[R]=new RegExp(y,E?"g":void 0),s[R]=new RegExp(k,E?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${u}*`),f("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${u}+`),f("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),f("FULL",`^${l[c.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),f("LOOSE",`^${l[c.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),f("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),f("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),f("COERCERTL",l[c.COERCE],!0),f("COERCERTLFULL",l[c.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",f("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",f("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(hu,hu.exports)),hu.exports}var mu,n_;function gu(){if(n_)return mu;n_=1;const t=Object.freeze({loose:!0}),e=Object.freeze({});return mu=r=>r?typeof r!="object"?t:r:e,mu}var yu,a_;function o_(){if(a_)return yu;a_=1;const t=/^[0-9]+$/,e=(r,n)=>{const a=t.test(r),o=t.test(n);return a&&o&&(r=+r,n=+n),r===n?0:a&&!o?-1:o&&!a?1:r<n?-1:1};return yu={compareIdentifiers:e,rcompareIdentifiers:(r,n)=>e(n,r)},yu}var vu,i_;function ut(){if(i_)return vu;i_=1;const t=tl(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:r}=el(),{safeRe:n,t:a}=ni(),o=gu(),{compareIdentifiers:i}=o_();class s{constructor(c,d){if(d=o(d),c instanceof s){if(c.loose===!!d.loose&&c.includePrerelease===!!d.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);t("SemVer",c,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const u=c.trim().match(d.loose?n[a.LOOSE]:n[a.FULL]);if(!u)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+u[1],this.minor=+u[2],this.patch=+u[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");u[4]?this.prerelease=u[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const p=+h;if(p>=0&&p<r)return p}return h}):this.prerelease=[],this.build=u[5]?u[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(t("SemVer.compare",this.version,this.options,c),!(c instanceof s)){if(typeof c=="string"&&c===this.version)return 0;c=new s(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof s||(c=new s(c,this.options)),i(this.major,c.major)||i(this.minor,c.minor)||i(this.patch,c.patch)}comparePre(c){if(c instanceof s||(c=new s(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let d=0;do{const u=this.prerelease[d],h=c.prerelease[d];if(t("prerelease compare",d,u,h),u===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(u===void 0)return-1;if(u!==h)return i(u,h)}while(++d)}compareBuild(c){c instanceof s||(c=new s(c,this.options));let d=0;do{const u=this.build[d],h=c.build[d];if(t("build compare",d,u,h),u===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(u===void 0)return-1;if(u!==h)return i(u,h)}while(++d)}inc(c,d,u){switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,u);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,u);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,u),this.inc("pre",d,u);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,u),this.inc("pre",d,u);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(u)?1:0;if(!d&&u===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[h];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&u===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(d){let p=[d,h];u===!1&&(p=[d]),i(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return vu=s,vu}var _u,s_;function Fa(){if(s_)return _u;s_=1;const t=ut();return _u=(e,r,n=!1)=>{if(e instanceof t)return e;try{return new t(e,r)}catch(a){if(!n)return null;throw a}},_u}var wu,l_;function FA(){if(l_)return wu;l_=1;const t=Fa();return wu=(e,r)=>{const n=t(e,r);return n?n.version:null},wu}var bu,c_;function NA(){if(c_)return bu;c_=1;const t=Fa();return bu=(e,r)=>{const n=t(e.trim().replace(/^[=v]+/,""),r);return n?n.version:null},bu}var Eu,d_;function PA(){if(d_)return Eu;d_=1;const t=ut();return Eu=(e,r,n,a,o)=>{typeof n=="string"&&(o=a,a=n,n=void 0);try{return new t(e instanceof t?e.version:e,n).inc(r,a,o).version}catch{return null}},Eu}var Su,u_;function OA(){if(u_)return Su;u_=1;const t=Fa();return Su=(e,r)=>{const n=t(e,null,!0),a=t(r,null,!0),o=n.compare(a);if(o===0)return null;const i=o>0,s=i?n:a,l=i?a:n,c=!!s.prerelease.length;if(l.prerelease.length&&!c)return!l.patch&&!l.minor?"major":s.patch?"patch":s.minor?"minor":"major";const d=c?"pre":"";return n.major!==a.major?d+"major":n.minor!==a.minor?d+"minor":n.patch!==a.patch?d+"patch":"prerelease"},Su}var xu,h_;function IA(){if(h_)return xu;h_=1;const t=ut();return xu=(e,r)=>new t(e,r).major,xu}var ku,p_;function CA(){if(p_)return ku;p_=1;const t=ut();return ku=(e,r)=>new t(e,r).minor,ku}var Tu,f_;function jA(){if(f_)return Tu;f_=1;const t=ut();return Tu=(e,r)=>new t(e,r).patch,Tu}var Au,m_;function LA(){if(m_)return Au;m_=1;const t=Fa();return Au=(e,r)=>{const n=t(e,r);return n&&n.prerelease.length?n.prerelease:null},Au}var Mu,g_;function Xt(){if(g_)return Mu;g_=1;const t=ut();return Mu=(e,r,n)=>new t(e,n).compare(new t(r,n)),Mu}var Ru,y_;function DA(){if(y_)return Ru;y_=1;const t=Xt();return Ru=(e,r,n)=>t(r,e,n),Ru}var Fu,v_;function $A(){if(v_)return Fu;v_=1;const t=Xt();return Fu=(e,r)=>t(e,r,!0),Fu}var Nu,__;function Pu(){if(__)return Nu;__=1;const t=ut();return Nu=(e,r,n)=>{const a=new t(e,n),o=new t(r,n);return a.compare(o)||a.compareBuild(o)},Nu}var Ou,w_;function UA(){if(w_)return Ou;w_=1;const t=Pu();return Ou=(e,r)=>e.sort((n,a)=>t(n,a,r)),Ou}var Iu,b_;function zA(){if(b_)return Iu;b_=1;const t=Pu();return Iu=(e,r)=>e.sort((n,a)=>t(a,n,r)),Iu}var Cu,E_;function rl(){if(E_)return Cu;E_=1;const t=Xt();return Cu=(e,r,n)=>t(e,r,n)>0,Cu}var ju,S_;function Lu(){if(S_)return ju;S_=1;const t=Xt();return ju=(e,r,n)=>t(e,r,n)<0,ju}var Du,x_;function k_(){if(x_)return Du;x_=1;const t=Xt();return Du=(e,r,n)=>t(e,r,n)===0,Du}var $u,T_;function A_(){if(T_)return $u;T_=1;const t=Xt();return $u=(e,r,n)=>t(e,r,n)!==0,$u}var Uu,M_;function zu(){if(M_)return Uu;M_=1;const t=Xt();return Uu=(e,r,n)=>t(e,r,n)>=0,Uu}var Bu,R_;function Hu(){if(R_)return Bu;R_=1;const t=Xt();return Bu=(e,r,n)=>t(e,r,n)<=0,Bu}var Wu,F_;function N_(){if(F_)return Wu;F_=1;const t=k_(),e=A_(),r=rl(),n=zu(),a=Lu(),o=Hu();return Wu=(i,s,l,c)=>{switch(s){case"===":return typeof i=="object"&&(i=i.version),typeof l=="object"&&(l=l.version),i===l;case"!==":return typeof i=="object"&&(i=i.version),typeof l=="object"&&(l=l.version),i!==l;case"":case"=":case"==":return t(i,l,c);case"!=":return e(i,l,c);case">":return r(i,l,c);case">=":return n(i,l,c);case"<":return a(i,l,c);case"<=":return o(i,l,c);default:throw new TypeError(`Invalid operator: ${s}`)}},Wu}var Gu,P_;function BA(){if(P_)return Gu;P_=1;const t=ut(),e=Fa(),{safeRe:r,t:n}=ni();return Gu=(a,o)=>{if(a instanceof t)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;o=o||{};let i=null;if(!o.rtl)i=a.match(o.includePrerelease?r[n.COERCEFULL]:r[n.COERCE]);else{const h=o.includePrerelease?r[n.COERCERTLFULL]:r[n.COERCERTL];let p;for(;(p=h.exec(a))&&(!i||i.index+i[0].length!==a.length);)(!i||p.index+p[0].length!==i.index+i[0].length)&&(i=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(i===null)return null;const s=i[2],l=i[3]||"0",c=i[4]||"0",d=o.includePrerelease&&i[5]?`-${i[5]}`:"",u=o.includePrerelease&&i[6]?`+${i[6]}`:"";return e(`${s}.${l}.${c}${d}${u}`,o)},Gu}var Vu,O_;function HA(){if(O_)return Vu;O_=1;class t{constructor(){this.max=1e3,this.map=new Map}get(r){const n=this.map.get(r);if(n!==void 0)return this.map.delete(r),this.map.set(r,n),n}delete(r){return this.map.delete(r)}set(r,n){if(!this.delete(r)&&n!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(r,n)}return this}}return Vu=t,Vu}var qu,I_;function Qt(){if(I_)return qu;I_=1;const t=/\s+/g;class e{constructor(_,B){if(B=a(B),_ instanceof e)return _.loose===!!B.loose&&_.includePrerelease===!!B.includePrerelease?_:new e(_.raw,B);if(_ instanceof o)return this.raw=_.value,this.set=[[_]],this.formatted=void 0,this;if(this.options=B,this.loose=!!B.loose,this.includePrerelease=!!B.includePrerelease,this.raw=_.trim().replace(t," "),this.set=this.raw.split("||").map(N=>this.parseRange(N.trim())).filter(N=>N.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const N=this.set[0];if(this.set=this.set.filter(C=>!g(C[0])),this.set.length===0)this.set=[N];else if(this.set.length>1){for(const C of this.set)if(C.length===1&&y(C[0])){this.set=[C];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let _=0;_<this.set.length;_++){_>0&&(this.formatted+="||");const B=this.set[_];for(let N=0;N<B.length;N++)N>0&&(this.formatted+=" "),this.formatted+=B[N].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(_){const B=((this.options.includePrerelease&&p)|(this.options.loose&&f))+":"+_,N=n.get(B);if(N)return N;const C=this.options.loose,I=C?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];_=_.replace(I,S(this.options.includePrerelease)),i("hyphen replace",_),_=_.replace(l[c.COMPARATORTRIM],d),i("comparator trim",_),_=_.replace(l[c.TILDETRIM],u),i("tilde trim",_),_=_.replace(l[c.CARETTRIM],h),i("caret trim",_);let Y=_.split(" ").map(Se=>k(Se,this.options)).join(" ").split(/\s+/).map(Se=>he(Se,this.options));C&&(Y=Y.filter(Se=>(i("loose invalid filter",Se,this.options),!!Se.match(l[c.COMPARATORLOOSE])))),i("range list",Y);const ae=new Map,ce=Y.map(Se=>new o(Se,this.options));for(const Se of ce){if(g(Se))return[Se];ae.set(Se.value,Se)}ae.size>1&&ae.has("")&&ae.delete("");const be=[...ae.values()];return n.set(B,be),be}intersects(_,B){if(!(_ instanceof e))throw new TypeError("a Range is required");return this.set.some(N=>E(N,B)&&_.set.some(C=>E(C,B)&&N.every(I=>C.every(Y=>I.intersects(Y,B)))))}test(_){if(!_)return!1;if(typeof _=="string")try{_=new s(_,this.options)}catch{return!1}for(let B=0;B<this.set.length;B++)if(M(this.set[B],_,this.options))return!0;return!1}}qu=e;const r=HA(),n=new r,a=gu(),o=nl(),i=tl(),s=ut(),{safeRe:l,t:c,comparatorTrimReplace:d,tildeTrimReplace:u,caretTrimReplace:h}=ni(),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:f}=el(),g=x=>x.value==="<0.0.0-0",y=x=>x.value==="",E=(x,_)=>{let B=!0;const N=x.slice();let C=N.pop();for(;B&&N.length;)B=N.every(I=>C.intersects(I,_)),C=N.pop();return B},k=(x,_)=>(i("comp",x,_),x=U(x,_),i("caret",x),x=O(x,_),i("tildes",x),x=$(x,_),i("xrange",x),x=ne(x,_),i("stars",x),x),R=x=>!x||x.toLowerCase()==="x"||x==="*",O=(x,_)=>x.trim().split(/\s+/).map(B=>b(B,_)).join(" "),b=(x,_)=>{const B=_.loose?l[c.TILDELOOSE]:l[c.TILDE];return x.replace(B,(N,C,I,Y,ae)=>{i("tilde",x,N,C,I,Y,ae);let ce;return R(C)?ce="":R(I)?ce=`>=${C}.0.0 <${+C+1}.0.0-0`:R(Y)?ce=`>=${C}.${I}.0 <${C}.${+I+1}.0-0`:ae?(i("replaceTilde pr",ae),ce=`>=${C}.${I}.${Y}-${ae} <${C}.${+I+1}.0-0`):ce=`>=${C}.${I}.${Y} <${C}.${+I+1}.0-0`,i("tilde return",ce),ce})},U=(x,_)=>x.trim().split(/\s+/).map(B=>H(B,_)).join(" "),H=(x,_)=>{i("caret",x,_);const B=_.loose?l[c.CARETLOOSE]:l[c.CARET],N=_.includePrerelease?"-0":"";return x.replace(B,(C,I,Y,ae,ce)=>{i("caret",x,C,I,Y,ae,ce);let be;return R(I)?be="":R(Y)?be=`>=${I}.0.0${N} <${+I+1}.0.0-0`:R(ae)?I==="0"?be=`>=${I}.${Y}.0${N} <${I}.${+Y+1}.0-0`:be=`>=${I}.${Y}.0${N} <${+I+1}.0.0-0`:ce?(i("replaceCaret pr",ce),I==="0"?Y==="0"?be=`>=${I}.${Y}.${ae}-${ce} <${I}.${Y}.${+ae+1}-0`:be=`>=${I}.${Y}.${ae}-${ce} <${I}.${+Y+1}.0-0`:be=`>=${I}.${Y}.${ae}-${ce} <${+I+1}.0.0-0`):(i("no pr"),I==="0"?Y==="0"?be=`>=${I}.${Y}.${ae}${N} <${I}.${Y}.${+ae+1}-0`:be=`>=${I}.${Y}.${ae}${N} <${I}.${+Y+1}.0-0`:be=`>=${I}.${Y}.${ae} <${+I+1}.0.0-0`),i("caret return",be),be})},$=(x,_)=>(i("replaceXRanges",x,_),x.split(/\s+/).map(B=>G(B,_)).join(" ")),G=(x,_)=>{x=x.trim();const B=_.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return x.replace(B,(N,C,I,Y,ae,ce)=>{i("xRange",x,N,C,I,Y,ae,ce);const be=R(I),Se=be||R(Y),We=Se||R(ae),vt=We;return C==="="&&vt&&(C=""),ce=_.includePrerelease?"-0":"",be?C===">"||C==="<"?N="<0.0.0-0":N="*":C&&vt?(Se&&(Y=0),ae=0,C===">"?(C=">=",Se?(I=+I+1,Y=0,ae=0):(Y=+Y+1,ae=0)):C==="<="&&(C="<",Se?I=+I+1:Y=+Y+1),C==="<"&&(ce="-0"),N=`${C+I}.${Y}.${ae}${ce}`):Se?N=`>=${I}.0.0${ce} <${+I+1}.0.0-0`:We&&(N=`>=${I}.${Y}.0${ce} <${I}.${+Y+1}.0-0`),i("xRange return",N),N})},ne=(x,_)=>(i("replaceStars",x,_),x.trim().replace(l[c.STAR],"")),he=(x,_)=>(i("replaceGTE0",x,_),x.trim().replace(l[_.includePrerelease?c.GTE0PRE:c.GTE0],"")),S=x=>(_,B,N,C,I,Y,ae,ce,be,Se,We,vt)=>(R(N)?B="":R(C)?B=`>=${N}.0.0${x?"-0":""}`:R(I)?B=`>=${N}.${C}.0${x?"-0":""}`:Y?B=`>=${B}`:B=`>=${B}${x?"-0":""}`,R(be)?ce="":R(Se)?ce=`<${+be+1}.0.0-0`:R(We)?ce=`<${be}.${+Se+1}.0-0`:vt?ce=`<=${be}.${Se}.${We}-${vt}`:x?ce=`<${be}.${Se}.${+We+1}-0`:ce=`<=${ce}`,`${B} ${ce}`.trim()),M=(x,_,B)=>{for(let N=0;N<x.length;N++)if(!x[N].test(_))return!1;if(_.prerelease.length&&!B.includePrerelease){for(let N=0;N<x.length;N++)if(i(x[N].semver),x[N].semver!==o.ANY&&x[N].semver.prerelease.length>0){const C=x[N].semver;if(C.major===_.major&&C.minor===_.minor&&C.patch===_.patch)return!0}return!1}return!0};return qu}var Zu,C_;function nl(){if(C_)return Zu;C_=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(d,u){if(u=r(u),d instanceof e){if(d.loose===!!u.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),i("comparator",d,u),this.options=u,this.loose=!!u.loose,this.parse(d),this.semver===t?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(d){const u=this.options.loose?n[a.COMPARATORLOOSE]:n[a.COMPARATOR],h=d.match(u);if(!h)throw new TypeError(`Invalid comparator: ${d}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new s(h[2],this.options.loose):this.semver=t}toString(){return this.value}test(d){if(i("Comparator.test",d,this.options.loose),this.semver===t||d===t)return!0;if(typeof d=="string")try{d=new s(d,this.options)}catch{return!1}return o(d,this.operator,this.semver,this.options)}intersects(d,u){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(d.value,u).test(this.value):d.operator===""?d.value===""?!0:new l(this.value,u).test(d.semver):(u=r(u),u.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!u.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||o(this.semver,"<",d.semver,u)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||o(this.semver,">",d.semver,u)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}Zu=e;const r=gu(),{safeRe:n,t:a}=ni(),o=N_(),i=tl(),s=ut(),l=Qt();return Zu}var Ju,j_;function al(){if(j_)return Ju;j_=1;const t=Qt();return Ju=(e,r,n)=>{try{r=new t(r,n)}catch{return!1}return r.test(e)},Ju}var Ku,L_;function WA(){if(L_)return Ku;L_=1;const t=Qt();return Ku=(e,r)=>new t(e,r).set.map(n=>n.map(a=>a.value).join(" ").trim().split(" ")),Ku}var Yu,D_;function GA(){if(D_)return Yu;D_=1;const t=ut(),e=Qt();return Yu=(r,n,a)=>{let o=null,i=null,s=null;try{s=new e(n,a)}catch{return null}return r.forEach(l=>{s.test(l)&&(!o||i.compare(l)===-1)&&(o=l,i=new t(o,a))}),o},Yu}var Xu,$_;function VA(){if($_)return Xu;$_=1;const t=ut(),e=Qt();return Xu=(r,n,a)=>{let o=null,i=null,s=null;try{s=new e(n,a)}catch{return null}return r.forEach(l=>{s.test(l)&&(!o||i.compare(l)===1)&&(o=l,i=new t(o,a))}),o},Xu}var Qu,U_;function qA(){if(U_)return Qu;U_=1;const t=ut(),e=Qt(),r=rl();return Qu=(n,a)=>{n=new e(n,a);let o=new t("0.0.0");if(n.test(o)||(o=new t("0.0.0-0"),n.test(o)))return o;o=null;for(let i=0;i<n.set.length;++i){const s=n.set[i];let l=null;s.forEach(c=>{const d=new t(c.semver.version);switch(c.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!l||r(d,l))&&(l=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),l&&(!o||r(o,l))&&(o=l)}return o&&n.test(o)?o:null},Qu}var eh,z_;function ZA(){if(z_)return eh;z_=1;const t=Qt();return eh=(e,r)=>{try{return new t(e,r).range||"*"}catch{return null}},eh}var th,B_;function rh(){if(B_)return th;B_=1;const t=ut(),e=nl(),{ANY:r}=e,n=Qt(),a=al(),o=rl(),i=Lu(),s=Hu(),l=zu();return th=(c,d,u,h)=>{c=new t(c,h),d=new n(d,h);let p,f,g,y,E;switch(u){case">":p=o,f=s,g=i,y=">",E=">=";break;case"<":p=i,f=l,g=o,y="<",E="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(c,d,h))return!1;for(let k=0;k<d.set.length;++k){const R=d.set[k];let O=null,b=null;if(R.forEach(U=>{U.semver===r&&(U=new e(">=0.0.0")),O=O||U,b=b||U,p(U.semver,O.semver,h)?O=U:g(U.semver,b.semver,h)&&(b=U)}),O.operator===y||O.operator===E||(!b.operator||b.operator===y)&&f(c,b.semver)||b.operator===E&&g(c,b.semver))return!1}return!0},th}var nh,H_;function JA(){if(H_)return nh;H_=1;const t=rh();return nh=(e,r,n)=>t(e,r,">",n),nh}var ah,W_;function KA(){if(W_)return ah;W_=1;const t=rh();return ah=(e,r,n)=>t(e,r,"<",n),ah}var oh,G_;function YA(){if(G_)return oh;G_=1;const t=Qt();return oh=(e,r,n)=>(e=new t(e,n),r=new t(r,n),e.intersects(r,n)),oh}var ih,V_;function XA(){if(V_)return ih;V_=1;const t=al(),e=Xt();return ih=(r,n,a)=>{const o=[];let i=null,s=null;const l=r.sort((h,p)=>e(h,p,a));for(const h of l)t(h,n,a)?(s=h,i||(i=h)):(s&&o.push([i,s]),s=null,i=null);i&&o.push([i,null]);const c=[];for(const[h,p]of o)h===p?c.push(h):!p&&h===l[0]?c.push("*"):p?h===l[0]?c.push(`<=${p}`):c.push(`${h} - ${p}`):c.push(`>=${h}`);const d=c.join(" || "),u=typeof n.raw=="string"?n.raw:String(n);return d.length<u.length?d:n},ih}var sh,q_;function QA(){if(q_)return sh;q_=1;const t=Qt(),e=nl(),{ANY:r}=e,n=al(),a=Xt(),o=(u,h,p={})=>{if(u===h)return!0;u=new t(u,p),h=new t(h,p);let f=!1;e:for(const g of u.set){for(const y of h.set){const E=l(g,y,p);if(f=f||E!==null,E)continue e}if(f)return!1}return!0},i=[new e(">=0.0.0-0")],s=[new e(">=0.0.0")],l=(u,h,p)=>{if(u===h)return!0;if(u.length===1&&u[0].semver===r){if(h.length===1&&h[0].semver===r)return!0;p.includePrerelease?u=i:u=s}if(h.length===1&&h[0].semver===r){if(p.includePrerelease)return!0;h=s}const f=new Set;let g,y;for(const $ of u)$.operator===">"||$.operator===">="?g=c(g,$,p):$.operator==="<"||$.operator==="<="?y=d(y,$,p):f.add($.semver);if(f.size>1)return null;let E;if(g&&y&&(E=a(g.semver,y.semver,p),E>0||E===0&&(g.operator!==">="||y.operator!=="<=")))return null;for(const $ of f){if(g&&!n($,String(g),p)||y&&!n($,String(y),p))return null;for(const G of h)if(!n($,String(G),p))return!1;return!0}let k,R,O,b,U=y&&!p.includePrerelease&&y.semver.prerelease.length?y.semver:!1,H=g&&!p.includePrerelease&&g.semver.prerelease.length?g.semver:!1;U&&U.prerelease.length===1&&y.operator==="<"&&U.prerelease[0]===0&&(U=!1);for(const $ of h){if(b=b||$.operator===">"||$.operator===">=",O=O||$.operator==="<"||$.operator==="<=",g){if(H&&$.semver.prerelease&&$.semver.prerelease.length&&$.semver.major===H.major&&$.semver.minor===H.minor&&$.semver.patch===H.patch&&(H=!1),$.operator===">"||$.operator===">="){if(k=c(g,$,p),k===$&&k!==g)return!1}else if(g.operator===">="&&!n(g.semver,String($),p))return!1}if(y){if(U&&$.semver.prerelease&&$.semver.prerelease.length&&$.semver.major===U.major&&$.semver.minor===U.minor&&$.semver.patch===U.patch&&(U=!1),$.operator==="<"||$.operator==="<="){if(R=d(y,$,p),R===$&&R!==y)return!1}else if(y.operator==="<="&&!n(y.semver,String($),p))return!1}if(!$.operator&&(y||g)&&E!==0)return!1}return!(g&&O&&!y&&E!==0||y&&b&&!g&&E!==0||H||U)},c=(u,h,p)=>{if(!u)return h;const f=a(u.semver,h.semver,p);return f>0?u:f<0||h.operator===">"&&u.operator===">="?h:u},d=(u,h,p)=>{if(!u)return h;const f=a(u.semver,h.semver,p);return f<0?u:f>0||h.operator==="<"&&u.operator==="<="?h:u};return sh=o,sh}var lh,Z_;function eM(){if(Z_)return lh;Z_=1;const t=ni(),e=el(),r=ut(),n=o_(),a=Fa(),o=FA(),i=NA(),s=PA(),l=OA(),c=IA(),d=CA(),u=jA(),h=LA(),p=Xt(),f=DA(),g=$A(),y=Pu(),E=UA(),k=zA(),R=rl(),O=Lu(),b=k_(),U=A_(),H=zu(),$=Hu(),G=N_(),ne=BA(),he=nl(),S=Qt(),M=al(),x=WA(),_=GA(),B=VA(),N=qA(),C=ZA(),I=rh(),Y=JA(),ae=KA(),ce=YA(),be=XA(),Se=QA();return lh={parse:a,valid:o,clean:i,inc:s,diff:l,major:c,minor:d,patch:u,prerelease:h,compare:p,rcompare:f,compareLoose:g,compareBuild:y,sort:E,rsort:k,gt:R,lt:O,eq:b,neq:U,gte:H,lte:$,cmp:G,coerce:ne,Comparator:he,Range:S,satisfies:M,toComparators:x,maxSatisfying:_,minSatisfying:B,minVersion:N,validRange:C,outside:I,gtr:Y,ltr:ae,intersects:ce,simplifyRange:be,subset:Se,SemVer:r,re:t.re,src:t.src,tokens:t.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},lh}var J_=eM();function tM(t,e){const r=J_.parse(t),n=J_.parse(e);if(!r||!n)throw new Error("Invalid version format.");return r.compare(n)>=0}function ln(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,r]=t.split(":"),n=r||"latest";if(e.includes("/")){const[a,o]=e.split("/",2);if(!a||!o)throw new Error(`Invalid identifier format: ${t}`);return[a,o,n]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,n]}}class rM extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function Te(t,e,r){let n;if(t.ok){r&&(n=await t.text());return}n=await t.text();const a=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${n}`;throw t.status===409?new rM(a):new Error(a)}var K_="[...]",nM={result:"[Circular]"},ol=[],Na=[];function aM(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function ai(t,e,r,n){typeof n>"u"&&(n=aM()),dh(t,"",0,[],void 0,0,n);var a;try{Na.length===0?a=JSON.stringify(t,e,r):a=JSON.stringify(t,oM(e),r)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ol.length!==0;){var o=ol.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return a}function ch(t,e,r,n){var a=Object.getOwnPropertyDescriptor(n,r);a.get!==void 0?a.configurable?(Object.defineProperty(n,r,{value:t}),ol.push([n,r,e,a])):Na.push([e,r,t]):(n[r]=t,ol.push([n,r,e]))}function dh(t,e,r,n,a,o,i){o+=1;var s;if(typeof t=="object"&&t!==null){for(s=0;s<n.length;s++)if(n[s]===t){ch(nM,t,e,a);return}if(typeof i.depthLimit<"u"&&o>i.depthLimit){ch(K_,t,e,a);return}if(typeof i.edgesLimit<"u"&&r+1>i.edgesLimit){ch(K_,t,e,a);return}if(n.push(t),Array.isArray(t))for(s=0;s<t.length;s++)dh(t[s],s,s,n,t,o,i);else{var l=Object.keys(t);for(s=0;s<l.length;s++){var c=l[s];dh(t[c],c,s,n,t,o,i)}}n.pop()}}function oM(t){return t=typeof t<"u"?t:function(e,r){return r},function(e,r){if(Na.length>0)for(var n=0;n<Na.length;n++){var a=Na[n];if(a[1]===e&&a[0]===r){r=a[2],Na.splice(n,1);break}}return t.call(this,e,r)}}async function Y_(t){const e=await Yv(),r=AA();return t.map(n=>{const a=n.extra??{},o=a.metadata;return n.extra={...a,runtime:{...e,...a==null?void 0:a.runtime},metadata:{...r,...r.revision_id||n.revision_id?{revision_id:n.revision_id??r.revision_id}:{},...o}},n})}const iM=()=>{const t=$n("TRACING_SAMPLING_RATE");if(t===void 0)return;const e=parseFloat(t);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},sM=t=>{const e=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return e==="localhost"||e==="127.0.0.1"||e==="::1"};async function lM(t){const e=[];for await(const r of t)e.push(r);return e}function uh(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const cM=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(r=>setTimeout(r,e)),!0}return!1};class dM{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(r=>{this.items.push([e,r])})}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const r=[];for(;r.length<e&&this.items.length;){const n=this.items.shift();if(n)r.push(n);else break}return[r.map(n=>n[0]),()=>r.forEach(n=>n[1]())]}}const uM=20971520;class oi{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new dM}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=oi.getDefaultClientConfig();this.tracingSampleRate=iM(),this.apiUrl=uh(e.apiUrl??r.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=uh(e.apiKey??r.apiKey),this.webUrl=uh(e.webUrl??r.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new qv(e.callerOptions??{}),this.batchIngestCaller=new qv({...e.callerOptions??{},onFailedResponseHook:cM}),this.hideInputs=e.hideInputs??e.anonymizer??r.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??r.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=$n("API_KEY"),r=$n("ENDPOINT")??"https://api.smith.langchain.com",n=$n("HIDE_INPUTS")==="true",a=$n("HIDE_OUTPUTS")==="true";return{apiUrl:r,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:sM(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${ew}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const r={...e};return r.inputs!==void 0&&(r.inputs=this.processInputs(r.inputs)),r.outputs!==void 0&&(r.outputs=this.processOutputs(r.outputs)),r}async _getResponse(e,r){const n=(r==null?void 0:r.toString())??"",a=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(me(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(o,`Failed to fetch ${e}`),o}async _get(e,r){return(await this._getResponse(e,r)).json()}async*_getPaginated(e,r=new URLSearchParams,n){let a=Number(r.get("offset"))||0;const o=Number(r.get("limit"))||100;for(;;){r.set("offset",String(a)),r.set("limit",String(o));const i=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(me(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(s,`Failed to fetch ${e}`);const l=n?n(await s.json()):await s.json();if(l.length===0||(yield l,l.length<o))break;a+=l.length}}async*_getCursorPaginatedList(e,r=null,n="POST",a="runs"){const o=r?{...r}:{};for(;;){const i=await(await this.caller.call(me(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(o)})).json();if(!i||!i[a])break;yield i[a];const s=i.cursors;if(!s||!s.next)break;o.cursor=s.next}}_filterForSampling(e,r=!1){if(this.tracingSampleRate===void 0)return e;if(r){const n=[];for(const a of e)this.filteredPostUuids.has(a.id)?this.filteredPostUuids.delete(a.id):n.push(a);return n}else{const n=[];for(const a of e)a.id!==a.trace_id&&!this.filteredPostUuids.has(a.trace_id)||Math.random()<this.tracingSampleRate?n.push(a):this.filteredPostUuids.add(a.id);return n}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,r]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){r();return}try{await this.batchIngestRuns({runCreates:e.filter(n=>n.action==="create").map(n=>n.item),runUpdates:e.filter(n=>n.action==="update").map(n=>n.item)})}finally{r()}}}async processRunOperation(e,r){const n=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const a=this.autoBatchQueue.push(e);return(r||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue().catch(console.error),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},n?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),a}async _getServerInfo(){const e=await me()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(e,"get server info"),e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch{return!1}return!0}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;const r={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const a=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.processRunOperation({action:"create",item:a}).catch(console.error);return}const o=await Y_([a]),i=await this.caller.call(me(),`${this.apiUrl}/runs`,{method:"POST",headers:r,body:ai(o[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:r}){var c,d;if(e===void 0&&r===void 0)return;let n=(e==null?void 0:e.map(u=>this.prepareRunCreateOrUpdateInputs(u)))??[],a=(r==null?void 0:r.map(u=>this.prepareRunCreateOrUpdateInputs(u)))??[];if(n.length>0&&a.length>0){const u=n.reduce((p,f)=>(f.id&&(p[f.id]=f),p),{}),h=[];for(const p of a)p.id!==void 0&&u[p.id]?u[p.id]={...u[p.id],...p}:h.push(p);n=Object.values(u),a=h}const o={post:this._filterForSampling(n),patch:this._filterForSampling(a,!0)};if(!o.post.length&&!o.patch.length)return;if(n=await Y_(n),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const u of o.post)await this.createRun(u);for(const u of o.patch)u.id!==void 0&&await this.updateRun(u.id,u);return}const i=((d=(c=this.serverInfo)==null?void 0:c.batch_ingest_config)==null?void 0:d.size_limit_bytes)??uM,s={post:[],patch:[]};let l=0;for(const u of["post","patch"]){const h=u,p=o[h].reverse();let f=p.pop();for(;f!==void 0;){const g=ai(f);l>0&&l+g.length>i&&(await this._postBatchIngestRuns(ai(s)),l=0,s.post=[],s.patch=[]),l+=g.length,s[h].push(f),f=p.pop()}}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(ai(s))}async _postBatchIngestRuns(e){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(me(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:r,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(n,"batch create run",!0)}async updateRun(e,r){Re(e),r.inputs&&(r.inputs=this.processInputs(r.inputs)),r.outputs&&(r.outputs=this.processOutputs(r.outputs));const n={...r,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(r.end_time!==void 0&&n.parent_run_id===void 0){await this.processRunOperation({action:"update",item:n},!0);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"},o=await this.caller.call(me(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:ai(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(o,"update run",!0)}async readRun(e,{loadChildRuns:r}={loadChildRuns:!1}){Re(e);let n=await this._get(`/runs/${e}`);return r&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:r,projectOpts:n}){if(r!==void 0){let a;r.session_id?a=r.session_id:n!=null&&n.projectName?a=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?a=n==null?void 0:n.projectId:a=(await this.readProject({projectName:$n("PROJECT")||"default"})).id;const o=await this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${a}/r/${r.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const r=await lM(this.listRuns({id:e.child_run_ids})),n={},a={};r.sort((o,i)=>((o==null?void 0:o.dotted_order)??"").localeCompare((i==null?void 0:i.dotted_order)??""));for(const o of r){if(o.parent_run_id===null||o.parent_run_id===void 0)throw new Error(`Child run ${o.id} has no parent`);o.parent_run_id in n||(n[o.parent_run_id]=[]),n[o.parent_run_id].push(o),a[o.id]=o}e.child_runs=n[e.id]||[];for(const o in n)o!==e.id&&(a[o].child_runs=n[o]);return e}async*listRuns(e){const{projectId:r,projectName:n,parentRunId:a,traceId:o,referenceExampleId:i,startTime:s,executionOrder:l,isRoot:c,runType:d,error:u,id:h,query:p,filter:f,traceFilter:g,treeFilter:y,limit:E,select:k}=e;let R=[];if(r&&(R=Array.isArray(r)?r:[r]),n){const H=Array.isArray(n)?n:[n],$=await Promise.all(H.map(G=>this.readProject({projectName:G}).then(ne=>ne.id)));R.push(...$)}const O=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],b={session:R.length?R:null,run_type:d,reference_example:i,query:p,filter:f,trace_filter:g,tree_filter:y,execution_order:l,parent_run:a,start_time:s?s.toISOString():null,error:u,id:h,limit:E,trace:o,select:k||O,is_root:c};let U=0;for await(const H of this._getCursorPaginatedList("/runs/query",b))if(E){if(U>=E)break;if(H.length+U>E){yield*H.slice(0,E-U);break}U+=H.length,yield*H}else yield*H}async getRunStats({id:e,trace:r,parentRun:n,runType:a,projectNames:o,projectIds:i,referenceExampleIds:s,startTime:l,endTime:c,error:d,query:u,filter:h,traceFilter:p,treeFilter:f,isRoot:g,dataSourceType:y}){let E=i||[];o&&(E=[...i||[],...await Promise.all(o.map(R=>this.readProject({projectName:R}).then(O=>O.id)))]);const k=Object.fromEntries(Object.entries({id:e,trace:r,parent_run:n,run_type:a,session:E,reference_example:s,start_time:l,end_time:c,error:d,query:u,filter:h,trace_filter:p,tree_filter:f,is_root:g,data_source_type:y}).filter(([R,O])=>O!==void 0));return await(await this.caller.call(me(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(k),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:r}={}){const n={run_id:e,share_token:r||At()};Re(e);const a=await(await this.caller.call(me(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){Re(e);const r=await this.caller.call(me(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(r,"unshare run",!0)}async readRunSharedLink(e){Re(e);const r=await(await this.caller.call(me(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:r}={}){const n=new URLSearchParams({share_token:e});if(r!==void 0)for(const a of r)n.append("id",a);return Re(e),await(await this.caller.call(me(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id),Re(e);const n=await(await this.caller.call(me(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async shareDataset(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id);const n={dataset_id:e};Re(e);const a=await(await this.caller.call(me(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){Re(e);const r=await this.caller.call(me(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(r,"unshare dataset",!0)}async readSharedDataset(e){return Re(e),await(await this.caller.call(me(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,r){const n={};r!=null&&r.exampleIds&&(n.id=r.exampleIds);const a=new URLSearchParams;Object.entries(n).forEach(([s,l])=>{Array.isArray(l)?l.forEach(c=>a.append(s,c)):a.append(s,l)});const o=await this.caller.call(me(),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await o.json();if(!o.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${o.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${o.status} ${o.statusText}`);return i.map(s=>({...s,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:r=null,metadata:n=null,upsert:a=!1,projectExtra:o=null,referenceDatasetId:i=null}){const s=a?"?upsert=true":"",l=`${this.apiUrl}/sessions${s}`,c=o||{};n&&(c.metadata=n);const d={name:e,extra:c,description:r};i!==null&&(d.reference_dataset_id=i);const u=await this.caller.call(me(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(u,"create project"),await u.json()}async updateProject(e,{name:r=null,description:n=null,metadata:a=null,projectExtra:o=null,endTime:i=null}){const s=`${this.apiUrl}/sessions/${e}`;let l=o;a&&(l={...l||{},metadata:a});const c={name:r,extra:l,description:n,end_time:i?new Date(i).toISOString():null},d=await this.caller.call(me(),s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(d,"update project"),await d.json()}async hasProject({projectId:e,projectName:r}){let n="/sessions";const a=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Re(e),n+=`/${e}`;else if(r!==void 0)a.append("name",r);else throw new Error("Must provide projectName or projectId");const o=await this.caller.call(me(),`${this.apiUrl}${n}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await o.json();return o.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:r,includeStats:n}){let a="/sessions";const o=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Re(e),a+=`/${e}`;else if(r!==void 0)o.append("name",r);else throw new Error("Must provide projectName or projectId");n!==void 0&&o.append("include_stats",n.toString());const i=await this._get(a,o);let s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${r}] not found`);s=i[0]}else s=i;return s}async getProjectUrl({projectId:e,projectName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:r}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:r}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const r of this._getPaginated("/sessions",e))return this._tenantId=r[0].tenant_id,r[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:r,nameContains:n,referenceDatasetId:a,referenceDatasetName:o,referenceFree:i,metadata:s}={}){const l=new URLSearchParams;if(e!==void 0)for(const c of e)l.append("id",c);if(r!==void 0&&l.append("name",r),n!==void 0&&l.append("name_contains",n),a!==void 0)l.append("reference_dataset",a);else if(o!==void 0){const c=await this.readDataset({datasetName:o});l.append("reference_dataset",c.id)}i!==void 0&&l.append("reference_free",i.toString()),s!==void 0&&l.append("metadata",JSON.stringify(s));for await(const c of this._getPaginated("/sessions",l))yield*c}async deleteProject({projectId:e,projectName:r}){let n;if(e===void 0&&r===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:r})).id:n=e,Re(n);const a=await this.caller.call(me(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(a,`delete session ${n} (${r})`,!0)}async uploadCsv({csvFile:e,fileName:r,inputKeys:n,outputKeys:a,description:o,dataType:i,name:s}){const l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,r),n.forEach(u=>{c.append("input_keys",u)}),a.forEach(u=>{c.append("output_keys",u)}),o&&c.append("description",o),i&&c.append("data_type",i),s&&c.append("name",s);const d=await this.caller.call(me(),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(d,"upload CSV"),await d.json()}async createDataset(e,{description:r,dataType:n,inputsSchema:a,outputsSchema:o,metadata:i}={}){const s={name:e,description:r,extra:i?{metadata:i}:void 0};n&&(s.data_type=n),a&&(s.inputs_schema_definition=a),o&&(s.outputs_schema_definition=o);const l=await this.caller.call(me(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:r}){let n="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Re(e),n+=`/${e}`;else if(r!==void 0)a.append("name",r);else throw new Error("Must provide datasetName or datasetId");const o=await this._get(n,a);let i;if(Array.isArray(o)){if(o.length===0)throw new Error(`Dataset[id=${e}, name=${r}] not found`);i=o[0]}else i=o;return i}async hasDataset({datasetId:e,datasetName:r}){try{return await this.readDataset({datasetId:e,datasetName:r}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:r,fromVersion:n,toVersion:a}){let o=e;if(o===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:r})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${o}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:r}){const n="/datasets";if(e===void 0)if(r!==void 0)e=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(a=>JSON.parse(a))}async*listDatasets({limit:e=100,offset:r=0,datasetIds:n,datasetName:a,datasetNameContains:o,metadata:i}={}){const s="/datasets",l=new URLSearchParams({limit:e.toString(),offset:r.toString()});if(n!==void 0)for(const c of n)l.append("id",c);a!==void 0&&l.append("name",a),o!==void 0&&l.append("name_contains",o),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(const c of this._getPaginated(s,l))yield*c}async updateDataset(e){const{datasetId:r,datasetName:n,...a}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");const o=r??(await this.readDataset({datasetName:n})).id;Re(o);const i=await this.caller.call(me(),`${this.apiUrl}/datasets/${o}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,"update dataset"),await i.json()}async deleteDataset({datasetId:e,datasetName:r}){let n="/datasets",a=e;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(r!==void 0&&(a=(await this.readDataset({datasetName:r})).id),a!==void 0)Re(a),n+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const o=await this.caller.call(me(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(o,`delete ${n}`),await o.json()}async indexDataset({datasetId:e,datasetName:r,tag:n}){let a=e;if(!a&&!r)throw new Error("Must provide either datasetName or datasetId");if(a&&r)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:r})).id),Re(a);const o={tag:n},i=await this.caller.call(me(),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(i,"index dataset"),await i.json()}async similarExamples(e,r,n,{filter:a}={}){const o={limit:n,inputs:e};a!==void 0&&(o.filter=a),Re(r);const i=await this.caller.call(me(),`${this.apiUrl}/datasets/${r}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,r,{datasetId:n,datasetName:a,createdAt:o,exampleId:i,metadata:s,split:l,sourceRunId:c}){var p;let d=n;if(d===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(d!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");d===void 0&&(d=(await this.readDataset({datasetName:a})).id);const u={dataset_id:d,inputs:e,outputs:r,created_at:(p=o||new Date)==null?void 0:p.toISOString(),id:i,metadata:s,split:l,source_run_id:c},h=await this.caller.call(me(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(h,"create example"),await h.json()}async createExamples(e){const{inputs:r,outputs:n,metadata:a,sourceRunIds:o,exampleIds:i,datasetId:s,datasetName:l}=e;let c=s;if(c===void 0&&l===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&l!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:l})).id);const d=r.map((h,p)=>({dataset_id:c,inputs:h,outputs:n?n[p]:void 0,metadata:a?a[p]:void 0,split:e.splits?e.splits[p]:void 0,id:i?i[p]:void 0,source_run_id:o?o[p]:void 0})),u=await this.caller.call(me(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(u,"create examples"),await u.json()}async createLLMExample(e,r,n){return this.createExample({input:e},{output:r},n)}async createChatExample(e,r,n){const a=e.map(i=>Zv(i)?Jv(i):i),o=Zv(r)?Jv(r):r;return this.createExample({input:a},{output:o},n)}async readExample(e){Re(e);const r=`/examples/${e}`;return await this._get(r)}async*listExamples({datasetId:e,datasetName:r,exampleIds:n,asOf:a,splits:o,inlineS3Urls:i,metadata:s,limit:l,offset:c,filter:d}={}){let u;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)u=e;else if(r!==void 0)u=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide a datasetName or datasetId");const h=new URLSearchParams({dataset:u}),p=a?typeof a=="string"?a:a==null?void 0:a.toISOString():void 0;p&&h.append("as_of",p);const f=i??!0;if(h.append("inline_s3_urls",f.toString()),n!==void 0)for(const y of n)h.append("id",y);if(o!==void 0)for(const y of o)h.append("splits",y);if(s!==void 0){const y=JSON.stringify(s);h.append("metadata",y)}l!==void 0&&h.append("limit",l.toString()),c!==void 0&&h.append("offset",c.toString()),d!==void 0&&h.append("filter",d);let g=0;for await(const y of this._getPaginated("/examples",h)){for(const E of y)yield E,g++;if(l!==void 0&&g>=l)break}}async deleteExample(e){Re(e);const r=`/examples/${e}`,n=await this.caller.call(me(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(n,`delete ${r}`),await n.json()}async updateExample(e,r){Re(e);const n=await this.caller.call(me(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(n,"update example"),await n.json()}async updateExamples(e){const r=await this.caller.call(me(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(r,"update examples"),await r.json()}async listDatasetSplits({datasetId:e,datasetName:r,asOf:n}){let a;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:r})).id:a=e,Re(a);const o=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&o.append("as_of",i),await this._get(`/datasets/${a}/splits`,o)}async updateDatasetSplits({datasetId:e,datasetName:r,splitName:n,exampleIds:a,remove:o=!1}){let i;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:r})).id:i=e,Re(i);const s={split_name:n,examples:a.map(c=>(Re(c),c)),remove:o},l=await this.caller.call(me(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(l,"update dataset splits",!0)}async evaluateRun(e,r,{sourceInfo:n,loadChildRuns:a,referenceExample:o}={loadChildRuns:!1}){Qv("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(o=await this.readExample(i.reference_example_id));const s=await r.evaluateRun(i,o),[l,c]=await this._logEvaluationFeedback(s,i,n);return c[0]}async createFeedback(e,r,{score:n,value:a,correction:o,comment:i,sourceInfo:s,feedbackSourceType:l="api",sourceRunId:c,feedbackId:d,feedbackConfig:u,projectId:h,comparativeExperimentId:p}){var k;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const f={type:l??"api",metadata:s??{}};c!==void 0&&(f==null?void 0:f.metadata)!==void 0&&!f.metadata.__run&&(f.metadata.__run={run_id:c}),(f==null?void 0:f.metadata)!==void 0&&((k=f.metadata.__run)==null?void 0:k.run_id)!==void 0&&Re(f.metadata.__run.run_id);const g={id:d??At(),run_id:e,key:r,score:n,value:a,correction:o,comment:i,feedback_source:f,comparative_experiment_id:p,feedbackConfig:u,session_id:h},y=`${this.apiUrl}/feedback`,E=await this.caller.call(me(),y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(E,"create feedback",!0),g}async updateFeedback(e,{score:r,value:n,correction:a,comment:o}){const i={};r!=null&&(i.score=r),n!=null&&(i.value=n),a!=null&&(i.correction=a),o!=null&&(i.comment=o),Re(e);const s=await this.caller.call(me(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(s,"update feedback",!0)}async readFeedback(e){Re(e);const r=`/feedback/${e}`;return await this._get(r)}async deleteFeedback(e){Re(e);const r=`/feedback/${e}`,n=await this.caller.call(me(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(n,`delete ${r}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:r,feedbackSourceTypes:n}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),r)for(const o of r)a.append("key",o);if(n)for(const o of n)a.append("source",o);for await(const o of this._getPaginated("/feedback",a))yield*o}async createPresignedFeedbackToken(e,r,{expiration:n,feedbackConfig:a}={}){const o={run_id:e,feedback_key:r,feedback_config:a};return n?typeof n=="string"?o.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(o.expires_in=n):o.expires_in={hours:3},await(await this.caller.call(me(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:r,referenceDatasetId:n,createdAt:a,description:o,metadata:i,id:s}){var c;if(r.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:r[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:s,name:e,experiment_ids:r,reference_dataset_id:n,description:o,created_at:(c=a??new Date)==null?void 0:c.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(me(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Re(e);const r=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",r))yield*n}_selectEvalResults(e){let r;return"results"in e?r=e.results:r=[e],r}async _logEvaluationFeedback(e,r,n){const a=this._selectEvalResults(e),o=[];for(const i of a){let s=n||{};i.evaluatorInfo&&(s={...i.evaluatorInfo,...s});let l=null;i.targetRunId?l=i.targetRunId:r&&(l=r.id),o.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:s,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[a,o]}async logEvaluationFeedback(e,r,n){const[a]=await this._logEvaluationFeedback(e,r,n);return a}async*listAnnotationQueues(e={}){const{queueIds:r,name:n,nameContains:a,limit:o}=e,i=new URLSearchParams;r&&r.forEach((l,c)=>{Re(l,`queueIds[${c}]`),i.append("ids",l)}),n&&i.append("name",n),a&&i.append("name_contains",a),i.append("limit",(o!==void 0?Math.min(o,100):100).toString());let s=0;for await(const l of this._getPaginated("/annotation-queues",i))if(yield*l,s++,o!==void 0&&s>=o)break}async createAnnotationQueue(e){const{name:r,description:n,queueId:a}=e,o={name:r,description:n,id:a||At()},i=await this.caller.call(me(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(o).filter(([s,l])=>l!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){const r=await this.listAnnotationQueues({queueIds:[e]}).next();if(r.done)throw new Error(`Annotation queue with ID ${e} not found`);return r.value}async updateAnnotationQueue(e,r){const{name:n,description:a}=r,o=await this.caller.call(me(),`${this.apiUrl}/annotation-queues/${Re(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(o,"update annotation queue")}async deleteAnnotationQueue(e){const r=await this.caller.call(me(),`${this.apiUrl}/annotation-queues/${Re(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(r,"delete annotation queue")}async addRunsToAnnotationQueue(e,r){const n=await this.caller.call(me(),`${this.apiUrl}/annotation-queues/${Re(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r.map((a,o)=>Re(a,`runIds[${o}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,r){const n=`/annotation-queues/${Re(e,"queueId")}/run`,a=await this.caller.call(me(),`${this.apiUrl}${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(a,"get run from annotation queue"),await a.json()}async _currentTenantIsOwner(e){const r=await this._getSettings();return e=="-"||r.tenant_handle===e}async _ownerConflictError(e,r){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${r}`)}async _getLatestCommitHash(e){const r=await this.caller.call(me(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await r.json();if(!r.ok){const a=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),o=new Error(`Error ${r.status}: ${r.statusText}
${a}`);throw o.statusCode=r.status,o}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,r){const[n,a,o]=ln(e),i=await this.caller.call(me(),`${this.apiUrl}/likes/${n}/${a}`,{method:"POST",body:JSON.stringify({like:r}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,`${r?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[r,n,a]=ln(e);if(await this._currentTenantIsOwner(r)){const o=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${n}/${a.substring(0,8)}?organizationId=${o.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${o.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${r}/${n}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${r}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const r of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*r}async*listPrompts(e){const r=new URLSearchParams;r.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),r.append("sort_direction","desc"),r.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&r.append("is_public",e.isPublic.toString()),e!=null&&e.query&&r.append("query",e.query);for await(const n of this._getPaginated("/repos",r,a=>a.repos))yield*n}async getPrompt(e){const[r,n,a]=ln(e),o=await this.caller.call(me(),`${this.apiUrl}/repos/${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(o.status===404)return null;await Te(o,"get prompt");const i=await o.json();return i.repo?i.repo:null}async createPrompt(e,r){const n=await this._getSettings();if(r!=null&&r.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[a,o,i]=ln(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);const s={repo_handle:o,...(r==null?void 0:r.description)&&{description:r.description},...(r==null?void 0:r.readme)&&{readme:r.readme},...(r==null?void 0:r.tags)&&{tags:r.tags},is_public:!!(r!=null&&r.isPublic)},l=await this.caller.call(me(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(l,"create prompt");const{repo:c}=await l.json();return c}async createCommit(e,r,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[a,o,i]=ln(e),s=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${a}/${o}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(r)),parent_commit:s},c=await this.caller.call(me(),`${this.apiUrl}/commits/${a}/${o}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(c,"create commit");const d=await c.json();return this._getPromptUrl(`${a}/${o}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updatePrompt(e,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,a]=ln(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const o={};if((r==null?void 0:r.description)!==void 0&&(o.description=r.description),(r==null?void 0:r.readme)!==void 0&&(o.readme=r.readme),(r==null?void 0:r.tags)!==void 0&&(o.tags=r.tags),(r==null?void 0:r.isPublic)!==void 0&&(o.is_public=r.isPublic),(r==null?void 0:r.isArchived)!==void 0&&(o.is_archived=r.isArchived),Object.keys(o).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(me(),`${this.apiUrl}/repos/${n}/${a}`,{method:"PATCH",body:JSON.stringify(o),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,n,a]=ln(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("delete a prompt",r);return await(await this.caller.call(me(),`${this.apiUrl}/repos/${r}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,r){const[n,a,o]=ln(e),i=await this._getServerInfo(),s=tM(i.version,"0.5.23");let l=o;if(!s&&o==="latest"){const u=await this._getLatestCommitHash(`${n}/${a}`);if(u)l=u;else throw new Error("No commits found")}const c=await this.caller.call(me(),`${this.apiUrl}/commits/${n}/${a}/${l}${r!=null&&r.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(c,"pull prompt commit");const d=await c.json();return{owner:n,repo:a,commit_hash:d.commit_hash,manifest:d.manifest,examples:d.examples}}async _pullPrompt(e,r){const n=await this.pullPromptCommit(e,{includeModel:r==null?void 0:r.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,r){return await this.promptExists(e)?r&&Object.keys(r).some(n=>n!=="object")&&await this.updatePrompt(e,{description:r==null?void 0:r.description,readme:r==null?void 0:r.readme,tags:r==null?void 0:r.tags,isPublic:r==null?void 0:r.isPublic}):await this.createPrompt(e,{description:r==null?void 0:r.description,readme:r==null?void 0:r.readme,tags:r==null?void 0:r.tags,isPublic:r==null?void 0:r.isPublic}),r!=null&&r.object?await this.createCommit(e,r==null?void 0:r.object,{parentCommitHash:r==null?void 0:r.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,r={}){const{sourceApiUrl:n=this.apiUrl,datasetName:a}=r,[o,i]=this.parseTokenOrUrl(e,n),s=new oi({apiUrl:o,apiKey:"placeholder"}),l=await s.readSharedDataset(i),c=a||l.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const d=await s.listSharedExamples(i),u=await this.createDataset(c,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:d.map(h=>h.inputs),outputs:d.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:u.id})}catch(h){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),h}}parseTokenOrUrl(e,r,n=2,a="dataset"){try{return Re(e),[r,e]}catch{}try{const o=new URL(e).pathname.split("/").filter(i=>i!=="");if(o.length>=n){const i=o[o.length-n];return[r,i]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}}const hM=t=>!!["TRACING_V2","TRACING"].find(e=>$n(e)==="true");function pM(t){return t.replace(/[-:.]/g,"")}function fM(t,e,r=1){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return pM(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}class il{constructor(e,r){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=r}static fromHeader(e){const r=e.split(",");let n={},a=[];for(const o of r){const[i,s]=o.split("="),l=decodeURIComponent(s);i==="langsmith-metadata"?n=JSON.parse(l):i==="langsmith-tags"&&(a=l.split(","))}return new il(n,a)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class Mt{constructor(e){var s;Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=Mt.getDefaultConfig(),{metadata:n,...a}=e,o=a.client??Mt.getSharedClient(),i={...n,...(s=a==null?void 0:a.extra)==null?void 0:s.metadata};if(a.extra={...a.extra,metadata:i},Object.assign(this,{...r,...a,client:o}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=fM(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}static getDefaultConfig(){return{id:At(),run_type:"chain",project_name:Dn("LANGCHAIN_PROJECT")??Dn("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Dn("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Dn("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Mt.sharedClient||(Mt.sharedClient=new oi),Mt.sharedClient}createChild(e){var l,c,d,u,h,p;const r=this.child_execution_order+1,n=new Mt({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r}),a=Symbol.for("lc:child_config"),o=((l=e.extra)==null?void 0:l[a])??this.extra[a];if(gM(o)){const f={...o},g=mM(f.callbacks)?(d=(c=f.callbacks).copy)==null?void 0:d.call(c):void 0;g&&(Object.assign(g,{_parentRunId:n.id}),(p=(h=(u=g.handlers)==null?void 0:u.find(X_))==null?void 0:h.updateFromRunTree)==null||p.call(h,n),f.callbacks=g),n.extra[a]=f}const i=new Set;let s=this;for(;s!=null&&!i.has(s.id);)i.add(s.id),s.child_execution_order=Math.max(s.child_execution_order,r),s=s.parent_run;return this.child_runs.push(n),n}async end(e,r,n=Date.now()){this.outputs=this.outputs??e,this.error=this.error??r,this.end_time=this.end_time??n}_convertToCreate(e,r,n=!0){var s;const a=e.extra??{};if(a.runtime||(a.runtime={}),r)for(const[l,c]of Object.entries(r))a.runtime[l]||(a.runtime[l]=c);let o,i;return n?(i=(s=e.parent_run)==null?void 0:s.id,o=[]):(o=e.child_runs.map(l=>this._convertToCreate(l,r,n)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:o,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){try{const r=await Yv(),n=await this._convertToCreate(this,r,!0);if(await this.client.createRun(n),!e){Qv("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const a of this.child_runs)await a.postRun(!1)}}catch(r){console.error(`Error in postRun for run ${this.id}:`,r)}}async patchRun(){var e;try{const r={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,r)}catch(r){console.error(`Error in patchRun for run ${this.id}`,r)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,r){var l,c,d,u;const n=e==null?void 0:e.callbacks;let a,o,i,s=hM();if(n){const h=((l=n==null?void 0:n.getParentRunId)==null?void 0:l.call(n))??"",p=(c=n==null?void 0:n.handlers)==null?void 0:c.find(f=>(f==null?void 0:f.name)=="langchain_tracer");a=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,h),o=p==null?void 0:p.projectName,i=p==null?void 0:p.client,s=s||!!p}return a?new Mt({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:i,tracingEnabled:s,project_name:o,tags:[...new Set(((a==null?void 0:a.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(u=a==null?void 0:a.extra)==null?void 0:u.metadata,...e==null?void 0:e.metadata}}}).createChild(r):new Mt({...r,client:i,tracingEnabled:s,project_name:o})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,r){var c;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=n["langsmith-trace"];if(!a||typeof a!="string")return;const o=a.trim(),i=o.split(".").map(d=>{const[u,h]=d.split("Z");return{strTime:u,time:Date.parse(u+"Z"),uuid:h}}),s=i[0].uuid,l={...r,name:(r==null?void 0:r.name)??"parent",run_type:(r==null?void 0:r.run_type)??"chain",start_time:(r==null?void 0:r.start_time)??Date.now(),id:(c=i.at(-1))==null?void 0:c.uuid,trace_id:s,dotted_order:o};if(n.baggage&&typeof n.baggage=="string"){const d=il.fromHeader(n.baggage);l.metadata=d.metadata,l.tags=d.tags}return new Mt(l)}toHeaders(e){var n;const r={"langsmith-trace":this.dotted_order,baggage:new il((n=this.extra)==null?void 0:n.metadata,this.tags).toHeader()};if(e)for(const[a,o]of Object.entries(r))e.set(a,o);return r}}Object.defineProperty(Mt,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function X_(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function Q_(t){return Array.isArray(t)&&t.some(e=>X_(e))}function mM(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function gM(t){var e;return t!==void 0&&typeof t.callbacks=="object"&&(Q_((e=t.callbacks)==null?void 0:e.handlers)||Q_(t.callbacks))}const ew="0.1.61";var hh={exports:{}};hh.exports;var tw;function yM(){return tw||(tw=1,function(t){const e=(a=0)=>o=>`\x1B[${38+a};5;${o}m`,r=(a=0)=>(o,i,s)=>`\x1B[${38+a};2;${o};${i};${s}m`;function n(){const a=new Map,o={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};o.color.gray=o.color.blackBright,o.bgColor.bgGray=o.bgColor.bgBlackBright,o.color.grey=o.color.blackBright,o.bgColor.bgGrey=o.bgColor.bgBlackBright;for(const[i,s]of Object.entries(o)){for(const[l,c]of Object.entries(s))o[l]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},s[l]=o[l],a.set(c[0],c[1]);Object.defineProperty(o,i,{value:s,enumerable:!1})}return Object.defineProperty(o,"codes",{value:a,enumerable:!1}),o.color.close="\x1B[39m",o.bgColor.close="\x1B[49m",o.color.ansi256=e(),o.color.ansi16m=r(),o.bgColor.ansi256=e(10),o.bgColor.ansi16m=r(10),Object.defineProperties(o,{rgbToAnsi256:{value:(i,s,l)=>i===s&&s===l?i<8?16:i>248?231:Math.round((i-8)/247*24)+232:16+36*Math.round(i/255*5)+6*Math.round(s/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:i=>{const s=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(i.toString(16));if(!s)return[0,0,0];let{colorString:l}=s.groups;l.length===3&&(l=l.split("").map(d=>d+d).join(""));const c=Number.parseInt(l,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:i=>o.rgbToAnsi256(...o.hexToRgb(i)),enumerable:!1}}),o}Object.defineProperty(t,"exports",{enumerable:!0,get:n})}(hh)),hh.exports}var vM=yM();const rw=Xa(vM);function ht(t,e){return`${t.open}${e}${t.close}`}function It(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function nw(t){return typeof t=="string"?t.trim():t==null?t:It(t,t.toString())}function cn(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:yt}=rw;class aw extends ei{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const r=[];let n=e;for(;n.parent_run_id;){const a=this.runMap.get(n.parent_run_id);if(a)r.push(a),n=a;else break}return r}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((n,a,o)=>{const i=`${n.execution_order}:${n.run_type}:${n.name}`;return a===o.length-1?ht(rw.bold,i):i}).join(" > ");return ht(yt.grey,r)}onChainStart(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.green,"[chain/start]")} [${r}] Entering Chain run with input: ${It(e.inputs,"[inputs]")}`)}onChainEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.cyan,"[chain/end]")} [${r}] [${cn(e)}] Exiting Chain run with output: ${It(e.outputs,"[outputs]")}`)}onChainError(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.red,"[chain/error]")} [${r}] [${cn(e)}] Chain run errored with error: ${It(e.error,"[error]")}`)}onLLMStart(e){const r=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${ht(yt.green,"[llm/start]")} [${r}] Entering LLM run with input: ${It(n,"[inputs]")}`)}onLLMEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.cyan,"[llm/end]")} [${r}] [${cn(e)}] Exiting LLM run with output: ${It(e.outputs,"[response]")}`)}onLLMError(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.red,"[llm/error]")} [${r}] [${cn(e)}] LLM run errored with error: ${It(e.error,"[error]")}`)}onToolStart(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.green,"[tool/start]")} [${r}] Entering Tool run with input: "${nw(e.inputs.input)}"`)}onToolEnd(e){var n;const r=this.getBreadcrumbs(e);console.log(`${ht(yt.cyan,"[tool/end]")} [${r}] [${cn(e)}] Exiting Tool run with output: "${nw((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.red,"[tool/error]")} [${r}] [${cn(e)}] Tool run errored with error: ${It(e.error,"[error]")}`)}onRetrieverStart(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.green,"[retriever/start]")} [${r}] Entering Retriever run with input: ${It(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.cyan,"[retriever/end]")} [${r}] [${cn(e)}] Exiting Retriever run with output: ${It(e.outputs,"[outputs]")}`)}onRetrieverError(e){const r=this.getBreadcrumbs(e);console.log(`${ht(yt.red,"[retriever/error]")} [${r}] [${cn(e)}] Retriever run errored with error: ${It(e.error,"[error]")}`)}onAgentAction(e){const r=e,n=this.getBreadcrumbs(e);console.log(`${ht(yt.blue,"[agent/action]")} [${n}] Agent selected action: ${It(r.actions[r.actions.length-1],"[action]")}`)}}function ow(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}class _M extends Error{constructor(e,r){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=r}}Gb=function(t,e=hc){t=t.trim();const r=/```(json)?(.*)```/s.exec(t);return e(r?r[2]:t)},hc=function(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const r=[];let n=!1,a=!1;for(let o of t){if(n)o==='"'&&!a?n=!1:o===`
`&&!a?o="\\n":o==="\\"?a=!a:a=!1;else if(o==='"')n=!0,a=!1;else if(o==="{")r.push("}");else if(o==="[")r.push("]");else if(o==="}"||o==="]")if(r&&r[r.length-1]===o)r.pop();else return null;e+=o}n&&(e+='"');for(let o=r.length-1;o>=0;o-=1)e+=r[o];try{return JSON.parse(e)}catch{return null}};function Pa(t,e){return typeof t=="string"?typeof e=="string"?t+e:[{type:"text",text:t},...e]:Array.isArray(e)?sl(t,e)??[...t,...e]:[...t,{type:"text",text:e}]}function wM(t,e){return t==="error"||e==="error"?"error":"success"}function bM(t,e){function r(n,a){if(typeof n!="object"||n===null||n===void 0)return n;if(a>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>r(i,a+1));const o={};for(const i of Object.keys(n))o[i]=r(n[i],a+1);return o}return JSON.stringify(r(t,0),null,2)}class Oa extends bn{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,r){typeof e=="string"&&(e={content:e,additional_kwargs:r,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const r=bM(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${r}`}}function pt(t,e){const r={...t};for(const[n,a]of Object.entries(e))if(r[n]==null)r[n]=a;else{if(a==null)continue;if(typeof r[n]!=typeof a||Array.isArray(r[n])!==Array.isArray(a))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof r[n]=="string"){if(n==="type")continue;r[n]+=a}else if(typeof r[n]=="object"&&!Array.isArray(r[n]))r[n]=pt(r[n],a);else if(Array.isArray(r[n]))r[n]=sl(r[n],a);else{if(r[n]===a)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return r}function sl(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const r=[...t];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const a=r.findIndex(o=>o.index===n.index);a!==-1?r[a]=pt(r[a],n):r.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;r.push(n)}return r}}}function EM(t,e){if(!t&&!e)throw new Error("Cannot merge two undefined objects.");if(!t||!e)return t||e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return sl(t,e);if(typeof t=="object"&&typeof e=="object")return pt(t,e);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}class Ia extends Oa{}function SM(t){return typeof t.role=="string"}uc=function(t){return typeof(t==null?void 0:t._getType)=="function"},Hb=function(t){return uc(t)&&typeof t.concat=="function"};class xM extends Oa{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,r,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:r}),super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}jp=class extends Ia{constructor(t){super(t),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=t.tool_call_id,this.artifact=t.artifact,this.status=t.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(t){return new jp({content:Pa(this.content,t.content),additional_kwargs:pt(this.additional_kwargs,t.additional_kwargs),response_metadata:pt(this.response_metadata,t.response_metadata),artifact:EM(this.artifact,t.artifact),tool_call_id:this.tool_call_id,id:this.id??t.id,status:wM(this.status,t.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function kM(t){const e=[],r=[];for(const n of t)if(n.function){const a=n.function.name;try{const o=JSON.parse(n.function.arguments),i={name:a||"",args:o||{},id:n.id};e.push(i)}catch{r.push({name:a,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,r]}Qn=class extends Oa{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(t,e){var n;let r;if(typeof t=="string")r={content:t,tool_calls:[],invalid_tool_calls:[],additional_kwargs:e??{}};else{r=t;const a=(n=r.additional_kwargs)==null?void 0:n.tool_calls,o=r.tool_calls;a!=null&&a.length>0&&(o===void 0||o.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&o===void 0){const[i,s]=kM(a);r.tool_calls=i??[],r.invalid_tool_calls=s??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}},Vb=function(t){return t._getType()==="ai"},uo=class extends Ia{constructor(t){let e;if(typeof t=="string")e={content:t,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(t.tool_call_chunks===void 0)e={...t,tool_calls:t.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{const r=[],n=[];for(const a of t.tool_call_chunks){let o={};try{if(o=hc(a.args||"{}"),o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:o,id:a.id,type:"tool_call"})}catch{n.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}e={...t,tool_calls:r,invalid_tool_calls:n}}super(e),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=e.tool_call_chunks??this.tool_call_chunks,this.tool_calls=e.tool_calls??this.tool_calls,this.invalid_tool_calls=e.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=e.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(t){const e={content:Pa(this.content,t.content),additional_kwargs:pt(this.additional_kwargs,t.additional_kwargs),response_metadata:pt(this.response_metadata,t.response_metadata),tool_call_chunks:[],id:this.id??t.id};if(this.tool_call_chunks!==void 0||t.tool_call_chunks!==void 0){const r=sl(this.tool_call_chunks,t.tool_call_chunks);r!==void 0&&r.length>0&&(e.tool_call_chunks=r)}if(this.usage_metadata!==void 0||t.usage_metadata!==void 0){const r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},n=t.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a={input_tokens:r.input_tokens+n.input_tokens,output_tokens:r.output_tokens+n.output_tokens,total_tokens:r.total_tokens+n.total_tokens};e.usage_metadata=a}return new uo(e)}},Kl=class extends Oa{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Kl}constructor(t,e){typeof t=="string"&&(t={content:t,role:e}),super(t),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t.role}_getType(){return"generic"}static isInstance(t){return t._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},ec=class extends Ia{static lc_name(){return"ChatMessageChunk"}constructor(t,e){typeof t=="string"&&(t={content:t,role:e}),super(t),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t.role}_getType(){return"generic"}concat(t){return new ec({content:Pa(this.content,t.content),additional_kwargs:pt(this.additional_kwargs,t.additional_kwargs),response_metadata:pt(this.response_metadata,t.response_metadata),role:this.role,id:this.id??t.id})}get _printableFields(){return{...super._printableFields,role:this.role}}},Ql=class extends Ia{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(t){return new Ql({content:Pa(this.content,t.content),additional_kwargs:pt(this.additional_kwargs,t.additional_kwargs),response_metadata:pt(this.response_metadata,t.response_metadata),name:this.name??"",id:this.id??t.id})}},ao=class extends Oa{static lc_name(){return"HumanMessage"}_getType(){return"human"}},Yl=class extends Ia{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(t){return new Yl({content:Pa(this.content,t.content),additional_kwargs:pt(this.additional_kwargs,t.additional_kwargs),response_metadata:pt(this.response_metadata,t.response_metadata),id:this.id??t.id})}},Mi=class extends Oa{static lc_name(){return"SystemMessage"}_getType(){return"system"}},Xl=class extends Ia{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(t){return new Xl({content:Pa(this.content,t.content),additional_kwargs:pt(this.additional_kwargs,t.additional_kwargs),response_metadata:pt(this.response_metadata,t.response_metadata),id:this.id??t.id})}};function TM(t){return ow(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function ph(t){const{type:e,...r}=t;if(e==="human"||e==="user")return new ao(r);if(e==="ai"||e==="assistant"){const{tool_calls:n,...a}=r;if(!Array.isArray(n))return new Qn(r);const o=n.map(TM);return new Qn({...a,tool_calls:o})}else{if(e==="system")return new Mi(r);if(e==="tool"&&"tool_call_id"in r)return new xM({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}}zb=function(t){if(typeof t=="string")return new ao(t);if(uc(t))return t;if(Array.isArray(t)){const[e,r]=t;return ph({type:e,content:r})}else if(SM(t)){const{role:e,...r}=t;return ph({...r,type:e})}else return ph(t)},Gp=function(t,e="Human",r="AI"){const n=[];for(const a of t){let o;if(a._getType()==="human")o=e;else if(a._getType()==="ai")o=r;else if(a._getType()==="system")o="System";else if(a._getType()==="function")o="Function";else if(a._getType()==="tool")o="Tool";else if(a._getType()==="generic")o=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);const i=a.name?`${a.name}, `:"",s=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);n.push(`${o}: ${i}${s}`)}return n.join(`
`)},Wb=function(t){var r;const e=t._getType();if(e==="human")return new Yl({...t});if(e==="ai"){let n={...t};return"tool_calls"in n&&(n={...n,tool_call_chunks:(r=n.tool_calls)==null?void 0:r.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new uo({...n})}else{if(e==="system")return new Xl({...t});if(e==="function")return new Ql({...t});if(Kl.isInstance(t))return new ec({...t});throw new Error("Unknown message type.")}};class ii extends ei{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:r,projectName:n,client:a}=e;this.projectName=n??_n("LANGCHAIN_PROJECT")??_n("LANGCHAIN_SESSION"),this.exampleId=r,this.client=a??new oi({});const o=ii.getTraceableRunTree();o&&this.updateFromRunTree(o)}async _convertToCreate(e,r=void 0){return{...e,extra:{...e.extra,runtime:await sA()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:r}}async persistRun(e){}async onRunCreate(e){const r=await this._convertToCreate(e,this.exampleId);await this.client.createRun(r)}async onRunUpdate(e){const r={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,r)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let r=e;const n=new Set;for(;r.parent_run&&!(n.has(r.id)||(n.add(r.id),!r.parent_run));)r=r.parent_run;n.clear();const a=[r];for(;a.length>0;){const o=a.shift();!o||n.has(o.id)||(n.add(o.id),this.runMap.set(o.id,o),o.child_runs&&a.push(...o.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const r={},n=[];for(const[a,o]of this.runMap){const i=new Mt({...o,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});r[a]=i,n.push([a,o.dotted_order])}n.sort((a,o)=>!a[1]||!o[1]?0:a[1].localeCompare(o[1]));for(const[a]of n){const o=this.runMap.get(a),i=r[a];if(!(!o||!i)&&o.parent_run_id){const s=r[o.parent_run_id];s&&(s.child_runs.push(i),i.parent_run=s)}}return r[e]}static getTraceableRunTree(){try{return $T()}catch{return}}}let fh;function AM(){const t="default"in Dr?Dr.default:Dr;return new t({autoStart:!0,concurrency:1})}async function rt(t,e){e===!0?await t():(typeof fh>"u"&&(fh=AM()),fh.add(t))}const MM=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>_n(e)==="true");function RM(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}class FM{setHandler(e){return this.setHandlers([e])}}class ll{constructor(e,r,n,a,o,i,s,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;try{await((n=r.handleText)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleText: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleCustomEvent(e,r,n,a,o){await Promise.all(this.handlers.map(i=>rt(async()=>{var s;try{await((s=i.handleCustomEvent)==null?void 0:s.call(i,e,r,this.runId,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class NM extends ll{getChild(e){const r=new Bt(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;if(!r.ignoreRetriever)try{await((n=r.handleRetrieverEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetriever`),r.raiseError)throw a}},r.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;if(!r.ignoreRetriever)try{await((n=r.handleRetrieverError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetrieverError: ${a}`),r.raiseError)throw e}},r.awaitHandlers)))}}class iw extends ll{async handleLLMNewToken(e,r,n,a,o,i){await Promise.all(this.handlers.map(s=>rt(async()=>{var l;if(!s.ignoreLLM)try{await((l=s.handleLLMNewToken)==null?void 0:l.call(s,e,r??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMNewToken: ${c}`),s.raiseError)throw c}},s.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;if(!r.ignoreLLM)try{await((n=r.handleLLMError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMError: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;if(!r.ignoreLLM)try{await((n=r.handleLLMEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMEnd: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}}class PM extends ll{getChild(e){const r=new Bt(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleChainError(e,r,n,a,o){await Promise.all(this.handlers.map(i=>rt(async()=>{var s;if(!i.ignoreChain)try{await((s=i.handleChainError)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleChainEnd(e,r,n,a,o){await Promise.all(this.handlers.map(i=>rt(async()=>{var s;if(!i.ignoreChain)try{await((s=i.handleChainEnd)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleAgentAction)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleAgentAction: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleAgentEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleAgentEnd: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}}class OM extends ll{getChild(e){const r=new Bt(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleToolError(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleToolError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolError: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(r=>rt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleToolEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolEnd: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}}Bt=class extends FM{constructor(t,e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(e==null?void 0:e.handlers)??this.handlers,this.inheritableHandlers=(e==null?void 0:e.inheritableHandlers)??this.inheritableHandlers,this.tags=(e==null?void 0:e.tags)??this.tags,this.inheritableTags=(e==null?void 0:e.inheritableTags)??this.inheritableTags,this.metadata=(e==null?void 0:e.metadata)??this.metadata,this.inheritableMetadata=(e==null?void 0:e.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=t}getParentRunId(){return this._parentRunId}async handleLLMStart(t,e,r=void 0,n=void 0,a=void 0,o=void 0,i=void 0,s=void 0){return Promise.all(e.map(async(l,c)=>{const d=c===0&&r?r:At();return await Promise.all(this.handlers.map(u=>{if(!u.ignoreLLM)return Qo(u)&&u._createRunForLLMStart(t,[l],d,this._parentRunId,a,this.tags,this.metadata,s),rt(async()=>{var h;try{await((h=u.handleLLMStart)==null?void 0:h.call(u,t,[l],d,this._parentRunId,a,this.tags,this.metadata,s))}catch(p){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleLLMStart: ${p}`),u.raiseError)throw p}},u.awaitHandlers)})),new iw(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(t,e,r=void 0,n=void 0,a=void 0,o=void 0,i=void 0,s=void 0){return Promise.all(e.map(async(l,c)=>{const d=c===0&&r?r:At();return await Promise.all(this.handlers.map(u=>{if(!u.ignoreLLM)return Qo(u)&&u._createRunForChatModelStart(t,[l],d,this._parentRunId,a,this.tags,this.metadata,s),rt(async()=>{var h,p;try{if(u.handleChatModelStart)await((h=u.handleChatModelStart)==null?void 0:h.call(u,t,[l],d,this._parentRunId,a,this.tags,this.metadata,s));else if(u.handleLLMStart){const f=Gp(l);await((p=u.handleLLMStart)==null?void 0:p.call(u,t,[f],d,this._parentRunId,a,this.tags,this.metadata,s))}}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleLLMStart: ${f}`),u.raiseError)throw f}},u.awaitHandlers)})),new iw(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(t,e,r=At(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreChain)return Qo(s)&&s._createRunForChainStart(t,e,r,this._parentRunId,this.tags,this.metadata,n,i),rt(async()=>{var l;try{await((l=s.handleChainStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,n,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new PM(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(t,e,r=At(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreAgent)return Qo(s)&&s._createRunForToolStart(t,e,r,this._parentRunId,this.tags,this.metadata,i),rt(async()=>{var l;try{await((l=s.handleToolStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleToolStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new OM(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(t,e,r=At(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreRetriever)return Qo(s)&&s._createRunForRetrieverStart(t,e,r,this._parentRunId,this.tags,this.metadata,i),rt(async()=>{var l;try{await((l=s.handleRetrieverStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleRetrieverStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new NM(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(t,e,r,n,a){await Promise.all(this.handlers.map(o=>rt(async()=>{var i;if(!o.ignoreCustomEvent)try{await((i=o.handleCustomEvent)==null?void 0:i.call(o,t,e,r,this.tags,this.metadata))}catch(s){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${s}`),o.raiseError)throw s}},o.awaitHandlers)))}addHandler(t,e=!0){this.handlers.push(t),e&&this.inheritableHandlers.push(t)}removeHandler(t){this.handlers=this.handlers.filter(e=>e!==t),this.inheritableHandlers=this.inheritableHandlers.filter(e=>e!==t)}setHandlers(t,e=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of t)this.addHandler(r,e)}addTags(t,e=!0){this.removeTags(t),this.tags.push(...t),e&&this.inheritableTags.push(...t)}removeTags(t){this.tags=this.tags.filter(e=>!t.includes(e)),this.inheritableTags=this.inheritableTags.filter(e=>!t.includes(e))}addMetadata(t,e=!0){this.metadata={...this.metadata,...t},e&&(this.inheritableMetadata={...this.inheritableMetadata,...t})}removeMetadata(t){for(const e of Object.keys(t))delete this.metadata[e],delete this.inheritableMetadata[e]}copy(t=[],e=!0){const r=new Bt(this._parentRunId);for(const n of this.handlers){const a=this.inheritableHandlers.includes(n);r.addHandler(n,a)}for(const n of this.tags){const a=this.inheritableTags.includes(n);r.addTags([n],a)}for(const n of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(n);r.addMetadata({[n]:this.metadata[n]},a)}for(const n of t)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===n.name)||r.addHandler(n,e);return r}static fromHandlers(t){class e extends Xo{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:At()}),Object.assign(this,t)}}const r=new this;return r.addHandler(new e),r}static configure(t,e,r,n,a,o,i){return this._configureSync(t,e,r,n,a,o,i)}static _configureSync(t,e,r,n,a,o,i){var u,h;let s;(t||e)&&(Array.isArray(t)||!t?(s=new Bt,s.setHandlers((t==null?void 0:t.map(cl))??[],!0)):s=t,s=s.copy(Array.isArray(e)?e.map(cl):e==null?void 0:e.handlers,!1));const l=_n("LANGCHAIN_VERBOSE")==="true"||(i==null?void 0:i.verbose),c=((u=ii.getTraceableRunTree())==null?void 0:u.tracingEnabled)||MM(),d=c||(_n("LANGCHAIN_TRACING")??!1);if(l||d){if(s||(s=new Bt),l&&!s.handlers.some(p=>p.name===aw.prototype.name)){const p=new aw;s.addHandler(p,!0)}if(d&&!s.handlers.some(p=>p.name==="langchain_tracer")&&c){const p=new ii;s.addHandler(p,!0),s._parentRunId=((h=ii.getTraceableRunTree())==null?void 0:h.id)??s._parentRunId}}return(r||n)&&s&&(s.addTags(r??[]),s.addTags(n??[],!1)),(a||o)&&s&&(s.addMetadata(a??{}),s.addMetadata(o??{},!1)),s}};function cl(t){return"name"in t?t:Xo.fromMethods(t)}class IM{getStore(){}run(e,r){return r()}}const CM=new IM,mh=Symbol.for("ls:tracing_async_local_storage"),sw=Symbol.for("lc:child_config");class jM{getInstance(){return globalThis[mh]??CM}getRunnableConfig(){var e,r;return(r=(e=this.getInstance().getStore())==null?void 0:e.extra)==null?void 0:r[sw]}runWithConfig(e,r,n){var c;const a=Bt._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),o=this.getInstance(),i=a==null?void 0:a.getParentRunId(),s=(c=a==null?void 0:a.handlers)==null?void 0:c.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let l;return s&&i?l=s.convertToRunTree(i):n||(l=new Mt({name:"<runnable_lambda>",tracingEnabled:!1})),l&&(l.extra={...l.extra,[sw]:e}),o.run(l,r)}initializeGlobalInstance(e){globalThis[mh]===void 0&&(globalThis[mh]=e)}}const Un=new jM;async function dn(t,e){if(e===void 0)return t;let r;return Promise.race([t.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,a)=>{r=()=>{a(new Error("Aborted"))},e.addEventListener("abort",r),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",r))}class Rt extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const r=this.reader.cancel();this.reader.releaseLock(),await r}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const r=e.getReader();return new Rt({start(n){return a();function a(){return r.read().then(({done:o,value:i})=>{if(o){n.close();return}return n.enqueue(i),a()})}},cancel(){r.releaseLock()}})}static fromAsyncGenerator(e){return new Rt({async pull(r){const{value:n,done:a}=await e.next();a&&r.close(),r.enqueue(n)},async cancel(r){await e.return(r)}})}}function lw(t,e=2){const r=Array.from({length:e},()=>[]);return r.map(async function*(n){for(;;)if(n.length===0){const a=await t.next();for(const o of r)o.push(a)}else{if(n[0].done)return;yield n.shift().value}})}dr=function(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string"||typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const r={...t};for(const[n,a]of Object.entries(e))n in r&&!Array.isArray(r[n])?r[n]=dr(r[n],a):r[n]=a;return r}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)};class Ca{constructor(e){var r;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((r=this.config)==null?void 0:r.signal),this.setup=new Promise((n,a)=>{Un.runWithConfig(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,a):this.firstResult.then(o=>n(void 0),a)},!0)})}async next(...e){var r;return(r=this.signal)==null||r.throwIfAborted(),this.firstResultUsed?Un.runWithConfig(this.config,this.signal?async()=>dn(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function LM(t,e,r,n,...a){const o=new Ca({generator:e,startSetup:r,signal:n}),i=await o.setup;return{output:t(o,i,...a),setup:i}}class un{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const r=this.ops.concat(e.ops),n=qs({},r);return new si({ops:r,state:n[n.length-1].newDocument})}}class si extends un{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const r=this.ops.concat(e.ops),n=qs(this.state,e.ops);return new si({ops:r,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const r=qs({},e.ops);return new si({ops:e.ops,state:r[r.length-1].newDocument})}}Zp=t=>t.name==="log_stream_tracer";async function cw(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:r}=t;if(["retriever","llm","prompt"].includes(t.run_type))return r;if(!(Object.keys(r).length===1&&(r==null?void 0:r.input)===""))return r.input}async function dw(t,e){const{outputs:r}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?r:r!==void 0&&Object.keys(r).length===1&&(r==null?void 0:r.output)!==void 0?r.output:r}function DM(t){return t!==void 0&&t.message!==void 0}class uw extends ei{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Rt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||r.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&r.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,r){for await(const n of r){if(e!==this.rootId){const a=this.keyMapByRunId[e];a&&await this.writer.write(new un({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new un({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const r=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=r===1?e.name:`${e.name}:${r}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await cw(e,this._schemaFormat)),await this.writer.write(new un({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const r=this.keyMapByRunId[e.id];if(r===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${r}/inputs`,value:await cw(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${r}/final_output`,value:await dw(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${r}/end_time`,value:new Date(e.end_time).toISOString()});const a=new un({ops:n});await this.writer.write(a)}finally{if(e.id===this.rootId){const r=new un({ops:[{op:"replace",path:"/final_output",value:await dw(e,this._schemaFormat)}]});await this.writer.write(r),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,r,n){const a=this.keyMapByRunId[e.id];if(a===void 0)return;const o=e.inputs.messages!==void 0;let i;o?DM(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new uo({id:`run-${e.id}`,content:r}):i=r;const s=new un({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:r},{op:"add",path:`/logs/${a}/streamed_output/-`,value:i}]});await this.writer.write(s)}}Bb="__run",po=class{constructor(t){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=t.text,this.generationInfo=t.generationInfo}concat(t){return new po({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo}})}},Kp=class extends po{constructor(t){super(t),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=t.message}concat(t){return new Kp({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};function dl({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}qp=t=>t.name==="event_stream_tracer";class $M extends ei{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Rt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||r.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&r.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,r){const n=await r.next();if(n.done)return;const a=this.runInfoMap.get(e);if(a===void 0){yield n.value;return}function o(s,l){return s==="llm"&&typeof l=="string"?new po({text:l}):l}let i=this.tappedPromises.get(e);if(i===void 0){let s;i=new Promise(l=>{s=l}),this.tappedPromises.set(e,i);try{const l={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...l,data:{chunk:o(a.runType,n.value)}},a),yield n.value;for await(const c of r)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...l,data:{chunk:o(a.runType,c)}},a),yield c}finally{s()}}else{yield n.value;for await(const s of r)yield s}}async send(e,r){this._includeRun(r)&&await this.writer.write(e)}async sendEndEvent(e,r){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,r)}):await this.send(e,r)}async onLLMStart(e){var i,s;const r=dl(e),n=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,a);const o=`on_${n}_start`;await this.send({event:o,data:{input:e.inputs},name:r,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},a)}async onLLMNewToken(e,r,n){const a=this.runInfoMap.get(e.id);let o,i;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?o=new uo({content:r,id:`run-${e.id}`}):o=n.chunk.message;else if(a.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?o=new po({text:r}):o=n.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:i,data:{chunk:o},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){var i,s,l;const r=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(r===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const a=(i=e.outputs)==null?void 0:i.generations;let o;if(r.runType==="chat_model"){for(const c of a??[]){if(o!==void 0)break;o=(s=c[0])==null?void 0:s.message}n="on_chat_model_end"}else if(r.runType==="llm")o={generations:a==null?void 0:a.map(c=>c.map(d=>({text:d.text,generationInfo:d.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${r.runType}`);await this.sendEndEvent({event:n,data:{output:o,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onChainStart(e){var i,s;const r=dl(e),n=e.run_type??"chain",a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:e.run_type};let o={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(o={},a.inputs={}):e.inputs.input!==void 0?(o.input=e.inputs.input,a.inputs=e.inputs.input):(o.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${n}_start`,data:o,name:r,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},a)}async onChainEnd(e){var i;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,a=e.inputs??r.inputs??{},o={output:((i=e.outputs)==null?void 0:i.output)??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(o.input=a.input,r.inputs=a.input),await this.sendEndEvent({event:n,data:o,run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata??{}},r)}async onToolStart(e){var a,o;const r=dl(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:r,run_id:e.id,tags:e.tags??[],metadata:((o=e.extra)==null?void 0:o.metadata)??{}},n)}async onToolEnd(e){var a;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(r.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((a=e.outputs)==null?void 0:a.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onRetrieverStart(e){var a,o;const r=dl(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,n),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:r,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},n)}async onRetrieverEnd(e){var n;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async handleCustomEvent(e,r,n){const a=this.runInfoMap.get(n);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:a.tags,metadata:a.metadata,data:r},a)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const gh=25;async function er(t){return Bt._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function hw(...t){const e={};for(const r of t.filter(n=>!!n))for(const n of Object.keys(r))if(n==="metadata")e[n]={...e[n],...r[n]};else if(n==="tags"){const a=e[n]??[];e[n]=[...new Set(a.concat(r[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...r[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=r.timeout:r.timeout!==void 0&&(e.timeout=Math.min(e.timeout,r.timeout));else if(n==="signal")e.signal===void 0?e.signal=r.signal:r.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,r.signal]):e.signal=r.signal);else if(n==="callbacks"){const a=e.callbacks,o=r.callbacks;if(Array.isArray(o))if(!a)e.callbacks=o;else if(Array.isArray(a))e.callbacks=a.concat(o);else{const i=a.copy();for(const s of o)i.addHandler(cl(s),!0);e.callbacks=i}else if(o)if(!a)e.callbacks=o;else if(Array.isArray(a)){const i=o.copy();for(const s of a)i.addHandler(cl(s),!0);e.callbacks=i}else e.callbacks=new Bt(o._parentRunId,{handlers:a.handlers.concat(o.handlers),inheritableHandlers:a.inheritableHandlers.concat(o.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(o.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(o.inheritableTags))),metadata:{...a.metadata,...o.metadata}})}else{const a=n;e[a]=r[a]??e[a]}return e}const UM=new Set(["string","number","boolean"]);Pe=function(t){var n;const e=Un.getRunnableConfig();let r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:a,runName:o,...i}=e;r=Object.entries(i).reduce((s,[l,c])=>(c!==void 0&&(s[l]=c),s),r)}if(t&&(r=Object.entries(t).reduce((a,[o,i])=>(i!==void 0&&(a[o]=i),a),r)),r==null?void 0:r.configurable)for(const a of Object.keys(r.configurable))UM.has(typeof r.configurable[a])&&!((n=r.metadata)!=null&&n[a])&&(r.metadata||(r.metadata={}),r.metadata[a]=r.configurable[a]);if(r.timeout!==void 0){if(r.timeout<=0)throw new Error("Timeout must be a positive number");const a=AbortSignal.timeout(r.timeout);r.signal!==void 0?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,a])):r.signal=a,delete r.timeout}return r};function ct(t={},{callbacks:e,maxConcurrency:r,recursionLimit:n,runName:a,configurable:o,runId:i}={}){const s=Pe(t);return e!==void 0&&(delete s.runName,s.callbacks=e),n!==void 0&&(s.recursionLimit=n),r!==void 0&&(s.maxConcurrency=r),a!==void 0&&(s.runName=a),o!==void 0&&(s.configurable={...s.configurable,...o}),i!==void 0&&delete s.runId,s}const zM=[400,401,402,403,404,405,406,407,409],BM=t=>{var r,n;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((r=t==null?void 0:t.response)==null?void 0:r.status)??(t==null?void 0:t.status);if(e&&zM.includes(+e))throw t;if(((n=t==null?void 0:t.error)==null?void 0:n.code)==="insufficient_quota"){const a=new Error(t==null?void 0:t.message);throw a.name="InsufficientQuotaError",a}};Li=class{constructor(t){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.onFailedAttempt=t.onFailedAttempt??BM;const e="default"in Dr?Dr.default:Dr;this.queue=new e({concurrency:this.maxConcurrency})}call(t,...e){return this.queue.add(()=>Ws(()=>t(...e).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){return t.signal?Promise.race([this.call(e,...r),new Promise((n,a)=>{var o;(o=t.signal)==null||o.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(e,...r)}fetch(...t){return this.call(()=>fetch(...t).then(e=>e.ok?e:Promise.reject(e)))}};class pw extends ei{constructor({config:e,onStart:r,onEnd:n,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=r,this.argOnEnd=n,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function yh(t){return t?t.lc_runnable:!1}class HM{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,r){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const a=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(r)),this.includeTags!==void 0&&(n=n||a.some(o=>{var i;return(i=this.includeTags)==null?void 0:i.includes(o)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(r)),this.excludeTags!==void 0&&(n=n&&a.every(o=>{var i;return!((i=this.excludeTags)!=null&&i.includes(o))})),n}}const WM=Symbol("Let zodToJsonSchema decide on which parser to use"),GM={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},VM=t=>({...GM,...t}),qM=t=>{const e=VM(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function fw(t,e,r,n){n!=null&&n.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function je(t,e,r,n,a){t[e]=r,fw(t,e,n,a)}function ZM(){return{}}function JM(t,e){var n,a;const r={type:"array"};return((a=(n=t.type)==null?void 0:n._def)==null?void 0:a.typeName)!==K.ZodAny&&(r.items=Oe(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&je(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&je(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(je(r,"minItems",t.exactLength.value,t.exactLength.message,e),je(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function KM(t,e){const r={type:"integer",format:"int64"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?je(r,"minimum",n.value,n.message,e):je(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),je(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?je(r,"maximum",n.value,n.message,e):je(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),je(r,"maximum",n.value,n.message,e));break;case"multipleOf":je(r,"multipleOf",n.value,n.message,e);break}return r}function YM(){return{type:"boolean"}}function XM(t,e){return Oe(t.type._def,e)}const QM=(t,e)=>Oe(t.innerType._def,e);function mw(t,e,r){const n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>mw(t,e,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return eR(t,e)}}const eR=(t,e)=>{const r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(const n of t.checks)switch(n.kind){case"min":je(r,"minimum",n.value,n.message,e);break;case"max":je(r,"maximum",n.value,n.message,e);break}return r};function tR(t,e){return{...Oe(t.innerType._def,e),default:t.defaultValue()}}function rR(t,e){return e.effectStrategy==="input"?Oe(t.schema._def,e):{}}function nR(t){return{type:"string",enum:t.values}}const aR=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function oR(t,e){const r=[Oe(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Oe(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return r.forEach(o=>{if(aR(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let i=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:s,...l}=o;i=l}else n=void 0;a.push(i)}}),a.length?{allOf:a,...n}:void 0}function iR(t,e){const r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}let vh;const zn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(vh===void 0&&(vh=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),vh),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function gw(t,e){const r={type:"string"};function n(a){return e.patternStrategy==="escape"?sR(a):a}if(t.checks)for(const a of t.checks)switch(a.kind){case"min":je(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e);break;case"max":je(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":tr(r,"email",a.message,e);break;case"format:idn-email":tr(r,"idn-email",a.message,e);break;case"pattern:zod":rr(r,zn.email,a.message,e);break}break;case"url":tr(r,"uri",a.message,e);break;case"uuid":tr(r,"uuid",a.message,e);break;case"regex":rr(r,a.regex,a.message,e);break;case"cuid":rr(r,zn.cuid,a.message,e);break;case"cuid2":rr(r,zn.cuid2,a.message,e);break;case"startsWith":rr(r,RegExp(`^${n(a.value)}`),a.message,e);break;case"endsWith":rr(r,RegExp(`${n(a.value)}$`),a.message,e);break;case"datetime":tr(r,"date-time",a.message,e);break;case"date":tr(r,"date",a.message,e);break;case"time":tr(r,"time",a.message,e);break;case"duration":tr(r,"duration",a.message,e);break;case"length":je(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e),je(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"includes":{rr(r,RegExp(n(a.value)),a.message,e);break}case"ip":{a.version!=="v6"&&tr(r,"ipv4",a.message,e),a.version!=="v4"&&tr(r,"ipv6",a.message,e);break}case"emoji":rr(r,zn.emoji,a.message,e);break;case"ulid":{rr(r,zn.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{tr(r,"binary",a.message,e);break}case"contentEncoding:base64":{je(r,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{rr(r,zn.base64,a.message,e);break}}break}case"nanoid":rr(r,zn.nanoid,a.message,e)}return r}const sR=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),tr=(t,e,r,n)=>{var a;t.format||(a=t.anyOf)!=null&&a.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):je(t,"format",e,r,n)},rr=(t,e,r,n)=>{var a;t.pattern||(a=t.allOf)!=null&&a.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:yw(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):je(t,"pattern",yw(e,n),r,n)},yw=(t,e)=>{var c;const r=typeof t=="function"?t():t;if(!e.applyRegexFlags||!r.flags)return r.source;const n={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},a=n.i?r.source.toLowerCase():r.source;let o="",i=!1,s=!1,l=!1;for(let d=0;d<a.length;d++){if(i){o+=a[d],i=!1;continue}if(n.i){if(s){if(a[d].match(/[a-z]/)){l?(o+=a[d],o+=`${a[d-2]}-${a[d]}`.toUpperCase(),l=!1):a[d+1]==="-"&&((c=a[d+2])!=null&&c.match(/[a-z]/))?(o+=a[d],l=!0):o+=`${a[d]}${a[d].toUpperCase()}`;continue}}else if(a[d].match(/[a-z]/)){o+=`[${a[d]}${a[d].toUpperCase()}]`;continue}}if(n.m){if(a[d]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[d]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[d]==="."){o+=s?`${a[d]}\r
`:`[${a[d]}\r
]`;continue}o+=a[d],a[d]==="\\"?i=!0:s&&a[d]==="]"?s=!1:!s&&a[d]==="["&&(s=!0)}try{const d=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return o};function vw(t,e){var n,a,o,i;if(e.target==="openApi3"&&((n=t.keyType)==null?void 0:n._def.typeName)===K.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((s,l)=>({...s,[l]:Oe(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const r={type:"object",additionalProperties:Oe(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return r;if(((a=t.keyType)==null?void 0:a._def.typeName)===K.ZodString&&((o=t.keyType._def.checks)!=null&&o.length)){const s=Object.entries(gw(t.keyType._def,e)).reduce((l,[c,d])=>c==="type"?l:{...l,[c]:d},{});return{...r,propertyNames:s}}else if(((i=t.keyType)==null?void 0:i._def.typeName)===K.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};return r}function lR(t,e){if(e.mapStrategy==="record")return vw(t,e);const r=Oe(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Oe(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function cR(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),n=Array.from(new Set(r.map(a=>typeof a)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:r}}function dR(){return{not:{}}}function uR(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const ul={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function hR(t,e){if(e.target==="openApi3")return _w(t,e);const r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in ul&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,o)=>{const i=ul[o._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,o)=>{const i=typeof o._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===r.length){const a=n.filter((o,i,s)=>s.indexOf(o)===i);return{type:a.length>1?a:a[0],enum:r.reduce((o,i)=>o.includes(i._def.value)?o:[...o,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return _w(t,e)}const _w=(t,e)=>{const r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,a)=>Oe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function pR(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:ul[t.innerType._def.typeName],nullable:!0}:{type:[ul[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Oe(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=Oe(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function fR(t,e){const r={type:"number"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"int":r.type="integer",fw(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?je(r,"minimum",n.value,n.message,e):je(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),je(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?je(r,"maximum",n.value,n.message,e):je(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),je(r,"maximum",n.value,n.message,e));break;case"multipleOf":je(r,"multipleOf",n.value,n.message,e);break}return r}function mR(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":Oe(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":Oe(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function gR(t,e){const r={type:"object",...Object.entries(t.shape()).reduce((n,[a,o])=>{if(o===void 0||o._def===void 0)return n;const i=Oe(o._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});return i===void 0?n:{properties:{...n.properties,[a]:i},required:o.isOptional()?n.required:[...n.required,a]}},{properties:{},required:[]}),additionalProperties:mR(t,e)};return r.required.length||delete r.required,r}const yR=(t,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Oe(t.innerType._def,e);const r=Oe(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},vR=(t,e)=>{if(e.pipeStrategy==="input")return Oe(t.in._def,e);if(e.pipeStrategy==="output")return Oe(t.out._def,e);const r=Oe(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Oe(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function _R(t,e){return Oe(t.type._def,e)}function wR(t,e){const r={type:"array",uniqueItems:!0,items:Oe(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&je(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&je(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function bR(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>Oe(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:Oe(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>Oe(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function ER(){return{not:{}}}function SR(){return{}}const xR=(t,e)=>Oe(t.innerType._def,e);function Oe(t,e,r=!1){var i;const n=e.seen.get(t);if(e.override){const s=(i=e.override)==null?void 0:i.call(e,t,e,n,r);if(s!==WM)return s}if(n&&!r){const s=ww(n,e);if(s!==void 0)return s}const a={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,a);const o=Ew(t,t.typeName,e);return o&&Sw(t,e,o),a.jsonSchema=o,o}let ww,bw,Ew,Sw;ww=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:bw(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},bw=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")},Ew=(t,e,r)=>{switch(e){case K.ZodString:return gw(t,r);case K.ZodNumber:return fR(t,r);case K.ZodObject:return gR(t,r);case K.ZodBigInt:return KM(t,r);case K.ZodBoolean:return YM();case K.ZodDate:return mw(t,r);case K.ZodUndefined:return ER();case K.ZodNull:return uR(r);case K.ZodArray:return JM(t,r);case K.ZodUnion:case K.ZodDiscriminatedUnion:return hR(t,r);case K.ZodIntersection:return oR(t,r);case K.ZodTuple:return bR(t,r);case K.ZodRecord:return vw(t,r);case K.ZodLiteral:return iR(t,r);case K.ZodEnum:return nR(t);case K.ZodNativeEnum:return cR(t);case K.ZodNullable:return pR(t,r);case K.ZodOptional:return yR(t,r);case K.ZodMap:return lR(t,r);case K.ZodSet:return wR(t,r);case K.ZodLazy:return Oe(t.getter()._def,r);case K.ZodPromise:return _R(t,r);case K.ZodNaN:case K.ZodNever:return dR();case K.ZodEffects:return rR(t,r);case K.ZodAny:return ZM();case K.ZodUnknown:return SR();case K.ZodDefault:return tR(t,r);case K.ZodBranded:return XM(t,r);case K.ZodReadonly:return xR(t,r);case K.ZodCatch:return QM(t,r);case K.ZodPipeline:return vR(t,r);case K.ZodFunction:case K.ZodVoid:case K.ZodSymbol:return;default:return(n=>{})()}},Sw=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r),Jp=(t,e)=>{const r=qM(e),n=void 0,a=e==null?void 0:e.name,o=Oe(t._def,r,!1)??{},i=a===void 0?n?{...o,[r.definitionPath]:n}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...n,[a]:o}};return r.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),i};function _h(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}function kR(t,e){const r=e[t.source]??t.source,n=e[t.target]??t.target;return[r,n]}function TR(t){let e="";for(const[r,n]of Object.entries(t))e+=`	classDef ${r}class fill:${n};
`;return e}function AR(t,e,r){const{firstNodeLabel:n,lastNodeLabel:a,nodeColors:o,withStyles:i=!0,curveStyle:s="linear",wrapLabelNWords:l=9}=r??{};let c=i?`%%{init: {'flowchart': {'curve': '${s}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const u="default",h={[u]:"{0}([{1}]):::otherclass"};n!==void 0&&(h[n]="{0}[{0}]:::startclass"),a!==void 0&&(h[a]="{0}[{0}]:::endclass");for(const p of Object.values(t)){const f=h[p]??h[u],g=_h(p),y=p.split(":"),E=y[y.length-1];c+=`	${f.replace(/\{0\}/g,g).replace(/\{1\}/g,E)};
`}}let d="";for(const u of e){const h=u.source.includes(":")?u.source.split(":")[0]:void 0,p=u.target.includes(":")?u.target.split(":")[0]:void 0;d!==""&&(d!==h||d!==p)&&(c+=`	end
`,d=""),d===""&&h!==void 0&&h===p&&(c=`	subgraph ${h}
`,d=h);const[f,g]=kR(u,t);let y="";if(u.data!==void 0){let E=u.data;const k=E.split(" ");k.length>l&&(E=k.reduce((R,O,b)=>(b%l===0&&R.push(""),R[R.length-1]+=` ${O}`,R),[]).join("<br>")),u.conditional?y=` -. ${E} .-> `:y=` -- ${E} --> `}else u.conditional?y=" -.-> ":y=" --> ";c+=`	${_h(f)}${y}${_h(g)};
`}return d!==""&&(c+=`end
`),i&&o!==void 0&&(c+=TR(o)),c}async function MR(t,e){let{backgroundColor:r="white"}=e??{};const n=btoa(t);r!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));const a=`https://mermaid.ink/img/${n}?bgColor=${r}`,o=await fetch(a);if(!o.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${o.status}`,`Status text: ${o.statusText}`].join(`
`));return await o.blob()}const xw=42;function wh(t){if(Gs(t.id))if(yh(t.data))try{let e=t.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>xw&&(e=`${e.substring(0,xw)}...`),e}catch{return t.data.getName()}else return t.data.name??"UnknownSchema";else return t.id}function RR(t){return yh(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...Jp(t.data.schema),title:t.data.name}}}class kw{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach((r,n)=>{e[r.id]=Gs(r.id)?n:r.id}),{nodes:Object.values(this.nodes).map(r=>({id:e[r.id],...RR(r)})),edges:this.edges.map(r=>{const n={source:e[r.source],target:e[r.target]};return typeof r.data<"u"&&(n.data=r.data),typeof r.conditional<"u"&&(n.conditional=r.conditional),n})}}addNode(e,r){if(r!==void 0&&this.nodes[r]!==void 0)throw new Error(`Node with id ${r} already exists`);const n=r||At(),a={id:n,data:e};return this.nodes[n]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(r=>r.source!==e.id&&r.target!==e.id)}addEdge(e,r,n,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[r.id]===void 0)throw new Error(`Target node ${r.id} not in graph`);const o={source:e.id,target:r.id,data:n,conditional:a};return this.edges.push(o),o}firstNode(){const e=new Set(this.edges.map(n=>n.target)),r=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||r.push(n)}),r[0]}lastNode(){const e=new Set(this.edges.map(n=>n.source)),r=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||r.push(n)}),r[0]}extend(e,r=""){let n=r;Object.values(e.nodes).map(l=>l.id).every(Gs)&&(n="");const a=l=>n?`${n}:${l}`:l;Object.entries(e.nodes).forEach(([l,c])=>{this.nodes[a(l)]={...c,id:a(l)}});const o=e.edges.map(l=>({...l,source:a(l.source),target:a(l.target)}));this.edges=[...this.edges,...o];const i=e.firstNode(),s=e.lastNode();return[i?{id:a(i.id),data:i.data}:void 0,s?{id:a(s.id),data:s.data}:void 0]}trimFirstNode(){const e=this.firstNode();if(e){const r=this.edges.filter(n=>n.source===e.id);(Object.keys(this.nodes).length===1||r.length===1)&&this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const r=this.edges.filter(n=>n.target===e.id);(Object.keys(this.nodes).length===1||r.length===1)&&this.removeNode(e)}}drawMermaid(e){const{withStyles:r,curveStyle:n,nodeColors:a={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:o}=e??{},i={};for(const u of Object.values(this.nodes))i[u.id]=wh(u);const s=this.firstNode(),l=s?wh(s):void 0,c=this.lastNode(),d=c?wh(c):void 0;return AR(i,this.edges,{firstNodeLabel:l,lastNodeLabel:d,withStyles:r,curveStyle:n,nodeColors:a,wrapLabelNWords:o})}async drawMermaidPng(e){const r=this.drawMermaid(e);return MR(r,{backgroundColor:e==null?void 0:e.backgroundColor})}}function FR(t){const e=new TextEncoder,r=new ReadableStream({async start(n){for await(const a of t)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Rt.fromReadableStream(r)}function Tw(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const NR=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function bh(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*Aw(t,e){for(;;){const{value:r,done:n}=Un.runWithConfig(t,e.next.bind(e),!0);if(n)break;yield r}}async function*Mw(t,e){const r=e[Symbol.asyncIterator]();for(;;){const{value:n,done:a}=await Un.runWithConfig(t,r.next.bind(e),!0);if(a)break;yield n}}function nt(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}ot=class extends bn{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(t){const e=this.name??this.constructor.lc_name()??this.constructor.name;return t?`${e}${t}`:e}bind(t){return new Bn({bound:this,kwargs:t,config:{}})}map(){return new hl({bound:this})}withRetry(t){return new PR({bound:this,kwargs:{},config:{},maxAttemptNumber:t==null?void 0:t.stopAfterAttempt,...t})}withConfig(t){return new Bn({bound:this,config:t,kwargs:{}})}withFallbacks(t){const e=Array.isArray(t)?t:t.fallbacks;return new IR({runnable:this,fallbacks:e})}_getOptionsList(t,e=0){if(Array.isArray(t)&&t.length!==e)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${t.length} options for ${e} inputs`);if(Array.isArray(t))return t.map(Pe);if(e>1&&!Array.isArray(t)&&t.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(t).filter(([n])=>n!=="runId"));return Array.from({length:e},(n,a)=>Pe(a===0?t:r))}return Array.from({length:e},()=>Pe(t))}async batch(t,e,r){var s;const n=this._getOptionsList(e??{},t.length),a=((s=n[0])==null?void 0:s.maxConcurrency)??(r==null?void 0:r.maxConcurrency),o=new Li({maxConcurrency:a,onFailedAttempt:l=>{throw l}}),i=t.map((l,c)=>o.call(async()=>{try{return await this.invoke(l,n[c])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(i)}async*_streamIterator(t,e){yield this.invoke(t,e)}async stream(t,e){const r=Pe(e),n=new Ca({generator:this._streamIterator(t,r),config:r});return await n.setup,Rt.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(t){let e;t===void 0?e=Pe(t):e=Pe({callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,runName:t.runName,configurable:t.configurable,recursionLimit:t.recursionLimit,maxConcurrency:t.maxConcurrency,runId:t.runId,timeout:t.timeout,signal:t.signal});const r={...t};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[e,r]}async _callWithConfig(t,e,r){var i;const n=Pe(r),a=await((i=await er(n))==null?void 0:i.handleChainStart(this.toJSON(),nt(e,"input"),n.runId,n==null?void 0:n.runType,void 0,void 0,(n==null?void 0:n.runName)??this.getName()));delete n.runId;let o;try{const s=t.call(this,e,n,a);o=await dn(s,r==null?void 0:r.signal)}catch(s){throw await(a==null?void 0:a.handleChainError(s)),s}return await(a==null?void 0:a.handleChainEnd(nt(o,"output"))),o}async _batchWithConfig(t,e,r,n){var l;const a=this._getOptionsList(r??{},e.length),o=await Promise.all(a.map(er)),i=await Promise.all(o.map(async(c,d)=>{const u=await(c==null?void 0:c.handleChainStart(this.toJSON(),nt(e[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,u}));let s;try{const c=t.call(this,e,a,i,n);s=await dn(c,(l=a==null?void 0:a[0])==null?void 0:l.signal)}catch(c){throw await Promise.all(i.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(i.map(c=>c==null?void 0:c.handleChainEnd(nt(s,"output")))),s}async*_transformStreamWithConfig(t,e,r){let n,a=!0,o,i=!0;const s=Pe(r),l=await er(s);async function*c(){for await(const u of t){if(a)if(n===void 0)n=u;else try{n=dr(n,u)}catch{n=void 0,a=!1}yield u}}let d;try{const u=await LM(e.bind(this),c(),async()=>l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},s.runId,s.runType,void 0,void 0,s.runName??this.getName()),r==null?void 0:r.signal,s);delete s.runId,d=u.setup;const h=d==null?void 0:d.handlers.find(qp);let p=u.output;h!==void 0&&d!==void 0&&(p=h.tapOutputIterable(d.runId,p));const f=d==null?void 0:d.handlers.find(Zp);f!==void 0&&d!==void 0&&(p=f.tapOutputIterable(d.runId,p));for await(const g of p)if(yield g,i)if(o===void 0)o=g;else try{o=dr(o,g)}catch{o=void 0,i=!1}}catch(u){throw await(d==null?void 0:d.handleChainError(u,void 0,void 0,void 0,{inputs:nt(n,"input")})),u}await(d==null?void 0:d.handleChainEnd(o??{},void 0,void 0,void 0,{inputs:nt(n,"input")}))}getGraph(t){const e=new kw,r=e.addNode({name:`${this.getName()}Input`,schema:ra.any()}),n=e.addNode(this),a=e.addNode({name:`${this.getName()}Output`,schema:ra.any()});return e.addEdge(r,n),e.addEdge(n,a),e}pipe(t){return new En({first:this,last:Hn(t)})}pick(t){return this.pipe(new CR(t))}assign(t){return this.pipe(new Vp(new ho({steps:t})))}async*transform(t,e){let r;for await(const n of t)r===void 0?r=n:r=dr(r,n);yield*this._streamIterator(r,Pe(e))}async*streamLog(t,e,r){const n=new uw({...r,autoClose:!1,_schemaFormat:"original"}),a=Pe(e);yield*this._streamLog(t,n,a)}async*_streamLog(t,e,r){const{callbacks:n}=r;if(n===void 0)r.callbacks=[e];else if(Array.isArray(n))r.callbacks=n.concat([e]);else{const s=n.copy();s.addHandler(e,!0),r.callbacks=s}const a=this.stream(t,r);async function o(){try{const s=await a;for await(const l of s){const c=new un({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await e.writer.write(c)}}finally{await e.writer.close()}}const i=o();try{for await(const s of e)yield s}finally{await i}}streamEvents(t,e,r){let n;if(e.version==="v1")n=this._streamEventsV1(t,e,r);else if(e.version==="v2")n=this._streamEventsV2(t,e,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return e.encoding==="text/event-stream"?FR(n):Rt.fromAsyncGenerator(n)}async*_streamEventsV2(t,e,r){var h;const n=new $M({...r,autoClose:!1}),a=Pe(e),o=a.runId??At();a.runId=o;const i=a.callbacks;if(i===void 0)a.callbacks=[n];else if(Array.isArray(i))a.callbacks=i.concat(n);else{const p=i.copy();p.addHandler(n,!0),a.callbacks=p}const s=this;async function l(){try{const p=await s.stream(t,a),f=n.tapOutputIterable(o,p);for await(const g of f);}finally{await n.finish()}}const c=l();let d=!1,u;try{for await(const p of n){if(!d){p.data.input=t,d=!0,u=p.run_id,yield p;continue}p.run_id===u&&p.event.endsWith("_end")&&((h=p.data)!=null&&h.input)&&delete p.data.input,yield p}}finally{await c}}async*_streamEventsV1(t,e,r){let n,a=!1;const o=Pe(e),i=o.tags??[],s=o.metadata??{},l=o.runName??this.getName(),c=new uw({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new HM({...r}),u=this._streamLog(t,c,o);for await(const p of u){if(n?n=n.concat(p):n=si.fromRunLogPatch(p),n.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const E={...n.state},k={run_id:E.id,event:`on_${E.type}_start`,name:l,tags:i,metadata:s,data:{input:t}};d.includeEvent(k,E.type)&&(yield k)}const f=p.ops.filter(E=>E.path.startsWith("/logs/")).map(E=>E.path.split("/")[2]),g=[...new Set(f)];for(const E of g){let k,R={};const O=n.state.logs[E];if(O.end_time===void 0?O.streamed_output.length>0?k="stream":k="start":k="end",k==="start")O.inputs!==void 0&&(R.input=O.inputs);else if(k==="end")O.inputs!==void 0&&(R.input=O.inputs),R.output=O.final_output;else if(k==="stream"){const b=O.streamed_output.length;if(b!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${b} instead. Encountered in: "${O.name}"`);R={chunk:O.streamed_output[0]},O.streamed_output=[]}yield{event:`on_${O.type}_${k}`,name:O.name,run_id:O.id,tags:O.tags,metadata:O.metadata,data:R}}const{state:y}=n;if(y.streamed_output.length>0){const E=y.streamed_output.length;if(E!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${E} instead. Encountered in: "${y.name}"`);const k={chunk:y.streamed_output[0]};y.streamed_output=[];const R={event:`on_${y.type}_stream`,run_id:y.id,tags:i,metadata:s,name:l,data:k};d.includeEvent(R,y.type)&&(yield R)}}const h=n==null?void 0:n.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:l,run_id:h.id,tags:i,metadata:s,data:{output:h.final_output}};d.includeEvent(p,h.type)&&(yield p)}}static isRunnable(t){return yh(t)}withListeners({onStart:t,onEnd:e,onError:r}){return new Bn({bound:this,config:{},configFactories:[n=>({callbacks:[new pw({config:n,onStart:t,onEnd:e,onError:r})]})]})}asTool(t){return jR(this,t)}};class Bn extends ot{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const r=hw(this.config,...e);return hw(r,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(r))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,r){return this.bound.invoke(e,await this._mergeConfig(Pe(r),this.kwargs))}async batch(e,r,n){const a=Array.isArray(r)?await Promise.all(r.map(async o=>this._mergeConfig(Pe(o),this.kwargs))):await this._mergeConfig(Pe(r),this.kwargs);return this.bound.batch(e,a,n)}async*_streamIterator(e,r){yield*this.bound._streamIterator(e,await this._mergeConfig(Pe(r),this.kwargs))}async stream(e,r){return this.bound.stream(e,await this._mergeConfig(Pe(r),this.kwargs))}async*transform(e,r){yield*this.bound.transform(e,await this._mergeConfig(Pe(r),this.kwargs))}streamEvents(e,r,n){const a=this,o=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig(Pe(r),a.kwargs),version:r.version},n)};return Rt.fromAsyncGenerator(o())}static isRunnableBinding(e){return e.bound&&ot.isRunnable(e.bound)}withListeners({onStart:e,onEnd:r,onError:n}){return new Bn({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new pw({config:a,onStart:e,onEnd:r,onError:n})]})]})}}class hl extends ot{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new hl({bound:this.bound.bind(e)})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _invoke(e,r,n){return this.bound.batch(e,ct(r,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:r,onError:n}){return new hl({bound:this.bound.withListeners({onStart:e,onEnd:r,onError:n})})}}class PR extends Bn{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,r,n){const a=e>1?`retry:attempt:${e}`:void 0;return ct(r,{callbacks:n==null?void 0:n.getChild(a)})}async _invoke(e,r,n){return Ws(a=>super.invoke(e,this._patchConfigForRetry(a,r,n)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _batch(e,r,n,a){const o={};try{await Ws(async i=>{const s=e.map((h,p)=>p).filter(h=>o[h.toString()]===void 0||o[h.toString()]instanceof Error),l=s.map(h=>e[h]),c=s.map(h=>this._patchConfigForRetry(i,r==null?void 0:r[h],n==null?void 0:n[h])),d=await super.batch(l,c,{...a,returnExceptions:!0});let u;for(let h=0;h<d.length;h+=1){const p=d[h],f=s[h];p instanceof Error&&u===void 0&&(u=p,u.input=l[h]),o[f.toString()]=p}if(u)throw u;return d},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((a==null?void 0:a.returnExceptions)!==!0)throw i}return Object.keys(o).sort((i,s)=>parseInt(i,10)-parseInt(s,10)).map(i=>o[parseInt(i,10)])}async batch(e,r,n){return this._batchWithConfig(this._batch.bind(this),e,r,n)}}En=class extends ot{static lc_name(){return"RunnableSequence"}constructor(t){super(t),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=t.first,this.middle=t.middle??this.middle,this.last=t.last,this.name=t.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(t,e){var i,s;const r=Pe(e),n=await((i=await er(r))==null?void 0:i.handleChainStart(this.toJSON(),nt(t,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=t,o;try{const l=[this.first,...this.middle];for(let c=0;c<l.length;c+=1){const d=l[c].invoke(a,ct(r,{callbacks:n==null?void 0:n.getChild(`seq:step:${c+1}`)}));a=await dn(d,e==null?void 0:e.signal)}if((s=e==null?void 0:e.signal)!=null&&s.aborted)throw new Error("Aborted");o=await this.last.invoke(a,ct(r,{callbacks:n==null?void 0:n.getChild(`seq:step:${this.steps.length}`)}))}catch(l){throw await(n==null?void 0:n.handleChainError(l)),l}return await(n==null?void 0:n.handleChainEnd(nt(o,"output"))),o}async batch(t,e,r){var s;const n=this._getOptionsList(e??{},t.length),a=await Promise.all(n.map(er)),o=await Promise.all(a.map(async(l,c)=>{const d=await(l==null?void 0:l.handleChainStart(this.toJSON(),nt(t[c],"input"),n[c].runId,void 0,void 0,void 0,n[c].runName));return delete n[c].runId,d}));let i=t;try{for(let l=0;l<this.steps.length;l+=1){const c=this.steps[l].batch(i,o.map((d,u)=>{const h=d==null?void 0:d.getChild(`seq:step:${l+1}`);return ct(n[u],{callbacks:h})}),r);i=await dn(c,(s=n[0])==null?void 0:s.signal)}}catch(l){throw await Promise.all(o.map(c=>c==null?void 0:c.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(nt(i,"output")))),i}async*_streamIterator(t,e){var d;const r=await er(e),{runId:n,...a}=e??{},o=await(r==null?void 0:r.handleChainStart(this.toJSON(),nt(t,"input"),n,void 0,void 0,void 0,a==null?void 0:a.runName)),i=[this.first,...this.middle,this.last];let s=!0,l;async function*c(){yield t}try{let u=i[0].transform(c(),ct(a,{callbacks:o==null?void 0:o.getChild("seq:step:1")}));for(let h=1;h<i.length;h+=1)u=await i[h].transform(u,ct(a,{callbacks:o==null?void 0:o.getChild(`seq:step:${h+1}`)}));for await(const h of u)if((d=e==null?void 0:e.signal)==null||d.throwIfAborted(),yield h,s)if(l===void 0)l=h;else try{l=dr(l,h)}catch{l=void 0,s=!1}}catch(u){throw await(o==null?void 0:o.handleChainError(u)),u}await(o==null?void 0:o.handleChainEnd(nt(l,"output")))}getGraph(t){const e=new kw;let r=null;return this.steps.forEach((n,a)=>{const o=n.getGraph(t);a!==0&&o.trimFirstNode(),a!==this.steps.length-1&&o.trimLastNode(),e.extend(o);const i=o.firstNode();if(!i)throw new Error(`Runnable ${n} has no first node`);r&&e.addEdge(r,i),r=o.lastNode()}),e}pipe(t){return En.isRunnableSequence(t)?new En({first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}):new En({first:this.first,middle:[...this.middle,this.last],last:Hn(t),name:this.name})}static isRunnableSequence(t){return Array.isArray(t.middle)&&ot.isRunnable(t)}static from([t,...e],r){return new En({first:Hn(t),middle:e.slice(0,-1).map(Hn),last:Hn(e[e.length-1]),name:r})}},ho=class extends ot{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[e,r]of Object.entries(t.steps))this.steps[e]=Hn(r)}static from(t){return new ho({steps:t})}async invoke(t,e){var o;const r=Pe(e),n=await((o=await er(r))==null?void 0:o.handleChainStart(this.toJSON(),{input:t},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{const i=Object.entries(this.steps).map(async([s,l])=>{a[s]=await l.invoke(t,ct(r,{callbacks:n==null?void 0:n.getChild(`map:key:${s}`)}))});await dn(Promise.all(i),e==null?void 0:e.signal)}catch(i){throw await(n==null?void 0:n.handleChainError(i)),i}return await(n==null?void 0:n.handleChainEnd(a)),a}async*_transform(t,e,r){const n={...this.steps},a=lw(t,Object.keys(n).length),o=new Map(Object.entries(n).map(([i,s],l)=>{const c=s.transform(a[l],ct(r,{callbacks:e==null?void 0:e.getChild(`map:key:${i}`)}));return[i,c.next().then(d=>({key:i,gen:c,result:d}))]}));for(;o.size;){const i=Promise.race(o.values()),{key:s,result:l,gen:c}=await dn(i,r==null?void 0:r.signal);o.delete(s),l.done||(yield{[s]:l.value},o.set(s,c.next().then(d=>({key:s,gen:c,result:d}))))}}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Pe(e),a=new Ca({generator:this.transform(r(),n),config:n});return await a.setup,Rt.fromAsyncGenerator(a)}};class Eh extends ot{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!eu(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,r){const[n]=this._getOptionsList(r??{},1),a=await er(n),o=this.func(ct(n,{callbacks:a}),e);return dn(o,n==null?void 0:n.signal)}async*_streamIterator(e,r){var o,i;const[n]=this._getOptionsList(r??{},1),a=await this.invoke(e,r);if(bh(a)){for await(const s of a)(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield s;return}if(NR(a)){for(;;){(i=n==null?void 0:n.signal)==null||i.throwIfAborted();const s=a.next();if(s.done)break;yield s.value}return}yield a}static from(e){return new Eh({func:e})}}function OR(t){if(eu(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}Di=class extends ot{static lc_name(){return"RunnableLambda"}constructor(t){if(eu(t.func))return Eh.from(t.func);super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),OR(t.func),this.func=t.func}static from(t){return new Di({func:t})}async _invoke(t,e,r){return new Promise((n,a)=>{const o=ct(e,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((e==null?void 0:e.recursionLimit)??gh)-1});Un.runWithConfig(o,async()=>{var i,s;try{let l=await this.func(t,{...o});if(l&&ot.isRunnable(l)){if((e==null?void 0:e.recursionLimit)===0)throw new Error("Recursion limit reached.");l=await l.invoke(t,{...o,recursionLimit:(o.recursionLimit??gh)-1})}else if(bh(l)){let c;for await(const d of Mw(o,l))if((i=e==null?void 0:e.signal)==null||i.throwIfAborted(),c===void 0)c=d;else try{c=dr(c,d)}catch{c=d}l=c}else if(Tw(l)){let c;for(const d of Aw(o,l))if((s=e==null?void 0:e.signal)==null||s.throwIfAborted(),c===void 0)c=d;else try{c=dr(c,d)}catch{c=d}l=c}n(l)}catch(l){a(l)}})})}async invoke(t,e){return this._callWithConfig(this._invoke.bind(this),t,e)}async*_transform(t,e,r){var i,s;let n;for await(const l of t)if(n===void 0)n=l;else try{n=dr(n,l)}catch{n=l}const a=ct(r,{callbacks:e==null?void 0:e.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??gh)-1}),o=await new Promise((l,c)=>{Un.runWithConfig(a,async()=>{try{const d=await this.func(n,{...a,config:a});l(d)}catch(d){c(d)}})});if(o&&ot.isRunnable(o)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const l=await o.stream(n,a);for await(const c of l)yield c}else if(bh(o))for await(const l of Mw(a,o))(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),yield l;else if(Tw(o))for(const l of Aw(a,o))(s=r==null?void 0:r.signal)==null||s.throwIfAborted(),yield l;else yield o}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Pe(e),a=new Ca({generator:this.transform(r(),n),config:n});return await a.setup,Rt.fromAsyncGenerator(a)}};class IR extends ot{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,r){var c;const n=Pe(r),a=await er(r),{runId:o,...i}=n,s=await(a==null?void 0:a.handleChainStart(this.toJSON(),nt(e,"input"),o,void 0,void 0,void 0,i==null?void 0:i.runName));let l;for(const d of this.runnables()){(c=n==null?void 0:n.signal)==null||c.throwIfAborted();try{const u=await d.invoke(e,ct(i,{callbacks:s==null?void 0:s.getChild()}));return await(s==null?void 0:s.handleChainEnd(nt(u,"output"))),u}catch(u){l===void 0&&(l=u)}}throw l===void 0?new Error("No error stored at end of fallback."):(await(s==null?void 0:s.handleChainError(l)),l)}async*_streamIterator(e,r){var u;const n=Pe(r),a=await er(r),{runId:o,...i}=n,s=await(a==null?void 0:a.handleChainStart(this.toJSON(),nt(e,"input"),o,void 0,void 0,void 0,i==null?void 0:i.runName));let l,c;for(const h of this.runnables()){(u=n==null?void 0:n.signal)==null||u.throwIfAborted();const p=ct(i,{callbacks:s==null?void 0:s.getChild()});try{c=await h.stream(e,p);break}catch(f){l===void 0&&(l=f)}}if(c===void 0){const h=l??new Error("No error stored at end of fallback.");throw await(s==null?void 0:s.handleChainError(h)),h}let d;try{for await(const h of c){yield h;try{d=d===void 0?d:dr(d,h)}catch{d=void 0}}}catch(h){throw await(s==null?void 0:s.handleChainError(h)),h}await(s==null?void 0:s.handleChainEnd(nt(d,"output")))}async batch(e,r,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(r??{},e.length),o=await Promise.all(a.map(c=>er(c))),i=await Promise.all(o.map(async(c,d)=>{const u=await(c==null?void 0:c.handleChainStart(this.toJSON(),nt(e[d],"input"),a[d].runId,void 0,void 0,void 0,a[d].runName));return delete a[d].runId,u}));let s;for(const c of this.runnables()){(l=a[0].signal)==null||l.throwIfAborted();try{const d=await c.batch(e,i.map((u,h)=>ct(a[h],{callbacks:u==null?void 0:u.getChild()})),n);return await Promise.all(i.map((u,h)=>u==null?void 0:u.handleChainEnd(nt(d[h],"output")))),d}catch(d){s===void 0&&(s=d)}}throw s?(await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(s))),s):new Error("No error stored at end of fallbacks.")}}function Hn(t){if(typeof t=="function")return new Di({func:t});if(ot.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[r,n]of Object.entries(t))e[r]=Hn(n);return new ho({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}Vp=class extends ot{static lc_name(){return"RunnableAssign"}constructor(t){t instanceof ho&&(t={mapper:t}),super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=t.mapper}async invoke(t,e){const r=await this.mapper.invoke(t,e);return{...t,...r}}async*_transform(t,e,r){const n=this.mapper.getStepsKeys(),[a,o]=lw(t),i=this.mapper.transform(o,ct(r,{callbacks:e==null?void 0:e.getChild()})),s=i.next();for await(const l of a){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);const c=Object.fromEntries(Object.entries(l).filter(([d])=>!n.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await s).value;for await(const l of i)yield l}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Pe(e),a=new Ca({generator:this.transform(r(),n),config:n});return await a.setup,Rt.fromAsyncGenerator(a)}};class CR extends ot{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const r=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return r.length===0?void 0:Object.fromEntries(r)}}async invoke(e,r){return this._callWithConfig(this._pick.bind(this),e,r)}async*_transform(e){for await(const r of e){const n=await this._pick(r);n!==void 0&&(yield n)}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const a=Pe(r),o=new Ca({generator:this.transform(n(),a),config:a});return await o.setup,Rt.fromAsyncGenerator(o)}}class Rw extends Bn{constructor(e){const r=En.from([Di.from(async n=>{let a;if(ow(n))try{a=await this.schema.parseAsync(n.args)}catch{throw new _M("Received tool input did not match expected schema",JSON.stringify(n.args))}else a=n;return a}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:r,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function jR(t,e){var a;const r=e.name??t.getName(),n=e.description??((a=e.schema)==null?void 0:a.description);return e.schema.constructor===ra.ZodString?new Rw({name:r,description:n,schema:ra.object({input:ra.string()}).transform(o=>o.input),bound:t}):new Rw({name:r,description:n,schema:e.schema,bound:t})}class LR extends ot{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,r){return this.transformDocuments(e)}}var li={},Fw;function DR(){if(Fw)return li;Fw=1,li.byteLength=s,li.toByteArray=c,li.fromByteArray=h;for(var t=[],e=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)t[a]=n[a],e[n.charCodeAt(a)]=a;e[45]=62,e[95]=63;function i(p){var f=p.length;if(f%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=p.indexOf("=");g===-1&&(g=f);var y=g===f?0:4-g%4;return[g,y]}function s(p){var f=i(p),g=f[0],y=f[1];return(g+y)*3/4-y}function l(p,f,g){return(f+g)*3/4-g}function c(p){var f,g=i(p),y=g[0],E=g[1],k=new r(l(p,y,E)),R=0,O=E>0?y-4:y,b;for(b=0;b<O;b+=4)f=e[p.charCodeAt(b)]<<18|e[p.charCodeAt(b+1)]<<12|e[p.charCodeAt(b+2)]<<6|e[p.charCodeAt(b+3)],k[R++]=f>>16&255,k[R++]=f>>8&255,k[R++]=f&255;return E===2&&(f=e[p.charCodeAt(b)]<<2|e[p.charCodeAt(b+1)]>>4,k[R++]=f&255),E===1&&(f=e[p.charCodeAt(b)]<<10|e[p.charCodeAt(b+1)]<<4|e[p.charCodeAt(b+2)]>>2,k[R++]=f>>8&255,k[R++]=f&255),k}function d(p){return t[p>>18&63]+t[p>>12&63]+t[p>>6&63]+t[p&63]}function u(p,f,g){for(var y,E=[],k=f;k<g;k+=3)y=(p[k]<<16&16711680)+(p[k+1]<<8&65280)+(p[k+2]&255),E.push(d(y));return E.join("")}function h(p){for(var f,g=p.length,y=g%3,E=[],k=16383,R=0,O=g-y;R<O;R+=k)E.push(u(p,R,R+k>O?O:R+k));return y===1?(f=p[g-1],E.push(t[f>>2]+t[f<<4&63]+"==")):y===2&&(f=(p[g-2]<<8)+p[g-1],E.push(t[f>>10]+t[f>>4&63]+t[f<<2&63]+"=")),E.join("")}return li}var $R=DR();const UR=Xa($R);var zR=Object.defineProperty,BR=(t,e,r)=>e in t?zR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,HR=(t,e,r)=>(BR(t,e+"",r),r);function WR(t,e){let r=Array.from({length:t.length},(n,a)=>({start:a,end:a+1}));for(;r.length>1;){let n=null;for(let a=0;a<r.length-1;a++){const o=t.slice(r[a].start,r[a+1].end),i=e.get(o.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,a])}if(n!=null){const a=n[1];r[a]={start:r[a].start,end:r[a+1].end},r.splice(a+1,1)}else break}return r}function GR(t,e){return t.length===1?[e.get(t.join(","))]:WR(t,e).map(r=>e.get(t.slice(r.start,r.end).join(","))).filter(r=>r!=null)}function VR(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Sh=class{constructor(t,e){se(this,"specialTokens");se(this,"inverseSpecialTokens");se(this,"patStr");se(this,"textEncoder",new TextEncoder);se(this,"textDecoder",new TextDecoder("utf-8"));se(this,"rankMap",new Map);se(this,"textMap",new Map);this.patStr=t.pat_str;const r=t.bpe_ranks.split(`
`).filter(Boolean).reduce((n,a)=>{const[o,i,...s]=a.split(" "),l=Number.parseInt(i,10);return s.forEach((c,d)=>n[c]=l+d),n},{});for(const[n,a]of Object.entries(r)){const o=UR.toByteArray(n);this.rankMap.set(o.join(","),a),this.textMap.set(a,o)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[a,o])=>(n[o]=this.textEncoder.encode(a),n),{})}encode(t,e=[],r="all"){const n=new RegExp(this.patStr,"ug"),a=Sh.specialTokenRegex(Object.keys(this.specialTokens)),o=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),s=new Set(r==="all"?Object.keys(this.specialTokens).filter(c=>!i.has(c)):r);if(s.size>0){const c=Sh.specialTokenRegex([...s]),d=t.match(c);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let l=0;for(;;){let c=null,d=l;for(;a.lastIndex=d,c=a.exec(t),!(c==null||i.has(c[0]));)d=c.index+1;const u=(c==null?void 0:c.index)??t.length;for(const p of t.substring(l,u).matchAll(n)){const f=this.textEncoder.encode(p[0]),g=this.rankMap.get(f.join(","));if(g!=null){o.push(g);continue}o.push(...GR(f,this.rankMap))}if(c==null)break;let h=this.specialTokens[c[0]];o.push(h),l=c.index+c[0].length}return o}decode(t){const e=[];let r=0;for(let o=0;o<t.length;++o){const i=t[o],s=this.textMap.get(i)??this.inverseSpecialTokens[i];s!=null&&(e.push(s),r+=s.length)}const n=new Uint8Array(r);let a=0;for(const o of e)n.set(o,a),a+=o.length;return this.textDecoder.decode(n)}},Nw=Sh;HR(Nw,"specialTokenRegex",t=>new RegExp(t.map(e=>VR(e)).join("|"),"g"));function qR(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":return"o200k_base";default:throw new Error("Unknown model")}}const pl={},ZR=new Li({});async function Pw(t){return t in pl||(pl[t]=ZR.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new Nw(e)).catch(e=>{throw delete pl[t],e})),await pl[t]}Ub=async function(t){return Pw(qR(t))};class xh extends LR{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(r=>r.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,r={}){return this.splitDocuments(e,r)}splitOnSeparator(e,r){let n;if(r)if(this.keepSeparator){const a=r.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");n=e.split(new RegExp(`(?=${a})`))}else n=e.split(r);else n=e.split("");return n.filter(a=>a!=="")}async createDocuments(e,r=[],n={}){const a=r.length>0?r:[...Array(e.length)].map(()=>({})),{chunkHeader:o="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:s=!1}=n,l=new Array;for(let c=0;c<e.length;c+=1){const d=e[c];let u=1,h=null,p=-1;for(const f of await this.splitText(d)){let g=o;const y=d.indexOf(f,p+1);if(h===null){const O=this.numberOfNewLines(d,0,y);u+=O}else{const O=p+await this.lengthFunction(h);if(O<y){const b=this.numberOfNewLines(d,O,y);u+=b}else if(O>y){const b=this.numberOfNewLines(d,y,O);u-=b}s&&(g+=i)}const E=this.numberOfNewLines(f),k=a[c].loc&&typeof a[c].loc=="object"?{...a[c].loc}:{};k.lines={from:u,to:u+E};const R={...a[c],loc:k};g+=f,l.push(new xn({pageContent:g,metadata:R})),u+=E,h=f,p=y}}return l}numberOfNewLines(e,r,n){return(e.slice(r,n).match(/\n/g)||[]).length}async splitDocuments(e,r={}){const n=e.filter(i=>i.pageContent!==void 0),a=n.map(i=>i.pageContent),o=n.map(i=>i.metadata);return this.createDocuments(a,o,r)}joinDocs(e,r){const n=e.join(r).trim();return n===""?null:n}async mergeSplits(e,r){const n=[],a=[];let o=0;for(const s of e){const l=await this.lengthFunction(s);if(o+l+a.length*r.length>this.chunkSize&&(o>this.chunkSize&&console.warn(`Created a chunk of size ${o}, +
which is longer than the specified ${this.chunkSize}`),a.length>0)){const c=this.joinDocs(a,r);for(c!==null&&n.push(c);o>this.chunkOverlap||o+l+a.length*r.length>this.chunkSize&&o>0;)o-=await this.lengthFunction(a[0]),a.shift()}a.push(s),o+=l}const i=this.joinDocs(a,r);return i!==null&&n.push(i),n}}class JR extends xh{static lc_name(){return"CharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),this.separator=(e==null?void 0:e.separator)??this.separator}async splitText(e){const r=this.splitOnSeparator(e,this.separator);return this.mergeSplits(r,this.keepSeparator?"":this.separator)}}class fl extends xh{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,r){const n=[];let a=r[r.length-1],o;for(let c=0;c<r.length;c+=1){const d=r[c];if(d===""){a=d;break}if(e.includes(d)){a=d,o=r.slice(c+1);break}}const i=this.splitOnSeparator(e,a);let s=[];const l=this.keepSeparator?"":a;for(const c of i)if(await this.lengthFunction(c)<this.chunkSize)s.push(c);else{if(s.length){const d=await this.mergeSplits(s,l);n.push(...d),s=[]}if(!o)n.push(c);else{const d=await this._splitText(c,o);n.push(...d)}}if(s.length){const c=await this.mergeSplits(s,l);n.push(...c)}return n}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,r){return new fl({...r,separators:fl.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}class KR extends xh{static lc_name(){return"TokenTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"encodingName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disallowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenizer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.encodingName=(e==null?void 0:e.encodingName)??"gpt2",this.allowedSpecial=(e==null?void 0:e.allowedSpecial)??[],this.disallowedSpecial=(e==null?void 0:e.disallowedSpecial)??"all"}async splitText(e){this.tokenizer||(this.tokenizer=await Pw(this.encodingName));const r=[],n=this.tokenizer.encode(e,this.allowedSpecial,this.disallowedSpecial);let a=0;for(;a<n.length;){a>0&&(a-=this.chunkOverlap);const o=Math.min(a+this.chunkSize,n.length),i=n.slice(a,o);r.push(this.tokenizer.decode(i)),a=o}return r}}const YR="/NoLLMChat/assets/voy_search_bg-FlZi7F4l.wasm",XR=async(t={},e)=>{let r;if(e.startsWith("data:")){const n=e.replace(/^data:.*?base64,/,"");let a;if(typeof Gh=="function"&&typeof Gh.from=="function")a=Gh.from(n,"base64");else if(typeof atob=="function"){const o=atob(n);a=new Uint8Array(o.length);for(let i=0;i<o.length;i++)a[i]=o.charCodeAt(i)}else throw new Error("Cannot decode base64-encoded data URL");r=await WebAssembly.instantiate(a,t)}else{const n=await fetch(e),a=n.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&a.startsWith("application/wasm"))r=await WebAssembly.instantiateStreaming(n,t);else{const o=await n.arrayBuffer();r=await WebAssembly.instantiate(o,t)}}return r.instance.exports};let $e;function QR(t){$e=t}const $r=new Array(128).fill(void 0);$r.push(void 0,null,!0,!1);function ja(t){return $r[t]}let ci=$r.length;function Ur(t){ci===$r.length&&$r.push($r.length+1);const e=ci;return ci=$r[e],$r[e]=t,e}function eF(t){t<132||($r[t]=ci,ci=t)}function Ow(t){const e=ja(t);return eF(t),e}let Wn=0,ml=null;function gl(){return(ml===null||ml.byteLength===0)&&(ml=new Uint8Array($e.memory.buffer)),ml}const tF=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let yl=new tF("utf-8");const rF=typeof yl.encodeInto=="function"?function(t,e){return yl.encodeInto(t,e)}:function(t,e){const r=yl.encode(t);return e.set(r),{read:t.length,written:r.length}};function kh(t,e,r){if(r===void 0){const s=yl.encode(t),l=e(s.length)>>>0;return gl().subarray(l,l+s.length).set(s),Wn=s.length,l}let n=t.length,a=e(n)>>>0;const o=gl();let i=0;for(;i<n;i++){const s=t.charCodeAt(i);if(s>127)break;o[a+i]=s}if(i!==n){i!==0&&(t=t.slice(i)),a=r(a,n,n=i+t.length*3)>>>0;const s=gl().subarray(a+i,a+n),l=rF(t,s);i+=l.written}return Wn=i,a}function Iw(t){return t==null}let vl=null;function La(){return(vl===null||vl.byteLength===0)&&(vl=new Int32Array($e.memory.buffer)),vl}const nF=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let Cw=new nF("utf-8",{ignoreBOM:!0,fatal:!0});Cw.decode();function _l(t,e){return t=t>>>0,Cw.decode(gl().subarray(t,t+e))}let wl=null;function aF(){return(wl===null||wl.byteLength===0)&&(wl=new Float32Array($e.memory.buffer)),wl}function oF(t,e){const r=e(t.length*4)>>>0;return aF().set(t,r/4),Wn=t.length,r}function jw(t,e){try{return t.apply(this,e)}catch(r){$e.__wbindgen_exn_store(Ur(r))}}class hn{static __wrap(e){e=e>>>0;const r=Object.create(hn.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();$e.__wbg_voy_free(e)}constructor(e){const r=$e.voy_new(Iw(e)?0:Ur(e));return hn.__wrap(r)}serialize(){let e,r;try{const o=$e.__wbindgen_add_to_stack_pointer(-16);$e.voy_serialize(o,this.__wbg_ptr);var n=La()[o/4+0],a=La()[o/4+1];return e=n,r=a,_l(n,a)}finally{$e.__wbindgen_add_to_stack_pointer(16),$e.__wbindgen_free(e,r)}}static deserialize(e){const r=kh(e,$e.__wbindgen_malloc,$e.__wbindgen_realloc),n=Wn,a=$e.voy_deserialize(r,n);return hn.__wrap(a)}index(e){$e.voy_index(this.__wbg_ptr,Ur(e))}search(e,r){const n=oF(e,$e.__wbindgen_malloc),a=Wn,o=$e.voy_search(this.__wbg_ptr,n,a,r);return Ow(o)}add(e){$e.voy_add(this.__wbg_ptr,Ur(e))}remove(e){$e.voy_remove(this.__wbg_ptr,Ur(e))}clear(){$e.voy_clear(this.__wbg_ptr)}size(){return $e.voy_size(this.__wbg_ptr)>>>0}}function iF(t){const e=ja(t);return Ur(e)}function sF(t){return ja(t)===void 0}function lF(t){Ow(t)}function cF(){const t=new Error;return Ur(t)}function dF(t,e){const r=ja(e).stack,n=kh(r,$e.__wbindgen_malloc,$e.__wbindgen_realloc),a=Wn;La()[t/4+1]=a,La()[t/4+0]=n}function uF(t,e){let r,n;try{r=t,n=e,console.error(_l(t,e))}finally{$e.__wbindgen_free(r,n)}}function hF(){return jw(function(t,e){const r=JSON.parse(_l(t,e));return Ur(r)},arguments)}function pF(){return jw(function(t){const e=JSON.stringify(ja(t));return Ur(e)},arguments)}function fF(t,e){const r=ja(e),n=typeof r=="string"?r:void 0;var a=Iw(n)?0:kh(n,$e.__wbindgen_malloc,$e.__wbindgen_realloc),o=Wn;La()[t/4+1]=o,La()[t/4+0]=a}function mF(t,e){throw new Error(_l(t,e))}URL=globalThis.URL;const Je=await XR({"./voy_search_bg.js":{__wbindgen_object_clone_ref:iF,__wbindgen_is_undefined:sF,__wbindgen_object_drop_ref:lF,__wbg_new_abda76e883ba8a5f:cF,__wbg_stack_658279fe44541cf6:dF,__wbg_error_f851667af71bcfc6:uF,__wbg_parse_76a8a18ca3f8730b:hF,__wbg_stringify_d06ad2addc54d51e:pF,__wbindgen_string_get:fF,__wbindgen_throw:mF}},YR),gF=Je.memory,yF=Je.__wbg_voy_free,vF=Je.voy_new,_F=Je.voy_serialize,wF=Je.voy_deserialize,bF=Je.voy_index,EF=Je.voy_search,SF=Je.voy_add,xF=Je.voy_remove,kF=Je.voy_clear,TF=Je.voy_size,AF=Je.index,MF=Je.search,RF=Je.add,FF=Je.remove,NF=Je.clear,PF=Je.size,OF=Je.__wbindgen_malloc,IF=Je.__wbindgen_realloc,CF=Je.__wbindgen_add_to_stack_pointer,jF=Je.__wbindgen_free,LF=Je.__wbindgen_exn_store,DF=Object.freeze(Object.defineProperty({__proto__:null,__wbg_voy_free:yF,__wbindgen_add_to_stack_pointer:CF,__wbindgen_exn_store:LF,__wbindgen_free:jF,__wbindgen_malloc:OF,__wbindgen_realloc:IF,add:RF,clear:NF,index:AF,memory:gF,remove:FF,search:MF,size:PF,voy_add:SF,voy_clear:kF,voy_deserialize:wF,voy_index:bF,voy_new:vF,voy_remove:xF,voy_search:EF,voy_serialize:_F,voy_size:TF},Symbol.toStringTag,{value:"Module"}));QR(DF),co=function(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')};var Lw={exports:{}},Dw;function $F(){return Dw||(Dw=1,function(t,e){(function(r){t.exports=r()})(function(){return function r(n,a,o){function i(c,d){if(!a[c]){if(!n[c]){var u=typeof co=="function"&&co;if(!d&&u)return u(c,!0);if(s)return s(c,!0);var h=new Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h}var p=a[c]={exports:{}};n[c][0].call(p.exports,function(f){var g=n[c][1][f];return i(g||f)},p,p.exports,r,n,a,o)}return a[c].exports}for(var s=typeof co=="function"&&co,l=0;l<o.length;l++)i(o[l]);return i}({1:[function(r,n,a){(function(o){var i=o.MutationObserver||o.WebKitMutationObserver,s;if(i){var l=0,c=new i(f),d=o.document.createTextNode("");c.observe(d,{characterData:!0}),s=function(){d.data=l=++l%2}}else if(!o.setImmediate&&typeof o.MessageChannel<"u"){var u=new o.MessageChannel;u.port1.onmessage=f,s=function(){u.port2.postMessage(0)}}else"document"in o&&"onreadystatechange"in o.document.createElement("script")?s=function(){var y=o.document.createElement("script");y.onreadystatechange=function(){f(),y.onreadystatechange=null,y.parentNode.removeChild(y),y=null},o.document.documentElement.appendChild(y)}:s=function(){setTimeout(f,0)};var h,p=[];function f(){h=!0;for(var y,E,k=p.length;k;){for(E=p,p=[],y=-1;++y<k;)E[y]();k=p.length}h=!1}n.exports=g;function g(y){p.push(y)===1&&!h&&s()}}).call(this,typeof Ai<"u"?Ai:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(r,n,a){var o=r(1);function i(){}var s={},l=["REJECTED"],c=["FULFILLED"],d=["PENDING"];n.exports=u;function u(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,b!==i&&g(this,b)}u.prototype.catch=function(b){return this.then(null,b)},u.prototype.then=function(b,U){if(typeof b!="function"&&this.state===c||typeof U!="function"&&this.state===l)return this;var H=new this.constructor(i);if(this.state!==d){var $=this.state===c?b:U;p(H,$,this.outcome)}else this.queue.push(new h(H,b,U));return H};function h(b,U,H){this.promise=b,typeof U=="function"&&(this.onFulfilled=U,this.callFulfilled=this.otherCallFulfilled),typeof H=="function"&&(this.onRejected=H,this.callRejected=this.otherCallRejected)}h.prototype.callFulfilled=function(b){s.resolve(this.promise,b)},h.prototype.otherCallFulfilled=function(b){p(this.promise,this.onFulfilled,b)},h.prototype.callRejected=function(b){s.reject(this.promise,b)},h.prototype.otherCallRejected=function(b){p(this.promise,this.onRejected,b)};function p(b,U,H){o(function(){var $;try{$=U(H)}catch(G){return s.reject(b,G)}$===b?s.reject(b,new TypeError("Cannot resolve promise with itself")):s.resolve(b,$)})}s.resolve=function(b,U){var H=y(f,U);if(H.status==="error")return s.reject(b,H.value);var $=H.value;if($)g(b,$);else{b.state=c,b.outcome=U;for(var G=-1,ne=b.queue.length;++G<ne;)b.queue[G].callFulfilled(U)}return b},s.reject=function(b,U){b.state=l,b.outcome=U;for(var H=-1,$=b.queue.length;++H<$;)b.queue[H].callRejected(U);return b};function f(b){var U=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof U=="function")return function(){U.apply(b,arguments)}}function g(b,U){var H=!1;function $(S){H||(H=!0,s.reject(b,S))}function G(S){H||(H=!0,s.resolve(b,S))}function ne(){U(G,$)}var he=y(ne);he.status==="error"&&$(he.value)}function y(b,U){var H={};try{H.value=b(U),H.status="success"}catch($){H.status="error",H.value=$}return H}u.resolve=E;function E(b){return b instanceof this?b:s.resolve(new this(i),b)}u.reject=k;function k(b){var U=new this(i);return s.reject(U,b)}u.all=R;function R(b){var U=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var H=b.length,$=!1;if(!H)return this.resolve([]);for(var G=new Array(H),ne=0,he=-1,S=new this(i);++he<H;)M(b[he],he);return S;function M(x,_){U.resolve(x).then(B,function(N){$||($=!0,s.reject(S,N))});function B(N){G[_]=N,++ne===H&&!$&&($=!0,s.resolve(S,G))}}}u.race=O;function O(b){var U=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var H=b.length,$=!1;if(!H)return this.resolve([]);for(var G=-1,ne=new this(i);++G<H;)he(b[G]);return ne;function he(S){U.resolve(S).then(function(M){$||($=!0,s.resolve(ne,M))},function(M){$||($=!0,s.reject(ne,M))})}}},{1:1}],3:[function(r,n,a){(function(o){typeof o.Promise!="function"&&(o.Promise=r(2))}).call(this,typeof Ai<"u"?Ai:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(r,n,a){var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w};function i(w,T){if(!(w instanceof T))throw new TypeError("Cannot call a class as a function")}function s(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var l=s();function c(){try{if(!l||!l.open)return!1;var w=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),T=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!w||T)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function d(w,T){w=w||[],T=T||{};try{return new Blob(w,T)}catch(L){if(L.name!=="TypeError")throw L;for(var A=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,j=new A,P=0;P<w.length;P+=1)j.append(w[P]);return j.getBlob(T.type)}}typeof Promise>"u"&&r(3);var u=Promise;function h(w,T){T&&w.then(function(A){T(null,A)},function(A){T(A)})}function p(w,T,A){typeof T=="function"&&w.then(T),typeof A=="function"&&w.catch(A)}function f(w){return typeof w!="string"&&(console.warn(w+" used as a key, but it is not a string."),w=String(w)),w}function g(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var y="local-forage-detect-blob-support",E=void 0,k={},R=Object.prototype.toString,O="readonly",b="readwrite";function U(w){for(var T=w.length,A=new ArrayBuffer(T),j=new Uint8Array(A),P=0;P<T;P++)j[P]=w.charCodeAt(P);return A}function H(w){return new u(function(T){var A=w.transaction(y,b),j=d([""]);A.objectStore(y).put(j,"key"),A.onabort=function(P){P.preventDefault(),P.stopPropagation(),T(!1)},A.oncomplete=function(){var P=navigator.userAgent.match(/Chrome\/(\d+)/),L=navigator.userAgent.match(/Edge\//);T(L||!P||parseInt(P[1],10)>=43)}}).catch(function(){return!1})}function $(w){return typeof E=="boolean"?u.resolve(E):H(w).then(function(T){return E=T,E})}function G(w){var T=k[w.name],A={};A.promise=new u(function(j,P){A.resolve=j,A.reject=P}),T.deferredOperations.push(A),T.dbReady?T.dbReady=T.dbReady.then(function(){return A.promise}):T.dbReady=A.promise}function ne(w){var T=k[w.name],A=T.deferredOperations.pop();if(A)return A.resolve(),A.promise}function he(w,T){var A=k[w.name],j=A.deferredOperations.pop();if(j)return j.reject(T),j.promise}function S(w,T){return new u(function(A,j){if(k[w.name]=k[w.name]||ce(),w.db)if(T)G(w),w.db.close();else return A(w.db);var P=[w.name];T&&P.push(w.version);var L=l.open.apply(l,P);T&&(L.onupgradeneeded=function(W){var V=L.result;try{V.createObjectStore(w.storeName),W.oldVersion<=1&&V.createObjectStore(y)}catch(Q){if(Q.name==="ConstraintError")console.warn('The database "'+w.name+'" has been upgraded from version '+W.oldVersion+" to version "+W.newVersion+', but the storage "'+w.storeName+'" already exists.');else throw Q}}),L.onerror=function(W){W.preventDefault(),j(L.error)},L.onsuccess=function(){var W=L.result;W.onversionchange=function(V){V.target.close()},A(W),ne(w)}})}function M(w){return S(w,!1)}function x(w){return S(w,!0)}function _(w,T){if(!w.db)return!0;var A=!w.db.objectStoreNames.contains(w.storeName),j=w.version<w.db.version,P=w.version>w.db.version;if(j&&(w.version!==T&&console.warn('The database "'+w.name+`" can't be downgraded from version `+w.db.version+" to version "+w.version+"."),w.version=w.db.version),P||A){if(A){var L=w.db.version+1;L>w.version&&(w.version=L)}return!0}return!1}function B(w){return new u(function(T,A){var j=new FileReader;j.onerror=A,j.onloadend=function(P){var L=btoa(P.target.result||"");T({__local_forage_encoded_blob:!0,data:L,type:w.type})},j.readAsBinaryString(w)})}function N(w){var T=U(atob(w.data));return d([T],{type:w.type})}function C(w){return w&&w.__local_forage_encoded_blob}function I(w){var T=this,A=T._initReady().then(function(){var j=k[T._dbInfo.name];if(j&&j.dbReady)return j.dbReady});return p(A,w,w),A}function Y(w){G(w);for(var T=k[w.name],A=T.forages,j=0;j<A.length;j++){var P=A[j];P._dbInfo.db&&(P._dbInfo.db.close(),P._dbInfo.db=null)}return w.db=null,M(w).then(function(L){return w.db=L,_(w)?x(w):L}).then(function(L){w.db=T.db=L;for(var W=0;W<A.length;W++)A[W]._dbInfo.db=L}).catch(function(L){throw he(w,L),L})}function ae(w,T,A,j){j===void 0&&(j=1);try{var P=w.db.transaction(w.storeName,T);A(null,P)}catch(L){if(j>0&&(!w.db||L.name==="InvalidStateError"||L.name==="NotFoundError"))return u.resolve().then(function(){if(!w.db||L.name==="NotFoundError"&&!w.db.objectStoreNames.contains(w.storeName)&&w.version<=w.db.version)return w.db&&(w.version=w.db.version+1),x(w)}).then(function(){return Y(w).then(function(){ae(w,T,A,j-1)})}).catch(A);A(L)}}function ce(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function be(w){var T=this,A={db:null};if(w)for(var j in w)A[j]=w[j];var P=k[A.name];P||(P=ce(),k[A.name]=P),P.forages.push(T),T._initReady||(T._initReady=T.ready,T.ready=I);var L=[];function W(){return u.resolve()}for(var V=0;V<P.forages.length;V++){var Q=P.forages[V];Q!==T&&L.push(Q._initReady().catch(W))}var X=P.forages.slice(0);return u.all(L).then(function(){return A.db=P.db,M(A)}).then(function(J){return A.db=J,_(A,T._defaultConfig.version)?x(A):J}).then(function(J){A.db=P.db=J,T._dbInfo=A;for(var pe=0;pe<X.length;pe++){var Me=X[pe];Me!==T&&(Me._dbInfo.db=A.db,Me._dbInfo.version=A.version)}})}function Se(w,T){var A=this;w=f(w);var j=new u(function(P,L){A.ready().then(function(){ae(A._dbInfo,O,function(W,V){if(W)return L(W);try{var Q=V.objectStore(A._dbInfo.storeName),X=Q.get(w);X.onsuccess=function(){var J=X.result;J===void 0&&(J=null),C(J)&&(J=N(J)),P(J)},X.onerror=function(){L(X.error)}}catch(J){L(J)}})}).catch(L)});return h(j,T),j}function We(w,T){var A=this,j=new u(function(P,L){A.ready().then(function(){ae(A._dbInfo,O,function(W,V){if(W)return L(W);try{var Q=V.objectStore(A._dbInfo.storeName),X=Q.openCursor(),J=1;X.onsuccess=function(){var pe=X.result;if(pe){var Me=pe.value;C(Me)&&(Me=N(Me));var De=w(Me,pe.key,J++);De!==void 0?P(De):pe.continue()}else P()},X.onerror=function(){L(X.error)}}catch(pe){L(pe)}})}).catch(L)});return h(j,T),j}function vt(w,T,A){var j=this;w=f(w);var P=new u(function(L,W){var V;j.ready().then(function(){return V=j._dbInfo,R.call(T)==="[object Blob]"?$(V.db).then(function(Q){return Q?T:B(T)}):T}).then(function(Q){ae(j._dbInfo,b,function(X,J){if(X)return W(X);try{var pe=J.objectStore(j._dbInfo.storeName);Q===null&&(Q=void 0);var Me=pe.put(Q,w);J.oncomplete=function(){Q===void 0&&(Q=null),L(Q)},J.onabort=J.onerror=function(){var De=Me.error?Me.error:Me.transaction.error;W(De)}}catch(De){W(De)}})}).catch(W)});return h(P,A),P}function Br(w,T){var A=this;w=f(w);var j=new u(function(P,L){A.ready().then(function(){ae(A._dbInfo,b,function(W,V){if(W)return L(W);try{var Q=V.objectStore(A._dbInfo.storeName),X=Q.delete(w);V.oncomplete=function(){P()},V.onerror=function(){L(X.error)},V.onabort=function(){var J=X.error?X.error:X.transaction.error;L(J)}}catch(J){L(J)}})}).catch(L)});return h(j,T),j}function Hr(w){var T=this,A=new u(function(j,P){T.ready().then(function(){ae(T._dbInfo,b,function(L,W){if(L)return P(L);try{var V=W.objectStore(T._dbInfo.storeName),Q=V.clear();W.oncomplete=function(){j()},W.onabort=W.onerror=function(){var X=Q.error?Q.error:Q.transaction.error;P(X)}}catch(X){P(X)}})}).catch(P)});return h(A,w),A}function Ce(w){var T=this,A=new u(function(j,P){T.ready().then(function(){ae(T._dbInfo,O,function(L,W){if(L)return P(L);try{var V=W.objectStore(T._dbInfo.storeName),Q=V.count();Q.onsuccess=function(){j(Q.result)},Q.onerror=function(){P(Q.error)}}catch(X){P(X)}})}).catch(P)});return h(A,w),A}function _t(w,T){var A=this,j=new u(function(P,L){if(w<0){P(null);return}A.ready().then(function(){ae(A._dbInfo,O,function(W,V){if(W)return L(W);try{var Q=V.objectStore(A._dbInfo.storeName),X=!1,J=Q.openKeyCursor();J.onsuccess=function(){var pe=J.result;if(!pe){P(null);return}w===0||X?P(pe.key):(X=!0,pe.advance(w))},J.onerror=function(){L(J.error)}}catch(pe){L(pe)}})}).catch(L)});return h(j,T),j}function qn(w){var T=this,A=new u(function(j,P){T.ready().then(function(){ae(T._dbInfo,O,function(L,W){if(L)return P(L);try{var V=W.objectStore(T._dbInfo.storeName),Q=V.openKeyCursor(),X=[];Q.onsuccess=function(){var J=Q.result;if(!J){j(X);return}X.push(J.key),J.continue()},Q.onerror=function(){P(Q.error)}}catch(J){P(J)}})}).catch(P)});return h(A,w),A}function Ba(w,T){T=g.apply(this,arguments);var A=this.config();w=typeof w!="function"&&w||{},w.name||(w.name=w.name||A.name,w.storeName=w.storeName||A.storeName);var j=this,P;if(!w.name)P=u.reject("Invalid arguments");else{var L=w.name===A.name&&j._dbInfo.db,W=L?u.resolve(j._dbInfo.db):M(w).then(function(V){var Q=k[w.name],X=Q.forages;Q.db=V;for(var J=0;J<X.length;J++)X[J]._dbInfo.db=V;return V});w.storeName?P=W.then(function(V){if(V.objectStoreNames.contains(w.storeName)){var Q=V.version+1;G(w);var X=k[w.name],J=X.forages;V.close();for(var pe=0;pe<J.length;pe++){var Me=J[pe];Me._dbInfo.db=null,Me._dbInfo.version=Q}var De=new u(function(Le,et){var qe=l.open(w.name,Q);qe.onerror=function(Lt){var $h=qe.result;$h.close(),et(Lt)},qe.onupgradeneeded=function(){var Lt=qe.result;Lt.deleteObjectStore(w.storeName)},qe.onsuccess=function(){var Lt=qe.result;Lt.close(),Le(Lt)}});return De.then(function(Le){X.db=Le;for(var et=0;et<J.length;et++){var qe=J[et];qe._dbInfo.db=Le,ne(qe._dbInfo)}}).catch(function(Le){throw(he(w,Le)||u.resolve()).catch(function(){}),Le})}}):P=W.then(function(V){G(w);var Q=k[w.name],X=Q.forages;V.close();for(var J=0;J<X.length;J++){var pe=X[J];pe._dbInfo.db=null}var Me=new u(function(De,Le){var et=l.deleteDatabase(w.name);et.onerror=function(){var qe=et.result;qe&&qe.close(),Le(et.error)},et.onblocked=function(){console.warn('dropInstance blocked for database "'+w.name+'" until all open connections are closed')},et.onsuccess=function(){var qe=et.result;qe&&qe.close(),De(qe)}});return Me.then(function(De){Q.db=De;for(var Le=0;Le<X.length;Le++){var et=X[Le];ne(et._dbInfo)}}).catch(function(De){throw(he(w,De)||u.resolve()).catch(function(){}),De})})}return h(P,T),P}var ft={_driver:"asyncStorage",_initStorage:be,_support:c(),iterate:We,getItem:Se,setItem:vt,removeItem:Br,clear:Hr,length:Ce,key:_t,keys:qn,dropInstance:Ba};function fi(){return typeof openDatabase=="function"}var Ct="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ha="~~local_forage_type~",Wa=/^~~local_forage_type~([^~]+)~/,pn="__lfsc__:",Er=pn.length,mi="arbf",nr="blob",fn="si08",gi="ui08",Ga="uic8",ar="si16",jt="si32",yi="ur16",Va="ui32",kl="fl32",or="fl64",vi=Er+mi.length,_i=Object.prototype.toString;function wi(w){var T=w.length*.75,A=w.length,j,P=0,L,W,V,Q;w[w.length-1]==="="&&(T--,w[w.length-2]==="="&&T--);var X=new ArrayBuffer(T),J=new Uint8Array(X);for(j=0;j<A;j+=4)L=Ct.indexOf(w[j]),W=Ct.indexOf(w[j+1]),V=Ct.indexOf(w[j+2]),Q=Ct.indexOf(w[j+3]),J[P++]=L<<2|W>>4,J[P++]=(W&15)<<4|V>>2,J[P++]=(V&3)<<6|Q&63;return X}function bi(w){var T=new Uint8Array(w),A="",j;for(j=0;j<T.length;j+=3)A+=Ct[T[j]>>2],A+=Ct[(T[j]&3)<<4|T[j+1]>>4],A+=Ct[(T[j+1]&15)<<2|T[j+2]>>6],A+=Ct[T[j+2]&63];return T.length%3===2?A=A.substring(0,A.length-1)+"=":T.length%3===1&&(A=A.substring(0,A.length-2)+"=="),A}function Tl(w,T){var A="";if(w&&(A=_i.call(w)),w&&(A==="[object ArrayBuffer]"||w.buffer&&_i.call(w.buffer)==="[object ArrayBuffer]")){var j,P=pn;w instanceof ArrayBuffer?(j=w,P+=mi):(j=w.buffer,A==="[object Int8Array]"?P+=fn:A==="[object Uint8Array]"?P+=gi:A==="[object Uint8ClampedArray]"?P+=Ga:A==="[object Int16Array]"?P+=ar:A==="[object Uint16Array]"?P+=yi:A==="[object Int32Array]"?P+=jt:A==="[object Uint32Array]"?P+=Va:A==="[object Float32Array]"?P+=kl:A==="[object Float64Array]"?P+=or:T(new Error("Failed to get type for BinaryArray"))),T(P+bi(j))}else if(A==="[object Blob]"){var L=new FileReader;L.onload=function(){var W=Ha+w.type+"~"+bi(this.result);T(pn+nr+W)},L.readAsArrayBuffer(w)}else try{T(JSON.stringify(w))}catch(W){console.error("Couldn't convert value into a JSON string: ",w),T(null,W)}}function qa(w){if(w.substring(0,Er)!==pn)return JSON.parse(w);var T=w.substring(vi),A=w.substring(Er,vi),j;if(A===nr&&Wa.test(T)){var P=T.match(Wa);j=P[1],T=T.substring(P[0].length)}var L=wi(T);switch(A){case mi:return L;case nr:return d([L],{type:j});case fn:return new Int8Array(L);case gi:return new Uint8Array(L);case Ga:return new Uint8ClampedArray(L);case ar:return new Int16Array(L);case yi:return new Uint16Array(L);case jt:return new Int32Array(L);case Va:return new Uint32Array(L);case kl:return new Float32Array(L);case or:return new Float64Array(L);default:throw new Error("Unkown type: "+A)}}var Za={serialize:Tl,deserialize:qa,stringToBuffer:wi,bufferToString:bi};function Ja(w,T,A,j){w.executeSql("CREATE TABLE IF NOT EXISTS "+T.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],A,j)}function Ch(w){var T=this,A={db:null};if(w)for(var j in w)A[j]=typeof w[j]!="string"?w[j].toString():w[j];var P=new u(function(L,W){try{A.db=openDatabase(A.name,String(A.version),A.description,A.size)}catch(V){return W(V)}A.db.transaction(function(V){Ja(V,A,function(){T._dbInfo=A,L()},function(Q,X){W(X)})},W)});return A.serializer=Za,P}function ir(w,T,A,j,P,L){w.executeSql(A,j,P,function(W,V){V.code===V.SYNTAX_ERR?W.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[T.storeName],function(Q,X){X.rows.length?L(Q,V):Ja(Q,T,function(){Q.executeSql(A,j,P,L)},L)},L):L(W,V)},L)}function jh(w,T){var A=this;w=f(w);var j=new u(function(P,L){A.ready().then(function(){var W=A._dbInfo;W.db.transaction(function(V){ir(V,W,"SELECT * FROM "+W.storeName+" WHERE key = ? LIMIT 1",[w],function(Q,X){var J=X.rows.length?X.rows.item(0).value:null;J&&(J=W.serializer.deserialize(J)),P(J)},function(Q,X){L(X)})})}).catch(L)});return h(j,T),j}function Al(w,T){var A=this,j=new u(function(P,L){A.ready().then(function(){var W=A._dbInfo;W.db.transaction(function(V){ir(V,W,"SELECT * FROM "+W.storeName,[],function(Q,X){for(var J=X.rows,pe=J.length,Me=0;Me<pe;Me++){var De=J.item(Me),Le=De.value;if(Le&&(Le=W.serializer.deserialize(Le)),Le=w(Le,De.key,Me+1),Le!==void 0){P(Le);return}}P()},function(Q,X){L(X)})})}).catch(L)});return h(j,T),j}function Zn(w,T,A,j){var P=this;w=f(w);var L=new u(function(W,V){P.ready().then(function(){T===void 0&&(T=null);var Q=T,X=P._dbInfo;X.serializer.serialize(T,function(J,pe){pe?V(pe):X.db.transaction(function(Me){ir(Me,X,"INSERT OR REPLACE INTO "+X.storeName+" (key, value) VALUES (?, ?)",[w,J],function(){W(Q)},function(De,Le){V(Le)})},function(Me){if(Me.code===Me.QUOTA_ERR){if(j>0){W(Zn.apply(P,[w,Q,A,j-1]));return}V(Me)}})})}).catch(V)});return h(L,A),L}function Ka(w,T,A){return Zn.apply(this,[w,T,A,1])}function Lh(w,T){var A=this;w=f(w);var j=new u(function(P,L){A.ready().then(function(){var W=A._dbInfo;W.db.transaction(function(V){ir(V,W,"DELETE FROM "+W.storeName+" WHERE key = ?",[w],function(){P()},function(Q,X){L(X)})})}).catch(L)});return h(j,T),j}function Dh(w){var T=this,A=new u(function(j,P){T.ready().then(function(){var L=T._dbInfo;L.db.transaction(function(W){ir(W,L,"DELETE FROM "+L.storeName,[],function(){j()},function(V,Q){P(Q)})})}).catch(P)});return h(A,w),A}function F(w){var T=this,A=new u(function(j,P){T.ready().then(function(){var L=T._dbInfo;L.db.transaction(function(W){ir(W,L,"SELECT COUNT(key) as c FROM "+L.storeName,[],function(V,Q){var X=Q.rows.item(0).c;j(X)},function(V,Q){P(Q)})})}).catch(P)});return h(A,w),A}function D(w,T){var A=this,j=new u(function(P,L){A.ready().then(function(){var W=A._dbInfo;W.db.transaction(function(V){ir(V,W,"SELECT key FROM "+W.storeName+" WHERE id = ? LIMIT 1",[w+1],function(Q,X){var J=X.rows.length?X.rows.item(0).key:null;P(J)},function(Q,X){L(X)})})}).catch(L)});return h(j,T),j}function z(w){var T=this,A=new u(function(j,P){T.ready().then(function(){var L=T._dbInfo;L.db.transaction(function(W){ir(W,L,"SELECT key FROM "+L.storeName,[],function(V,Q){for(var X=[],J=0;J<Q.rows.length;J++)X.push(Q.rows.item(J).key);j(X)},function(V,Q){P(Q)})})}).catch(P)});return h(A,w),A}function q(w){return new u(function(T,A){w.transaction(function(j){j.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(P,L){for(var W=[],V=0;V<L.rows.length;V++)W.push(L.rows.item(V).name);T({db:w,storeNames:W})},function(P,L){A(L)})},function(j){A(j)})})}function oe(w,T){T=g.apply(this,arguments);var A=this.config();w=typeof w!="function"&&w||{},w.name||(w.name=w.name||A.name,w.storeName=w.storeName||A.storeName);var j=this,P;return w.name?P=new u(function(L){var W;w.name===A.name?W=j._dbInfo.db:W=openDatabase(w.name,"","",0),w.storeName?L({db:W,storeNames:[w.storeName]}):L(q(W))}).then(function(L){return new u(function(W,V){L.db.transaction(function(Q){function X(De){return new u(function(Le,et){Q.executeSql("DROP TABLE IF EXISTS "+De,[],function(){Le()},function(qe,Lt){et(Lt)})})}for(var J=[],pe=0,Me=L.storeNames.length;pe<Me;pe++)J.push(X(L.storeNames[pe]));u.all(J).then(function(){W()}).catch(function(De){V(De)})},function(Q){V(Q)})})}):P=u.reject("Invalid arguments"),h(P,T),P}var ue={_driver:"webSQLStorage",_initStorage:Ch,_support:fi(),iterate:Al,getItem:jh,setItem:Ka,removeItem:Lh,clear:Dh,length:F,key:D,keys:z,dropInstance:oe};function ye(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function ie(w,T){var A=w.name+"/";return w.storeName!==T.storeName&&(A+=w.storeName+"/"),A}function le(){var w="_localforage_support_test";try{return localStorage.setItem(w,!0),localStorage.removeItem(w),!1}catch{return!0}}function ee(){return!le()||localStorage.length>0}function ve(w){var T=this,A={};if(w)for(var j in w)A[j]=w[j];return A.keyPrefix=ie(w,T._defaultConfig),ee()?(T._dbInfo=A,A.serializer=Za,u.resolve()):u.reject()}function ke(w){var T=this,A=T.ready().then(function(){for(var j=T._dbInfo.keyPrefix,P=localStorage.length-1;P>=0;P--){var L=localStorage.key(P);L.indexOf(j)===0&&localStorage.removeItem(L)}});return h(A,w),A}function Ue(w,T){var A=this;w=f(w);var j=A.ready().then(function(){var P=A._dbInfo,L=localStorage.getItem(P.keyPrefix+w);return L&&(L=P.serializer.deserialize(L)),L});return h(j,T),j}function Ge(w,T){var A=this,j=A.ready().then(function(){for(var P=A._dbInfo,L=P.keyPrefix,W=L.length,V=localStorage.length,Q=1,X=0;X<V;X++){var J=localStorage.key(X);if(J.indexOf(L)===0){var pe=localStorage.getItem(J);if(pe&&(pe=P.serializer.deserialize(pe)),pe=w(pe,J.substring(W),Q++),pe!==void 0)return pe}}});return h(j,T),j}function Ne(w,T){var A=this,j=A.ready().then(function(){var P=A._dbInfo,L;try{L=localStorage.key(w)}catch{L=null}return L&&(L=L.substring(P.keyPrefix.length)),L});return h(j,T),j}function wt(w){var T=this,A=T.ready().then(function(){for(var j=T._dbInfo,P=localStorage.length,L=[],W=0;W<P;W++){var V=localStorage.key(W);V.indexOf(j.keyPrefix)===0&&L.push(V.substring(j.keyPrefix.length))}return L});return h(A,w),A}function Ke(w){var T=this,A=T.keys().then(function(j){return j.length});return h(A,w),A}function Jn(w,T){var A=this;w=f(w);var j=A.ready().then(function(){var P=A._dbInfo;localStorage.removeItem(P.keyPrefix+w)});return h(j,T),j}function sr(w,T,A){var j=this;w=f(w);var P=j.ready().then(function(){T===void 0&&(T=null);var L=T;return new u(function(W,V){var Q=j._dbInfo;Q.serializer.serialize(T,function(X,J){if(J)V(J);else try{localStorage.setItem(Q.keyPrefix+w,X),W(L)}catch(pe){(pe.name==="QuotaExceededError"||pe.name==="NS_ERROR_DOM_QUOTA_REACHED")&&V(pe),V(pe)}})})});return h(P,A),P}function mn(w,T){if(T=g.apply(this,arguments),w=typeof w!="function"&&w||{},!w.name){var A=this.config();w.name=w.name||A.name,w.storeName=w.storeName||A.storeName}var j=this,P;return w.name?P=new u(function(L){w.storeName?L(ie(w,j._defaultConfig)):L(w.name+"/")}).then(function(L){for(var W=localStorage.length-1;W>=0;W--){var V=localStorage.key(W);V.indexOf(L)===0&&localStorage.removeItem(V)}}):P=u.reject("Invalid arguments"),h(P,T),P}var Sr={_driver:"localStorageWrapper",_initStorage:ve,_support:ye(),iterate:Ge,getItem:Ue,setItem:sr,removeItem:Jn,clear:ke,length:Ke,key:Ne,keys:wt,dropInstance:mn},Ei=function(w,T){return w===T||typeof w=="number"&&typeof T=="number"&&isNaN(w)&&isNaN(T)},lr=function(w,T){for(var A=w.length,j=0;j<A;){if(Ei(w[j],T))return!0;j++}return!1},Kn=Array.isArray||function(w){return Object.prototype.toString.call(w)==="[object Array]"},xr={},Yn={},Ae={INDEXEDDB:ft,WEBSQL:ue,LOCALSTORAGE:Sr},bt=[Ae.INDEXEDDB._driver,Ae.WEBSQL._driver,Ae.LOCALSTORAGE._driver],kr=["dropInstance"],ze=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(kr),gn={description:"",driver:bt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ml(w,T){w[T]=function(){var A=arguments;return w.ready().then(function(){return w[T].apply(w,A)})}}function Si(){for(var w=1;w<arguments.length;w++){var T=arguments[w];if(T)for(var A in T)T.hasOwnProperty(A)&&(Kn(T[A])?arguments[0][A]=T[A].slice():arguments[0][A]=T[A])}return arguments[0]}var jN=function(){function w(T){i(this,w);for(var A in Ae)if(Ae.hasOwnProperty(A)){var j=Ae[A],P=j._driver;this[A]=P,xr[P]||this.defineDriver(j)}this._defaultConfig=Si({},gn),this._config=Si({},this._defaultConfig,T),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return w.prototype.config=function(T){if((typeof T>"u"?"undefined":o(T))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var A in T){if(A==="storeName"&&(T[A]=T[A].replace(/\W/g,"_")),A==="version"&&typeof T[A]!="number")return new Error("Database version must be a number.");this._config[A]=T[A]}return"driver"in T&&T.driver?this.setDriver(this._config.driver):!0}else return typeof T=="string"?this._config[T]:this._config},w.prototype.defineDriver=function(T,A,j){var P=new u(function(L,W){try{var V=T._driver,Q=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!T._driver){W(Q);return}for(var X=ze.concat("_initStorage"),J=0,pe=X.length;J<pe;J++){var Me=X[J],De=!lr(kr,Me);if((De||T[Me])&&typeof T[Me]!="function"){W(Q);return}}var Le=function(){for(var qe=function(DN){return function(){var $N=new Error("Method "+DN+" is not implemented by the current driver"),Eb=u.reject($N);return h(Eb,arguments[arguments.length-1]),Eb}},Lt=0,$h=kr.length;Lt<$h;Lt++){var Uh=kr[Lt];T[Uh]||(T[Uh]=qe(Uh))}};Le();var et=function(qe){xr[V]&&console.info("Redefining LocalForage driver: "+V),xr[V]=T,Yn[V]=qe,L()};"_support"in T?T._support&&typeof T._support=="function"?T._support().then(et,W):et(!!T._support):et(!0)}catch(qe){W(qe)}});return p(P,A,j),P},w.prototype.driver=function(){return this._driver||null},w.prototype.getDriver=function(T,A,j){var P=xr[T]?u.resolve(xr[T]):u.reject(new Error("Driver not found."));return p(P,A,j),P},w.prototype.getSerializer=function(T){var A=u.resolve(Za);return p(A,T),A},w.prototype.ready=function(T){var A=this,j=A._driverSet.then(function(){return A._ready===null&&(A._ready=A._initDriver()),A._ready});return p(j,T,T),j},w.prototype.setDriver=function(T,A,j){var P=this;Kn(T)||(T=[T]);var L=this._getSupportedDrivers(T);function W(){P._config.driver=P.driver()}function V(J){return P._extend(J),W(),P._ready=P._initStorage(P._config),P._ready}function Q(J){return function(){var pe=0;function Me(){for(;pe<J.length;){var De=J[pe];return pe++,P._dbInfo=null,P._ready=null,P.getDriver(De).then(V).catch(Me)}W();var Le=new Error("No available storage method found.");return P._driverSet=u.reject(Le),P._driverSet}return Me()}}var X=this._driverSet!==null?this._driverSet.catch(function(){return u.resolve()}):u.resolve();return this._driverSet=X.then(function(){var J=L[0];return P._dbInfo=null,P._ready=null,P.getDriver(J).then(function(pe){P._driver=pe._driver,W(),P._wrapLibraryMethodsWithReady(),P._initDriver=Q(L)})}).catch(function(){W();var J=new Error("No available storage method found.");return P._driverSet=u.reject(J),P._driverSet}),p(this._driverSet,A,j),this._driverSet},w.prototype.supports=function(T){return!!Yn[T]},w.prototype._extend=function(T){Si(this,T)},w.prototype._getSupportedDrivers=function(T){for(var A=[],j=0,P=T.length;j<P;j++){var L=T[j];this.supports(L)&&A.push(L)}return A},w.prototype._wrapLibraryMethodsWithReady=function(){for(var T=0,A=ze.length;T<A;T++)Ml(this,ze[T])},w.prototype.createInstance=function(T){return new w(T)},w}(),LN=new jN;n.exports=LN},{3:3}]},{},[4])(4)})}(Lw)),Lw.exports}var UF=$F();const $w=Xa(UF);class zF extends ot{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,r){throw new Error("Not implemented!")}async invoke(e,r){return this.getRelevantDocuments(e,Pe(r))}async getRelevantDocuments(e,r){var o;const n=Pe(RM(r)),a=await((o=await Bt.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}))==null?void 0:o.handleRetrieverStart(this.toJSON(),e,n.runId,void 0,void 0,void 0,n.runName));try{const i=await this._getRelevantDocuments(e,a);return await(a==null?void 0:a.handleRetrieverEnd(i)),i}catch(i){throw await(a==null?void 0:a.handleRetrieverError(i)),i}}}class Th extends zF{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,r){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},r==null?void 0:r.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,r==null?void 0:r.getChild("vectorstore"))}async addDocuments(e,r){return this.vectorStore.addDocuments(e,r)}}class Uw extends bn{constructor(e,r){super(r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,r=4,n=void 0,a=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)).map(o=>o[0])}async similaritySearchWithScore(e,r=4,n=void 0,a=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)}static fromTexts(e,r,n,a){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,r,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,r,n,a,o,i){if(typeof e=="number")return new Th({vectorStore:this,k:e,filter:r,tags:[...a??[],this._vectorstoreType()],metadata:o,verbose:i,callbacks:n});{const s={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Th({...s,searchKwargs:e.searchKwargs}):new Th({...s})}}}function BF(t,e){let r=0,n=0,a=0;for(let o=0;o<t.length;o++)r+=t[o]*e[o],n+=t[o]*t[o],a+=e[o]*e[o];return r/(Math.sqrt(n)*Math.sqrt(a))}function HF(t,e){let r=0,n=0,a=0;for(let o=0;o<t.length;o++)r+=t[o]*e[o],n+=t[o]*t[o],a+=e[o]*e[o];return r/(Math.sqrt(n)*Math.sqrt(a))}function WF(t,e,r){if(t.length===0||t[0].length===0||e.length===0||e[0].length===0)return[[]];if(t[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[t.length,t[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return t.map(n=>e.map(a=>r(n,a)).map(a=>Number.isNaN(a)?0:a))}function zw(t,e){return WF(t,e,HF)}function GF(t,e,r=.5,n=4){if(Math.min(n,e.length)<=0)return[];const a=Array.isArray(t[0])?t:[t],o=zw(a,e)[0],i=VF(o).maxIndex,s=[e[i]],l=[i];for(;l.length<Math.min(n,e.length);){let c=-1/0,d=-1;const u=zw(e,s);o.forEach((h,p)=>{if(l.includes(p))return;const f=Math.max(...u[p]),g=r*h-(1-r)*f;g>c&&(c=g,d=p)}),s.push(e[d]),l.push(d)}return l}function VF(t){if(t.length===0)return{maxIndex:-1,maxValue:NaN};let e=t[0],r=0;for(let n=1;n<t.length;n+=1)t[n]>e&&(r=n,e=t[n]);return{maxIndex:r,maxValue:e}}class Da extends Uw{_vectorstoreType(){return"memory"}constructor(e,{similarity:r,...n}={}){super(e,n),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=r??BF}async addDocuments(e){const r=e.map(({pageContent:n})=>n);return this.addVectors(await this.embeddings.embedDocuments(r),e)}async addVectors(e,r){const n=e.map((a,o)=>({content:r[o].pageContent,embedding:a,metadata:r[o].metadata,id:r[o].id}));this.memoryVectors=this.memoryVectors.concat(n)}async _queryVectors(e,r,n){const a=o=>{if(!n)return!0;const i=new xn({metadata:o.metadata,pageContent:o.content,id:o.id});return n(i)};return this.memoryVectors.filter(a).map((o,i)=>({similarity:this.similarity(e,o.embedding),index:i,metadata:o.metadata,content:o.content,embedding:o.embedding,id:o.id})).sort((o,i)=>o.similarity>i.similarity?-1:0).slice(0,r)}async similaritySearchVectorWithScore(e,r,n){return(await this._queryVectors(e,r,n)).map(a=>[new xn({metadata:a.metadata,pageContent:a.content,id:a.id}),a.similarity])}async maxMarginalRelevanceSearch(e,r){const n=await this.embeddings.embedQuery(e),a=await this._queryVectors(n,r.fetchK??20,r.filter),o=a.map(i=>i.embedding);return GF(n,o,r.lambda,r.k).map(i=>new xn({metadata:a[i].metadata,pageContent:a[i].content,id:a[i].id}))}static async fromTexts(e,r,n,a){const o=[];for(let i=0;i<e.length;i+=1){const s=Array.isArray(r)?r[i]:r,l=new xn({pageContent:e[i],metadata:s});o.push(l)}return Da.fromDocuments(o,n,a)}static async fromDocuments(e,r,n){const a=new this(r,n);return await a.addDocuments(e),a}static async fromExistingIndex(e,r){return new this(e,r)}}class Gn extends Uw{_vectorstoreType(){return"voi"}constructor(e,r){super(r,{}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numDimensions",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"docstore",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.client=e,this.embeddings=r}async addDocuments(e){const r=e.map(({pageContent:o})=>o);if(e.length===0)return;const n=(await this.embeddings.embedDocuments(r.slice(0,1)))[0];if(this.numDimensions===null)this.numDimensions=n.length;else if(this.numDimensions!==n.length)throw new Error(`Vectors must have the same length as the number of dimensions (${this.numDimensions})`);const a=await this.embeddings.embedDocuments(r.slice(1));await this.addVectors([n,...a],e)}async addVectors(e,r){if(e.length===0)return;if(this.numDimensions===null&&(this.numDimensions=e[0].length),e.length!==r.length)throw new Error("Vectors and metadata must have the same length");if(!e.every(a=>a.length===this.numDimensions))throw new Error(`Vectors must have the same length as the number of dimensions (${this.numDimensions})`);e.forEach((a,o)=>{const i=r[o];this.docstore.push({embeddings:a,document:i})});const n=this.docstore.map((a,o)=>({id:String(o),embeddings:a.embeddings,title:"",url:""}));this.client.index({embeddings:n})}async similaritySearchVectorWithScore(e,r){if(this.numDimensions===null)throw new Error("There aren't any elements in the index yet.");if(e.length!==this.numDimensions)throw new Error(`Query vector must have the same length as the number of dimensions (${this.numDimensions})`);const n=Math.min(this.docstore.length,r);return n>this.docstore.length&&console.warn(`k (${r}) is greater than the number of elements in the index (${this.docstore.length}), setting k to ${n}`),this.client.search(new Float32Array(e),n).neighbors.map(({id:a},o)=>[this.docstore[parseInt(a,10)].document,o])}async delete(e){if(e.deleteAll===!0)await this.client.clear();else throw new Error('You must provide a "deleteAll" parameter.')}static async fromTexts(e,r,n,a){const o=[];for(let i=0;i<e.length;i+=1){const s=Array.isArray(r)?r[i]:r,l=new xn({pageContent:e[i],metadata:s});o.push(l)}return Gn.fromDocuments(o,n,a)}static async fromDocuments(e,r,n){const a=new Gn(n,r);return await a.addDocuments(e),a}}var Bw={exports:{}};let Hw;Hw={},of=Object.freeze(Object.defineProperty({__proto__:null,default:Hw},Symbol.toStringTag,{value:"Module"})),fp=YN(of);var Ww;function qF(){return Ww||(Ww=1,function(t){(function(){var e="input is invalid type",r="finalize already called",n=typeof window=="object",a=n?window:{};a.JS_MD5_NO_WINDOW&&(n=!1);var o=!n&&typeof self=="object",i=!a.JS_MD5_NO_NODE_JS&&typeof gt=="object"&&gt.versions&&gt.versions.node;i?a=Ai:o&&(a=self);var s=!a.JS_MD5_NO_COMMON_JS&&!0&&t.exports,l=!a.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",c="0123456789abcdef".split(""),d=[128,32768,8388608,-2147483648],u=[0,8,16,24],h=["hex","array","digest","buffer","arrayBuffer","base64"],p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),f=[],g;if(l){var y=new ArrayBuffer(68);g=new Uint8Array(y),f=new Uint32Array(y)}var E=Array.isArray;(a.JS_MD5_NO_NODE_JS||!E)&&(E=function(S){return Object.prototype.toString.call(S)==="[object Array]"});var k=ArrayBuffer.isView;l&&(a.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!k)&&(k=function(S){return typeof S=="object"&&S.buffer&&S.buffer.constructor===ArrayBuffer});var R=function(S){var M=typeof S;if(M==="string")return[S,!0];if(M!=="object"||S===null)throw new Error(e);if(l&&S.constructor===ArrayBuffer)return[new Uint8Array(S),!1];if(!E(S)&&!k(S))throw new Error(e);return[S,!1]},O=function(S){return function(M){return new G(!0).update(M)[S]()}},b=function(){var S=O("hex");i&&(S=U(S)),S.create=function(){return new G},S.update=function(_){return S.create().update(_)};for(var M=0;M<h.length;++M){var x=h[M];S[x]=O(x)}return S},U=function(S){var M=fp,x=XN().Buffer,_;x.from&&!a.JS_MD5_NO_BUFFER_FROM?_=x.from:_=function(N){return new x(N)};var B=function(N){if(typeof N=="string")return M.createHash("md5").update(N,"utf8").digest("hex");if(N==null)throw new Error(e);return N.constructor===ArrayBuffer&&(N=new Uint8Array(N)),E(N)||k(N)||N.constructor===x?M.createHash("md5").update(_(N)).digest("hex"):S(N)};return B},H=function(S){return function(M,x){return new ne(M,!0).update(x)[S]()}},$=function(){var S=H("hex");S.create=function(_){return new ne(_)},S.update=function(_,B){return S.create(_).update(B)};for(var M=0;M<h.length;++M){var x=h[M];S[x]=H(x)}return S};function G(S){if(S)f[0]=f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0,this.blocks=f,this.buffer8=g;else if(l){var M=new ArrayBuffer(68);this.buffer8=new Uint8Array(M),this.blocks=new Uint32Array(M)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}G.prototype.update=function(S){if(this.finalized)throw new Error(r);var M=R(S);S=M[0];for(var x=M[1],_,B=0,N,C=S.length,I=this.blocks,Y=this.buffer8;B<C;){if(this.hashed&&(this.hashed=!1,I[0]=I[16],I[16]=I[1]=I[2]=I[3]=I[4]=I[5]=I[6]=I[7]=I[8]=I[9]=I[10]=I[11]=I[12]=I[13]=I[14]=I[15]=0),x)if(l)for(N=this.start;B<C&&N<64;++B)_=S.charCodeAt(B),_<128?Y[N++]=_:_<2048?(Y[N++]=192|_>>>6,Y[N++]=128|_&63):_<55296||_>=57344?(Y[N++]=224|_>>>12,Y[N++]=128|_>>>6&63,Y[N++]=128|_&63):(_=65536+((_&1023)<<10|S.charCodeAt(++B)&1023),Y[N++]=240|_>>>18,Y[N++]=128|_>>>12&63,Y[N++]=128|_>>>6&63,Y[N++]=128|_&63);else for(N=this.start;B<C&&N<64;++B)_=S.charCodeAt(B),_<128?I[N>>>2]|=_<<u[N++&3]:_<2048?(I[N>>>2]|=(192|_>>>6)<<u[N++&3],I[N>>>2]|=(128|_&63)<<u[N++&3]):_<55296||_>=57344?(I[N>>>2]|=(224|_>>>12)<<u[N++&3],I[N>>>2]|=(128|_>>>6&63)<<u[N++&3],I[N>>>2]|=(128|_&63)<<u[N++&3]):(_=65536+((_&1023)<<10|S.charCodeAt(++B)&1023),I[N>>>2]|=(240|_>>>18)<<u[N++&3],I[N>>>2]|=(128|_>>>12&63)<<u[N++&3],I[N>>>2]|=(128|_>>>6&63)<<u[N++&3],I[N>>>2]|=(128|_&63)<<u[N++&3]);else if(l)for(N=this.start;B<C&&N<64;++B)Y[N++]=S[B];else for(N=this.start;B<C&&N<64;++B)I[N>>>2]|=S[B]<<u[N++&3];this.lastByteIndex=N,this.bytes+=N-this.start,N>=64?(this.start=N-64,this.hash(),this.hashed=!0):this.start=N}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},G.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var S=this.blocks,M=this.lastByteIndex;S[M>>>2]|=d[M&3],M>=56&&(this.hashed||this.hash(),S[0]=S[16],S[16]=S[1]=S[2]=S[3]=S[4]=S[5]=S[6]=S[7]=S[8]=S[9]=S[10]=S[11]=S[12]=S[13]=S[14]=S[15]=0),S[14]=this.bytes<<3,S[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},G.prototype.hash=function(){var S,M,x,_,B,N,C=this.blocks;this.first?(S=C[0]-680876937,S=(S<<7|S>>>25)-271733879<<0,_=(-1732584194^S&2004318071)+C[1]-117830708,_=(_<<12|_>>>20)+S<<0,x=(-271733879^_&(S^-271733879))+C[2]-1126478375,x=(x<<17|x>>>15)+_<<0,M=(S^x&(_^S))+C[3]-1316259209,M=(M<<22|M>>>10)+x<<0):(S=this.h0,M=this.h1,x=this.h2,_=this.h3,S+=(_^M&(x^_))+C[0]-680876936,S=(S<<7|S>>>25)+M<<0,_+=(x^S&(M^x))+C[1]-389564586,_=(_<<12|_>>>20)+S<<0,x+=(M^_&(S^M))+C[2]+606105819,x=(x<<17|x>>>15)+_<<0,M+=(S^x&(_^S))+C[3]-1044525330,M=(M<<22|M>>>10)+x<<0),S+=(_^M&(x^_))+C[4]-176418897,S=(S<<7|S>>>25)+M<<0,_+=(x^S&(M^x))+C[5]+1200080426,_=(_<<12|_>>>20)+S<<0,x+=(M^_&(S^M))+C[6]-1473231341,x=(x<<17|x>>>15)+_<<0,M+=(S^x&(_^S))+C[7]-45705983,M=(M<<22|M>>>10)+x<<0,S+=(_^M&(x^_))+C[8]+1770035416,S=(S<<7|S>>>25)+M<<0,_+=(x^S&(M^x))+C[9]-1958414417,_=(_<<12|_>>>20)+S<<0,x+=(M^_&(S^M))+C[10]-42063,x=(x<<17|x>>>15)+_<<0,M+=(S^x&(_^S))+C[11]-1990404162,M=(M<<22|M>>>10)+x<<0,S+=(_^M&(x^_))+C[12]+1804603682,S=(S<<7|S>>>25)+M<<0,_+=(x^S&(M^x))+C[13]-40341101,_=(_<<12|_>>>20)+S<<0,x+=(M^_&(S^M))+C[14]-1502002290,x=(x<<17|x>>>15)+_<<0,M+=(S^x&(_^S))+C[15]+1236535329,M=(M<<22|M>>>10)+x<<0,S+=(x^_&(M^x))+C[1]-165796510,S=(S<<5|S>>>27)+M<<0,_+=(M^x&(S^M))+C[6]-1069501632,_=(_<<9|_>>>23)+S<<0,x+=(S^M&(_^S))+C[11]+643717713,x=(x<<14|x>>>18)+_<<0,M+=(_^S&(x^_))+C[0]-373897302,M=(M<<20|M>>>12)+x<<0,S+=(x^_&(M^x))+C[5]-701558691,S=(S<<5|S>>>27)+M<<0,_+=(M^x&(S^M))+C[10]+38016083,_=(_<<9|_>>>23)+S<<0,x+=(S^M&(_^S))+C[15]-660478335,x=(x<<14|x>>>18)+_<<0,M+=(_^S&(x^_))+C[4]-405537848,M=(M<<20|M>>>12)+x<<0,S+=(x^_&(M^x))+C[9]+568446438,S=(S<<5|S>>>27)+M<<0,_+=(M^x&(S^M))+C[14]-1019803690,_=(_<<9|_>>>23)+S<<0,x+=(S^M&(_^S))+C[3]-187363961,x=(x<<14|x>>>18)+_<<0,M+=(_^S&(x^_))+C[8]+1163531501,M=(M<<20|M>>>12)+x<<0,S+=(x^_&(M^x))+C[13]-1444681467,S=(S<<5|S>>>27)+M<<0,_+=(M^x&(S^M))+C[2]-51403784,_=(_<<9|_>>>23)+S<<0,x+=(S^M&(_^S))+C[7]+1735328473,x=(x<<14|x>>>18)+_<<0,M+=(_^S&(x^_))+C[12]-1926607734,M=(M<<20|M>>>12)+x<<0,B=M^x,S+=(B^_)+C[5]-378558,S=(S<<4|S>>>28)+M<<0,_+=(B^S)+C[8]-2022574463,_=(_<<11|_>>>21)+S<<0,N=_^S,x+=(N^M)+C[11]+1839030562,x=(x<<16|x>>>16)+_<<0,M+=(N^x)+C[14]-35309556,M=(M<<23|M>>>9)+x<<0,B=M^x,S+=(B^_)+C[1]-1530992060,S=(S<<4|S>>>28)+M<<0,_+=(B^S)+C[4]+1272893353,_=(_<<11|_>>>21)+S<<0,N=_^S,x+=(N^M)+C[7]-155497632,x=(x<<16|x>>>16)+_<<0,M+=(N^x)+C[10]-1094730640,M=(M<<23|M>>>9)+x<<0,B=M^x,S+=(B^_)+C[13]+681279174,S=(S<<4|S>>>28)+M<<0,_+=(B^S)+C[0]-358537222,_=(_<<11|_>>>21)+S<<0,N=_^S,x+=(N^M)+C[3]-722521979,x=(x<<16|x>>>16)+_<<0,M+=(N^x)+C[6]+76029189,M=(M<<23|M>>>9)+x<<0,B=M^x,S+=(B^_)+C[9]-640364487,S=(S<<4|S>>>28)+M<<0,_+=(B^S)+C[12]-421815835,_=(_<<11|_>>>21)+S<<0,N=_^S,x+=(N^M)+C[15]+530742520,x=(x<<16|x>>>16)+_<<0,M+=(N^x)+C[2]-995338651,M=(M<<23|M>>>9)+x<<0,S+=(x^(M|~_))+C[0]-198630844,S=(S<<6|S>>>26)+M<<0,_+=(M^(S|~x))+C[7]+1126891415,_=(_<<10|_>>>22)+S<<0,x+=(S^(_|~M))+C[14]-1416354905,x=(x<<15|x>>>17)+_<<0,M+=(_^(x|~S))+C[5]-57434055,M=(M<<21|M>>>11)+x<<0,S+=(x^(M|~_))+C[12]+1700485571,S=(S<<6|S>>>26)+M<<0,_+=(M^(S|~x))+C[3]-1894986606,_=(_<<10|_>>>22)+S<<0,x+=(S^(_|~M))+C[10]-1051523,x=(x<<15|x>>>17)+_<<0,M+=(_^(x|~S))+C[1]-2054922799,M=(M<<21|M>>>11)+x<<0,S+=(x^(M|~_))+C[8]+1873313359,S=(S<<6|S>>>26)+M<<0,_+=(M^(S|~x))+C[15]-30611744,_=(_<<10|_>>>22)+S<<0,x+=(S^(_|~M))+C[6]-1560198380,x=(x<<15|x>>>17)+_<<0,M+=(_^(x|~S))+C[13]+1309151649,M=(M<<21|M>>>11)+x<<0,S+=(x^(M|~_))+C[4]-145523070,S=(S<<6|S>>>26)+M<<0,_+=(M^(S|~x))+C[11]-1120210379,_=(_<<10|_>>>22)+S<<0,x+=(S^(_|~M))+C[2]+718787259,x=(x<<15|x>>>17)+_<<0,M+=(_^(x|~S))+C[9]-343485551,M=(M<<21|M>>>11)+x<<0,this.first?(this.h0=S+1732584193<<0,this.h1=M-271733879<<0,this.h2=x-1732584194<<0,this.h3=_+271733878<<0,this.first=!1):(this.h0=this.h0+S<<0,this.h1=this.h1+M<<0,this.h2=this.h2+x<<0,this.h3=this.h3+_<<0)},G.prototype.hex=function(){this.finalize();var S=this.h0,M=this.h1,x=this.h2,_=this.h3;return c[S>>>4&15]+c[S&15]+c[S>>>12&15]+c[S>>>8&15]+c[S>>>20&15]+c[S>>>16&15]+c[S>>>28&15]+c[S>>>24&15]+c[M>>>4&15]+c[M&15]+c[M>>>12&15]+c[M>>>8&15]+c[M>>>20&15]+c[M>>>16&15]+c[M>>>28&15]+c[M>>>24&15]+c[x>>>4&15]+c[x&15]+c[x>>>12&15]+c[x>>>8&15]+c[x>>>20&15]+c[x>>>16&15]+c[x>>>28&15]+c[x>>>24&15]+c[_>>>4&15]+c[_&15]+c[_>>>12&15]+c[_>>>8&15]+c[_>>>20&15]+c[_>>>16&15]+c[_>>>28&15]+c[_>>>24&15]},G.prototype.toString=G.prototype.hex,G.prototype.digest=function(){this.finalize();var S=this.h0,M=this.h1,x=this.h2,_=this.h3;return[S&255,S>>>8&255,S>>>16&255,S>>>24&255,M&255,M>>>8&255,M>>>16&255,M>>>24&255,x&255,x>>>8&255,x>>>16&255,x>>>24&255,_&255,_>>>8&255,_>>>16&255,_>>>24&255]},G.prototype.array=G.prototype.digest,G.prototype.arrayBuffer=function(){this.finalize();var S=new ArrayBuffer(16),M=new Uint32Array(S);return M[0]=this.h0,M[1]=this.h1,M[2]=this.h2,M[3]=this.h3,S},G.prototype.buffer=G.prototype.arrayBuffer,G.prototype.base64=function(){for(var S,M,x,_="",B=this.array(),N=0;N<15;)S=B[N++],M=B[N++],x=B[N++],_+=p[S>>>2]+p[(S<<4|M>>>4)&63]+p[(M<<2|x>>>6)&63]+p[x&63];return S=B[N],_+=p[S>>>2]+p[S<<4&63]+"==",_};function ne(S,M){var x,_=R(S);if(S=_[0],_[1]){var B=[],N=S.length,C=0,I;for(x=0;x<N;++x)I=S.charCodeAt(x),I<128?B[C++]=I:I<2048?(B[C++]=192|I>>>6,B[C++]=128|I&63):I<55296||I>=57344?(B[C++]=224|I>>>12,B[C++]=128|I>>>6&63,B[C++]=128|I&63):(I=65536+((I&1023)<<10|S.charCodeAt(++x)&1023),B[C++]=240|I>>>18,B[C++]=128|I>>>12&63,B[C++]=128|I>>>6&63,B[C++]=128|I&63);S=B}S.length>64&&(S=new G(!0).update(S).array());var Y=[],ae=[];for(x=0;x<64;++x){var ce=S[x]||0;Y[x]=92^ce,ae[x]=54^ce}G.call(this,M),this.update(ae),this.oKeyPad=Y,this.inner=!0,this.sharedMemory=M}ne.prototype=new G,ne.prototype.finalize=function(){if(G.prototype.finalize.call(this),this.inner){this.inner=!1;var S=this.array();G.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(S),G.prototype.finalize.call(this)}};var he=b();he.md5=he,he.md5.hmac=$(),s?t.exports=he:a.md5=he})()}(Bw)),Bw.exports}var ZF=qF();let di,$a,ui,Ah,hi;Ri=t=>t?t.join("|\u294A|"):"",Fi=t=>t?t.split("|\u294A|"):[],di=t=>t?t.join("|\u294C|"):"",Ui=t=>t?t.split("|\u294C|"):[],Nb=(t,e)=>({headers:Ri(t),data:di(e.map(r=>Ri(r)))}),cp=(t,e)=>{const r=Fi(t),n=Ui(e).reduce((a,o)=>{const i=Fi(o);return i.length===r.length?[...a,r.reduce((s,l,c)=>({...s,[l]:i[c]}),{})]:a},[]);return{headers:r,rows:n}},$a=async({provider:t,storedData:e,databaseName:r})=>{switch(t){case"voy":return e.map((n,a)=>{var o,i;return{id:n.id||((o=n.metadata)==null?void 0:o.id)||a,title:JSON.stringify({pageContent:n.content,metadata:n.metadata}),url:`/${r}/items/${n.id||((i=n.metadata)==null?void 0:i.id)||a}`,embeddings:n.embedding}});case"memory":return e.map((n,a)=>{var o;return{content:n.content,embedding:n.embedding,metadata:n.metadata,id:n.id||((o=n.metadata)==null?void 0:o.id)||a}});default:throw new Error("Invalid provider")}},ui=async({storageType:t,provider:e,databaseName:r,storageService:n,storageDataNode:a})=>{switch(t){case Gr.DataNode:{if(!a)throw new Error("Storage data node not found");if("csv"in a){const{rows:o}=cp((a==null?void 0:a.headers)||"",(a==null?void 0:a.csv)||"");return $a({provider:e,storedData:o,databaseName:r})}return"json"in a?$a({provider:e,storedData:JSON.parse((a==null?void 0:a.json)||"[]"),databaseName:r}):"jsonl"in a?$a({provider:e,storedData:Ui(a==null?void 0:a.jsonl).map(o=>JSON.parse(o)),databaseName:r}):[]}case Gr.DatabaseNode:return $a({provider:e,storedData:Ui(a==null?void 0:a.raw).map(o=>JSON.parse(o)),databaseName:r});case Gr.IndexedDB:{const o=await(n==null?void 0:n.getItem(r));return o?$a({provider:e,storedData:o,databaseName:r}):[]}default:throw new Error("Invalid storage type")}},Ah=async({docstore:t,storageType:e,databaseName:r,embeddingStorage:n,storageDataNode:a})=>{const o=t.map(i=>"embedding"in i?{id:i.id,embedding:i.embedding,content:i.content,metadata:i.metadata}:{id:i.document.metadata.id,content:i.document.pageContent,metadata:i.document.metadata,embedding:i.embeddings});switch(e){case Gr.DataNode:{if(a=a,!a)throw new Error("Storage data node not found");const i=dp(a);i==="CSVData"&&await He(i).update(a.id,{csv:di(o.map(s=>{const l=Fi(a.headers).map(c=>s[c]);return Ri(l)}))}),i==="JSONData"&&await He(i).update(a.id,{json:JSON.stringify(o)}),i==="JSONLData"&&await He(i).update(a.id,{jsonl:di(o.map(s=>JSON.stringify(s)))})}break;case Gr.DatabaseNode:{const i=a;await He("VectorDatabase").update(i.id,{raw:di(o.map(s=>JSON.stringify(s)))})}break;case Gr.IndexedDB:await n.setItem(r,o);break}return o},dp=t=>"csv"in t?"CSVData":"json"in t?"JSONData":"jsonl"in t?"JSONLData":void 0,hi=t=>ZF.md5(t),up="nomic-ai/nomic-embed-text-v1.5",hp=class{constructor(t){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Li(t??{})}},pp=(t,e)=>t.reduce((r,n,a)=>{const o=Math.floor(a/e),i=r[o]||[];return r[o]=i.concat([n]),r},[]);class JF extends hp{constructor(r){super(r??{});se(this,"worker");se(this,"EMBEDDING_LOAD_MESSAGE_ID","EMBEDDING_LOAD_MESSAGE_ID");se(this,"ready",!1);se(this,"timeout");se(this,"stripNewLines",!0);se(this,"modelName","Xenova/all-MiniLM-L6-v2");se(this,"model","Xenova/all-MiniLM-L6-v2");se(this,"batchSize",512);se(this,"pretrainedOptions");se(this,"pipelineOptions");se(this,"refProcesses",new Map);se(this,"initWorker",()=>{gr(this.worker,"load",this.EMBEDDING_LOAD_MESSAGE_ID,[this.model,this.pretrainedOptions]),this.worker.removeEventListener("message",this.handleMessages),this.worker.addEventListener("message",this.handleMessages);const r=Or();return this.refProcesses.set(this.EMBEDDING_LOAD_MESSAGE_ID,[r.promise,r.resolve,r.reject]),r.promise});se(this,"handleMessages",r=>{const n=r.data.messageId;if(n!==qg)if(r.data.type==="complete"||r.data.type==="error"){const[,a,o]=this.refProcesses.get(n)||[];r.data.type==="complete"?a==null||a(r.data.payload):o==null||o(new Error(JSON.stringify(r.data.payload))),n===this.EMBEDDING_LOAD_MESSAGE_ID&&(this.ready=!!r.data.payload),this.refProcesses.delete(n)}else r.data.type==="started"||r.data.type==="inprogress"||vn("Unknown message type",r.data)});se(this,"runEmbedding",async r=>{if(!this.worker)throw new Error("MISSING WORKER");const n=this.refProcesses.get(this.EMBEDDING_LOAD_MESSAGE_ID);if(n!=null&&n[0]&&await(n==null?void 0:n[0]),!this.ready)throw new Error("WORKER NOT READY YET");return this.caller.call(async()=>{const a=Dt(),o=Or(()=>{gr(this.worker,"embedding",a,[r,this.pipelineOptions])});return this.refProcesses.set(a,[o.promise,o.resolve,o.reject]),o.promise.then(i=>i)})});this.worker=r.worker,this.modelName=(r==null?void 0:r.model)??(r==null?void 0:r.modelName)??this.model,this.model=this.modelName,this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.pretrainedOptions=(r==null?void 0:r.pretrainedOptions)??{},this.pipelineOptions={pooling:"mean",normalize:!0,...r==null?void 0:r.pipelineOptions},this.initWorker()}async embedDocuments(r){const n=pp(this.stripNewLines?r.map(i=>i.replace(/\n/g," ")):r,this.batchSize).map(i=>this.runEmbedding(i)),a=await Promise.all(n),o=[];for(let i=0;i<a.length;i+=1){const s=a[i];for(let l=0;l<s.length;l+=1)o.push(s[l])}return o}async embedQuery(r){return(await this.runEmbedding([this.stripNewLines?r.replace(/\n/g," "):r]))[0]}}let Gw,Vw,qw,Zw;Gw=()=>new Worker(new URL("/NoLLMChat/assets/embedding.worker-UR4QY3w7.js",import.meta.url),{type:"module"}),Vw=(t,e)=>{var r;try{const n=JSON.parse(t.metadata||"{}");if(!(n!=null&&n.textSplitter))return e;switch((r=n==null?void 0:n.textSplitter)==null?void 0:r.type){case"TokenTextSplitter":return new KR({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);case"CharacterTextSplitter":return new JR({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);case"RecursiveCharacterTextSplitter":return new fl({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);default:throw new Error("Invalid text splitter")}}catch{return e}},qw=(t,e)=>({destroy:()=>{try{const r=e().worker;r&&r.terminate(),t({localEmbedding:void 0,embeddingStorage:void 0,worker:void 0})}catch(r){vn("Destroy Local Embedding Thread",r)}},init:async()=>{try{const r=e().worker;r&&r.terminate();const n=Gw(),a=new JF({modelName:up,worker:n}),o=$w.createInstance({name:"vector-database",driver:$w.INDEXEDDB,storeName:"main"});t({worker:n,localEmbedding:a,embeddingStorage:o})}catch(r){vn("Init Local Embedding Thread",r)}finally{t({ready:!0})}},index:async(r,n)=>{const a=(r==null?void 0:r.embedding)||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await He("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await He(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=hi(i.name),c=await Vw(i,n),d=await ui({databaseName:l,storageType:i.storage||"IndexedDB",provider:i.provider,storageService:o,storageDataNode:i||s});switch(i.provider){case cr.Voy:{const u=new hn({embeddings:d}),h=new Gn(u,a);await h.addDocuments(c),await Ah({databaseName:l,provider:i.provider,embeddingStorage:o,docstore:h.docstore,storageType:i.storage||"IndexedDB",storageDataNode:s||i})}break;case cr.Memory:{const u=new Da(a);u.memoryVectors=d,await u.addDocuments(c),await Ah({databaseName:l,provider:i.provider,embeddingStorage:o,docstore:u.memoryVectors,storageType:i.storage||"IndexedDB",storageDataNode:s||i})}break}},getVectorDatabase:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await He("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await He(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=hi(i.name),c=await ui({databaseName:l,storageType:i.storage||"IndexedDB",provider:i.provider,storageService:e().embeddingStorage,storageDataNode:s});switch(i.provider){case cr.Voy:{const d=new hn({embeddings:c});return new Gn(d,a)}case cr.Memory:{const d=new Da(a,n);return d.memoryVectors=c,d}default:throw new Error("Invalid provider")}},similaritySearch:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await He("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i||!i.provider)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await He(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=hi(i.name),c=await ui({databaseName:l,storageDataNode:s||i,provider:i.provider,storageService:o,storageType:i.storage||"IndexedDB"});switch(i.provider){case cr.Voy:{const d=new hn({embeddings:c});return await new Gn(d,a).similaritySearch(...n)}case cr.Memory:{const d=new Da(a);return d.memoryVectors=c,await d.similaritySearch(...n)}default:throw new Error("Invalid provider")}},similaritySearchWithScore:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await He("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i||!i.provider)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await He(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=hi(i.name),c=await ui({databaseName:l,provider:i.provider,storageDataNode:s||i,storageService:o,storageType:i.storage||"IndexedDB"});switch(i.provider){case cr.Voy:{const d=new hn({embeddings:c});return await new Gn(d,a).similaritySearchWithScore(...n)}case cr.Memory:{const d=new Da(a);return d.memoryVectors=c,await d.similaritySearchWithScore(...n)}default:throw new Error("Invalid provider")}}}),Zw={ready:!1,localEmbedding:void 0,embeddingStorage:void 0,worker:void 0},Ul=Hh()(Wh((t,e)=>({...Zw,...qw(t,e)})));async function*bl(t,e,r,n){for(;;){const o=r.get(e);if(o){const{processInfo:i}=o;if(i&&typeof i=="object"&&"data"in i&&"lastIndex"in i&&Array.isArray(i.data)){const s=n!=null&&n.lastChunkOnly?i.data[i.data.length-1]:i.data.slice(+`${i.lastIndex}`);s&&(!Array.isArray(s)||s!=null&&s.length)&&(i.lastIndex=n!=null&&n.lastChunkOnly?i.data.length-1:i.data.length>0?i.data.length:0,yield s)}await new Promise(s=>setTimeout(s,(n==null?void 0:n.interval)||150))}else break}const a=await t;return yield a,a}const KF=()=>new Worker(new URL("/NoLLMChat/assets/local-llm.worker-DN_Fjh8L.js",import.meta.url),{type:"module"}),YF=(t,e)=>r=>{Zg(r,t().refProcesses,{onWorkerInit:()=>e({ready:!0})})};async function XF(t,...e){const r=t.worker,n=t.refProcesses;if(!r)throw new Error("Worker not initialized");const a=Or(()=>{gr(r,"load",t.messageId,e)});return n.set(t.messageId,{promise:a.promise,resolve:a.resolve,reject:a.reject,processInfo:{type:"load",data:[],lastIndex:0}}),bl(a.promise,t.messageId,n,{lastChunkOnly:!0})}let Jw,Kw,Mh,El,Rh,Fh,Ua,Sl,Yw,Xw,Qw,eb,tb,rb,nb,ab,ob,ib,Nh;Jw=(t,e)=>({setInitializing:r=>{const n=e().initializing;t({initializing:{...n,...r}})},setSelectedModel:r=>{t({selectedModel:r})},destroy:()=>{try{const r=e().handler,n=e().worker;n&&(r&&n.removeEventListener("message",r),n.terminate()),t({handler:void 0,worker:void 0})}catch(r){vn("Destroy Local LLM thread",r)}},init:()=>{try{const r=e().handler,n=e().worker;n&&(r&&n.removeEventListener("message",r),n.terminate());const a=KF(),o=YF(e,t);a.addEventListener("message",o),t({handler:o,worker:a})}catch(r){vn("Init Local LLM Thread",r)}},syncCachedLLMURLs:async()=>caches.open("webllm/config").then(async r=>r.keys()).then(r=>{const n=r.map(a=>a.url);return t({cachedLLMURLs:n}),n}),loadModel:async(r,{callback:n})=>{let a=e().currentLoadModelMessageId;const o=e().worker,i=e().initProgressCallbacks,s=e().initializing,l=e().refProcesses;if(a){const d=l.get(a);if(d){const{reject:u}=d;u==null||u("stop"),l.delete(a)}}a=Dt(),t({currentLoadModelMessageId:Dt(),selectedModel:r,initializing:{...s,loading:!0}});const c=await XF({messageId:a,worker:o,refProcesses:l},{model:r});for await(const d of c)d&&(i.forEach(u=>u(d)),n==null||n(d));setTimeout(()=>{i.forEach(d=>d({progress:100,timeElapsed:1,text:`Model ${r} loaded.`})),t({initializing:{...e().initializing,loading:!1}})},100)},unLoadModel:()=>{const r=e().worker,n=e().refProcesses,a=e().currentLoadModelMessageId;if(a){const o=n.get(a);if(o){const{reject:i}=o;i==null||i("stop"),n.delete(a)}}r&&gr(r,"unload",Dt(),[]),t({selectedModel:void 0})},setInitProgressCallback:r=>{const n=e().initProgressCallbacks;return n.push(r),t({initProgressCallbacks:n}),()=>{t({initProgressCallbacks:e().initProgressCallbacks.filter(a=>a!==r)})}},invoke:(...r)=>{const n=e().refProcesses,a=e().worker;if(!a)throw new Error("Worker not initialized");const o=Dt(),i=Or(()=>{gr(a,"invoke",o,r)});return n.set(o,{promise:i.promise,resolve:i.resolve,reject:i.reject,processInfo:{type:"invoke",data:[],lastIndex:0}}),i.promise},stream:(...r)=>{const n=e().refProcesses,a=e().worker;if(!a)throw new Error("Worker not initialized");const o=Dt(),[i,...s]=r,l=Or(()=>{gr(a,"stream",o,[El(i),...s])});n.set(o,{promise:l.promise,resolve:l.resolve,reject:l.reject,processInfo:{type:"invoke",data:[],lastIndex:0}});const c=l.promise;return bl(c,o,n)},structuredStream:(r,...n)=>{const a=e().refProcesses,o=e().worker;if(!o)throw new Error("Worker not initialized");const i=Dt(),[s,...l]=n,c=Or(()=>{gr(o,"structured-stream",i,[r,El(s),...l])});a.set(i,{promise:c.promise,resolve:c.resolve,reject:c.reject,processInfo:{type:"invoke",data:[],lastIndex:0}});const d=c.promise;return bl(d,i,a)},toolsCallingStream:(r,...n)=>{const a=e().refProcesses,o=e().worker;if(!o)throw new Error("Worker not initialized");const i=Dt(),[s,...l]=n,c=Or(()=>{gr(o,"tools-calling-stream",i,[r,El(s),...l])});a.set(i,{promise:c.promise,resolve:c.resolve,reject:c.reject,processInfo:{type:"invoke",data:[],lastIndex:0}});const d=c.promise;return bl(d,i,a)},getCurrentModelInfo:async()=>{const r=e().refProcesses,n=e().worker;if(!n)throw new Error("Worker not initialized");const a=Dt(),o=Or(()=>{gr(n,"get-current-model-info",a,[])});return r.set(a,{promise:o.promise,resolve:o.resolve,reject:o.reject,processInfo:{type:"get-current-model-info",data:[],lastIndex:0}}),o.promise}}),Kw={cachedLLMURLs:[],ready:!1,initializing:{worker:!0,init:!0,loading:!1},selectedModel:"",refProcesses:new Map,currentLoadModelMessageId:void 0,handler:void 0,initProgressCallbacks:[],worker:void 0},ql=Hh()(Wh((t,e)=>({...Kw,...Jw(t,e)}))),Mh=t=>typeof t=="string"?t:t instanceof ao?{instanceof:"HumanMessage",item:t,content:t.content}:t instanceof Qn?{instanceof:"AIMessage",item:t,content:t.content}:t instanceof Mi?{instanceof:"SystemMessage",item:t,content:t.content}:t,El=t=>Array.isArray(t)?t.map(Mh):Mh(t),Rh=1,Fh={erro_evt:{name:"erro_evt",structName:"glue_msg_error",className:"GlueMsgError",fields:[{type:"str",name:"message",isNullable:!1}]},load_req:{name:"load_req",structName:"glue_msg_load_req",className:"GlueMsgLoadReq",fields:[{type:"arr_str",name:"model_paths",isNullable:!1},{type:"bool",name:"n_ctx_auto",isNullable:!1},{type:"bool",name:"use_mmap",isNullable:!1},{type:"bool",name:"use_mlock",isNullable:!1},{type:"int",name:"n_gpu_layers",isNullable:!1},{type:"int",name:"seed",isNullable:!1},{type:"int",name:"n_ctx",isNullable:!1},{type:"int",name:"n_threads",isNullable:!1},{type:"bool",name:"embeddings",isNullable:!0},{type:"bool",name:"offload_kqv",isNullable:!0},{type:"int",name:"n_batch",isNullable:!0},{type:"int",name:"n_seq_max",isNullable:!0},{type:"str",name:"pooling_type",isNullable:!0},{type:"str",name:"rope_scaling_type",isNullable:!0},{type:"float",name:"rope_freq_base",isNullable:!0},{type:"float",name:"rope_freq_scale",isNullable:!0},{type:"float",name:"yarn_ext_factor",isNullable:!0},{type:"float",name:"yarn_attn_factor",isNullable:!0},{type:"float",name:"yarn_beta_fast",isNullable:!0},{type:"float",name:"yarn_beta_slow",isNullable:!0},{type:"int",name:"yarn_orig_ctx",isNullable:!0},{type:"str",name:"cache_type_k",isNullable:!0},{type:"str",name:"cache_type_v",isNullable:!0}]},load_res:{name:"load_res",structName:"glue_msg_load_res",className:"GlueMsgLoadRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"int",name:"n_ctx",isNullable:!1},{type:"int",name:"n_batch",isNullable:!1},{type:"int",name:"n_ubatch",isNullable:!1},{type:"int",name:"n_vocab",isNullable:!1},{type:"int",name:"n_ctx_train",isNullable:!1},{type:"int",name:"n_embd",isNullable:!1},{type:"int",name:"n_layer",isNullable:!1},{type:"arr_str",name:"metadata_key",isNullable:!1},{type:"arr_str",name:"metadata_val",isNullable:!1},{type:"int",name:"token_bos",isNullable:!1},{type:"int",name:"token_eos",isNullable:!1},{type:"int",name:"token_eot",isNullable:!1},{type:"arr_int",name:"list_tokens_eog",isNullable:!1},{type:"bool",name:"add_bos_token",isNullable:!1},{type:"bool",name:"add_eos_token",isNullable:!1},{type:"bool",name:"has_encoder",isNullable:!1},{type:"int",name:"token_decoder_start",isNullable:!1}]},opti_req:{name:"opti_req",structName:"glue_msg_set_options_req",className:"GlueMsgSetOptionsReq",fields:[{type:"bool",name:"embeddings",isNullable:!1}]},opti_res:{name:"opti_res",structName:"glue_msg_set_options_res",className:"GlueMsgSetOptionsRes",fields:[{type:"bool",name:"success",isNullable:!1}]},sint_req:{name:"sint_req",structName:"glue_msg_sampling_init_req",className:"GlueMsgSamplingInitReq",fields:[{type:"int",name:"mirostat",isNullable:!0},{type:"float",name:"mirostat_tau",isNullable:!0},{type:"float",name:"mirostat_eta",isNullable:!0},{type:"float",name:"temp",isNullable:!0},{type:"float",name:"top_p",isNullable:!0},{type:"int",name:"top_k",isNullable:!0},{type:"int",name:"penalty_last_n",isNullable:!0},{type:"float",name:"penalty_repeat",isNullable:!0},{type:"float",name:"penalty_freq",isNullable:!0},{type:"float",name:"penalty_present",isNullable:!0},{type:"float",name:"dynatemp_range",isNullable:!0},{type:"float",name:"dynatemp_exponent",isNullable:!0},{type:"arr_str",name:"samplers_sequence",isNullable:!0},{type:"str",name:"grammar",isNullable:!0},{type:"int",name:"n_prev",isNullable:!0},{type:"int",name:"n_probs",isNullable:!0},{type:"float",name:"min_p",isNullable:!0},{type:"float",name:"typical_p",isNullable:!0},{type:"float",name:"typ_p",isNullable:!0},{type:"arr_int",name:"logit_bias_toks",isNullable:!0},{type:"arr_float",name:"logit_bias_vals",isNullable:!0},{type:"arr_int",name:"tokens",isNullable:!0}]},sint_res:{name:"sint_res",structName:"glue_msg_sampling_init_res",className:"GlueMsgSamplingInitRes",fields:[{type:"bool",name:"success",isNullable:!1}]},gvoc_req:{name:"gvoc_req",structName:"glue_msg_get_vocab_req",className:"GlueMsgGetVocabReq",fields:[]},gvoc_res:{name:"gvoc_res",structName:"glue_msg_get_vocab_res",className:"GlueMsgGetVocabRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_raw",name:"vocab",isNullable:!1}]},lkup_req:{name:"lkup_req",structName:"glue_msg_lookup_token_req",className:"GlueMsgLookupTokenReq",fields:[{type:"str",name:"piece",isNullable:!1}]},lkup_res:{name:"lkup_res",structName:"glue_msg_lookup_token_res",className:"GlueMsgLookupTokenRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"int",name:"token",isNullable:!1}]},tokn_req:{name:"tokn_req",structName:"glue_msg_tokenize_req",className:"GlueMsgTokenizeReq",fields:[{type:"str",name:"text",isNullable:!1},{type:"bool",name:"special",isNullable:!1}]},tokn_res:{name:"tokn_res",structName:"glue_msg_tokenize_res",className:"GlueMsgTokenizeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},dtkn_req:{name:"dtkn_req",structName:"glue_msg_detokenize_req",className:"GlueMsgDetokenizeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},dtkn_res:{name:"dtkn_res",structName:"glue_msg_detokenize_res",className:"GlueMsgDetokenizeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"raw",name:"buffer",isNullable:!1}]},deco_req:{name:"deco_req",structName:"glue_msg_decode_req",className:"GlueMsgDecodeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1},{type:"bool",name:"skip_logits",isNullable:!1}]},deco_res:{name:"deco_res",structName:"glue_msg_decode_res",className:"GlueMsgDecodeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"n_past",isNullable:!1}]},enco_req:{name:"enco_req",structName:"glue_msg_encode_req",className:"GlueMsgEncodeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},enco_res:{name:"enco_res",structName:"glue_msg_encode_res",className:"GlueMsgEncodeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"n_past",isNullable:!1}]},ssam_req:{name:"ssam_req",structName:"glue_msg_sampling_sample_req",className:"GlueMsgSamplingSampleReq",fields:[]},ssam_res:{name:"ssam_res",structName:"glue_msg_sampling_sample_res",className:"GlueMsgSamplingSampleRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"raw",name:"piece",isNullable:!1},{type:"int",name:"token",isNullable:!1}]},sacc_req:{name:"sacc_req",structName:"glue_msg_sampling_accept_req",className:"GlueMsgSamplingAcceptReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},sacc_res:{name:"sacc_res",structName:"glue_msg_sampling_accept_res",className:"GlueMsgSamplingAcceptRes",fields:[{type:"bool",name:"success",isNullable:!1}]},glog_req:{name:"glog_req",structName:"glue_msg_get_logits_req",className:"GlueMsgGetLogitsReq",fields:[{type:"int",name:"top_k",isNullable:!1}]},glog_res:{name:"glog_res",structName:"glue_msg_get_logits_res",className:"GlueMsgGetLogitsRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1},{type:"arr_float",name:"probs",isNullable:!1}]},gemb_req:{name:"gemb_req",structName:"glue_msg_get_embeddings_req",className:"GlueMsgGetEmbeddingsReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},gemb_res:{name:"gemb_res",structName:"glue_msg_get_embeddings_res",className:"GlueMsgGetEmbeddingsRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"arr_float",name:"embeddings",isNullable:!1}]},kvcr_req:{name:"kvcr_req",structName:"glue_msg_get_kv_remove_req",className:"GlueMsgGetKvRemoveReq",fields:[{type:"int",name:"n_keep",isNullable:!1},{type:"int",name:"n_discard",isNullable:!1}]},kvcr_res:{name:"kvcr_res",structName:"glue_msg_get_kv_remove_res",className:"GlueMsgGetKvRemoveRes",fields:[{type:"int",name:"n_past",isNullable:!1},{type:"bool",name:"success",isNullable:!1}]},kvcc_req:{name:"kvcc_req",structName:"glue_msg_get_kv_clear_req",className:"GlueMsgGetKvClearReq",fields:[]},kvcc_res:{name:"kvcc_res",structName:"glue_msg_get_kv_clear_res",className:"GlueMsgGetKvClearRes",fields:[{type:"int",name:"n_past",isNullable:!1},{type:"bool",name:"success",isNullable:!1}]},sesa_req:{name:"sesa_req",structName:"glue_msg_session_save_req",className:"GlueMsgSessionSaveReq",fields:[{type:"str",name:"session_path",isNullable:!1}]},sesa_res:{name:"sesa_res",structName:"glue_msg_session_save_res",className:"GlueMsgSessionSaveRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},sesl_req:{name:"sesl_req",structName:"glue_msg_session_load_req",className:"GlueMsgSessionLoadReq",fields:[{type:"str",name:"session_path",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},sesl_res:{name:"sesl_res",structName:"glue_msg_session_load_res",className:"GlueMsgSessionLoadRes",fields:[{type:"bool",name:"success",isNullable:!1}]},stat_req:{name:"stat_req",structName:"glue_msg_status_req",className:"GlueMsgStatusReq",fields:[]},stat_res:{name:"stat_res",structName:"glue_msg_status_res",className:"GlueMsgStatusRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},tben_req:{name:"tben_req",structName:"glue_msg_test_benchmark_req",className:"GlueMsgTestBenchmarkReq",fields:[{type:"str",name:"type",isNullable:!1},{type:"int",name:"n_samples",isNullable:!1}]},tben_res:{name:"tben_res",structName:"glue_msg_test_benchmark_res",className:"GlueMsgTestBenchmarkRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"t_ms",isNullable:!1}]},tper_req:{name:"tper_req",structName:"glue_msg_test_perplexity_req",className:"GlueMsgTestPerplexityReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},tper_res:{name:"tper_res",structName:"glue_msg_test_perplexity_res",className:"GlueMsgTestPerplexityRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"float",name:"ppl",isNullable:!1},{type:"float",name:"nll",isNullable:!1},{type:"float",name:"cross_entropy",isNullable:!1},{type:"int",name:"n_tokens",isNullable:!1},{type:"int",name:"t_ms",isNullable:!1}]},cfmt_req:{name:"cfmt_req",structName:"glue_msg_chat_format_req",className:"GlueMsgChatFormatReq",fields:[{type:"str",name:"tmpl",isNullable:!0},{type:"bool",name:"add_ass",isNullable:!0},{type:"arr_str",name:"roles",isNullable:!1},{type:"arr_str",name:"contents",isNullable:!1}]},cfmt_res:{name:"cfmt_res",structName:"glue_msg_chat_format_res",className:"GlueMsgChatFormatRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"str",name:"formatted_chat",isNullable:!1}]}},Ua=new Uint8Array([71,76,85,69]),Sl=0,Yw=1,Xw=2,Qw=3,eb=4,tb=5,rb=6,nb=7,ab=8,ob=9,ib=10,Nh={str:eb,int:Xw,float:Qw,bool:Yw,raw:tb,arr_str:ob,arr_int:nb,arr_float:ab,arr_bool:rb,arr_raw:ib,null:Sl};function QF(t){let e=0;const r=new DataView(t.buffer),n=()=>{const y=r.getUint32(e,!0);return e+=4,y},a=()=>{const y=r.getInt32(e,!0);return e+=4,y},o=()=>{const y=r.getFloat32(e,!0);return e+=4,y},i=()=>n()!==0,s=y=>{const E=y??n(),k=new TextDecoder().decode(t.slice(e,e+E));return e+=E,k},l=()=>{const y=n(),E=t.slice(e,e+y);return e+=y,E},c=y=>{const E=n(),k=new Array(E);for(let R=0;R<E;R++)k[R]=y();return k},d=()=>null,u=y=>{switch(y.type){case"str":return s();case"int":return a();case"float":return o();case"bool":return i();case"raw":return l();case"arr_str":return c(s);case"arr_int":return c(a);case"arr_float":return c(o);case"arr_bool":return c(i);case"arr_raw":return c(l);case"null":return d()}},h=t[0]===Ua[0]&&t[1]===Ua[1]&&t[2]===Ua[2]&&t[3]===Ua[3];if(e+=4,!h)throw new Error("Invalid magic number");if(n()!==Rh)throw new Error("Invalid version number");const p=s(8),f=Fh[p];if(!f)throw new Error(`Unknown message name: ${p}`);const g={_name:p};for(const y of f.fields){const E=n();if(E===Sl){if(!y.isNullable)throw new Error(`${p}: Expect field ${y.name} to be non-nullable`);g[y.name]=null;continue}if(E!==Nh[y.type])throw new Error(`${p}: Expect field ${y.name} to have type ${y.type}`);g[y.name]=u(y)}return g}function eN(t){const e=Fh[t._name];if(!e)throw new Error(`Unknown message name: ${t._name}`);const r=[],n=p=>{const f=new ArrayBuffer(4);new DataView(f).setUint32(0,p,!0),r.push(new Uint8Array(f))},a=p=>{const f=new ArrayBuffer(4);new DataView(f).setInt32(0,p,!0),r.push(new Uint8Array(f))},o=p=>{const f=new ArrayBuffer(4);new DataView(f).setFloat32(0,p,!0),r.push(new Uint8Array(f))},i=p=>{n(p?1:0)},s=p=>{const f=new TextEncoder().encode(p);n(f.byteLength),r.push(f)},l=p=>{n(p.byteLength),r.push(p)},c=(p,f)=>{n(p.length);for(const g of p)f(g)};r.push(Ua),n(Rh);{const p=new TextEncoder().encode(t._name);r.push(p)}for(const p of e.fields){const f=t[p.name];if(!p.isNullable&&f==null)throw new Error(`${t._name}: Expect field ${p.name} to be non-nullable`);if(f==null){n(Sl);continue}switch(n(Nh[p.type]),p.type){case"str":s(f);break;case"int":a(f);break;case"float":o(f);break;case"bool":i(f);break;case"raw":l(f);break;case"arr_str":c(f,s);break;case"arr_int":c(f,a);break;case"arr_float":c(f,o);break;case"arr_bool":c(f,i);break;case"arr_raw":c(f,l);break}}const d=r.reduce((p,f)=>p+f.byteLength,0),u=new Uint8Array(d);let h=0;for(const p of r)u.set(p,h),h+=p.byteLength;return u}const tN=t=>{const e=t.reduce((n,a)=>n+a.length,0),r=new Uint8Array(e);r.set(t[0],0);for(let n=1;n<t.length;n++)r.set(t[n],t[n-1].length);return r},rN=new TextDecoder,sb=t=>rN.decode(t),lb=/-(\d{5})-of-(\d{5})\.gguf$/,cb=t=>{const e=t.match(lb);return e?{baseURL:t.replace(lb,""),current:parseInt(e[1]),total:parseInt(e[2])}:{baseURL:t,current:1,total:1}},nN=t=>{t.every(e=>!!e.name)&&t.length>1&&t.sort((e,r)=>{const n=cb(e.name),a=cb(r.name);return n.current-a.current})},db=t=>new URL(t,document.baseURI).href,Ph=t=>t.reduce((e,r)=>e+r,0),ub=t=>!!(t!=null&&t.startsWith),aN=()=>(async t=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(t)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),oN=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),iN=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),sN=async()=>{if(!await oN())throw new Error("WebAssembly runtime does not support exception handling");if(!await iN())throw new Error("WebAssembly runtime does not support SIMD")},hb=()=>!!navigator.userAgent.match(/Version\/([0-9\._]+).*Mobile.*Safari.*/),Oh=t=>{const e=URL.createObjectURL(ub(t)?new Blob([t],{type:"text/javascript"}):t);return new Worker(e,{type:"module"})},lN=`// Start the main llama.cpp
let wllamaMalloc;
let wllamaStart;
let wllamaAction;
let wllamaExit;
let wllamaDebug;

let Module = null;

//////////////////////////////////////////////////////////////
// UTILS
//////////////////////////////////////////////////////////////

// send message back to main thread
const msg = (data, transfer) => postMessage(data, transfer);

// Convert CPP log into JS log
const cppLogToJSLog = (line) => {
  const matched = line.match(/@@(DEBUG|INFO|WARN|ERROR)@@(.*)/);
  return !!matched
    ? {
        level: (matched[1] === 'INFO' ? 'debug' : matched[1]).toLowerCase(),
        text: matched[2],
      }
    : { level: 'log', text: line };
};

// Get module config that forwards stdout/err to main thread
const getWModuleConfig = (_argMainScriptBlob) => {
  var pathConfig = RUN_OPTIONS.pathConfig;
  var pthreadPoolSize = RUN_OPTIONS.nbThread;
  var argMainScriptBlob = _argMainScriptBlob;

  if (!pathConfig['wllama.wasm']) {
    throw new Error('"wllama.wasm" is missing in pathConfig');
  }
  return {
    noInitialRun: true,
    print: function (text) {
      if (arguments.length > 1)
        text = Array.prototype.slice.call(arguments).join(' ');
      msg({ verb: 'console.log', args: [text] });
    },
    printErr: function (text) {
      if (arguments.length > 1)
        text = Array.prototype.slice.call(arguments).join(' ');
      const logLine = cppLogToJSLog(text);
      msg({ verb: 'console.' + logLine.level, args: [logLine.text] });
    },
    locateFile: function (filename, basePath) {
      const p = pathConfig[filename];
      const truncate = (str) =>
        str.length > 128 ? \`\${str.substr(0, 128)}...\` : str;
      if (filename.match(/wllama\\.worker\\.js/)) {
        msg({
          verb: 'console.error',
          args: [
            '"wllama.worker.js" is removed from v2.2.1. Hint: make sure to clear browser\\'s cache.',
          ],
        });
      } else {
        msg({
          verb: 'console.debug',
          args: [\`Loading "\${filename}" from "\${truncate(p)}"\`],
        });
        return p;
      }
    },
    mainScriptUrlOrBlob: argMainScriptBlob,
    pthreadPoolSize,
    wasmMemory: pthreadPoolSize > 1 ? getWasmMemory() : null,
    onAbort: function (text) {
      msg({ verb: 'signal.abort', args: [text] });
    },
  };
};

// Get the memory to be used by wasm. (Only used in multi-thread mode)
// Because we have a weird OOM issue on iOS, we need to try some values
// See: https://github.com/emscripten-core/emscripten/issues/19144
//      https://github.com/godotengine/godot/issues/70621
const getWasmMemory = () => {
  let minBytes = 128 * 1024 * 1024;
  let maxBytes = 4096 * 1024 * 1024;
  let stepBytes = 128 * 1024 * 1024;
  while (maxBytes > minBytes) {
    try {
      const wasmMemory = new WebAssembly.Memory({
        initial: minBytes / 65536,
        maximum: maxBytes / 65536,
        shared: true,
      });
      return wasmMemory;
    } catch (e) {
      maxBytes -= stepBytes;
      continue; // retry
    }
  }
  throw new Error('Cannot allocate WebAssembly.Memory');
};

//////////////////////////////////////////////////////////////
// MEMFS PATCH
//////////////////////////////////////////////////////////////

/**
 * By default, emscripten uses memfs. The way it works is by
 * allocating new Uint8Array in javascript heap. This is not good
 * because it requires files to be copied to wasm heap each time
 * a file is read.
 *
 * HeapFS is an alternative, which resolves this problem by
 * allocating space for file directly inside wasm heap. This
 * allows us to mmap without doing any copy.
 *
 * For llama.cpp, this is great because we use MAP_SHARED
 *
 * Ref: https://github.com/ngxson/wllama/pull/39
 * Ref: https://github.com/emscripten-core/emscripten/blob/main/src/library_memfs.js
 *
 * Note 29/05/2024 @ngxson
 * Due to ftell() being limited to MAX_LONG, we cannot load files bigger than 2^31 bytes (or 2GB)
 * Ref: https://github.com/emscripten-core/emscripten/blob/main/system/lib/libc/musl/src/stdio/ftell.c
 */

const fsNameToFile = {}; // map Name => File
const fsIdToFile = {}; // map ID => File
let currFileId = 0;

// Patch and redirect memfs calls to wllama
const patchMEMFS = () => {
  const m = Module;
  // save functions
  m.MEMFS.stream_ops._read = m.MEMFS.stream_ops.read;
  m.MEMFS.stream_ops._write = m.MEMFS.stream_ops.write;
  m.MEMFS.stream_ops._llseek = m.MEMFS.stream_ops.llseek;
  m.MEMFS.stream_ops._allocate = m.MEMFS.stream_ops.allocate;
  m.MEMFS.stream_ops._mmap = m.MEMFS.stream_ops.mmap;
  m.MEMFS.stream_ops._msync = m.MEMFS.stream_ops.msync;

  const patchStream = (stream) => {
    const name = stream.node.name;
    if (fsNameToFile[name]) {
      const f = fsNameToFile[name];
      stream.node.contents = m.HEAPU8.subarray(f.ptr, f.ptr + f.size);
      stream.node.usedBytes = f.size;
    }
  };

  // replace "read" functions
  m.MEMFS.stream_ops.read = function (
    stream,
    buffer,
    offset,
    length,
    position
  ) {
    patchStream(stream);
    return m.MEMFS.stream_ops._read(stream, buffer, offset, length, position);
  };
  m.MEMFS.ops_table.file.stream.read = m.MEMFS.stream_ops.read;

  // replace "llseek" functions
  m.MEMFS.stream_ops.llseek = function (stream, offset, whence) {
    patchStream(stream);
    return m.MEMFS.stream_ops._llseek(stream, offset, whence);
  };
  m.MEMFS.ops_table.file.stream.llseek = m.MEMFS.stream_ops.llseek;

  // replace "mmap" functions
  m.MEMFS.stream_ops.mmap = function (stream, length, position, prot, flags) {
    patchStream(stream);
    const name = stream.node.name;
    if (fsNameToFile[name]) {
      const f = fsNameToFile[name];
      return {
        ptr: f.ptr + position,
        allocated: false,
      };
    } else {
      return m.MEMFS.stream_ops._mmap(stream, length, position, prot, flags);
    }
  };
  m.MEMFS.ops_table.file.stream.mmap = m.MEMFS.stream_ops.mmap;

  // mount FS
  m.FS.mkdir('/models');
  m.FS.mount(m.MEMFS, { root: '.' }, '/models');
};

// Allocate a new file in wllama heapfs, returns file ID
const heapfsAlloc = (name, size) => {
  if (size < 1) {
    throw new Error('File size must be bigger than 0');
  }
  const m = Module;
  const ptr = m.mmapAlloc(size);
  const file = {
    ptr: ptr,
    size: size,
    id: currFileId++,
  };
  fsIdToFile[file.id] = file;
  fsNameToFile[name] = file;
  return file.id;
};

// Add new file to wllama heapfs, return number of written bytes
const heapfsWrite = (id, buffer, offset) => {
  const m = Module;
  if (fsIdToFile[id]) {
    const { ptr, size } = fsIdToFile[id];
    const afterWriteByte = offset + buffer.byteLength;
    if (afterWriteByte > size) {
      throw new Error(
        \`File ID \${id} write out of bound, afterWriteByte = \${afterWriteByte} while size = \${size}\`
      );
    }
    m.HEAPU8.set(buffer, ptr + offset);
    return buffer.byteLength;
  } else {
    throw new Error(\`File ID \${id} not found in heapfs\`);
  }
};

//////////////////////////////////////////////////////////////
// MAIN CODE
//////////////////////////////////////////////////////////////

const callWrapper = (name, ret, args) => {
  const fn = Module.cwrap(name, ret, args);
  return async (action, req) => {
    let result;
    try {
      if (args.length === 2) {
        result = await fn(action, req);
      } else {
        result = fn();
      }
    } catch (ex) {
      console.error(ex);
      throw ex;
    }
    return result;
  };
};

onmessage = async (e) => {
  if (!e.data) return;
  const { verb, args, callbackId } = e.data;

  if (!callbackId) {
    msg({ verb: 'console.error', args: ['callbackId is required', e.data] });
    return;
  }

  if (verb === 'module.init') {
    const argMainScriptBlob = args[0];
    try {
      Module = getWModuleConfig(argMainScriptBlob);
      Module.onRuntimeInitialized = () => {
        // async call once module is ready
        // init FS
        patchMEMFS();
        // init cwrap
        const pointer = 'number';
        // TODO: note sure why emscripten cannot bind if there is only 1 argument
        wllamaMalloc = callWrapper('wllama_malloc', pointer, [
          'number',
          pointer,
        ]);
        wllamaStart = callWrapper('wllama_start', 'string', []);
        wllamaAction = callWrapper('wllama_action', pointer, [
          'string',
          pointer,
        ]);
        wllamaExit = callWrapper('wllama_exit', 'string', []);
        wllamaDebug = callWrapper('wllama_debug', 'string', []);
        msg({ callbackId, result: null });
      };
      wModuleInit();
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'fs.alloc') {
    const argFilename = args[0];
    const argSize = args[1];
    try {
      // create blank file
      const emptyBuffer = new ArrayBuffer(0);
      Module['FS_createDataFile'](
        '/models',
        argFilename,
        emptyBuffer,
        true,
        true,
        true
      );
      // alloc data on heap
      const fileId = heapfsAlloc(argFilename, argSize);
      msg({ callbackId, result: { fileId } });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'fs.write') {
    const argFileId = args[0];
    const argBuffer = args[1];
    const argOffset = args[2];
    try {
      const writtenBytes = heapfsWrite(argFileId, argBuffer, argOffset);
      msg({ callbackId, result: { writtenBytes } });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.start') {
    try {
      const result = await wllamaStart();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.action') {
    const argAction = args[0];
    const argEncodedMsg = args[1];
    try {
      const inputPtr = await wllamaMalloc(argEncodedMsg.byteLength, 0);
      // copy data to wasm heap
      const inputBuffer = new Uint8Array(
        Module.HEAPU8.buffer,
        inputPtr,
        argEncodedMsg.byteLength
      );
      inputBuffer.set(argEncodedMsg, 0);
      const outputPtr = await wllamaAction(argAction, inputPtr);
      // length of output buffer is written at the first 4 bytes of input buffer
      const outputLen = new Uint32Array(Module.HEAPU8.buffer, inputPtr, 1)[0];
      // copy the output buffer to JS heap
      const outputBuffer = new Uint8Array(outputLen);
      const outputSrcView = new Uint8Array(
        Module.HEAPU8.buffer,
        outputPtr,
        outputLen
      );
      outputBuffer.set(outputSrcView, 0); // copy it
      msg({ callbackId, result: outputBuffer }, [outputBuffer.buffer]);
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.exit') {
    try {
      const result = await wllamaExit();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.debug') {
    try {
      const result = await wllamaDebug();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }
};
`,pb=`let accessHandle;
let abortController = new AbortController();

async function openFile(filename) {
  const opfsRoot = await navigator.storage.getDirectory();
  const cacheDir = await opfsRoot.getDirectoryHandle('cache', { create: true });
  const fileHandler = await cacheDir.getFileHandle(filename, { create: true });
  accessHandle = await fileHandler.createSyncAccessHandle();
  accessHandle.truncate(0); // clear file content
}

async function writeFile(buf) {
  accessHandle.write(buf);
}

async function closeFile() {
  accessHandle.flush();
  accessHandle.close();
}

async function writeTextFile(filename, str) {
  await openFile(filename);
  await writeFile(new TextEncoder().encode(str));
  await closeFile();
}

const throttled = (func, delay) => {
  let lastRun = 0;
  return (...args) => {
    const now = Date.now();
    if (now - lastRun > delay) {
      lastRun = now;
      func.apply(null, args);
    }
  };
};

const assertNonNull = (val) => {
  if (val === null || val === undefined) {
    throw new Error('OPFS Worker: Assertion failed');
  }
};

// respond to main thread
const resOK = () => postMessage({ ok: true });
const resProgress = (loaded, total) =>
  postMessage({ progress: { loaded, total } });
const resErr = (err) => postMessage({ err });

onmessage = async (e) => {
  try {
    if (!e.data) return;

    /**
     * @param {Object} e.data
     *
     * Fine-control FS actions:
     * - { action: 'open', filename: 'string' }
     * - { action: 'write', buf: ArrayBuffer }
     * - { action: 'close' }
     *
     * Simple write API:
     * - { action: 'write-simple', filename: 'string', buf: ArrayBuffer }
     *
     * Download API:
     * - { action: 'download', url: 'string', filename: 'string', options: Object, metadataFileName: 'string' }
     * - { action: 'download-abort' }
     */
    const { action, filename, buf, url, options, metadataFileName } = e.data;

    if (action === 'open') {
      assertNonNull(filename);
      await openFile(filename);
      return resOK();
    } else if (action === 'write') {
      assertNonNull(buf);
      await writeFile(buf);
      return resOK();
    } else if (action === 'close') {
      await closeFile();
      return resOK();
    } else if (action === 'write-simple') {
      assertNonNull(filename);
      assertNonNull(buf);
      await openFile(filename);
      await writeFile(buf);
      await closeFile();
      return resOK();
    } else if (action === 'download') {
      assertNonNull(url);
      assertNonNull(filename);
      assertNonNull(metadataFileName);
      assertNonNull(options);
      assertNonNull(options.aborted);
      abortController = new AbortController();
      if (options.aborted) abortController.abort();
      const response = await fetch(url, {
        ...options,
        signal: abortController.signal,
      });
      const contentLength = response.headers.get('content-length');
      const etag = (response.headers.get('etag') || '').replace(
        /[^A-Za-z0-9]/g,
        ''
      );
      const total = parseInt(contentLength, 10);
      const reader = response.body.getReader();
      await openFile(filename);
      let loaded = 0;
      const throttledProgress = throttled(resProgress, 100);
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        loaded += value.byteLength;
        await writeFile(value);
        throttledProgress(loaded, total);
      }
      resProgress(total, total); // 100% done
      await closeFile();
      // make sure this is in-sync with CacheEntryMetadata
      await writeTextFile(
        metadataFileName,
        JSON.stringify({
          originalURL: url,
          originalSize: total,
          etag,
        })
      );
      return resOK();
    } else if (action === 'download-abort') {
      if (abortController) {
        abortController.abort();
      }
      return;
    }

    throw new Error('OPFS Worker: Invalid action', e.data);
  } catch (err) {
    return resErr(err);
  }
};
`,cN='var Module=typeof Module!="undefined"?Module:{};var ENVIRONMENT_IS_WEB=typeof window=="object";var ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope!="undefined";var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var ENVIRONMENT_IS_PTHREAD=ENVIRONMENT_IS_WORKER&&self.name?.startsWith("em-pthread");if(ENVIRONMENT_IS_NODE){var worker_threads=require("worker_threads");global.Worker=worker_threads.Worker;ENVIRONMENT_IS_WORKER=!worker_threads.isMainThread;ENVIRONMENT_IS_PTHREAD=ENVIRONMENT_IS_WORKER&&worker_threads["workerData"]=="em-pthread"}var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var _scriptName=typeof document!="undefined"?document.currentScript?.src:undefined;if(ENVIRONMENT_IS_NODE){_scriptName=__filename}else if(ENVIRONMENT_IS_WORKER){_scriptName=self.location.href}var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs");var nodePath=require("path");scriptDirectory=__dirname+"/";readBinary=filename=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename);return ret};readAsync=async(filename,binary=true)=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename,binary?undefined:"utf8");return ret};if(!Module["thisProgram"]&&process.argv.length>1){thisProgram=process.argv[1].replace(/\\\\/g,"/")}arguments_=process.argv.slice(2);if(typeof module!="undefined"){module["exports"]=Module}quit_=(status,toThrow)=>{process.exitCode=status;throw toThrow}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}if(!ENVIRONMENT_IS_NODE){if(ENVIRONMENT_IS_WORKER){readBinary=url=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=async url=>{if(isFileURI(url)){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=()=>{if(xhr.status==200||xhr.status==0&&xhr.response){resolve(xhr.response);return}reject(xhr.status)};xhr.onerror=reject;xhr.send(null)})}var response=await fetch(url,{credentials:"same-origin"});if(response.ok){return response.arrayBuffer()}throw new Error(response.status+" : "+response.url)}}}else{}var defaultPrint=console.log.bind(console);var defaultPrintErr=console.error.bind(console);if(ENVIRONMENT_IS_NODE){defaultPrint=(...args)=>fs.writeSync(1,args.join(" ")+"\\n");defaultPrintErr=(...args)=>fs.writeSync(2,args.join(" ")+"\\n")}var out=Module["print"]||defaultPrint;var err=Module["printErr"]||defaultPrintErr;Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var wasmModule;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;var runtimeInitialized=false;var isFileURI=filename=>filename.startsWith("file://");function GROWABLE_HEAP_I8(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP8}function GROWABLE_HEAP_U8(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPU8}function GROWABLE_HEAP_I16(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP16}function GROWABLE_HEAP_I32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP32}function GROWABLE_HEAP_U32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPU32}function GROWABLE_HEAP_F32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPF32}function GROWABLE_HEAP_F64(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPF64}if(ENVIRONMENT_IS_PTHREAD){var wasmModuleReceived;if(ENVIRONMENT_IS_NODE){var parentPort=worker_threads["parentPort"];parentPort.on("message",msg=>onmessage({data:msg}));Object.assign(globalThis,{self:global,postMessage:msg=>parentPort.postMessage(msg)})}var initializedJS=false;function threadPrintErr(...args){var text=args.join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\\n");return}console.error(text)}if(!Module["printErr"])err=threadPrintErr;function threadAlert(...args){var text=args.join(" ");postMessage({cmd:"alert",text,threadId:_pthread_self()})}self.alert=threadAlert;self.onunhandledrejection=e=>{throw e.reason||e};function handleMessage(e){try{var msgData=e["data"];var cmd=msgData.cmd;if(cmd==="load"){let messageQueue=[];self.onmessage=e=>messageQueue.push(e);self.startWorker=instance=>{postMessage({cmd:"loaded"});for(let msg of messageQueue){handleMessage(msg)}self.onmessage=handleMessage};for(const handler of msgData.handlers){if(!Module[handler]||Module[handler].proxy){Module[handler]=(...args)=>{postMessage({cmd:"callHandler",handler,args})};if(handler=="print")out=Module[handler];if(handler=="printErr")err=Module[handler]}}wasmMemory=msgData.wasmMemory;updateMemoryViews();wasmModuleReceived(msgData.wasmModule)}else if(cmd==="run"){establishStackSpace(msgData.pthread_ptr);__emscripten_thread_init(msgData.pthread_ptr,0,0,1,0,0);PThread.receiveObjectTransfer(msgData);PThread.threadInitTLS();__emscripten_thread_mailbox_await(msgData.pthread_ptr);if(!initializedJS){initializedJS=true}try{invokeEntryPoint(msgData.start_routine,msgData.arg)}catch(ex){if(ex!="unwind"){throw ex}}}else if(msgData.target==="setimmediate"){}else if(cmd==="checkMailbox"){if(initializedJS){checkMailbox()}}else if(cmd){err(`worker: received unknown command ${cmd}`);err(msgData)}}catch(ex){__emscripten_thread_crashed();throw ex}}self.onmessage=handleMessage}function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}if(!ENVIRONMENT_IS_PTHREAD){if(Module["wasmMemory"]){wasmMemory=Module["wasmMemory"]}else{var INITIAL_MEMORY=Module["INITIAL_MEMORY"]||134217728;wasmMemory=new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:65536,shared:true})}updateMemoryViews()}function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=true;if(ENVIRONMENT_IS_PTHREAD)return startWorker(Module);if(!Module["noFSInit"]&&!FS.initialized)FS.init();TTY.init();wasmExports["G"]();FS.ignorePermissions=false}function preMain(){}function postRun(){if(ENVIRONMENT_IS_PTHREAD)return;if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(onPostRuns)}var runDependencies=0;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";if(runtimeInitialized){___trap()}var e=new WebAssembly.RuntimeError(what);throw e}var wasmBinaryFile;function findWasmBinary(){return locateFile("wllama.wasm")}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(binaryFile){if(!wasmBinary){try{var response=await readAsync(binaryFile);return new Uint8Array(response)}catch{}}return getBinarySync(binaryFile)}async function instantiateArrayBuffer(binaryFile,imports){try{var binary=await getWasmBinary(binaryFile);var instance=await WebAssembly.instantiate(binary,imports);return instance}catch(reason){err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)}}async function instantiateAsync(binary,binaryFile,imports){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI(binaryFile)&&!ENVIRONMENT_IS_NODE){try{var response=fetch(binaryFile,{credentials:"same-origin"});var instantiationResult=await WebAssembly.instantiateStreaming(response,imports);return instantiationResult}catch(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation")}}return instantiateArrayBuffer(binaryFile,imports)}function getWasmImports(){assignWasmImports();return{a:wasmImports}}async function createWasm(){function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=applySignatureConversions(wasmExports);registerTLSInit(wasmExports["N"]);wasmTable=wasmExports["Q"];wasmModule=module;removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){return receiveInstance(result["instance"],result["module"])}var info=getWasmImports();if(Module["instantiateWasm"]){return new Promise((resolve,reject)=>{Module["instantiateWasm"](info,(mod,inst)=>{receiveInstance(mod,inst);resolve(mod.exports)})})}if(ENVIRONMENT_IS_PTHREAD){return new Promise(resolve=>{wasmModuleReceived=module=>{var instance=new WebAssembly.Instance(module,getWasmImports());resolve(receiveInstance(instance,module))}})}wasmBinaryFile??=findWasmBinary();var result=await instantiateAsync(wasmBinary,wasmBinaryFile,info);var exports=receiveInstantiationResult(result);return exports}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}Module["ExitStatus"]=ExitStatus;var terminateWorker=worker=>{worker.terminate();worker.onmessage=e=>{}};Module["terminateWorker"]=terminateWorker;var cleanupThread=pthread_ptr=>{var worker=PThread.pthreads[pthread_ptr];PThread.returnWorkerToPool(worker)};Module["cleanupThread"]=cleanupThread;var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};Module["callRuntimeCallbacks"]=callRuntimeCallbacks;var onPreRuns=[];Module["onPreRuns"]=onPreRuns;var addOnPreRun=cb=>onPreRuns.unshift(cb);Module["addOnPreRun"]=addOnPreRun;var spawnThread=threadParams=>{var worker=PThread.getNewWorker();if(!worker){return 6}PThread.runningWorkers.push(worker);PThread.pthreads[threadParams.pthread_ptr]=worker;worker.pthread_ptr=threadParams.pthread_ptr;var msg={cmd:"run",start_routine:threadParams.startRoutine,arg:threadParams.arg,pthread_ptr:threadParams.pthread_ptr};if(ENVIRONMENT_IS_NODE){worker.unref()}worker.postMessage(msg,threadParams.transferList);return 0};Module["spawnThread"]=spawnThread;var runtimeKeepaliveCounter=0;Module["runtimeKeepaliveCounter"]=runtimeKeepaliveCounter;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;Module["keepRuntimeAlive"]=keepRuntimeAlive;var stackSave=()=>_emscripten_stack_get_current();Module["stackSave"]=stackSave;var stackRestore=val=>__emscripten_stack_restore(val);Module["stackRestore"]=stackRestore;var stackAlloc=sz=>__emscripten_stack_alloc(sz);Module["stackAlloc"]=stackAlloc;var INT53_MAX=9007199254740992;Module["INT53_MAX"]=INT53_MAX;var INT53_MIN=-9007199254740992;Module["INT53_MIN"]=INT53_MIN;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);Module["bigintToI53Checked"]=bigintToI53Checked;var proxyToMainThread=(funcIndex,emAsmAddr,sync,...callArgs)=>{var serializedNumCallArgs=callArgs.length*2;var sp=stackSave();var args=stackAlloc(serializedNumCallArgs*8);var b=args>>>3;for(var i=0;i<callArgs.length;i++){var arg=callArgs[i];if(typeof arg=="bigint"){HEAP64[b+2*i]=1n;HEAP64[b+2*i+1]=arg}else{HEAP64[b+2*i]=0n;GROWABLE_HEAP_F64()[b+2*i+1>>>0]=arg}}var rtn=__emscripten_run_on_main_thread_js(funcIndex,emAsmAddr,serializedNumCallArgs,args,sync);stackRestore(sp);return rtn};Module["proxyToMainThread"]=proxyToMainThread;function _proc_exit(code){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(0,0,1,code);EXITSTATUS=code;if(!keepRuntimeAlive()){PThread.terminateAllThreads();Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))}Module["_proc_exit"]=_proc_exit;var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};Module["handleException"]=handleException;function exitOnMainThread(returnCode){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(1,0,0,returnCode);_exit(returnCode)}Module["exitOnMainThread"]=exitOnMainThread;var exitJS=(status,implicit)=>{EXITSTATUS=status;if(ENVIRONMENT_IS_PTHREAD){exitOnMainThread(status);throw"unwind"}_proc_exit(status)};Module["exitJS"]=exitJS;var _exit=exitJS;Module["_exit"]=_exit;var PThread={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init(){if(!ENVIRONMENT_IS_PTHREAD){PThread.initMainThread()}},initMainThread(){var pthreadPoolSize=Module["pthreadPoolSize"];while(pthreadPoolSize--){PThread.allocateUnusedWorker()}addOnPreRun(()=>{addRunDependency("loading-workers");PThread.loadWasmModuleToAllWorkers(()=>removeRunDependency("loading-workers"))})},terminateAllThreads:()=>{for(var worker of PThread.runningWorkers){terminateWorker(worker)}for(var worker of PThread.unusedWorkers){terminateWorker(worker)}PThread.unusedWorkers=[];PThread.runningWorkers=[];PThread.pthreads={}},returnWorkerToPool:worker=>{var pthread_ptr=worker.pthread_ptr;delete PThread.pthreads[pthread_ptr];PThread.unusedWorkers.push(worker);PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(worker),1);worker.pthread_ptr=0;__emscripten_thread_free_data(pthread_ptr)},receiveObjectTransfer(data){},threadInitTLS(){PThread.tlsInitFunctions.forEach(f=>f())},loadWasmModuleToWorker:worker=>new Promise(onFinishedLoading=>{worker.onmessage=e=>{var d=e["data"];var cmd=d.cmd;if(d.targetThread&&d.targetThread!=_pthread_self()){var targetWorker=PThread.pthreads[d.targetThread];if(targetWorker){targetWorker.postMessage(d,d.transferList)}else{err(`Internal error! Worker sent a message "${cmd}" to target pthread ${d.targetThread}, but that thread no longer exists!`)}return}if(cmd==="checkMailbox"){checkMailbox()}else if(cmd==="spawnThread"){spawnThread(d)}else if(cmd==="cleanupThread"){cleanupThread(d.thread)}else if(cmd==="loaded"){worker.loaded=true;if(ENVIRONMENT_IS_NODE&&!worker.pthread_ptr){worker.unref()}onFinishedLoading(worker)}else if(cmd==="alert"){alert(`Thread ${d.threadId}: ${d.text}`)}else if(d.target==="setimmediate"){worker.postMessage(d)}else if(cmd==="callHandler"){Module[d.handler](...d.args)}else if(cmd){err(`worker sent an unknown command ${cmd}`)}};worker.onerror=e=>{var message="worker sent an error!";err(`${message} ${e.filename}:${e.lineno}: ${e.message}`);throw e};if(ENVIRONMENT_IS_NODE){worker.on("message",data=>worker.onmessage({data}));worker.on("error",e=>worker.onerror(e))}var handlers=[];var knownHandlers=["onExit","onAbort","print","printErr"];for(var handler of knownHandlers){if(Module.propertyIsEnumerable(handler)){handlers.push(handler)}}worker.postMessage({cmd:"load",handlers,wasmMemory,wasmModule})}),loadWasmModuleToAllWorkers(onMaybeReady){if(ENVIRONMENT_IS_PTHREAD){return onMaybeReady()}let pthreadPoolReady=Promise.all(PThread.unusedWorkers.map(PThread.loadWasmModuleToWorker));pthreadPoolReady.then(onMaybeReady)},allocateUnusedWorker(){var worker;var workerOptions={workerData:"em-pthread",name:"em-pthread"};var pthreadMainJs=_scriptName;if(Module["mainScriptUrlOrBlob"]){pthreadMainJs=Module["mainScriptUrlOrBlob"];if(typeof pthreadMainJs!="string"){pthreadMainJs=URL.createObjectURL(pthreadMainJs)}}worker=new Worker(pthreadMainJs,workerOptions);PThread.unusedWorkers.push(worker)},getNewWorker(){if(PThread.unusedWorkers.length==0){PThread.allocateUnusedWorker();PThread.loadWasmModuleToWorker(PThread.unusedWorkers[0])}return PThread.unusedWorkers.pop()}};Module["PThread"]=PThread;var onPostRuns=[];Module["onPostRuns"]=onPostRuns;var addOnPostRun=cb=>onPostRuns.unshift(cb);Module["addOnPostRun"]=addOnPostRun;var establishStackSpace=pthread_ptr=>{updateMemoryViews();var stackHigh=GROWABLE_HEAP_U32()[pthread_ptr+52>>>2>>>0];var stackSize=GROWABLE_HEAP_U32()[pthread_ptr+56>>>2>>>0];var stackLow=stackHigh-stackSize;_emscripten_stack_set_limits(stackHigh,stackLow);stackRestore(stackHigh)};Module["establishStackSpace"]=establishStackSpace;function getValue(ptr,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":return GROWABLE_HEAP_I8()[ptr>>>0];case"i8":return GROWABLE_HEAP_I8()[ptr>>>0];case"i16":return GROWABLE_HEAP_I16()[ptr>>>1>>>0];case"i32":return GROWABLE_HEAP_I32()[ptr>>>2>>>0];case"i64":return HEAP64[ptr>>>3];case"float":return GROWABLE_HEAP_F32()[ptr>>>2>>>0];case"double":return GROWABLE_HEAP_F64()[ptr>>>3>>>0];case"*":return GROWABLE_HEAP_U32()[ptr>>>2>>>0];default:abort(`invalid type for getValue: ${type}`)}}Module["getValue"]=getValue;var wasmTableMirror=[];Module["wasmTableMirror"]=wasmTableMirror;var wasmTable;Module["wasmTable"]=wasmTable;var getWasmTableEntry=funcPtr=>{var func=wasmTableMirror[funcPtr];if(!func){if(funcPtr>=wasmTableMirror.length)wasmTableMirror.length=funcPtr+1;wasmTableMirror[funcPtr]=func=wasmTable.get(funcPtr)}return func};Module["getWasmTableEntry"]=getWasmTableEntry;var invokeEntryPoint=(ptr,arg)=>{runtimeKeepaliveCounter=0;noExitRuntime=0;var result=getWasmTableEntry(ptr)(arg);function finish(result){if(keepRuntimeAlive()){EXITSTATUS=result}else{__emscripten_thread_exit(result)}}finish(result)};Module["invokeEntryPoint"]=invokeEntryPoint;var noExitRuntime=Module["noExitRuntime"]||true;Module["noExitRuntime"]=noExitRuntime;var registerTLSInit=tlsInitFunc=>PThread.tlsInitFunctions.push(tlsInitFunc);Module["registerTLSInit"]=registerTLSInit;function setValue(ptr,value,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":GROWABLE_HEAP_I8()[ptr>>>0]=value;break;case"i8":GROWABLE_HEAP_I8()[ptr>>>0]=value;break;case"i16":GROWABLE_HEAP_I16()[ptr>>>1>>>0]=value;break;case"i32":GROWABLE_HEAP_I32()[ptr>>>2>>>0]=value;break;case"i64":HEAP64[ptr>>>3]=BigInt(value);break;case"float":GROWABLE_HEAP_F32()[ptr>>>2>>>0]=value;break;case"double":GROWABLE_HEAP_F64()[ptr>>>3>>>0]=value;break;case"*":GROWABLE_HEAP_U32()[ptr>>>2>>>0]=value;break;default:abort(`invalid type for setValue: ${type}`)}}Module["setValue"]=setValue;function pthreadCreateProxied(pthread_ptr,attr,startRoutine,arg){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(2,0,1,pthread_ptr,attr,startRoutine,arg);return ___pthread_create_js(pthread_ptr,attr,startRoutine,arg)}Module["pthreadCreateProxied"]=pthreadCreateProxied;var _emscripten_has_threading_support=()=>typeof SharedArrayBuffer!="undefined";Module["_emscripten_has_threading_support"]=_emscripten_has_threading_support;function ___pthread_create_js(pthread_ptr,attr,startRoutine,arg){pthread_ptr>>>=0;attr>>>=0;startRoutine>>>=0;arg>>>=0;if(!_emscripten_has_threading_support()){return 6}var transferList=[];var error=0;if(ENVIRONMENT_IS_PTHREAD&&(transferList.length===0||error)){return pthreadCreateProxied(pthread_ptr,attr,startRoutine,arg)}if(error)return error;var threadParams={startRoutine,pthread_ptr,arg,transferList};if(ENVIRONMENT_IS_PTHREAD){threadParams.cmd="spawnThread";postMessage(threadParams,transferList);return 0}return spawnThread(threadParams)}Module["___pthread_create_js"]=___pthread_create_js;var syscallGetVarargI=()=>{var ret=GROWABLE_HEAP_I32()[+SYSCALLS.varargs>>>2>>>0];SYSCALLS.varargs+=4;return ret};Module["syscallGetVarargI"]=syscallGetVarargI;var syscallGetVarargP=syscallGetVarargI;Module["syscallGetVarargP"]=syscallGetVarargP;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.slice(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.slice(0,-1)}return root+dir},basename:path=>path&&path.match(/([^\\/]+|\\/)\\/*$/)[1],join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};Module["PATH"]=PATH;var initRandomFill=()=>{if(ENVIRONMENT_IS_NODE){var nodeCrypto=require("crypto");return view=>nodeCrypto.randomFillSync(view)}return view=>view.set(crypto.getRandomValues(new Uint8Array(view.byteLength)))};Module["initRandomFill"]=initRandomFill;var randomFill=view=>{(randomFill=initRandomFill())(view)};Module["randomFill"]=randomFill;var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).slice(1);to=PATH_FS.resolve(to).slice(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};Module["PATH_FS"]=PATH_FS;var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;Module["UTF8Decoder"]=UTF8Decoder;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{idx>>>=0;var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.buffer instanceof ArrayBuffer?heapOrArray.subarray(idx,endPtr):heapOrArray.slice(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};Module["UTF8ArrayToString"]=UTF8ArrayToString;var FS_stdin_getChar_buffer=[];Module["FS_stdin_getChar_buffer"]=FS_stdin_getChar_buffer;var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};Module["lengthBytesUTF8"]=lengthBytesUTF8;var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{outIdx>>>=0;if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++>>>0]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++>>>0]=192|u>>6;heap[outIdx++>>>0]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++>>>0]=224|u>>12;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++>>>0]=240|u>>18;heap[outIdx++>>>0]=128|u>>12&63;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}}heap[outIdx>>>0]=0;return outIdx-startIdx};Module["stringToUTF8Array"]=stringToUTF8Array;var intArrayFromString=(stringy,dontAddNull,length)=>{var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array};Module["intArrayFromString"]=intArrayFromString;var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(ENVIRONMENT_IS_NODE){var BUFSIZE=256;var buf=Buffer.alloc(BUFSIZE);var bytesRead=0;var fd=process.stdin.fd;try{bytesRead=fs.readSync(fd,buf,0,BUFSIZE)}catch(e){if(e.toString().includes("EOF"))bytesRead=0;else throw e}if(bytesRead>0){result=buf.slice(0,bytesRead).toString("utf-8")}}else if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};Module["FS_stdin_getChar"]=FS_stdin_getChar;var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};Module["TTY"]=TTY;var zeroMemory=(address,size)=>{GROWABLE_HEAP_U8().fill(0,address,address+size)};Module["zeroMemory"]=zeroMemory;var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;Module["alignMemory"]=alignMemory;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};Module["mmapAlloc"]=mmapAlloc;var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16895,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.atime=node.mtime=node.ctime=Date.now();if(parent){parent.contents[name]=node;parent.atime=parent.mtime=parent.ctime=node.atime}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.atime);attr.mtime=new Date(node.mtime);attr.ctime=new Date(node.ctime);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){for(const key of["mode","atime","mtime","ctime"]){if(attr[key]!=null){node[key]=attr[key]}}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw MEMFS.doesNotExistError},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){if(FS.isDir(old_node.mode)){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}FS.hashRemoveNode(new_node)}delete old_node.parent.contents[old_node.name];new_dir.contents[new_name]=old_node;old_node.name=new_name;new_dir.ctime=new_dir.mtime=old_node.parent.ctime=old_node.parent.mtime=Date.now()},unlink(parent,name){delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},readdir(node){return[".","..",...Object.keys(node.contents)]},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===GROWABLE_HEAP_I8().buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.mtime=node.ctime=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===GROWABLE_HEAP_I8().buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}GROWABLE_HEAP_I8().set(contents,ptr>>>0)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};Module["MEMFS"]=MEMFS;var asyncLoad=async url=>{var arrayBuffer=await readAsync(url);return new Uint8Array(arrayBuffer)};Module["asyncLoad"]=asyncLoad;var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};Module["FS_createDataFile"]=FS_createDataFile;var preloadPlugins=Module["preloadPlugins"]||[];Module["preloadPlugins"]=preloadPlugins;var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};Module["FS_handledByPreloadPlugin"]=FS_handledByPreloadPlugin;var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url).then(processData,onerror)}else{processData(url)}};Module["FS_createPreloadedFile"]=FS_createPreloadedFile;var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};Module["FS_modeStringToFlags"]=FS_modeStringToFlags;var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};Module["FS_getMode"]=FS_getMode;var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev;this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!path){throw new FS.ErrnoError(44)}opts.follow_mount??=true;if(!PATH.isAbs(path)){path=FS.cwd()+"/"+path}linkloop:for(var nlinks=0;nlinks<40;nlinks++){var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}if(parts[i]==="."){continue}if(parts[i]===".."){current_path=PATH.dirname(current_path);current=current.parent;continue}current_path=PATH.join2(current_path,parts[i]);try{current=FS.lookupNode(current,parts[i])}catch(e){if(e?.errno===44&&islast&&opts.noent_okay){return{path:current_path}}throw e}if(FS.isMountpoint(current)&&(!islast||opts.follow_mount)){current=current.mounted.root}if(FS.isLink(current.mode)&&(!islast||opts.follow)){if(!current.node_ops.readlink){throw new FS.ErrnoError(52)}var link=current.node_ops.readlink(current);if(!PATH.isAbs(link)){link=PATH.dirname(current_path)+"/"+link}path=link+"/"+parts.slice(i+1).join("/");continue linkloop}}return{path:current_path,node:current}}throw new FS.ErrnoError(32)},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){if(!FS.isDir(dir.mode)){return 54}try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&(512|64)){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},checkOpExists(op,err){if(!op){throw new FS.ErrnoError(err)}return op},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},doSetAttr(stream,node,attr){var setattr=stream?.stream_ops.setattr;var arg=setattr?stream:node;setattr??=node.node_ops.setattr;FS.checkOpExists(setattr,63);setattr(arg,attr)},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name){throw new FS.ErrnoError(28)}if(name==="."||name===".."){throw new FS.ErrnoError(20)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){return FS.statfsNode(FS.lookupPath(path,{follow:true}).node)},statfsStream(stream){return FS.statfsNode(stream.node)},statfsNode(node){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255};if(node.node_ops.statfs){Object.assign(rtn,node.node_ops.statfs(node.mount.opts.root))}return rtn},create(path,mode=438){mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode=511){mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var readdir=FS.checkOpExists(node.node_ops.readdir,54);return readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return link.node_ops.readlink(link)},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;var getattr=FS.checkOpExists(node.node_ops.getattr,63);return getattr(node)},fstat(fd){var stream=FS.getStreamChecked(fd);var node=stream.node;var getattr=stream.stream_ops.getattr;var arg=getattr?stream:node;getattr??=node.node_ops.getattr;FS.checkOpExists(getattr,63);return getattr(arg)},lstat(path){return FS.stat(path,true)},doChmod(stream,node,mode,dontFollow){FS.doSetAttr(stream,node,{mode:mode&4095|node.mode&~4095,ctime:Date.now(),dontFollow})},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChmod(null,node,mode,dontFollow)},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.doChmod(stream,stream.node,mode,false)},doChown(stream,node,dontFollow){FS.doSetAttr(stream,node,{timestamp:Date.now(),dontFollow})},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChown(null,node,dontFollow)},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.doChown(stream,stream.node,false)},doTruncate(stream,node,len){if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}FS.doSetAttr(stream,node,{size:len,timestamp:Date.now()})},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}FS.doTruncate(null,node,len)},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(len<0||(stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.doTruncate(stream,stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var setattr=FS.checkOpExists(node.node_ops.setattr,63);setattr(node,{atime,mtime})},open(path,flags,mode=438){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=mode&4095|32768}else{mode=0}var node;var isDirPath;if(typeof path=="object"){node=path}else{isDirPath=path.endsWith("/");var lookup=FS.lookupPath(path,{follow:!(flags&131072),noent_okay:true});node=lookup.node;path=lookup.path}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else if(isDirPath){throw new FS.ErrnoError(31)}else{node=FS.mknod(path,mode|511,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(created){FS.chmod(node,mode&511)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomFill(randomBuffer);randomLeft=randomBuffer.byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);node.stream_ops={llseek:MEMFS.stream_ops.llseek};node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path},id:fd+1};ret.parent=ret;return ret},readdir(){return Array.from(FS.streams.entries()).filter(([k,v])=>v).map(([k,v])=>k.toString())}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,GROWABLE_HEAP_I8(),ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};Module["FS"]=FS;var UTF8ToString=(ptr,maxBytesToRead)=>{ptr>>>=0;return ptr?UTF8ArrayToString(GROWABLE_HEAP_U8(),ptr,maxBytesToRead):""};Module["UTF8ToString"]=UTF8ToString;var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return dir+"/"+path},writeStat(buf,stat){GROWABLE_HEAP_I32()[buf>>>2>>>0]=stat.dev;GROWABLE_HEAP_I32()[buf+4>>>2>>>0]=stat.mode;GROWABLE_HEAP_U32()[buf+8>>>2>>>0]=stat.nlink;GROWABLE_HEAP_I32()[buf+12>>>2>>>0]=stat.uid;GROWABLE_HEAP_I32()[buf+16>>>2>>>0]=stat.gid;GROWABLE_HEAP_I32()[buf+20>>>2>>>0]=stat.rdev;HEAP64[buf+24>>>3]=BigInt(stat.size);GROWABLE_HEAP_I32()[buf+32>>>2>>>0]=4096;GROWABLE_HEAP_I32()[buf+36>>>2>>>0]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>>3]=BigInt(Math.floor(atime/1e3));GROWABLE_HEAP_U32()[buf+48>>>2>>>0]=atime%1e3*1e3*1e3;HEAP64[buf+56>>>3]=BigInt(Math.floor(mtime/1e3));GROWABLE_HEAP_U32()[buf+64>>>2>>>0]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>>3]=BigInt(Math.floor(ctime/1e3));GROWABLE_HEAP_U32()[buf+80>>>2>>>0]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>>3]=BigInt(stat.ino);return 0},writeStatFs(buf,stats){GROWABLE_HEAP_I32()[buf+4>>>2>>>0]=stats.bsize;GROWABLE_HEAP_I32()[buf+40>>>2>>>0]=stats.bsize;GROWABLE_HEAP_I32()[buf+8>>>2>>>0]=stats.blocks;GROWABLE_HEAP_I32()[buf+12>>>2>>>0]=stats.bfree;GROWABLE_HEAP_I32()[buf+16>>>2>>>0]=stats.bavail;GROWABLE_HEAP_I32()[buf+20>>>2>>>0]=stats.files;GROWABLE_HEAP_I32()[buf+24>>>2>>>0]=stats.ffree;GROWABLE_HEAP_I32()[buf+28>>>2>>>0]=stats.fsid;GROWABLE_HEAP_I32()[buf+44>>>2>>>0]=stats.flags;GROWABLE_HEAP_I32()[buf+36>>>2>>>0]=stats.namelen},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=GROWABLE_HEAP_U8().slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};Module["SYSCALLS"]=SYSCALLS;function ___syscall_fcntl64(fd,cmd,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(3,0,1,fd,cmd,varargs);varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;GROWABLE_HEAP_I16()[arg+offset>>>1>>>0]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_fcntl64"]=___syscall_fcntl64;function ___syscall_ioctl(fd,op,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(4,0,1,fd,op,varargs);varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();GROWABLE_HEAP_I32()[argp>>>2>>>0]=termios.c_iflag||0;GROWABLE_HEAP_I32()[argp+4>>>2>>>0]=termios.c_oflag||0;GROWABLE_HEAP_I32()[argp+8>>>2>>>0]=termios.c_cflag||0;GROWABLE_HEAP_I32()[argp+12>>>2>>>0]=termios.c_lflag||0;for(var i=0;i<32;i++){GROWABLE_HEAP_I8()[argp+i+17>>>0]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=GROWABLE_HEAP_I32()[argp>>>2>>>0];var c_oflag=GROWABLE_HEAP_I32()[argp+4>>>2>>>0];var c_cflag=GROWABLE_HEAP_I32()[argp+8>>>2>>>0];var c_lflag=GROWABLE_HEAP_I32()[argp+12>>>2>>>0];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(GROWABLE_HEAP_I8()[argp+i+17>>>0])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();GROWABLE_HEAP_I32()[argp>>>2>>>0]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();GROWABLE_HEAP_I16()[argp>>>1>>>0]=winsize[0];GROWABLE_HEAP_I16()[argp+2>>>1>>>0]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_ioctl"]=___syscall_ioctl;function ___syscall_openat(dirfd,path,flags,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(5,0,1,dirfd,path,flags,varargs);path>>>=0;varargs>>>=0;SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_openat"]=___syscall_openat;var __abort_js=()=>abort("");Module["__abort_js"]=__abort_js;function __emscripten_init_main_thread_js(tb){tb>>>=0;__emscripten_thread_init(tb,!ENVIRONMENT_IS_WORKER,1,!ENVIRONMENT_IS_WEB,65536,false);PThread.threadInitTLS()}Module["__emscripten_init_main_thread_js"]=__emscripten_init_main_thread_js;var maybeExit=()=>{if(!keepRuntimeAlive()){try{if(ENVIRONMENT_IS_PTHREAD)__emscripten_thread_exit(EXITSTATUS);else _exit(EXITSTATUS)}catch(e){handleException(e)}}};Module["maybeExit"]=maybeExit;var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};Module["callUserCallback"]=callUserCallback;function __emscripten_thread_mailbox_await(pthread_ptr){pthread_ptr>>>=0;if(typeof Atomics.waitAsync==="function"){var wait=Atomics.waitAsync(GROWABLE_HEAP_I32(),pthread_ptr>>>2,pthread_ptr);wait.value.then(checkMailbox);var waitingAsync=pthread_ptr+128;Atomics.store(GROWABLE_HEAP_I32(),waitingAsync>>>2,1)}}Module["__emscripten_thread_mailbox_await"]=__emscripten_thread_mailbox_await;var checkMailbox=()=>{var pthread_ptr=_pthread_self();if(pthread_ptr){__emscripten_thread_mailbox_await(pthread_ptr);callUserCallback(__emscripten_check_mailbox)}};Module["checkMailbox"]=checkMailbox;function __emscripten_notify_mailbox_postmessage(targetThread,currThreadId){targetThread>>>=0;currThreadId>>>=0;if(targetThread==currThreadId){setTimeout(checkMailbox)}else if(ENVIRONMENT_IS_PTHREAD){postMessage({targetThread,cmd:"checkMailbox"})}else{var worker=PThread.pthreads[targetThread];if(!worker){return}worker.postMessage({cmd:"checkMailbox"})}}Module["__emscripten_notify_mailbox_postmessage"]=__emscripten_notify_mailbox_postmessage;var proxiedJSCallArgs=[];Module["proxiedJSCallArgs"]=proxiedJSCallArgs;function __emscripten_receive_on_main_thread_js(funcIndex,emAsmAddr,callingThread,numCallArgs,args){emAsmAddr>>>=0;callingThread>>>=0;args>>>=0;numCallArgs/=2;proxiedJSCallArgs.length=numCallArgs;var b=args>>>3;for(var i=0;i<numCallArgs;i++){if(HEAP64[b+2*i]){proxiedJSCallArgs[i]=HEAP64[b+2*i+1]}else{proxiedJSCallArgs[i]=GROWABLE_HEAP_F64()[b+2*i+1>>>0]}}var func=proxiedFunctionTable[funcIndex];PThread.currentProxiedOperationCallerThread=callingThread;var rtn=func(...proxiedJSCallArgs);PThread.currentProxiedOperationCallerThread=0;return rtn}Module["__emscripten_receive_on_main_thread_js"]=__emscripten_receive_on_main_thread_js;var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=false;runtimeKeepaliveCounter=0};Module["__emscripten_runtime_keepalive_clear"]=__emscripten_runtime_keepalive_clear;function __emscripten_thread_cleanup(thread){thread>>>=0;if(!ENVIRONMENT_IS_PTHREAD)cleanupThread(thread);else postMessage({cmd:"cleanupThread",thread})}Module["__emscripten_thread_cleanup"]=__emscripten_thread_cleanup;function __emscripten_thread_set_strongref(thread){thread>>>=0;if(ENVIRONMENT_IS_NODE){PThread.pthreads[thread].ref()}}Module["__emscripten_thread_set_strongref"]=__emscripten_thread_set_strongref;function __mmap_js(len,prot,flags,fd,offset,allocated,addr){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(6,0,1,len,prot,flags,fd,offset,allocated,addr);len>>>=0;offset=bigintToI53Checked(offset);allocated>>>=0;addr>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);var res=FS.mmap(stream,len,offset,prot,flags);var ptr=res.ptr;GROWABLE_HEAP_I32()[allocated>>>2>>>0]=res.allocated;GROWABLE_HEAP_U32()[addr>>>2>>>0]=ptr;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__mmap_js"]=__mmap_js;function __munmap_js(addr,len,prot,flags,fd,offset){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(7,0,1,addr,len,prot,flags,fd,offset);addr>>>=0;len>>>=0;offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__munmap_js"]=__munmap_js;var timers={};Module["timers"]=timers;var _emscripten_get_now=()=>performance.timeOrigin+performance.now();Module["_emscripten_get_now"]=_emscripten_get_now;function __setitimer_js(which,timeout_ms){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(8,0,1,which,timeout_ms);if(timers[which]){clearTimeout(timers[which].id);delete timers[which]}if(!timeout_ms)return 0;var id=setTimeout(()=>{delete timers[which];callUserCallback(()=>__emscripten_timeout(which,_emscripten_get_now()))},timeout_ms);timers[which]={id,timeout_ms};return 0}Module["__setitimer_js"]=__setitimer_js;var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,GROWABLE_HEAP_U8(),outPtr,maxBytesToWrite);Module["stringToUTF8"]=stringToUTF8;var __tzset_js=function(timezone,daylight,std_name,dst_name){timezone>>>=0;daylight>>>=0;std_name>>>=0;dst_name>>>=0;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);GROWABLE_HEAP_U32()[timezone>>>2>>>0]=stdTimezoneOffset*60;GROWABLE_HEAP_I32()[daylight>>>2>>>0]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};Module["__tzset_js"]=__tzset_js;var _emscripten_date_now=()=>Date.now();Module["_emscripten_date_now"]=_emscripten_date_now;var nowIsMonotonic=1;Module["nowIsMonotonic"]=nowIsMonotonic;var checkWasiClock=clock_id=>clock_id>=0&&clock_id<=3;Module["checkWasiClock"]=checkWasiClock;function _clock_time_get(clk_id,ignored_precision,ptime){ignored_precision=bigintToI53Checked(ignored_precision);ptime>>>=0;if(!checkWasiClock(clk_id)){return 28}var now;if(clk_id===0){now=_emscripten_date_now()}else if(nowIsMonotonic){now=_emscripten_get_now()}else{return 52}var nsec=Math.round(now*1e3*1e3);HEAP64[ptime>>>3]=BigInt(nsec);return 0}Module["_clock_time_get"]=_clock_time_get;var warnOnce=text=>{warnOnce.shown||={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;if(ENVIRONMENT_IS_NODE)text="warning: "+text;err(text)}};Module["warnOnce"]=warnOnce;var _emscripten_check_blocking_allowed=()=>{};Module["_emscripten_check_blocking_allowed"]=_emscripten_check_blocking_allowed;var runtimeKeepalivePush=()=>{runtimeKeepaliveCounter+=1};Module["runtimeKeepalivePush"]=runtimeKeepalivePush;var _emscripten_exit_with_live_runtime=()=>{runtimeKeepalivePush();throw"unwind"};Module["_emscripten_exit_with_live_runtime"]=_emscripten_exit_with_live_runtime;var getHeapMax=()=>4294901760;Module["getHeapMax"]=getHeapMax;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};Module["growMemory"]=growMemory;function _emscripten_resize_heap(requestedSize){requestedSize>>>=0;var oldSize=GROWABLE_HEAP_U8().length;if(requestedSize<=oldSize){return false}var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false}Module["_emscripten_resize_heap"]=_emscripten_resize_heap;var ENV={};Module["ENV"]=ENV;var getExecutableName=()=>thisProgram||"./this.program";Module["getExecutableName"]=getExecutableName;var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};Module["getEnvStrings"]=getEnvStrings;var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){GROWABLE_HEAP_I8()[buffer++>>>0]=str.charCodeAt(i)}GROWABLE_HEAP_I8()[buffer>>>0]=0};Module["stringToAscii"]=stringToAscii;var _environ_get=function(__environ,environ_buf){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(9,0,1,__environ,environ_buf);__environ>>>=0;environ_buf>>>=0;var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;GROWABLE_HEAP_U32()[__environ+i*4>>>2>>>0]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};Module["_environ_get"]=_environ_get;var _environ_sizes_get=function(penviron_count,penviron_buf_size){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(10,0,1,penviron_count,penviron_buf_size);penviron_count>>>=0;penviron_buf_size>>>=0;var strings=getEnvStrings();GROWABLE_HEAP_U32()[penviron_count>>>2>>>0]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);GROWABLE_HEAP_U32()[penviron_buf_size>>>2>>>0]=bufSize;return 0};Module["_environ_sizes_get"]=_environ_sizes_get;function _fd_close(fd){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(11,0,1,fd);try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_close"]=_fd_close;var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=GROWABLE_HEAP_U32()[iov>>>2>>>0];var len=GROWABLE_HEAP_U32()[iov+4>>>2>>>0];iov+=8;var curr=FS.read(stream,GROWABLE_HEAP_I8(),ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doReadv"]=doReadv;function _fd_read(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(12,0,1,fd,iov,iovcnt,pnum);iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);GROWABLE_HEAP_U32()[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_read"]=_fd_read;function _fd_seek(fd,offset,whence,newOffset){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(13,0,1,fd,offset,whence,newOffset);offset=bigintToI53Checked(offset);newOffset>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_seek"]=_fd_seek;var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=GROWABLE_HEAP_U32()[iov>>>2>>>0];var len=GROWABLE_HEAP_U32()[iov+4>>>2>>>0];iov+=8;var curr=FS.write(stream,GROWABLE_HEAP_I8(),ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doWritev"]=doWritev;function _fd_write(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(14,0,1,fd,iov,iovcnt,pnum);iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);GROWABLE_HEAP_U32()[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_write"]=_fd_write;function _random_get(buffer,size){buffer>>>=0;size>>>=0;try{randomFill(GROWABLE_HEAP_U8().subarray(buffer>>>0,buffer+size>>>0));return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_random_get"]=_random_get;var getCFunc=ident=>{var func=Module["_"+ident];return func};Module["getCFunc"]=getCFunc;var writeArrayToMemory=(array,buffer)=>{GROWABLE_HEAP_I8().set(array,buffer>>>0)};Module["writeArrayToMemory"]=writeArrayToMemory;var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};Module["stringToUTF8OnStack"]=stringToUTF8OnStack;var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func(...cArgs);function onDone(ret){if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}ret=onDone(ret);return ret};Module["ccall"]=ccall;var cwrap=(ident,returnType,argTypes,opts)=>{var numericArgs=!argTypes||argTypes.every(type=>type==="number"||type==="boolean");var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return(...args)=>ccall(ident,returnType,argTypes,args,opts)};Module["cwrap"]=cwrap;var FS_createPath=FS.createPath;Module["FS_createPath"]=FS_createPath;var FS_unlink=path=>FS.unlink(path);Module["FS_unlink"]=FS_unlink;var FS_createLazyFile=FS.createLazyFile;Module["FS_createLazyFile"]=FS_createLazyFile;var FS_createDevice=FS.createDevice;Module["FS_createDevice"]=FS_createDevice;PThread.init();FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();Module["FS_createPath"]=FS.createPath;Module["FS_createDataFile"]=FS.createDataFile;Module["FS_createPreloadedFile"]=FS.createPreloadedFile;Module["FS_unlink"]=FS.unlink;Module["FS_createLazyFile"]=FS.createLazyFile;Module["FS_createDevice"]=FS.createDevice;MEMFS.doesNotExistError=new FS.ErrnoError(44);MEMFS.doesNotExistError.stack="<generic error, no stack>";var proxiedFunctionTable=[_proc_exit,exitOnMainThread,pthreadCreateProxied,___syscall_fcntl64,___syscall_ioctl,___syscall_openat,__mmap_js,__munmap_js,__setitimer_js,_environ_get,_environ_sizes_get,_fd_close,_fd_read,_fd_seek,_fd_write];var wasmImports;function assignWasmImports(){wasmImports={s:___pthread_create_js,c:___syscall_fcntl64,h:___syscall_ioctl,i:___syscall_openat,F:__abort_js,A:__emscripten_init_main_thread_js,q:__emscripten_notify_mailbox_postmessage,t:__emscripten_receive_on_main_thread_js,m:__emscripten_runtime_keepalive_clear,d:__emscripten_thread_cleanup,z:__emscripten_thread_mailbox_await,l:__emscripten_thread_set_strongref,v:__mmap_js,w:__munmap_js,n:__setitimer_js,x:__tzset_js,E:_clock_time_get,e:_emscripten_check_blocking_allowed,u:_emscripten_date_now,j:_emscripten_exit_with_live_runtime,b:_emscripten_get_now,p:_emscripten_resize_heap,B:_environ_get,C:_environ_sizes_get,r:_exit,f:_fd_close,g:_fd_read,y:_fd_seek,D:_fd_write,a:wasmMemory,k:_proc_exit,o:_random_get}}var wasmExports;createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["G"])();var _wllama_malloc=Module["_wllama_malloc"]=(a0,a1)=>(_wllama_malloc=Module["_wllama_malloc"]=wasmExports["H"])(a0,a1);var _wllama_start=Module["_wllama_start"]=()=>(_wllama_start=Module["_wllama_start"]=wasmExports["I"])();var _wllama_action=Module["_wllama_action"]=(a0,a1)=>(_wllama_action=Module["_wllama_action"]=wasmExports["J"])(a0,a1);var _wllama_exit=Module["_wllama_exit"]=()=>(_wllama_exit=Module["_wllama_exit"]=wasmExports["K"])();var _wllama_debug=Module["_wllama_debug"]=()=>(_wllama_debug=Module["_wllama_debug"]=wasmExports["L"])();var _main=Module["_main"]=(a0,a1)=>(_main=Module["_main"]=wasmExports["M"])(a0,a1);var __emscripten_tls_init=()=>(__emscripten_tls_init=wasmExports["N"])();var _pthread_self=()=>(_pthread_self=wasmExports["O"])();var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["P"])(a0,a1);var __emscripten_thread_init=(a0,a1,a2,a3,a4,a5)=>(__emscripten_thread_init=wasmExports["R"])(a0,a1,a2,a3,a4,a5);var __emscripten_thread_crashed=()=>(__emscripten_thread_crashed=wasmExports["S"])();var __emscripten_run_on_main_thread_js=(a0,a1,a2,a3,a4)=>(__emscripten_run_on_main_thread_js=wasmExports["T"])(a0,a1,a2,a3,a4);var __emscripten_thread_free_data=a0=>(__emscripten_thread_free_data=wasmExports["U"])(a0);var __emscripten_thread_exit=a0=>(__emscripten_thread_exit=wasmExports["V"])(a0);var __emscripten_timeout=(a0,a1)=>(__emscripten_timeout=wasmExports["W"])(a0,a1);var __emscripten_check_mailbox=()=>(__emscripten_check_mailbox=wasmExports["X"])();var ___trap=()=>(___trap=wasmExports["Y"])();var _emscripten_stack_set_limits=(a0,a1)=>(_emscripten_stack_set_limits=wasmExports["Z"])(a0,a1);var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["_"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["$"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["aa"])();function applySignatureConversions(wasmExports){wasmExports=Object.assign({},wasmExports);var makeWrapper_p=f=>()=>f()>>>0;var makeWrapper_ppp=f=>(a0,a1)=>f(a0,a1)>>>0;var makeWrapper_pp=f=>a0=>f(a0)>>>0;wasmExports["O"]=makeWrapper_p(wasmExports["O"]);wasmExports["P"]=makeWrapper_ppp(wasmExports["P"]);wasmExports["$"]=makeWrapper_pp(wasmExports["$"]);wasmExports["aa"]=makeWrapper_p(wasmExports["aa"]);return wasmExports}Module["addRunDependency"]=addRunDependency;Module["removeRunDependency"]=removeRunDependency;Module["ccall"]=ccall;Module["cwrap"]=cwrap;Module["FS_createPreloadedFile"]=FS_createPreloadedFile;Module["FS_unlink"]=FS_unlink;Module["FS_createPath"]=FS_createPath;Module["FS_createDevice"]=FS_createDevice;Module["FS_createDataFile"]=FS_createDataFile;Module["FS_createLazyFile"]=FS_createLazyFile;function callMain(){var entryFunction=_main;var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exitJS(ret,true);return ret}catch(e){return handleException(e)}}function run(){if(runDependencies>0){dependenciesFulfilled=run;return}if(ENVIRONMENT_IS_PTHREAD){initRuntime();return}preRun();if(runDependencies>0){dependenciesFulfilled=run;return}function doRun(){Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();Module["onRuntimeInitialized"]?.();var noInitialRun=Module["noInitialRun"];if(!noInitialRun)callMain();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();\n',dN='var Module=typeof Module!="undefined"?Module:{};var ENVIRONMENT_IS_WEB=typeof window=="object";var ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope!="undefined";var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";if(ENVIRONMENT_IS_NODE){}var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs");var nodePath=require("path");scriptDirectory=__dirname+"/";readBinary=filename=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename);return ret};readAsync=async(filename,binary=true)=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename,binary?undefined:"utf8");return ret};if(!Module["thisProgram"]&&process.argv.length>1){thisProgram=process.argv[1].replace(/\\\\/g,"/")}arguments_=process.argv.slice(2);if(typeof module!="undefined"){module["exports"]=Module}quit_=(status,toThrow)=>{process.exitCode=status;throw toThrow}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}{if(ENVIRONMENT_IS_WORKER){readBinary=url=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=async url=>{if(isFileURI(url)){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=()=>{if(xhr.status==200||xhr.status==0&&xhr.response){resolve(xhr.response);return}reject(xhr.status)};xhr.onerror=reject;xhr.send(null)})}var response=await fetch(url,{credentials:"same-origin"});if(response.ok){return response.arrayBuffer()}throw new Error(response.status+" : "+response.url)}}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.error.bind(console);Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;var runtimeInitialized=false;var isFileURI=filename=>filename.startsWith("file://");function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=true;if(!Module["noFSInit"]&&!FS.initialized)FS.init();TTY.init();wasmExports["v"]();FS.ignorePermissions=false}function preMain(){}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(onPostRuns)}var runDependencies=0;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";if(runtimeInitialized){___trap()}var e=new WebAssembly.RuntimeError(what);throw e}var wasmBinaryFile;function findWasmBinary(){return locateFile("wllama.wasm")}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(binaryFile){if(!wasmBinary){try{var response=await readAsync(binaryFile);return new Uint8Array(response)}catch{}}return getBinarySync(binaryFile)}async function instantiateArrayBuffer(binaryFile,imports){try{var binary=await getWasmBinary(binaryFile);var instance=await WebAssembly.instantiate(binary,imports);return instance}catch(reason){err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)}}async function instantiateAsync(binary,binaryFile,imports){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI(binaryFile)&&!ENVIRONMENT_IS_NODE){try{var response=fetch(binaryFile,{credentials:"same-origin"});var instantiationResult=await WebAssembly.instantiateStreaming(response,imports);return instantiationResult}catch(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation")}}return instantiateArrayBuffer(binaryFile,imports)}function getWasmImports(){return{a:wasmImports}}async function createWasm(){function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=applySignatureConversions(wasmExports);wasmMemory=wasmExports["u"];updateMemoryViews();removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){return receiveInstance(result["instance"])}var info=getWasmImports();if(Module["instantiateWasm"]){return new Promise((resolve,reject)=>{Module["instantiateWasm"](info,(mod,inst)=>{receiveInstance(mod,inst);resolve(mod.exports)})})}wasmBinaryFile??=findWasmBinary();var result=await instantiateAsync(wasmBinary,wasmBinaryFile,info);var exports=receiveInstantiationResult(result);return exports}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}Module["ExitStatus"]=ExitStatus;var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};Module["callRuntimeCallbacks"]=callRuntimeCallbacks;var onPostRuns=[];Module["onPostRuns"]=onPostRuns;var addOnPostRun=cb=>onPostRuns.unshift(cb);Module["addOnPostRun"]=addOnPostRun;var onPreRuns=[];Module["onPreRuns"]=onPreRuns;var addOnPreRun=cb=>onPreRuns.unshift(cb);Module["addOnPreRun"]=addOnPreRun;function getValue(ptr,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":return HEAP8[ptr>>>0];case"i8":return HEAP8[ptr>>>0];case"i16":return HEAP16[ptr>>>1>>>0];case"i32":return HEAP32[ptr>>>2>>>0];case"i64":return HEAP64[ptr>>>3];case"float":return HEAPF32[ptr>>>2>>>0];case"double":return HEAPF64[ptr>>>3>>>0];case"*":return HEAPU32[ptr>>>2>>>0];default:abort(`invalid type for getValue: ${type}`)}}Module["getValue"]=getValue;var noExitRuntime=Module["noExitRuntime"]||true;Module["noExitRuntime"]=noExitRuntime;function setValue(ptr,value,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":HEAP8[ptr>>>0]=value;break;case"i8":HEAP8[ptr>>>0]=value;break;case"i16":HEAP16[ptr>>>1>>>0]=value;break;case"i32":HEAP32[ptr>>>2>>>0]=value;break;case"i64":HEAP64[ptr>>>3]=BigInt(value);break;case"float":HEAPF32[ptr>>>2>>>0]=value;break;case"double":HEAPF64[ptr>>>3>>>0]=value;break;case"*":HEAPU32[ptr>>>2>>>0]=value;break;default:abort(`invalid type for setValue: ${type}`)}}Module["setValue"]=setValue;var syscallGetVarargI=()=>{var ret=HEAP32[+SYSCALLS.varargs>>>2>>>0];SYSCALLS.varargs+=4;return ret};Module["syscallGetVarargI"]=syscallGetVarargI;var syscallGetVarargP=syscallGetVarargI;Module["syscallGetVarargP"]=syscallGetVarargP;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.slice(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.slice(0,-1)}return root+dir},basename:path=>path&&path.match(/([^\\/]+|\\/)\\/*$/)[1],join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};Module["PATH"]=PATH;var initRandomFill=()=>{if(ENVIRONMENT_IS_NODE){var nodeCrypto=require("crypto");return view=>nodeCrypto.randomFillSync(view)}return view=>crypto.getRandomValues(view)};Module["initRandomFill"]=initRandomFill;var randomFill=view=>{(randomFill=initRandomFill())(view)};Module["randomFill"]=randomFill;var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).slice(1);to=PATH_FS.resolve(to).slice(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};Module["PATH_FS"]=PATH_FS;var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;Module["UTF8Decoder"]=UTF8Decoder;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{idx>>>=0;var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.subarray(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};Module["UTF8ArrayToString"]=UTF8ArrayToString;var FS_stdin_getChar_buffer=[];Module["FS_stdin_getChar_buffer"]=FS_stdin_getChar_buffer;var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};Module["lengthBytesUTF8"]=lengthBytesUTF8;var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{outIdx>>>=0;if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++>>>0]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++>>>0]=192|u>>6;heap[outIdx++>>>0]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++>>>0]=224|u>>12;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++>>>0]=240|u>>18;heap[outIdx++>>>0]=128|u>>12&63;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}}heap[outIdx>>>0]=0;return outIdx-startIdx};Module["stringToUTF8Array"]=stringToUTF8Array;var intArrayFromString=(stringy,dontAddNull,length)=>{var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array};Module["intArrayFromString"]=intArrayFromString;var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(ENVIRONMENT_IS_NODE){var BUFSIZE=256;var buf=Buffer.alloc(BUFSIZE);var bytesRead=0;var fd=process.stdin.fd;try{bytesRead=fs.readSync(fd,buf,0,BUFSIZE)}catch(e){if(e.toString().includes("EOF"))bytesRead=0;else throw e}if(bytesRead>0){result=buf.slice(0,bytesRead).toString("utf-8")}}else if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};Module["FS_stdin_getChar"]=FS_stdin_getChar;var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};Module["TTY"]=TTY;var zeroMemory=(address,size)=>{HEAPU8.fill(0,address,address+size)};Module["zeroMemory"]=zeroMemory;var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;Module["alignMemory"]=alignMemory;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};Module["mmapAlloc"]=mmapAlloc;var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16895,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.atime=node.mtime=node.ctime=Date.now();if(parent){parent.contents[name]=node;parent.atime=parent.mtime=parent.ctime=node.atime}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.atime);attr.mtime=new Date(node.mtime);attr.ctime=new Date(node.ctime);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){for(const key of["mode","atime","mtime","ctime"]){if(attr[key]!=null){node[key]=attr[key]}}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw MEMFS.doesNotExistError},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){if(FS.isDir(old_node.mode)){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}FS.hashRemoveNode(new_node)}delete old_node.parent.contents[old_node.name];new_dir.contents[new_name]=old_node;old_node.name=new_name;new_dir.ctime=new_dir.mtime=old_node.parent.ctime=old_node.parent.mtime=Date.now()},unlink(parent,name){delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},readdir(node){return[".","..",...Object.keys(node.contents)]},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===HEAP8.buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.mtime=node.ctime=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===HEAP8.buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}HEAP8.set(contents,ptr>>>0)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};Module["MEMFS"]=MEMFS;var asyncLoad=async url=>{var arrayBuffer=await readAsync(url);return new Uint8Array(arrayBuffer)};Module["asyncLoad"]=asyncLoad;var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};Module["FS_createDataFile"]=FS_createDataFile;var preloadPlugins=Module["preloadPlugins"]||[];Module["preloadPlugins"]=preloadPlugins;var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};Module["FS_handledByPreloadPlugin"]=FS_handledByPreloadPlugin;var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url).then(processData,onerror)}else{processData(url)}};Module["FS_createPreloadedFile"]=FS_createPreloadedFile;var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};Module["FS_modeStringToFlags"]=FS_modeStringToFlags;var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};Module["FS_getMode"]=FS_getMode;var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev;this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!path){throw new FS.ErrnoError(44)}opts.follow_mount??=true;if(!PATH.isAbs(path)){path=FS.cwd()+"/"+path}linkloop:for(var nlinks=0;nlinks<40;nlinks++){var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}if(parts[i]==="."){continue}if(parts[i]===".."){current_path=PATH.dirname(current_path);current=current.parent;continue}current_path=PATH.join2(current_path,parts[i]);try{current=FS.lookupNode(current,parts[i])}catch(e){if(e?.errno===44&&islast&&opts.noent_okay){return{path:current_path}}throw e}if(FS.isMountpoint(current)&&(!islast||opts.follow_mount)){current=current.mounted.root}if(FS.isLink(current.mode)&&(!islast||opts.follow)){if(!current.node_ops.readlink){throw new FS.ErrnoError(52)}var link=current.node_ops.readlink(current);if(!PATH.isAbs(link)){link=PATH.dirname(current_path)+"/"+link}path=link+"/"+parts.slice(i+1).join("/");continue linkloop}}return{path:current_path,node:current}}throw new FS.ErrnoError(32)},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){if(!FS.isDir(dir.mode)){return 54}try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&(512|64)){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},checkOpExists(op,err){if(!op){throw new FS.ErrnoError(err)}return op},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},doSetAttr(stream,node,attr){var setattr=stream?.stream_ops.setattr;var arg=setattr?stream:node;setattr??=node.node_ops.setattr;FS.checkOpExists(setattr,63);setattr(arg,attr)},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name){throw new FS.ErrnoError(28)}if(name==="."||name===".."){throw new FS.ErrnoError(20)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){return FS.statfsNode(FS.lookupPath(path,{follow:true}).node)},statfsStream(stream){return FS.statfsNode(stream.node)},statfsNode(node){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255};if(node.node_ops.statfs){Object.assign(rtn,node.node_ops.statfs(node.mount.opts.root))}return rtn},create(path,mode=438){mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode=511){mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var readdir=FS.checkOpExists(node.node_ops.readdir,54);return readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return link.node_ops.readlink(link)},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;var getattr=FS.checkOpExists(node.node_ops.getattr,63);return getattr(node)},fstat(fd){var stream=FS.getStreamChecked(fd);var node=stream.node;var getattr=stream.stream_ops.getattr;var arg=getattr?stream:node;getattr??=node.node_ops.getattr;FS.checkOpExists(getattr,63);return getattr(arg)},lstat(path){return FS.stat(path,true)},doChmod(stream,node,mode,dontFollow){FS.doSetAttr(stream,node,{mode:mode&4095|node.mode&~4095,ctime:Date.now(),dontFollow})},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChmod(null,node,mode,dontFollow)},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.doChmod(stream,stream.node,mode,false)},doChown(stream,node,dontFollow){FS.doSetAttr(stream,node,{timestamp:Date.now(),dontFollow})},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChown(null,node,dontFollow)},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.doChown(stream,stream.node,false)},doTruncate(stream,node,len){if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}FS.doSetAttr(stream,node,{size:len,timestamp:Date.now()})},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}FS.doTruncate(null,node,len)},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(len<0||(stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.doTruncate(stream,stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var setattr=FS.checkOpExists(node.node_ops.setattr,63);setattr(node,{atime,mtime})},open(path,flags,mode=438){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=mode&4095|32768}else{mode=0}var node;var isDirPath;if(typeof path=="object"){node=path}else{isDirPath=path.endsWith("/");var lookup=FS.lookupPath(path,{follow:!(flags&131072),noent_okay:true});node=lookup.node;path=lookup.path}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else if(isDirPath){throw new FS.ErrnoError(31)}else{node=FS.mknod(path,mode|511,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(created){FS.chmod(node,mode&511)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomFill(randomBuffer);randomLeft=randomBuffer.byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);node.stream_ops={llseek:MEMFS.stream_ops.llseek};node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path},id:fd+1};ret.parent=ret;return ret},readdir(){return Array.from(FS.streams.entries()).filter(([k,v])=>v).map(([k,v])=>k.toString())}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,HEAP8,ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};Module["FS"]=FS;var UTF8ToString=(ptr,maxBytesToRead)=>{ptr>>>=0;return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""};Module["UTF8ToString"]=UTF8ToString;var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return dir+"/"+path},writeStat(buf,stat){HEAP32[buf>>>2>>>0]=stat.dev;HEAP32[buf+4>>>2>>>0]=stat.mode;HEAPU32[buf+8>>>2>>>0]=stat.nlink;HEAP32[buf+12>>>2>>>0]=stat.uid;HEAP32[buf+16>>>2>>>0]=stat.gid;HEAP32[buf+20>>>2>>>0]=stat.rdev;HEAP64[buf+24>>>3]=BigInt(stat.size);HEAP32[buf+32>>>2>>>0]=4096;HEAP32[buf+36>>>2>>>0]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>>3]=BigInt(Math.floor(atime/1e3));HEAPU32[buf+48>>>2>>>0]=atime%1e3*1e3*1e3;HEAP64[buf+56>>>3]=BigInt(Math.floor(mtime/1e3));HEAPU32[buf+64>>>2>>>0]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>>3]=BigInt(Math.floor(ctime/1e3));HEAPU32[buf+80>>>2>>>0]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>>3]=BigInt(stat.ino);return 0},writeStatFs(buf,stats){HEAP32[buf+4>>>2>>>0]=stats.bsize;HEAP32[buf+40>>>2>>>0]=stats.bsize;HEAP32[buf+8>>>2>>>0]=stats.blocks;HEAP32[buf+12>>>2>>>0]=stats.bfree;HEAP32[buf+16>>>2>>>0]=stats.bavail;HEAP32[buf+20>>>2>>>0]=stats.files;HEAP32[buf+24>>>2>>>0]=stats.ffree;HEAP32[buf+28>>>2>>>0]=stats.fsid;HEAP32[buf+44>>>2>>>0]=stats.flags;HEAP32[buf+36>>>2>>>0]=stats.namelen},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=HEAPU8.slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};Module["SYSCALLS"]=SYSCALLS;var INT53_MAX=9007199254740992;Module["INT53_MAX"]=INT53_MAX;var INT53_MIN=-9007199254740992;Module["INT53_MIN"]=INT53_MIN;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);Module["bigintToI53Checked"]=bigintToI53Checked;function ___syscall_fcntl64(fd,cmd,varargs){varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;HEAP16[arg+offset>>>1>>>0]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_fcntl64"]=___syscall_fcntl64;function ___syscall_ioctl(fd,op,varargs){varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();HEAP32[argp>>>2>>>0]=termios.c_iflag||0;HEAP32[argp+4>>>2>>>0]=termios.c_oflag||0;HEAP32[argp+8>>>2>>>0]=termios.c_cflag||0;HEAP32[argp+12>>>2>>>0]=termios.c_lflag||0;for(var i=0;i<32;i++){HEAP8[argp+i+17>>>0]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=HEAP32[argp>>>2>>>0];var c_oflag=HEAP32[argp+4>>>2>>>0];var c_cflag=HEAP32[argp+8>>>2>>>0];var c_lflag=HEAP32[argp+12>>>2>>>0];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(HEAP8[argp+i+17>>>0])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();HEAP32[argp>>>2>>>0]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();HEAP16[argp>>>1>>>0]=winsize[0];HEAP16[argp+2>>>1>>>0]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_ioctl"]=___syscall_ioctl;function ___syscall_openat(dirfd,path,flags,varargs){path>>>=0;varargs>>>=0;SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_openat"]=___syscall_openat;var __abort_js=()=>abort("");Module["__abort_js"]=__abort_js;var runtimeKeepaliveCounter=0;Module["runtimeKeepaliveCounter"]=runtimeKeepaliveCounter;var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=false;runtimeKeepaliveCounter=0};Module["__emscripten_runtime_keepalive_clear"]=__emscripten_runtime_keepalive_clear;function __mmap_js(len,prot,flags,fd,offset,allocated,addr){len>>>=0;offset=bigintToI53Checked(offset);allocated>>>=0;addr>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);var res=FS.mmap(stream,len,offset,prot,flags);var ptr=res.ptr;HEAP32[allocated>>>2>>>0]=res.allocated;HEAPU32[addr>>>2>>>0]=ptr;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__mmap_js"]=__mmap_js;function __munmap_js(addr,len,prot,flags,fd,offset){addr>>>=0;len>>>=0;offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__munmap_js"]=__munmap_js;var timers={};Module["timers"]=timers;var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};Module["handleException"]=handleException;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;Module["keepRuntimeAlive"]=keepRuntimeAlive;var _proc_exit=code=>{EXITSTATUS=code;if(!keepRuntimeAlive()){Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))};Module["_proc_exit"]=_proc_exit;var exitJS=(status,implicit)=>{EXITSTATUS=status;_proc_exit(status)};Module["exitJS"]=exitJS;var _exit=exitJS;Module["_exit"]=_exit;var maybeExit=()=>{if(!keepRuntimeAlive()){try{_exit(EXITSTATUS)}catch(e){handleException(e)}}};Module["maybeExit"]=maybeExit;var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};Module["callUserCallback"]=callUserCallback;var _emscripten_get_now=()=>performance.now();Module["_emscripten_get_now"]=_emscripten_get_now;var __setitimer_js=(which,timeout_ms)=>{if(timers[which]){clearTimeout(timers[which].id);delete timers[which]}if(!timeout_ms)return 0;var id=setTimeout(()=>{delete timers[which];callUserCallback(()=>__emscripten_timeout(which,_emscripten_get_now()))},timeout_ms);timers[which]={id,timeout_ms};return 0};Module["__setitimer_js"]=__setitimer_js;var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite);Module["stringToUTF8"]=stringToUTF8;var __tzset_js=function(timezone,daylight,std_name,dst_name){timezone>>>=0;daylight>>>=0;std_name>>>=0;dst_name>>>=0;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);HEAPU32[timezone>>>2>>>0]=stdTimezoneOffset*60;HEAP32[daylight>>>2>>>0]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};Module["__tzset_js"]=__tzset_js;var _emscripten_date_now=()=>Date.now();Module["_emscripten_date_now"]=_emscripten_date_now;var nowIsMonotonic=1;Module["nowIsMonotonic"]=nowIsMonotonic;var checkWasiClock=clock_id=>clock_id>=0&&clock_id<=3;Module["checkWasiClock"]=checkWasiClock;function _clock_time_get(clk_id,ignored_precision,ptime){ignored_precision=bigintToI53Checked(ignored_precision);ptime>>>=0;if(!checkWasiClock(clk_id)){return 28}var now;if(clk_id===0){now=_emscripten_date_now()}else if(nowIsMonotonic){now=_emscripten_get_now()}else{return 52}var nsec=Math.round(now*1e3*1e3);HEAP64[ptime>>>3]=BigInt(nsec);return 0}Module["_clock_time_get"]=_clock_time_get;var getHeapMax=()=>4294901760;Module["getHeapMax"]=getHeapMax;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};Module["growMemory"]=growMemory;function _emscripten_resize_heap(requestedSize){requestedSize>>>=0;var oldSize=HEAPU8.length;var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false}Module["_emscripten_resize_heap"]=_emscripten_resize_heap;var ENV={};Module["ENV"]=ENV;var getExecutableName=()=>thisProgram||"./this.program";Module["getExecutableName"]=getExecutableName;var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};Module["getEnvStrings"]=getEnvStrings;var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){HEAP8[buffer++>>>0]=str.charCodeAt(i)}HEAP8[buffer>>>0]=0};Module["stringToAscii"]=stringToAscii;var _environ_get=function(__environ,environ_buf){__environ>>>=0;environ_buf>>>=0;var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;HEAPU32[__environ+i*4>>>2>>>0]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};Module["_environ_get"]=_environ_get;var _environ_sizes_get=function(penviron_count,penviron_buf_size){penviron_count>>>=0;penviron_buf_size>>>=0;var strings=getEnvStrings();HEAPU32[penviron_count>>>2>>>0]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);HEAPU32[penviron_buf_size>>>2>>>0]=bufSize;return 0};Module["_environ_sizes_get"]=_environ_sizes_get;function _fd_close(fd){try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_close"]=_fd_close;var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>>2>>>0];var len=HEAPU32[iov+4>>>2>>>0];iov+=8;var curr=FS.read(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doReadv"]=doReadv;function _fd_read(fd,iov,iovcnt,pnum){iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);HEAPU32[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_read"]=_fd_read;function _fd_seek(fd,offset,whence,newOffset){offset=bigintToI53Checked(offset);newOffset>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_seek"]=_fd_seek;var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>>2>>>0];var len=HEAPU32[iov+4>>>2>>>0];iov+=8;var curr=FS.write(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doWritev"]=doWritev;function _fd_write(fd,iov,iovcnt,pnum){iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);HEAPU32[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_write"]=_fd_write;function _random_get(buffer,size){buffer>>>=0;size>>>=0;try{randomFill(HEAPU8.subarray(buffer>>>0,buffer+size>>>0));return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_random_get"]=_random_get;var getCFunc=ident=>{var func=Module["_"+ident];return func};Module["getCFunc"]=getCFunc;var writeArrayToMemory=(array,buffer)=>{HEAP8.set(array,buffer>>>0)};Module["writeArrayToMemory"]=writeArrayToMemory;var stackAlloc=sz=>__emscripten_stack_alloc(sz);Module["stackAlloc"]=stackAlloc;var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};Module["stringToUTF8OnStack"]=stringToUTF8OnStack;var stackSave=()=>_emscripten_stack_get_current();Module["stackSave"]=stackSave;var stackRestore=val=>__emscripten_stack_restore(val);Module["stackRestore"]=stackRestore;var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func(...cArgs);function onDone(ret){if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}ret=onDone(ret);return ret};Module["ccall"]=ccall;var cwrap=(ident,returnType,argTypes,opts)=>{var numericArgs=!argTypes||argTypes.every(type=>type==="number"||type==="boolean");var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return(...args)=>ccall(ident,returnType,argTypes,args,opts)};Module["cwrap"]=cwrap;var FS_createPath=FS.createPath;Module["FS_createPath"]=FS_createPath;var FS_unlink=path=>FS.unlink(path);Module["FS_unlink"]=FS_unlink;var FS_createLazyFile=FS.createLazyFile;Module["FS_createLazyFile"]=FS_createLazyFile;var FS_createDevice=FS.createDevice;Module["FS_createDevice"]=FS_createDevice;FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();Module["FS_createPath"]=FS.createPath;Module["FS_createDataFile"]=FS.createDataFile;Module["FS_createPreloadedFile"]=FS.createPreloadedFile;Module["FS_unlink"]=FS.unlink;Module["FS_createLazyFile"]=FS.createLazyFile;Module["FS_createDevice"]=FS.createDevice;MEMFS.doesNotExistError=new FS.ErrnoError(44);MEMFS.doesNotExistError.stack="<generic error, no stack>";var wasmImports={b:___syscall_fcntl64,f:___syscall_ioctl,g:___syscall_openat,t:__abort_js,j:__emscripten_runtime_keepalive_clear,n:__mmap_js,o:__munmap_js,k:__setitimer_js,p:__tzset_js,s:_clock_time_get,h:_emscripten_date_now,m:_emscripten_resize_heap,r:_environ_get,c:_environ_sizes_get,a:_fd_close,e:_fd_read,q:_fd_seek,d:_fd_write,i:_proc_exit,l:_random_get};var wasmExports;createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["v"])();var _wllama_malloc=Module["_wllama_malloc"]=(a0,a1)=>(_wllama_malloc=Module["_wllama_malloc"]=wasmExports["w"])(a0,a1);var _wllama_start=Module["_wllama_start"]=()=>(_wllama_start=Module["_wllama_start"]=wasmExports["x"])();var _wllama_action=Module["_wllama_action"]=(a0,a1)=>(_wllama_action=Module["_wllama_action"]=wasmExports["y"])(a0,a1);var _wllama_exit=Module["_wllama_exit"]=()=>(_wllama_exit=Module["_wllama_exit"]=wasmExports["z"])();var _wllama_debug=Module["_wllama_debug"]=()=>(_wllama_debug=Module["_wllama_debug"]=wasmExports["A"])();var _main=Module["_main"]=(a0,a1)=>(_main=Module["_main"]=wasmExports["B"])(a0,a1);var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["D"])(a0,a1);var __emscripten_timeout=(a0,a1)=>(__emscripten_timeout=wasmExports["E"])(a0,a1);var ___trap=()=>(___trap=wasmExports["F"])();var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["G"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["H"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["I"])();function applySignatureConversions(wasmExports){wasmExports=Object.assign({},wasmExports);var makeWrapper_ppp=f=>(a0,a1)=>f(a0,a1)>>>0;var makeWrapper_pp=f=>a0=>f(a0)>>>0;var makeWrapper_p=f=>()=>f()>>>0;wasmExports["D"]=makeWrapper_ppp(wasmExports["D"]);wasmExports["H"]=makeWrapper_pp(wasmExports["H"]);wasmExports["I"]=makeWrapper_p(wasmExports["I"]);return wasmExports}Module["addRunDependency"]=addRunDependency;Module["removeRunDependency"]=removeRunDependency;Module["ccall"]=ccall;Module["cwrap"]=cwrap;Module["FS_createPreloadedFile"]=FS_createPreloadedFile;Module["FS_unlink"]=FS_unlink;Module["FS_createPath"]=FS_createPath;Module["FS_createDevice"]=FS_createDevice;Module["FS_createDataFile"]=FS_createDataFile;Module["FS_createLazyFile"]=FS_createLazyFile;function callMain(){var entryFunction=_main;var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exitJS(ret,true);return ret}catch(e){return handleException(e)}}function run(){if(runDependencies>0){dependenciesFulfilled=run;return}preRun();if(runDependencies>0){dependenciesFulfilled=run;return}function doRun(){Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();Module["onRuntimeInitialized"]?.();var noInitialRun=Module["noInitialRun"];if(!noInitialRun)callMain();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();\n';class uN{constructor(e,r=1,n,a){se(this,"logger");se(this,"suppressNativeLog");se(this,"taskQueue",[]);se(this,"taskId",1);se(this,"resultQueue",[]);se(this,"busy",!1);se(this,"worker");se(this,"pathConfig");se(this,"multiThread");se(this,"nbThread");this.pathConfig=e,this.nbThread=r,this.multiThread=r>1,this.logger=a,this.suppressNativeLog=n}async moduleInit(e){if(!this.pathConfig["wllama.wasm"])throw new Error('"single-thread/wllama.wasm" is missing from pathConfig');let r=this.multiThread?cN:dN,n=r.replace("var Module","var ___Module");const a={pathConfig:this.pathConfig,nbThread:this.nbThread},o=[`const RUN_OPTIONS = ${JSON.stringify(a)};`,`function wModuleInit() { ${n}; return Module; }`,lN].join(`;

`);this.worker=Oh(o),this.worker.onmessage=this.onRecvMsg.bind(this),this.worker.onerror=this.logger.error;const i=await this.pushTask({verb:"module.init",args:[new Blob([r],{type:"text/javascript"})],callbackId:this.taskId++}),s=[];for(const l of e){const c=await this.fileAlloc(l.name,l.blob.size);s.push({id:c,...l})}return await Promise.all(s.map(l=>this.fileWrite(l.id,l.blob))),i}async wllamaStart(){const e=await this.pushTask({verb:"wllama.start",args:[],callbackId:this.taskId++});return this.parseResult(e)}async wllamaAction(e,r){const n=eN(r),a=await this.pushTask({verb:"wllama.action",args:[e,n],callbackId:this.taskId++});return QF(a)}async wllamaExit(){if(this.worker){const e=await this.pushTask({verb:"wllama.exit",args:[],callbackId:this.taskId++});this.parseResult(e),this.worker.terminate()}}async wllamaDebug(){const e=await this.pushTask({verb:"wllama.debug",args:[],callbackId:this.taskId++});return JSON.parse(e)}async fileAlloc(e,r){return(await this.pushTask({verb:"fs.alloc",args:[e,r],callbackId:this.taskId++})).fileId}async fileWrite(e,r){const n=r.stream().getReader();let a=0;for(;;){const{done:o,value:i}=await n.read();if(o)break;const s=i.byteLength;await this.pushTask({verb:"fs.write",args:[e,i,a],callbackId:this.taskId++},[i.buffer]),a+=s}}parseResult(e){const r=JSON.parse(e);if(r&&r.error)throw new Error("Unknown error, please see console.log");return r}pushTask(e,r){return new Promise((n,a)=>{this.taskQueue.push({resolve:n,reject:a,param:e,buffers:r}),this.runTaskLoop()})}async runTaskLoop(){if(!this.busy){for(this.busy=!0;;){const e=this.taskQueue.shift();if(!e)break;this.resultQueue.push(e),this.worker.postMessage(e.param,hb()?void 0:{transfer:e.buffers??[]})}this.busy=!1}}onRecvMsg(e){if(!e.data)return;const{verb:r,args:n}=e.data;if(r&&r.startsWith("console.")){if(this.suppressNativeLog)return;r.endsWith("debug")&&this.logger.debug(...n),r.endsWith("log")&&this.logger.log(...n),r.endsWith("warn")&&this.logger.warn(...n),r.endsWith("error")&&this.logger.error(...n);return}else r==="signal.abort"&&this.abort(n[0]);const{callbackId:a,result:o,err:i}=e.data;if(a){const s=this.resultQueue.findIndex(l=>l.param.callbackId===a);if(s!==-1){const l=this.resultQueue.splice(s,1)[0];i?l.reject(i):l.resolve(o)}else this.logger.error(`Cannot find waiting task with callbackId = ${a}`)}}abort(e){for(;this.resultQueue.length>0;){const r=this.resultQueue.pop();if(!r)break;r.reject(new Error(`Received abort signal from llama.cpp; Message: ${e||"(empty)"}`))}}}let Vn;Vn="__metadata__",nf="polyfill_for_older_version";class fb{async getNameFromURL(e){return await za(e,"")}async write(e,r,n){return this.writeMetadata(e,n),await mb(e,r)}async download(e,r={}){const n=Oh(pb);let a=!1;r.signal&&(a=r.signal.aborted,r.signal.addEventListener("abort",()=>{a=!0,n.postMessage({action:"download-abort"})}),delete r.signal);const o=await za(e,Vn),i=await za(e,"");return await new Promise((s,l)=>{n.postMessage({action:"download",url:e,filename:i,metadataFileName:o,options:{headers:r.headers,aborted:a}}),n.onmessage=c=>{var d;if(c.data.ok)n.terminate(),s();else if(c.data.err)n.terminate(),l(c.data.err);else if(c.data.progress){const u=c.data.progress;(d=r.progressCallback)==null||d.call(r,u)}else l(new Error("Unknown message from worker")),console.error("Unknown message from worker",c.data)}})}async open(e){return await gb(e)}async getSize(e){return await hN(e)}async getMetadata(e){const r=await gb(e,Vn),n=await this.getSize(e);if(!r)return n>0?{etag:nf,originalSize:n,originalURL:""}:null;try{return await new Response(r).json()}catch{return null}}async list(){const e=await xl(),r=[],n={};for await(let[a,o]of e.entries())if(o.kind==="file"&&a.startsWith(Vn)){const i=(await o.getFile()).stream(),s=await new Response(i).json().catch(l=>null);n[a.replace(Vn,"")]=s}for await(let[a,o]of e.entries())o.kind==="file"&&!a.startsWith(Vn)&&r.push({name:a,size:await o.getFile().then(i=>i.size),metadata:n[a]||{originalSize:(await o.getFile()).size,originalURL:"",etag:""}});return r}async clear(){await this.deleteMany(()=>!0)}async delete(e){const r=await this.getNameFromURL(e);await this.deleteMany(n=>n.name===e||n.name===r)}async deleteMany(e){const r=await xl(),n=await this.list();for(const a of n)e(a)&&r.removeEntry(a.name)}async writeMetadata(e,r){const n=new Blob([JSON.stringify(r)],{type:"text/plain"});await mb(e,n.stream(),Vn)}}async function mb(t,e,r=""){try{const n=await za(t,r),a=await pN(n);await a.truncate(0);const o=e.getReader();for(;;){const{done:i,value:s}=await o.read();if(i)break;await a.write(s)}await a.close()}catch(n){console.error("opfsWrite",n)}}async function gb(t,e=""){const r=async o=>{try{return await(await(await xl()).getFileHandle(o)).getFile()}catch{return null}};let n=await r(t);if(n)return n;const a=await za(t,e);return n=await r(a),n}async function hN(t,e=""){try{const r=await xl(),n=await za(t,e);return(await(await r.getFileHandle(n)).getFile()).size}catch{return-1}}async function za(t,e){const r=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(t)),n=Array.from(new Uint8Array(r)).map(a=>a.toString(16).padStart(2,"0")).join("");return`${e}${n}_${t.split("/").pop()}`}async function xl(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("cache",{create:!0})}async function pN(t){const e=Oh(pb);let r,n;e.onmessage=o=>{o.data.ok?r(null):o.data.err&&n(o.data.err)};const a=o=>new Promise((i,s)=>{r=i,n=s,e.postMessage(o,hb()?void 0:{transfer:o.value?[o.value.buffer]:[]})});return await a({open:t}),{truncate:async()=>{},write:o=>a({value:o}),close:async()=>{await a({done:!0}),e.terminate()}}}const fN=3;af=(t=>(t.VALID="valid",t.INVALID="invalid",t.DELETED="deleted",t))(af||{}),$i=class{constructor(t,e,r){se(this,"modelManager");se(this,"url");se(this,"size");se(this,"files");this.modelManager=t,this.url=e,r?(this.files=this.getAllFiles(r),this.size=Ph(this.files.map(n=>n.metadata.originalSize))):(this.files=[],this.size=0)}async open(){if(this.size===-1)throw new Ie("Model is deleted from the cache; Call ModelManager.downloadModel to re-download the model","load_error");const t=[];for(const e of this.files){const r=await this.modelManager.cacheManager.open(e.name);if(!r)throw new Error(`Failed to open file ${e.name}; Hint: the model may be invalid, please refresh it`);t.push(r)}return t}validate(){const t=na.parseModelUrl(this.url).length;if(this.size===-1)return"deleted";if(this.size<16||this.files.length!==t)return"invalid";for(const e of this.files)if(!e.metadata||e.metadata.originalSize!==e.size)return"invalid";return"valid"}async refresh(t={}){const e=na.parseModelUrl(this.url),r=e.map((l,c)=>({url:l,index:c}));this.modelManager.logger.debug("Downloading model files:",e);const n=this.modelManager.params.parallelDownloads??fN,a=await this.getTotalDownloadSize(e),o=[],i=async()=>{for(;r.length>0;){const l=r.shift();if(!l)break;await this.modelManager.cacheManager.download(l.url,{...t,progressCallback:({loaded:c})=>{var d;o[l.index]=c,(d=t.progressCallback)==null||d.call(t,{loaded:Ph(o),total:a})}})}},s=[];for(let l=0;l<n;l++)s.push(i()),o.push(0);await Promise.all(s),this.files=this.getAllFiles(await this.modelManager.cacheManager.list()),this.size=this.files.reduce((l,c)=>l+c.metadata.originalSize,0)}async remove(){this.files=this.getAllFiles(await this.modelManager.cacheManager.list()),await this.modelManager.cacheManager.deleteMany(t=>!!this.files.find(e=>e.name===t.name)),this.size=-1}getAllFiles(t){const e=new Set(na.parseModelUrl(this.url)),r=[];for(const n of e){const a=t.find(o=>o.metadata.originalURL===n);if(!a)throw new Error(`Model file not found: ${n}`);r.push(a)}return r.sort((n,a)=>n.metadata.originalURL.localeCompare(a.metadata.originalURL)),r}async getTotalDownloadSize(t){const e=(await Promise.all(t.map(r=>fetch(r,{method:"HEAD"})))).map(r=>Number(r.headers.get("content-length")||"0"));return Ph(e)}},na=class{constructor(t={}){se(this,"cacheManager");se(this,"params");se(this,"logger");this.cacheManager=t.cacheManager||new fb,this.params=t,this.logger=t.logger||console}static parseModelUrl(t){if(Array.isArray(t))return t;const e=/-(\d{5})-of-(\d{5})\.gguf$/,r=t.match(e);if(!r)return[t];const n=t.replace(e,""),a=r[2];return Array.from({length:Number(a)},(o,i)=>(i+1).toString().padStart(5,"0")).map(o=>`${n}-${o}-of-${a}.gguf`)}async getModels(t={}){const e=await this.cacheManager.list();let r=[];for(const n of e){const a=na.parseModelUrl(n.metadata.originalURL);(a.length===1||a[0]===n.metadata.originalURL)&&r.push(new $i(this,n.metadata.originalURL,e))}return t.includeInvalid||(r=r.filter(n=>n.validate()==="valid")),r}async downloadModel(t,e={}){if(!t.endsWith(".gguf"))throw new Ie(`Invalid model URL: ${t}; URL must ends with ".gguf"`,"download_error");const r=new $i(this,t,void 0);return r.validate()!=="valid"&&await r.refresh(e),r}async getModelOrDownload(t,e={}){var n;const r=(await this.getModels()).find(a=>a.url===t);return r?((n=e.progressCallback)==null||n.call(e,{loaded:r.size,total:r.size}),r):this.downloadModel(t,e)}async clear(){await this.cacheManager.clear()}};let yb,vb;yb=/^([a-zA-Z0-9_\-\.]+)\/([a-zA-Z0-9_\-\.]+)$/,vb="Hugging Face model ID is incorrect. Only regular alphanumeric characters, '-', '.' and '_' supported",Kb={...console,debug:()=>{}},Ie=class extends Error{constructor(e,r="unknown_error"){super(e);se(this,"type");this.type=r}},rf=class{constructor(t,e={}){se(this,"cacheManager");se(this,"modelManager");se(this,"proxy",null);se(this,"config");se(this,"pathConfig");se(this,"useMultiThread",!1);se(this,"nbThreads",1);se(this,"useEmbeddings",!1);se(this,"loadedContextInfo",null);se(this,"bosToken",-1);se(this,"eosToken",-1);se(this,"eotToken",-1);se(this,"eogTokens",new Set);se(this,"addBosToken",!1);se(this,"addEosToken",!1);se(this,"chatTemplate");se(this,"metadata");se(this,"samplingConfig",{});se(this,"hasEncoder",!1);se(this,"decoderStartToken",-1);se(this,"nCachedTokens",0);if(sN(),!t)throw new Ie("AssetsPathConfig is required");this.pathConfig=t,this.config=e,this.cacheManager=e.cacheManager??new fb,this.modelManager=e.modelManager??new na({cacheManager:this.cacheManager,logger:e.logger??console,parallelDownloads:e.parallelDownloads,allowOffline:e.allowOffline})}logger(){return this.config.logger??console}checkModelLoaded(){if(!this.isModelLoaded())throw new Ie("loadModel() is not yet called","model_not_loaded")}isModelLoaded(){return!!this.proxy&&!!this.metadata}getBOS(){return this.bosToken}getEOS(){return this.eosToken}getEOT(){return this.eotToken}isTokenEOG(t){return t===this.eosToken||t===this.eotToken||this.eogTokens.has(t)}getDecoderStartToken(){return this.decoderStartToken}getModelMetadata(){return this.checkModelLoaded(),this.metadata}isMultithread(){return this.checkModelLoaded(),this.useMultiThread}getNumThreads(){return this.checkModelLoaded(),this.useMultiThread?this.nbThreads:1}isEncoderDecoderArchitecture(){return this.checkModelLoaded(),this.hasEncoder}mustAddBosToken(){return this.checkModelLoaded(),this.addBosToken}mustAddEosToken(){return this.checkModelLoaded(),this.addEosToken}getChatTemplate(){return this.checkModelLoaded(),this.chatTemplate??null}async loadModelFromUrl(t,e={}){const r=ub(t)?t:t[0],n=await(e.useCache??!0?await this.modelManager.getModelOrDownload(r,e):await this.modelManager.downloadModel(r,e)).open();return await this.loadModel(n,e)}async loadModelFromHF(t,e,r={}){if(!t.match(yb))throw new Ie(vb,"download_error");if(!e.endsWith(".gguf"))throw new Ie("Only GGUF file is supported","download_error");return await this.loadModelFromUrl(`https://huggingface.co/${t}/resolve/main/${e}`,r)}async loadModel(t,e={}){const r=t instanceof $i?await t.open():[...t];if(r.some(h=>h.size===0))throw new Ie("Input model (or splits) must be non-empty Blob or File","load_error");if(nN(r),this.proxy)throw new Ie("Module is already initialized","load_error");const n=await aN();n||this.logger().warn("Multi-threads are not supported in this environment, falling back to single-thread");const a=!!this.pathConfig["multi-thread/wllama.wasm"];a||this.logger().warn('Missing paths to "multi-thread/wllama.wasm", falling back to single-thread');const o=Math.floor((navigator.hardwareConcurrency||1)/2),i=e.n_threads??o;this.nbThreads=i,this.useMultiThread=n&&a&&i>1;const s=this.useMultiThread?{"wllama.wasm":db(this.pathConfig["multi-thread/wllama.wasm"])}:{"wllama.wasm":db(this.pathConfig["single-thread/wllama.wasm"])};this.proxy=new uN(s,this.useMultiThread?i:1,this.config.suppressNativeLog??!1,this.logger());const l=r.map((h,p)=>({name:`model-${p}.gguf`,blob:h}));await this.proxy.moduleInit(l);const c=await this.proxy.wllamaStart();if(!c.success)throw new Ie(`Error while calling start function, result = ${c}`);const d=await this.proxy.wllamaAction("load",{_name:"load_req",use_mmap:!0,use_mlock:!0,n_gpu_layers:0,seed:e.seed||Math.floor(Math.random()*1e5),n_ctx:e.n_ctx||1024,n_threads:this.useMultiThread?i:1,n_ctx_auto:!1,model_paths:l.map(h=>`models/${h.name}`),embeddings:e.embeddings,offload_kqv:e.offload_kqv,n_batch:e.n_batch,pooling_type:e.pooling_type,rope_scaling_type:e.rope_scaling_type,rope_freq_base:e.rope_freq_base,rope_freq_scale:e.rope_freq_scale,yarn_ext_factor:e.yarn_ext_factor,yarn_attn_factor:e.yarn_attn_factor,yarn_beta_fast:e.yarn_beta_fast,yarn_beta_slow:e.yarn_beta_slow,yarn_orig_ctx:e.yarn_orig_ctx,cache_type_k:e.cache_type_k,cache_type_v:e.cache_type_v}),u={...d,metadata:{}};for(let h=0;h<d.metadata_key.length;h++)u.metadata[d.metadata_key[h]]=d.metadata_val[h];this.bosToken=u.token_bos,this.eosToken=u.token_eos,this.eotToken=u.token_eot,this.useEmbeddings=!!e.embeddings,this.metadata={hparams:{nVocab:u.n_vocab,nCtxTrain:u.n_ctx_train,nEmbd:u.n_embd,nLayer:u.n_layer},meta:u.metadata},this.hasEncoder=!!u.has_encoder,this.decoderStartToken=u.token_decoder_start,this.addBosToken=u.add_bos_token,this.addEosToken=u.add_eos_token,this.chatTemplate=u.metadata["tokenizer.chat_template"],this.loadedContextInfo=u,this.eogTokens=new Set(u.list_tokens_eog),this.logger().debug({loadedCtxInfo:u})}getLoadedContextInfo(){if(this.checkModelLoaded(),!this.loadedContextInfo)throw new Ie("Loaded context info is not available");return{...this.loadedContextInfo}}async createEmbedding(t,e={}){this.checkModelLoaded();const r={skipBOS:!1,skipEOS:!1,...e};await this.samplingInit(this.samplingConfig),await this.kvClear();const n=await this.tokenize(t);return this.bosToken&&!r.skipBOS&&n.unshift(this.bosToken),this.eosToken&&!r.skipEOS&&n.push(this.eosToken),await this.embeddings(n)}async createChatCompletion(t,e){const r=await this.formatChat(t,!0);return await this.createCompletion(r,e)}async createCompletion(t,e){this.checkModelLoaded(),this.samplingConfig=e.sampling??{},await this.samplingInit(this.samplingConfig);const r=new Set(e.stopTokens??[]);let n=await this.tokenize(t,!0);this.addBosToken&&n[0]!==this.bosToken&&n.unshift(this.bosToken),e.useCache?n=await this.computeNonCachedTokens(n):await this.kvClear(),await this.samplingAccept(n),this.isEncoderDecoderArchitecture()?(await this.encode(n),await this.decode([this.getDecoderStartToken()],{})):await this.decode(n,{});let a=new Uint8Array,o=!1;const i=()=>{o=!0};for(let s=0;s<(e.nPredict??1/0);s++){const l=await this.samplingSample();if(this.isTokenEOG(l.token)||r.has(l.token)||(a=tN([a,l.piece]),e.onNewToken&&e.onNewToken(l.token,l.piece,sb(a),{abortSignal:i}),o))break;await this.samplingAccept([l.token]),await this.decode([l.token],{})}return sb(a)}async samplingInit(t,e=[]){if(this.checkModelLoaded(),this.samplingConfig=t,!(await this.proxy.wllamaAction("sampling_init",{_name:"sint_req",...t,tokens:e})).success)throw new Ie("Failed to initialize sampling")}async getVocab(){return this.checkModelLoaded(),(await this.proxy.wllamaAction("get_vocab",{_name:"gvoc_req"})).vocab}async lookupToken(t){this.checkModelLoaded();const e=await this.proxy.wllamaAction("lookup_token",{_name:"lkup_req",piece:t});return e.success?e.token:-1}async tokenize(t,e=!0){return this.checkModelLoaded(),(await this.proxy.wllamaAction("tokenize",{_name:"tokn_req",text:t,special:!!e})).tokens}async detokenize(t){return this.checkModelLoaded(),(await this.proxy.wllamaAction("detokenize",{_name:"dtkn_req",tokens:t})).buffer}async decode(t,e){if(this.checkModelLoaded(),this.useEmbeddings)throw new Ie("embeddings is enabled. Use wllama.setOptions({ embeddings: false }) to disable it.");if(t.length===0)return{nPast:this.nCachedTokens};if(this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ie("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");const r=this.breakTokensIntoBatches(t,this.loadedContextInfo.n_batch);let n;for(let a=0;a<r.length;a++){const o=r.length>1&&a<r.length-1;if(n=await this.proxy.wllamaAction("decode",{_name:"deco_req",tokens:r[a],skip_logits:e.skipLogits||o}),n.error)throw new Ie(n.error);if(!n.success)throw new Ie("Cannot encode, unknown error")}return this.nCachedTokens=n.n_past,{nPast:n.n_past}}async encode(t,e){if(this.checkModelLoaded(),!this.hasEncoder)throw new Ie("This model does not use encoder-decoder architecture.","inference_error");if(this.useEmbeddings)throw new Ie("embeddings is enabled. Use wllama.setOptions({ embeddings: false }) to disable it.","inference_error");if(t.length===0)return{nPast:this.nCachedTokens};if(this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ie("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");const r=this.breakTokensIntoBatches(t,this.loadedContextInfo.n_batch);let n;for(let a=0;a<r.length;a++){if(n=await this.proxy.wllamaAction("encode",{_name:"enco_req",tokens:r[a]}),n.error)throw new Ie(n.error);if(!n.success)throw new Ie("Cannot encode, unknown error")}return this.nCachedTokens=n.n_past,{nPast:n.n_past}}breakTokensIntoBatches(t,e){const r=[];for(let n=0;n<t.length;n+=e)r.push(t.slice(n,n+e));return r}async samplingSample(){this.checkModelLoaded();const t=await this.proxy.wllamaAction("sampling_sample",{_name:"ssam_req"});return{piece:t.piece,token:t.token}}async samplingAccept(t){if(this.checkModelLoaded(),!(await this.proxy.wllamaAction("sampling_accept",{_name:"sacc_req",tokens:t})).success)throw new Ie("samplingAccept unknown error")}async getLogits(t=40){this.checkModelLoaded();const e=await this.proxy.wllamaAction("get_logits",{_name:"glog_req",top_k:t}),r=[];for(let n=0;n<e.tokens.length;n++)r.push({token:e.tokens[n],p:e.probs[n]});return r}async embeddings(t){if(this.checkModelLoaded(),!this.useEmbeddings)throw new Ie("embeddings is disabled. Use wllama.setOptions({ embeddings: true }) to enable it.","inference_error");if(this.nCachedTokens>0&&this.logger().warn("Embeddings: KV cache is not empty, this may produce incorrect results"),this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ie("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");if(t.length>this.loadedContextInfo.n_batch)throw new Ie("Embedding tokens does not fit into batch. Please increase n_batch when loading the model","inference_error");if(t.length>this.loadedContextInfo.n_ubatch)throw new Ie("Embedding tokens does not fit into physical batch. Please increase n_ubatch when loading the model","inference_error");const e=await this.proxy.wllamaAction("embeddings",{_name:"gemb_req",tokens:t});if(e.success)return e.embeddings;throw new Ie("embeddings unknown error")}async kvRemove(t,e){if(this.checkModelLoaded(),e!==0){if(!(await this.proxy.wllamaAction("kv_remove",{_name:"kvcr_req",n_keep:t,n_discard:e})).success)throw new Ie("kvRemove unknown error");this.nCachedTokens-=e}}async kvClear(){if(this.checkModelLoaded(),!(await this.proxy.wllamaAction("kv_clear",{_name:"kvcc_req"})).success)throw new Ie("kvClear unknown error");this.nCachedTokens=0}async formatChat(t,e,r){this.checkModelLoaded();const n=t.map(i=>i.role),a=t.map(i=>i.content),o=await this.proxy.wllamaAction("chat_format",{_name:"cfmt_req",roles:n,contents:a,tmpl:r,add_ass:e});if(!o.success)throw new Ie("formatChat unknown error");return o.formatted_chat}async setOptions(t){this.checkModelLoaded(),await this.proxy.wllamaAction("set_options",{_name:"opti_req",...t}),this.useEmbeddings=t.embeddings}async exit(){var t;await((t=this.proxy)==null?void 0:t.wllamaExit()),this.proxy=null}async _getDebugInfo(){return this.checkModelLoaded(),await this.proxy.wllamaDebug()}async _testBenchmark(t,e){return this.checkModelLoaded(),await this.proxy.wllamaAction("test_benchmark",{_name:"tben_req",type:t,n_samples:e})}async _testPerplexity(t){return this.checkModelLoaded(),await this.proxy.wllamaAction("test_perplexity",{_name:"tper_req",tokens:t})}async getCachedTokens(){return this.checkModelLoaded(),(await this.proxy.wllamaAction("current_status",{_name:"stat_req"})).tokens}async computeNonCachedTokens(t){const e=await this.getCachedTokens();let r=0;for(;r<Math.min(e.length,t.length)&&e[r]===t[r];r++);return this.logger().debug(`Cache nKeep=${r}`),await this.kvRemove(r,-1),t.slice(r,t.length)}};const mN="/NoLLMChat/assets/wllama-59gK4z3b.wasm",gN="/NoLLMChat/assets/wllama-BdNJdSN3.wasm",_b=t=>t.reduce((e,r)=>"text"in r?`${e} ${r.text}`:e,""),Ih=t=>typeof t=="string"?t:Array.isArray(t)?_b(t):typeof t.content=="string"?t.content:_b(t.content);function yN(t){if(typeof t=="string"||!Array.isArray(t))return[{role:"user",content:typeof t=="string"?t:t.toString()}];const e=[];return t.map(r=>{if(typeof r=="string")e.push({role:"assistant",content:r});else if(r instanceof ao)e.push({role:"user",content:Ih(r.content)});else if(r instanceof Qn)e.push({role:"assistant",content:Ih(r.content)});else if(r instanceof Mi)e.push({role:"system",content:Ih(r.content)});else throw new Error(`Invalid message type ${JSON.stringify(r)}`)}),e}const vN={"single-thread/wllama.wasm":mN,"multi-thread/wllama.wasm":gN};let zr;Db=async(t,e)=>{var i;zr=new rf(vN,{logger:{debug:(...s)=>Mb(...s),log:(...s)=>QN(...s),warn:(...s)=>vn(...s),error:(...s)=>Nl(...s)}});const r=({loaded:s,total:l})=>{var u;const c=Math.round(s/l*100),d=`Downloading... ${c}%`;(u=e.callback)==null||u.call(e,{text:d,progress:c,timeElapsed:0})},[n,a,...o]=t.split("/");await zr.loadModelFromHF(`${n}/${a}`,o.join("/"),{progressCallback:r}),(i=e.callback)==null||i.call(e,{text:"Model loaded!",progress:100,timeElapsed:0})};async function _N(){await(zr==null?void 0:zr.exit()),zr=void 0}Lb=async function(t,e){var o,i,s,l,c,d,u,h;let r="";const n=yN(t),a=await(zr==null?void 0:zr.createChatCompletion(n,{nPredict:(o=e==null?void 0:e.configurable)!=null&&o.nPredict?+((i=e==null?void 0:e.configurable)==null?void 0:i.nPredict):void 0,sampling:{temp:(s=e==null?void 0:e.configurable)!=null&&s.temperature?+((l=e==null?void 0:e.configurable)==null?void 0:l.temperature):void 0,top_k:(c=e==null?void 0:e.configurable)!=null&&c.topK?+((d=e==null?void 0:e.configurable)==null?void 0:d.topK):void 0,top_p:(u=e==null?void 0:e.configurable)!=null&&u.topP?+((h=e==null?void 0:e.configurable)==null?void 0:h.topP):void 0},onNewToken:(p,f,g)=>{var E;const y=g.slice(r.length);(E=e.onNewToken)==null||E.call(e,p,f,y),r=g}}));return new Qn(a||"")};const wN=m.memo(({children:t})=>{const e=ql(o=>o.destroy),r=Ul(o=>o.destroy),n=ql(o=>o.init),a=Ul(o=>o.init);return m.useEffect(()=>(n(),a(),()=>{e(),r(),_N().catch(()=>{})}),[e,r,n,a]),t});function wb(t){return e=>v.jsx(wN,{children:v.jsx(t,{...e})})}const bN=m.lazy(()=>Qa(()=>import("./ChatApplication-BTqDgBdS.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),EN=m.lazy(()=>Qa(()=>import("./EditorApplication-xfFljTgE.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([13,1,2,8,9,10]))),SN=m.lazy(()=>Qa(()=>import("./VSLiteApplication-C2ncasre.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([14,1,2,8,9,10,15])));function xN(){var r;const t=Vr(n=>n.currentSession),e=m.useMemo(()=>{var n,a;if(!(t!=null&&t.id))return v.jsx(eo,{simple:!0,className:"w-full h-full"});if(t.main_source_type==="Thread")return v.jsx(bN,{});if(((n=t.main_node)==null?void 0:n.node_type)==="EDITOR_APP")return v.jsx(EN,{});if(((a=t.main_node)==null?void 0:a.node_type)==="VSLITE_APP")return v.jsx(SN,{})},[t==null?void 0:t.id,t==null?void 0:t.main_source_type,(r=t==null?void 0:t.main_node)==null?void 0:r.node_type]);return v.jsx(m.Suspense,{fallback:v.jsx(eo,{flickeringGrid:!0,className:"w-full h-full"}),children:e})}const kN=wb(xN),TN=m.lazy(()=>Qa(()=>import("./Home-4HtxotAA.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([16,1,2,7,4,8,9,10,5,6,17,18,15]))),AN=()=>v.jsx(m.Suspense,{fallback:v.jsx(eo,{flickeringGrid:!0,className:"w-full h-full"}),children:v.jsx(TN,{})}),MN=wb(AN),RN=m.lazy(()=>Qa(()=>import("./DocumentViewer-DvcwPXYH.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([19,1,2,20]))),FN=()=>{const{documentId:t}=Uf();return v.jsx(m.Suspense,{fallback:v.jsx(eo,{flickeringGrid:!0,className:"w-full h-full"}),children:v.jsx(RN,{name:t||""})})},NN=m.lazy(()=>Qa(()=>import("./SessionList-2QkCZMrZ.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([21,1,2,18,11,12]))),PN=()=>v.jsx(m.Suspense,{fallback:v.jsx(eo,{flickeringGrid:!0,className:"w-full h-full"}),children:v.jsx(NN,{})});function pi(){const t=zf();return Nl("[ERROR]",t),v.jsx(Ab,{})}const ON=mE(v.jsxs(Rr,{errorElement:v.jsx(pi,{}),children:[v.jsxs(Rr,{element:v.jsx(cv,{requiredSession:!0}),children:[v.jsx(Rr,{path:Pn.whiteboard,Component:MN,errorElement:v.jsx(pi,{})}),v.jsx(Rr,{path:Pn.application,errorElement:v.jsx(pi,{}),Component:kN}),v.jsx(Rr,{path:"*",element:v.jsx(hE,{to:Pn.sessions})})]}),v.jsxs(Rr,{element:v.jsx(cv,{}),children:[v.jsx(Rr,{path:Pn.document,errorElement:v.jsx(pi,{}),Component:FN}),v.jsx(Rr,{path:Pn.sessions,errorElement:v.jsx(pi,{}),Component:PN})]})]})),IN=(t,e)=>{switch(Ug){case"browser":return Kf(t,e);case"hash":return $E(t);default:return Kf(t,e)}},CN=IN(ON,{basename:"/NoLLMChat/"});Mb("[BASE_URL]","/NoLLMChat/");let bb;bb=m.memo(()=>{const t=!window.location.pathname.includes("/NoLLMChat/");return m.useLayoutEffect(()=>{t&&(window.location.href="/NoLLMChat/".replace("//","/"))},[t]),t?v.jsx(eo,{className:"w-screen h-screen",simple:!0}):v.jsx(KE,{router:CN})},()=>!0),Yb=Object.freeze(Object.defineProperty({__proto__:null,default:bb},Symbol.toStringTag,{value:"Module"}))});export{Vh as $,Qn as A,Wr as B,to as C,ro as D,ea as E,Be as F,no as G,ao as H,qh as I,Pl as J,Ol as K,Zh as L,Dt as M,Jh as N,oo as O,Il as P,Kh as Q,Cl as R,Mi as S,Rb as T,Yh as U,Gr as V,Fb as W,Xh as X,Qh as Y,ep as Z,tp as _,tP as __tla,io as a,rp as a$,np as a0,ap as a1,jl as a2,$t as a3,op as a4,Ll as a5,ip as a6,sp as a7,Dl as a8,$l as a9,Nb as aA,lp as aB,cr as aC,Ri as aD,ta as aE,Pb as aF,Et as aG,so as aH,at as aI,cp as aJ,dp as aK,Fi as aL,up as aM,Ni as aN,ot as aO,hp as aP,_n as aQ,pp as aR,Ul as aS,lo as aT,zl as aU,Pi as aV,Oi as aW,Bl as aX,Hl as aY,Ii as aZ,Ob as a_,Ut as aa,co as ab,fp as ac,Wl as ad,mp as ae,gp as af,yp as ag,vp as ah,_p as ai,wp as aj,bp as ak,Ep as al,Sp as am,xp as an,kp as ao,Tp as ap,Ap as aq,Mp as ar,Rp as as,Gl as at,Vl as au,Fp as av,ql as aw,Ci as ax,ji as ay,Zl as az,Np as b,Jl as b$,Ib as b0,Cb as b1,Pp as b2,Op as b3,Ip as b4,Cp as b5,jb as b6,wn as b7,Lb as b8,Db as b9,uo as bA,Kl as bB,Yl as bC,Xl as bD,Ql as bE,jp as bF,ec as bG,zt as bH,Lp as bI,Dp as bJ,$p as bK,tc as bL,Up as bM,zp as bN,Bp as bO,rc as bP,Hp as bQ,$b as bR,nc as bS,ac as bT,oc as bU,Wp as bV,ic as bW,sc as bX,lc as bY,cc as bZ,dc as b_,bn as ba,Gp as bb,Li as bc,Ub as bd,zb as be,Pe as bf,Vp as bg,ho as bh,dr as bi,Bt as bj,qp as bk,Zp as bl,Bb as bm,Jp as bn,Di as bo,En as bp,Hb as bq,Kp as br,uc as bs,Wb as bt,po as bu,ra as bv,Gb as bw,hc as bx,Vb as by,K as bz,qb as c,Yp as c0,Xp as c1,Zb as c2,Qp as c3,ef as c4,tf as c5,Jb as c6,pc as c7,Kb as c8,Ie as c9,rf as ca,nf as cb,af as cc,$i as cd,na as ce,of as cf,Yb as cg,fc as d,mc as e,aa as f,He as g,oa as h,Sn as i,sf as j,gc as k,yc as l,lf as m,xn as n,Ui as o,gt as p,cf as q,vc as r,_c as s,wc as t,Vr as u,bc as v,Ec as w,Sc as x,zi as y,fo as z};
