import{r as M,M as ZO,j as E,F as Mf,as as YO,H as XO,at as GO,aj as Je,a0 as KO,m as JO,au as gn,av as e3,aw as t3,ax as Ef,ay as Cf,X as ke,az as n3,y as Ae,a3 as xt,s as Ps,aq as _f,g as Ne,L as vi,p as r3,h as i3,q as Sf,Z as ks,__tla as o3}from"./index-D4Spz8xS.js";import{W as $t,__tla as s3}from"./routes-CKz-qo7F.js";let Ts,js,Of,Af,Nf,Rs,Is,$s,xn,bi,Bs,Ls,Ds,zs,wi,vn,re,Mi,Fs,Ei,Ci,_i,Si,rr,Oi,ir,Vs,Bt,Lt,qs,or,sr,vt,Ze,Ai,Ws,Hs,Us,Pf,Ni,Pi,Qs,Zs,bn,Dt,ar,ki,Ys,Xs,Gs,kf,Tf,cr,de,ge,jf,Rf,wn,If,lr,bt,$f,wt,Bf,dt,Lf,Df,Ks,Ti,Js,ea,ji,ta,na,Ri,ra,ia,Ii,$i,oa,sa,aa,zf,ca,et,Ff,Vf,ur,qf,Wf,la,ua,Hf,Fe,Bi,Uf,Qf,dr,hr,Zf,tt,zt,a3=Promise.all([(()=>{try{return o3}catch{}})(),(()=>{try{return s3}catch{}})()]).then(async()=>{Ds=(t=>(t.Started="started",t.Downloading="downloading",t.Downloaded="downloaded",t.Loading="loading",t.Loaded="loaded",t))(Ds||{}),ca=(t=>(t.LLM="LLM",t.embedding="embedding",t.VLM="VLM",t))(ca||{}),aa=(t=>(t.WebLLM="WebLLM",t.OpenAI="OpenAI",t))(aa||{}),Is=(t=>(t.VECTOR_DATABASE_RETREIVER="VECTOR_DATABASE_RETREIVER",t))(Is||{});class Yf extends M.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Xf({children:t,isPresent:e}){const n=M.useId(),r=M.useRef(null),i=M.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=M.useContext(ZO);return M.useInsertionEffect(()=>{const{width:s,height:a,top:c,left:l}=i.current;if(e||!r.current||!s||!a)return;r.current.dataset.motionPopId=n;const u=document.createElement("style");return o&&(u.nonce=o),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${s}px !important;
            height: ${a}px !important;
            top: ${c}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[e]),E.jsx(Yf,{isPresent:e,childRef:r,sizeRef:i,children:M.cloneElement(t,{ref:r})})}const Gf=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:o,mode:s})=>{const a=Mf(Kf),c=M.useId(),l=M.useCallback(d=>{a.set(d,!0);for(const h of a.values())if(!h)return;r&&r()},[a,r]),u=M.useMemo(()=>({id:c,initial:e,isPresent:n,custom:i,onExitComplete:l,register:d=>(a.set(d,!1),()=>a.delete(d))}),o?[Math.random(),l]:[n,l]);return M.useMemo(()=>{a.forEach((d,h)=>a.set(h,!1))},[n]),M.useEffect(()=>{!n&&!a.size&&r&&r()},[n]),s==="popLayout"&&(t=E.jsx(Xf,{isPresent:n,children:t})),E.jsx(YO.Provider,{value:u,children:t})};function Kf(){return new Map}const pr=t=>t.key||"";function da(t){const e=[];return M.Children.forEach(t,n=>{M.isValidElement(n)&&e.push(n)}),e}const Jf=({children:t,exitBeforeEnter:e,custom:n,initial:r=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:s="sync"})=>{const a=M.useMemo(()=>da(t),[t]),c=a.map(pr),l=M.useRef(!0),u=M.useRef(a),d=Mf(()=>new Map),[h,p]=M.useState(a),[m,f]=M.useState(a);XO(()=>{l.current=!1,u.current=a;for(let b=0;b<m.length;b++){const x=pr(m[b]);c.includes(x)?d.delete(x):d.get(x)!==!0&&d.set(x,!1)}},[m,c.length,c.join("-")]);const y=[];if(a!==h){let b=[...a];for(let x=0;x<m.length;x++){const v=m[x],C=pr(v);c.includes(C)||(b.splice(x,0,v),y.push(v))}s==="wait"&&y.length&&(b=y),f(da(b)),p(a);return}const{forceRender:g}=M.useContext(GO);return E.jsx(E.Fragment,{children:m.map(b=>{const x=pr(b),v=a===m||c.includes(x),C=()=>{if(d.has(x))d.set(x,!0);else return;let T=!0;d.forEach(S=>{S||(T=!1)}),T&&(g==null||g(),f(u.current),i&&i())};return E.jsx(Gf,{isPresent:v,initial:!l.current||r?void 0:!1,custom:v?void 0:n,presenceAffectsLayout:o,mode:s,onExitComplete:v?void 0:C,children:b},x)})})};function _e(t){if(typeof t=="string"||typeof t=="number")return""+t;let e="";if(Array.isArray(t))for(let n=0,r;n<t.length;n++)(r=_e(t[n]))!==""&&(e+=(e&&" ")+r);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}var em={value:()=>{}};function fr(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new mr(n)}function mr(t){this._=t}function tm(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}mr.prototype=fr.prototype={constructor:mr,on:function(t,e){var n=this._,r=tm(t+"",n),i,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((i=(t=r[o]).type)&&(i=nm(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(t=r[o]).type)n[i]=ha(n[i],t.name,e);else if(e==null)for(i in n)n[i]=ha(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new mr(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function nm(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function ha(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=em,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Li="http://www.w3.org/1999/xhtml";const pa={svg:"http://www.w3.org/2000/svg",xhtml:Li,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function yr(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),pa.hasOwnProperty(e)?{space:pa[e],local:t}:t}function rm(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Li&&e.documentElement.namespaceURI===Li?e.createElement(t):e.createElementNS(n,t)}}function im(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function fa(t){var e=yr(t);return(e.local?im:rm)(e)}function om(){}function Di(t){return t==null?om:function(){return this.querySelector(t)}}function sm(t){typeof t!="function"&&(t=Di(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=new Array(s),c,l,u=0;u<s;++u)(c=o[u])&&(l=t.call(c,c.__data__,u,o))&&("__data__"in c&&(l.__data__=c.__data__),a[u]=l);return new Le(r,this._parents)}function am(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function cm(){return[]}function ma(t){return t==null?cm:function(){return this.querySelectorAll(t)}}function lm(t){return function(){return am(t.apply(this,arguments))}}function um(t){typeof t=="function"?t=lm(t):t=ma(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var s=e[o],a=s.length,c,l=0;l<a;++l)(c=s[l])&&(r.push(t.call(c,c.__data__,l,s)),i.push(c));return new Le(r,i)}function ya(t){return function(){return this.matches(t)}}function ga(t){return function(e){return e.matches(t)}}var dm=Array.prototype.find;function hm(t){return function(){return dm.call(this.children,t)}}function pm(){return this.firstElementChild}function fm(t){return this.select(t==null?pm:hm(typeof t=="function"?t:ga(t)))}var mm=Array.prototype.filter;function ym(){return Array.from(this.children)}function gm(t){return function(){return mm.call(this.children,t)}}function xm(t){return this.selectAll(t==null?ym:gm(typeof t=="function"?t:ga(t)))}function vm(t){typeof t!="function"&&(t=ya(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],c,l=0;l<s;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&a.push(c);return new Le(r,this._parents)}function xa(t){return new Array(t.length)}function bm(){return new Le(this._enter||this._groups.map(xa),this._parents)}function gr(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}gr.prototype={constructor:gr,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function wm(t){return function(){return t}}function Mm(t,e,n,r,i,o){for(var s=0,a,c=e.length,l=o.length;s<l;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new gr(t,o[s]);for(;s<c;++s)(a=e[s])&&(i[s]=a)}function Em(t,e,n,r,i,o,s){var a,c,l=new Map,u=e.length,d=o.length,h=new Array(u),p;for(a=0;a<u;++a)(c=e[a])&&(h[a]=p=s.call(c,c.__data__,a,e)+"",l.has(p)?i[a]=c:l.set(p,c));for(a=0;a<d;++a)p=s.call(t,o[a],a,o)+"",(c=l.get(p))?(r[a]=c,c.__data__=o[a],l.delete(p)):n[a]=new gr(t,o[a]);for(a=0;a<u;++a)(c=e[a])&&l.get(h[a])===c&&(i[a]=c)}function Cm(t){return t.__data__}function _m(t,e){if(!arguments.length)return Array.from(this,Cm);var n=e?Em:Mm,r=this._parents,i=this._groups;typeof t!="function"&&(t=wm(t));for(var o=i.length,s=new Array(o),a=new Array(o),c=new Array(o),l=0;l<o;++l){var u=r[l],d=i[l],h=d.length,p=Sm(t.call(u,u&&u.__data__,l,r)),m=p.length,f=a[l]=new Array(m),y=s[l]=new Array(m),g=c[l]=new Array(h);n(u,d,f,y,g,p,e);for(var b=0,x=0,v,C;b<m;++b)if(v=f[b]){for(b>=x&&(x=b+1);!(C=y[x])&&++x<m;);v._next=C||null}}return s=new Le(s,r),s._enter=a,s._exit=c,s}function Sm(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Om(){return new Le(this._exit||this._groups.map(xa),this._parents)}function Am(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function Nm(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),c=0;c<s;++c)for(var l=n[c],u=r[c],d=l.length,h=a[c]=new Array(d),p,m=0;m<d;++m)(p=l[m]||u[m])&&(h[m]=p);for(;c<i;++c)a[c]=n[c];return new Le(a,this._parents)}function Pm(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],s;--i>=0;)(s=r[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function km(t){t||(t=Tm);function e(d,h){return d&&h?t(d.__data__,h.__data__):!d-!h}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s=n[o],a=s.length,c=i[o]=new Array(a),l,u=0;u<a;++u)(l=s[u])&&(c[u]=l);c.sort(e)}return new Le(i,this._parents).order()}function Tm(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function jm(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Rm(){return Array.from(this)}function Im(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null}function $m(){let t=0;for(const e of this)++t;return t}function Bm(){return!this.node()}function Lm(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,s=i.length,a;o<s;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this}function Dm(t){return function(){this.removeAttribute(t)}}function zm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Fm(t,e){return function(){this.setAttribute(t,e)}}function Vm(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function qm(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Wm(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Hm(t,e){var n=yr(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?zm:Dm:typeof e=="function"?n.local?Wm:qm:n.local?Vm:Fm)(n,e))}function va(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Um(t){return function(){this.style.removeProperty(t)}}function Qm(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Zm(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ym(t,e,n){return arguments.length>1?this.each((e==null?Um:typeof e=="function"?Zm:Qm)(t,e,n??"")):Ft(this.node(),t)}function Ft(t,e){return t.style.getPropertyValue(e)||va(t).getComputedStyle(t,null).getPropertyValue(e)}function Xm(t){return function(){delete this[t]}}function Gm(t,e){return function(){this[t]=e}}function Km(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Jm(t,e){return arguments.length>1?this.each((e==null?Xm:typeof e=="function"?Km:Gm)(t,e)):this.node()[t]}function ba(t){return t.trim().split(/^|\s+/)}function zi(t){return t.classList||new wa(t)}function wa(t){this._node=t,this._names=ba(t.getAttribute("class")||"")}wa.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Ma(t,e){for(var n=zi(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Ea(t,e){for(var n=zi(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function ey(t){return function(){Ma(this,t)}}function ty(t){return function(){Ea(this,t)}}function ny(t,e){return function(){(e.apply(this,arguments)?Ma:Ea)(this,t)}}function ry(t,e){var n=ba(t+"");if(arguments.length<2){for(var r=zi(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?ny:e?ey:ty)(n,e))}function iy(){this.textContent=""}function oy(t){return function(){this.textContent=t}}function sy(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ay(t){return arguments.length?this.each(t==null?iy:(typeof t=="function"?sy:oy)(t)):this.node().textContent}function cy(){this.innerHTML=""}function ly(t){return function(){this.innerHTML=t}}function uy(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function dy(t){return arguments.length?this.each(t==null?cy:(typeof t=="function"?uy:ly)(t)):this.node().innerHTML}function hy(){this.nextSibling&&this.parentNode.appendChild(this)}function py(){return this.each(hy)}function fy(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function my(){return this.each(fy)}function yy(t){var e=typeof t=="function"?t:fa(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function gy(){return null}function xy(t,e){var n=typeof t=="function"?t:fa(t),r=e==null?gy:typeof e=="function"?e:Di(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function vy(){var t=this.parentNode;t&&t.removeChild(this)}function by(){return this.each(vy)}function wy(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function My(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ey(t){return this.select(t?My:wy)}function Cy(t){return arguments.length?this.property("__data__",t):this.node().__data__}function _y(t){return function(e){t.call(this,e,this.__data__)}}function Sy(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Oy(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function Ay(t,e,n){return function(){var r=this.__on,i,o=_y(e);if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function Ny(t,e,n){var r=Sy(t+""),i,o=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,u;c<l;++c)for(i=0,u=a[c];i<o;++i)if((s=r[i]).type===u.type&&s.name===u.name)return u.value}return}for(a=e?Ay:Oy,i=0;i<o;++i)this.each(a(r[i],e,n));return this}function Ca(t,e,n){var r=va(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Py(t,e){return function(){return Ca(this,t,e)}}function ky(t,e){return function(){return Ca(this,t,e.apply(this,arguments))}}function Ty(t,e){return this.each((typeof e=="function"?ky:Py)(t,e))}function*jy(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,s;i<o;++i)(s=r[i])&&(yield s)}var _a=[null];function Le(t,e){this._groups=t,this._parents=e}function Mn(){return new Le([[document.documentElement]],_a)}function Ry(){return this}Le.prototype=Mn.prototype={constructor:Le,select:sm,selectAll:um,selectChild:fm,selectChildren:xm,filter:vm,data:_m,enter:bm,exit:Om,join:Am,merge:Nm,selection:Ry,order:Pm,sort:km,call:jm,nodes:Rm,node:Im,size:$m,empty:Bm,each:Lm,attr:Hm,style:Ym,property:Jm,classed:ry,text:ay,html:dy,raise:py,lower:my,append:yy,insert:xy,remove:by,clone:Ey,datum:Cy,on:Ny,dispatch:Ty,[Symbol.iterator]:jy};function De(t){return typeof t=="string"?new Le([[document.querySelector(t)]],[document.documentElement]):new Le([[t]],_a)}function Iy(t){let e;for(;e=t.sourceEvent;)t=e;return t}function qe(t,e){if(t=Iy(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const $y={passive:!1},En={capture:!0,passive:!1};function Fi(t){t.stopImmediatePropagation()}function Vt(t){t.preventDefault(),t.stopImmediatePropagation()}function Sa(t){var e=t.document.documentElement,n=De(t).on("dragstart.drag",Vt,En);"onselectstart"in e?n.on("selectstart.drag",Vt,En):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Oa(t,e){var n=t.document.documentElement,r=De(t).on("dragstart.drag",null);e&&(r.on("click.drag",Vt,En),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const xr=t=>()=>t;function Vi(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:s,y:a,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}Vi.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function By(t){return!t.ctrlKey&&!t.button}function Ly(){return this.parentNode}function Dy(t,e){return e??{x:t.x,y:t.y}}function zy(){return navigator.maxTouchPoints||"ontouchstart"in this}function Aa(){var t=By,e=Ly,n=Dy,r=zy,i={},o=fr("start","drag","end"),s=0,a,c,l,u,d=0;function h(v){v.on("mousedown.drag",p).filter(r).on("touchstart.drag",y).on("touchmove.drag",g,$y).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(v,C){if(!(u||!t.call(this,v,C))){var T=x(this,e.call(this,v,C),v,C,"mouse");T&&(De(v.view).on("mousemove.drag",m,En).on("mouseup.drag",f,En),Sa(v.view),Fi(v),l=!1,a=v.clientX,c=v.clientY,T("start",v))}}function m(v){if(Vt(v),!l){var C=v.clientX-a,T=v.clientY-c;l=C*C+T*T>d}i.mouse("drag",v)}function f(v){De(v.view).on("mousemove.drag mouseup.drag",null),Oa(v.view,l),Vt(v),i.mouse("end",v)}function y(v,C){if(t.call(this,v,C)){var T=v.changedTouches,S=e.call(this,v,C),j=T.length,$,B;for($=0;$<j;++$)(B=x(this,S,v,C,T[$].identifier,T[$]))&&(Fi(v),B("start",v,T[$]))}}function g(v){var C=v.changedTouches,T=C.length,S,j;for(S=0;S<T;++S)(j=i[C[S].identifier])&&(Vt(v),j("drag",v,C[S]))}function b(v){var C=v.changedTouches,T=C.length,S,j;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),S=0;S<T;++S)(j=i[C[S].identifier])&&(Fi(v),j("end",v,C[S]))}function x(v,C,T,S,j,$){var B=o.copy(),V=qe($||T,C),F,z,w;if((w=n.call(v,new Vi("beforestart",{sourceEvent:T,target:h,identifier:j,active:s,x:V[0],y:V[1],dx:0,dy:0,dispatch:B}),S))!=null)return F=w.x-V[0]||0,z=w.y-V[1]||0,function N(_,R,A){var P=V,L;switch(_){case"start":i[j]=N,L=s++;break;case"end":delete i[j],--s;case"drag":V=qe(A||R,C),L=s;break}B.call(_,v,new Vi(_,{sourceEvent:R,subject:w,target:h,identifier:j,active:L,x:V[0]+F,y:V[1]+z,dx:V[0]-P[0],dy:V[1]-P[1],dispatch:B}),S)}}return h.filter=function(v){return arguments.length?(t=typeof v=="function"?v:xr(!!v),h):t},h.container=function(v){return arguments.length?(e=typeof v=="function"?v:xr(v),h):e},h.subject=function(v){return arguments.length?(n=typeof v=="function"?v:xr(v),h):n},h.touchable=function(v){return arguments.length?(r=typeof v=="function"?v:xr(!!v),h):r},h.on=function(){var v=o.on.apply(o,arguments);return v===o?h:v},h.clickDistance=function(v){return arguments.length?(d=(v=+v)*v,h):Math.sqrt(d)},h}function qi(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Na(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Cn(){}var _n=.7,vr=1/_n,qt="\\s*([+-]?\\d+)\\s*",Sn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ye="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fy=/^#([0-9a-f]{3,8})$/,Vy=new RegExp(`^rgb\\(${qt},${qt},${qt}\\)$`),qy=new RegExp(`^rgb\\(${Ye},${Ye},${Ye}\\)$`),Wy=new RegExp(`^rgba\\(${qt},${qt},${qt},${Sn}\\)$`),Hy=new RegExp(`^rgba\\(${Ye},${Ye},${Ye},${Sn}\\)$`),Uy=new RegExp(`^hsl\\(${Sn},${Ye},${Ye}\\)$`),Qy=new RegExp(`^hsla\\(${Sn},${Ye},${Ye},${Sn}\\)$`),Pa={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};qi(Cn,Lt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:ka,formatHex:ka,formatHex8:Zy,formatHsl:Yy,formatRgb:Ta,toString:Ta});function ka(){return this.rgb().formatHex()}function Zy(){return this.rgb().formatHex8()}function Yy(){return Ba(this).formatHsl()}function Ta(){return this.rgb().formatRgb()}Lt=function(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Fy.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?ja(e):n===3?new $e(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?br(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?br(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Vy.exec(t))?new $e(e[1],e[2],e[3],1):(e=qy.exec(t))?new $e(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Wy.exec(t))?br(e[1],e[2],e[3],e[4]):(e=Hy.exec(t))?br(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Uy.exec(t))?$a(e[1],e[2]/100,e[3]/100,1):(e=Qy.exec(t))?$a(e[1],e[2]/100,e[3]/100,e[4]):Pa.hasOwnProperty(t)?ja(Pa[t]):t==="transparent"?new $e(NaN,NaN,NaN,0):null};function ja(t){return new $e(t>>16&255,t>>8&255,t&255,1)}function br(t,e,n,r){return r<=0&&(t=e=n=NaN),new $e(t,e,n,r)}function Xy(t){return t instanceof Cn||(t=Lt(t)),t?(t=t.rgb(),new $e(t.r,t.g,t.b,t.opacity)):new $e}function Wi(t,e,n,r){return arguments.length===1?Xy(t):new $e(t,e,n,r??1)}function $e(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}qi($e,Wi,Na(Cn,{brighter(t){return t=t==null?vr:Math.pow(vr,t),new $e(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?_n:Math.pow(_n,t),new $e(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new $e(Mt(this.r),Mt(this.g),Mt(this.b),wr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ra,formatHex:Ra,formatHex8:Gy,formatRgb:Ia,toString:Ia}));function Ra(){return`#${Et(this.r)}${Et(this.g)}${Et(this.b)}`}function Gy(){return`#${Et(this.r)}${Et(this.g)}${Et(this.b)}${Et((isNaN(this.opacity)?1:this.opacity)*255)}`}function Ia(){const t=wr(this.opacity);return`${t===1?"rgb(":"rgba("}${Mt(this.r)}, ${Mt(this.g)}, ${Mt(this.b)}${t===1?")":`, ${t})`}`}function wr(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Mt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Et(t){return t=Mt(t),(t<16?"0":"")+t.toString(16)}function $a(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new We(t,e,n,r)}function Ba(t){if(t instanceof We)return new We(t.h,t.s,t.l,t.opacity);if(t instanceof Cn||(t=Lt(t)),!t)return new We;if(t instanceof We)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,a=o-i,c=(o+i)/2;return a?(e===o?s=(n-r)/a+(n<r)*6:n===o?s=(r-e)/a+2:s=(e-n)/a+4,a/=c<.5?o+i:2-o-i,s*=60):a=c>0&&c<1?0:s,new We(s,a,c,t.opacity)}function Ky(t,e,n,r){return arguments.length===1?Ba(t):new We(t,e,n,r??1)}function We(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}qi(We,Ky,Na(Cn,{brighter(t){return t=t==null?vr:Math.pow(vr,t),new We(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?_n:Math.pow(_n,t),new We(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new $e(Hi(t>=240?t-240:t+120,i,r),Hi(t,i,r),Hi(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new We(La(this.h),Mr(this.s),Mr(this.l),wr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=wr(this.opacity);return`${t===1?"hsl(":"hsla("}${La(this.h)}, ${Mr(this.s)*100}%, ${Mr(this.l)*100}%${t===1?")":`, ${t})`}`}}));function La(t){return t=(t||0)%360,t<0?t+360:t}function Mr(t){return Math.max(0,Math.min(1,t||0))}function Hi(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}$i=t=>()=>t;function Jy(t,e){return function(n){return t+n*e}}function eg(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function tg(t){return(t=+t)==1?Da:function(e,n){return n-e?eg(e,n,t):$i(isNaN(e)?n:e)}}function Da(t,e){var n=e-t;return n?Jy(t,n):$i(isNaN(t)?e:t)}Ii=function t(e){var n=tg(e);function r(i,o){var s=n((i=Wi(i)).r,(o=Wi(o)).r),a=n(i.g,o.g),c=n(i.b,o.b),l=Da(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=c(u),i.opacity=l(u),i+""}}return r.gamma=t,r}(1),et=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}};var Ui=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qi=new RegExp(Ui.source,"g");function ng(t){return function(){return t}}function rg(t){return function(e){return t(e)+""}}oa=function(t,e){var n=Ui.lastIndex=Qi.lastIndex=0,r,i,o,s=-1,a=[],c=[];for(t=t+"",e=e+"";(r=Ui.exec(t))&&(i=Qi.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,c.push({i:s,x:et(r,i)})),n=Qi.lastIndex;return n<e.length&&(o=e.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?c[0]?rg(c[0].x):ng(e):(e=c.length,function(l){for(var u=0,d;u<e;++u)a[(d=c[u]).i]=d.x(l);return a.join("")})};var za=180/Math.PI,Fa={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Va(t,e,n,r,i,o){var s,a,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),t*r<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*za,skewX:Math.atan(c)*za,scaleX:s,scaleY:a}}var Er;function ig(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Fa:Va(e.a,e.b,e.c,e.d,e.e,e.f)}function og(t){return t==null||(Er||(Er=document.createElementNS("http://www.w3.org/2000/svg","g")),Er.setAttribute("transform",t),!(t=Er.transform.baseVal.consolidate()))?Fa:(t=t.matrix,Va(t.a,t.b,t.c,t.d,t.e,t.f))}function qa(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function o(l,u,d,h,p,m){if(l!==d||u!==h){var f=p.push("translate(",null,e,null,n);m.push({i:f-4,x:et(l,d)},{i:f-2,x:et(u,h)})}else(d||h)&&p.push("translate("+d+e+h+n)}function s(l,u,d,h){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),h.push({i:d.push(i(d)+"rotate(",null,r)-2,x:et(l,u)})):u&&d.push(i(d)+"rotate("+u+r)}function a(l,u,d,h){l!==u?h.push({i:d.push(i(d)+"skewX(",null,r)-2,x:et(l,u)}):u&&d.push(i(d)+"skewX("+u+r)}function c(l,u,d,h,p,m){if(l!==d||u!==h){var f=p.push(i(p)+"scale(",null,",",null,")");m.push({i:f-4,x:et(l,d)},{i:f-2,x:et(u,h)})}else(d!==1||h!==1)&&p.push(i(p)+"scale("+d+","+h+")")}return function(l,u){var d=[],h=[];return l=t(l),u=t(u),o(l.translateX,l.translateY,u.translateX,u.translateY,d,h),s(l.rotate,u.rotate,d,h),a(l.skewX,u.skewX,d,h),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,d,h),l=u=null,function(p){for(var m=-1,f=h.length,y;++m<f;)d[(y=h[m]).i]=y.x(p);return d.join("")}}}var sg=qa(ig,"px, ","px)","deg)"),ag=qa(og,", ",")",")"),cg=1e-12;function Wa(t){return((t=Math.exp(t))+1/t)/2}function lg(t){return((t=Math.exp(t))-1/t)/2}function ug(t){return((t=Math.exp(2*t))-1)/(t+1)}const dg=function t(e,n,r){function i(o,s){var a=o[0],c=o[1],l=o[2],u=s[0],d=s[1],h=s[2],p=u-a,m=d-c,f=p*p+m*m,y,g;if(f<cg)g=Math.log(h/l)/e,y=function(S){return[a+S*p,c+S*m,l*Math.exp(e*S*g)]};else{var b=Math.sqrt(f),x=(h*h-l*l+r*f)/(2*l*n*b),v=(h*h-l*l-r*f)/(2*h*n*b),C=Math.log(Math.sqrt(x*x+1)-x),T=Math.log(Math.sqrt(v*v+1)-v);g=(T-C)/e,y=function(S){var j=S*g,$=Wa(C),B=l/(n*b)*($*ug(e*j+C)-lg(C));return[a+B*p,c+B*m,l*$/Wa(e*j+C)]}}return y.duration=g*1e3*e/Math.SQRT2,y}return i.rho=function(o){var s=Math.max(.001,+o),a=s*s,c=a*a;return t(s,a,c)},i}(Math.SQRT2,2,4);var Wt=0,On=0,An=0,Ha=1e3,Cr,Nn,_r=0,Ct=0,Sr=0,Pn=typeof performance=="object"&&performance.now?performance:Date,Ua=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Zi(){return Ct||(Ua(hg),Ct=Pn.now()+Sr)}function hg(){Ct=0}function Or(){this._call=this._time=this._next=null}Or.prototype=Qa.prototype={constructor:Or,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Zi():+n)+(e==null?0:+e),!this._next&&Nn!==this&&(Nn?Nn._next=this:Cr=this,Nn=this),this._call=t,this._time=n,Yi()},stop:function(){this._call&&(this._call=null,this._time=1/0,Yi())}};function Qa(t,e,n){var r=new Or;return r.restart(t,e,n),r}function pg(){Zi(),++Wt;for(var t=Cr,e;t;)(e=Ct-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Wt}function Za(){Ct=(_r=Pn.now())+Sr,Wt=On=0;try{pg()}finally{Wt=0,mg(),Ct=0}}function fg(){var t=Pn.now(),e=t-_r;e>Ha&&(Sr-=e,_r=t)}function mg(){for(var t,e=Cr,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Cr=n);Nn=t,Yi(r)}function Yi(t){if(!Wt){On&&(On=clearTimeout(On));var e=t-Ct;e>24?(t<1/0&&(On=setTimeout(Za,t-Pn.now()-Sr)),An&&(An=clearInterval(An))):(An||(_r=Pn.now(),An=setInterval(fg,Ha)),Wt=1,Ua(Za))}}function Ya(t,e,n){var r=new Or;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var yg=fr("start","end","cancel","interrupt"),gg=[],Xa=0,Ga=1,Xi=2,Ar=3,Ka=4,Gi=5,Nr=6;function Pr(t,e,n,r,i,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;xg(t,n,{name:e,index:r,group:i,on:yg,tween:gg,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Xa})}function Ki(t,e){var n=He(t,e);if(n.state>Xa)throw new Error("too late; already scheduled");return n}function Xe(t,e){var n=He(t,e);if(n.state>Ar)throw new Error("too late; already running");return n}function He(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function xg(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Qa(o,0,n.time);function o(l){n.state=Ga,n.timer.restart(s,n.delay,n.time),n.delay<=l&&s(l-n.delay)}function s(l){var u,d,h,p;if(n.state!==Ga)return c();for(u in r)if(p=r[u],p.name===n.name){if(p.state===Ar)return Ya(s);p.state===Ka?(p.state=Nr,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[u]):+u<e&&(p.state=Nr,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[u])}if(Ya(function(){n.state===Ar&&(n.state=Ka,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=Xi,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Xi){for(n.state=Ar,i=new Array(h=n.tween.length),u=0,d=-1;u<h;++u)(p=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(i[++d]=p);i.length=d+1}}function a(l){for(var u=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=Gi,1),d=-1,h=i.length;++d<h;)i[d].call(t,u);n.state===Gi&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=Nr,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function kr(t,e){var n=t.__transition,r,i,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){o=!1;continue}i=r.state>Xi&&r.state<Gi,r.state=Nr,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}o&&delete t.__transition}}function vg(t){return this.each(function(){kr(this,t)})}function bg(t,e){var n,r;return function(){var i=Xe(this,t),o=i.tween;if(o!==n){r=n=o;for(var s=0,a=r.length;s<a;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function wg(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=Xe(this,t),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:e,value:n},c=0,l=i.length;c<l;++c)if(i[c].name===e){i[c]=a;break}c===l&&i.push(a)}o.tween=i}}function Mg(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=He(this.node(),n).tween,i=0,o=r.length,s;i<o;++i)if((s=r[i]).name===t)return s.value;return null}return this.each((e==null?bg:wg)(n,t,e))}function Ji(t,e,n){var r=t._id;return t.each(function(){var i=Xe(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return He(i,r).value[e]}}function Ja(t,e){var n;return(typeof e=="number"?et:e instanceof Lt?Ii:(n=Lt(e))?(e=n,Ii):oa)(t,e)}function Eg(t){return function(){this.removeAttribute(t)}}function Cg(t){return function(){this.removeAttributeNS(t.space,t.local)}}function _g(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttribute(t);return s===i?null:s===r?o:o=e(r=s,n)}}function Sg(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===r?o:o=e(r=s,n)}}function Og(t,e,n){var r,i,o;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=a+"",s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a)))}}function Ag(t,e,n){var r,i,o;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=a+"",s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a)))}}function Ng(t,e){var n=yr(t),r=n==="transform"?ag:Ja;return this.attrTween(t,typeof e=="function"?(n.local?Ag:Og)(n,r,Ji(this,"attr."+t,e)):e==null?(n.local?Cg:Eg)(n):(n.local?Sg:_g)(n,r,e))}function Pg(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function kg(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Tg(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&kg(t,o)),n}return i._value=e,i}function jg(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&Pg(t,o)),n}return i._value=e,i}function Rg(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=yr(t);return this.tween(n,(r.local?Tg:jg)(r,e))}function Ig(t,e){return function(){Ki(this,t).delay=+e.apply(this,arguments)}}function $g(t,e){return e=+e,function(){Ki(this,t).delay=e}}function Bg(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Ig:$g)(e,t)):He(this.node(),e).delay}function Lg(t,e){return function(){Xe(this,t).duration=+e.apply(this,arguments)}}function Dg(t,e){return e=+e,function(){Xe(this,t).duration=e}}function zg(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Lg:Dg)(e,t)):He(this.node(),e).duration}function Fg(t,e){if(typeof e!="function")throw new Error;return function(){Xe(this,t).ease=e}}function Vg(t){var e=this._id;return arguments.length?this.each(Fg(e,t)):He(this.node(),e).ease}function qg(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Xe(this,t).ease=n}}function Wg(t){if(typeof t!="function")throw new Error;return this.each(qg(this._id,t))}function Hg(t){typeof t!="function"&&(t=ya(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],c,l=0;l<s;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&a.push(c);return new nt(r,this._parents,this._name,this._id)}function Ug(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var c=e[a],l=n[a],u=c.length,d=s[a]=new Array(u),h,p=0;p<u;++p)(h=c[p]||l[p])&&(d[p]=h);for(;a<r;++a)s[a]=e[a];return new nt(s,this._parents,this._name,this._id)}function Qg(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Zg(t,e,n){var r,i,o=Qg(e)?Ki:Xe;return function(){var s=o(this,t),a=s.on;a!==r&&(i=(r=a).copy()).on(e,n),s.on=i}}function Yg(t,e){var n=this._id;return arguments.length<2?He(this.node(),n).on.on(t):this.each(Zg(n,t,e))}function Xg(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Gg(){return this.on("end.remove",Xg(this._id))}function Kg(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Di(t));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a=r[s],c=a.length,l=o[s]=new Array(c),u,d,h=0;h<c;++h)(u=a[h])&&(d=t.call(u,u.__data__,h,a))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d,Pr(l[h],e,n,h,l,He(u,n)));return new nt(o,this._parents,e,n)}function Jg(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ma(t));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var c=r[a],l=c.length,u,d=0;d<l;++d)if(u=c[d]){for(var h=t.call(u,u.__data__,d,c),p,m=He(u,n),f=0,y=h.length;f<y;++f)(p=h[f])&&Pr(p,e,n,f,h,m);o.push(h),s.push(u)}return new nt(o,s,e,n)}var e0=Mn.prototype.constructor;function t0(){return new e0(this._groups,this._parents)}function n0(t,e){var n,r,i;return function(){var o=Ft(this,t),s=(this.style.removeProperty(t),Ft(this,t));return o===s?null:o===n&&s===r?i:i=e(n=o,r=s)}}function ec(t){return function(){this.style.removeProperty(t)}}function r0(t,e,n){var r,i=n+"",o;return function(){var s=Ft(this,t);return s===i?null:s===r?o:o=e(r=s,n)}}function i0(t,e,n){var r,i,o;return function(){var s=Ft(this,t),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(t),Ft(this,t))),s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a))}}function o0(t,e){var n,r,i,o="style."+e,s="end."+o,a;return function(){var c=Xe(this,t),l=c.on,u=c.value[o]==null?a||(a=ec(e)):void 0;(l!==n||i!==u)&&(r=(n=l).copy()).on(s,i=u),c.on=r}}function s0(t,e,n){var r=(t+="")=="transform"?sg:Ja;return e==null?this.styleTween(t,n0(t,r)).on("end.style."+t,ec(t)):typeof e=="function"?this.styleTween(t,i0(t,r,Ji(this,"style."+t,e))).each(o0(this._id,t)):this.styleTween(t,r0(t,r,e),n).on("end.style."+t,null)}function a0(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function c0(t,e,n){var r,i;function o(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&a0(t,s,n)),r}return o._value=e,o}function l0(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,c0(t,e,n??""))}function u0(t){return function(){this.textContent=t}}function d0(t){return function(){var e=t(this);this.textContent=e??""}}function h0(t){return this.tween("text",typeof t=="function"?d0(Ji(this,"text",t)):u0(t==null?"":t+""))}function p0(t){return function(e){this.textContent=t.call(this,e)}}function f0(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&p0(i)),e}return r._value=t,r}function m0(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,f0(t))}function y0(){for(var t=this._name,e=this._id,n=tc(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,c,l=0;l<a;++l)if(c=s[l]){var u=He(c,e);Pr(c,t,n,l,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new nt(r,this._parents,t,n)}function g0(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},c={value:function(){--i===0&&o()}};n.each(function(){var l=Xe(this,r),u=l.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(c)),l.on=e}),i===0&&o()})}var x0=0;function nt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function tc(){return++x0}var rt=Mn.prototype;nt.prototype={constructor:nt,select:Kg,selectAll:Jg,selectChild:rt.selectChild,selectChildren:rt.selectChildren,filter:Hg,merge:Ug,selection:t0,transition:y0,call:rt.call,nodes:rt.nodes,node:rt.node,size:rt.size,empty:rt.empty,each:rt.each,on:Yg,attr:Ng,attrTween:Rg,style:s0,styleTween:l0,text:h0,textTween:m0,remove:Gg,tween:Mg,delay:Bg,duration:zg,ease:Vg,easeVarying:Wg,end:g0,[Symbol.iterator]:rt[Symbol.iterator]};function v0(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var b0={time:null,delay:0,duration:250,ease:v0};function w0(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function M0(t){var e,n;t instanceof nt?(e=t._id,t=t._name):(e=tc(),(n=b0).time=Zi(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,c,l=0;l<a;++l)(c=s[l])&&Pr(c,t,e,l,s,n||w0(c,e));return new nt(r,this._parents,t,e)}Mn.prototype.interrupt=vg,Mn.prototype.transition=M0;const Tr=t=>()=>t;function E0(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function it(t,e,n){this.k=t,this.x=e,this.y=n}it.prototype={constructor:it,scale:function(t){return t===1?this:new it(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new it(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var jr=new it(1,0,0);nc.prototype=it.prototype;function nc(t){for(;!t.__zoom;)if(!(t=t.parentNode))return jr;return t.__zoom}function eo(t){t.stopImmediatePropagation()}function kn(t){t.preventDefault(),t.stopImmediatePropagation()}function C0(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function _0(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function rc(){return this.__zoom||jr}function S0(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function O0(){return navigator.maxTouchPoints||"ontouchstart"in this}function A0(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function ic(){var t=C0,e=_0,n=A0,r=S0,i=O0,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,c=dg,l=fr("start","zoom","end"),u,d,h,p=500,m=150,f=0,y=10;function g(w){w.property("__zoom",rc).on("wheel.zoom",j,{passive:!1}).on("mousedown.zoom",$).on("dblclick.zoom",B).filter(i).on("touchstart.zoom",V).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(w,N,_,R){var A=w.selection?w.selection():w;A.property("__zoom",rc),w!==A?C(w,N,_,R):A.interrupt().each(function(){T(this,arguments).event(R).start().zoom(null,typeof N=="function"?N.apply(this,arguments):N).end()})},g.scaleBy=function(w,N,_,R){g.scaleTo(w,function(){var A=this.__zoom.k,P=typeof N=="function"?N.apply(this,arguments):N;return A*P},_,R)},g.scaleTo=function(w,N,_,R){g.transform(w,function(){var A=e.apply(this,arguments),P=this.__zoom,L=_==null?v(A):typeof _=="function"?_.apply(this,arguments):_,W=P.invert(L),I=typeof N=="function"?N.apply(this,arguments):N;return n(x(b(P,I),L,W),A,s)},_,R)},g.translateBy=function(w,N,_,R){g.transform(w,function(){return n(this.__zoom.translate(typeof N=="function"?N.apply(this,arguments):N,typeof _=="function"?_.apply(this,arguments):_),e.apply(this,arguments),s)},null,R)},g.translateTo=function(w,N,_,R,A){g.transform(w,function(){var P=e.apply(this,arguments),L=this.__zoom,W=R==null?v(P):typeof R=="function"?R.apply(this,arguments):R;return n(jr.translate(W[0],W[1]).scale(L.k).translate(typeof N=="function"?-N.apply(this,arguments):-N,typeof _=="function"?-_.apply(this,arguments):-_),P,s)},R,A)};function b(w,N){return N=Math.max(o[0],Math.min(o[1],N)),N===w.k?w:new it(N,w.x,w.y)}function x(w,N,_){var R=N[0]-_[0]*w.k,A=N[1]-_[1]*w.k;return R===w.x&&A===w.y?w:new it(w.k,R,A)}function v(w){return[(+w[0][0]+ +w[1][0])/2,(+w[0][1]+ +w[1][1])/2]}function C(w,N,_,R){w.on("start.zoom",function(){T(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(R).end()}).tween("zoom",function(){var A=this,P=arguments,L=T(A,P).event(R),W=e.apply(A,P),I=_==null?v(W):typeof _=="function"?_.apply(A,P):_,J=Math.max(W[1][0]-W[0][0],W[1][1]-W[0][1]),X=A.__zoom,q=typeof N=="function"?N.apply(A,P):N,ee=c(X.invert(I).concat(J/X.k),q.invert(I).concat(J/q.k));return function(ne){if(ne===1)ne=q;else{var H=ee(ne),ae=J/H[2];ne=new it(ae,I[0]-H[0]*ae,I[1]-H[1]*ae)}L.zoom(null,ne)}})}function T(w,N,_){return!_&&w.__zooming||new S(w,N)}function S(w,N){this.that=w,this.args=N,this.active=0,this.sourceEvent=null,this.extent=e.apply(w,N),this.taps=0}S.prototype={event:function(w){return w&&(this.sourceEvent=w),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(w,N){return this.mouse&&w!=="mouse"&&(this.mouse[1]=N.invert(this.mouse[0])),this.touch0&&w!=="touch"&&(this.touch0[1]=N.invert(this.touch0[0])),this.touch1&&w!=="touch"&&(this.touch1[1]=N.invert(this.touch1[0])),this.that.__zoom=N,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(w){var N=De(this.that).datum();l.call(w,this.that,new E0(w,{sourceEvent:this.sourceEvent,target:g,type:w,transform:this.that.__zoom,dispatch:l}),N)}};function j(w,...N){if(!t.apply(this,arguments))return;var _=T(this,N).event(w),R=this.__zoom,A=Math.max(o[0],Math.min(o[1],R.k*Math.pow(2,r.apply(this,arguments)))),P=qe(w);if(_.wheel)(_.mouse[0][0]!==P[0]||_.mouse[0][1]!==P[1])&&(_.mouse[1]=R.invert(_.mouse[0]=P)),clearTimeout(_.wheel);else{if(R.k===A)return;_.mouse=[P,R.invert(P)],kr(this),_.start()}kn(w),_.wheel=setTimeout(L,m),_.zoom("mouse",n(x(b(R,A),_.mouse[0],_.mouse[1]),_.extent,s));function L(){_.wheel=null,_.end()}}function $(w,...N){if(h||!t.apply(this,arguments))return;var _=w.currentTarget,R=T(this,N,!0).event(w),A=De(w.view).on("mousemove.zoom",I,!0).on("mouseup.zoom",J,!0),P=qe(w,_),L=w.clientX,W=w.clientY;Sa(w.view),eo(w),R.mouse=[P,this.__zoom.invert(P)],kr(this),R.start();function I(X){if(kn(X),!R.moved){var q=X.clientX-L,ee=X.clientY-W;R.moved=q*q+ee*ee>f}R.event(X).zoom("mouse",n(x(R.that.__zoom,R.mouse[0]=qe(X,_),R.mouse[1]),R.extent,s))}function J(X){A.on("mousemove.zoom mouseup.zoom",null),Oa(X.view,R.moved),kn(X),R.event(X).end()}}function B(w,...N){if(t.apply(this,arguments)){var _=this.__zoom,R=qe(w.changedTouches?w.changedTouches[0]:w,this),A=_.invert(R),P=_.k*(w.shiftKey?.5:2),L=n(x(b(_,P),R,A),e.apply(this,N),s);kn(w),a>0?De(this).transition().duration(a).call(C,L,R,w):De(this).call(g.transform,L,R,w)}}function V(w,...N){if(t.apply(this,arguments)){var _=w.touches,R=_.length,A=T(this,N,w.changedTouches.length===R).event(w),P,L,W,I;for(eo(w),L=0;L<R;++L)W=_[L],I=qe(W,this),I=[I,this.__zoom.invert(I),W.identifier],A.touch0?!A.touch1&&A.touch0[2]!==I[2]&&(A.touch1=I,A.taps=0):(A.touch0=I,P=!0,A.taps=1+!!u);u&&(u=clearTimeout(u)),P&&(A.taps<2&&(d=I[0],u=setTimeout(function(){u=null},p)),kr(this),A.start())}}function F(w,...N){if(this.__zooming){var _=T(this,N).event(w),R=w.changedTouches,A=R.length,P,L,W,I;for(kn(w),P=0;P<A;++P)L=R[P],W=qe(L,this),_.touch0&&_.touch0[2]===L.identifier?_.touch0[0]=W:_.touch1&&_.touch1[2]===L.identifier&&(_.touch1[0]=W);if(L=_.that.__zoom,_.touch1){var J=_.touch0[0],X=_.touch0[1],q=_.touch1[0],ee=_.touch1[1],ne=(ne=q[0]-J[0])*ne+(ne=q[1]-J[1])*ne,H=(H=ee[0]-X[0])*H+(H=ee[1]-X[1])*H;L=b(L,Math.sqrt(ne/H)),W=[(J[0]+q[0])/2,(J[1]+q[1])/2],I=[(X[0]+ee[0])/2,(X[1]+ee[1])/2]}else if(_.touch0)W=_.touch0[0],I=_.touch0[1];else return;_.zoom("touch",n(x(L,W,I),_.extent,s))}}function z(w,...N){if(this.__zooming){var _=T(this,N).event(w),R=w.changedTouches,A=R.length,P,L;for(eo(w),h&&clearTimeout(h),h=setTimeout(function(){h=null},p),P=0;P<A;++P)L=R[P],_.touch0&&_.touch0[2]===L.identifier?delete _.touch0:_.touch1&&_.touch1[2]===L.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(L=qe(L,this),Math.hypot(d[0]-L[0],d[1]-L[1])<y)){var W=De(this).on("dblclick.zoom");W&&W.apply(this,arguments)}}}return g.wheelDelta=function(w){return arguments.length?(r=typeof w=="function"?w:Tr(+w),g):r},g.filter=function(w){return arguments.length?(t=typeof w=="function"?w:Tr(!!w),g):t},g.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:Tr(!!w),g):i},g.extent=function(w){return arguments.length?(e=typeof w=="function"?w:Tr([[+w[0][0],+w[0][1]],[+w[1][0],+w[1][1]]]),g):e},g.scaleExtent=function(w){return arguments.length?(o[0]=+w[0],o[1]=+w[1],g):[o[0],o[1]]},g.translateExtent=function(w){return arguments.length?(s[0][0]=+w[0][0],s[1][0]=+w[1][0],s[0][1]=+w[0][1],s[1][1]=+w[1][1],g):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},g.constrain=function(w){return arguments.length?(n=w,g):n},g.duration=function(w){return arguments.length?(a=+w,g):a},g.interpolate=function(w){return arguments.length?(c=w,g):c},g.on=function(){var w=l.on.apply(l,arguments);return w===l?g:w},g.clickDistance=function(w){return arguments.length?(f=(w=+w)*w,g):Math.sqrt(f)},g.tapDistance=function(w){return arguments.length?(y=+w,g):y},g}const ot={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`},Tn=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],oc=["Enter"," ","Escape"];var Ht;(function(t){t.Strict="strict",t.Loose="loose"})(Ht||(Ht={})),function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"}(wt||(wt={}));var jn;(function(t){t.Partial="partial",t.Full="full"})(jn||(jn={}));const sc={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var ht;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(ht||(ht={}));var Rr;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(Rr||(Rr={})),function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"}(re||(re={}));const ac={[re.Left]:re.Right,[re.Right]:re.Left,[re.Top]:re.Bottom,[re.Bottom]:re.Top};function N0(t,e){if(!t&&!e)return!0;if(!t||!e||t.size!==e.size)return!1;if(!t.size&&!e.size)return!0;for(const n of t.keys())if(!e.has(n))return!1;return!0}function cc(t,e,n){if(!n)return;const r=[];t.forEach((i,o)=>{e!=null&&e.has(o)||r.push(i)}),r.length&&n(r)}function lc(t){return t===null?null:t?"valid":"invalid"}const uc=t=>"id"in t&&"source"in t&&"target"in t,P0=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),to=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),Rn=(t,e=[0,0])=>{const{width:n,height:r}=st(t),i=t.origin??e,o=n*i[0],s=r*i[1];return{x:t.position.x-o,y:t.position.y-s}},k0=(t,e={nodeOrigin:[0,0],nodeLookup:void 0})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,i)=>{const o=typeof i=="string";let s=!e.nodeLookup&&!o?i:void 0;e.nodeLookup&&(s=o?e.nodeLookup.get(i):to(i)?i:e.nodeLookup.get(i.id));const a=s?Br(s,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Ir(r,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return $r(n)},In=(t,e={})=>{if(t.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return t.forEach(r=>{if(e.filter===void 0||e.filter(r)){const i=Br(r);n=Ir(n,i)}}),$r(n)},dc=(t,e,[n,r,i]=[0,0,1],o=!1,s=!1)=>{const a={...Bn(e,[n,r,i]),width:e.width/i,height:e.height/i},c=[];for(const l of t.values()){const{measured:u,selectable:d=!0,hidden:h=!1}=l;if(s&&!d||h)continue;const p=u.width??l.width??l.initialWidth??null,m=u.height??l.height??l.initialHeight??null,f=$n(a,Qt(l)),y=(p??0)*(m??0),g=o&&f>0;(!l.internals.handleBounds||g||f>=y||l.dragging)&&c.push(l)}return c},T0=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function no(t,e){const n=new Map,r=e!=null&&e.nodes?new Set(e.nodes.map(i=>i.id)):null;return t.forEach(i=>{i.measured.width&&i.measured.height&&(e!=null&&e.includeHiddenNodes||!i.hidden)&&(!r||r.has(i.id))&&n.set(i.id,i)}),n}async function ro({nodes:t,width:e,height:n,panZoom:r,minZoom:i,maxZoom:o},s){if(t.size===0)return Promise.resolve(!1);const a=In(t),c=oo(a,e,n,(s==null?void 0:s.minZoom)??i,(s==null?void 0:s.maxZoom)??o,(s==null?void 0:s.padding)??.1);return await r.setViewport(c,{duration:s==null?void 0:s.duration}),Promise.resolve(!0)}function hc({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:i,onError:o}){const s=n.get(t),a=s.parentId?n.get(s.parentId):void 0,{x:c,y:l}=a?a.internals.positionAbsolute:{x:0,y:0},u=s.origin??r;let d=i;if(s.extent==="parent"&&!s.expandParent)if(!a)o==null||o("005",ot.error005());else{const p=a.measured.width,m=a.measured.height;p&&m&&(d=[[c,l],[c+p,l+m]])}else a&&Zt(s.extent)&&(d=[[s.extent[0][0]+c,s.extent[0][1]+l],[s.extent[1][0]+c,s.extent[1][1]+l]]);const h=Zt(d)?_t(e,d,s.measured):e;return{position:{x:h.x-c+s.measured.width*u[0],y:h.y-l+s.measured.height*u[1]},positionAbsolute:h}}async function j0({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:i}){const o=new Set(t.map(d=>d.id)),s=[];for(const d of n){if(d.deletable===!1)continue;const h=o.has(d.id),p=!h&&d.parentId&&s.find(m=>m.id===d.parentId);(h||p)&&s.push(d)}const a=new Set(e.map(d=>d.id)),c=r.filter(d=>d.deletable!==!1),l=T0(s,c);for(const d of c)a.has(d.id)&&!l.find(h=>h.id===d.id)&&l.push(d);if(!i)return{edges:l,nodes:s};const u=await i({nodes:s,edges:l});return typeof u=="boolean"?u?{edges:l,nodes:s}:{edges:[],nodes:[]}:u}const Ut=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),_t=(t={x:0,y:0},e,n)=>({x:Ut(t.x,e[0][0],e[1][0]-((n==null?void 0:n.width)??0)),y:Ut(t.y,e[0][1],e[1][1]-((n==null?void 0:n.height)??0))});function pc(t,e,n){const{width:r,height:i}=st(n),{x:o,y:s}=n.internals.positionAbsolute;return _t(t,[[o,s],[o+r,s+i]],e)}const fc=(t,e,n)=>t<e?Ut(Math.abs(t-e),1,e)/e:t>n?-Ut(Math.abs(t-n),1,e)/e:0,mc=(t,e,n=15,r=40)=>{const i=fc(t.x,r,e.width-r)*n,o=fc(t.y,r,e.height-r)*n;return[i,o]},Ir=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),io=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),$r=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),Qt=(t,e=[0,0])=>{var i,o;const{x:n,y:r}=to(t)?t.internals.positionAbsolute:Rn(t,e);return{x:n,y:r,width:((i=t.measured)==null?void 0:i.width)??t.width??t.initialWidth??0,height:((o=t.measured)==null?void 0:o.height)??t.height??t.initialHeight??0}},Br=(t,e=[0,0])=>{var i,o;const{x:n,y:r}=to(t)?t.internals.positionAbsolute:Rn(t,e);return{x:n,y:r,x2:n+(((i=t.measured)==null?void 0:i.width)??t.width??t.initialWidth??0),y2:r+(((o=t.measured)==null?void 0:o.height)??t.height??t.initialHeight??0)}},yc=(t,e)=>$r(Ir(io(t),io(e))),$n=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},gc=t=>Ue(t.width)&&Ue(t.height)&&Ue(t.x)&&Ue(t.y),Ue=t=>!isNaN(t)&&isFinite(t),R0=(t,e)=>{},Lr=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),Bn=({x:t,y:e},[n,r,i],o=!1,s=[1,1])=>{const a={x:(t-n)/i,y:(e-r)/i};return o?Lr(a,s):a},xc=({x:t,y:e},[n,r,i])=>({x:t*i+n,y:e*i+r}),oo=(t,e,n,r,i,o)=>{const s=e/(t.width*(1+o)),a=n/(t.height*(1+o)),c=Math.min(s,a),l=Ut(c,r,i),u=t.x+t.width/2,d=t.y+t.height/2,h=e/2-u*l,p=n/2-d*l;return{x:h,y:p,zoom:l}},Dr=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function Zt(t){return t!==void 0&&t!=="parent"}function st(t){var e,n;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight??0}}function vc(t){var e,n;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight)!==void 0}function bc(t,e={width:0,height:0},n,r,i){const o={...t},s=r.get(n);if(s){const a=s.origin||i;o.x+=s.internals.positionAbsolute.x-(e.width??0)*a[0],o.y+=s.internals.positionAbsolute.y-(e.height??0)*a[1]}return o}function Ln(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:i}){const{x:o,y:s}=at(t),a=Bn({x:o-((i==null?void 0:i.left)??0),y:s-((i==null?void 0:i.top)??0)},r),{x:c,y:l}=n?Lr(a,e):a;return{xSnapped:c,ySnapped:l,...a}}const zr=t=>({width:t.offsetWidth,height:t.offsetHeight}),wc=t=>{var e;return((e=t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},I0=["INPUT","SELECT","TEXTAREA"];function so(t){var n,r;const e=((r=(n=t.composedPath)==null?void 0:n.call(t))==null?void 0:r[0])||t.target;return I0.includes(e==null?void 0:e.nodeName)||(e==null?void 0:e.hasAttribute("contenteditable"))||!!(e!=null&&e.closest(".nokey"))}const Mc=t=>"clientX"in t,at=(t,e)=>{var o,s;const n=Mc(t),r=n?t.clientX:(o=t.touches)==null?void 0:o[0].clientX,i=n?t.clientY:(s=t.touches)==null?void 0:s[0].clientY;return{x:r-((e==null?void 0:e.left)??0),y:i-((e==null?void 0:e.top)??0)}},Ec=(t,e,n,r,i)=>{const o=e.querySelectorAll(`.${t}`);return!o||!o.length?null:Array.from(o).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:t,nodeId:i,position:s.getAttribute("data-handlepos"),x:(a.left-n.left)/r,y:(a.top-n.top)/r,...zr(s)}})};function Cc({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:i,sourceControlY:o,targetControlX:s,targetControlY:a}){const c=t*.125+i*.375+s*.375+n*.125,l=e*.125+o*.375+a*.375+r*.125,u=Math.abs(c-t),d=Math.abs(l-e);return[c,l,u,d]}function Fr(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function _c({pos:t,x1:e,y1:n,x2:r,y2:i,c:o}){switch(t){case re.Left:return[e-Fr(e-r,o),n];case re.Right:return[e+Fr(r-e,o),n];case re.Top:return[e,n-Fr(n-i,o)];case re.Bottom:return[e,n+Fr(i-n,o)]}}function Sc({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top,curvature:s=.25}){const[a,c]=_c({pos:n,x1:t,y1:e,x2:r,y2:i,c:s}),[l,u]=_c({pos:o,x1:r,y1:i,x2:t,y2:e,c:s}),[d,h,p,m]=Cc({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:a,sourceControlY:c,targetControlX:l,targetControlY:u});return[`M${t},${e} C${a},${c} ${l},${u} ${r},${i}`,d,h,p,m]}function Oc({sourceX:t,sourceY:e,targetX:n,targetY:r}){const i=Math.abs(n-t)/2,o=n<t?n+i:n-i,s=Math.abs(r-e)/2,a=r<e?r+s:r-s;return[o,a,i,s]}function $0({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:i=!1}){if(!i)return r;const o=n||e.selected||t.selected,s=Math.max(t.internals.z||0,e.internals.z||0,1e3);return r+(o?s:0)}function B0({sourceNode:t,targetNode:e,width:n,height:r,transform:i}){const o=Ir(Br(t),Br(e));o.x===o.x2&&(o.x2+=1),o.y===o.y2&&(o.y2+=1);const s={x:-i[0]/i[2],y:-i[1]/i[2],width:n/i[2],height:r/i[2]};return $n(s,$r(o))>0}const L0=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,D0=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),Ac=(t,e)=>{if(!t.source||!t.target)return e;let n;return uc(t)?n={...t}:n={...t,id:L0(t)},D0(n,e)?e:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,e.concat(n))};function Nc({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[i,o,s,a]=Oc({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,i,o,s,a]}const Pc={[re.Left]:{x:-1,y:0},[re.Right]:{x:1,y:0},[re.Top]:{x:0,y:-1},[re.Bottom]:{x:0,y:1}},z0=({source:t,sourcePosition:e=re.Bottom,target:n})=>e===re.Left||e===re.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},kc=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function F0({source:t,sourcePosition:e=re.Bottom,target:n,targetPosition:r=re.Top,center:i,offset:o}){const s=Pc[e],a=Pc[r],c={x:t.x+s.x*o,y:t.y+s.y*o},l={x:n.x+a.x*o,y:n.y+a.y*o},u=z0({source:c,sourcePosition:e,target:l}),d=u.x!==0?"x":"y",h=u[d];let p=[],m,f;const y={x:0,y:0},g={x:0,y:0},[b,x,v,C]=Oc({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(s[d]*a[d]===-1){m=i.x??b,f=i.y??x;const T=[{x:m,y:c.y},{x:m,y:l.y}],S=[{x:c.x,y:f},{x:l.x,y:f}];s[d]===h?p=d==="x"?T:S:p=d==="x"?S:T}else{const T=[{x:c.x,y:l.y}],S=[{x:l.x,y:c.y}];if(d==="x"?p=s.x===h?S:T:p=s.y===h?T:S,e===r){const F=Math.abs(t[d]-n[d]);if(F<=o){const z=Math.min(o-1,o-F);s[d]===h?y[d]=(c[d]>t[d]?-1:1)*z:g[d]=(l[d]>n[d]?-1:1)*z}}if(e!==r){const F=d==="x"?"y":"x",z=s[d]===a[F],w=c[F]>l[F],N=c[F]<l[F];(s[d]===1&&(!z&&w||z&&N)||s[d]!==1&&(!z&&N||z&&w))&&(p=d==="x"?T:S)}const j={x:c.x+y.x,y:c.y+y.y},$={x:l.x+g.x,y:l.y+g.y},B=Math.max(Math.abs(j.x-p[0].x),Math.abs($.x-p[0].x)),V=Math.max(Math.abs(j.y-p[0].y),Math.abs($.y-p[0].y));B>=V?(m=(j.x+$.x)/2,f=p[0].y):(m=p[0].x,f=(j.y+$.y)/2)}return[[t,{x:c.x+y.x,y:c.y+y.y},...p,{x:l.x+g.x,y:l.y+g.y},n],m,f,v,C]}function V0(t,e,n,r){const i=Math.min(kc(t,e)/2,kc(e,n)/2,r),{x:o,y:s}=e;if(t.x===o&&o===n.x||t.y===s&&s===n.y)return`L${o} ${s}`;if(t.y===s){const l=t.x<n.x?-1:1,u=t.y<n.y?1:-1;return`L ${o+i*l},${s}Q ${o},${s} ${o},${s+i*u}`}const a=t.x<n.x?1:-1,c=t.y<n.y?-1:1;return`L ${o},${s+i*c}Q ${o},${s} ${o+i*a},${s}`}function ao({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top,borderRadius:s=5,centerX:a,centerY:c,offset:l=20}){const[u,d,h,p,m]=F0({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:i},targetPosition:o,center:{x:a,y:c},offset:l});return[u.reduce((f,y,g)=>{let b="";return g>0&&g<u.length-1?b=V0(u[g-1],y,u[g+1],s):b=`${g===0?"M":"L"}${y.x} ${y.y}`,f+=b,f},""),d,h,p,m]}function Tc(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function q0(t){var d;const{sourceNode:e,targetNode:n}=t;if(!Tc(e)||!Tc(n))return null;const r=e.internals.handleBounds||jc(e.handles),i=n.internals.handleBounds||jc(n.handles),o=Rc((r==null?void 0:r.source)??[],t.sourceHandle),s=Rc(t.connectionMode===Ht.Strict?(i==null?void 0:i.target)??[]:((i==null?void 0:i.target)??[]).concat((i==null?void 0:i.source)??[]),t.targetHandle);if(!o||!s)return(d=t.onError)==null||d.call(t,"008",ot.error008(o?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const a=(o==null?void 0:o.position)||re.Bottom,c=(s==null?void 0:s.position)||re.Top,l=Dn(e,o,a),u=Dn(n,s,c);return{sourceX:l.x,sourceY:l.y,targetX:u.x,targetY:u.y,sourcePosition:a,targetPosition:c}}function jc(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function Dn(t,e,n=re.Left,r=!1){const i=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,o=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:s,height:a}=e??st(t);if(r)return{x:i+s/2,y:o+a/2};switch((e==null?void 0:e.position)??n){case re.Top:return{x:i+s/2,y:o};case re.Right:return{x:i+s,y:o+a/2};case re.Bottom:return{x:i+s/2,y:o+a};case re.Left:return{x:i,y:o+a/2}}}function Rc(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function co(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(n=>`${n}=${t[n]}`).join("&")}`:""}function W0(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:i}){const o=new Set;return t.reduce((s,a)=>([a.markerStart||r,a.markerEnd||i].forEach(c=>{if(c&&typeof c=="object"){const l=co(c,e);o.has(l)||(s.push({id:l,color:c.color||n,...c}),o.add(l))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const lo={nodeOrigin:[0,0],nodeExtent:Tn,elevateNodesOnSelect:!0,defaults:{}},H0={...lo,checkEquality:!0};function uo(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function U0(t,e,n){const r=uo(lo,n);for(const i of t.values())if(i.parentId)po(i,t,e,r);else{const o=Rn(i,r.nodeOrigin),s=Zt(i.extent)?i.extent:r.nodeExtent,a=_t(o,s,st(i));i.internals.positionAbsolute=a}}function ho(t,e,n,r){var a,c;const i=uo(H0,r),o=new Map(e),s=i!=null&&i.elevateNodesOnSelect?1e3:0;e.clear(),n.clear();for(const l of t){let u=o.get(l.id);if(i.checkEquality&&l===(u==null?void 0:u.internals.userNode))e.set(l.id,u);else{const d=Rn(l,i.nodeOrigin),h=Zt(l.extent)?l.extent:i.nodeExtent,p=_t(d,h,st(l));u={...i.defaults,...l,measured:{width:(a=l.measured)==null?void 0:a.width,height:(c=l.measured)==null?void 0:c.height},internals:{positionAbsolute:p,handleBounds:l.measured?u==null?void 0:u.internals.handleBounds:void 0,z:Ic(l,s),userNode:l}},e.set(l.id,u)}l.parentId&&po(u,e,n,r)}}function Q0(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function po(t,e,n,r){const{elevateNodesOnSelect:i,nodeOrigin:o,nodeExtent:s}=uo(lo,r),a=t.parentId,c=e.get(a);if(!c){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Q0(t,n);const l=i?1e3:0,{x:u,y:d,z:h}=Z0(t,c,o,s,l),{positionAbsolute:p}=t.internals,m=u!==p.x||d!==p.y;(m||h!==t.internals.z)&&(t.internals={...t.internals,positionAbsolute:m?{x:u,y:d}:p,z:h})}function Ic(t,e){return(Ue(t.zIndex)?t.zIndex:0)+(t.selected?e:0)}function Z0(t,e,n,r,i){const{x:o,y:s}=e.internals.positionAbsolute,a=st(t),c=Rn(t,n),l=Zt(t.extent)?_t(c,t.extent,a):c;let u=_t({x:o+l.x,y:s+l.y},r,a);t.extent==="parent"&&(u=pc(u,a,e));const d=Ic(t,i),h=e.internals.z??0;return{x:u.x,y:u.y,z:h>d?h:d}}function fo(t,e,n,r=[0,0]){var s;const i=[],o=new Map;for(const a of t){const c=e.get(a.parentId);if(!c)continue;const l=((s=o.get(a.parentId))==null?void 0:s.expandedRect)??Qt(c),u=yc(l,a.rect);o.set(a.parentId,{expandedRect:u,parent:c})}return o.size>0&&o.forEach(({expandedRect:a,parent:c},l)=>{var x;const u=c.internals.positionAbsolute,d=st(c),h=c.origin??r,p=a.x<u.x?Math.round(Math.abs(u.x-a.x)):0,m=a.y<u.y?Math.round(Math.abs(u.y-a.y)):0,f=Math.max(d.width,Math.round(a.width)),y=Math.max(d.height,Math.round(a.height)),g=(f-d.width)*h[0],b=(y-d.height)*h[1];(p>0||m>0||g||b)&&(i.push({id:l,type:"position",position:{x:c.position.x-p+g,y:c.position.y-m+b}}),(x=n.get(l))==null||x.forEach(v=>{t.some(C=>C.id===v.id)||i.push({id:v.id,type:"position",position:{x:v.position.x+p,y:v.position.y+m}})})),(d.width<a.width||d.height<a.height||p||m)&&i.push({id:l,type:"dimensions",setAttributes:!0,dimensions:{width:f+(p?h[0]*p-g:0),height:y+(m?h[1]*m-b:0)}})}),i}function Y0(t,e,n,r,i,o){const s=r==null?void 0:r.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const c=[],l=window.getComputedStyle(s),{m22:u}=new window.DOMMatrixReadOnly(l.transform),d=[];for(const h of t.values()){const p=e.get(h.id);if(p)if(p.hidden)p.internals={...p.internals,handleBounds:void 0},a=!0;else{const m=zr(h.nodeElement),f=p.measured.width!==m.width||p.measured.height!==m.height;if(m.width&&m.height&&(f||!p.internals.handleBounds||h.force)){const y=h.nodeElement.getBoundingClientRect(),g=Zt(p.extent)?p.extent:o;let{positionAbsolute:b}=p.internals;p.parentId&&p.extent==="parent"?b=pc(b,m,e.get(p.parentId)):g&&(b=_t(b,g,m)),p.measured=m,p.internals={...p.internals,positionAbsolute:b,handleBounds:{source:Ec("source",h.nodeElement,y,u,p.id),target:Ec("target",h.nodeElement,y,u,p.id)}},p.parentId&&po(p,e,n,{nodeOrigin:i}),a=!0,f&&(c.push({id:p.id,type:"dimensions",dimensions:m}),p.expandParent&&p.parentId&&d.push({id:p.id,parentId:p.parentId,rect:Qt(p,i)}))}}}if(d.length>0){const h=fo(d,e,n,i);c.push(...h)}return{changes:c,updatedInternals:a}}async function X0({delta:t,panZoom:e,transform:n,translateExtent:r,width:i,height:o}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const s=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[i,o]],r),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}function $c(t,e,n){t.clear(),e.clear();for(const r of n){const{source:i,target:o,sourceHandle:s=null,targetHandle:a=null}=r,c=`${i}-source-${s}`,l=`${o}-target-${a}`,u=t.get(c)||new Map,d=t.get(l)||new Map,h={edgeId:r.id,source:i,target:o,sourceHandle:s,targetHandle:a};e.set(r.id,r),t.set(c,u.set(`${o}-${a}`,h)),t.set(l,d.set(`${i}-${s}`,h))}}function Bc(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:Bc(n,e):!1}function Lc(t,e,n){let r=t;do{if(r!=null&&r.matches(e))return!0;if(r===n)return!1;r=r.parentElement}while(r);return!1}function G0(t,e,n,r){const i=new Map;for(const[o,s]of t)if((s.selected||s.id===r)&&(!s.parentId||!Bc(s,t))&&(s.draggable||e&&typeof s.draggable>"u")){const a=t.get(o);a&&i.set(o,{id:o,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return i}function mo({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){var s,a,c;const i=[];for(const[l,u]of e){const d=(s=n.get(l))==null?void 0:s.internals.userNode;d&&i.push({...d,position:u.position,dragging:r})}if(!t)return[i[0],i];const o=(a=n.get(t))==null?void 0:a.internals.userNode;return[o?{...o,position:((c=e.get(t))==null?void 0:c.position)||o.position,dragging:r}:i[0],i]}function K0({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:i}){let o={x:null,y:null},s=0,a=new Map,c=!1,l={x:0,y:0},u=null,d=!1,h=null,p=!1;function m({noDragClassName:y,handleSelector:g,domNode:b,isSelectable:x,nodeId:v,nodeClickDistance:C=0}){h=De(b);function T({x:B,y:V},F){const{nodeLookup:z,nodeExtent:w,snapGrid:N,snapToGrid:_,nodeOrigin:R,onNodeDrag:A,onSelectionDrag:P,onError:L,updateNodePositions:W}=e();o={x:B,y:V};let I=!1,J={x:0,y:0,x2:0,y2:0};if(a.size>1&&w){const X=In(a);J=io(X)}for(const[X,q]of a){if(!z.has(X))continue;let ee={x:B-q.distance.x,y:V-q.distance.y};_&&(ee=Lr(ee,N));let ne=[[w[0][0],w[0][1]],[w[1][0],w[1][1]]];if(a.size>1&&w&&!q.extent){const{positionAbsolute:oe}=q.internals,ce=oe.x-J.x+w[0][0],se=oe.x+q.measured.width-J.x2+w[1][0],pe=oe.y-J.y+w[0][1],ye=oe.y+q.measured.height-J.y2+w[1][1];ne=[[ce,pe],[se,ye]]}const{position:H,positionAbsolute:ae}=hc({nodeId:X,nextPosition:ee,nodeLookup:z,nodeExtent:ne,nodeOrigin:R,onError:L});I=I||q.position.x!==H.x||q.position.y!==H.y,q.position=H,q.internals.positionAbsolute=ae}if(I&&(W(a,!0),F&&(r||A||!v&&P))){const[X,q]=mo({nodeId:v,dragItems:a,nodeLookup:z});r==null||r(F,a,X,q),A==null||A(F,X,q),v||(P==null||P(F,q))}}async function S(){if(!u)return;const{transform:B,panBy:V,autoPanSpeed:F}=e(),[z,w]=mc(l,u,F);(z!==0||w!==0)&&(o.x=(o.x??0)-z/B[2],o.y=(o.y??0)-w/B[2],await V({x:z,y:w})&&T(o,null)),s=requestAnimationFrame(S)}function j(B){var I;const{nodeLookup:V,multiSelectionActive:F,nodesDraggable:z,transform:w,snapGrid:N,snapToGrid:_,selectNodesOnDrag:R,onNodeDragStart:A,onSelectionDragStart:P,unselectNodesAndEdges:L}=e();d=!0,(!R||!x)&&!F&&v&&((I=V.get(v))!=null&&I.selected||L()),x&&R&&v&&(t==null||t(v));const W=Ln(B.sourceEvent,{transform:w,snapGrid:N,snapToGrid:_,containerBounds:u});if(o=W,a=G0(V,z,W,v),a.size>0&&(n||A||!v&&P)){const[J,X]=mo({nodeId:v,dragItems:a,nodeLookup:V});n==null||n(B.sourceEvent,a,J,X),A==null||A(B.sourceEvent,J,X),v||(P==null||P(B.sourceEvent,X))}}const $=Aa().clickDistance(C).on("start",B=>{const{domNode:V,nodeDragThreshold:F,transform:z,snapGrid:w,snapToGrid:N}=e();u=(V==null?void 0:V.getBoundingClientRect())||null,p=!1,F===0&&j(B),o=Ln(B.sourceEvent,{transform:z,snapGrid:w,snapToGrid:N,containerBounds:u}),l=at(B.sourceEvent,u)}).on("drag",B=>{const{autoPanOnNodeDrag:V,transform:F,snapGrid:z,snapToGrid:w,nodeDragThreshold:N,nodeLookup:_}=e(),R=Ln(B.sourceEvent,{transform:F,snapGrid:z,snapToGrid:w,containerBounds:u});if((B.sourceEvent.type==="touchmove"&&B.sourceEvent.touches.length>1||v&&!_.has(v))&&(p=!0),!p){if(!c&&V&&d&&(c=!0,S()),!d){const A=R.xSnapped-(o.x??0),P=R.ySnapped-(o.y??0);Math.sqrt(A*A+P*P)>N&&j(B)}(o.x!==R.xSnapped||o.y!==R.ySnapped)&&a&&d&&(l=at(B.sourceEvent,u),T(R,B.sourceEvent))}}).on("end",B=>{if(!(!d||p)&&(c=!1,d=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:V,updateNodePositions:F,onNodeDragStop:z,onSelectionDragStop:w}=e();if(F(a,!1),i||z||!v&&w){const[N,_]=mo({nodeId:v,dragItems:a,nodeLookup:V,dragging:!1});i==null||i(B.sourceEvent,a,N,_),z==null||z(B.sourceEvent,N,_),v||(w==null||w(B.sourceEvent,_))}}}).filter(B=>{const V=B.target;return!B.button&&(!y||!Lc(V,`.${y}`,b))&&(!g||Lc(V,g,b))});h.call($)}function f(){h==null||h.on(".drag",null)}return{update:m,destroy:f}}function J0(t,e,n){const r=[],i={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const o of e.values())$n(i,Qt(o))>0&&r.push(o);return r}const ex=250;function tx(t,e,n,r){var a,c;let i=[],o=1/0;const s=J0(t,n,e+ex);for(const l of s){const u=[...((a=l.internals.handleBounds)==null?void 0:a.source)??[],...((c=l.internals.handleBounds)==null?void 0:c.target)??[]];for(const d of u){if(r.nodeId===d.nodeId&&r.type===d.type&&r.id===d.id)continue;const{x:h,y:p}=Dn(l,d,d.position,!0),m=Math.sqrt(Math.pow(h-t.x,2)+Math.pow(p-t.y,2));m>e||(m<o?(i=[{...d,x:h,y:p}],o=m):m===o&&i.push({...d,x:h,y:p}))}}if(!i.length)return null;if(i.length>1){const l=r.type==="source"?"target":"source";return i.find(u=>u.type===l)??i[0]}return i[0]}function Dc(t,e,n,r,i,o=!1){var l,u,d;const s=r.get(t);if(!s)return null;const a=i==="strict"?(l=s.internals.handleBounds)==null?void 0:l[e]:[...((u=s.internals.handleBounds)==null?void 0:u.source)??[],...((d=s.internals.handleBounds)==null?void 0:d.target)??[]],c=(n?a==null?void 0:a.find(h=>h.id===n):a==null?void 0:a[0])??null;return c&&o?{...c,...Dn(s,c,c.position,!0)}:c}function zc(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function nx(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const Fc=()=>!0;function rx(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:i,edgeUpdaterType:o,isTarget:s,domNode:a,nodeLookup:c,lib:l,autoPanOnConnect:u,flowId:d,panBy:h,cancelConnection:p,onConnectStart:m,onConnect:f,onConnectEnd:y,isValidConnection:g=Fc,onReconnectEnd:b,updateConnection:x,getTransform:v,getFromHandle:C,autoPanSpeed:T}){const S=wc(t.target);let j=0,$;const{x:B,y:V}=at(t),F=S==null?void 0:S.elementFromPoint(B,V),z=zc(o,F),w=a==null?void 0:a.getBoundingClientRect();if(!w||!z)return;const N=Dc(i,z,r,c,e);if(!N)return;let _=at(t,w),R=!1,A=null,P=!1,L=null;function W(){if(!u||!w)return;const[H,ae]=mc(_,w,T);h({x:H,y:ae}),j=requestAnimationFrame(W)}const I={...N,nodeId:i,type:z,position:N.position},J=c.get(i),X={inProgress:!0,isValid:null,from:Dn(J,I,re.Left,!0),fromHandle:I,fromPosition:I.position,fromNode:J,to:_,toHandle:null,toPosition:ac[I.position],toNode:null};x(X);let q=X;m==null||m(t,{nodeId:i,handleId:r,handleType:z});function ee(H){if(!C()||!I){ne(H);return}const ae=v();_=at(H,w),$=tx(Bn(_,ae,!1,[1,1]),n,c,I),R||(W(),R=!0);const oe=Vc(H,{handle:$,connectionMode:e,fromNodeId:i,fromHandleId:r,fromType:s?"target":"source",isValidConnection:g,doc:S,lib:l,flowId:d,nodeLookup:c});L=oe.handleDomNode,A=oe.connection,P=nx(!!$,oe.isValid);const ce={...q,isValid:P,to:$&&P?xc({x:$.x,y:$.y},ae):_,toHandle:oe.toHandle,toPosition:P&&oe.toHandle?oe.toHandle.position:ac[I.position],toNode:oe.toHandle?c.get(oe.toHandle.nodeId):null};P&&$&&q.toHandle&&ce.toHandle&&q.toHandle.type===ce.toHandle.type&&q.toHandle.nodeId===ce.toHandle.nodeId&&q.toHandle.id===ce.toHandle.id&&q.to.x===ce.to.x&&q.to.y===ce.to.y||(x(ce),q=ce)}function ne(H){($||L)&&A&&P&&(f==null||f(A));const{inProgress:ae,...oe}=q,ce={...oe,toPosition:q.toHandle?q.toPosition:null};y==null||y(H,ce),o&&(b==null||b(H,ce)),p(),cancelAnimationFrame(j),R=!1,P=!1,A=null,L=null,S.removeEventListener("mousemove",ee),S.removeEventListener("mouseup",ne),S.removeEventListener("touchmove",ee),S.removeEventListener("touchend",ne)}S.addEventListener("mousemove",ee),S.addEventListener("mouseup",ne),S.addEventListener("touchmove",ee),S.addEventListener("touchend",ne)}function Vc(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:i,fromType:o,doc:s,lib:a,flowId:c,isValidConnection:l=Fc,nodeLookup:u}){const d=o==="target",h=e?s.querySelector(`.${a}-flow__handle[data-id="${c}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:p,y:m}=at(t),f=s.elementFromPoint(p,m),y=f!=null&&f.classList.contains(`${a}-flow__handle`)?f:h,g={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const b=zc(void 0,y),x=y.getAttribute("data-nodeid"),v=y.getAttribute("data-handleid"),C=y.classList.contains("connectable"),T=y.classList.contains("connectableend");if(!x||!b)return g;const S={source:d?x:r,sourceHandle:d?v:i,target:d?r:x,targetHandle:d?i:v};g.connection=S;const j=C&&T&&(n===Ht.Strict?d&&b==="source"||!d&&b==="target":x!==r||v!==i);g.isValid=j&&l(S),g.toHandle=Dc(x,b,v,u,n,!1)}return g}const yo={onPointerDown:rx,isValid:Vc};function ix({domNode:t,panZoom:e,getTransform:n,getViewScale:r}){const i=De(t);function o({translateExtent:a,width:c,height:l,zoomStep:u=10,pannable:d=!0,zoomable:h=!0,inversePan:p=!1}){const m=x=>{const v=n();if(x.sourceEvent.type!=="wheel"||!e)return;const C=-x.sourceEvent.deltaY*(x.sourceEvent.deltaMode===1?.05:x.sourceEvent.deltaMode?1:.002)*u,T=v[2]*Math.pow(2,C);e.scaleTo(T)};let f=[0,0];const y=x=>{(x.sourceEvent.type==="mousedown"||x.sourceEvent.type==="touchstart")&&(f=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY])},g=x=>{const v=n();if(x.sourceEvent.type!=="mousemove"&&x.sourceEvent.type!=="touchmove"||!e)return;const C=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY],T=[C[0]-f[0],C[1]-f[1]];f=C;const S=r()*Math.max(v[2],Math.log(v[2]))*(p?-1:1),j={x:v[0]-T[0]*S,y:v[1]-T[1]*S},$=[[0,0],[c,l]];e.setViewportConstrained({x:j.x,y:j.y,zoom:v[2]},$,a)},b=ic().on("start",y).on("zoom",d?g:null).on("zoom.wheel",h?m:null);i.call(b,{})}function s(){i.on("zoom",null)}return{update:o,destroy:s,pointer:qe}}const ox=(t,e)=>t.x!==e.x||t.y!==e.y||t.zoom!==e.k,Vr=t=>({x:t.x,y:t.y,zoom:t.k}),go=({x:t,y:e,zoom:n})=>jr.translate(t,e).scale(n),Yt=(t,e)=>t.target.closest(`.${e}`),qc=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),xo=(t,e=0,n=()=>{})=>{const r=typeof e=="number"&&e>0;return r||n(),r?t.transition().duration(e).on("end",n):t},Wc=t=>{const e=t.ctrlKey&&Dr()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function sx({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:i,panOnScrollSpeed:o,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:l}){return u=>{if(Yt(u,e))return!1;u.preventDefault(),u.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(u.ctrlKey&&s){const y=qe(u),g=Wc(u),b=d*Math.pow(2,g);r.scaleTo(n,b,y,u);return}const h=u.deltaMode===1?20:1;let p=i===wt.Vertical?0:u.deltaX*h,m=i===wt.Horizontal?0:u.deltaY*h;!Dr()&&u.shiftKey&&i!==wt.Vertical&&(p=u.deltaY*h,m=0),r.translateBy(n,-(p/d)*o,-(m/d)*o,{internal:!0});const f=Vr(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling||(t.isPanScrolling=!0,a==null||a(u,f)),t.isPanScrolling&&(c==null||c(u,f),t.panScrollTimeout=setTimeout(()=>{l==null||l(u,f),t.isPanScrolling=!1},150))}}function ax({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,i){if(!e&&r.type==="wheel"&&!r.ctrlKey||Yt(r,t))return null;r.preventDefault(),n.call(this,r,i)}}function cx({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{var o,s,a;if((o=r.sourceEvent)!=null&&o.internal)return;const i=Vr(r.transform);t.mouseButton=((s=r.sourceEvent)==null?void 0:s.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=i,((a=r.sourceEvent)==null?void 0:a.type)==="mousedown"&&e(!0),n&&(n==null||n(r.sourceEvent,i))}}function lx({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:i}){return o=>{var s,a;t.usedRightMouseButton=!!(n&&qc(e,t.mouseButton??0)),(s=o.sourceEvent)!=null&&s.sync||r([o.transform.x,o.transform.y,o.transform.k]),i&&!((a=o.sourceEvent)!=null&&a.internal)&&(i==null||i(o.sourceEvent,Vr(o.transform)))}}function ux({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:i,onPaneContextMenu:o}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(t.isZoomingOrPanning=!1,o&&qc(e,t.mouseButton??0)&&!t.usedRightMouseButton&&s.sourceEvent&&o(s.sourceEvent),t.usedRightMouseButton=!1,r(!1),i&&ox(t.prevViewport,s.transform))){const c=Vr(s.transform);t.prevViewport=c,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{i==null||i(s.sourceEvent,c)},n?150:0)}}}function dx({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:i,zoomOnDoubleClick:o,userSelectionActive:s,noWheelClassName:a,noPanClassName:c,lib:l}){return u=>{var m;const d=t||e,h=n&&u.ctrlKey;if(u.button===1&&u.type==="mousedown"&&(Yt(u,`${l}-flow__node`)||Yt(u,`${l}-flow__edge`)))return!0;if(!r&&!d&&!i&&!o&&!n||s||Yt(u,a)&&u.type==="wheel"||Yt(u,c)&&(u.type!=="wheel"||i&&u.type==="wheel"&&!t)||!n&&u.ctrlKey&&u.type==="wheel")return!1;if(!n&&u.type==="touchstart"&&((m=u.touches)==null?void 0:m.length)>1)return u.preventDefault(),!1;if(!d&&!i&&!h&&u.type==="wheel"||!r&&(u.type==="mousedown"||u.type==="touchstart")||Array.isArray(r)&&!r.includes(u.button)&&u.type==="mousedown")return!1;const p=Array.isArray(r)&&r.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||u.type==="wheel")&&p}}function hx({domNode:t,minZoom:e,maxZoom:n,paneClickDistance:r,translateExtent:i,viewport:o,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:c,onDraggingChange:l}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=t.getBoundingClientRect(),h=ic().clickDistance(!Ue(r)||r<0?0:r).scaleExtent([e,n]).translateExtent(i),p=De(t).call(h);x({x:o.x,y:o.y,zoom:Ut(o.zoom,e,n)},[[0,0],[d.width,d.height]],i);const m=p.on("wheel.zoom"),f=p.on("dblclick.zoom");h.wheelDelta(Wc);function y(F,z){return p?new Promise(w=>{h==null||h.transform(xo(p,z==null?void 0:z.duration,()=>w(!0)),F)}):Promise.resolve(!1)}function g({noWheelClassName:F,noPanClassName:z,onPaneContextMenu:w,userSelectionActive:N,panOnScroll:_,panOnDrag:R,panOnScrollMode:A,panOnScrollSpeed:P,preventScrolling:L,zoomOnPinch:W,zoomOnScroll:I,zoomOnDoubleClick:J,zoomActivationKeyPressed:X,lib:q,onTransformChange:ee}){N&&!u.isZoomingOrPanning&&b();const ne=_&&!X&&!N?sx({zoomPanValues:u,noWheelClassName:F,d3Selection:p,d3Zoom:h,panOnScrollMode:A,panOnScrollSpeed:P,zoomOnPinch:W,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:c}):ax({noWheelClassName:F,preventScrolling:L,d3ZoomHandler:m});if(p.on("wheel.zoom",ne,{passive:!1}),!N){const ae=cx({zoomPanValues:u,onDraggingChange:l,onPanZoomStart:a});h.on("start",ae);const oe=lx({zoomPanValues:u,panOnDrag:R,onPaneContextMenu:!!w,onPanZoom:s,onTransformChange:ee});h.on("zoom",oe);const ce=ux({zoomPanValues:u,panOnDrag:R,panOnScroll:_,onPaneContextMenu:w,onPanZoomEnd:c,onDraggingChange:l});h.on("end",ce)}const H=dx({zoomActivationKeyPressed:X,panOnDrag:R,zoomOnScroll:I,panOnScroll:_,zoomOnDoubleClick:J,zoomOnPinch:W,userSelectionActive:N,noPanClassName:z,noWheelClassName:F,lib:q});h.filter(H),J?p.on("dblclick.zoom",f):p.on("dblclick.zoom",null)}function b(){h.on("zoom",null)}async function x(F,z,w){const N=go(F),_=h==null?void 0:h.constrain()(N,z,w);return _&&await y(_),new Promise(R=>R(_))}async function v(F,z){const w=go(F);return await y(w,z),new Promise(N=>N(w))}function C(F){if(p){const z=go(F),w=p.property("__zoom");(w.k!==F.zoom||w.x!==F.x||w.y!==F.y)&&(h==null||h.transform(p,z,null,{sync:!0}))}}function T(){const F=p?nc(p.node()):{x:0,y:0,k:1};return{x:F.x,y:F.y,zoom:F.k}}function S(F,z){return p?new Promise(w=>{h==null||h.scaleTo(xo(p,z==null?void 0:z.duration,()=>w(!0)),F)}):Promise.resolve(!1)}function j(F,z){return p?new Promise(w=>{h==null||h.scaleBy(xo(p,z==null?void 0:z.duration,()=>w(!0)),F)}):Promise.resolve(!1)}function $(F){h==null||h.scaleExtent(F)}function B(F){h==null||h.translateExtent(F)}function V(F){const z=!Ue(F)||F<0?0:F;h==null||h.clickDistance(z)}return{update:g,destroy:b,setViewport:v,setViewportConstrained:x,getViewport:T,scaleTo:S,scaleBy:j,setScaleExtent:$,setTranslateExtent:B,syncViewport:C,setClickDistance:V}}var Xt;(function(t){t.Line="line",t.Handle="handle"})(Xt||(Xt={}));const px=["top-left","top-right","bottom-left","bottom-right"],fx=["top","right","bottom","left"];function mx({width:t,prevWidth:e,height:n,prevHeight:r,affectsX:i,affectsY:o}){const s=t-e,a=n-r,c=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&i&&(c[0]=c[0]*-1),a&&o&&(c[1]=c[1]*-1),c}function yx(t){const e=t.includes("right")||t.includes("left"),n=t.includes("bottom")||t.includes("top"),r=t.includes("left"),i=t.includes("top");return{isHorizontal:e,isVertical:n,affectsX:r,affectsY:i}}function pt(t,e){return Math.max(0,e-t)}function ft(t,e){return Math.max(0,t-e)}function qr(t,e,n){return Math.max(0,e-t,t-n)}function Hc(t,e){return t?!e:e}function gx(t,e,n,r,i,o,s,a){let{affectsX:c,affectsY:l}=e;const{isHorizontal:u,isVertical:d}=e,h=u&&d,{xSnapped:p,ySnapped:m}=n,{minWidth:f,maxWidth:y,minHeight:g,maxHeight:b}=r,{x,y:v,width:C,height:T,aspectRatio:S}=t;let j=Math.floor(u?p-t.pointerX:0),$=Math.floor(d?m-t.pointerY:0);const B=C+(c?-j:j),V=T+(l?-$:$),F=-o[0]*C,z=-o[1]*T;let w=qr(B,f,y),N=qr(V,g,b);if(s){let A=0,P=0;c&&j<0?A=pt(x+j+F,s[0][0]):!c&&j>0&&(A=ft(x+B+F,s[1][0])),l&&$<0?P=pt(v+$+z,s[0][1]):!l&&$>0&&(P=ft(v+V+z,s[1][1])),w=Math.max(w,A),N=Math.max(N,P)}if(a){let A=0,P=0;c&&j>0?A=ft(x+j,a[0][0]):!c&&j<0&&(A=pt(x+B,a[1][0])),l&&$>0?P=ft(v+$,a[0][1]):!l&&$<0&&(P=pt(v+V,a[1][1])),w=Math.max(w,A),N=Math.max(N,P)}if(i){if(u){const A=qr(B/S,g,b)*S;if(w=Math.max(w,A),s){let P=0;!c&&!l||c&&!l&&h?P=ft(v+z+B/S,s[1][1])*S:P=pt(v+z+(c?j:-j)/S,s[0][1])*S,w=Math.max(w,P)}if(a){let P=0;!c&&!l||c&&!l&&h?P=pt(v+B/S,a[1][1])*S:P=ft(v+(c?j:-j)/S,a[0][1])*S,w=Math.max(w,P)}}if(d){const A=qr(V*S,f,y)/S;if(N=Math.max(N,A),s){let P=0;!c&&!l||l&&!c&&h?P=ft(x+V*S+F,s[1][0])/S:P=pt(x+(l?$:-$)*S+F,s[0][0])/S,N=Math.max(N,P)}if(a){let P=0;!c&&!l||l&&!c&&h?P=pt(x+V*S,a[1][0])/S:P=ft(x+(l?$:-$)*S,a[0][0])/S,N=Math.max(N,P)}}}$=$+($<0?N:-N),j=j+(j<0?w:-w),i&&(h?B>V*S?$=(Hc(c,l)?-j:j)/S:j=(Hc(c,l)?-$:$)*S:u?($=j/S,l=c):(j=$*S,c=l));const _=c?x+j:x,R=l?v+$:v;return{width:C+(c?-j:j),height:T+(l?-$:$),x:o[0]*j*(c?-1:1)+_,y:o[1]*$*(l?-1:1)+R}}const Uc={width:0,height:0,x:0,y:0},xx={...Uc,pointerX:0,pointerY:0,aspectRatio:1};function vx(t){return[[0,0],[t.measured.width,t.measured.height]]}function bx(t,e,n){const r=e.position.x+t.position.x,i=e.position.y+t.position.y,o=t.measured.width??0,s=t.measured.height??0,a=n[0]*o,c=n[1]*s;return[[r-a,i-c],[r+o-a,i+s-c]]}function wx({domNode:t,nodeId:e,getStoreItems:n,onChange:r,onEnd:i}){const o=De(t);function s({controlPosition:c,boundaries:l,keepAspectRatio:u,onResizeStart:d,onResize:h,onResizeEnd:p,shouldResize:m}){let f={...Uc},y={...xx};const g=yx(c);let b,x=null,v=[],C,T,S;const j=Aa().on("start",$=>{const{nodeLookup:B,transform:V,snapGrid:F,snapToGrid:z,nodeOrigin:w,paneDomNode:N}=n();if(b=B.get(e),!b)return;x=(N==null?void 0:N.getBoundingClientRect())??null;const{xSnapped:_,ySnapped:R}=Ln($.sourceEvent,{transform:V,snapGrid:F,snapToGrid:z,containerBounds:x});f={width:b.measured.width??0,height:b.measured.height??0,x:b.position.x??0,y:b.position.y??0},y={...f,pointerX:_,pointerY:R,aspectRatio:f.width/f.height},C=void 0,b.parentId&&(b.extent==="parent"||b.expandParent)&&(C=B.get(b.parentId),T=C&&b.extent==="parent"?vx(C):void 0),v=[],S=void 0;for(const[A,P]of B)if(P.parentId===e&&(v.push({id:A,position:{...P.position},extent:P.extent}),P.extent==="parent"||P.expandParent)){const L=bx(P,b,P.origin??w);S?S=[[Math.min(L[0][0],S[0][0]),Math.min(L[0][1],S[0][1])],[Math.max(L[1][0],S[1][0]),Math.max(L[1][1],S[1][1])]]:S=L}d==null||d($,{...f})}).on("drag",$=>{const{transform:B,snapGrid:V,snapToGrid:F,nodeOrigin:z}=n(),w=Ln($.sourceEvent,{transform:B,snapGrid:V,snapToGrid:F,containerBounds:x}),N=[];if(!b)return;const{x:_,y:R,width:A,height:P}=f,L={},W=b.origin??z,{width:I,height:J,x:X,y:q}=gx(y,g,w,l,u,W,T,S),ee=I!==A,ne=J!==P,H=X!==_&&ee,ae=q!==R&&ne;if(!H&&!ae&&!ee&&!ne)return;if((H||ae||W[0]===1||W[1]===1)&&(L.x=H?X:f.x,L.y=ae?q:f.y,f.x=L.x,f.y=L.y,v.length>0)){const se=X-_,pe=q-R;for(const ye of v)ye.position={x:ye.position.x-se+W[0]*(I-A),y:ye.position.y-pe+W[1]*(J-P)},N.push(ye)}if((ee||ne)&&(L.width=ee?I:f.width,L.height=ne?J:f.height,f.width=L.width,f.height=L.height),C&&b.expandParent){const se=W[0]*(L.width??0);L.x&&L.x<se&&(f.x=se,y.x=y.x-(L.x-se));const pe=W[1]*(L.height??0);L.y&&L.y<pe&&(f.y=pe,y.y=y.y-(L.y-pe))}const oe=mx({width:f.width,prevWidth:A,height:f.height,prevHeight:P,affectsX:g.affectsX,affectsY:g.affectsY}),ce={...f,direction:oe};(m==null?void 0:m($,ce))!==!1&&(h==null||h($,ce),r(L,N))}).on("end",$=>{p==null||p($,{...f}),i==null||i()});o.call(j)}function a(){o.on(".drag",null)}return{update:s,destroy:a}}var Qc={exports:{}},Zc={},Yc={exports:{}},Xc={},Gt=M;function Mx(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ex=typeof Object.is=="function"?Object.is:Mx,Cx=Gt.useState,_x=Gt.useEffect,Sx=Gt.useLayoutEffect,Ox=Gt.useDebugValue;function Ax(t,e){var n=e(),r=Cx({inst:{value:n,getSnapshot:e}}),i=r[0].inst,o=r[1];return Sx(function(){i.value=n,i.getSnapshot=e,vo(i)&&o({inst:i})},[t,n,e]),_x(function(){return vo(i)&&o({inst:i}),t(function(){vo(i)&&o({inst:i})})},[t]),Ox(n),n}function vo(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ex(t,n)}catch{return!0}}function Nx(t,e){return e()}var Px=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Nx:Ax;Xc.useSyncExternalStore=Gt.useSyncExternalStore!==void 0?Gt.useSyncExternalStore:Px,Yc.exports=Xc,Bi=Yc.exports,kf=Je(Bi);var Wr=M,kx=Bi;function Tx(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var jx=typeof Object.is=="function"?Object.is:Tx,Rx=kx.useSyncExternalStore,Ix=Wr.useRef,$x=Wr.useEffect,Bx=Wr.useMemo,Lx=Wr.useDebugValue;Zc.useSyncExternalStoreWithSelector=function(t,e,n,r,i){var o=Ix(null);if(o.current===null){var s={hasValue:!1,value:null};o.current=s}else s=o.current;o=Bx(function(){function c(p){if(!l){if(l=!0,u=p,p=r(p),i!==void 0&&s.hasValue){var m=s.value;if(i(m,p))return d=m}return d=p}if(m=d,jx(u,p))return m;var f=r(p);return i!==void 0&&i(m,f)?m:(u=p,d=f)}var l=!1,u,d,h=n===void 0?null:n;return[function(){return c(e())},h===null?void 0:function(){return c(h())}]},[e,n,r,i]);var a=Rx(t,o[0],o[1]);return $x(function(){s.hasValue=!0,s.value=a},[a]),Lx(a),a},Qc.exports=Zc;var Dx=Qc.exports;let Gc,bo,Kc,Jc,el,tl;Ys=Je(Dx),Gc={BASE_URL:"/NoLLMChat/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},bo=t=>{let e;const n=new Set,r=(a,c)=>{const l=typeof a=="function"?a(e):a;if(!Object.is(l,e)){const u=e;e=c??(typeof l!="object"||l===null)?l:Object.assign({},e,l),n.forEach(d=>d(e,u))}},i=()=>e,o={setState:r,getState:i,getInitialState:()=>s,subscribe:a=>(n.add(a),()=>n.delete(a)),destroy:()=>{(Gc?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},s=e=t(r,i,o);return o},Kc=t=>t?bo(t):bo,{useDebugValue:Jc}=KO,{useSyncExternalStoreWithSelector:el}=Ys,tl=t=>t;function nl(t,e=tl,n){const r=el(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return Jc(r),r}const rl=(t,e)=>{const n=Kc(t),r=(i,o=e)=>nl(n,i,o);return Object.assign(r,n),r},zx=(t,e)=>t?rl(t,e):rl;function be(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[r,i]of t)if(!Object.is(i,e.get(r)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(t[r],e[r]))return!1;return!0}const Hr=M.createContext(null),Fx=Hr.Provider,il=ot.error001();de=function(t,e){const n=M.useContext(Hr);if(n===null)throw new Error(il);return nl(n,t,e)},ge=function(){const t=M.useContext(Hr);if(t===null)throw new Error(il);return M.useMemo(()=>({getState:t.getState,setState:t.setState,subscribe:t.subscribe}),[t])};const ol={display:"none"},Vx={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},sl="react-flow__node-desc",al="react-flow__edge-desc",qx="react-flow__aria-live",Wx=t=>t.ariaLiveMessage;function Hx({rfId:t}){const e=de(Wx);return E.jsx("div",{id:`${qx}-${t}`,"aria-live":"assertive","aria-atomic":"true",style:Vx,children:e})}function Ux({rfId:t,disableKeyboardA11y:e}){return E.jsxs(E.Fragment,{children:[E.jsxs("div",{id:`${sl}-${t}`,style:ol,children:["Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "]}),E.jsx("div",{id:`${al}-${t}`,style:ol,children:"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."}),!e&&E.jsx(Hx,{rfId:t})]})}const Qx=t=>t.userSelectionActive?"none":"all";cr=function({position:t="top-left",children:e,className:n,style:r,...i}){const o=de(Qx),s=`${t}`.split("-");return E.jsx("div",{className:_e(["react-flow__panel",n,...s]),style:{...r,pointerEvents:o},...i,children:e})};function Zx({proOptions:t,position:e="bottom-right"}){return t!=null&&t.hideAttribution?null:E.jsx(cr,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:E.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Yx=t=>{const e=[],n=[];for(const[,r]of t.nodeLookup)r.selected&&e.push(r.internals.userNode);for(const[,r]of t.edgeLookup)r.selected&&n.push(r);return{selectedNodes:e,selectedEdges:n}},Ur=t=>t.id;function Xx(t,e){return be(t.selectedNodes.map(Ur),e.selectedNodes.map(Ur))&&be(t.selectedEdges.map(Ur),e.selectedEdges.map(Ur))}function Gx({onSelectionChange:t}){const e=ge(),{selectedNodes:n,selectedEdges:r}=de(Yx,Xx);return M.useEffect(()=>{const i={nodes:n,edges:r};t==null||t(i),e.getState().onSelectionChangeHandlers.forEach(o=>o(i))},[n,r,t]),null}const Kx=t=>!!t.onSelectionChangeHandlers;function Jx({onSelectionChange:t}){const e=de(Kx);return t||e?E.jsx(Gx,{onSelectionChange:t}):null}const cl=[0,0],e1={x:0,y:0,zoom:1},t1=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance"],ll=[...t1,"rfId"],n1=t=>({setNodes:t.setNodes,setEdges:t.setEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setPaneClickDistance:t.setPaneClickDistance}),ul={translateExtent:Tn,nodeOrigin:cl,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function r1(t){const{setNodes:e,setEdges:n,setMinZoom:r,setMaxZoom:i,setTranslateExtent:o,setNodeExtent:s,reset:a,setDefaultNodesAndEdges:c,setPaneClickDistance:l}=de(n1,be),u=ge();M.useEffect(()=>(c(t.defaultNodes,t.defaultEdges),()=>{d.current=ul,a()}),[]);const d=M.useRef(ul);return M.useEffect(()=>{for(const h of ll){const p=t[h],m=d.current[h];p!==m&&(typeof t[h]>"u"||(h==="nodes"?e(p):h==="edges"?n(p):h==="minZoom"?r(p):h==="maxZoom"?i(p):h==="translateExtent"?o(p):h==="nodeExtent"?s(p):h==="paneClickDistance"?l(p):h==="fitView"?u.setState({fitViewOnInit:p}):h==="fitViewOptions"?u.setState({fitViewOnInitOptions:p}):u.setState({[h]:p})))}d.current=t},ll.map(h=>t[h])),null}function dl(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function i1(t){var r;const[e,n]=M.useState(t==="system"?null:t);return M.useEffect(()=>{if(t!=="system"){n(t);return}const i=dl(),o=()=>n(i!=null&&i.matches?"dark":"light");return o(),i==null||i.addEventListener("change",o),()=>{i==null||i.removeEventListener("change",o)}},[t]),e!==null?e:(r=dl())!=null&&r.matches?"dark":"light"}const hl=typeof document<"u"?document:null;function zn(t=null,e={target:hl,actInsideInputWithModifier:!0}){const[n,r]=M.useState(!1),i=M.useRef(!1),o=M.useRef(new Set([])),[s,a]=M.useMemo(()=>{if(t!==null){const c=(Array.isArray(t)?t:[t]).filter(u=>typeof u=="string").map(u=>u.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=c.reduce((u,d)=>u.concat(...d),[]);return[c,l]}return[[],[]]},[t]);return M.useEffect(()=>{const c=(e==null?void 0:e.target)||hl;if(t!==null){const l=h=>{if(i.current=h.ctrlKey||h.metaKey||h.shiftKey,(!i.current||i.current&&!e.actInsideInputWithModifier)&&so(h))return!1;const p=fl(h.code,a);o.current.add(h[p]),pl(s,o.current,!1)&&(h.preventDefault(),r(!0))},u=h=>{if((!i.current||i.current&&!e.actInsideInputWithModifier)&&so(h))return!1;const p=fl(h.code,a);pl(s,o.current,!0)?(r(!1),o.current.clear()):o.current.delete(h[p]),h.key==="Meta"&&o.current.clear(),i.current=!1},d=()=>{o.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",l),c==null||c.addEventListener("keyup",u),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{c==null||c.removeEventListener("keydown",l),c==null||c.removeEventListener("keyup",u),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[t,r]),n}function pl(t,e,n){return t.filter(r=>n||r.length===e.size).some(r=>r.every(i=>e.has(i)))}function fl(t,e){return e.includes(t)?"code":"key"}const o1=()=>{const t=ge();return M.useMemo(()=>({zoomIn:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1/1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomTo:(e,n)=>{const{panZoom:r}=t.getState();return r?r.scaleTo(e,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>t.getState().transform[2],setViewport:async(e,n)=>{const{transform:[r,i,o],panZoom:s}=t.getState();return s?(await s.setViewport({x:e.x??r,y:e.y??i,zoom:e.zoom??o},{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,n,r]=t.getState().transform;return{x:e,y:n,zoom:r}},fitView:e=>{const{nodeLookup:n,minZoom:r,maxZoom:i,panZoom:o,domNode:s}=t.getState();if(!o||!s)return Promise.resolve(!1);const a=no(n,e),{width:c,height:l}=zr(s);return ro({nodes:a,width:c,height:l,minZoom:r,maxZoom:i,panZoom:o},e)},setCenter:async(e,n,r)=>{const{width:i,height:o,maxZoom:s,panZoom:a}=t.getState(),c=typeof(r==null?void 0:r.zoom)<"u"?r.zoom:s,l=i/2-e*c,u=o/2-n*c;return a?(await a.setViewport({x:l,y:u,zoom:c},{duration:r==null?void 0:r.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitBounds:async(e,n)=>{const{width:r,height:i,minZoom:o,maxZoom:s,panZoom:a}=t.getState(),c=oo(e,r,i,o,s,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(c,{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,n={snapToGrid:!0})=>{const{transform:r,snapGrid:i,domNode:o}=t.getState();if(!o)return e;const{x:s,y:a}=o.getBoundingClientRect(),c={x:e.x-s,y:e.y-a};return Bn(c,r,n.snapToGrid,i)},flowToScreenPosition:e=>{const{transform:n,domNode:r}=t.getState();if(!r)return e;const{x:i,y:o}=r.getBoundingClientRect(),s=xc(e,n);return{x:s.x+i,y:s.y+o}}}),[])};function ml(t,e){const n=[],r=new Map,i=[];for(const o of t)if(o.type==="add"){i.push(o);continue}else if(o.type==="remove"||o.type==="replace")r.set(o.id,[o]);else{const s=r.get(o.id);s?s.push(o):r.set(o.id,[o])}for(const o of e){const s=r.get(o.id);if(!s){n.push(o);continue}if(s[0].type==="remove")continue;if(s[0].type==="replace"){n.push({...s[0].item});continue}const a={...o};for(const c of s)s1(c,a);n.push(a)}return i.length&&i.forEach(o=>{o.index!==void 0?n.splice(o.index,0,{...o.item}):n.push({...o.item})}),n}function s1(t,e){switch(t.type){case"select":{e.selected=t.selected;break}case"position":{typeof t.position<"u"&&(e.position=t.position),typeof t.dragging<"u"&&(e.dragging=t.dragging);break}case"dimensions":{typeof t.dimensions<"u"&&(e.measured??(e.measured={}),e.measured.width=t.dimensions.width,e.measured.height=t.dimensions.height,t.setAttributes&&(e.width=t.dimensions.width,e.height=t.dimensions.height)),typeof t.resizing=="boolean"&&(e.resizing=t.resizing);break}}}bt=function(t,e){return ml(t,e)};function Fn(t,e){return ml(t,e)}function St(t,e){return{id:t,type:"select",selected:e}}function Kt(t,e=new Set,n=!1){const r=[];for(const[i,o]of t){const s=e.has(i);!(o.selected===void 0&&!s)&&o.selected!==s&&(n&&(o.selected=s),r.push(St(o.id,s)))}return r}function yl({items:t=[],lookup:e}){var i;const n=[],r=new Map(t.map(o=>[o.id,o]));for(const[o,s]of t.entries()){const a=e.get(s.id),c=((i=a==null?void 0:a.internals)==null?void 0:i.userNode)??a;c!==void 0&&c!==s&&n.push({id:s.id,item:s,type:"replace"}),c===void 0&&n.push({item:s,type:"add",index:o})}for(const[o]of e)r.get(o)===void 0&&n.push({id:o,type:"remove"});return n}function gl(t){return{id:t.id,type:"remove"}}const xl=t=>P0(t),a1=t=>uc(t);function vl(t){return M.forwardRef(t)}const c1=typeof window<"u"?M.useLayoutEffect:M.useEffect;function bl(t){const[e,n]=M.useState(BigInt(0)),[r]=M.useState(()=>l1(()=>n(i=>i+BigInt(1))));return c1(()=>{const i=r.get();i.length&&(t(i),r.reset())},[e]),r}function l1(t){let e=[];return{get:()=>e,reset:()=>{e=[]},push:n=>{e.push(n),t()}}}const wl=M.createContext(null);function u1({children:t}){const e=ge(),n=M.useCallback(a=>{const{nodes:c=[],setNodes:l,hasDefaultNodes:u,onNodesChange:d,nodeLookup:h}=e.getState();let p=c;for(const m of a)p=typeof m=="function"?m(p):m;u?l(p):d&&d(yl({items:p,lookup:h}))},[]),r=bl(n),i=M.useCallback(a=>{const{edges:c=[],setEdges:l,hasDefaultEdges:u,onEdgesChange:d,edgeLookup:h}=e.getState();let p=c;for(const m of a)p=typeof m=="function"?m(p):m;u?l(p):d&&d(yl({items:p,lookup:h}))},[]),o=bl(i),s=M.useMemo(()=>({nodeQueue:r,edgeQueue:o}),[]);return E.jsx(wl.Provider,{value:s,children:t})}function d1(){const t=M.useContext(wl);if(!t)throw new Error("useBatchContext must be used within a BatchProvider");return t}const h1=t=>!!t.panZoom;ur=function(){const t=o1(),e=ge(),n=d1(),r=de(h1),i=M.useMemo(()=>{const o=d=>e.getState().nodeLookup.get(d),s=d=>{n.nodeQueue.push(d)},a=d=>{n.edgeQueue.push(d)},c=d=>{var g,b;const{nodeLookup:h,nodeOrigin:p}=e.getState(),m=xl(d)?d:h.get(d.id),f=m.parentId?bc(m.position,m.measured,m.parentId,h,p):m.position,y={id:m.id,position:f,width:((g=m.measured)==null?void 0:g.width)??m.width,height:((b=m.measured)==null?void 0:b.height)??m.height,data:m.data};return Qt(y)},l=(d,h,p={replace:!1})=>{s(m=>m.map(f=>{if(f.id===d){const y=typeof h=="function"?h(f):h;return p.replace&&xl(y)?y:{...f,...y}}return f}))},u=(d,h,p={replace:!1})=>{a(m=>m.map(f=>{if(f.id===d){const y=typeof h=="function"?h(f):h;return p.replace&&a1(y)?y:{...f,...y}}return f}))};return{getNodes:()=>e.getState().nodes.map(d=>({...d})),getNode:d=>{var h;return(h=o(d))==null?void 0:h.internals.userNode},getInternalNode:o,getEdges:()=>{const{edges:d=[]}=e.getState();return d.map(h=>({...h}))},getEdge:d=>e.getState().edgeLookup.get(d),setNodes:s,setEdges:a,addNodes:d=>{const h=Array.isArray(d)?d:[d];n.nodeQueue.push(p=>[...p,...h])},addEdges:d=>{const h=Array.isArray(d)?d:[d];n.edgeQueue.push(p=>[...p,...h])},toObject:()=>{const{nodes:d=[],edges:h=[],transform:p}=e.getState(),[m,f,y]=p;return{nodes:d.map(g=>({...g})),edges:h.map(g=>({...g})),viewport:{x:m,y:f,zoom:y}}},deleteElements:async({nodes:d=[],edges:h=[]})=>{const{nodes:p,edges:m,onNodesDelete:f,onEdgesDelete:y,triggerNodeChanges:g,triggerEdgeChanges:b,onDelete:x,onBeforeDelete:v}=e.getState(),{nodes:C,edges:T}=await j0({nodesToRemove:d,edgesToRemove:h,nodes:p,edges:m,onBeforeDelete:v}),S=T.length>0,j=C.length>0;if(S){const $=T.map(gl);y==null||y(T),b($)}if(j){const $=C.map(gl);f==null||f(C),g($)}return(j||S)&&(x==null||x({nodes:C,edges:T})),{deletedNodes:C,deletedEdges:T}},getIntersectingNodes:(d,h=!0,p)=>{const m=gc(d),f=m?d:c(d),y=p!==void 0;return f?(p||e.getState().nodes).filter(g=>{const b=e.getState().nodeLookup.get(g.id);if(b&&!m&&(g.id===d.id||!b.internals.positionAbsolute))return!1;const x=Qt(y?g:b),v=$n(x,f);return h&&v>0||v>=f.width*f.height}):[]},isNodeIntersecting:(d,h,p=!0)=>{const m=gc(d)?d:c(d);if(!m)return!1;const f=$n(m,h);return p&&f>0||f>=m.width*m.height},updateNode:l,updateNodeData:(d,h,p={replace:!1})=>{l(d,m=>{const f=typeof h=="function"?h(m):h;return p.replace?{...m,data:f}:{...m,data:{...m.data,...f}}},p)},updateEdge:u,updateEdgeData:(d,h,p={replace:!1})=>{u(d,m=>{const f=typeof h=="function"?h(m):h;return p.replace?{...m,data:f}:{...m,data:{...m.data,...f}}},p)},getNodesBounds:d=>{const{nodeLookup:h,nodeOrigin:p}=e.getState();return k0(d,{nodeLookup:h,nodeOrigin:p})},getHandleConnections:({type:d,id:h,nodeId:p})=>{var m;return Array.from(((m=e.getState().connectionLookup.get(`${p}-${d}-${h??null}`))==null?void 0:m.values())??[])}}},[]);return M.useMemo(()=>({...i,...t,viewportInitialized:r}),[r])};const Ml=t=>t.selected,p1={actInsideInputWithModifier:!1},f1=typeof window<"u"?window:void 0;function m1({deleteKeyCode:t,multiSelectionKeyCode:e}){const n=ge(),{deleteElements:r}=ur(),i=zn(t,p1),o=zn(e,{target:f1});M.useEffect(()=>{if(i){const{edges:s,nodes:a}=n.getState();r({nodes:a.filter(Ml),edges:s.filter(Ml)}),n.setState({nodesSelectionActive:!1})}},[i]),M.useEffect(()=>{n.setState({multiSelectionActive:o})},[o])}function y1(t){const e=ge();M.useEffect(()=>{const n=()=>{var i,o;if(!t.current)return!1;const r=zr(t.current);(r.height===0||r.width===0)&&((o=(i=e.getState()).onError)==null||o.call(i,"004",ot.error004())),e.setState({width:r.width||500,height:r.height||500})};if(t.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(t.current),()=>{window.removeEventListener("resize",n),r&&t.current&&r.unobserve(t.current)}}},[])}const Qr={position:"absolute",width:"100%",height:"100%",top:0,left:0},g1=t=>({userSelectionActive:t.userSelectionActive,lib:t.lib});function x1({onPaneContextMenu:t,zoomOnScroll:e=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:i=.5,panOnScrollMode:o=wt.Free,zoomOnDoubleClick:s=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:l,minZoom:u,maxZoom:d,zoomActivationKeyCode:h,preventScrolling:p=!0,children:m,noWheelClassName:f,noPanClassName:y,onViewportChange:g,isControlledViewport:b,paneClickDistance:x}){const v=ge(),C=M.useRef(null),{userSelectionActive:T,lib:S}=de(g1,be),j=zn(h),$=M.useRef();y1(C);const B=M.useCallback(V=>{g==null||g({x:V[0],y:V[1],zoom:V[2]}),b||v.setState({transform:V})},[g,b]);return M.useEffect(()=>{if(C.current){$.current=hx({domNode:C.current,minZoom:u,maxZoom:d,translateExtent:l,viewport:c,paneClickDistance:x,onDraggingChange:w=>v.setState({paneDragging:w}),onPanZoomStart:(w,N)=>{const{onViewportChangeStart:_,onMoveStart:R}=v.getState();R==null||R(w,N),_==null||_(N)},onPanZoom:(w,N)=>{const{onViewportChange:_,onMove:R}=v.getState();R==null||R(w,N),_==null||_(N)},onPanZoomEnd:(w,N)=>{const{onViewportChangeEnd:_,onMoveEnd:R}=v.getState();R==null||R(w,N),_==null||_(N)}});const{x:V,y:F,zoom:z}=$.current.getViewport();return v.setState({panZoom:$.current,transform:[V,F,z],domNode:C.current.closest(".react-flow")}),()=>{var w;(w=$.current)==null||w.destroy()}}},[]),M.useEffect(()=>{var V;(V=$.current)==null||V.update({onPaneContextMenu:t,zoomOnScroll:e,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:i,panOnScrollMode:o,zoomOnDoubleClick:s,panOnDrag:a,zoomActivationKeyPressed:j,preventScrolling:p,noPanClassName:y,userSelectionActive:T,noWheelClassName:f,lib:S,onTransformChange:B})},[t,e,n,r,i,o,s,a,j,p,y,T,f,S,B]),E.jsx("div",{className:"react-flow__renderer",ref:C,style:Qr,children:m})}const v1=t=>({userSelectionActive:t.userSelectionActive,userSelectionRect:t.userSelectionRect});function b1(){const{userSelectionActive:t,userSelectionRect:e}=de(v1,be);return t&&e?E.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const wo=(t,e)=>n=>{n.target===e.current&&(t==null||t(n))},w1=t=>({userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable,dragging:t.paneDragging});function M1({isSelecting:t,selectionKeyPressed:e,selectionMode:n=jn.Full,panOnDrag:r,selectionOnDrag:i,onSelectionStart:o,onSelectionEnd:s,onPaneClick:a,onPaneContextMenu:c,onPaneScroll:l,onPaneMouseEnter:u,onPaneMouseMove:d,onPaneMouseLeave:h,children:p}){const m=M.useRef(null),f=ge(),y=M.useRef(0),g=M.useRef(0),b=M.useRef(),x=M.useRef(new Map),{userSelectionActive:v,elementsSelectable:C,dragging:T}=de(w1,be),S=C&&(t||v),j=M.useRef(!1),$=M.useRef(!1),B=()=>{f.setState({userSelectionActive:!1,userSelectionRect:null}),y.current=0,g.current=0},V=A=>{if(j.current){j.current=!1;return}a==null||a(A),f.getState().resetSelectedElements(),f.setState({nodesSelectionActive:!1})},F=A=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){A.preventDefault();return}c==null||c(A)},z=l?A=>l(A):void 0,w=A=>{var X,q,ee,ne;const{resetSelectedElements:P,domNode:L,edgeLookup:W}=f.getState();if(b.current=L==null?void 0:L.getBoundingClientRect(),!C||!t||A.button!==0||A.target!==m.current||!b.current)return;(q=(X=A.target)==null?void 0:X.setPointerCapture)==null||q.call(X,A.pointerId),$.current=!0,j.current=!1,x.current=new Map;for(const[H,ae]of W)x.current.set(ae.source,((ee=x.current.get(ae.source))==null?void 0:ee.add(H))||new Set([H])),x.current.set(ae.target,((ne=x.current.get(ae.target))==null?void 0:ne.add(H))||new Set([H]));const{x:I,y:J}=at(A.nativeEvent,b.current);P(),f.setState({userSelectionRect:{width:0,height:0,startX:I,startY:J,x:I,y:J}}),o==null||o(A)},N=A=>{const{userSelectionRect:P,edgeLookup:L,transform:W,nodeLookup:I,triggerNodeChanges:J,triggerEdgeChanges:X}=f.getState();if(!b.current||!P)return;j.current=!0;const{x:q,y:ee}=at(A.nativeEvent,b.current),{startX:ne,startY:H}=P,ae={startX:ne,startY:H,x:q<ne?q:ne,y:ee<H?ee:H,width:Math.abs(q-ne),height:Math.abs(ee-H)},oe=dc(I,ae,W,n===jn.Partial,!0),ce=new Set,se=new Set;for(const pe of oe){se.add(pe.id);const ye=x.current.get(pe.id);if(ye)for(const Ie of ye)ce.add(Ie)}if(y.current!==se.size){y.current=se.size;const pe=Kt(I,se,!0);J(pe)}if(g.current!==ce.size){g.current=ce.size;const pe=Kt(L,ce);X(pe)}f.setState({userSelectionRect:ae,userSelectionActive:!0,nodesSelectionActive:!1})},_=A=>{var L,W;if(A.button!==0||!$.current)return;(W=(L=A.target)==null?void 0:L.releasePointerCapture)==null||W.call(L,A.pointerId);const{userSelectionRect:P}=f.getState();!v&&P&&A.target===m.current&&(V==null||V(A)),y.current>0&&f.setState({nodesSelectionActive:!0}),B(),s==null||s(A),(e||i)&&(j.current=!1),$.current=!1},R=r===!0||Array.isArray(r)&&r.includes(0);return E.jsxs("div",{className:_e(["react-flow__pane",{draggable:R,dragging:T,selection:t}]),onClick:S?void 0:wo(V,m),onContextMenu:wo(F,m),onWheel:wo(z,m),onPointerEnter:S?void 0:u,onPointerDown:S?w:d,onPointerMove:S?N:d,onPointerUp:S?_:void 0,onPointerLeave:h,ref:m,style:Qr,children:[p,E.jsx(b1,{})]})}function Mo({id:t,store:e,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:i,unselectNodesAndEdges:o,multiSelectionActive:s,nodeLookup:a,onError:c}=e.getState(),l=a.get(t);if(!l){c==null||c("012",ot.error012(t));return}e.setState({nodesSelectionActive:!1}),l.selected?(n||l.selected&&s)&&(o({nodes:[l],edges:[]}),requestAnimationFrame(()=>{var u;return(u=r==null?void 0:r.current)==null?void 0:u.blur()})):i([t])}function El({nodeRef:t,disabled:e=!1,noDragClassName:n,handleSelector:r,nodeId:i,isSelectable:o,nodeClickDistance:s}){const a=ge(),[c,l]=M.useState(!1),u=M.useRef();return M.useEffect(()=>{u.current=K0({getStoreItems:()=>a.getState(),onNodeMouseDown:d=>{Mo({id:d,store:a,nodeRef:t})},onDragStart:()=>{l(!0)},onDragStop:()=>{l(!1)}})},[]),M.useEffect(()=>{var d,h;if(e)(d=u.current)==null||d.destroy();else if(t.current)return(h=u.current)==null||h.update({noDragClassName:n,handleSelector:r,domNode:t.current,isSelectable:o,nodeId:i,nodeClickDistance:s}),()=>{var p;(p=u.current)==null||p.destroy()}},[n,r,e,o,t,i]),c}const E1=t=>e=>e.selected&&(e.draggable||t&&typeof e.draggable>"u");function Cl(){const t=ge();return M.useCallback(e=>{const{nodeExtent:n,snapToGrid:r,snapGrid:i,nodesDraggable:o,onError:s,updateNodePositions:a,nodeLookup:c,nodeOrigin:l}=t.getState(),u=new Map,d=E1(o),h=r?i[0]:5,p=r?i[1]:5,m=e.direction.x*h*e.factor,f=e.direction.y*p*e.factor;for(const[,y]of c){if(!d(y))continue;let g={x:y.internals.positionAbsolute.x+m,y:y.internals.positionAbsolute.y+f};r&&(g=Lr(g,i));const{position:b,positionAbsolute:x}=hc({nodeId:y.id,nextPosition:g,nodeLookup:c,nodeExtent:n,nodeOrigin:l,onError:s});y.position=b,y.internals.positionAbsolute=x,u.set(y.id,y)}a(u)},[])}const Eo=M.createContext(null),C1=Eo.Provider;Eo.Consumer;const Co=()=>M.useContext(Eo),_1=t=>({connectOnClick:t.connectOnClick,noPanClassName:t.noPanClassName,rfId:t.rfId}),S1=(t,e,n)=>r=>{const{connectionClickStartHandle:i,connectionMode:o,connection:s}=r,{fromHandle:a,toHandle:c,isValid:l}=s,u=(c==null?void 0:c.nodeId)===t&&(c==null?void 0:c.id)===e&&(c==null?void 0:c.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===t&&(a==null?void 0:a.id)===e&&(a==null?void 0:a.type)===n,connectingTo:u,clickConnecting:(i==null?void 0:i.nodeId)===t&&(i==null?void 0:i.id)===e&&(i==null?void 0:i.type)===n,isPossibleEndHandle:o===Ht.Strict?(a==null?void 0:a.type)!==n:t!==(a==null?void 0:a.nodeId)||e!==(a==null?void 0:a.id),connectionInProcess:!!a,valid:u&&l}};function O1({type:t="source",position:e=re.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:o=!0,id:s,onConnect:a,children:c,className:l,onMouseDown:u,onTouchStart:d,...h},p){var w,N;const m=s||null,f=t==="target",y=ge(),g=Co(),{connectOnClick:b,noPanClassName:x,rfId:v}=de(_1,be),{connectingFrom:C,connectingTo:T,clickConnecting:S,isPossibleEndHandle:j,connectionInProcess:$,valid:B}=de(S1(g,m,t),be);g||((N=(w=y.getState()).onError)==null||N.call(w,"010",ot.error010()));const V=_=>{const{defaultEdgeOptions:R,onConnect:A,hasDefaultEdges:P}=y.getState(),L={...R,..._};if(P){const{edges:W,setEdges:I}=y.getState();I(Ac(L,W))}A==null||A(L),a==null||a(L)},F=_=>{if(!g)return;const R=Mc(_.nativeEvent);if(i&&(R&&_.button===0||!R)){const A=y.getState();yo.onPointerDown(_.nativeEvent,{autoPanOnConnect:A.autoPanOnConnect,connectionMode:A.connectionMode,connectionRadius:A.connectionRadius,domNode:A.domNode,nodeLookup:A.nodeLookup,lib:A.lib,isTarget:f,handleId:m,nodeId:g,flowId:A.rfId,panBy:A.panBy,cancelConnection:A.cancelConnection,onConnectStart:A.onConnectStart,onConnectEnd:A.onConnectEnd,updateConnection:A.updateConnection,onConnect:V,isValidConnection:n||A.isValidConnection,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,autoPanSpeed:A.autoPanSpeed})}R?u==null||u(_):d==null||d(_)},z=_=>{const{onClickConnectStart:R,onClickConnectEnd:A,connectionClickStartHandle:P,connectionMode:L,isValidConnection:W,lib:I,rfId:J,nodeLookup:X,connection:q}=y.getState();if(!g||!P&&!i)return;if(!P){R==null||R(_.nativeEvent,{nodeId:g,handleId:m,handleType:t}),y.setState({connectionClickStartHandle:{nodeId:g,type:t,id:m}});return}const ee=wc(_.target),ne=n||W,{connection:H,isValid:ae}=yo.isValid(_.nativeEvent,{handle:{nodeId:g,id:m,type:t},connectionMode:L,fromNodeId:P.nodeId,fromHandleId:P.id||null,fromType:P.type,isValidConnection:ne,flowId:J,doc:ee,lib:I,nodeLookup:X});ae&&H&&V(H);const oe=structuredClone(q);delete oe.inProgress,oe.toPosition=oe.toHandle?oe.toHandle.position:null,A==null||A(_,oe),y.setState({connectionClickStartHandle:null})};return E.jsx("div",{"data-handleid":m,"data-nodeid":g,"data-handlepos":e,"data-id":`${v}-${g}-${m}-${t}`,className:_e(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",x,l,{source:!f,target:f,connectable:r,connectablestart:i,connectableend:o,clickconnecting:S,connectingfrom:C,connectingto:T,valid:B,connectionindicator:r&&(!$||j)&&($?o:i)}]),onMouseDown:F,onTouchStart:F,onClick:b?z:void 0,ref:p,...h,children:c})}xn=M.memo(vl(O1));function A1({data:t,isConnectable:e,sourcePosition:n=re.Bottom}){return E.jsxs(E.Fragment,{children:[t==null?void 0:t.label,E.jsx(xn,{type:"source",position:n,isConnectable:e})]})}function N1({data:t,isConnectable:e,targetPosition:n=re.Top,sourcePosition:r=re.Bottom}){return E.jsxs(E.Fragment,{children:[E.jsx(xn,{type:"target",position:n,isConnectable:e}),t==null?void 0:t.label,E.jsx(xn,{type:"source",position:r,isConnectable:e})]})}function P1(){return null}function k1({data:t,isConnectable:e,targetPosition:n=re.Top}){return E.jsxs(E.Fragment,{children:[E.jsx(xn,{type:"target",position:n,isConnectable:e}),t==null?void 0:t.label]})}const Zr={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},_l={input:A1,default:N1,output:k1,group:P1};function T1(t){var e,n,r,i;return t.internals.handleBounds===void 0?{width:t.width??t.initialWidth??((e=t.style)==null?void 0:e.width),height:t.height??t.initialHeight??((n=t.style)==null?void 0:n.height)}:{width:t.width??((r=t.style)==null?void 0:r.width),height:t.height??((i=t.style)==null?void 0:i.height)}}const j1=t=>{const{width:e,height:n,x:r,y:i}=In(t.nodeLookup,{filter:o=>!!o.selected});return{width:Ue(e)?e:null,height:Ue(n)?n:null,userSelectionActive:t.userSelectionActive,transformString:`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]}) translate(${r}px,${i}px)`}};function R1({onSelectionContextMenu:t,noPanClassName:e,disableKeyboardA11y:n}){const r=ge(),{width:i,height:o,transformString:s,userSelectionActive:a}=de(j1,be),c=Cl(),l=M.useRef(null);if(M.useEffect(()=>{var h;n||((h=l.current)==null||h.focus({preventScroll:!0}))},[n]),El({nodeRef:l}),a||!i||!o)return null;const u=t?h=>{const p=r.getState().nodes.filter(m=>m.selected);t(h,p)}:void 0,d=h=>{Object.prototype.hasOwnProperty.call(Zr,h.key)&&c({direction:Zr[h.key],factor:h.shiftKey?4:1})};return E.jsx("div",{className:_e(["react-flow__nodesselection","react-flow__container",e]),style:{transform:s},children:E.jsx("div",{ref:l,className:"react-flow__nodesselection-rect",onContextMenu:u,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:i,height:o}})})}const Sl=typeof window<"u"?window:void 0,I1=t=>({nodesSelectionActive:t.nodesSelectionActive,userSelectionActive:t.userSelectionActive});function Ol({children:t,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:o,onPaneScroll:s,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:l,selectionOnDrag:u,selectionMode:d,onSelectionStart:h,onSelectionEnd:p,multiSelectionKeyCode:m,panActivationKeyCode:f,zoomActivationKeyCode:y,elementsSelectable:g,zoomOnScroll:b,zoomOnPinch:x,panOnScroll:v,panOnScrollSpeed:C,panOnScrollMode:T,zoomOnDoubleClick:S,panOnDrag:j,defaultViewport:$,translateExtent:B,minZoom:V,maxZoom:F,preventScrolling:z,onSelectionContextMenu:w,noWheelClassName:N,noPanClassName:_,disableKeyboardA11y:R,onViewportChange:A,isControlledViewport:P}){const{nodesSelectionActive:L,userSelectionActive:W}=de(I1),I=zn(l,{target:Sl}),J=zn(f,{target:Sl}),X=J||j,q=J||v,ee=u&&X!==!0,ne=I||W||ee;return m1({deleteKeyCode:c,multiSelectionKeyCode:m}),E.jsx(x1,{onPaneContextMenu:o,elementsSelectable:g,zoomOnScroll:b,zoomOnPinch:x,panOnScroll:q,panOnScrollSpeed:C,panOnScrollMode:T,zoomOnDoubleClick:S,panOnDrag:!I&&X,defaultViewport:$,translateExtent:B,minZoom:V,maxZoom:F,zoomActivationKeyCode:y,preventScrolling:z,noWheelClassName:N,noPanClassName:_,onViewportChange:A,isControlledViewport:P,paneClickDistance:a,children:E.jsxs(M1,{onSelectionStart:h,onSelectionEnd:p,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:o,onPaneScroll:s,panOnDrag:X,isSelecting:!!ne,selectionMode:d,selectionKeyPressed:I,selectionOnDrag:ee,children:[t,L&&E.jsx(R1,{onSelectionContextMenu:w,noPanClassName:_,disableKeyboardA11y:R})]})})}Ol.displayName="FlowRenderer";const $1=M.memo(Ol),B1=t=>e=>t?dc(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(n=>n.id):Array.from(e.nodeLookup.keys());function L1(t){return de(M.useCallback(B1(t),[t]),be)}const D1=t=>t.updateNodeInternals;function z1(){const t=de(D1),[e]=M.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(i=>{const o=i.target.getAttribute("data-id");r.set(o,{id:o,nodeElement:i.target,force:!0})}),t(r)}));return M.useEffect(()=>()=>{e==null||e.disconnect()},[e]),e}function F1({node:t,nodeType:e,hasDimensions:n,resizeObserver:r}){const i=ge(),o=M.useRef(null),s=M.useRef(null),a=M.useRef(t.sourcePosition),c=M.useRef(t.targetPosition),l=M.useRef(e),u=n&&!!t.internals.handleBounds;return M.useEffect(()=>{o.current&&!t.hidden&&(!u||s.current!==o.current)&&(s.current&&(r==null||r.unobserve(s.current)),r==null||r.observe(o.current),s.current=o.current)},[u,t.hidden]),M.useEffect(()=>()=>{s.current&&(r==null||r.unobserve(s.current),s.current=null)},[]),M.useEffect(()=>{if(o.current){const d=l.current!==e,h=a.current!==t.sourcePosition,p=c.current!==t.targetPosition;(d||h||p)&&(l.current=e,a.current=t.sourcePosition,c.current=t.targetPosition,i.getState().updateNodeInternals(new Map([[t.id,{id:t.id,nodeElement:o.current,force:!0}]])))}},[t.id,e,t.sourcePosition,t.targetPosition]),o}function V1({id:t,onClick:e,onMouseEnter:n,onMouseMove:r,onMouseLeave:i,onContextMenu:o,onDoubleClick:s,nodesDraggable:a,elementsSelectable:c,nodesConnectable:l,nodesFocusable:u,resizeObserver:d,noDragClassName:h,noPanClassName:p,disableKeyboardA11y:m,rfId:f,nodeTypes:y,nodeExtent:g,nodeClickDistance:b,onError:x}){const{node:v,internals:C,isParent:T}=de(H=>{const ae=H.nodeLookup.get(t),oe=H.parentLookup.has(t);return{node:ae,internals:ae.internals,isParent:oe}},be);let S=v.type||"default",j=(y==null?void 0:y[S])||_l[S];j===void 0&&(x==null||x("003",ot.error003(S)),S="default",j=_l.default);const $=!!(v.draggable||a&&typeof v.draggable>"u"),B=!!(v.selectable||c&&typeof v.selectable>"u"),V=!!(v.connectable||l&&typeof v.connectable>"u"),F=!!(v.focusable||u&&typeof v.focusable>"u"),z=ge(),w=vc(v),N=F1({node:v,nodeType:S,hasDimensions:w,resizeObserver:d}),_=El({nodeRef:N,disabled:v.hidden||!$,noDragClassName:h,handleSelector:v.dragHandle,nodeId:t,isSelectable:B,nodeClickDistance:b}),R=Cl();if(v.hidden)return null;const A=st(v),P=T1(v),L=B||$||e||n||r||i,W=n?H=>n(H,{...C.userNode}):void 0,I=r?H=>r(H,{...C.userNode}):void 0,J=i?H=>i(H,{...C.userNode}):void 0,X=o?H=>o(H,{...C.userNode}):void 0,q=s?H=>s(H,{...C.userNode}):void 0,ee=H=>{const{selectNodesOnDrag:ae,nodeDragThreshold:oe}=z.getState();B&&(!ae||!$||oe>0)&&Mo({id:t,store:z,nodeRef:N}),e&&e(H,{...C.userNode})},ne=H=>{if(!(so(H.nativeEvent)||m))if(oc.includes(H.key)&&B){const ae=H.key==="Escape";Mo({id:t,store:z,unselect:ae,nodeRef:N})}else $&&v.selected&&Object.prototype.hasOwnProperty.call(Zr,H.key)&&(z.setState({ariaLiveMessage:`Moved selected node ${H.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~C.positionAbsolute.x}, y: ${~~C.positionAbsolute.y}`}),R({direction:Zr[H.key],factor:H.shiftKey?4:1}))};return E.jsx("div",{className:_e(["react-flow__node",`react-flow__node-${S}`,{[p]:$},v.className,{selected:v.selected,selectable:B,parent:T,draggable:$,dragging:_}]),ref:N,style:{zIndex:C.z,transform:`translate(${C.positionAbsolute.x}px,${C.positionAbsolute.y}px)`,pointerEvents:L?"all":"none",visibility:w?"visible":"hidden",...v.style,...P},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:W,onMouseMove:I,onMouseLeave:J,onContextMenu:X,onClick:ee,onDoubleClick:q,onKeyDown:F?ne:void 0,tabIndex:F?0:void 0,role:F?"button":void 0,"aria-describedby":m?void 0:`${sl}-${f}`,"aria-label":v.ariaLabel,children:E.jsx(C1,{value:t,children:E.jsx(j,{id:t,data:v.data,type:S,positionAbsoluteX:C.positionAbsolute.x,positionAbsoluteY:C.positionAbsolute.y,selected:v.selected,selectable:B,draggable:$,deletable:v.deletable??!0,isConnectable:V,sourcePosition:v.sourcePosition,targetPosition:v.targetPosition,dragging:_,dragHandle:v.dragHandle,zIndex:C.z,parentId:v.parentId,...A})})})}const q1=t=>({nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,nodesFocusable:t.nodesFocusable,elementsSelectable:t.elementsSelectable,onError:t.onError});function Al(t){const{nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,onError:o}=de(q1,be),s=L1(t.onlyRenderVisibleElements),a=z1();return E.jsx("div",{className:"react-flow__nodes",style:Qr,children:s.map(c=>E.jsx(V1,{id:c,nodeTypes:t.nodeTypes,nodeExtent:t.nodeExtent,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,resizeObserver:a,nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,nodeClickDistance:t.nodeClickDistance,onError:o},c))})}Al.displayName="NodeRenderer";const W1=M.memo(Al);function H1(t){return de(M.useCallback(e=>{if(!t)return e.edges.map(r=>r.id);const n=[];if(e.width&&e.height)for(const r of e.edges){const i=e.nodeLookup.get(r.source),o=e.nodeLookup.get(r.target);i&&o&&B0({sourceNode:i,targetNode:o,width:e.width,height:e.height,transform:e.transform})&&n.push(r.id)}return n},[t]),be)}const U1=({color:t="none",strokeWidth:e=1})=>E.jsx("polyline",{style:{stroke:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),Q1=({color:t="none",strokeWidth:e=1})=>E.jsx("polyline",{style:{stroke:t,fill:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),Nl={[Rr.Arrow]:U1,[Rr.ArrowClosed]:Q1};function Z1(t){const e=ge();return M.useMemo(()=>{var n,r;return Object.prototype.hasOwnProperty.call(Nl,t)?Nl[t]:((r=(n=e.getState()).onError)==null||r.call(n,"009",ot.error009(t)),null)},[t])}const Y1=({id:t,type:e,color:n,width:r=12.5,height:i=12.5,markerUnits:o="strokeWidth",strokeWidth:s,orient:a="auto-start-reverse"})=>{const c=Z1(e);return c?E.jsx("marker",{className:"react-flow__arrowhead",id:t,markerWidth:`${r}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:o,orient:a,refX:"0",refY:"0",children:E.jsx(c,{color:n,strokeWidth:s})}):null},Pl=({defaultColor:t,rfId:e})=>{const n=de(o=>o.edges),r=de(o=>o.defaultEdgeOptions),i=M.useMemo(()=>W0(n,{id:e,defaultColor:t,defaultMarkerStart:r==null?void 0:r.markerStart,defaultMarkerEnd:r==null?void 0:r.markerEnd}),[n,r,e,t]);return i.length?E.jsx("svg",{className:"react-flow__marker",children:E.jsx("defs",{children:i.map(o=>E.jsx(Y1,{id:o.id,type:o.type,color:o.color,width:o.width,height:o.height,markerUnits:o.markerUnits,strokeWidth:o.strokeWidth,orient:o.orient},o.id))})}):null};Pl.displayName="MarkerDefinitions";var X1=M.memo(Pl);function kl({x:t,y:e,label:n,labelStyle:r={},labelShowBg:i=!0,labelBgStyle:o={},labelBgPadding:s=[2,4],labelBgBorderRadius:a=2,children:c,className:l,...u}){const[d,h]=M.useState({x:1,y:0,width:0,height:0}),p=_e(["react-flow__edge-textwrapper",l]),m=M.useRef(null);return M.useEffect(()=>{if(m.current){const f=m.current.getBBox();h({x:f.x,y:f.y,width:f.width,height:f.height})}},[n]),typeof n>"u"||!n?null:E.jsxs("g",{transform:`translate(${t-d.width/2} ${e-d.height/2})`,className:p,visibility:d.width?"visible":"hidden",...u,children:[i&&E.jsx("rect",{width:d.width+2*s[0],x:-s[0],y:-s[1],height:d.height+2*s[1],className:"react-flow__edge-textbg",style:o,rx:a,ry:a}),E.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:m,style:r,children:n}),c]})}kl.displayName="EdgeText";const G1=M.memo(kl);function Yr({id:t,path:e,labelX:n,labelY:r,label:i,labelStyle:o,labelShowBg:s,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,style:u,markerEnd:d,markerStart:h,className:p,interactionWidth:m=20}){return E.jsxs(E.Fragment,{children:[E.jsx("path",{id:t,style:u,d:e,fill:"none",className:_e(["react-flow__edge-path",p]),markerEnd:d,markerStart:h}),m&&E.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:m,className:"react-flow__edge-interaction"}),i&&Ue(n)&&Ue(r)?E.jsx(G1,{x:n,y:r,label:i,labelStyle:o,labelShowBg:s,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l}):null]})}function Tl({pos:t,x1:e,y1:n,x2:r,y2:i}){return t===re.Left||t===re.Right?[.5*(e+r),n]:[e,.5*(n+i)]}function jl({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top}){const[s,a]=Tl({pos:n,x1:t,y1:e,x2:r,y2:i}),[c,l]=Tl({pos:o,x1:r,y1:i,x2:t,y2:e}),[u,d,h,p]=Cc({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:s,sourceControlY:a,targetControlX:c,targetControlY:l});return[`M${t},${e} C${s},${a} ${c},${l} ${r},${i}`,u,d,h,p]}function Rl(t){return M.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,sourcePosition:s=re.Bottom,targetPosition:a=re.Top,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:y,interactionWidth:g})=>{const[b,x,v]=jl({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:o,targetPosition:a}),C=t.isInternal?void 0:e;return E.jsx(Yr,{id:C,path:b,labelX:x,labelY:v,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:y,interactionWidth:g})})}const K1=Rl({isInternal:!1}),Il=Rl({isInternal:!0});K1.displayName="SimpleBezierEdge",Il.displayName="SimpleBezierEdgeInternal";function $l(t){return M.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,sourcePosition:p=re.Bottom,targetPosition:m=re.Top,markerEnd:f,markerStart:y,pathOptions:g,interactionWidth:b})=>{const[x,v,C]=ao({sourceX:n,sourceY:r,sourcePosition:p,targetX:i,targetY:o,targetPosition:m,borderRadius:g==null?void 0:g.borderRadius,offset:g==null?void 0:g.offset}),T=t.isInternal?void 0:e;return E.jsx(Yr,{id:T,path:x,labelX:v,labelY:C,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:y,interactionWidth:b})})}const Bl=$l({isInternal:!1}),Ll=$l({isInternal:!0});Bl.displayName="SmoothStepEdge",Ll.displayName="SmoothStepEdgeInternal";function Dl(t){return M.memo(({id:e,...n})=>{var i;const r=t.isInternal?void 0:e;return E.jsx(Bl,{...n,id:r,pathOptions:M.useMemo(()=>{var o;return{borderRadius:0,offset:(o=n.pathOptions)==null?void 0:o.offset}},[(i=n.pathOptions)==null?void 0:i.offset])})})}const J1=Dl({isInternal:!1}),zl=Dl({isInternal:!0});J1.displayName="StepEdge",zl.displayName="StepEdgeInternal";function Fl(t){return M.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,interactionWidth:f})=>{const[y,g,b]=Nc({sourceX:n,sourceY:r,targetX:i,targetY:o}),x=t.isInternal?void 0:e;return E.jsx(Yr,{id:x,path:y,labelX:g,labelY:b,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,interactionWidth:f})})}const ev=Fl({isInternal:!1}),Vl=Fl({isInternal:!0});ev.displayName="StraightEdge",Vl.displayName="StraightEdgeInternal";function ql(t){return M.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,sourcePosition:s=re.Bottom,targetPosition:a=re.Top,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:y,pathOptions:g,interactionWidth:b})=>{const[x,v,C]=Sc({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:o,targetPosition:a,curvature:g==null?void 0:g.curvature}),T=t.isInternal?void 0:e;return E.jsx(Yr,{id:T,path:x,labelX:v,labelY:C,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:y,interactionWidth:b})})}const tv=ql({isInternal:!1}),Wl=ql({isInternal:!0});tv.displayName="BezierEdge",Wl.displayName="BezierEdgeInternal";const Hl={default:Wl,straight:Vl,step:zl,smoothstep:Ll,simplebezier:Il},Ul={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},nv=(t,e,n)=>n===re.Left?t-e:n===re.Right?t+e:t,rv=(t,e,n)=>n===re.Top?t-e:n===re.Bottom?t+e:t,Ql="react-flow__edgeupdater";function Zl({position:t,centerX:e,centerY:n,radius:r=10,onMouseDown:i,onMouseEnter:o,onMouseOut:s,type:a}){return E.jsx("circle",{onMouseDown:i,onMouseEnter:o,onMouseOut:s,className:_e([Ql,`${Ql}-${a}`]),cx:nv(e,r,t),cy:rv(n,r,t),r,stroke:"transparent",fill:"transparent"})}function iv({isReconnectable:t,reconnectRadius:e,edge:n,sourceX:r,sourceY:i,targetX:o,targetY:s,sourcePosition:a,targetPosition:c,onReconnect:l,onReconnectStart:u,onReconnectEnd:d,setReconnecting:h,setUpdateHover:p}){const m=ge(),f=(v,C)=>{if(v.button!==0)return;const{autoPanOnConnect:T,domNode:S,isValidConnection:j,connectionMode:$,connectionRadius:B,lib:V,onConnectStart:F,onConnectEnd:z,cancelConnection:w,nodeLookup:N,rfId:_,panBy:R,updateConnection:A}=m.getState(),P=C.type==="target";h(!0),u==null||u(v,n,C.type);const L=(I,J)=>{h(!1),d==null||d(I,n,C.type,J)},W=I=>l==null?void 0:l(n,I);yo.onPointerDown(v.nativeEvent,{autoPanOnConnect:T,connectionMode:$,connectionRadius:B,domNode:S,handleId:C.id,nodeId:C.nodeId,nodeLookup:N,isTarget:P,edgeUpdaterType:C.type,lib:V,flowId:_,cancelConnection:w,panBy:R,isValidConnection:j,onConnect:W,onConnectStart:F,onConnectEnd:z,onReconnectEnd:L,updateConnection:A,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle})},y=v=>f(v,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),g=v=>f(v,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),b=()=>p(!0),x=()=>p(!1);return E.jsxs(E.Fragment,{children:[(t===!0||t==="source")&&E.jsx(Zl,{position:a,centerX:r,centerY:i,radius:e,onMouseDown:y,onMouseEnter:b,onMouseOut:x,type:"source"}),(t===!0||t==="target")&&E.jsx(Zl,{position:c,centerX:o,centerY:s,radius:e,onMouseDown:g,onMouseEnter:b,onMouseOut:x,type:"target"})]})}function ov({id:t,edgesFocusable:e,edgesReconnectable:n,elementsSelectable:r,onClick:i,onDoubleClick:o,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,reconnectRadius:u,onReconnect:d,onReconnectStart:h,onReconnectEnd:p,rfId:m,edgeTypes:f,noPanClassName:y,onError:g,disableKeyboardA11y:b}){let x=de(se=>se.edgeLookup.get(t));const v=de(se=>se.defaultEdgeOptions);x=v?{...v,...x}:x;let C=x.type||"default",T=(f==null?void 0:f[C])||Hl[C];T===void 0&&(g==null||g("011",ot.error011(C)),C="default",T=Hl.default);const S=!!(x.focusable||e&&typeof x.focusable>"u"),j=typeof d<"u"&&(x.reconnectable||n&&typeof x.reconnectable>"u"),$=!!(x.selectable||r&&typeof x.selectable>"u"),B=M.useRef(null),[V,F]=M.useState(!1),[z,w]=M.useState(!1),N=ge(),{zIndex:_,sourceX:R,sourceY:A,targetX:P,targetY:L,sourcePosition:W,targetPosition:I}=de(M.useCallback(se=>{const pe=se.nodeLookup.get(x.source),ye=se.nodeLookup.get(x.target);if(!pe||!ye)return{zIndex:x.zIndex,...Ul};const Ie=q0({id:t,sourceNode:pe,targetNode:ye,sourceHandle:x.sourceHandle||null,targetHandle:x.targetHandle||null,connectionMode:se.connectionMode,onError:g});return{zIndex:$0({selected:x.selected,zIndex:x.zIndex,sourceNode:pe,targetNode:ye,elevateOnSelect:se.elevateEdgesOnSelect}),...Ie||Ul}},[x.source,x.target,x.sourceHandle,x.targetHandle,x.selected,x.zIndex]),be),J=M.useMemo(()=>x.markerStart?`url('#${co(x.markerStart,m)}')`:void 0,[x.markerStart,m]),X=M.useMemo(()=>x.markerEnd?`url('#${co(x.markerEnd,m)}')`:void 0,[x.markerEnd,m]);if(x.hidden||R===null||A===null||P===null||L===null)return null;const q=se=>{var ut;const{addSelectedEdges:pe,unselectNodesAndEdges:ye,multiSelectionActive:Ie}=N.getState();$&&(N.setState({nodesSelectionActive:!1}),x.selected&&Ie?(ye({nodes:[],edges:[x]}),(ut=B.current)==null||ut.blur()):pe([t])),i&&i(se,x)},ee=o?se=>{o(se,{...x})}:void 0,ne=s?se=>{s(se,{...x})}:void 0,H=a?se=>{a(se,{...x})}:void 0,ae=c?se=>{c(se,{...x})}:void 0,oe=l?se=>{l(se,{...x})}:void 0,ce=se=>{var pe;if(!b&&oc.includes(se.key)&&$){const{unselectNodesAndEdges:ye,addSelectedEdges:Ie}=N.getState();se.key==="Escape"?((pe=B.current)==null||pe.blur(),ye({edges:[x]})):Ie([t])}};return E.jsx("svg",{style:{zIndex:_},children:E.jsxs("g",{className:_e(["react-flow__edge",`react-flow__edge-${C}`,x.className,y,{selected:x.selected,animated:x.animated,inactive:!$&&!i,updating:V,selectable:$}]),onClick:q,onDoubleClick:ee,onContextMenu:ne,onMouseEnter:H,onMouseMove:ae,onMouseLeave:oe,onKeyDown:S?ce:void 0,tabIndex:S?0:void 0,role:S?"button":"img","data-id":t,"data-testid":`rf__edge-${t}`,"aria-label":x.ariaLabel===null?void 0:x.ariaLabel||`Edge from ${x.source} to ${x.target}`,"aria-describedby":S?`${al}-${m}`:void 0,ref:B,children:[!z&&E.jsx(T,{id:t,source:x.source,target:x.target,type:x.type,selected:x.selected,animated:x.animated,selectable:$,deletable:x.deletable??!0,label:x.label,labelStyle:x.labelStyle,labelShowBg:x.labelShowBg,labelBgStyle:x.labelBgStyle,labelBgPadding:x.labelBgPadding,labelBgBorderRadius:x.labelBgBorderRadius,sourceX:R,sourceY:A,targetX:P,targetY:L,sourcePosition:W,targetPosition:I,data:x.data,style:x.style,sourceHandleId:x.sourceHandle,targetHandleId:x.targetHandle,markerStart:J,markerEnd:X,pathOptions:"pathOptions"in x?x.pathOptions:void 0,interactionWidth:x.interactionWidth}),j&&E.jsx(iv,{edge:x,isReconnectable:j,reconnectRadius:u,onReconnect:d,onReconnectStart:h,onReconnectEnd:p,sourceX:R,sourceY:A,targetX:P,targetY:L,sourcePosition:W,targetPosition:I,setUpdateHover:F,setReconnecting:w})]})})}const sv=t=>({width:t.width,height:t.height,edgesFocusable:t.edgesFocusable,edgesReconnectable:t.edgesReconnectable,elementsSelectable:t.elementsSelectable,connectionMode:t.connectionMode,onError:t.onError});function Yl({defaultMarkerColor:t,onlyRenderVisibleElements:e,rfId:n,edgeTypes:r,noPanClassName:i,onReconnect:o,onEdgeContextMenu:s,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:l,onEdgeClick:u,reconnectRadius:d,onEdgeDoubleClick:h,onReconnectStart:p,onReconnectEnd:m,disableKeyboardA11y:f}){const{edgesFocusable:y,edgesReconnectable:g,elementsSelectable:b,onError:x}=de(sv,be),v=H1(e);return E.jsxs("div",{className:"react-flow__edges",children:[E.jsx(X1,{defaultColor:t,rfId:n}),v.map(C=>E.jsx(ov,{id:C,edgesFocusable:y,edgesReconnectable:g,elementsSelectable:b,noPanClassName:i,onReconnect:o,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,onClick:u,reconnectRadius:d,onDoubleClick:h,onReconnectStart:p,onReconnectEnd:m,rfId:n,onError:x,edgeTypes:r,disableKeyboardA11y:f},C))]})}Yl.displayName="EdgeRenderer";const av=M.memo(Yl),cv=t=>`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`;function lv({children:t}){const e=de(cv);return E.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:t})}function uv(t){const e=ur(),n=M.useRef(!1);M.useEffect(()=>{!n.current&&e.viewportInitialized&&t&&(setTimeout(()=>t(e),1),n.current=!0)},[t,e.viewportInitialized])}const dv=t=>{var e;return(e=t.panZoom)==null?void 0:e.syncViewport};function hv(t){const e=de(dv),n=ge();return M.useEffect(()=>{t&&(e==null||e(t),n.setState({transform:[t.x,t.y,t.zoom]}))},[t,e]),null}function pv(t){return t.connection.inProgress?{...t.connection,to:Bn(t.connection.to,t.transform)}:{...t.connection}}function fv(t){return pv}function mv(t){const e=fv();return de(e,be)}const yv=t=>({nodesConnectable:t.nodesConnectable,isValid:t.connection.isValid,inProgress:t.connection.inProgress,width:t.width,height:t.height});function gv({containerStyle:t,style:e,type:n,component:r}){const{nodesConnectable:i,width:o,height:s,isValid:a,inProgress:c}=de(yv,be);return o&&i&&c?E.jsx("svg",{style:t,width:o,height:s,className:"react-flow__connectionline react-flow__container",children:E.jsx("g",{className:_e(["react-flow__connection",lc(a)]),children:E.jsx(Xl,{style:e,type:n,CustomComponent:r,isValid:a})})}):null}const Xl=({style:t,type:e=ht.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:i,from:o,fromNode:s,fromHandle:a,fromPosition:c,to:l,toNode:u,toHandle:d,toPosition:h}=mv();if(!i)return;if(n)return E.jsx(n,{connectionLineType:e,connectionLineStyle:t,fromNode:s,fromHandle:a,fromX:o.x,fromY:o.y,toX:l.x,toY:l.y,fromPosition:c,toPosition:h,connectionStatus:lc(r),toNode:u,toHandle:d});let p="";const m={sourceX:o.x,sourceY:o.y,sourcePosition:c,targetX:l.x,targetY:l.y,targetPosition:h};switch(e){case ht.Bezier:[p]=Sc(m);break;case ht.SimpleBezier:[p]=jl(m);break;case ht.Step:[p]=ao({...m,borderRadius:0});break;case ht.SmoothStep:[p]=ao(m);break;default:[p]=Nc(m)}return E.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:t})};Xl.displayName="ConnectionLine";const xv={};function Gl(t=xv){M.useRef(t),ge(),M.useEffect(()=>{},[t])}function vv(){ge(),M.useRef(!1),M.useEffect(()=>{},[])}function Kl({nodeTypes:t,edgeTypes:e,onInit:n,onNodeClick:r,onEdgeClick:i,onNodeDoubleClick:o,onEdgeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:u,onSelectionContextMenu:d,onSelectionStart:h,onSelectionEnd:p,connectionLineType:m,connectionLineStyle:f,connectionLineComponent:y,connectionLineContainerStyle:g,selectionKeyCode:b,selectionOnDrag:x,selectionMode:v,multiSelectionKeyCode:C,panActivationKeyCode:T,zoomActivationKeyCode:S,deleteKeyCode:j,onlyRenderVisibleElements:$,elementsSelectable:B,defaultViewport:V,translateExtent:F,minZoom:z,maxZoom:w,preventScrolling:N,defaultMarkerColor:_,zoomOnScroll:R,zoomOnPinch:A,panOnScroll:P,panOnScrollSpeed:L,panOnScrollMode:W,zoomOnDoubleClick:I,panOnDrag:J,onPaneClick:X,onPaneMouseEnter:q,onPaneMouseMove:ee,onPaneMouseLeave:ne,onPaneScroll:H,onPaneContextMenu:ae,paneClickDistance:oe,nodeClickDistance:ce,onEdgeContextMenu:se,onEdgeMouseEnter:pe,onEdgeMouseMove:ye,onEdgeMouseLeave:Ie,reconnectRadius:ut,onReconnect:pn,onReconnectStart:fn,onReconnectEnd:mn,noDragClassName:gt,noWheelClassName:Tt,noPanClassName:jt,disableKeyboardA11y:Rt,nodeExtent:er,rfId:It,viewport:Qe,onViewportChange:yn}){return Gl(t),Gl(e),vv(),uv(n),hv(Qe),E.jsx($1,{onPaneClick:X,onPaneMouseEnter:q,onPaneMouseMove:ee,onPaneMouseLeave:ne,onPaneContextMenu:ae,onPaneScroll:H,paneClickDistance:oe,deleteKeyCode:j,selectionKeyCode:b,selectionOnDrag:x,selectionMode:v,onSelectionStart:h,onSelectionEnd:p,multiSelectionKeyCode:C,panActivationKeyCode:T,zoomActivationKeyCode:S,elementsSelectable:B,zoomOnScroll:R,zoomOnPinch:A,zoomOnDoubleClick:I,panOnScroll:P,panOnScrollSpeed:L,panOnScrollMode:W,panOnDrag:J,defaultViewport:V,translateExtent:F,minZoom:z,maxZoom:w,onSelectionContextMenu:d,preventScrolling:N,noDragClassName:gt,noWheelClassName:Tt,noPanClassName:jt,disableKeyboardA11y:Rt,onViewportChange:yn,isControlledViewport:!!Qe,children:E.jsxs(lv,{children:[E.jsx(av,{edgeTypes:e,onEdgeClick:i,onEdgeDoubleClick:s,onReconnect:pn,onReconnectStart:fn,onReconnectEnd:mn,onlyRenderVisibleElements:$,onEdgeContextMenu:se,onEdgeMouseEnter:pe,onEdgeMouseMove:ye,onEdgeMouseLeave:Ie,reconnectRadius:ut,defaultMarkerColor:_,noPanClassName:jt,disableKeyboardA11y:Rt,rfId:It}),E.jsx(gv,{style:f,type:m,component:y,containerStyle:g}),E.jsx("div",{className:"react-flow__edgelabel-renderer"}),E.jsx(W1,{nodeTypes:t,onNodeClick:r,onNodeDoubleClick:o,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:u,nodeClickDistance:ce,onlyRenderVisibleElements:$,noPanClassName:jt,noDragClassName:gt,disableKeyboardA11y:Rt,nodeExtent:er,rfId:It}),E.jsx("div",{className:"react-flow__viewport-portal"})]})})}Kl.displayName="GraphView";const bv=M.memo(Kl),Jl=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c}={})=>{const l=new Map,u=new Map,d=new Map,h=new Map,p=r??e??[],m=n??t??[],f=a??[0,0],y=c??Tn;$c(d,h,p),ho(m,l,u,{nodeOrigin:f,nodeExtent:y,elevateNodesOnSelect:!1});let g=[0,0,1];if(s&&i&&o){const b=In(l,{filter:T=>!!((T.width||T.initialWidth)&&(T.height||T.initialHeight))}),{x,y:v,zoom:C}=oo(b,i,o,.5,2,.1);g=[x,v,C]}return{rfId:"1",width:0,height:0,transform:g,nodes:m,nodeLookup:l,parentLookup:u,edges:p,edgeLookup:h,connectionLookup:d,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:.5,maxZoom:2,translateExtent:Tn,nodeExtent:y,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Ht.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:f,nodeDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,fitViewOnInit:!1,fitViewDone:!1,fitViewOnInitOptions:void 0,selectNodesOnDrag:!0,multiSelectionActive:!1,connection:{...sc},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanSpeed:15,connectionRadius:20,onError:R0,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1}},wv=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c})=>zx((l,u)=>({...Jl({nodes:t,edges:e,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c,defaultNodes:n,defaultEdges:r}),setNodes:d=>{const{nodeLookup:h,parentLookup:p,nodeOrigin:m,elevateNodesOnSelect:f}=u();ho(d,h,p,{nodeOrigin:m,nodeExtent:c,elevateNodesOnSelect:f,checkEquality:!0}),l({nodes:d})},setEdges:d=>{const{connectionLookup:h,edgeLookup:p}=u();$c(h,p,d),l({edges:d})},setDefaultNodesAndEdges:(d,h)=>{if(d){const{setNodes:p}=u();p(d),l({hasDefaultNodes:!0})}if(h){const{setEdges:p}=u();p(h),l({hasDefaultEdges:!0})}},updateNodeInternals:(d,h={triggerFitView:!0})=>{const{triggerNodeChanges:p,nodeLookup:m,parentLookup:f,fitViewOnInit:y,fitViewDone:g,fitViewOnInitOptions:b,domNode:x,nodeOrigin:v,nodeExtent:C,debug:T,fitViewSync:S}=u(),{changes:j,updatedInternals:$}=Y0(d,m,f,x,v,C);if($){if(U0(m,f,{nodeOrigin:v,nodeExtent:C}),h.triggerFitView){let B=g;!g&&y&&(B=S({...b,nodes:b==null?void 0:b.nodes})),l({fitViewDone:B})}else l({});(j==null?void 0:j.length)>0&&(T&&console.log("React Flow: trigger node changes",j),p==null||p(j))}},updateNodePositions:(d,h=!1)=>{const p=[],m=[];for(const[f,y]of d){const g={id:f,type:"position",position:y.position,dragging:h};y!=null&&y.expandParent&&(y!=null&&y.parentId)&&g.position&&(p.push({id:f,parentId:y.parentId,rect:{...y.internals.positionAbsolute,width:y.measured.width,height:y.measured.height}}),g.position.x=Math.max(0,g.position.x),g.position.y=Math.max(0,g.position.y)),m.push(g)}if(p.length>0){const{nodeLookup:f,parentLookup:y,nodeOrigin:g}=u(),b=fo(p,f,y,g);m.push(...b)}u().triggerNodeChanges(m)},triggerNodeChanges:d=>{const{onNodesChange:h,setNodes:p,nodes:m,hasDefaultNodes:f,debug:y}=u();if(d!=null&&d.length){if(f){const g=bt(d,m);p(g)}y&&console.log("React Flow: trigger node changes",d),h==null||h(d)}},triggerEdgeChanges:d=>{const{onEdgesChange:h,setEdges:p,edges:m,hasDefaultEdges:f,debug:y}=u();if(d!=null&&d.length){if(f){const g=Fn(d,m);p(g)}y&&console.log("React Flow: trigger edge changes",d),h==null||h(d)}},addSelectedNodes:d=>{const{multiSelectionActive:h,edgeLookup:p,nodeLookup:m,triggerNodeChanges:f,triggerEdgeChanges:y}=u();if(h){const g=d.map(b=>St(b,!0));f(g);return}f(Kt(m,new Set([...d]),!0)),y(Kt(p))},addSelectedEdges:d=>{const{multiSelectionActive:h,edgeLookup:p,nodeLookup:m,triggerNodeChanges:f,triggerEdgeChanges:y}=u();if(h){const g=d.map(b=>St(b,!0));y(g);return}y(Kt(p,new Set([...d]))),f(Kt(m,new Set,!0))},unselectNodesAndEdges:({nodes:d,edges:h}={})=>{const{edges:p,nodes:m,nodeLookup:f,triggerNodeChanges:y,triggerEdgeChanges:g}=u(),b=d||m,x=h||p,v=b.map(T=>{const S=f.get(T.id);return S&&(S.selected=!1),St(T.id,!1)}),C=x.map(T=>St(T.id,!1));y(v),g(C)},setMinZoom:d=>{const{panZoom:h,maxZoom:p}=u();h==null||h.setScaleExtent([d,p]),l({minZoom:d})},setMaxZoom:d=>{const{panZoom:h,minZoom:p}=u();h==null||h.setScaleExtent([p,d]),l({maxZoom:d})},setTranslateExtent:d=>{var h;(h=u().panZoom)==null||h.setTranslateExtent(d),l({translateExtent:d})},setPaneClickDistance:d=>{var h;(h=u().panZoom)==null||h.setClickDistance(d)},resetSelectedElements:()=>{const{edges:d,nodes:h,triggerNodeChanges:p,triggerEdgeChanges:m}=u(),f=h.reduce((g,b)=>b.selected?[...g,St(b.id,!1)]:g,[]),y=d.reduce((g,b)=>b.selected?[...g,St(b.id,!1)]:g,[]);p(f),m(y)},setNodeExtent:d=>{const{nodes:h,nodeLookup:p,parentLookup:m,nodeOrigin:f,elevateNodesOnSelect:y,nodeExtent:g}=u();d[0][0]===g[0][0]&&d[0][1]===g[0][1]&&d[1][0]===g[1][0]&&d[1][1]===g[1][1]||(ho(h,p,m,{nodeOrigin:f,nodeExtent:d,elevateNodesOnSelect:y,checkEquality:!1}),l({nodeExtent:d}))},panBy:d=>{const{transform:h,width:p,height:m,panZoom:f,translateExtent:y}=u();return X0({delta:d,panZoom:f,transform:h,translateExtent:y,width:p,height:m})},fitView:d=>{const{panZoom:h,width:p,height:m,minZoom:f,maxZoom:y,nodeLookup:g}=u();if(!h)return Promise.resolve(!1);const b=no(g,d);return ro({nodes:b,width:p,height:m,panZoom:h,minZoom:f,maxZoom:y},d)},fitViewSync:d=>{const{panZoom:h,width:p,height:m,minZoom:f,maxZoom:y,nodeLookup:g}=u();if(!h)return!1;const b=no(g,d);return ro({nodes:b,width:p,height:m,panZoom:h,minZoom:f,maxZoom:y},d),b.size>0},cancelConnection:()=>{l({connection:{...sc}})},updateConnection:d=>{l({connection:d})},reset:()=>l({...Jl()})}),Object.is);function Mv({initialNodes:t,initialEdges:e,defaultNodes:n,defaultEdges:r,initialWidth:i,initialHeight:o,fitView:s,nodeOrigin:a,nodeExtent:c,children:l}){const[u]=M.useState(()=>wv({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c}));return E.jsx(Fx,{value:u,children:E.jsx(u1,{children:l})})}function Ev({children:t,nodes:e,edges:n,defaultNodes:r,defaultEdges:i,width:o,height:s,fitView:a,nodeOrigin:c,nodeExtent:l}){return M.useContext(Hr)?E.jsx(E.Fragment,{children:t}):E.jsx(Mv,{initialNodes:e,initialEdges:n,defaultNodes:r,defaultEdges:i,initialWidth:o,initialHeight:s,fitView:a,nodeOrigin:c,nodeExtent:l,children:t})}const Cv={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function _v({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,className:i,nodeTypes:o,edgeTypes:s,onNodeClick:a,onEdgeClick:c,onInit:l,onMove:u,onMoveStart:d,onMoveEnd:h,onConnect:p,onConnectStart:m,onConnectEnd:f,onClickConnectStart:y,onClickConnectEnd:g,onNodeMouseEnter:b,onNodeMouseMove:x,onNodeMouseLeave:v,onNodeContextMenu:C,onNodeDoubleClick:T,onNodeDragStart:S,onNodeDrag:j,onNodeDragStop:$,onNodesDelete:B,onEdgesDelete:V,onDelete:F,onSelectionChange:z,onSelectionDragStart:w,onSelectionDrag:N,onSelectionDragStop:_,onSelectionContextMenu:R,onSelectionStart:A,onSelectionEnd:P,onBeforeDelete:L,connectionMode:W,connectionLineType:I=ht.Bezier,connectionLineStyle:J,connectionLineComponent:X,connectionLineContainerStyle:q,deleteKeyCode:ee="Backspace",selectionKeyCode:ne="Shift",selectionOnDrag:H=!1,selectionMode:ae=jn.Full,panActivationKeyCode:oe="Space",multiSelectionKeyCode:ce=Dr()?"Meta":"Control",zoomActivationKeyCode:se=Dr()?"Meta":"Control",snapToGrid:pe,snapGrid:ye,onlyRenderVisibleElements:Ie=!1,selectNodesOnDrag:ut,nodesDraggable:pn,nodesConnectable:fn,nodesFocusable:mn,nodeOrigin:gt=cl,edgesFocusable:Tt,edgesReconnectable:jt,elementsSelectable:Rt=!0,defaultViewport:er=e1,minZoom:It=.5,maxZoom:Qe=2,translateExtent:yn=Tn,preventScrolling:Ss=!0,nodeExtent:tr,defaultMarkerColor:nr="#b1b1b7",zoomOnScroll:O=!0,zoomOnPinch:k=!0,panOnScroll:D=!1,panOnScrollSpeed:U=.5,panOnScrollMode:ie=wt.Free,zoomOnDoubleClick:Oe=!0,panOnDrag:Ce=!0,onPaneClick:ue,onPaneMouseEnter:Z,onPaneMouseMove:G,onPaneMouseLeave:K,onPaneScroll:te,onPaneContextMenu:he,paneClickDistance:fe=0,nodeClickDistance:Me=0,children:ze,onReconnect:xi,onReconnectStart:Os,onReconnectEnd:As,onEdgeContextMenu:fO,onEdgeDoubleClick:mO,onEdgeMouseEnter:yO,onEdgeMouseMove:gO,onEdgeMouseLeave:xO,reconnectRadius:vO=10,onNodesChange:bO,onEdgesChange:wO,noDragClassName:MO="nodrag",noWheelClassName:EO="nowheel",noPanClassName:xf="nopan",fitView:vf,fitViewOptions:CO,connectOnClick:_O,attributionPosition:SO,proOptions:OO,defaultEdgeOptions:AO,elevateNodesOnSelect:NO,elevateEdgesOnSelect:PO,disableKeyboardA11y:bf=!1,autoPanOnConnect:kO,autoPanOnNodeDrag:TO,autoPanSpeed:jO,connectionRadius:RO,isValidConnection:IO,onError:$O,style:BO,id:wf,nodeDragThreshold:LO,viewport:DO,onViewportChange:zO,width:FO,height:VO,colorMode:qO="light",debug:WO,...HO},UO){const Ns=wf||"1",QO=i1(qO);return E.jsx("div",{...HO,style:{...BO,...Cv},ref:UO,className:_e(["react-flow",i,QO]),"data-testid":"rf__wrapper",id:wf,children:E.jsxs(Ev,{nodes:t,edges:e,width:FO,height:VO,fitView:vf,nodeOrigin:gt,nodeExtent:tr,children:[E.jsx(bv,{onInit:l,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:b,onNodeMouseMove:x,onNodeMouseLeave:v,onNodeContextMenu:C,onNodeDoubleClick:T,nodeTypes:o,edgeTypes:s,connectionLineType:I,connectionLineStyle:J,connectionLineComponent:X,connectionLineContainerStyle:q,selectionKeyCode:ne,selectionOnDrag:H,selectionMode:ae,deleteKeyCode:ee,multiSelectionKeyCode:ce,panActivationKeyCode:oe,zoomActivationKeyCode:se,onlyRenderVisibleElements:Ie,defaultViewport:er,translateExtent:yn,minZoom:It,maxZoom:Qe,preventScrolling:Ss,zoomOnScroll:O,zoomOnPinch:k,zoomOnDoubleClick:Oe,panOnScroll:D,panOnScrollSpeed:U,panOnScrollMode:ie,panOnDrag:Ce,onPaneClick:ue,onPaneMouseEnter:Z,onPaneMouseMove:G,onPaneMouseLeave:K,onPaneScroll:te,onPaneContextMenu:he,paneClickDistance:fe,nodeClickDistance:Me,onSelectionContextMenu:R,onSelectionStart:A,onSelectionEnd:P,onReconnect:xi,onReconnectStart:Os,onReconnectEnd:As,onEdgeContextMenu:fO,onEdgeDoubleClick:mO,onEdgeMouseEnter:yO,onEdgeMouseMove:gO,onEdgeMouseLeave:xO,reconnectRadius:vO,defaultMarkerColor:nr,noDragClassName:MO,noWheelClassName:EO,noPanClassName:xf,rfId:Ns,disableKeyboardA11y:bf,nodeExtent:tr,viewport:DO,onViewportChange:zO}),E.jsx(r1,{nodes:t,edges:e,defaultNodes:n,defaultEdges:r,onConnect:p,onConnectStart:m,onConnectEnd:f,onClickConnectStart:y,onClickConnectEnd:g,nodesDraggable:pn,nodesConnectable:fn,nodesFocusable:mn,edgesFocusable:Tt,edgesReconnectable:jt,elementsSelectable:Rt,elevateNodesOnSelect:NO,elevateEdgesOnSelect:PO,minZoom:It,maxZoom:Qe,nodeExtent:tr,onNodesChange:bO,onEdgesChange:wO,snapToGrid:pe,snapGrid:ye,connectionMode:W,translateExtent:yn,connectOnClick:_O,defaultEdgeOptions:AO,fitView:vf,fitViewOptions:CO,onNodesDelete:B,onEdgesDelete:V,onDelete:F,onNodeDragStart:S,onNodeDrag:j,onNodeDragStop:$,onSelectionDrag:N,onSelectionDragStart:w,onSelectionDragStop:_,onMove:u,onMoveStart:d,onMoveEnd:h,noPanClassName:xf,nodeOrigin:gt,rfId:Ns,autoPanOnConnect:kO,autoPanOnNodeDrag:TO,autoPanSpeed:jO,onError:$O,connectionRadius:RO,isValidConnection:IO,selectNodesOnDrag:ut,nodeDragThreshold:LO,onBeforeDelete:L,paneClickDistance:fe,debug:WO}),E.jsx(Jx,{onSelectionChange:z}),ze,E.jsx(Zx,{proOptions:OO,position:SO}),E.jsx(Ux,{rfId:Ns,disableKeyboardA11y:bf})]})})}$f=vl(_v);const Sv=t=>{var e;return(e=t.domNode)==null?void 0:e.querySelector(".react-flow__viewport-portal")};Rf=function({children:t}){const e=de(Sv);return e?JO.createPortal(t,e):null};const Ov=t=>t.nodes;jf=function(){return de(Ov,be)},qf=function({type:t,id:e=null,nodeId:n,onConnect:r,onDisconnect:i}){const o=Co(),s=n??o,a=M.useRef(null),c=de(l=>l.connectionLookup.get(`${s}-${t}-${e}`),N0);return M.useEffect(()=>{if(a.current&&a.current!==c){const l=c??new Map;cc(a.current,l,i),cc(l,a.current,r)}a.current=c??new Map},[c,r,i]),M.useMemo(()=>Array.from((c==null?void 0:c.values())??[]),[c])},Qf=function(t){return de(M.useCallback(e=>e.nodeLookup.get(t),[t]),be)};function Av({dimensions:t,lineWidth:e,variant:n,className:r}){return E.jsx("path",{strokeWidth:e,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`,className:_e(["react-flow__background-pattern",n,r])})}function Nv({radius:t,className:e}){return E.jsx("circle",{cx:t,cy:t,r:t,className:_e(["react-flow__background-pattern","dots",e])})}(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(dt||(dt={}));const Pv={[dt.Dots]:1,[dt.Lines]:1,[dt.Cross]:6},kv=t=>({transform:t.transform,patternId:`pattern-${t.rfId}`});function eu({id:t,variant:e=dt.Dots,gap:n=20,size:r,lineWidth:i=1,offset:o=0,color:s,bgColor:a,style:c,className:l,patternClassName:u}){const d=M.useRef(null),{transform:h,patternId:p}=de(kv,be),m=r||Pv[e],f=e===dt.Dots,y=e===dt.Cross,g=Array.isArray(n)?n:[n,n],b=[g[0]*h[2]||1,g[1]*h[2]||1],x=m*h[2],v=Array.isArray(o)?o:[o,o],C=y?[x,x]:b,T=[v[0]*h[2]||1+C[0]/2,v[1]*h[2]||1+C[1]/2],S=`${p}${t||""}`;return E.jsxs("svg",{className:_e(["react-flow__background",l]),style:{...c,...Qr,"--xy-background-color-props":a,"--xy-background-pattern-color-props":s},ref:d,"data-testid":"rf__background",children:[E.jsx("pattern",{id:S,x:h[0]%b[0],y:h[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${T[0]},-${T[1]})`,children:f?E.jsx(Nv,{radius:x/2,className:u}):E.jsx(Av,{dimensions:C,lineWidth:i,variant:e,className:u})}),E.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${S})`})]})}eu.displayName="Background",Bf=M.memo(eu);function Tv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:E.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function jv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:E.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Rv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:E.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Iv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:E.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function $v(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:E.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Xr({children:t,className:e,...n}){return E.jsx("button",{type:"button",className:_e(["react-flow__controls-button",e]),...n,children:t})}const Bv=t=>({isInteractive:t.nodesDraggable||t.nodesConnectable||t.elementsSelectable,minZoomReached:t.transform[2]<=t.minZoom,maxZoomReached:t.transform[2]>=t.maxZoom});function tu({style:t,showZoom:e=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:o,onZoomOut:s,onFitView:a,onInteractiveChange:c,className:l,children:u,position:d="bottom-left",orientation:h="vertical","aria-label":p="React Flow controls"}){const m=ge(),{isInteractive:f,minZoomReached:y,maxZoomReached:g}=de(Bv,be),{zoomIn:b,zoomOut:x,fitView:v}=ur(),C=()=>{b(),o==null||o()},T=()=>{x(),s==null||s()},S=()=>{v(i),a==null||a()},j=()=>{m.setState({nodesDraggable:!f,nodesConnectable:!f,elementsSelectable:!f}),c==null||c(!f)},$=h==="horizontal"?"horizontal":"vertical";return E.jsxs(cr,{className:_e(["react-flow__controls",$,l]),position:d,style:t,"data-testid":"rf__controls","aria-label":p,children:[e&&E.jsxs(E.Fragment,{children:[E.jsx(Xr,{onClick:C,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:g,children:E.jsx(Tv,{})}),E.jsx(Xr,{onClick:T,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y,children:E.jsx(jv,{})})]}),n&&E.jsx(Xr,{className:"react-flow__controls-fitview",onClick:S,title:"fit view","aria-label":"fit view",children:E.jsx(Rv,{})}),r&&E.jsx(Xr,{className:"react-flow__controls-interactive",onClick:j,title:"toggle interactivity","aria-label":"toggle interactivity",children:f?E.jsx($v,{}):E.jsx(Iv,{})}),u]})}tu.displayName="Controls",Lf=M.memo(tu);function Lv({id:t,x:e,y:n,width:r,height:i,style:o,color:s,strokeColor:a,strokeWidth:c,className:l,borderRadius:u,shapeRendering:d,selected:h,onClick:p}){const{background:m,backgroundColor:f}=o||{},y=s||m||f;return E.jsx("rect",{className:_e(["react-flow__minimap-node",{selected:h},l]),x:e,y:n,rx:u,ry:u,width:r,height:i,style:{fill:y,stroke:a,strokeWidth:c},shapeRendering:d,onClick:p?g=>p(g,t):void 0})}const Dv=M.memo(Lv),zv=t=>t.nodes.map(e=>e.id),_o=t=>t instanceof Function?t:()=>t;function Fv({nodeStrokeColor:t,nodeColor:e,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:o=Dv,onClick:s}){const a=de(zv,be),c=_o(e),l=_o(t),u=_o(n),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return E.jsx(E.Fragment,{children:a.map(h=>E.jsx(qv,{id:h,nodeColorFunc:c,nodeStrokeColorFunc:l,nodeClassNameFunc:u,nodeBorderRadius:r,nodeStrokeWidth:i,NodeComponent:o,onClick:s,shapeRendering:d},h))})}function Vv({id:t,nodeColorFunc:e,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:i,nodeStrokeWidth:o,shapeRendering:s,NodeComponent:a,onClick:c}){const{node:l,x:u,y:d,width:h,height:p}=de(m=>{const f=m.nodeLookup.get(t),{x:y,y:g}=f.internals.positionAbsolute,{width:b,height:x}=st(f);return{node:f,x:y,y:g,width:b,height:x}},be);return!l||l.hidden||!vc(l)?null:E.jsx(a,{x:u,y:d,width:h,height:p,style:l.style,selected:!!l.selected,className:r(l),color:e(l),borderRadius:i,strokeColor:n(l),strokeWidth:o,shapeRendering:s,onClick:c,id:l.id})}const qv=M.memo(Vv);var Wv=M.memo(Fv);const Hv=200,Uv=150,Qv=t=>{const e={x:-t.transform[0]/t.transform[2],y:-t.transform[1]/t.transform[2],width:t.width/t.transform[2],height:t.height/t.transform[2]};return{viewBB:e,boundingRect:t.nodeLookup.size>0?yc(In(t.nodeLookup),e):e,rfId:t.rfId,panZoom:t.panZoom,translateExtent:t.translateExtent,flowWidth:t.width,flowHeight:t.height}},Zv="react-flow__minimap-desc";function nu({style:t,className:e,nodeStrokeColor:n,nodeColor:r,nodeClassName:i="",nodeBorderRadius:o=5,nodeStrokeWidth:s,nodeComponent:a,bgColor:c,maskColor:l,maskStrokeColor:u,maskStrokeWidth:d,position:h="bottom-right",onClick:p,onNodeClick:m,pannable:f=!1,zoomable:y=!1,ariaLabel:g="React Flow mini map",inversePan:b,zoomStep:x=10,offsetScale:v=5}){const C=ge(),T=M.useRef(null),{boundingRect:S,viewBB:j,rfId:$,panZoom:B,translateExtent:V,flowWidth:F,flowHeight:z}=de(Qv,be),w=(t==null?void 0:t.width)??Hv,N=(t==null?void 0:t.height)??Uv,_=S.width/w,R=S.height/N,A=Math.max(_,R),P=A*w,L=A*N,W=v*A,I=S.x-(P-S.width)/2-W,J=S.y-(L-S.height)/2-W,X=P+W*2,q=L+W*2,ee=`${Zv}-${$}`,ne=M.useRef(0),H=M.useRef();ne.current=A,M.useEffect(()=>{if(T.current&&B)return H.current=ix({domNode:T.current,panZoom:B,getTransform:()=>C.getState().transform,getViewScale:()=>ne.current}),()=>{var ce;(ce=H.current)==null||ce.destroy()}},[B]),M.useEffect(()=>{var ce;(ce=H.current)==null||ce.update({translateExtent:V,width:F,height:z,inversePan:b,pannable:f,zoomStep:x,zoomable:y})},[f,y,b,x,V,F,z]);const ae=p?ce=>{var ye;const[se,pe]=((ye=H.current)==null?void 0:ye.pointer(ce))||[0,0];p(ce,{x:se,y:pe})}:void 0,oe=m?M.useCallback((ce,se)=>{const pe=C.getState().nodeLookup.get(se);m(ce,pe)},[]):void 0;return E.jsx(cr,{position:h,style:{...t,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*A:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof s=="string"?s:void 0},className:_e(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:E.jsxs("svg",{width:w,height:N,viewBox:`${I} ${J} ${X} ${q}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":ee,ref:T,onClick:ae,children:[g&&E.jsx("title",{id:ee,children:g}),E.jsx(Wv,{onClick:oe,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:o,nodeClassName:i,nodeStrokeWidth:s,nodeComponent:a}),E.jsx("path",{className:"react-flow__minimap-mask",d:`M${I-W},${J-W}h${X+W*2}v${q+W*2}h${-X-W*2}z
        M${j.x},${j.y}h${j.width}v${j.height}h${-j.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}nu.displayName="MiniMap",Df=M.memo(nu);function Yv({nodeId:t,position:e,variant:n=Xt.Handle,className:r,style:i={},children:o,color:s,minWidth:a=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:d=!1,shouldResize:h,onResizeStart:p,onResize:m,onResizeEnd:f}){const y=Co(),g=typeof t=="string"?t:y,b=ge(),x=M.useRef(null),v=n===Xt.Line?"right":"bottom-right",C=e??v,T=M.useRef(null);M.useEffect(()=>{if(!(!x.current||!g))return T.current||(T.current=wx({domNode:x.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:B,transform:V,snapGrid:F,snapToGrid:z,nodeOrigin:w,domNode:N}=b.getState();return{nodeLookup:B,transform:V,snapGrid:F,snapToGrid:z,nodeOrigin:w,paneDomNode:N}},onChange:(B,V)=>{const{triggerNodeChanges:F,nodeLookup:z,parentLookup:w,nodeOrigin:N}=b.getState(),_=[],R={x:B.x,y:B.y},A=z.get(g);if(A&&A.expandParent&&A.parentId){const P=A.origin??N,L=B.width??A.measured.width,W=B.height??A.measured.height,I={id:A.id,parentId:A.parentId,rect:{width:L,height:W,...bc({x:B.x??A.position.x,y:B.y??A.position.y},{width:L,height:W},A.parentId,z,P)}},J=fo([I],z,w,N);_.push(...J),R.x=B.x?Math.max(P[0]*L,B.x):void 0,R.y=B.y?Math.max(P[1]*W,B.y):void 0}if(R.x!==void 0&&R.y!==void 0){const P={id:g,type:"position",position:{...R}};_.push(P)}if(B.width!==void 0&&B.height!==void 0){const P={id:g,type:"dimensions",resizing:!0,setAttributes:!0,dimensions:{width:B.width,height:B.height}};_.push(P)}for(const P of V){const L={...P,type:"position"};_.push(L)}F(_)},onEnd:()=>{const B={id:g,type:"dimensions",resizing:!1};b.getState().triggerNodeChanges([B])}})),T.current.update({controlPosition:C,boundaries:{minWidth:a,minHeight:c,maxWidth:l,maxHeight:u},keepAspectRatio:d,onResizeStart:p,onResize:m,onResizeEnd:f,shouldResize:h}),()=>{var B;(B=T.current)==null||B.destroy()}},[C,a,c,l,u,d,p,m,f,h]);const S=C.split("-"),j=n===Xt.Line?"borderColor":"backgroundColor",$=s?{...i,[j]:s}:i;return E.jsx("div",{className:_e(["react-flow__resize-control","nodrag",...S,n,r]),ref:x,style:$,children:o})}const ru=M.memo(Yv);Tf=function({nodeId:t,isVisible:e=!0,handleClassName:n,handleStyle:r,lineClassName:i,lineStyle:o,color:s,minWidth:a=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:d=!1,shouldResize:h,onResizeStart:p,onResize:m,onResizeEnd:f}){return e?E.jsxs(E.Fragment,{children:[fx.map(y=>E.jsx(ru,{className:i,style:o,nodeId:t,position:y,variant:Xt.Line,color:s,minWidth:a,minHeight:c,maxWidth:l,maxHeight:u,onResizeStart:p,keepAspectRatio:d,shouldResize:h,onResize:m,onResizeEnd:f},y)),px.map(y=>E.jsx(ru,{className:n,style:r,nodeId:t,position:y,color:s,minWidth:a,minHeight:c,maxWidth:l,maxHeight:u,onResizeStart:p,keepAspectRatio:d,shouldResize:h,onResize:m,onResizeEnd:f},y))]}):null};function Xv(){this.__data__=[],this.size=0}var Gv=Xv;function Kv(t,e){return t===e||t!==t&&e!==e}let iu;or=Kv,iu=or;function Jv(t,e){for(var n=t.length;n--;)if(iu(t[n][0],e))return n;return-1}var Gr=Jv,eb=Gr,tb=Array.prototype,nb=tb.splice;function rb(t){var e=this.__data__,n=eb(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():nb.call(e,n,1),--this.size,!0}var ib=rb,ob=Gr;function sb(t){var e=this.__data__,n=ob(e,t);return n<0?void 0:e[n][1]}var ab=sb,cb=Gr;function lb(t){return cb(this.__data__,t)>-1}var ub=lb,db=Gr;function hb(t,e){var n=this.__data__,r=db(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}var pb=hb,fb=Gv,mb=ib,yb=ab,gb=ub,xb=pb;function Jt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Jt.prototype.clear=fb,Jt.prototype.delete=mb,Jt.prototype.get=yb,Jt.prototype.has=gb,Jt.prototype.set=xb;var Kr=Jt,vb=Kr;function bb(){this.__data__=new vb,this.size=0}var wb=bb;function Mb(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}var Eb=Mb;function Cb(t){return this.__data__.get(t)}var _b=Cb;function Sb(t){return this.__data__.has(t)}let ou,su,So,au,cu,lu,uu,du,Oo,Ao,hu,pu,en;ou=Sb,su=typeof gn=="object"&&gn&&gn.Object===Object&&gn,So=su,au=So,cu=typeof self=="object"&&self&&self.Object===Object&&self,lu=au||cu||Function("return this")(),Ze=lu,uu=Ze,du=uu.Symbol,vn=du,Oo=vn,Ao=Object.prototype,hu=Ao.hasOwnProperty,pu=Ao.toString,en=Oo?Oo.toStringTag:void 0;function Ob(t){var e=hu.call(t,en),n=t[en];try{t[en]=void 0;var r=!0}catch{}var i=pu.call(t);return r&&(e?t[en]=n:delete t[en]),i}var Ab=Ob,Nb=Object.prototype,Pb=Nb.toString;function kb(t){return Pb.call(t)}var Tb=kb,fu=vn,jb=Ab,Rb=Tb,Ib="[object Null]",$b="[object Undefined]",mu=fu?fu.toStringTag:void 0;function Bb(t){return t==null?t===void 0?$b:Ib:mu&&mu in Object(t)?jb(t):Rb(t)}Bt=Bb;function Lb(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}vt=Lb,Af=Je(vt);var Db=Bt,zb=vt,Fb="[object AsyncFunction]",Vb="[object Function]",qb="[object GeneratorFunction]",Wb="[object Proxy]";function Hb(t){if(!zb(t))return!1;var e=Db(t);return e==Vb||e==qb||e==Fb||e==Wb}ar=Hb,Nf=Je(ar);var Ub=Ze,Qb=Ub["__core-js_shared__"],Zb=Qb,No=Zb,yu=function(){var t=/[^.]+$/.exec(No&&No.keys&&No.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Yb(t){return!!yu&&yu in t}var Xb=Yb,Gb=Function.prototype,Kb=Gb.toString;function Jb(t){if(t!=null){try{return Kb.call(t)}catch{}try{return t+""}catch{}}return""}var gu=Jb,ew=ar,tw=Xb,nw=vt,rw=gu,iw=/[\\^$.*+?()[\]{}|]/g,ow=/^\[object .+?Constructor\]$/,sw=Function.prototype,aw=Object.prototype,cw=sw.toString,lw=aw.hasOwnProperty,uw=RegExp("^"+cw.call(lw).replace(iw,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function dw(t){if(!nw(t)||tw(t))return!1;var e=ew(t)?uw:ow;return e.test(rw(t))}var hw=dw;function pw(t,e){return t==null?void 0:t[e]}var fw=pw,mw=hw,yw=fw;function gw(t,e){var n=yw(t,e);return mw(n)?n:void 0}var Ot=gw,xw=Ot,vw=Ze,bw=xw(vw,"Map"),Po=bw,ww=Ot,Mw=ww(Object,"create"),Jr=Mw,xu=Jr;function Ew(){this.__data__=xu?xu(null):{},this.size=0}var Cw=Ew;function _w(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Sw=_w,Ow=Jr,Aw="__lodash_hash_undefined__",Nw=Object.prototype,Pw=Nw.hasOwnProperty;function kw(t){var e=this.__data__;if(Ow){var n=e[t];return n===Aw?void 0:n}return Pw.call(e,t)?e[t]:void 0}var Tw=kw,jw=Jr,Rw=Object.prototype,Iw=Rw.hasOwnProperty;function $w(t){var e=this.__data__;return jw?e[t]!==void 0:Iw.call(e,t)}var Bw=$w,Lw=Jr,Dw="__lodash_hash_undefined__";function zw(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Lw&&e===void 0?Dw:e,this}var Fw=zw,Vw=Cw,qw=Sw,Ww=Tw,Hw=Bw,Uw=Fw;function tn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}tn.prototype.clear=Vw,tn.prototype.delete=qw,tn.prototype.get=Ww,tn.prototype.has=Hw,tn.prototype.set=Uw;var Qw=tn,vu=Qw,Zw=Kr,Yw=Po;function Xw(){this.size=0,this.__data__={hash:new vu,map:new(Yw||Zw),string:new vu}}var Gw=Xw;function Kw(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var Jw=Kw,eM=Jw;function tM(t,e){var n=t.__data__;return eM(e)?n[typeof e=="string"?"string":"hash"]:n.map}var ei=tM,nM=ei;function rM(t){var e=nM(this,t).delete(t);return this.size-=e?1:0,e}var iM=rM,oM=ei;function sM(t){return oM(this,t).get(t)}var aM=sM,cM=ei;function lM(t){return cM(this,t).has(t)}var uM=lM,dM=ei;function hM(t,e){var n=dM(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}var pM=hM,fM=Gw,mM=iM,yM=aM,gM=uM,xM=pM;function nn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}nn.prototype.clear=fM,nn.prototype.delete=mM,nn.prototype.get=yM,nn.prototype.has=gM,nn.prototype.set=xM;var ko=nn,vM=Kr,bM=Po,wM=ko,MM=200;function EM(t,e){var n=this.__data__;if(n instanceof vM){var r=n.__data__;if(!bM||r.length<MM-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new wM(r)}return n.set(t,e),this.size=n.size,this}var CM=EM,_M=Kr,SM=wb,OM=Eb,AM=_b,NM=ou,PM=CM;function rn(t){var e=this.__data__=new _M(t);this.size=e.size}rn.prototype.clear=SM,rn.prototype.delete=OM,rn.prototype.get=AM,rn.prototype.has=NM,rn.prototype.set=PM;let bu;Ni=rn,bu="__lodash_hash_undefined__";function kM(t){return this.__data__.set(t,bu),this}var TM=kM;function jM(t){return this.__data__.has(t)}var RM=jM,IM=ko,$M=TM,BM=RM;function ti(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new IM;++e<n;)this.add(t[e])}ti.prototype.add=ti.prototype.push=$M,ti.prototype.has=BM,Ls=ti;function LM(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}Hs=LM;function DM(t,e){return t.has(e)}let wu,Mu,Eu,Cu,_u;zs=DM,wu=Ls,Mu=Hs,Eu=zs,Cu=1,_u=2;function zM(t,e,n,r,i,o){var s=n&Cu,a=t.length,c=e.length;if(a!=c&&!(s&&c>a))return!1;var l=o.get(t),u=o.get(e);if(l&&u)return l==e&&u==t;var d=-1,h=!0,p=n&_u?new wu:void 0;for(o.set(t,e),o.set(e,t);++d<a;){var m=t[d],f=e[d];if(r)var y=s?r(f,m,d,e,t,o):r(m,f,d,t,e,o);if(y!==void 0){if(y)continue;h=!1;break}if(p){if(!Mu(e,function(g,b){if(!Eu(p,b)&&(m===g||i(m,g,n,r,o)))return p.push(b)})){h=!1;break}}else if(!(m===f||i(m,f,n,r,o))){h=!1;break}}return o.delete(t),o.delete(e),h}let To,Su,Ou;To=zM,Su=Ze,Ou=Su.Uint8Array,na=Ou;function FM(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}var VM=FM;function qM(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}let jo,Ro,Au,Nu,Pu,ku,Tu,ju,Ru,Iu,$u,Bu,Lu,Du,zu,Fu,Vu,qu,Wu,Io,ni;Bs=qM,jo=vn,Ro=na,Au=or,Nu=To,Pu=VM,ku=Bs,Tu=1,ju=2,Ru="[object Boolean]",Iu="[object Date]",$u="[object Error]",Bu="[object Map]",Lu="[object Number]",Du="[object RegExp]",zu="[object Set]",Fu="[object String]",Vu="[object Symbol]",qu="[object ArrayBuffer]",Wu="[object DataView]",Io=jo?jo.prototype:void 0,ni=Io?Io.valueOf:void 0;function WM(t,e,n,r,i,o,s){switch(n){case Wu:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case qu:return!(t.byteLength!=e.byteLength||!o(new Ro(t),new Ro(e)));case Ru:case Iu:case Lu:return Au(+t,+e);case $u:return t.name==e.name&&t.message==e.message;case Du:case Fu:return t==e+"";case Bu:var a=Pu;case zu:var c=r&Tu;if(a||(a=ku),t.size!=e.size&&!c)return!1;var l=s.get(t);if(l)return l==e;r|=ju,s.set(t,e);var u=Nu(a(t),a(e),r,i,o,s);return s.delete(t),u;case Vu:if(ni)return ni.call(t)==ni.call(e)}return!1}var HM=WM;function UM(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}let Hu,Uu,Qu;Ei=UM,Hu=Array.isArray,tt=Hu,Uu=Ei,Qu=tt;function QM(t,e,n){var r=e(t);return Qu(t)?r:Uu(r,n(t))}var Zu=QM;function ZM(t,e){for(var n=-1,r=t==null?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o}var YM=ZM;function XM(){return[]}let $o,Yu,Xu,Gu,Ku,Bo,Ju;$o=XM,Yu=YM,Xu=$o,Gu=Object.prototype,Ku=Gu.propertyIsEnumerable,Bo=Object.getOwnPropertySymbols,Ju=Bo?function(t){return t==null?[]:(t=Object(t),Yu(Bo(t),function(e){return Ku.call(t,e)}))}:Xu,ji=Ju;function GM(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var KM=GM;function JM(t){return t!=null&&typeof t=="object"}let ed,td,nd;zt=JM,ed=Bt,td=zt,nd="[object Arguments]";function eE(t){return td(t)&&ed(t)==nd}let rd,Lo,id,Do,od,sd,ad,Vn;rd=eE,Lo=rd,id=zt,Do=Object.prototype,od=Do.hasOwnProperty,sd=Do.propertyIsEnumerable,ad=Lo(function(){return arguments}())?Lo:function(t){return id(t)&&od.call(t,"callee")&&!sd.call(t,"callee")},Mi=ad,Vn={exports:{}};function tE(){return!1}var nE=tE;Vn.exports,function(t,e){var n=Ze,r=nE,i=e&&!e.nodeType&&e,o=i&&!0&&t&&!t.nodeType&&t,s=o&&o.exports===i,a=s?n.Buffer:void 0,c=a?a.isBuffer:void 0,l=c||r;t.exports=l}(Vn,Vn.exports);let cd,ld;Pi=Vn.exports,cd=9007199254740991,ld=/^(?:0|[1-9]\d*)$/;function rE(t,e){var n=typeof t;return e=e??cd,!!e&&(n=="number"||n!="symbol"&&ld.test(t))&&t>-1&&t%1==0&&t<e}let ud;sr=rE,ud=9007199254740991;function iE(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ud}var zo=iE,oE=Bt,sE=zo,aE=zt,cE="[object Arguments]",lE="[object Array]",uE="[object Boolean]",dE="[object Date]",hE="[object Error]",pE="[object Function]",fE="[object Map]",mE="[object Number]",yE="[object Object]",gE="[object RegExp]",xE="[object Set]",vE="[object String]",bE="[object WeakMap]",wE="[object ArrayBuffer]",ME="[object DataView]",EE="[object Float32Array]",CE="[object Float64Array]",_E="[object Int8Array]",SE="[object Int16Array]",OE="[object Int32Array]",AE="[object Uint8Array]",NE="[object Uint8ClampedArray]",PE="[object Uint16Array]",kE="[object Uint32Array]",xe={};xe[EE]=xe[CE]=xe[_E]=xe[SE]=xe[OE]=xe[AE]=xe[NE]=xe[PE]=xe[kE]=!0,xe[cE]=xe[lE]=xe[wE]=xe[uE]=xe[ME]=xe[dE]=xe[hE]=xe[pE]=xe[fE]=xe[mE]=xe[yE]=xe[gE]=xe[xE]=xe[vE]=xe[bE]=!1;function TE(t){return aE(t)&&sE(t.length)&&!!xe[oE(t)]}var jE=TE;function RE(t){return function(e){return t(e)}}let qn;Vs=RE,qn={exports:{}},qn.exports,function(t,e){var n=So,r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,o=i&&i.exports===r,s=o&&n.process,a=function(){try{var c=i&&i.require&&i.require("util").types;return c||s&&s.binding&&s.binding("util")}catch{}}();t.exports=a}(qn,qn.exports);let dd,hd,Fo,Vo,pd,fd,md,yd,gd,xd,vd,bd,wd;ia=qn.exports,dd=jE,hd=Vs,Fo=ia,Vo=Fo&&Fo.isTypedArray,pd=Vo?hd(Vo):dd,ki=pd,fd=KM,md=Mi,yd=tt,gd=Pi,xd=sr,vd=ki,bd=Object.prototype,wd=bd.hasOwnProperty;function IE(t,e){var n=yd(t),r=!n&&md(t),i=!n&&!r&&gd(t),o=!n&&!r&&!i&&vd(t),s=n||r||i||o,a=s?fd(t.length,String):[],c=a.length;for(var l in t)(e||wd.call(t,l))&&!(s&&(l=="length"||i&&(l=="offset"||l=="parent")||o&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||xd(l,c)))&&a.push(l);return a}var Md=IE,$E=Object.prototype;function BE(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||$E;return t===n}Ri=BE;function LE(t,e){return function(n){return t(e(n))}}var Ed=LE,DE=Ed,zE=DE(Object.keys,Object),FE=zE,VE=Ri,qE=FE,WE=Object.prototype,HE=WE.hasOwnProperty;function UE(t){if(!VE(t))return qE(t);var e=[];for(var n in Object(t))HE.call(t,n)&&n!="constructor"&&e.push(n);return e}var QE=UE,ZE=ar,YE=zo;function XE(t){return t!=null&&YE(t.length)&&!ZE(t)}let Cd,_d,Sd;Si=XE,Cd=Md,_d=QE,Sd=Si;function GE(t){return Sd(t)?Cd(t):_d(t)}let Od,Ad,Nd;_i=GE,Od=Zu,Ad=ji,Nd=_i;function KE(t){return Od(t,Nd,Ad)}let qo,Pd,kd,Td;Qs=KE,qo=Qs,Pd=1,kd=Object.prototype,Td=kd.hasOwnProperty;function JE(t,e,n,r,i,o){var s=n&Pd,a=qo(t),c=a.length,l=qo(e),u=l.length;if(c!=u&&!s)return!1;for(var d=c;d--;){var h=a[d];if(!(s?h in e:Td.call(e,h)))return!1}var p=o.get(t),m=o.get(e);if(p&&m)return p==e&&m==t;var f=!0;o.set(t,e),o.set(e,t);for(var y=s;++d<c;){h=a[d];var g=t[h],b=e[h];if(r)var x=s?r(b,g,h,e,t,o):r(g,b,h,t,e,o);if(!(x===void 0?g===b||i(g,b,n,r,o):x)){f=!1;break}y||(y=h=="constructor")}if(f&&!y){var v=t.constructor,C=e.constructor;v!=C&&"constructor"in t&&"constructor"in e&&!(typeof v=="function"&&v instanceof v&&typeof C=="function"&&C instanceof C)&&(f=!1)}return o.delete(t),o.delete(e),f}let jd,Rd,Id,$d,Bd,Ld,Dd,zd,Fd,Vd,qd,Wd,Hd,Ud,Qd,Zd,ri,ii,oi,si,ai,Wo,At,Ho,Yd,Uo,Qo,Zo,Yo,Xd,Gd,Kd,Jd,eh,mt;jd=JE,Rd=Ot,Id=Ze,$d=Rd(Id,"DataView"),Bd=$d,Ld=Ot,Dd=Ze,zd=Ld(Dd,"Promise"),Fd=zd,Vd=Ot,qd=Ze,Wd=Vd(qd,"Set"),$s=Wd,Hd=Ot,Ud=Ze,Qd=Hd(Ud,"WeakMap"),Zd=Qd,ri=Bd,ii=Po,oi=Fd,si=$s,ai=Zd,Wo=Bt,At=gu,Ho="[object Map]",Yd="[object Object]",Uo="[object Promise]",Qo="[object Set]",Zo="[object WeakMap]",Yo="[object DataView]",Xd=At(ri),Gd=At(ii),Kd=At(oi),Jd=At(si),eh=At(ai),mt=Wo,(ri&&mt(new ri(new ArrayBuffer(1)))!=Yo||ii&&mt(new ii)!=Ho||oi&&mt(oi.resolve())!=Uo||si&&mt(new si)!=Qo||ai&&mt(new ai)!=Zo)&&(mt=function(t){var e=Wo(t),n=e==Yd?t.constructor:void 0,r=n?At(n):"";if(r)switch(r){case Xd:return Yo;case Gd:return Ho;case Kd:return Uo;case Jd:return Qo;case eh:return Zo}return e});let ci,th,nh,rh,Xo,Go,Ko,ih,oh,Jo,es,Wn,sh,ts;ra=mt,ci=Ni,th=To,nh=HM,rh=jd,Xo=ra,Go=tt,Ko=Pi,ih=ki,oh=1,Jo="[object Arguments]",es="[object Array]",Wn="[object Object]",sh=Object.prototype,ts=sh.hasOwnProperty;function e2(t,e,n,r,i,o){var s=Go(t),a=Go(e),c=s?es:Xo(t),l=a?es:Xo(e);c=c==Jo?Wn:c,l=l==Jo?Wn:l;var u=c==Wn,d=l==Wn,h=c==l;if(h&&Ko(t)){if(!Ko(e))return!1;s=!0,u=!1}if(h&&!u)return o||(o=new ci),s||ih(t)?th(t,e,n,r,i,o):nh(t,e,c,n,r,i,o);if(!(n&oh)){var p=u&&ts.call(t,"__wrapped__"),m=d&&ts.call(e,"__wrapped__");if(p||m){var f=p?t.value():t,y=m?e.value():e;return o||(o=new ci),i(f,y,n,r,o)}}return h?(o||(o=new ci),rh(t,e,n,r,i,o)):!1}var t2=e2,n2=t2,ah=zt;function ch(t,e,n,r,i){return t===e?!0:t==null||e==null||!ah(t)&&!ah(e)?t!==t&&e!==e:n2(t,e,n,r,ch,i)}let lh,uh,dh,hh;Ai=ch,lh=Ni,uh=Ai,dh=1,hh=2;function r2(t,e,n,r){var i=n.length,o=i,s=!r;if(t==null)return!o;for(t=Object(t);i--;){var a=n[i];if(s&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<o;){a=n[i];var c=a[0],l=t[c],u=a[1];if(s&&a[2]){if(l===void 0&&!(c in t))return!1}else{var d=new lh;if(r)var h=r(l,u,c,t,e,d);if(!(h===void 0?uh(u,l,dh|hh,r,d):h))return!1}}return!0}var i2=r2,o2=vt;function s2(t){return t===t&&!o2(t)}var ph=s2,a2=ph,c2=_i;function l2(t){for(var e=c2(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,a2(i)]}return e}var u2=l2;function d2(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}var fh=d2,h2=i2,p2=u2,f2=fh;function m2(t){var e=p2(t);return e.length==1&&e[0][2]?f2(e[0][0],e[0][1]):function(n){return n===t||h2(n,t,e)}}var y2=m2,g2=Bt,x2=zt,v2="[object Symbol]";function b2(t){return typeof t=="symbol"||x2(t)&&g2(t)==v2}let mh,yh,gh,xh;rr=b2,mh=tt,yh=rr,gh=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xh=/^\w*$/;function w2(t,e){if(mh(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||yh(t)?!0:xh.test(t)||!gh.test(t)||e!=null&&t in Object(e)}var ns=w2,vh=ko,M2="Expected a function";function rs(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(M2);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=t.apply(this,r);return n.cache=o.set(i,s)||o,s};return n.cache=new(rs.Cache||vh),n}rs.Cache=vh;var bh=rs;Pf=Je(bh);var E2=bh,C2=500;function _2(t){var e=E2(t,function(r){return n.size===C2&&n.clear(),r}),n=e.cache;return e}var S2=_2,O2=S2,A2=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,N2=/\\(\\)?/g,P2=O2(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(A2,function(n,r,i,o){e.push(i?o.replace(N2,"$1"):r||n)}),e}),k2=P2;function T2(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}let is,wh,Mh,Eh,Ch,os,ss;Oi=T2,is=vn,wh=Oi,Mh=tt,Eh=rr,Ch=1/0,os=is?is.prototype:void 0,ss=os?os.toString:void 0;function _h(t){if(typeof t=="string")return t;if(Mh(t))return wh(t,_h)+"";if(Eh(t))return ss?ss.call(t):"";var e=t+"";return e=="0"&&1/t==-Ch?"-0":e}var j2=_h,R2=j2;function I2(t){return t==null?"":R2(t)}let Sh,Oh,Ah,Nh;Rs=I2,Sh=tt,Oh=ns,Ah=k2,Nh=Rs;function $2(t,e){return Sh(t)?t:Oh(t,e)?[t]:Ah(Nh(t))}let Ph,kh;bn=$2,Ph=rr,kh=1/0;function B2(t){if(typeof t=="string"||Ph(t))return t;var e=t+"";return e=="0"&&1/t==-kh?"-0":e}let Th,jh;Dt=B2,Th=bn,jh=Dt;function L2(t,e){e=Th(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[jh(e[n++])];return n&&n==r?t:void 0}let Rh;ir=L2,Rh=ir;function D2(t,e,n){var r=t==null?void 0:Rh(t,e);return r===void 0?n:r}var Ih=D2;Of=Je(Ih);function z2(t,e){return t!=null&&e in Object(t)}var F2=z2,V2=bn,q2=Mi,W2=tt,H2=sr,U2=zo,Q2=Dt;function Z2(t,e,n){e=V2(e,t);for(var r=-1,i=e.length,o=!1;++r<i;){var s=Q2(e[r]);if(!(o=t!=null&&n(t,s)))break;t=t[s]}return o||++r!=i?o:(i=t==null?0:t.length,!!i&&U2(i)&&H2(s,i)&&(W2(t)||q2(t)))}var Y2=Z2,X2=F2,G2=Y2;function K2(t,e){return t!=null&&G2(t,e,X2)}let $h,Bh,Lh,Dh,zh,Fh,Vh,qh,Wh;Gs=K2,$h=Ai,Bh=Ih,Lh=Gs,Dh=ns,zh=ph,Fh=fh,Vh=Dt,qh=1,Wh=2;function J2(t,e){return Dh(t)&&zh(e)?Fh(Vh(t),e):function(n){var r=Bh(n,t);return r===void 0&&r===e?Lh(n,t):$h(e,r,qh|Wh)}}var eC=J2;function tC(t){return t}Ts=tC;function nC(t){return function(e){return e==null?void 0:e[t]}}var rC=nC,iC=ir;function oC(t){return function(e){return iC(e,t)}}var sC=oC,aC=rC,cC=sC,lC=ns,uC=Dt;function dC(t){return lC(t)?aC(uC(t)):cC(t)}var hC=dC,pC=y2,fC=eC,mC=Ts,yC=tt,gC=hC;function xC(t){return typeof t=="function"?t:t==null?mC:typeof t=="object"?yC(t)?fC(t[0],t[1]):pC(t):gC(t)}let Hh;wi=xC,Hh="Expected a function";function vC(t){if(typeof t!="function")throw new TypeError(Hh);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}let Uh,Qh,Zh,as;Uh=vC,Qh=Ot,Zh=function(){try{var t=Qh(Object,"defineProperty");return t({},"",{}),t}catch{}}(),qs=Zh,as=qs;function bC(t,e,n){e=="__proto__"&&as?as(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}let Yh,Xh,Gh,Kh;Us=bC,Yh=Us,Xh=or,Gh=Object.prototype,Kh=Gh.hasOwnProperty;function wC(t,e,n){var r=t[e];(!(Kh.call(t,e)&&Xh(r,n))||n===void 0&&!(e in t))&&Yh(t,e,n)}let Jh,ep,tp,cs,np;Js=wC,Jh=Js,ep=bn,tp=sr,cs=vt,np=Dt;function MC(t,e,n,r){if(!cs(t))return t;e=ep(e,t);for(var i=-1,o=e.length,s=o-1,a=t;a!=null&&++i<o;){var c=np(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=s){var u=a[c];l=r?r(u,c,a):void 0,l===void 0&&(l=cs(u)?u:tp(e[i+1])?[]:{})}Jh(a,c,l),a=a[c]}return t}var EC=MC,CC=ir,_C=EC,SC=bn;function OC(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var s=e[r],a=CC(t,s);n(a,s)&&_C(o,SC(s,t),a)}return o}let rp,ip,op,sp,ap,cp,lp,up;Xs=OC,rp=Ed,ip=rp(Object.getPrototypeOf,Object),Ws=ip,op=Ei,sp=Ws,ap=ji,cp=$o,lp=Object.getOwnPropertySymbols,up=lp?function(t){for(var e=[];t;)op(e,ap(t)),t=sp(t);return e}:cp,ta=up;function AC(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var NC=AC,PC=vt,kC=Ri,TC=NC,jC=Object.prototype,RC=jC.hasOwnProperty;function IC(t){if(!PC(t))return TC(t);var e=kC(t),n=[];for(var r in t)r=="constructor"&&(e||!RC.call(t,r))||n.push(r);return n}var $C=IC,BC=Md,LC=$C,DC=Si;function zC(t){return DC(t)?BC(t,!0):LC(t)}let dp,hp,pp;ea=zC,dp=Zu,hp=ta,pp=ea;function FC(t){return dp(t,pp,hp)}let fp,mp,yp,gp;Zs=FC,fp=Oi,mp=wi,yp=Xs,gp=Zs;function VC(t,e){if(t==null)return{};var n=fp(gp(t),function(r){return[r]});return e=mp(e),yp(t,n,function(r,i){return e(r,i[0])})}var qC=VC,WC=wi,HC=Uh,UC=qC;function QC(t,e){return UC(t,HC(WC(e)))}var ZC=QC;dr=Je(ZC);function YC(t){return t===void 0}var XC=YC;hr=Je(XC);var GC=function(t){return KC(t)&&!JC(t)};function KC(t){return!!t&&typeof t=="object"}function JC(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||n_(t)}var e_=typeof Symbol=="function"&&Symbol.for,t_=e_?Symbol.for("react.element"):60103;function n_(t){return t.$$typeof===t_}function r_(t){return Array.isArray(t)?[]:{}}function Hn(t,e){return e.clone!==!1&&e.isMergeableObject(t)?on(r_(t),t,e):t}function i_(t,e,n){return t.concat(e).map(function(r){return Hn(r,n)})}function o_(t,e){if(!e.customMerge)return on;var n=e.customMerge(t);return typeof n=="function"?n:on}function s_(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter(function(e){return Object.propertyIsEnumerable.call(t,e)}):[]}function xp(t){return Object.keys(t).concat(s_(t))}function vp(t,e){try{return e in t}catch{return!1}}function a_(t,e){return vp(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))}function c_(t,e,n){var r={};return n.isMergeableObject(t)&&xp(t).forEach(function(i){r[i]=Hn(t[i],n)}),xp(e).forEach(function(i){a_(t,i)||(vp(t,i)&&n.isMergeableObject(e[i])?r[i]=o_(i,n)(t[i],e[i],n):r[i]=Hn(e[i],n))}),r}function on(t,e,n){n=n||{},n.arrayMerge=n.arrayMerge||i_,n.isMergeableObject=n.isMergeableObject||GC,n.cloneUnlessOtherwiseSpecified=Hn;var r=Array.isArray(e),i=Array.isArray(t),o=r===i;return o?r?n.arrayMerge(t,e,n):c_(t,e,n):Hn(e,n)}on.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(n,r){return on(n,r,e)},{})};var l_=on,u_=l_;lr=Je(u_);var bp;(function(t){(function(e){var n=typeof globalThis=="object"?globalThis:typeof gn=="object"?gn:typeof self=="object"?self:typeof this=="object"?this:a(),r=i(t);typeof n.Reflect<"u"&&(r=i(n.Reflect,r)),e(r,n),typeof n.Reflect>"u"&&(n.Reflect=t);function i(c,l){return function(u,d){Object.defineProperty(c,u,{configurable:!0,writable:!0,value:d}),l&&l(u,d)}}function o(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return o()||s()}})(function(e,n){var r=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",o=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,u={create:a?function(){return nr(Object.create(null))}:c?function(){return nr({__proto__:null})}:function(){return nr({})},has:l?function(O,k){return r.call(O,k)}:function(O,k){return k in O},get:l?function(O,k){return r.call(O,k)?O[k]:void 0}:function(O,k){return O[k]}},d=Object.getPrototypeOf(Function),h=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:yn(),p=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ss(),m=typeof WeakMap=="function"?WeakMap:tr(),f=i?Symbol.for("@reflect-metadata:registry"):void 0,y=Rt(),g=er(y);function b(O,k,D,U){if(I(D)){if(!ce(O))throw new TypeError;if(!pe(k))throw new TypeError;return F(O,k)}else{if(!ce(O))throw new TypeError;if(!q(k))throw new TypeError;if(!q(U)&&!I(U)&&!J(U))throw new TypeError;return J(U)&&(U=void 0),D=oe(D),z(O,k,D,U)}}e("decorate",b);function x(O,k){function D(U,ie){if(!q(U))throw new TypeError;if(!I(ie)&&!ye(ie))throw new TypeError;A(O,k,U,ie)}return D}e("metadata",x);function v(O,k,D,U){if(!q(D))throw new TypeError;return I(U)||(U=oe(U)),A(O,k,D,U)}e("defineMetadata",v);function C(O,k,D){if(!q(k))throw new TypeError;return I(D)||(D=oe(D)),w(O,k,D)}e("hasMetadata",C);function T(O,k,D){if(!q(k))throw new TypeError;return I(D)||(D=oe(D)),N(O,k,D)}e("hasOwnMetadata",T);function S(O,k,D){if(!q(k))throw new TypeError;return I(D)||(D=oe(D)),_(O,k,D)}e("getMetadata",S);function j(O,k,D){if(!q(k))throw new TypeError;return I(D)||(D=oe(D)),R(O,k,D)}e("getOwnMetadata",j);function $(O,k){if(!q(O))throw new TypeError;return I(k)||(k=oe(k)),P(O,k)}e("getMetadataKeys",$);function B(O,k){if(!q(O))throw new TypeError;return I(k)||(k=oe(k)),L(O,k)}e("getOwnMetadataKeys",B);function V(O,k,D){if(!q(k))throw new TypeError;if(I(D)||(D=oe(D)),!q(k))throw new TypeError;I(D)||(D=oe(D));var U=Qe(k,D,!1);return I(U)?!1:U.OrdinaryDeleteMetadata(O,k,D)}e("deleteMetadata",V);function F(O,k){for(var D=O.length-1;D>=0;--D){var U=O[D],ie=U(k);if(!I(ie)&&!J(ie)){if(!pe(ie))throw new TypeError;k=ie}}return k}function z(O,k,D,U){for(var ie=O.length-1;ie>=0;--ie){var Oe=O[ie],Ce=Oe(k,D,U);if(!I(Ce)&&!J(Ce)){if(!q(Ce))throw new TypeError;U=Ce}}return U}function w(O,k,D){var U=N(O,k,D);if(U)return!0;var ie=Tt(k);return J(ie)?!1:w(O,ie,D)}function N(O,k,D){var U=Qe(k,D,!1);return I(U)?!1:H(U.OrdinaryHasOwnMetadata(O,k,D))}function _(O,k,D){var U=N(O,k,D);if(U)return R(O,k,D);var ie=Tt(k);if(!J(ie))return _(O,ie,D)}function R(O,k,D){var U=Qe(k,D,!1);if(!I(U))return U.OrdinaryGetOwnMetadata(O,k,D)}function A(O,k,D,U){var ie=Qe(D,U,!0);ie.OrdinaryDefineOwnMetadata(O,k,D,U)}function P(O,k){var D=L(O,k),U=Tt(O);if(U===null)return D;var ie=P(U,k);if(ie.length<=0)return D;if(D.length<=0)return ie;for(var Oe=new p,Ce=[],ue=0,Z=D;ue<Z.length;ue++){var G=Z[ue],K=Oe.has(G);K||(Oe.add(G),Ce.push(G))}for(var te=0,he=ie;te<he.length;te++){var G=he[te],K=Oe.has(G);K||(Oe.add(G),Ce.push(G))}return Ce}function L(O,k){var D=Qe(O,k,!1);return D?D.OrdinaryOwnMetadataKeys(O,k):[]}function W(O){if(O===null)return 1;switch(typeof O){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return O===null?1:6;default:return 6}}function I(O){return O===void 0}function J(O){return O===null}function X(O){return typeof O=="symbol"}function q(O){return typeof O=="object"?O!==null:typeof O=="function"}function ee(O,k){switch(W(O)){case 0:return O;case 1:return O;case 2:return O;case 3:return O;case 4:return O;case 5:return O}var D="string",U=ut(O,o);if(U!==void 0){var ie=U.call(O,D);if(q(ie))throw new TypeError;return ie}return ne(O)}function ne(O,k){var D,U;{var ie=O.toString;if(se(ie)){var U=ie.call(O);if(!q(U))return U}var D=O.valueOf;if(se(D)){var U=D.call(O);if(!q(U))return U}}throw new TypeError}function H(O){return!!O}function ae(O){return""+O}function oe(O){var k=ee(O);return X(k)?k:ae(k)}function ce(O){return Array.isArray?Array.isArray(O):O instanceof Object?O instanceof Array:Object.prototype.toString.call(O)==="[object Array]"}function se(O){return typeof O=="function"}function pe(O){return typeof O=="function"}function ye(O){switch(W(O)){case 3:return!0;case 4:return!0;default:return!1}}function Ie(O,k){return O===k||O!==O&&k!==k}function ut(O,k){var D=O[k];if(D!=null){if(!se(D))throw new TypeError;return D}}function pn(O){var k=ut(O,s);if(!se(k))throw new TypeError;var D=k.call(O);if(!q(D))throw new TypeError;return D}function fn(O){return O.value}function mn(O){var k=O.next();return k.done?!1:k}function gt(O){var k=O.return;k&&k.call(O)}function Tt(O){var k=Object.getPrototypeOf(O);if(typeof O!="function"||O===d||k!==d)return k;var D=O.prototype,U=D&&Object.getPrototypeOf(D);if(U==null||U===Object.prototype)return k;var ie=U.constructor;return typeof ie!="function"||ie===O?k:ie}function jt(){var O;!I(f)&&typeof n.Reflect<"u"&&!(f in n.Reflect)&&typeof n.Reflect.defineMetadata=="function"&&(O=It(n.Reflect));var k,D,U,ie=new m,Oe={registerProvider:Ce,getProvider:Z,setProvider:K};return Oe;function Ce(te){if(!Object.isExtensible(Oe))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case O===te:break;case I(k):k=te;break;case k===te:break;case I(D):D=te;break;case D===te:break;default:U===void 0&&(U=new p),U.add(te);break}}function ue(te,he){if(!I(k)){if(k.isProviderFor(te,he))return k;if(!I(D)){if(D.isProviderFor(te,he))return k;if(!I(U))for(var fe=pn(U);;){var Me=mn(fe);if(!Me)return;var ze=fn(Me);if(ze.isProviderFor(te,he))return gt(fe),ze}}}if(!I(O)&&O.isProviderFor(te,he))return O}function Z(te,he){var fe=ie.get(te),Me;return I(fe)||(Me=fe.get(he)),I(Me)&&(Me=ue(te,he),I(Me)||(I(fe)&&(fe=new h,ie.set(te,fe)),fe.set(he,Me))),Me}function G(te){if(I(te))throw new TypeError;return k===te||D===te||!I(U)&&U.has(te)}function K(te,he,fe){if(!G(fe))throw new Error("Metadata provider not registered.");var Me=Z(te,he);if(Me!==fe){if(!I(Me))return!1;var ze=ie.get(te);I(ze)&&(ze=new h,ie.set(te,ze)),ze.set(he,fe)}return!0}}function Rt(){var O;return!I(f)&&q(n.Reflect)&&Object.isExtensible(n.Reflect)&&(O=n.Reflect[f]),I(O)&&(O=jt()),!I(f)&&q(n.Reflect)&&Object.isExtensible(n.Reflect)&&Object.defineProperty(n.Reflect,f,{enumerable:!1,configurable:!1,writable:!1,value:O}),O}function er(O){var k=new m,D={isProviderFor:function(G,K){var te=k.get(G);return I(te)?!1:te.has(K)},OrdinaryDefineOwnMetadata:Ce,OrdinaryHasOwnMetadata:ie,OrdinaryGetOwnMetadata:Oe,OrdinaryOwnMetadataKeys:ue,OrdinaryDeleteMetadata:Z};return y.registerProvider(D),D;function U(G,K,te){var he=k.get(G),fe=!1;if(I(he)){if(!te)return;he=new h,k.set(G,he),fe=!0}var Me=he.get(K);if(I(Me)){if(!te)return;if(Me=new h,he.set(K,Me),!O.setProvider(G,K,D))throw he.delete(K),fe&&k.delete(G),new Error("Wrong provider for target.")}return Me}function ie(G,K,te){var he=U(K,te,!1);return I(he)?!1:H(he.has(G))}function Oe(G,K,te){var he=U(K,te,!1);if(!I(he))return he.get(G)}function Ce(G,K,te,he){var fe=U(te,he,!0);fe.set(G,K)}function ue(G,K){var te=[],he=U(G,K,!1);if(I(he))return te;for(var fe=he.keys(),Me=pn(fe),ze=0;;){var xi=mn(Me);if(!xi)return te.length=ze,te;var Os=fn(xi);try{te[ze]=Os}catch(As){try{gt(Me)}finally{throw As}}ze++}}function Z(G,K,te){var he=U(K,te,!1);if(I(he)||!he.delete(G))return!1;if(he.size===0){var fe=k.get(K);I(fe)||(fe.delete(te),fe.size===0&&k.delete(fe))}return!0}}function It(O){var k=O.defineMetadata,D=O.hasOwnMetadata,U=O.getOwnMetadata,ie=O.getOwnMetadataKeys,Oe=O.deleteMetadata,Ce=new m,ue={isProviderFor:function(Z,G){var K=Ce.get(Z);return!I(K)&&K.has(G)?!0:ie(Z,G).length?(I(K)&&(K=new p,Ce.set(Z,K)),K.add(G),!0):!1},OrdinaryDefineOwnMetadata:k,OrdinaryHasOwnMetadata:D,OrdinaryGetOwnMetadata:U,OrdinaryOwnMetadataKeys:ie,OrdinaryDeleteMetadata:Oe};return ue}function Qe(O,k,D){var U=y.getProvider(O,k);if(!I(U))return U;if(D){if(y.setProvider(O,k,g))return g;throw new Error("Illegal state.")}}function yn(){var O={},k=[],D=function(){function ue(Z,G,K){this._index=0,this._keys=Z,this._values=G,this._selector=K}return ue.prototype["@@iterator"]=function(){return this},ue.prototype[s]=function(){return this},ue.prototype.next=function(){var Z=this._index;if(Z>=0&&Z<this._keys.length){var G=this._selector(this._keys[Z],this._values[Z]);return Z+1>=this._keys.length?(this._index=-1,this._keys=k,this._values=k):this._index++,{value:G,done:!1}}return{value:void 0,done:!0}},ue.prototype.throw=function(Z){throw this._index>=0&&(this._index=-1,this._keys=k,this._values=k),Z},ue.prototype.return=function(Z){return this._index>=0&&(this._index=-1,this._keys=k,this._values=k),{value:Z,done:!0}},ue}(),U=function(){function ue(){this._keys=[],this._values=[],this._cacheKey=O,this._cacheIndex=-2}return Object.defineProperty(ue.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ue.prototype.has=function(Z){return this._find(Z,!1)>=0},ue.prototype.get=function(Z){var G=this._find(Z,!1);return G>=0?this._values[G]:void 0},ue.prototype.set=function(Z,G){var K=this._find(Z,!0);return this._values[K]=G,this},ue.prototype.delete=function(Z){var G=this._find(Z,!1);if(G>=0){for(var K=this._keys.length,te=G+1;te<K;te++)this._keys[te-1]=this._keys[te],this._values[te-1]=this._values[te];return this._keys.length--,this._values.length--,Ie(Z,this._cacheKey)&&(this._cacheKey=O,this._cacheIndex=-2),!0}return!1},ue.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=O,this._cacheIndex=-2},ue.prototype.keys=function(){return new D(this._keys,this._values,ie)},ue.prototype.values=function(){return new D(this._keys,this._values,Oe)},ue.prototype.entries=function(){return new D(this._keys,this._values,Ce)},ue.prototype["@@iterator"]=function(){return this.entries()},ue.prototype[s]=function(){return this.entries()},ue.prototype._find=function(Z,G){if(!Ie(this._cacheKey,Z)){this._cacheIndex=-1;for(var K=0;K<this._keys.length;K++)if(Ie(this._keys[K],Z)){this._cacheIndex=K;break}}return this._cacheIndex<0&&G&&(this._cacheIndex=this._keys.length,this._keys.push(Z),this._values.push(void 0)),this._cacheIndex},ue}();return U;function ie(ue,Z){return ue}function Oe(ue,Z){return Z}function Ce(ue,Z){return[ue,Z]}}function Ss(){var O=function(){function k(){this._map=new h}return Object.defineProperty(k.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),k.prototype.has=function(D){return this._map.has(D)},k.prototype.add=function(D){return this._map.set(D,D),this},k.prototype.delete=function(D){return this._map.delete(D)},k.prototype.clear=function(){this._map.clear()},k.prototype.keys=function(){return this._map.keys()},k.prototype.values=function(){return this._map.keys()},k.prototype.entries=function(){return this._map.entries()},k.prototype["@@iterator"]=function(){return this.keys()},k.prototype[s]=function(){return this.keys()},k}();return O}function tr(){var O=16,k=u.create(),D=U();return function(){function Z(){this._key=U()}return Z.prototype.has=function(G){var K=ie(G,!1);return K!==void 0?u.has(K,this._key):!1},Z.prototype.get=function(G){var K=ie(G,!1);return K!==void 0?u.get(K,this._key):void 0},Z.prototype.set=function(G,K){var te=ie(G,!0);return te[this._key]=K,this},Z.prototype.delete=function(G){var K=ie(G,!1);return K!==void 0?delete K[this._key]:!1},Z.prototype.clear=function(){this._key=U()},Z}();function U(){var Z;do Z="@@WeakMap@@"+ue();while(u.has(k,Z));return k[Z]=!0,Z}function ie(Z,G){if(!r.call(Z,D)){if(!G)return;Object.defineProperty(Z,D,{value:u.create()})}return Z[D]}function Oe(Z,G){for(var K=0;K<G;++K)Z[K]=Math.random()*255|0;return Z}function Ce(Z){if(typeof Uint8Array=="function"){var G=new Uint8Array(Z);return typeof crypto<"u"?crypto.getRandomValues(G):typeof msCrypto<"u"?msCrypto.getRandomValues(G):Oe(G,Z),G}return Oe(new Array(Z),Z)}function ue(){var Z=Ce(O);Z[6]=Z[6]&79|64,Z[8]=Z[8]&191|128;for(var G="",K=0;K<O;++K){var te=Z[K];(K===4||K===6||K===8)&&(G+="-"),te<16&&(G+="0"),G+=te.toString(16).toLowerCase()}return G}}function nr(O){return O.__=void 0,delete O.__,O}})})(bp||(bp={})),Ti=globalThis||void 0||self,typeof window<"u"&&(window.Buffer=e3.Buffer),typeof Ti<"u"&&typeof require<"u"&&(Ti.Buffer=require("buffer/").Buffer);class Se{static isObject(e){return e!==null&&typeof e=="object"}static isObjectWithName(e){return e!==null&&typeof e=="object"&&e.name!==void 0}static assign(e,...n){for(const r of n)for(const i of Object.getOwnPropertyNames(r))e[i]=r[i]}static mixedListToArray(e){return e!==null&&typeof e=="object"?Object.keys(e).map(n=>e[n]):e}}class Y extends Error{get name(){return this.constructor.name}constructor(e){super(e),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}class sn extends Y{constructor(){super("Locking not supported on given driver.")}}class ls extends Y{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}class me{static isMssqlParameter(e){return this.check(e,"MssqlParameter")}static isEntityMetadata(e){return this.check(e,"EntityMetadata")}static isColumnMetadata(e){return this.check(e,"ColumnMetadata")}static isSelectQueryBuilder(e){return this.check(e,"SelectQueryBuilder")}static isInsertQueryBuilder(e){return this.check(e,"InsertQueryBuilder")}static isDeleteQueryBuilder(e){return this.check(e,"DeleteQueryBuilder")}static isUpdateQueryBuilder(e){return this.check(e,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(e){return this.check(e,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(e){return this.check(e,"RelationQueryBuilder")}static isBrackets(e){return this.check(e,"Brackets")||this.check(e,"NotBrackets")}static isNotBrackets(e){return this.check(e,"NotBrackets")}static isSubject(e){return this.check(e,"Subject")}static isRdbmsSchemaBuilder(e){return this.check(e,"RdbmsSchemaBuilder")}static isMongoEntityManager(e){return this.check(e,"MongoEntityManager")}static isSqljsEntityManager(e){return this.check(e,"SqljsEntityManager")}static isEntitySchema(e){return this.check(e,"EntitySchema")}static isBaseEntityConstructor(e){return typeof e=="function"&&typeof e.hasId=="function"&&typeof e.save=="function"&&typeof e.useDataSource=="function"}static isFindOperator(e){return this.check(e,"FindOperator")||this.check(e,"EqualOperator")}static isEqualOperator(e){return this.check(e,"EqualOperator")}static isQuery(e){return this.check(e,"Query")}static isTable(e){return this.check(e,"Table")}static isTableCheck(e){return this.check(e,"TableCheck")}static isTableColumn(e){return this.check(e,"TableColumn")}static isTableExclusion(e){return this.check(e,"TableExclusion")}static isTableForeignKey(e){return this.check(e,"TableForeignKey")}static isTableIndex(e){return this.check(e,"TableIndex")}static isTableUnique(e){return this.check(e,"TableUnique")}static isView(e){return this.check(e,"View")}static isDataSource(e){return this.check(e,"DataSource")}static check(e,n){return typeof e=="object"&&e!==null&&e["@instanceof"]===Symbol.for(n)}}class d_ extends Y{constructor(e,n){super(),this.entityClass=e,this.criteria=n,this.message=`Could not find any entity of type "${this.stringifyTarget(e)}" matching: ${this.stringifyCriteria(n)}`}stringifyTarget(e){return me.isEntitySchema(e)?e.options.name:typeof e=="function"||Se.isObject(e)&&"name"in e?e.name:e}stringifyCriteria(e){try{return JSON.stringify(e,null,4)}catch{}return""+e}}class wp extends Y{constructor(e,n,r){super(`The optimistic lock on entity ${e} failed, version ${n} was expected, but is actually ${r}.`)}}class Mp extends Y{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}class h_ extends Y{constructor(e){super(`Entity "${e.name}" does not have delete date columns.`)}}class li extends Y{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}class Ge extends Y{constructor(e,n){super(e),Object.setPrototypeOf(this,Ge.prototype),this.message=`Property "${e}" was not found in "${n.targetName}". Make sure your query is correct.`}}class p_ extends Y{constructor(e){super(`Entity ${e} does not have version or update date columns.`)}}class f_ extends Y{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}class Un extends Y{constructor(){super("The optimistic lock can be used only with getOne() method.")}}class m_ extends Y{constructor(e){super(),e.length===1?this.message=`Relation "${e[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${e.map(n=>`"${n}"`).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}class y_ extends Y{constructor(){super("An open transaction is required for pessimistic lock.")}}class g_ extends Y{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}class Ep{constructor(e){Se.assign(this,e||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(e){this._metadata=e}get metadata(){if(!this._metadata)throw new Y(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}class Ke{static isAliasProperty(e){if(typeof e!="string"||e.indexOf(".")===-1)return!1;const[n,r]=e.split(".");return!(!n||!r||e.indexOf("(")!==-1||e.indexOf(")")!==-1)}}var Cp={exports:{}},us={exports:{}};typeof Object.create=="function"?us.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:us.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}};var an=us.exports,ds={exports:{}};(function(t,e){var n=t3(),r=n.Buffer;function i(s,a){for(var c in s)a[c]=s[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(i(n,e),e.Buffer=o);function o(s,a,c){return r(s,a,c)}o.prototype=Object.create(r.prototype),i(r,o),o.from=function(s,a,c){if(typeof s=="number")throw new TypeError("Argument must not be a number");return r(s,a,c)},o.alloc=function(s,a,c){if(typeof s!="number")throw new TypeError("Argument must be a number");var l=r(s);return a!==void 0?typeof c=="string"?l.fill(a,c):l.fill(a):l.fill(0),l},o.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return r(s)},o.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(s)}})(ds,ds.exports);var Nt=ds.exports,_p=Nt.Buffer;function ui(t,e){this._block=_p.alloc(t),this._finalSize=e,this._blockSize=t,this._len=0}ui.prototype.update=function(t,e){typeof t=="string"&&(e=e||"utf8",t=_p.from(t,e));for(var n=this._block,r=this._blockSize,i=t.length,o=this._len,s=0;s<i;){for(var a=o%r,c=Math.min(i-s,r-a),l=0;l<c;l++)n[a+l]=t[s+l];o+=c,s+=c,o%r===0&&this._update(n)}return this._len+=i,this},ui.prototype.digest=function(t){var e=this._len%this._blockSize;this._block[e]=128,this._block.fill(0,e+1),e>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=this._len*8;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(n&4294967295)>>>0,i=(n-r)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var o=this._hash();return t?o.toString(t):o},ui.prototype._update=function(){throw new Error("_update must be implemented by subclass")};var cn=ui,x_=an,Sp=cn,v_=Nt.Buffer,b_=[1518500249,1859775393,-1894007588,-899497514],w_=new Array(80);function Qn(){this.init(),this._w=w_,Sp.call(this,64,56)}x_(Qn,Sp),Qn.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function M_(t){return t<<5|t>>>27}function E_(t){return t<<30|t>>>2}function C_(t,e,n,r){return t===0?e&n|~e&r:t===2?e&n|e&r|n&r:e^n^r}Qn.prototype._update=function(t){for(var e=this._w,n=this._a|0,r=this._b|0,i=this._c|0,o=this._d|0,s=this._e|0,a=0;a<16;++a)e[a]=t.readInt32BE(a*4);for(;a<80;++a)e[a]=e[a-3]^e[a-8]^e[a-14]^e[a-16];for(var c=0;c<80;++c){var l=~~(c/20),u=M_(n)+C_(l,r,i,o)+s+e[c]+b_[l]|0;s=o,o=i,i=E_(r),r=n,n=u}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=o+this._d|0,this._e=s+this._e|0},Qn.prototype._hash=function(){var t=v_.allocUnsafe(20);return t.writeInt32BE(this._a|0,0),t.writeInt32BE(this._b|0,4),t.writeInt32BE(this._c|0,8),t.writeInt32BE(this._d|0,12),t.writeInt32BE(this._e|0,16),t};var __=Qn,S_=an,Op=cn,O_=Nt.Buffer,A_=[1518500249,1859775393,-1894007588,-899497514],N_=new Array(80);function Zn(){this.init(),this._w=N_,Op.call(this,64,56)}S_(Zn,Op),Zn.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function P_(t){return t<<1|t>>>31}function k_(t){return t<<5|t>>>27}function T_(t){return t<<30|t>>>2}function j_(t,e,n,r){return t===0?e&n|~e&r:t===2?e&n|e&r|n&r:e^n^r}Zn.prototype._update=function(t){for(var e=this._w,n=this._a|0,r=this._b|0,i=this._c|0,o=this._d|0,s=this._e|0,a=0;a<16;++a)e[a]=t.readInt32BE(a*4);for(;a<80;++a)e[a]=P_(e[a-3]^e[a-8]^e[a-14]^e[a-16]);for(var c=0;c<80;++c){var l=~~(c/20),u=k_(n)+j_(l,r,i,o)+s+e[c]+A_[l]|0;s=o,o=i,i=T_(r),r=n,n=u}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=o+this._d|0,this._e=s+this._e|0},Zn.prototype._hash=function(){var t=O_.allocUnsafe(20);return t.writeInt32BE(this._a|0,0),t.writeInt32BE(this._b|0,4),t.writeInt32BE(this._c|0,8),t.writeInt32BE(this._d|0,12),t.writeInt32BE(this._e|0,16),t};var R_=Zn,I_=an,Ap=cn,$_=Nt.Buffer,B_=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],L_=new Array(64);function Yn(){this.init(),this._w=L_,Ap.call(this,64,56)}I_(Yn,Ap),Yn.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function D_(t,e,n){return n^t&(e^n)}function z_(t,e,n){return t&e|n&(t|e)}function F_(t){return(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10)}function V_(t){return(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7)}function q_(t){return(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3}function W_(t){return(t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10}Yn.prototype._update=function(t){for(var e=this._w,n=this._a|0,r=this._b|0,i=this._c|0,o=this._d|0,s=this._e|0,a=this._f|0,c=this._g|0,l=this._h|0,u=0;u<16;++u)e[u]=t.readInt32BE(u*4);for(;u<64;++u)e[u]=W_(e[u-2])+e[u-7]+q_(e[u-15])+e[u-16]|0;for(var d=0;d<64;++d){var h=l+V_(s)+D_(s,a,c)+B_[d]+e[d]|0,p=F_(n)+z_(n,r,i)|0;l=c,c=a,a=s,s=o+h|0,o=i,i=r,r=n,n=h+p|0}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=o+this._d|0,this._e=s+this._e|0,this._f=a+this._f|0,this._g=c+this._g|0,this._h=l+this._h|0},Yn.prototype._hash=function(){var t=$_.allocUnsafe(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t};var Np=Yn,H_=an,U_=Np,Q_=cn,Z_=Nt.Buffer,Y_=new Array(64);function di(){this.init(),this._w=Y_,Q_.call(this,64,56)}H_(di,U_),di.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},di.prototype._hash=function(){var t=Z_.allocUnsafe(28);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t};var X_=di,G_=an,Pp=cn,K_=Nt.Buffer,kp=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],J_=new Array(160);function Xn(){this.init(),this._w=J_,Pp.call(this,128,112)}G_(Xn,Pp),Xn.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function Tp(t,e,n){return n^t&(e^n)}function jp(t,e,n){return t&e|n&(t|e)}function Rp(t,e){return(t>>>28|e<<4)^(e>>>2|t<<30)^(e>>>7|t<<25)}function Ip(t,e){return(t>>>14|e<<18)^(t>>>18|e<<14)^(e>>>9|t<<23)}function eS(t,e){return(t>>>1|e<<31)^(t>>>8|e<<24)^t>>>7}function tS(t,e){return(t>>>1|e<<31)^(t>>>8|e<<24)^(t>>>7|e<<25)}function nS(t,e){return(t>>>19|e<<13)^(e>>>29|t<<3)^t>>>6}function rS(t,e){return(t>>>19|e<<13)^(e>>>29|t<<3)^(t>>>6|e<<26)}function Pe(t,e){return t>>>0<e>>>0?1:0}Xn.prototype._update=function(t){for(var e=this._w,n=this._ah|0,r=this._bh|0,i=this._ch|0,o=this._dh|0,s=this._eh|0,a=this._fh|0,c=this._gh|0,l=this._hh|0,u=this._al|0,d=this._bl|0,h=this._cl|0,p=this._dl|0,m=this._el|0,f=this._fl|0,y=this._gl|0,g=this._hl|0,b=0;b<32;b+=2)e[b]=t.readInt32BE(b*4),e[b+1]=t.readInt32BE(b*4+4);for(;b<160;b+=2){var x=e[b-30],v=e[b-15*2+1],C=eS(x,v),T=tS(v,x);x=e[b-2*2],v=e[b-2*2+1];var S=nS(x,v),j=rS(v,x),$=e[b-7*2],B=e[b-7*2+1],V=e[b-16*2],F=e[b-16*2+1],z=T+B|0,w=C+$+Pe(z,T)|0;z=z+j|0,w=w+S+Pe(z,j)|0,z=z+F|0,w=w+V+Pe(z,F)|0,e[b]=w,e[b+1]=z}for(var N=0;N<160;N+=2){w=e[N],z=e[N+1];var _=jp(n,r,i),R=jp(u,d,h),A=Rp(n,u),P=Rp(u,n),L=Ip(s,m),W=Ip(m,s),I=kp[N],J=kp[N+1],X=Tp(s,a,c),q=Tp(m,f,y),ee=g+W|0,ne=l+L+Pe(ee,g)|0;ee=ee+q|0,ne=ne+X+Pe(ee,q)|0,ee=ee+J|0,ne=ne+I+Pe(ee,J)|0,ee=ee+z|0,ne=ne+w+Pe(ee,z)|0;var H=P+R|0,ae=A+_+Pe(H,P)|0;l=c,g=y,c=a,y=f,a=s,f=m,m=p+ee|0,s=o+ne+Pe(m,p)|0,o=i,p=h,i=r,h=d,r=n,d=u,u=ee+H|0,n=ne+ae+Pe(u,ee)|0}this._al=this._al+u|0,this._bl=this._bl+d|0,this._cl=this._cl+h|0,this._dl=this._dl+p|0,this._el=this._el+m|0,this._fl=this._fl+f|0,this._gl=this._gl+y|0,this._hl=this._hl+g|0,this._ah=this._ah+n+Pe(this._al,u)|0,this._bh=this._bh+r+Pe(this._bl,d)|0,this._ch=this._ch+i+Pe(this._cl,h)|0,this._dh=this._dh+o+Pe(this._dl,p)|0,this._eh=this._eh+s+Pe(this._el,m)|0,this._fh=this._fh+a+Pe(this._fl,f)|0,this._gh=this._gh+c+Pe(this._gl,y)|0,this._hh=this._hh+l+Pe(this._hl,g)|0},Xn.prototype._hash=function(){var t=K_.allocUnsafe(64);function e(n,r,i){t.writeInt32BE(n,i),t.writeInt32BE(r,i+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),t};var $p=Xn,iS=an,oS=$p,sS=cn,aS=Nt.Buffer,cS=new Array(160);function hi(){this.init(),this._w=cS,sS.call(this,128,112)}iS(hi,oS),hi.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},hi.prototype._hash=function(){var t=aS.allocUnsafe(48);function e(n,r,i){t.writeInt32BE(n,i),t.writeInt32BE(r,i+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),t};var lS=hi,Pt=Cp.exports=function(t){t=t.toLowerCase();var e=Pt[t];if(!e)throw new Error(t+" is not supported (we accept pull requests)");return new e};Pt.sha=__,Pt.sha1=R_,Pt.sha224=X_,Pt.sha256=Np,Pt.sha384=lS,Pt.sha512=$p;var uS=Cp.exports;const dS=Je(uS);function hS(t,e={}){const{segmentLength:n=4,separator:r="__",termLength:i=2}=e;return t.split(r).reduce((o,s)=>{const a=s.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),c=a.length>1?i:n,l=a.map(u=>u.substr(0,c)).join("");return o.push(l),o},[]).join(r)}function pS(t,e={}){const n=dS("sha1");n.update(t,"utf8");const r=n.digest("hex");return e.length?r.slice(0,e.length):r}class fS{static isGreaterOrEqual(e,n){const r=Bp(e),i=Bp(n);return r[0]>i[0]||r[0]===i[0]&&r[1]>i[1]||r[0]===i[0]&&r[1]===i[1]&&r[2]>=i[2]}}function Bp(t=""){const e=[0,0,0];return t.split(".").forEach((n,r)=>e[r]=parseInt(n,10)),e}class Q{static isSQLiteFamily(e){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(e.options.type)}static isMySQLFamily(e){return["mysql","mariadb"].includes(e.options.type)}static isReleaseVersionOrGreater(e,n){return e.version!=null&&fS.isGreaterOrEqual(e.version,n)}static isPostgresFamily(e){return["postgres","aurora-postgres","cockroachdb"].includes(e.options.type)}static buildDriverOptions(e,n){if(e.url){const r=this.parseConnectionUrl(e.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const i of Object.keys(r))typeof r[i]>"u"&&delete r[i];return Object.assign({},e,r)}return Object.assign({},e)}static buildMongoDBDriverOptions(e,n){if(e.url){const r=this.parseMongoDBConnectionUrl(e.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const i of Object.keys(r))typeof r[i]>"u"&&delete r[i];return Object.assign({},e,r)}return Object.assign({},e)}static buildAlias({maxAliasLength:e},n,...r){const i=n&&n.joiner?n.joiner:"_";let o=r.length===1?r[0]:r.join(i);if(e&&e>0&&o.length>e){if(n&&n.shorten===!0){const s=hS(o);if(s.length<e)return s}return pS(o,{length:e})}return o}static buildColumnAlias({maxAliasLength:e},n,...r){return typeof n=="string"?(r.unshift(n),n={shorten:!1,joiner:"_"}):n=Object.assign({shorten:!1,joiner:"_"},n),this.buildAlias({maxAliasLength:e},n,...r)}static parseConnectionUrl(e){const n=e.split(":")[0],r=e.indexOf("//"),i=e.substr(r+2),o=i.indexOf("/"),s=o!==-1?i.substr(0,o):i;let a=o!==-1?i.substr(o+1):void 0;a&&a.indexOf("?")!==-1&&(a=a.substr(0,a.indexOf("?")));const c=s.lastIndexOf("@"),l=s.substr(0,c),u=s.substr(c+1);let d=l,h="";const p=l.indexOf(":");p!==-1&&(d=l.substr(0,p),h=l.substr(p+1));const[m,f]=u.split(":");return{type:n,host:m,username:decodeURIComponent(d),password:decodeURIComponent(h),port:f?parseInt(f):void 0,database:a||void 0}}static parseMongoDBConnectionUrl(e){const n=e.split(":")[0],r=e.indexOf("//"),i=e.substr(r+2),o=i.indexOf("/"),s=o!==-1?i.substr(0,o):i;let a=o!==-1?i.substr(o+1):void 0,c="",l,u,d,h,p={};if(a&&a.indexOf("?")!==-1){c=a.substr(a.indexOf("?")+1,a.length);const C=c.split("&");let T,S;C.forEach(j=>{T=j.split("=")[0],S=j.split("=")[1],p[T]=S}),h=p.replicaSet,a=a.substr(0,a.indexOf("?"))}const m=s.lastIndexOf("@"),f=s.substr(0,m),y=s.substr(m+1);let g=f,b="";const x=f.indexOf(":");x!==-1&&(g=f.substr(0,x),b=f.substr(x+1)),h?d=y:[l,u]=y.split(":");let v={type:n,host:l,hostReplicaSet:d,username:decodeURIComponent(g),password:decodeURIComponent(b),port:u?parseInt(u):void 0,database:a||void 0};for(const[C,T]of Object.entries(p))v[C]=T;return v}}class Lp{constructor(e,n,r){this.connection=e,this.queryExpressionMap=n,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,r&&Se.assign(this,r)}get isMany(){return this.isMappingMany!==void 0?this.isMappingMany:this.relation?this.relation.isManyToMany||this.relation.isOneToMany:!1}get isSelected(){if(!this.isSelectedEvaluated){let e=()=>{for(const n of this.queryExpressionMap.selects)if(n.selection===this.alias.name||this.metadata&&this.metadata.columns.find(r=>n.selection===this.alias.name+"."+r.propertyPath))return!0;return!1};this.isSelectedCache=e(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(Ke.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(Ke.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let e=()=>{if(!Ke.isAliasProperty(this.entityOrProperty))return;const n=this.queryExpressionMap.findAliasByName(this.parentAlias);let r=n.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(r||n.metadata.parentEntityMetadata&&(r=n.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),r))return r;throw new Y(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=e.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){if(this.relation)return this.relation.inverseEntityMetadata;if(this.connection.hasMetadata(this.entityOrProperty))return this.connection.getMetadata(this.entityOrProperty);if(this.mapAsEntity&&this.connection.hasMetadata(this.mapAsEntity))return this.connection.getMetadata(this.mapAsEntity)}get junctionAlias(){if(!this.relation)throw new Y("Cannot get junction table for join without relation.");if(typeof this.entityOrProperty!="string")throw new Y("Junction property is not defined.");const e=this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."));return this.relation.isOwning?Q.buildAlias(this.connection.driver,void 0,e,this.alias.name):Q.buildAlias(this.connection.driver,void 0,this.alias.name,e)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}class hs{constructor(e,n){this.queryExpressionMap=e,this.disableMixedMap=!1,Se.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!Ke.isAliasProperty(this.relationName))throw new Y("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!Ke.isAliasProperty(this.relationName))throw new Y("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!Ke.isAliasProperty(this.relationName))throw new Y("Given value must be a string representation of alias property");const e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Y(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return e}get junctionAlias(){const[e,n]=this.relationName.split(".");return e+"_"+n+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}class ps{constructor(e,n){this.expressionMap=e,Se.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!Ke.isAliasProperty(this.relationName))throw new Y("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!Ke.isAliasProperty(this.relationName))throw new Y("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[e,n]=this.relationName.split(".");return e+"_"+n+"_rc"}get relation(){if(!Ke.isAliasProperty(this.relationName))throw new Y("Given value is a string representation of alias property");const[e,n]=this.relationName.split("."),r=this.expressionMap.findAliasByName(e).metadata.findRelationWithPropertyPath(n);if(!r)throw new Y(`Relation with property path ${n} in entity was not found.`);return r}get metadata(){if(!Ke.isAliasProperty(this.relationName))throw new Y("Given value is a string representation of alias property");const e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}class fs{constructor(e){var n;this.connection=e,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],e.options.relationLoadStrategy&&(this.relationLoadStrategy=e.options.relationLoadStrategy),this.timeTravel=((n=e.options)==null?void 0:n.timeTravelQueries)||!1}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&this.options.indexOf("disable-global-order")===-1){const e=this.mainAlias.metadata.orderBy||{};return Object.keys(e).reduce((n,r)=>(n[this.mainAlias.name+"."+r]=e[r],n),{})}return this.orderBys}setMainAlias(e){return this.mainAlias=e,e}createAlias(e){let n=e.name;!n&&e.tablePath&&(n=e.tablePath),!n&&typeof e.target=="function"&&(n=e.target.name),!n&&typeof e.target=="string"&&(n=e.target);const r=new Ep;return r.type=e.type,n&&(r.name=n),e.metadata&&(r.metadata=e.metadata),e.target&&!r.hasMetadata&&(r.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(r.tablePath=e.tablePath),e.subQuery&&(r.subQuery=e.subQuery),this.aliases.push(r),r}findAliasByName(e){const n=this.aliases.find(r=>r.name===e);if(!n)throw new Y(`"${e}" alias was not found. Maybe you forgot to join it?`);return n}findColumnByAliasExpression(e){const[n,r]=e.split(".");return this.findAliasByName(n).metadata.findColumnWithPropertyName(r)}get relationMetadata(){if(!this.mainAlias)throw new Y("Entity to work with is not specified!");const e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Y(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return e}clone(){const e=new fs(this.connection);return e.queryType=this.queryType,e.selects=this.selects.map(n=>n),e.maxExecutionTime=this.maxExecutionTime,e.selectDistinct=this.selectDistinct,e.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(n=>e.aliases.push(new Ep(n))),e.relationLoadStrategy=this.relationLoadStrategy,e.mainAlias=this.mainAlias,e.valuesSet=this.valuesSet,e.returning=this.returning,e.onConflict=this.onConflict,e.onIgnore=this.onIgnore,e.onUpdate=this.onUpdate,e.joinAttributes=this.joinAttributes.map(n=>new Lp(this.connection,this,n)),e.relationIdAttributes=this.relationIdAttributes.map(n=>new hs(this,n)),e.relationCountAttributes=this.relationCountAttributes.map(n=>new ps(this,n)),e.wheres=this.wheres.map(n=>({...n})),e.havings=this.havings.map(n=>({...n})),e.orderBys=Object.assign({},this.orderBys),e.groupBys=this.groupBys.map(n=>n),e.limit=this.limit,e.offset=this.offset,e.skip=this.skip,e.take=this.take,e.lockMode=this.lockMode,e.onLocked=this.onLocked,e.lockVersion=this.lockVersion,e.lockTables=this.lockTables,e.withDeleted=this.withDeleted,e.parameters=Object.assign({},this.parameters),e.disableEscaping=this.disableEscaping,e.enableRelationIdValues=this.enableRelationIdValues,e.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,e.subQuery=this.subQuery,e.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,e.cache=this.cache,e.cacheId=this.cacheId,e.cacheDuration=this.cacheDuration,e.relationPropertyPath=this.relationPropertyPath,e.of=this.of,e.insertColumns=this.insertColumns,e.whereEntities=this.whereEntities,e.updateEntity=this.updateEntity,e.callListeners=this.callListeners,e.useTransaction=this.useTransaction,e.timeTravel=this.timeTravel,e.nativeParameters=Object.assign({},this.nativeParameters),e.comment=this.comment,e.commonTableExpressions=this.commonTableExpressions.map(n=>({alias:n.alias,queryBuilder:typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.clone(),options:n.options})),e}}class Dp{constructor(e){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=e}}class ms{static transformFrom(e,n){return Array.isArray(e)?e.slice().reverse().reduce((r,i)=>i.from(r),n):e.from(n)}static transformTo(e,n){return Array.isArray(e)?e.reduce((r,i)=>i.to(r),n):e.to(n)}}class Gn{constructor(e,n,r=!0,i=!1,o,s){this["@instanceof"]=Symbol.for("FindOperator"),this._type=e,this._value=n,this._useParameter=r,this._multipleParameters=i,this._getSql=o,this._objectLiteralParameters=s}get useParameter(){return me.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return me.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return me.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return me.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(me.isFindOperator(this._value))return this._value}get getSql(){return me.isFindOperator(this._value)?this._value.getSql:this._getSql}transformValue(e){this._value instanceof Gn?this._value.transformValue(e):this._value=Array.isArray(this._value)&&this._multipleParameters?this._value.map(n=>e&&ms.transformTo(e,n)):ms.transformTo(e,this._value)}}bi=function(t){return new Gn("in",t,!0,!0)};const mS=/[.*+\-?^${}()|[\]\\]/g,yS=t=>t.replace(mS,"\\$&");class we{constructor(e,n){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,me.isDataSource(e)?(this.connection=e,this.queryRunner=n,this.expressionMap=new fs(this.connection)):(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone())}static registerQueryBuilderClass(e,n){we.queryBuilderRegistry[e]=n}get alias(){if(!this.expressionMap.mainAlias)throw new Y("Main alias is not set");return this.expressionMap.mainAlias.name}select(e,n){return this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map(r=>({selection:r})):e&&(this.expressionMap.selects=[{selection:e,aliasName:n}]),me.isSelectQueryBuilder(this)?this:we.queryBuilderRegistry.SelectQueryBuilder(this)}insert(){return this.expressionMap.queryType="insert",me.isInsertQueryBuilder(this)?this:we.queryBuilderRegistry.InsertQueryBuilder(this)}update(e,n){const r=n||e;if(e=me.isEntitySchema(e)?e.options.name:e,typeof e=="function"||typeof e=="string"){const i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}return this.expressionMap.queryType="update",this.expressionMap.valuesSet=r,me.isUpdateQueryBuilder(this)?this:we.queryBuilderRegistry.UpdateQueryBuilder(this)}delete(){return this.expressionMap.queryType="delete",me.isDeleteQueryBuilder(this)?this:we.queryBuilderRegistry.DeleteQueryBuilder(this)}softDelete(){return this.expressionMap.queryType="soft-delete",me.isSoftDeleteQueryBuilder(this)?this:we.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}restore(){return this.expressionMap.queryType="restore",me.isSoftDeleteQueryBuilder(this)?this:we.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}relation(e,n){const r=arguments.length===2?e:void 0,i=arguments.length===2?n:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){const o=this.createFromAlias(r);this.expressionMap.setMainAlias(o)}return me.isRelationQueryBuilder(this)?this:we.queryBuilderRegistry.RelationQueryBuilder(this)}hasRelation(e,n){const r=this.connection.getMetadata(e);return(Array.isArray(n)?n:[n]).every(i=>!!r.findRelationWithPropertyPath(i))}hasParameter(e){var n;return((n=this.parentQueryBuilder)==null?void 0:n.hasParameter(e))||e in this.expressionMap.parameters}setParameter(e,n){if(typeof n=="function")throw new Y(`Function parameter isn't supported in the parameters. Please check "${e}" parameter.`);if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new Y("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,n),this.expressionMap.parameters[e]=n,this}setParameters(e){for(const[n,r]of Object.entries(e))this.setParameter(n,r);return this}createParameter(e){let n;do n=`orm_param_${this.parameterIndex++}`;while(this.hasParameter(n));return this.setParameter(n,e),`:${n}`}setNativeParameters(e){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(n=>{this.expressionMap.nativeParameters[n]=e[n]}),this}getParameters(){const e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const n=this.expressionMap.mainAlias.metadata;if(n.discriminatorColumn&&n.parentEntityMetadata){const r=n.childEntityMetadatas.filter(i=>i.discriminatorColumn).map(i=>i.discriminatorValue);r.push(n.discriminatorValue),e.discriminatorColumnValues=r}}return e}printSql(){const[e,n]=this.getQueryAndParameters();return this.connection.logger.logQuery(e,n),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const e=this.getQuery(),n=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,n,this.expressionMap.nativeParameters)}async execute(){const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();try{return await r.query(e,n)}finally{r!==this.queryRunner&&await r.release()}}createQueryBuilder(e){return new this.constructor(this.connection,e??this.queryRunner)}clone(){return new this.constructor(this)}comment(e){return this.expressionMap.comment=e,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e}setQueryRunner(e){return this.queryRunner=e,this}callListeners(e){return this.expressionMap.callListeners=e,this}useTransaction(e){return this.expressionMap.useTransaction=e,this}addCommonTableExpression(e,n,r){return this.expressionMap.commonTableExpressions.push({queryBuilder:e,alias:n,options:r||{}}),this}getTableName(e){return e.split(".").map(n=>n===""?n:this.escape(n)).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new Y('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(e,n){if(this.connection.hasMetadata(e)){const r=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:n,metadata:this.connection.getMetadata(e),tablePath:r.tablePath})}else{if(typeof e=="string"){const o=e.substr(0,1)==="("&&e.substr(-1)===")";return this.expressionMap.createAlias({type:"from",name:n,tablePath:o?void 0:e,subQuery:o?e:void 0})}const r=e(this.subQuery());this.setParameters(r.getParameters());const i=r.getQuery();return this.expressionMap.createAlias({type:"from",name:n,subQuery:i})}}replacePropertyNames(e){return e}replacePropertyNamesForTheWholeQuery(e){const n={};for(const o of this.expressionMap.aliases){if(!o.hasMetadata)continue;const s=this.expressionMap.aliasNamePrefixingEnabled&&o.name?`${o.name}.`:"";n[s]||(n[s]={});for(const a of o.metadata.relations)a.joinColumns.length>0&&(n[s][a.propertyPath]=a.joinColumns[0].databaseName);for(const a of o.metadata.relations){const c=[...a.joinColumns,...a.inverseJoinColumns];for(const l of c){const u=`${a.propertyPath}.${l.referencedColumn.propertyPath}`;n[s][u]=l.databaseName}}for(const a of o.metadata.columns)n[s][a.databaseName]=a.databaseName;for(const a of o.metadata.columns)n[s][a.propertyName]=a.databaseName;for(const a of o.metadata.columns)n[s][a.propertyPath]=a.databaseName}const r=Object.keys(n),i=r.map(o=>yS(o)).join("|");return r.length>0&&(e=e.replace(new RegExp(`([ =(]|^.{0})${i?"("+i+")":""}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),(...o)=>{let s,a,c;if(i){if(s=o[0],a=o[1],c=o[3],n[o[2]][c])return`${a}${this.escape(o[2].substring(0,o[2].length-1))}.${this.escape(n[o[2]][c])}`}else if(s=o[0],a=o[1],c=o[2],n[""][c])return`${a}${this.escape(n[""][c])}`;return s})),e}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace(/\*\//g,"")} */ `:""}createTimeTravelQuery(){return this.expressionMap.queryType==="select"&&this.expressionMap.timeTravel?` AS OF SYSTEM TIME ${this.expressionMap.timeTravel}`:""}createWhereExpression(){const e=[],n=this.createWhereClausesExpression(this.expressionMap.wheres);if(n.length>0&&n!=="1=1"&&e.push(this.replacePropertyNames(n)),this.expressionMap.mainAlias.hasMetadata){const i=this.expressionMap.mainAlias.metadata;if(this.expressionMap.queryType==="select"&&!this.expressionMap.withDeleted&&i.deleteDateColumn){const o=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+i.deleteDateColumn.propertyName:i.deleteDateColumn.propertyName,s=`${this.replacePropertyNames(o)} IS NULL`;e.push(s)}if(i.discriminatorColumn&&i.parentEntityMetadata){const o=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+i.discriminatorColumn.databaseName:i.discriminatorColumn.databaseName,s=`${this.replacePropertyNames(o)} IN (:...discriminatorColumnValues)`;e.push(s)}}if(this.expressionMap.extraAppendedAndWhereCondition){const i=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(i)}let r="";return r+=this.createTimeTravelQuery(),e.length?e.length===1?r+=` WHERE ${e[0]}`:r+=` WHERE ( ${e.join(" ) AND ( ")} )`:r+="",r}createReturningExpression(e){const n=this.getReturningColumns(),r=this.connection.driver;if(typeof this.expressionMap.returning!="string"&&this.expressionMap.extraReturningColumns.length>0&&r.isReturningSqlSupported(e)&&n.push(...this.expressionMap.extraReturningColumns.filter(i=>n.indexOf(i)===-1)),n.length){let i=n.map(o=>{const s=this.escape(o.databaseName);return r.options.type==="mssql"?this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update"||this.expressionMap.queryType==="soft-delete"||this.expressionMap.queryType==="restore"?"INSERTED."+s:this.escape(this.getMainTableName())+"."+s:s}).join(", ");return r.options.type==="oracle"&&(i+=" INTO "+n.map(o=>this.createParameter({type:r.columnTypeToNativeParameter(o.type),dir:r.oracle.BIND_OUT})).join(", ")),r.options.type==="mssql"&&(this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update")&&(i+=" INTO @OutputTable"),i}else if(typeof this.expressionMap.returning=="string")return this.expressionMap.returning;return""}getReturningColumns(){const e=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(n=>{this.expressionMap.mainAlias.hasMetadata&&e.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n))}),e}createWhereClausesExpression(e){return e.map((n,r)=>{const i=this.createWhereConditionExpression(n.condition);switch(n.type){case"and":return(r>0?"AND ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${i}${this.connection.options.isolateWhereStatements?")":""}`;case"or":return(r>0?"OR ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${i}${this.connection.options.isolateWhereStatements?")":""}`}return i}).join(" ").trim()}createWhereConditionExpression(e,n=!1){if(typeof e=="string")return e;if(Array.isArray(e))return e.length===0?"1=1":e.length===1&&!n?this.createWhereClausesExpression(e):"("+this.createWhereClausesExpression(e)+")";const{driver:r}=this.connection;switch(e.operator){case"lessThan":return`${e.parameters[0]} < ${e.parameters[1]}`;case"lessThanOrEqual":return`${e.parameters[0]} <= ${e.parameters[1]}`;case"arrayContains":return`${e.parameters[0]} @> ${e.parameters[1]}`;case"jsonContains":return`${e.parameters[0]} ::jsonb @> ${e.parameters[1]}`;case"arrayContainedBy":return`${e.parameters[0]} <@ ${e.parameters[1]}`;case"arrayOverlap":return`${e.parameters[0]} && ${e.parameters[1]}`;case"moreThan":return`${e.parameters[0]} > ${e.parameters[1]}`;case"moreThanOrEqual":return`${e.parameters[0]} >= ${e.parameters[1]}`;case"notEqual":return`${e.parameters[0]} != ${e.parameters[1]}`;case"equal":return`${e.parameters[0]} = ${e.parameters[1]}`;case"ilike":return r.options.type==="postgres"||r.options.type==="cockroachdb"?`${e.parameters[0]} ILIKE ${e.parameters[1]}`:`UPPER(${e.parameters[0]}) LIKE UPPER(${e.parameters[1]})`;case"like":return`${e.parameters[0]} LIKE ${e.parameters[1]}`;case"between":return`${e.parameters[0]} BETWEEN ${e.parameters[1]} AND ${e.parameters[2]}`;case"in":return e.parameters.length<=1?"0=1":`${e.parameters[0]} IN (${e.parameters.slice(1).join(", ")})`;case"any":return r.options.type==="cockroachdb"?`${e.parameters[0]}::STRING = ANY(${e.parameters[1]}::STRING[])`:`${e.parameters[0]} = ANY(${e.parameters[1]})`;case"isNull":return`${e.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(e.condition)})`;case"brackets":return`${this.createWhereConditionExpression(e.condition,!0)}`;case"and":return"("+e.parameters.join(" AND ")+")";case"or":return"("+e.parameters.join(" OR ")+")"}throw new TypeError(`Unsupported FindOperator ${Gn.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const e=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map(n=>{const r=typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.getQuery();if(typeof n.queryBuilder!="string"){if(n.queryBuilder.hasCommonTableExpressions())throw new Y(`Nested CTEs aren't supported (CTE: ${n.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!me.isSelectQueryBuilder(n.queryBuilder))throw new Y(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${n.alias})`);this.setParameters(n.queryBuilder.getParameters())}let i=this.escape(n.alias);if(n.options.columnNames){const a=n.options.columnNames.map(c=>this.escape(c));if(me.isSelectQueryBuilder(n.queryBuilder)&&n.queryBuilder.expressionMap.selects.length&&n.options.columnNames.length!==n.queryBuilder.expressionMap.selects.length)throw new Y(`cte.options.columnNames length (${n.options.columnNames.length}) doesn't match subquery select list length ${n.queryBuilder.expressionMap.selects.length} (CTE: ${n.alias})`);i+=`(${a.join(", ")})`}const o=n.options.recursive&&e?"RECURSIVE":"";let s="";return this.connection.driver.cteCapabilities.materializedHint&&n.options.materialized!==void 0&&(s=n.options.materialized?"MATERIALIZED":"NOT MATERIALIZED"),[o,i,"AS",s,`(${r})`].filter(Boolean).join(" ")}).join(", ")+" "}getWhereInIdsCondition(e){const n=this.expressionMap.mainAlias.metadata,r=(Array.isArray(e)?e:[e]).map(i=>n.ensureEntityIdMap(i));if(!n.hasMultiplePrimaryKeys){const i=n.primaryColumns[0];if(!i.transformer&&!i.relationMetadata&&!i.embeddedMetadata)return{[i.propertyName]:bi(r.map(o=>i.getEntityValue(o,!1)))}}return new Dp(i=>{for(const o of r)i.orWhere(new Dp(s=>s.where(o)))})}getExistsCondition(e){const n=e.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select("1").setOption("disable-global-order");return[`EXISTS (${n.getQuery()})`,n.getParameters()]}findColumnsForPropertyPath(e){let n=this.expressionMap.mainAlias;const r=[],i=e.split(".");for(;i.length>1;){const a=i[0];if(!(n!=null&&n.hasMetadata))break;if(n.metadata.hasEmbeddedWithPropertyPath(a)){i.unshift(`${i.shift()}.${i.shift()}`);continue}if(n.metadata.hasRelationWithPropertyPath(a)){const c=this.expressionMap.joinAttributes.find(l=>l.relationPropertyPath===a);if(!(c!=null&&c.alias)){const l=r.length>0?`${r.join(".")}.${a}`:a;throw new Error(`Cannot find alias for relation at ${l}`)}n=c.alias,r.push(...a.split(".")),i.shift();continue}break}if(!n)throw new Error(`Cannot find alias for property ${e}`);const o=i.join("."),s=n.metadata.findColumnsWithPropertyPath(o);if(!s.length)throw new Ge(e,n.metadata);return[n,r,s]}createPropertyPath(e,n,r=""){const i=[];for(const o of Object.keys(n)){const s=r?`${r}.${o}`:o;if(n[o]===null||typeof n[o]!="object"||me.isFindOperator(n[o])){i.push(s);continue}if(e.hasEmbeddedWithPropertyPath(s)){const a=this.createPropertyPath(e,n[o],s);i.push(...a);continue}if(e.hasRelationWithPropertyPath(s)){const a=e.findRelationWithPropertyPath(s);if(a.relationType==="one-to-one"||a.relationType==="many-to-one"){const u=a.joinColumns.map(d=>d.referencedColumn).filter(d=>!!d);if(u.length>0&&u.every(d=>d.getEntityValue(n[o],!1))){i.push(s);continue}}if(a.relationType==="one-to-many"||a.relationType==="many-to-many")throw new Error(`Cannot query across ${a.relationType} for property ${s}`);const c=a.inverseEntityMetadata.primaryColumns;if(c.length>0&&c.every(u=>u.getEntityValue(n[o],!1))){const u=c.map(d=>`${s}.${d.propertyPath}`);i.push(...u);continue}const l=this.createPropertyPath(a.inverseEntityMetadata,n[o]).map(u=>`${s}.${u}`);i.push(...l);continue}i.push(s)}return i}*getPredicates(e){if(this.expressionMap.mainAlias.hasMetadata){const n=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e);for(const r of n){const[i,o,s]=this.findColumnsForPropertyPath(r);for(const a of s){let c=e;for(const d of o){if(!c||!(d in c)){c={};break}c=c[d]}const l=this.expressionMap.aliasNamePrefixingEnabled?`${i.name}.${a.propertyPath}`:a.propertyPath,u=a.getEntityValue(c,!0);yield[l,u]}}}else for(const n of Object.keys(e)){const r=e[n];yield[this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${n}`:n,r]}}getWherePredicateCondition(e,n){if(me.isFindOperator(n)){let r=[];if(n.useParameter)if(n.objectLiteralParameters)this.setParameters(n.objectLiteralParameters);else if(n.multipleParameters)for(const i of n.value)r.push(this.createParameter(i));else r.push(this.createParameter(n.value));if(n.type==="raw")return n.getSql?n.getSql(e):{operator:"equal",parameters:[e,n.value]};if(n.type==="not")return n.child?{operator:n.type,condition:this.getWherePredicateCondition(e,n.child)}:{operator:"notEqual",parameters:[e,...r]};if(n.type==="and"){const i=n.value;return{operator:n.type,parameters:i.map(o=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,o)))}}else if(n.type==="or"){const i=n.value;return{operator:n.type,parameters:i.map(o=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,o)))}}else return{operator:n.type,parameters:[e,...r]}}else return{operator:"equal",parameters:[e,this.createParameter(n)]}}getWhereCondition(e){if(typeof e=="string")return e;if(me.isBrackets(e)){const i=this.createQueryBuilder();return i.parentQueryBuilder=this,i.expressionMap.mainAlias=this.expressionMap.mainAlias,i.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,i.expressionMap.parameters=this.expressionMap.parameters,i.expressionMap.nativeParameters=this.expressionMap.nativeParameters,i.expressionMap.wheres=[],e.whereFactory(i),{operator:me.isNotBrackets(e)?"not":"brackets",condition:i.expressionMap.wheres}}if(typeof e=="function")return e(this);const n=Array.isArray(e)?e:[e],r=[];for(const i of n){const o=[];for(const[s,a]of this.getPredicates(i))o.push({type:"and",condition:this.getWherePredicateCondition(s,a)});r.push({type:"or",condition:o})}return r.length===1?r[0].condition:r}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}we.queryBuilderRegistry={};class gS{static from(e){const n=new this;return n.raw=e.records,n.affected=e.affected,n}}class xS extends we{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createDeleteExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let i=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),i=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const o=await r.query(e,n,!0),s=gS.from(o);return this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),i&&await r.commitTransaction(),s}catch(o){if(i)try{await r.rollbackTransaction()}catch{}throw o}finally{r!==this.queryRunner&&await r.release()}}from(e,n){e=me.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new li;return this.expressionMap.returning=e,this}createDeleteExpression(){const e=this.getTableName(this.getMainTableName()),n=this.createWhereExpression(),r=this.createReturningExpression("delete");return r===""?`DELETE FROM ${e}${n}`:this.connection.driver.options.type==="mssql"?`DELETE FROM ${e} OUTPUT ${r}${n}`:`DELETE FROM ${e}${n} RETURNING ${r}`}}let pi;const vS=new Uint8Array(16);function bS(){if(!pi&&(pi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!pi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return pi(vS)}const Te=[];for(let t=0;t<256;++t)Te.push((t+256).toString(16).slice(1));function wS(t,e=0){return Te[t[e+0]]+Te[t[e+1]]+Te[t[e+2]]+Te[t[e+3]]+"-"+Te[t[e+4]]+Te[t[e+5]]+"-"+Te[t[e+6]]+Te[t[e+7]]+"-"+Te[t[e+8]]+Te[t[e+9]]+"-"+Te[t[e+10]]+Te[t[e+11]]+Te[t[e+12]]+Te[t[e+13]]+Te[t[e+14]]+Te[t[e+15]]}const MS=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zp={randomUUID:MS};function ES(t,e,n){if(zp.randomUUID&&!e&&!t)return zp.randomUUID();t=t||{};const r=t.random||(t.rng||bS)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,wS(r)}class Fp{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}class Vp{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(e){const n=new this;return n.raw=e.raw,n}}class ys{constructor(e,n){this.queryRunner=e,this.expressionMap=n}async update(e,n){const r=this.expressionMap.mainAlias.metadata;await Promise.all(n.map(async(i,o)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((c,l,u)=>(c[this.expressionMap.extraReturningColumns[u].databaseName]=l[0],c),{}));const s=Array.isArray(e.raw)?e.raw[o]:e.raw,a=this.queryRunner.connection.driver.createGeneratedMap(r,s);a&&(this.queryRunner.manager.merge(r.target,i,a),e.generatedMaps.push(a))}else{const s=this.expressionMap.extraReturningColumns;if(s.length>0){const a=this.expressionMap.mainAlias.metadata.getEntityIdMap(i);if(!a)throw new Y("Cannot update entity because entity id is not set in the entity.");const c=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(l=>r.targetName+"."+l.propertyPath)).addSelect(s.map(l=>r.targetName+"."+l.propertyPath)).from(r.target,r.targetName).where(a).withDeleted().setOption("create-pojo").getOne();c&&(this.queryRunner.manager.merge(r.target,i,c),e.generatedMaps.push(c))}}}))}async insert(e,n){const r=this.expressionMap.mainAlias.metadata;let i=r.getInsertionReturningColumns();const o=this.queryRunner.connection.driver.isReturningSqlSupported("insert");i=i.filter(a=>a.isGenerated?o===!0:!0);const s=n.map((a,c)=>{this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((d,h,p)=>(d[this.expressionMap.extraReturningColumns[p].databaseName]=h[0],d),{}));const l=Array.isArray(e.raw)?e.raw[c]:e.raw,u=this.queryRunner.connection.driver.createGeneratedMap(r,l,c,n.length)||{};return c in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(r.target,u,this.expressionMap.locallyGenerated[c]),this.queryRunner.manager.merge(r.target,a,u),u});if(i.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const a=n.map(l=>{const u=r.getEntityIdMap(l);if(!u)throw new Y("Cannot update entity because entity id is not set in the entity.");return u}),c=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(l=>r.targetName+"."+l.propertyPath)).addSelect(i.map(l=>r.targetName+"."+l.propertyPath)).from(r.target,r.targetName).where(a).setOption("create-pojo").getMany();n.forEach((l,u)=>{this.queryRunner.manager.merge(r.target,s[u],c[u]),this.queryRunner.manager.merge(r.target,l,c[u])})}n.forEach((a,c)=>{const l=r.getEntityIdMap(a);e.identifiers.push(l),e.generatedMaps.push(s[c])})}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion)}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion||e.isDeleteDate)}}class CS extends we{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createInsertExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.getValueSets();if(e.length===0)return new Vp;const n=this.obtainQueryRunner();let r=!1;try{if(this.expressionMap.useTransaction===!0&&n.isTransactionActive===!1&&(await n.startTransaction(),r=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const p=new Fp;e.forEach(m=>{n.broadcaster.broadcastBeforeInsertEvent(p,this.expressionMap.mainAlias.metadata,m)}),await p.wait()}let i=null,o=null;const s=new ys(n,this.expressionMap),a=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const p of this.expressionMap.returning)a.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(p));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver.options.type==="oracle"||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),a.push(...this.expressionMap.extraReturningColumns.filter(p=>!a.includes(p)))),a.length>0&&this.connection.driver.options.type==="mssql"&&(i=this.connection.driver.buildTableVariableDeclaration("@OutputTable",a),o="SELECT * FROM @OutputTable");const[c,l]=this.getQueryAndParameters(),u=[i,c,o].filter(p=>p!=null).join(`;

`),d=await n.query(u,l,!0),h=Vp.from(d);if(this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&await s.insert(h,e),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const p=new Fp;e.forEach(m=>{n.broadcaster.broadcastAfterInsertEvent(p,this.expressionMap.mainAlias.metadata,m)}),await p.wait()}return r&&await n.commitTransaction(),h}catch(i){if(r)try{await n.rollbackTransaction()}catch{}throw i}finally{n!==this.queryRunner&&await n.release()}}into(e,n){e=me.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e);return this.expressionMap.setMainAlias(r),this.expressionMap.insertColumns=n||[],this}values(e){return this.expressionMap.valuesSet=e,this}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new li;return this.expressionMap.returning=e,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}onConflict(e){return this.expressionMap.onConflict=e,this}orIgnore(e=!0){return this.expressionMap.onIgnore=!!e,this}orUpdate(e,n,r){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:n,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,indexPredicate:r==null?void 0:r.indexPredicate,upsertType:r==null?void 0:r.upsertType},this):(this.expressionMap.onUpdate={conflict:e==null?void 0:e.conflict_target,columns:e==null?void 0:e.columns,overwrite:e==null?void 0:e.overwrite,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,upsertType:r==null?void 0:r.upsertType},this)}createInsertExpression(){var s,a;const e=this.getTableName(this.getMainTableName()),n=this.createValuesExpression(),r=this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),i=this.createColumnNamesExpression();let o="INSERT ";if(((s=this.expressionMap.onUpdate)==null?void 0:s.upsertType)==="primary-key"&&(o="UPSERT "),(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(o+=`${this.expressionMap.onIgnore?" IGNORE ":""}`),o+=`INTO ${e}`,this.alias!==this.getMainTableName()&&Q.isPostgresFamily(this.connection.driver)&&(o+=` AS "${this.alias}"`),i?o+=`(${i})`:!n&&(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(o+="()"),r&&this.connection.driver.options.type==="mssql"&&(o+=` OUTPUT ${r}`),n?(this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="sap")&&this.getValueSets().length>1?o+=` ${n}`:o+=` VALUES ${n}`:Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"?o+=" VALUES ()":o+=" DEFAULT VALUES",((a=this.expressionMap.onUpdate)==null?void 0:a.upsertType)!=="primary-key"){if(this.connection.driver.supportedUpsertTypes.includes("on-conflict-do-update")){if(this.expressionMap.onIgnore)o+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)o+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:c,columns:l,conflict:u,skipUpdateIfNoValuesChanged:d,indexPredicate:h}=this.expressionMap.onUpdate;let p="ON CONFLICT";if(Array.isArray(u)){if(p+=` ( ${u.map(f=>this.escape(f)).join(", ")} )`,h&&!Q.isPostgresFamily(this.connection.driver))throw new Y("indexPredicate option is not supported by the current database driver");h&&Q.isPostgresFamily(this.connection.driver)&&(p+=` WHERE ( ${h} )`)}else u&&(p+=` ON CONSTRAINT ${this.escape(u)}`);const m=[];Array.isArray(c)?m.push(...c.map(f=>`${this.escape(f)} = EXCLUDED.${this.escape(f)}`)):l&&m.push(...l.map(f=>`${this.escape(f)} = :${f}`)),m.length>0&&(o+=` ${p} DO UPDATE SET `,m.push(...this.expressionMap.mainAlias.metadata.columns.filter(f=>f.isUpdateDate&&!(c!=null&&c.includes(f.databaseName))&&!(this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")).map(f=>`${this.escape(f.databaseName)} = DEFAULT`)),o+=m.join(", "),o+=" "),Array.isArray(c)&&d&&Q.isPostgresFamily(this.connection.driver)&&(o+=" WHERE (",o+=c.map(f=>`${e}.${this.escape(f)} IS DISTINCT FROM EXCLUDED.${this.escape(f)}`).join(" OR "),o+=") ")}}else if(this.connection.driver.supportedUpsertTypes.includes("on-duplicate-key-update")){if(this.expressionMap.onUpdate){const{overwrite:c,columns:l}=this.expressionMap.onUpdate;Array.isArray(c)?(o+=" ON DUPLICATE KEY UPDATE ",o+=c.map(u=>`${this.escape(u)} = VALUES(${this.escape(u)})`).join(", "),o+=" "):Array.isArray(l)&&(o+=" ON DUPLICATE KEY UPDATE ",o+=l.map(u=>`${this.escape(u)} = :${u}`).join(", "),o+=" ")}}else if(this.expressionMap.onUpdate)throw new Y("onUpdate is not supported by the current database driver")}return r&&(Q.isPostgresFamily(this.connection.driver)||this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="cockroachdb"||Q.isMySQLFamily(this.connection.driver))&&(o+=` RETURNING ${r}`),this.connection.driver.options.type==="mssql"&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter(c=>this.expressionMap.insertColumns.length>0?this.expressionMap.insertColumns.indexOf(c.propertyPath)!==-1:c.isInsert).some(c=>this.isOverridingAutoIncrementBehavior(c))&&(o=`SET IDENTITY_INSERT ${e} ON; ${o}; SET IDENTITY_INSERT ${e} OFF`),o}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(e=>this.expressionMap.insertColumns.length?this.expressionMap.insertColumns.indexOf(e.propertyPath)!==-1:!(!e.isInsert||e.isGenerated&&e.generationStrategy==="increment"&&this.connection.driver.options.type!=="spanner"&&this.connection.driver.options.type!=="oracle"&&!Q.isSQLiteFamily(this.connection.driver)&&!Q.isMySQLFamily(this.connection.driver)&&this.connection.driver.options.type!=="aurora-mysql"&&!(this.connection.driver.options.type==="mssql"&&this.isOverridingAutoIncrementBehavior(e)))):[]}createColumnNamesExpression(){const e=this.getInsertedColumns();if(e.length>0)return e.map(n=>this.escape(n.databaseName)).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const n=this.getValueSets();if(n.length===1)return Object.keys(n[0]).map(r=>this.escape(r)).join(", ")}return this.expressionMap.insertColumns.map(n=>this.escape(n)).join(", ")}createValuesExpression(){const e=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){let r="";return e.forEach((i,o)=>{n.forEach((s,a)=>{a===0&&(this.connection.driver.options.type==="oracle"&&e.length>1||this.connection.driver.options.type==="sap"&&e.length>1?r+=" SELECT ":r+="(");let c=s.getEntityValue(i);if(typeof c!="function"&&(c=this.connection.driver.preparePersistentValue(c,s)),s.isVersion&&c===void 0)r+="1";else if(s.isDiscriminator)r+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(s.isGenerated&&s.generationStrategy==="uuid"&&!this.connection.driver.isUUIDGenerationSupported()&&c===void 0)c=ES(),r+=this.createParameter(c),o in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[o]={}),s.setEntityValue(this.expressionMap.locallyGenerated[o],c);else if(c===void 0)this.connection.driver.options.type==="oracle"&&e.length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?s.default!==void 0&&s.default!==null?r+=this.connection.driver.normalizeDefault(s):r+="NULL":r+="DEFAULT";else if(c===null&&this.connection.driver.options.type==="spanner")r+="NULL";else if(typeof c=="function")r+=c();else{this.connection.driver.options.type==="mssql"&&(c=this.connection.driver.parametrizeValue(s,c));const l=this.createParameter(c);if((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1){const u=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";s.srid!=null?r+=`${u}(${l}, ${s.srid})`:r+=`${u}(${l})`}else Q.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1?s.srid!=null?r+=`ST_SetSRID(ST_GeomFromGeoJSON(${l}), ${s.srid})::${s.type}`:r+=`ST_GeomFromGeoJSON(${l})::${s.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1?r+=s.type+"::STGeomFromText("+l+", "+(s.srid||"0")+")":r+=l}a===n.length-1?o===e.length-1?this.connection.driver.options.type==="oracle"&&e.length>1?r+=" FROM DUAL ":this.connection.driver.options.type==="sap"&&e.length>1?r+=" FROM dummy ":r+=")":this.connection.driver.options.type==="oracle"&&e.length>1?r+=" FROM DUAL UNION ALL ":this.connection.driver.options.type==="sap"&&e.length>1?r+=" FROM dummy UNION ALL ":r+="), ":r+=", "})}),r==="()"?"":r}else{let r="";return e.forEach((i,o)=>{Object.keys(i).forEach((s,a)=>{a===0&&(r+="(");const c=i[s];typeof c=="function"?r+=c():c===void 0?this.connection.driver.options.type==="oracle"&&e.length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?r+="NULL":r+="DEFAULT":c===null&&this.connection.driver.options.type==="spanner"||(r+=this.createParameter(c)),a===Object.keys(i).length-1?o===e.length-1?r+=")":r+="), ":r+=", "})}),r==="()"?"":r}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(Se.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new f_}isOverridingAutoIncrementBehavior(e){return e.isPrimary&&e.isGenerated&&e.generationStrategy==="increment"&&this.getValueSets().some(n=>e.getEntityValue(n)!==void 0&&e.getEntityValue(n)!==null)}}class qp{constructor(e,n){this.queryBuilder=e,this.expressionMap=n}async update(e){const n=this.expressionMap.relationMetadata;if(n.isManyToOne||n.isOneToOneOwner){const r=n.joinColumns.reduce((i,o)=>{const s=Se.isObject(e)?o.referencedColumn.getEntityValue(e):e;return o.setEntityValue(i,s),i},{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(n.entityMetadata.target).set(r).whereInIds(this.expressionMap.of).execute()}else if((n.isOneToOneNotOwner||n.isOneToMany)&&e===null){const r={};n.inverseRelation.joinColumns.forEach(c=>{r[c.propertyName]=null});const i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o={},s=[];i.forEach((c,l)=>{n.inverseRelation.joinColumns.map((u,d)=>{const h="joinColumn_"+l+"_"+d;o[h]=Se.isObject(c)?u.referencedColumn.getEntityValue(c):c,s.push(`${u.propertyPath} = :${h}`)})});const a=s.map(c=>"("+c+")").join(" OR ");if(!a)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(r).where(a).setParameters(o).execute()}else if(n.isOneToOneNotOwner||n.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new Y("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const r=this.expressionMap.of,i=n.inverseRelation.joinColumns.reduce((o,s)=>{const a=Se.isObject(r)?s.referencedColumn.getEntityValue(r):r;return s.setEntityValue(o,a),o},{});if(!e||Array.isArray(e)&&!e.length)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(i).whereInIds(e).execute()}else{const r=n.junctionEntityMetadata,i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(e)?e:[e],s=n.isManyToManyOwner?i:o,a=n.isManyToManyOwner?o:i,c=[];if(s.forEach(l=>{a.forEach(u=>{const d={};r.ownerColumns.forEach(h=>{d[h.databaseName]=Se.isObject(l)?h.referencedColumn.getEntityValue(l):l}),r.inverseColumns.forEach(h=>{d[h.databaseName]=Se.isObject(u)?h.referencedColumn.getEntityValue(u):u}),c.push(d)})}),!c.length)return;this.queryBuilder.connection.driver.options.type==="oracle"||this.queryBuilder.connection.driver.options.type==="sap"?await Promise.all(c.map(l=>this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(l).execute())):await this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(c).execute()}}}class _S{constructor(e,n){this.queryBuilder=e,this.expressionMap=n}async remove(e){const n=this.expressionMap.relationMetadata;if(n.isOneToMany){const r=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i=Array.isArray(e)?e:[e],o={};n.inverseRelation.joinColumns.forEach(l=>{o[l.propertyName]=null});const s={},a=[];r.forEach((l,u)=>{a.push(...i.map((d,h)=>[...n.inverseRelation.joinColumns.map((p,m)=>{const f="joinColumn_"+u+"_"+h+"_"+m;return s[f]=Se.isObject(l)?p.referencedColumn.getEntityValue(l):l,`${p.propertyPath} = :${f}`}),...n.inverseRelation.entityMetadata.primaryColumns.map((p,m)=>{const f="primaryColumn_"+h+"_"+h+"_"+m;return s[f]=Se.isObject(d)?p.getEntityValue(d):d,`${p.propertyPath} = :${f}`})].join(" AND ")))});const c=a.map(l=>"("+l+")").join(" OR ");if(!c)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(o).where(c).setParameters(s).execute()}else{const r=n.junctionEntityMetadata,i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(e)?e:[e],s=n.isManyToManyOwner?i:o,a=n.isManyToManyOwner?o:i,c={},l=[];s.forEach((d,h)=>{l.push(...a.map((p,m)=>[...r.ownerColumns.map((f,y)=>{const g="firstValue_"+h+"_"+m+"_"+y;return c[g]=Se.isObject(d)?f.referencedColumn.getEntityValue(d):d,`${f.databaseName} = :${g}`}),...r.inverseColumns.map((f,y)=>{const g="secondValue_"+h+"_"+m+"_"+y;return c[g]=Se.isObject(p)?f.referencedColumn.getEntityValue(p):p,`${f.databaseName} = :${g}`})].join(" AND ")))});const u=l.map(d=>"("+d+")").join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(r.tableName).where(u).setParameters(c).execute()}}}class SS extends we{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(e){return this.expressionMap.of=e,this}async set(e){const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new Y("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToMany||n.isOneToMany)throw new Y(`Set operation is only supported for many-to-one and one-to-one relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .add() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!Se.isObject(e)||Object.keys(e).length<n.joinColumns.length))throw new Y('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new qp(this,this.expressionMap).update(e)}async add(e){if(Array.isArray(e)&&e.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new Y("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new Y(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!Se.isObject(e)||Object.keys(e).length<n.joinColumns.length))throw new Y('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new qp(this,this.expressionMap).update(e)}async remove(e){if(Array.isArray(e)&&e.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new Y("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new Y(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set(null) method instead.`);return new _S(this,this.expressionMap).remove(e)}async addAndRemove(e,n){await this.remove(n),await this.add(e)}async loadOne(){return this.loadMany().then(e=>e[0])}async loadMany(){let e=this.expressionMap.of;if(!Se.isObject(e)){const n=this.expressionMap.mainAlias.metadata;if(n.hasMultiplePrimaryKeys)throw new Y("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=n.primaryColumns[0].createValueMap(e)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)}}class je{static chunk(e,n){return Array.from(Array(Math.ceil(e.length/n)),(r,i)=>e.slice(i*n,i*n+n))}static splitClassesAndStrings(e){return[e.filter(n=>typeof n!="string"),e.filter(n=>typeof n=="string")]}static groupBy(e,n){return e.reduce((r,i)=>{const o=n(i);let s=r.find(a=>a.id===o);return s||(s={id:o,items:[]},r.push(s)),s.items.push(i),r},[])}static uniq(e,n){return e.reduce((r,i)=>{let o=!1;if(typeof n=="function"){const s=n(i);o=!!r.find(a=>n(a)===s)}else typeof n=="string"?o=!!r.find(s=>s[n]===i[n]):o=r.indexOf(i)!==-1;return o||r.push(i),r},[])}static isPlainObject(e){return e==null?!1:!e.constructor||e.constructor===Object}static mergeArrayKey(e,n,r,i){if(i.has(r)){e[n]=i.get(r);return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){e[n]=r;return}e[n]||(e[n]=Array.isArray(r)?[]:{}),i.set(r,e[n]),this.merge(e[n],r,i),i.delete(r)}}static mergeObjectKey(e,n,r,i){if(i.has(r)){Object.assign(e,{[n]:i.get(r)});return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){Object.assign(e,{[n]:r});return}e[n]||Object.assign(e,{[n]:Array.isArray(r)?[]:{}}),i.set(r,e[n]),this.merge(e[n],r,i),i.delete(r)}}static merge(e,n,r=new Map){if(this.isPlainObject(e)&&this.isPlainObject(n))for(const i of Object.keys(n))i!=="__proto__"&&this.mergeObjectKey(e,i,n[i],r);if(Array.isArray(e)&&Array.isArray(n))for(let i=0;i<n.length;i++)this.mergeArrayKey(e,i,n[i],r)}static mergeDeep(e,...n){if(!n.length)return e;for(const r of n)je.merge(e,r);return e}static deepCompare(...e){let n,r,i,o;if(arguments.length<1)return!0;for(n=1,r=arguments.length;n<r;n++)if(i=[],o=[],!this.compare2Objects(i,o,arguments[0],arguments[n]))return!1;return!0}static deepValue(e,n){const r=n.split(".");for(let i=0,o=r.length;i<o;i++)e=e[r[i]];return e}static replaceEmptyObjectsWithBooleans(e){for(let n in e)e[n]&&typeof e[n]=="object"&&(Object.keys(e[n]).length===0?e[n]=!0:this.replaceEmptyObjectsWithBooleans(e[n]))}static propertyPathsToTruthyObject(e){let n={};for(let r of e){const i=r.split(".");if(!i.length)continue;(!n[i[0]]||n[i[0]]===!0)&&(n[i[0]]={});let o=n[i[0]];for(let[s,a]of i.entries())s!==0&&(o[a]?o=o[a]:s===i.length-1?(o[a]={},o=null):(o[a]={},o=o[a]))}return this.replaceEmptyObjectsWithBooleans(n),n}static compareIds(e,n){return e==null||n===void 0||n===null?!1:(typeof e.id=="string"&&typeof n.id=="string"||typeof e.id=="number"&&typeof n.id=="number")&&Object.keys(e).length===1&&Object.keys(n).length===1?e.id===n.id:je.deepCompare(e,n)}static toBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e==="true"||e==="1":typeof e=="number"?e>0:!1}static zipObject(e,n){return e.reduce((r,i,o)=>(r[i]=n[o],r),{})}static isArraysEqual(e,n){return e.length!==n.length?!1:e.every(r=>n.indexOf(r)!==-1)}static areMutuallyExclusive(...e){return!e.some(n=>{const r=e.filter(i=>i!==n);return n.some(i=>r.some(o=>o.includes(i)))})}static parseSqlCheckExpression(e,n){const r=e.match(new RegExp(`"${n}" varchar CHECK\\s*\\(\\s*"${n}"\\s+IN\\s*`));if(r&&r.index){const i=e.substring(r.index+r[0].length);let o="",s="";const a=[];for(let c=0;c<i.length;c++){const l=i[c];switch(l){case",":o==""?(a.push(s),s=""):s+=l;break;case"'":o==l?i[c+1]===l?(s+=l,c+=1):o="":o=l;break;case")":if(o=="")return a.push(s),a;s+=l;break;default:o!=""&&(s+=l)}}}}static compare2Objects(e,n,r,i){let o;if(Number.isNaN(r)&&Number.isNaN(i)||r===i)return!0;if(r===null||i===null||r===void 0||i===void 0)return!1;if((typeof r.equals=="function"||typeof r.equals=="function")&&r.equals(i))return!0;if(typeof r=="function"&&typeof i=="function"||r instanceof Date&&i instanceof Date||r instanceof RegExp&&i instanceof RegExp||typeof r=="string"&&typeof i=="string"||typeof r=="number"&&typeof i=="number")return r.toString()===i.toString();if(!(typeof r=="object"&&typeof i=="object")||Object.prototype.isPrototypeOf.call(r,i)||Object.prototype.isPrototypeOf.call(i,r)||r.constructor!==i.constructor||r.prototype!==i.prototype||e.indexOf(r)>-1||n.indexOf(i)>-1)return!1;for(o in i)if(i.hasOwnProperty(o)!==r.hasOwnProperty(o)||typeof i[o]!=typeof r[o])return!1;for(o in r){if(i.hasOwnProperty(o)!==r.hasOwnProperty(o)||typeof i[o]!=typeof r[o])return!1;switch(typeof r[o]){case"object":case"function":if(e.push(r),n.push(i),!this.compare2Objects(e,n,r[o],i[o]))return!1;e.pop(),n.pop();break;default:if(r[o]!==i[o])return!1;break}}return!0}}class OS{constructor(e,n,r,i,o){this.expressionMap=e,this.driver=n,this.rawRelationIdResults=r,this.rawRelationCountResults=i,this.queryRunner=o}transform(e,n){const r=this.group(e,n),i=[];return r.forEach(o=>{const s=this.transformRawResultsGroup(o,n);s!==void 0&&!Object.values(s).every(a=>a===null)&&i.push(s)}),i}group(e,n){const r=new Map,i=[];return n.metadata.tableType==="view"?i.push(...n.metadata.columns.map(o=>Q.buildAlias(this.driver,void 0,n.name,o.databaseName))):i.push(...n.metadata.primaryColumns.map(o=>Q.buildAlias(this.driver,void 0,n.name,o.databaseName))),e.forEach(o=>{const s=i.map(c=>{const l=o[c];return Ef.isBuffer(l)?l.toString("hex"):Se.isObject(l)?JSON.stringify(l):l}).join("_"),a=r.get(s);a?a.push(o):r.set(s,[o])}),r}transformRawResultsGroup(e,n){let r=n.metadata;if(r.discriminatorColumn){const l=e.map(d=>d[Q.buildAlias(this.driver,void 0,n.name,n.metadata.discriminatorColumn.databaseName)]),u=r.childEntityMetadatas.find(d=>typeof l.find(h=>h===d.discriminatorValue)<"u");u&&(r=u)}let i=r.create(this.queryRunner,{fromDeserializer:!0,pojo:this.expressionMap.options.indexOf("create-pojo")!==-1});const o=this.transformColumns(e,n,i,r),s=this.transformJoins(e,i,n,r),a=this.transformRelationIds(e,n,i,r),c=this.transformRelationCounts(e,n,i);if(o||r.primaryColumns.filter(l=>l.isVirtual===!1).length===0&&(s||a||c))return i}transformColumns(e,n,r,i){let o=!1;return i.columns.forEach(s=>{if(i.childEntityMetadatas.length>0&&i.childEntityMetadatas.findIndex(c=>c.target===s.target)!==-1)return;const a=e[0][Q.buildAlias(this.driver,void 0,n.name,s.databaseName)];a===void 0||s.isVirtual||this.expressionMap.selects.find(c=>c.selection===n.name||c.selection===n.name+"."+s.propertyPath)&&(s.setEntityValue(r,this.driver.prepareHydratedValue(a,s)),a!==null&&(o=!0))}),o}transformJoins(e,n,r,i){let o=!1;return this.expressionMap.joinAttributes.forEach(s=>{if(!s.metadata||!s.isSelected||s.relation&&!i.relations.find(c=>c===s.relation))return;if(s.mapToProperty){if(s.mapToPropertyParentAlias!==r.name)return}else if(!s.relation||s.parentAlias!==r.name||s.relationPropertyPath!==s.relation.propertyPath)return;let a=this.transform(e,s.alias);a=s.isMany?a:a[0],a=!s.isMany&&a===void 0?null:a,a!==void 0&&(s.mapToPropertyPropertyName?n[s.mapToPropertyPropertyName]=a:s.relation.setEntityValue(n,a),o=!0)}),o}transformRelationIds(e,n,r,i){let o=!1;return this.rawRelationIdResults.forEach((s,a)=>{if(s.relationIdAttribute.parentAlias!==n.name)return;const c=s.relationIdAttribute.relation,l=this.createValueMapFromJoinColumns(c,s.relationIdAttribute.parentAlias,e);if(l==null)return;this.prepareDataForTransformRelationIds();const u=this.hashEntityIds(c,l),d=this.relationIdMaps[a][u]||[],h=s.relationIdAttribute.mapToPropertyPropertyPath.split("."),p=(m,f,y)=>{const g=m.shift();if(g&&m.length===0)return f[g]=y,f;if(g&&m.length>0)p(m,f[g],y);else return f};c.isOneToOne||c.isManyToOne?d[0]!==void 0&&(p(h,r,d[0]),o=!0):(p(h,r,d),o=o||d.length>0)}),o}transformRelationCounts(e,n,r){let i=!1;return this.rawRelationCountResults.filter(o=>o.relationCountAttribute.parentAlias===n.name).forEach(o=>{const s=o.relationCountAttribute.relation;let a;s.isOneToMany?a=s.inverseRelation.joinColumns[0].referencedColumn.databaseName:a=s.isOwning?s.joinColumns[0].referencedColumn.databaseName:s.inverseRelation.joinColumns[0].referencedColumn.databaseName;const c=e[0][Q.buildAlias(this.driver,void 0,n.name,a)];c!=null&&(r[o.relationCountAttribute.mapToPropertyPropertyName]=0,o.results.filter(l=>l.parentId===c).forEach(l=>{r[o.relationCountAttribute.mapToPropertyPropertyName]=parseInt(l.cnt),i=!0}))}),i}createValueMapFromJoinColumns(e,n,r){let i;return e.isManyToOne||e.isOneToOneOwner?i=e.entityMetadata.primaryColumns.map(o=>o):e.isOneToMany||e.isOneToOneNotOwner?i=e.inverseRelation.joinColumns.map(o=>o):e.isOwning?i=e.joinColumns.map(o=>o):i=e.inverseRelation.inverseJoinColumns.map(o=>o),i.reduce((o,s)=>(r.forEach(a=>{e.isManyToOne||e.isOneToOneOwner?o[s.databaseName]=this.driver.prepareHydratedValue(a[Q.buildAlias(this.driver,void 0,n,s.databaseName)],s):o[s.databaseName]=this.driver.prepareHydratedValue(a[Q.buildAlias(this.driver,void 0,n,s.referencedColumn.databaseName)],s.referencedColumn)}),o),{})}extractEntityPrimaryIds(e,n){let r;return e.isManyToOne||e.isOneToOneOwner?r=e.entityMetadata.primaryColumns.map(i=>i):e.isOneToMany||e.isOneToOneNotOwner?r=e.inverseRelation.joinColumns.map(i=>i):e.isOwning?r=e.joinColumns.map(i=>i):r=e.inverseRelation.inverseJoinColumns.map(i=>i),r.reduce((i,o)=>(i[o.databaseName]=n[o.databaseName],i),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map(e=>{const n=e.relationIdAttribute.relation;let r;return n.isManyToOne||n.isOneToOneOwner?r=n.joinColumns:n.isOneToMany||n.isOneToOneNotOwner?r=n.inverseEntityMetadata.primaryColumns:n.isOwning?r=n.inverseJoinColumns:r=n.inverseRelation.joinColumns,e.results.reduce((i,o)=>{let s=r.reduce((a,c)=>{let l=o[c.databaseName];return n.isOneToMany||n.isOneToOneNotOwner?(c.isVirtual&&c.referencedColumn&&c.referencedColumn.propertyName!==c.propertyName&&(l=c.referencedColumn.createValueMap(l)),je.mergeDeep(a,c.createValueMap(l))):(!c.isPrimary&&c.referencedColumn.referencedColumn&&(l=c.referencedColumn.referencedColumn.createValueMap(l)),je.mergeDeep(a,c.referencedColumn.createValueMap(l)))},{});if(r.length===1&&!e.relationIdAttribute.disableMixedMap&&(n.isOneToMany||n.isOneToOneNotOwner?s=r[0].getEntityValue(s):s=r[0].referencedColumn.getEntityValue(s)),s!==void 0){const a=this.hashEntityIds(n,o);i[a]?i[a].push(s):i[a]=[s]}return i},{})}))}hashEntityIds(e,n){const r=this.extractEntityPrimaryIds(e,n);return JSON.stringify(r)}}let AS=class{constructor(t,e,n){this.connection=t,this.queryRunner=e,this.relationIdAttributes=n}async load(t){const e=this.relationIdAttributes.map(async n=>{if(n.relation.isManyToOne||n.relation.isOneToOneOwner){if(n.queryBuilderFactory)throw new Y("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const r={},i=t.map(o=>{const s={},a=[];n.relation.joinColumns.forEach(l=>{s[l.databaseName]=this.connection.driver.prepareHydratedValue(o[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,l.databaseName)],l.referencedColumn);const u=`${l.databaseName}:${s[l.databaseName]}`;a.indexOf(u)===-1&&a.push(u)}),n.relation.entityMetadata.primaryColumns.forEach(l=>{s[l.databaseName]=this.connection.driver.prepareHydratedValue(o[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,l.databaseName)],l);const u=`${l.databaseName}:${s[l.databaseName]}`;a.indexOf(u)===-1&&a.push(u)}),a.sort();const c=a.join("::");return r[c]?null:(r[c]=!0,s)}).filter(o=>o);return{relationIdAttribute:n,results:i}}else if(n.relation.isOneToMany||n.relation.isOneToOneNotOwner){const r=n.relation,i=r.isOwning?r.joinColumns:r.inverseRelation.joinColumns,o=r.inverseEntityMetadata.target,s=r.inverseEntityMetadata.tableName,a=n.alias||s,c={},l={},u=t.map((p,m)=>{const f=[],y={},g=i.map(x=>{const v=x.databaseName+m,C=p[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,x.referencedColumn.databaseName)],T=`${a}:${x.propertyPath}:${C}`;return f.indexOf(T)!==-1?"":(f.push(T),y[v]=C,a+"."+x.propertyPath+" = :"+v)}).filter(x=>x).join(" AND ");f.sort();const b=f.join("::");return c[b]?"":(c[b]=!0,Object.assign(l,y),g)}).filter(p=>p).map(p=>"("+p+")").join(" OR ");if(!u)return{relationIdAttribute:n,results:[]};const d=this.connection.createQueryBuilder(this.queryRunner);je.uniq([...i,...r.inverseRelation.entityMetadata.primaryColumns],p=>p.propertyPath).forEach(p=>{d.addSelect(a+"."+p.propertyPath,p.databaseName)}),d.from(o,a).where("("+u+")").setParameters(l),n.queryBuilderFactory&&n.queryBuilderFactory(d);const h=await d.getRawMany();return h.forEach(p=>{i.forEach(m=>{p[m.databaseName]=this.connection.driver.prepareHydratedValue(p[m.databaseName],m.referencedColumn)}),r.inverseRelation.entityMetadata.primaryColumns.forEach(m=>{p[m.databaseName]=this.connection.driver.prepareHydratedValue(p[m.databaseName],m)})}),{relationIdAttribute:n,results:h}}else{const r=n.relation,i=r.isOwning?r.joinColumns:r.inverseRelation.inverseJoinColumns,o=r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns,s=n.junctionAlias,a=n.joinInverseSideMetadata.tableName,c=n.alias||a,l=r.isOwning?r.junctionEntityMetadata.tableName:r.inverseRelation.junctionEntityMetadata.tableName,u=t.map(b=>i.reduce((x,v)=>(x[v.propertyPath]=b[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,v.referencedColumn.databaseName)],x),{}));if(u.length===0)return{relationIdAttribute:n,results:[]};const d={},h={},p=u.map((b,x)=>{const v=[],C={},T=Object.keys(b).map(j=>{const $=j+x,B=b[j],V=`${s}:${j}:${B}`;return v.indexOf(V)!==-1?"":(v.push(V),C[$]=B,s+"."+j+" = :"+$)}).filter(j=>j).join(" AND ");v.sort();const S=v.join("::");return h[S]?"":(h[S]=!0,Object.assign(d,C),T)}).filter(b=>b),m=o.map(b=>s+"."+b.propertyPath+" = "+c+"."+b.referencedColumn.propertyPath).join(" AND "),f=p.map(b=>"("+b+" AND "+m+")").join(" OR "),y=this.connection.createQueryBuilder(this.queryRunner);o.forEach(b=>{y.addSelect(s+"."+b.propertyPath,b.databaseName).addOrderBy(s+"."+b.propertyPath)}),i.forEach(b=>{y.addSelect(s+"."+b.propertyPath,b.databaseName).addOrderBy(s+"."+b.propertyPath)}),y.from(a,c).innerJoin(l,s,f).setParameters(d),n.queryBuilderFactory&&n.queryBuilderFactory(y);const g=await y.getRawMany();return g.forEach(b=>{[...i,...o].forEach(x=>{b[x.databaseName]=this.connection.driver.prepareHydratedValue(b[x.databaseName],x.referencedColumn)})}),{relationIdAttribute:n,results:g}}});return Promise.all(e)}};class NS{constructor(e,n){this.connection=e,this.queryRunner=n}load(e,n,r){const i=Array.isArray(n)?n:[n],o=Array.isArray(r)?r:r?[r]:void 0;return e.isManyToMany?this.loadForManyToMany(e,i,o):e.isManyToOne||e.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(e,i,o):this.loadForOneToManyAndOneToOneNotOwner(e,i,o)}async loadManyToManyRelationIdsAndGroup(e,n,r,i){const o=e.isManyToMany||e.isOneToMany,s=Array.isArray(n)?n:[n];if(!r&&(r=await this.connection.relationLoader.load(e,n,this.queryRunner,i),!r.length))return s.map(d=>({entity:d,related:o?[]:void 0}));const a=await this.load(e,n,r),c=Array.isArray(r)?r:[r];let l=[],u=[];return e.isManyToManyOwner?(l=e.junctionEntityMetadata.inverseColumns.map(d=>d.referencedColumn),u=e.junctionEntityMetadata.ownerColumns.map(d=>d.referencedColumn)):e.isManyToManyNotOwner?(l=e.junctionEntityMetadata.ownerColumns.map(d=>d.referencedColumn),u=e.junctionEntityMetadata.inverseColumns.map(d=>d.referencedColumn)):e.isManyToOne||e.isOneToOneOwner?(l=e.joinColumns.map(d=>d.referencedColumn),u=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(l=e.inverseRelation.entityMetadata.primaryColumns,u=e.inverseRelation.joinColumns.map(d=>d.referencedColumn)),s.map(d=>{const h={entity:d,related:o?[]:void 0},p=a.filter(m=>u.every(f=>f.compareEntityValue(d,m[f.entityMetadata.name+"_"+f.propertyAliasName])));return p.length&&c.forEach(m=>{p.forEach(f=>{l.every(y=>y.compareEntityValue(m,f[Q.buildAlias(this.connection.driver,void 0,y.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+y.propertyPath.replace(".","_"))]))&&(o?h.related.push(m):h.related=m)})}),h})}loadForManyToMany(e,n,r){const i=e.junctionEntityMetadata,o=i.name,s=e.isOwning?i.ownerColumns:i.inverseColumns,a=e.isOwning?i.inverseColumns:i.ownerColumns,c=this.connection.createQueryBuilder(this.queryRunner);s.forEach(h=>{const p=Q.buildAlias(this.connection.driver,void 0,h.referencedColumn.entityMetadata.name+"_"+h.referencedColumn.propertyPath.replace(".","_"));c.addSelect(o+"."+h.propertyPath,p)}),a.forEach(h=>{const p=Q.buildAlias(this.connection.driver,void 0,h.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+h.referencedColumn.propertyPath.replace(".","_"));c.addSelect(o+"."+h.propertyPath,p)});let l="";if(s.length===1){const h=n.map(p=>s[0].referencedColumn.getEntityValue(p));h.every(p=>typeof p=="number")?l=`${o}.${s[0].propertyPath} IN (${h.join(", ")})`:(c.setParameter("values1",h),l=o+"."+s[0].propertyPath+" IN (:...values1)")}else l="("+n.map((h,p)=>s.map(m=>{const f="entity1_"+p+"_"+m.propertyName;return c.setParameter(f,m.referencedColumn.getEntityValue(h)),o+"."+m.propertyPath+" = :"+f}).join(" AND ")).map(h=>"("+h+")").join(" OR ")+")";let u="";if(r)if(a.length===1){const h=r.map(p=>a[0].referencedColumn.getEntityValue(p));h.every(p=>typeof p=="number")?u=`${o}.${a[0].propertyPath} IN (${h.join(", ")})`:(c.setParameter("values2",h),u=o+"."+a[0].propertyPath+" IN (:...values2)")}else u="("+r.map((h,p)=>a.map(m=>{const f="entity2_"+p+"_"+m.propertyName;return c.setParameter(f,m.referencedColumn.getEntityValue(h)),o+"."+m.propertyPath+" = :"+f}).join(" AND ")).map(h=>"("+h+")").join(" OR ")+")";const d=[l,u].filter(h=>h.length>0).join(" AND ");return c.from(i.target,o).where(d).getRawMany()}loadForManyToOneAndOneToOneOwner(e,n,r){const i=e.entityMetadata.targetName,o=e.joinColumns.every(c=>!!e.entityMetadata.nonVirtualColumns.find(l=>l===c));if(r&&o){let c=[];if(n.forEach(l=>{let u={};e.entityMetadata.primaryColumns.forEach(d=>{const h=d.entityMetadata.name+"_"+d.propertyPath.replace(".","_");u[h]=d.getEntityValue(l)}),r.forEach(d=>{e.joinColumns.forEach(h=>{const p=h.getEntityValue(l),m=h.referencedColumn.getEntityValue(d);if(!(p===void 0||m===void 0)&&p===m){const f=h.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+h.referencedColumn.propertyPath.replace(".","_");u[f]=m}})}),Object.keys(u).length===e.entityMetadata.primaryColumns.length+e.joinColumns.length&&c.push(u)}),c.length===n.length)return Promise.resolve(c)}const s=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(c=>{const l=Q.buildAlias(this.connection.driver,void 0,c.entityMetadata.name+"_"+c.propertyPath.replace(".","_"));s.addSelect(i+"."+c.propertyPath,l)}),e.joinColumns.forEach(c=>{const l=Q.buildAlias(this.connection.driver,void 0,c.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+c.referencedColumn.propertyPath.replace(".","_"));s.addSelect(i+"."+c.propertyPath,l)});let a="";if(e.entityMetadata.primaryColumns.length===1){const c=n.map(l=>e.entityMetadata.primaryColumns[0].getEntityValue(l));c.every(l=>typeof l=="number")?a=`${i}.${e.entityMetadata.primaryColumns[0].propertyPath} IN (${c.join(", ")})`:(s.setParameter("values",c),a=i+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else a=n.map((c,l)=>e.entityMetadata.primaryColumns.map((u,d)=>{const h="entity"+l+"_"+d;return s.setParameter(h,u.getEntityValue(c)),i+"."+u.propertyPath+" = :"+h}).join(" AND ")).map(c=>"("+c+")").join(" OR ");return s.from(e.entityMetadata.target,i).where(a).getRawMany()}loadForOneToManyAndOneToOneNotOwner(e,n,r){if(e=e.inverseRelation,e.entityMetadata.primaryColumns.length===e.joinColumns.length&&e.entityMetadata.primaryColumns.every(a=>e.joinColumns.indexOf(a)!==-1))return Promise.resolve(n.map(a=>{const c={};return e.joinColumns.forEach(function(l){const u=l.referencedColumn.getEntityValue(a),d=l.referencedColumn.entityMetadata.name+"_"+l.referencedColumn.propertyPath.replace(".","_"),h=l.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+l.propertyPath.replace(".","_");c[d]=u,c[h]=u}),c}));const i=e.entityMetadata.targetName,o=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(a=>{const c=Q.buildAlias(this.connection.driver,void 0,a.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+a.propertyPath.replace(".","_"));o.addSelect(i+"."+a.propertyPath,c)}),e.joinColumns.forEach(a=>{const c=Q.buildAlias(this.connection.driver,void 0,a.referencedColumn.entityMetadata.name+"_"+a.referencedColumn.propertyPath.replace(".","_"));o.addSelect(i+"."+a.propertyPath,c)});let s="";if(e.joinColumns.length===1){const a=n.map(c=>e.joinColumns[0].referencedColumn.getEntityValue(c));a.every(c=>typeof c=="number")?s=`${i}.${e.joinColumns[0].propertyPath} IN (${a.join(", ")})`:(o.setParameter("values",a),s=i+"."+e.joinColumns[0].propertyPath+" IN (:...values)")}else s=n.map((a,c)=>e.joinColumns.map((l,u)=>{const d="entity"+c+"_"+u;return o.setParameter(d,l.referencedColumn.getEntityValue(a)),i+"."+l.propertyPath+" = :"+d}).join(" AND ")).map(a=>"("+a+")").join(" OR ");return o.from(e.entityMetadata.target,i).where(s).getRawMany()}}class PS{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(e=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationIds.forEach(n=>{const r=this.metadataToAttribute(e.alias.name,n);this.expressionMap.relationIdAttributes.push(r)})})}metadataToAttribute(e,n){return new hs(this.expressionMap,{relationName:e+"."+n.relation.propertyName,mapToProperty:e+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class kS{constructor(e,n,r){this.connection=e,this.queryRunner=n,this.relationCountAttributes=r}async load(e){const n=(i,o,s)=>s.indexOf(i)===o,r=this.relationCountAttributes.map(async i=>{if(i.relation.isOneToMany){const o=i.relation,s=o.inverseRelation,a=s.joinColumns[0].referencedColumn.propertyName,c=o.inverseEntityMetadata.target,l=o.inverseEntityMetadata.tableName,u=i.alias||l,d=s.propertyName;let h=e.map(m=>m[i.parentAlias+"_"+a]).filter(m=>!!m);if(h=h.filter(n),h.length===0)return{relationCountAttribute:i,results:[]};const p=this.connection.createQueryBuilder(this.queryRunner);return p.select(u+"."+d,"parentId").addSelect("COUNT(*)","cnt").from(c,u).where(u+"."+d+" IN (:...ids)").addGroupBy(u+"."+d).setParameter("ids",h),i.queryBuilderFactory&&i.queryBuilderFactory(p),{relationCountAttribute:i,results:await p.getRawMany()}}else{let o,s,a,c;i.relation.isOwning?(o=i.relation.joinColumns[0].referencedColumn.databaseName,s=i.relation.inverseJoinColumns[0].referencedColumn.databaseName,a=i.relation.junctionEntityMetadata.columns[0],c=i.relation.junctionEntityMetadata.columns[1]):(o=i.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,s=i.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,a=i.relation.junctionEntityMetadata.columns[1],c=i.relation.junctionEntityMetadata.columns[0]);let l=e.map(y=>y[i.parentAlias+"_"+o]).filter(y=>!!y);if(l=l.filter(n),l.length===0)return{relationCountAttribute:i,results:[]};const u=i.junctionAlias,d=i.joinInverseSideMetadata.tableName,h=i.alias||d,p=i.relation.junctionEntityMetadata.tableName,m=u+"."+a.propertyName+" IN ("+l.map(y=>isNaN(y)?"'"+y+"'":y)+") AND "+u+"."+c.propertyName+" = "+h+"."+s,f=this.connection.createQueryBuilder(this.queryRunner);return f.select(u+"."+a.propertyName,"parentId").addSelect("COUNT("+f.escape(h)+"."+f.escape(s)+")","cnt").from(d,h).innerJoin(p,u,m).addGroupBy(u+"."+a.propertyName),i.queryBuilderFactory&&i.queryBuilderFactory(f),{relationCountAttribute:i,results:await f.getRawMany()}}});return Promise.all(r)}}class TS{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(e=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationCounts.forEach(n=>{const r=this.metadataToAttribute(e.alias.name,n);this.expressionMap.relationCountAttributes.push(r)})})}metadataToAttribute(e,n){return new ps(this.expressionMap,{relationName:e+"."+n.relation.propertyName,mapToProperty:e+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class gs{static isFindOneOptions(e){const n=e;return n&&(Array.isArray(n.select)||Array.isArray(n.relations)||typeof n.select=="object"||typeof n.relations=="object"||typeof n.where=="object"||typeof n.join=="object"||typeof n.order=="object"||typeof n.cache=="object"||typeof n.cache=="boolean"||typeof n.cache=="number"||typeof n.comment=="string"||typeof n.lock=="object"||typeof n.loadRelationIds=="object"||typeof n.loadRelationIds=="boolean"||typeof n.loadEagerRelations=="boolean"||typeof n.withDeleted=="boolean"||typeof n.relationLoadStrategy=="string"||typeof n.transaction=="boolean")}static isFindManyOptions(e){const n=e;return n&&(this.isFindOneOptions(n)||typeof n.skip=="number"||typeof n.take=="number"||typeof n.skip=="string"||typeof n.take=="string")}static extractFindManyOptionsAlias(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias}static applyOptionsToTreeQueryBuilder(e,n){if(n!=null&&n.relations){const r=[...n.relations];if(gs.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),r.length>0)throw new m_(r)}return e}static applyRelationsRecursively(e,n,r,i,o){let s=[];if(o){const a=new RegExp("^"+o.replace(".","\\.")+"\\.");s=n.filter(c=>c.match(a)).map(c=>i.findRelationWithPropertyPath(c.replace(a,""))).filter(c=>c)}else s=n.map(a=>i.findRelationWithPropertyPath(a)).filter(a=>a);s.forEach(a=>{let c=Q.buildAlias(e.connection.driver,{joiner:"__"},r,a.propertyPath);const l=r+"."+a.propertyPath;e.expressionMap.relationLoadStrategy==="query"?e.concatRelationMetadata(a):e.leftJoinAndSelect(l,c),n.splice(n.indexOf(o?o+"."+a.propertyPath:a.propertyPath),1);let u,d;if(e.expressionMap.relationLoadStrategy==="query")u=a.inverseEntityMetadata,d=c;else{const h=e.expressionMap.joinAttributes.find(p=>p.entityOrProperty===l);u=h.metadata,d=h.alias.name}if(!d||!u)throw new Ge(a.propertyPath,i);if(this.applyRelationsRecursively(e,n,d,u,o?o+"."+a.propertyPath:a.propertyPath),e.expressionMap.relationLoadStrategy==="join"){const h=i.relations.find(p=>p.propertyName===a.propertyPath);h&&this.joinEagerRelations(e,c,h.inverseEntityMetadata)}})}static joinEagerRelations(e,n,r){r.eagerRelations.forEach(i=>{let o=Q.buildAlias(e.connection.driver,{joiner:"__"},n,i.propertyName),s=!0;for(const l of e.expressionMap.joinAttributes)if(!(l.condition!==void 0||l.mapToProperty!==void 0||l.isMappingMany!==void 0||l.direction!=="LEFT"||l.entityOrProperty!==`${n}.${i.propertyPath}`)){s=!1,o=l.alias.name;break}const a=!!e.expressionMap.joinAttributes.find(l=>l.alias.name===o);s&&!a&&e.leftJoin(n+"."+i.propertyPath,o);let c=!0;for(const l of e.expressionMap.selects)if(!(l.aliasName!==void 0||l.virtual!==void 0||l.selection!==o)){c=!1;break}c&&e.addSelect(o),this.joinEagerRelations(e,o,i.inverseEntityMetadata)})}}class xs extends we{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),this.replacePropertyNamesForTheWholeQuery(e)}setFindOptions(e){return this.findOptions=e,this.applyFindOptions(),this}subQuery(){const e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e}select(e,n){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map(r=>({selection:r}));else if(typeof e=="function"){const r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:n}]);return this}addSelect(e,n){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map(r=>({selection:r})));else if(typeof e=="function"){const r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else e&&this.expressionMap.selects.push({selection:e,aliasName:n});return this}maxExecutionTime(e){return this.expressionMap.maxExecutionTime=e,this}distinct(e=!0){return this.expressionMap.selectDistinct=e,this}distinctOn(e){return this.expressionMap.selectDistinctOn=e,this}fromDummy(){return this.from(this.connection.driver.dummyTableName??"(SELECT 1 AS dummy_column)","dummy_table")}from(e,n){const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}addFrom(e,n){const r=this.createFromAlias(e,n);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(r),this}innerJoin(e,n,r,i){return this.join("INNER",e,n,r,i),this}leftJoin(e,n,r,i){return this.join("LEFT",e,n,r,i),this}innerJoinAndSelect(e,n,r,i){return this.addSelect(n),this.innerJoin(e,n,r,i),this}leftJoinAndSelect(e,n,r,i){return this.addSelect(n),this.leftJoin(e,n,r,i),this}innerJoinAndMapMany(e,n,r,i,o){return this.addSelect(r),this.join("INNER",n,r,i,o,e,!0),this}innerJoinAndMapOne(e,n,r,i,o,s){return this.addSelect(r),this.join("INNER",n,r,i,o,e,!1,s),this}leftJoinAndMapMany(e,n,r,i,o){return this.addSelect(r),this.join("LEFT",n,r,i,o,e,!0),this}leftJoinAndMapOne(e,n,r,i,o,s){return this.addSelect(r),this.join("LEFT",n,r,i,o,e,!1,s),this}loadRelationIdAndMap(e,n,r,i){const o=new hs(this.expressionMap);return o.mapToProperty=e,o.relationName=n,typeof r=="string"&&(o.alias=r),typeof r=="object"&&r.disableMixedMap&&(o.disableMixedMap=!0),o.queryBuilderFactory=i,this.expressionMap.relationIdAttributes.push(o),o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(e,n,r,i){const o=new ps(this.expressionMap);return o.mapToProperty=e,o.relationName=n,o.alias=r,o.queryBuilderFactory=i,this.expressionMap.relationCountAttributes.push(o),this.expressionMap.createAlias({type:"other",name:o.junctionAlias}),o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata}),this}loadAllRelationIds(e){return this.expressionMap.mainAlias.metadata.relations.forEach(n=>{e!==void 0&&e.relations!==void 0&&e.relations.indexOf(n.propertyPath)===-1||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+n.propertyPath,this.expressionMap.mainAlias.name+"."+n.propertyPath,e)}),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereExists(e){return this.where(...this.getExistsCondition(e))}andWhereExists(e){return this.andWhere(...this.getExistsCondition(e))}orWhereExists(e){return this.orWhere(...this.getExistsCondition(e))}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}having(e,n){return this.expressionMap.havings.push({type:"simple",condition:e}),n&&this.setParameters(n),this}andHaving(e,n){return this.expressionMap.havings.push({type:"and",condition:e}),n&&this.setParameters(n),this}orHaving(e,n){return this.expressionMap.havings.push({type:"or",condition:e}),n&&this.setParameters(n),this}groupBy(e){return e?this.expressionMap.groupBys=[e]:this.expressionMap.groupBys=[],this}addGroupBy(e){return this.expressionMap.groupBys.push(e),this}timeTravelQuery(e){return this.connection.driver.options.type==="cockroachdb"&&(e===void 0?this.expressionMap.timeTravel="follower_read_timestamp()":this.expressionMap.timeTravel=e),this}orderBy(e,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new Y('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new Y('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new Y('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new Y('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){if(this.expressionMap.limit=this.normalizeNumber(e),this.expressionMap.limit!==void 0&&isNaN(this.expressionMap.limit))throw new Y('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(e){if(this.expressionMap.offset=this.normalizeNumber(e),this.expressionMap.offset!==void 0&&isNaN(this.expressionMap.offset))throw new Y('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(e){if(this.expressionMap.take=this.normalizeNumber(e),this.expressionMap.take!==void 0&&isNaN(this.expressionMap.take))throw new Y('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(e){if(this.expressionMap.skip=this.normalizeNumber(e),this.expressionMap.skip!==void 0&&isNaN(this.expressionMap.skip))throw new Y('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(e){return this.expressionMap.useIndex=e,this}setLock(e,n,r){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=n,this.expressionMap.lockTables=r,this}setOnLocked(e){return this.expressionMap.onLocked=e,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if(this.expressionMap.lockMode==="optimistic")throw new Un;this.expressionMap.queryEntity=!1;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0);const r=await this.loadRawResults(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getRawAndEntities(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getOne(){const e=(await this.getRawAndEntities()).entities[0];if(e&&this.expressionMap.lockMode==="optimistic"&&this.expressionMap.lockVersion){const n=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const r=n.updateDateColumn.getEntityValue(e);if(r.getTime()!==this.expressionMap.lockVersion.getTime())throw new wp(n.name,this.expressionMap.lockVersion,r)}else{const r=n.versionColumn.getEntityValue(e);if(r!==this.expressionMap.lockVersion)throw new wp(n.name,this.expressionMap.lockVersion,r)}}return e===void 0?null:e}async getOneOrFail(){const e=await this.getOne();if(!e)throw new d_(this.expressionMap.mainAlias.target,this.expressionMap.parameters);return e}async getMany(){if(this.expressionMap.lockMode==="optimistic")throw new Un;return(await this.getRawAndEntities()).entities}async getCount(){if(this.expressionMap.lockMode==="optimistic")throw new Un;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeCountQuery(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getExists(){if(this.expressionMap.lockMode==="optimistic")throw new Un;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeExistsQuery(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getManyAndCount(){if(this.expressionMap.lockMode==="optimistic")throw new Un;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(e);this.expressionMap.queryEntity=!1;const i=this.expressionMap.cacheId;this.expressionMap.cacheId=i&&`${i}-count`;const o=await this.executeCountQuery(e),s=[r.entities,o];return n&&await e.commitTransaction(),s}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async stream(){this.expressionMap.queryEntity=!1;const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let i=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),i=!0);const o=()=>{if(r!==this.queryRunner)return r.release()},s=r.stream(e,n,o,o);return i&&await r.commitTransaction(),s}catch(o){if(i)try{await r.rollbackTransaction()}catch{}throw o}}cache(e,n){return typeof e=="boolean"?this.expressionMap.cache=e:typeof e=="number"?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):(typeof e=="string"||typeof e=="number")&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),n&&(this.expressionMap.cacheDuration=n),this}setOption(e){return this.expressionMap.options.push(e),this}join(e,n,r,i,o,s,a,c){o&&this.setParameters(o);const l=new Lp(this.connection,this.expressionMap);l.direction=e,l.mapAsEntity=c,l.mapToProperty=s,l.isMappingMany=a,l.entityOrProperty=n,l.condition=i,this.expressionMap.joinAttributes.push(l);const u=l.metadata;if(u){if(u.deleteDateColumn&&!this.expressionMap.withDeleted){const d=`${r}.${u.deleteDateColumn.propertyName} IS NULL`;l.condition=l.condition?` ${l.condition} AND ${d}`:`${d}`}l.alias=this.expressionMap.createAlias({type:"join",name:r,metadata:u}),l.relation&&l.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:l.junctionAlias,metadata:l.relation.junctionEntityMetadata})}else{let d="";if(typeof n=="function"){const p=n(this.subQuery());this.setParameters(p.getParameters()),d=p.getQuery()}else d=n;const h=typeof n=="function"||n.substr(0,1)==="("&&n.substr(-1)===")";l.alias=this.expressionMap.createAlias({type:"join",name:r,tablePath:h===!1?n:void 0,subQuery:h===!0?d:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new Y("Cannot build query because main alias is not set (call qb#from method)");const e=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){const a=this.expressionMap.mainAlias.metadata;e.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,a)),n.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,a))}this.expressionMap.joinAttributes.forEach(a=>{if(a.metadata)e.push(...this.buildEscapedEntityColumnSelects(a.alias.name,a.metadata)),n.push(...this.findEntityColumnSelects(a.alias.name,a.metadata));else if(this.expressionMap.selects.some(c=>c.selection===a.alias.name)){e.push({selection:this.escape(a.alias.name)+".*"});const c=this.expressionMap.selects.find(l=>l.selection===a.alias.name);n.push(c)}}),this.expressionMap.selects.filter(a=>n.indexOf(a)===-1).forEach(a=>e.push({selection:this.replacePropertyNames(a.selection),aliasName:a.aliasName})),e.length===0&&e.push({selection:"*"});let r="";this.expressionMap.useIndex&&Q.isMySQLFamily(this.connection.driver)&&(r=` USE INDEX (${this.expressionMap.useIndex})`);const i=this.expressionMap.aliases.filter(a=>a.type==="from"&&(a.tablePath||a.subQuery)).map(a=>a.subQuery?a.subQuery+" "+this.escape(a.name):this.getTableName(a.tablePath)+" "+this.escape(a.name)),o=this.createSelectDistinctExpression(),s=e.map(a=>a.selection+(a.aliasName?" AS "+this.escape(a.aliasName):"")).join(", ");return o+s+" FROM "+i.join(", ")+this.createTableLockExpression()+r}createSelectDistinctExpression(){const{selectDistinct:e,selectDistinctOn:n,maxExecutionTime:r}=this.expressionMap,{driver:i}=this.connection;let o="SELECT ";return r>0&&Q.isMySQLFamily(i)&&(o+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),Q.isPostgresFamily(i)&&n.length>0?o=`SELECT DISTINCT ON (${n.map(s=>this.replacePropertyNames(s)).join(", ")}) `:e&&(o="SELECT DISTINCT "),o}createJoinExpression(){return this.expressionMap.joinAttributes.map(e=>{const n=e.relation,r=e.tablePath,i=e.alias.name;let o=e.condition?" AND ("+e.condition+")":"";const s=e.parentAlias;if(!s||!n){const a=e.alias.subQuery?e.alias.subQuery:this.getTableName(r);return" "+e.direction+" JOIN "+a+" "+this.escape(i)+this.createTableLockExpression()+(e.condition?" ON "+this.replacePropertyNames(e.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){const a=n.joinColumns.map(c=>i+"."+c.referencedColumn.propertyPath+"="+s+"."+n.propertyPath+"."+c.referencedColumn.propertyPath).join(" AND ");return" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(a+o)}else if(n.isOneToMany||n.isOneToOneNotOwner){const a=n.inverseRelation.joinColumns.map(c=>(n.inverseEntityMetadata.tableType==="entity-child"&&n.inverseEntityMetadata.discriminatorColumn&&(o+=" AND "+i+"."+n.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+n.inverseEntityMetadata.discriminatorValue+"'"),i+"."+n.inverseRelation.propertyPath+"."+c.referencedColumn.propertyPath+"="+s+"."+c.referencedColumn.propertyPath)).join(" AND ");if(!a)throw new Y(`Relation ${n.entityMetadata.name}.${n.propertyName} does not have join columns.`);return" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(a+o)}else{const a=n.junctionEntityMetadata.tablePath,c=e.junctionAlias;let l="",u="";return n.isOwning?(l=n.joinColumns.map(d=>c+"."+d.propertyPath+"="+s+"."+d.referencedColumn.propertyPath).join(" AND "),u=n.inverseJoinColumns.map(d=>i+"."+d.referencedColumn.propertyPath+"="+c+"."+d.propertyPath).join(" AND ")):(l=n.inverseRelation.inverseJoinColumns.map(d=>c+"."+d.propertyPath+"="+s+"."+d.referencedColumn.propertyPath).join(" AND "),u=n.inverseRelation.joinColumns.map(d=>i+"."+d.referencedColumn.propertyPath+"="+c+"."+d.propertyPath).join(" AND "))," "+e.direction+" JOIN "+this.getTableName(a)+" "+this.escape(c)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(l)+" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(u+o)}}).join(" ")}createGroupByExpression(){return!this.expressionMap.groupBys||!this.expressionMap.groupBys.length?"":" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", "))}createOrderByExpression(){const e=this.expressionMap.allOrderBys;return Object.keys(e).length===0?"":" ORDER BY "+Object.keys(e).map(n=>{const r=typeof e[n]=="string"?e[n]:e[n].order+" "+e[n].nulls,i=this.expressionMap.selects.find(o=>o.selection===n);if(i&&!i.aliasName&&n.indexOf(".")!==-1){const o=n.split("."),s=o[0],a=o.slice(1).join("."),c=this.expressionMap.aliases.find(l=>l.name===s);if(c){const l=c.metadata.findColumnWithPropertyPath(a);if(l){const u=Q.buildAlias(this.connection.driver,void 0,s,l.databaseName);return this.escape(u)+" "+r}}}return this.replacePropertyNames(n)+" "+r}).join(", ")}createLimitOffsetExpression(){let e=this.expressionMap.offset,n=this.expressionMap.limit;if(!e&&!n&&this.expressionMap.joinAttributes.length===0&&(e=this.expressionMap.skip,n=this.expressionMap.take),this.connection.driver.options.type==="mssql"){let r="";if((n||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(r=" ORDER BY (SELECT NULL)"),n&&e)return r+" OFFSET "+e+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return r+" OFFSET 0 ROWS FETCH NEXT "+n+" ROWS ONLY";if(e)return r+" OFFSET "+e+" ROWS"}else if(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)throw new g_}else if(Q.isSQLiteFamily(this.connection.driver)){if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver.options.type==="oracle"){if(n&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return" FETCH NEXT "+n+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)return" OFFSET "+e}return""}createTableLockExpression(){if(this.connection.driver.options.type==="mssql")switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const e=this.connection.driver;let n="";if(this.expressionMap.lockTables){if(!(Q.isPostgresFamily(e)||e.options.type==="cockroachdb"))throw new Y("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new Y("lockTables cannot be an empty array");n=" OF "+this.expressionMap.lockTables.join(", ")}let r="";switch(this.expressionMap.onLocked==="nowait"?r=" NOWAIT":this.expressionMap.onLocked==="skip_locked"&&(r=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if(e.options.type==="mysql"||e.options.type==="aurora-mysql")return Q.isReleaseVersionOrGreater(e,"8.0.0")?" FOR SHARE"+n+r:" LOCK IN SHARE MODE";if(e.options.type==="mariadb")return" LOCK IN SHARE MODE";if(Q.isPostgresFamily(e))return" FOR SHARE"+n+r;if(e.options.type==="oracle")return" FOR UPDATE";if(e.options.type==="mssql")return"";throw new sn;case"pessimistic_write":if(Q.isMySQLFamily(e)||e.options.type==="aurora-mysql"||e.options.type==="oracle")return" FOR UPDATE"+r;if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+n+r;if(e.options.type==="mssql")return"";throw new sn;case"pessimistic_partial_write":if(Q.isPostgresFamily(e))return" FOR UPDATE"+n+" SKIP LOCKED";if(Q.isMySQLFamily(e))return" FOR UPDATE SKIP LOCKED";throw new sn;case"pessimistic_write_or_fail":if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+n+" NOWAIT";if(Q.isMySQLFamily(e))return" FOR UPDATE NOWAIT";throw new sn;case"for_no_key_update":if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR NO KEY UPDATE"+n+r;throw new sn;case"for_key_share":if(Q.isPostgresFamily(e))return" FOR KEY SHARE"+n+r;throw new sn;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const e=this.expressionMap.havings.map((n,r)=>{switch(n.type){case"and":return(r>0?"AND ":"")+this.replacePropertyNames(n.condition);case"or":return(r>0?"OR ":"")+this.replacePropertyNames(n.condition);default:return this.replacePropertyNames(n.condition)}}).join(" ");return e.length?" HAVING "+e:""}buildEscapedEntityColumnSelects(e,n){const r=this.expressionMap.selects.some(l=>l.selection===e),i=[];if(r&&i.push(...n.columns.filter(l=>l.isSelect===!0)),i.push(...n.columns.filter(l=>this.expressionMap.selects.some(u=>u.selection===e+"."+l.propertyPath))),i.length===0)return[];const o=this.expressionMap.queryEntity?n.primaryColumns.filter(l=>i.indexOf(l)===-1):[],s=[...i,...o],a=[],c=this.escape(e);return s.forEach(l=>{let u=c+"."+this.escape(l.databaseName);l.isVirtualProperty&&l.query&&(u=`(${l.query(c)})`),this.connection.driver.spatialTypes.indexOf(l.type)!==-1&&((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(u=`${this.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText"}(${u})`),Q.isPostgresFamily(this.connection.driver)&&(l.precision?u=`ST_AsGeoJSON(${u}, ${l.precision})::json`:u=`ST_AsGeoJSON(${u})::json`),this.connection.driver.options.type==="mssql"&&(u=`${u}.ToString()`));const d=this.expressionMap.selects.filter(h=>h.selection===e+"."+l.propertyPath);if(d.length)d.forEach(h=>{a.push({selection:u,aliasName:h.aliasName?h.aliasName:Q.buildAlias(this.connection.driver,void 0,e,l.databaseName),virtual:h.virtual})});else{if(l.isVirtualProperty)return;a.push({selection:u,aliasName:Q.buildAlias(this.connection.driver,void 0,e,l.databaseName),virtual:r})}}),a}findEntityColumnSelects(e,n){const r=this.expressionMap.selects.find(i=>i.selection===e);return r?[r]:this.expressionMap.selects.filter(i=>n.columns.some(o=>i.selection===e+"."+o.propertyPath))}computeCountExpression(){const e=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata.primaryColumns,r=this.escape(e);if(this.expressionMap.joinAttributes.length===0&&this.expressionMap.relationIdAttributes.length===0&&this.expressionMap.relationCountAttributes.length===0)return"COUNT(1)";if(this.connection.driver.options.type==="cockroachdb"||Q.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(", ")+"))";if(Q.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(", ")+")";if(this.connection.driver.options.type==="mssql"){const i=n.map(o=>`${r}.${this.escape(o.databaseName)}`).join(", '|;|', ");return n.length===1?`COUNT(DISTINCT(${i}))`:`COUNT(DISTINCT(CONCAT(${i})))`}return this.connection.driver.options.type==="spanner"?n.length===1?`COUNT(DISTINCT(${r}.${this.escape(n[0].databaseName)}))`:`COUNT(DISTINCT(CONCAT(${n.map(i=>`CAST(${r}.${this.escape(i.databaseName)} AS STRING)`).join(", '|;|', ")})))`:"COUNT(DISTINCT("+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(" || '|;|' || ")+"))"}async executeCountQuery(e){const n=this.computeCountExpression(),r=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(n,"cnt").setOption("disable-global-order").loadRawResults(e);return!r||!r[0]||!r[0].cnt?0:parseInt(r[0].cnt)}async executeExistsQuery(e){return(await this.connection.createQueryBuilder().fromDummy().select("1","row_exists").whereExists(this).limit(1).loadRawResults(e)).length>0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const e=Array.isArray(this.findOptions.select)?je.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(e,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const e=Array.isArray(this.findOptions.relations)?je.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.findOptions.loadEagerRelations!==!1&&this.expressionMap.relationLoadStrategy==="join"&&this.buildEagerRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere(this.conditions.substr(0,1)!=="("?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach(e=>{e.select&&!e.selection?e.type==="inner"?this.innerJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):e.type==="inner"?this.innerJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias)}),this.findOptions.skip!==void 0&&this.skip(this.findOptions.skip),this.findOptions.take!==void 0&&this.take(this.findOptions.take),typeof this.findOptions.cache=="number"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="boolean"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="object"&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach(e=>{this.leftJoin(this.findOptions.join.leftJoin[e],e)}),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach(e=>{this.innerJoin(this.findOptions.join.innerJoin[e],e)}),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach(e=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[e],e)}),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach(e=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[e],e)})),this.findOptions.lock){if(this.findOptions.lock.mode==="optimistic")this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if(this.findOptions.lock.mode==="pessimistic_read"||this.findOptions.lock.mode==="pessimistic_write"||this.findOptions.lock.mode==="dirty_read"||this.findOptions.lock.mode==="pessimistic_partial_write"||this.findOptions.lock.mode==="pessimistic_write_or_fail"||this.findOptions.lock.mode==="for_no_key_update"||this.findOptions.lock.mode==="for_key_share"){const e=this.findOptions.lock.tables?this.findOptions.lock.tables.map(n=>{const r=this.expressionMap.aliases.find(i=>i.metadata.tableNameWithoutPrefix===n);if(!r)throw new Y(`"${n}" is not part of this query`);return this.escape(r.name)}):void 0;this.setLock(this.findOptions.lock.mode,void 0,e),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}}this.findOptions.loadRelationIds===!0?this.loadAllRelationIds():typeof this.findOptions.loadRelationIds=="object"&&this.loadAllRelationIds(this.findOptions.loadRelationIds),this.findOptions.loadEagerRelations!==!1&&gs.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),this.findOptions.transaction===!0&&(this.expressionMap.useTransaction=!0)}}concatRelationMetadata(e){this.relationMetadatas.push(e)}async executeEntitiesAndRawResults(e){if(!this.expressionMap.mainAlias)throw new Y('Alias is not set. Use "from" method to set an alias.');if((this.expressionMap.lockMode==="pessimistic_read"||this.expressionMap.lockMode==="pessimistic_write"||this.expressionMap.lockMode==="pessimistic_partial_write"||this.expressionMap.lockMode==="pessimistic_write_or_fail"||this.expressionMap.lockMode==="for_no_key_update"||this.expressionMap.lockMode==="for_key_share")&&!e.isTransactionActive)throw new y_;if(this.expressionMap.lockMode==="optimistic"){const s=this.expressionMap.mainAlias.metadata;if(!s.versionColumn&&!s.updateDateColumn)throw new p_(s.name)}const n=new AS(this.connection,e,this.expressionMap.relationIdAttributes),r=new kS(this.connection,e,this.expressionMap.relationCountAttributes);new PS(this.expressionMap).transform(),new TS(this.expressionMap).transform();let i=[],o=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[s,a]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),c=this.expressionMap.mainAlias.metadata,l=this.expressionMap.mainAlias.name,u=c.primaryColumns.map(p=>{const m=this.escape("distinctAlias"),f=this.escape(Q.buildAlias(this.connection.driver,void 0,l,p.databaseName));a[f]||(a[f]="ASC");const y=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,p.databaseName);return`${m}.${f} AS ${this.escape(y)}`}),d=this.clone(),h=d.expressionMap.timeTravel;if(i=await new xs(this.connection,e).select(`DISTINCT ${u.join(", ")}`).addSelect(s).from(`(${d.orderBy().timeTravelQuery(!1).getQuery()})`,"distinctAlias").timeTravelQuery(h).offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(a).cache(this.expressionMap.cache&&this.expressionMap.cacheId?`${this.expressionMap.cacheId}-pagination`:this.expressionMap.cache,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),i.length>0){let p="";const m={};if(c.hasMultiplePrimaryKeys)p=i.map((f,y)=>c.primaryColumns.map(g=>{const b=`orm_distinct_ids_${y}_${g.databaseName}`,x=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,g.databaseName);return m[b]=f[x],`${l}.${g.propertyPath}=:${b}`}).join(" AND ")).join(" OR ");else{const f=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,c.primaryColumns[0].databaseName),y=i.map(g=>g[f]);y.every(g=>typeof g=="number")?p=`${l}.${c.primaryColumns[0].propertyPath} IN (${y.join(", ")})`:(m.orm_distinct_ids=y,p=l+"."+c.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}i=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:p}).setParameters(m).loadRawResults(e)}}else i=await this.loadRawResults(e);if(i.length>0){const s=await n.load(i),a=await r.load(i);o=new OS(this.expressionMap,this.connection.driver,s,a,this.queryRunner).transform(i,this.expressionMap.mainAlias),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,o)}if(this.expressionMap.relationLoadStrategy==="query"){const s=new NS(this.connection,e);await Promise.all(this.relationMetadatas.map(async a=>{const c=a.inverseEntityMetadata.target,l=a.inverseEntityMetadata.targetName,u=Array.isArray(this.findOptions.select)?je.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,d=Array.isArray(this.findOptions.relations)?je.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,h=this.createQueryBuilder(e).select(l).from(c,l).setFindOptions({select:u?je.deepValue(u,a.propertyPath):void 0,order:this.findOptions.order?je.deepValue(this.findOptions.order,a.propertyPath):void 0,relations:d?je.deepValue(d,a.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(o.length>0){const p=await s.loadManyToManyRelationIdsAndGroup(a,o,void 0,h);o.forEach(m=>{const f=p.find(y=>y.entity===m);if(f){const y=f.related===void 0?null:f.related;a.setEntityValue(m,y)}})}}))}return{raw:i,entities:o}}createOrderByCombinedWithSelectExpression(e){const n=this.expressionMap.allOrderBys,r=Object.keys(n).map(o=>{if(o.indexOf(".")!==-1){const s=o.split("."),a=s[0],c=s.slice(1).join("."),l=this.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyPath(c);return this.escape(e)+"."+this.escape(Q.buildAlias(this.connection.driver,void 0,a,l.databaseName))}else return this.expressionMap.selects.find(s=>s.selection===o||s.aliasName===o)?this.escape(e)+"."+this.escape(o):""}).join(", "),i={};return Object.keys(n).forEach(o=>{if(o.indexOf(".")!==-1){const s=o.split("."),a=s[0],c=s.slice(1).join("."),l=this.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyPath(c);i[this.escape(e)+"."+this.escape(Q.buildAlias(this.connection.driver,void 0,a,l.databaseName))]=n[o]}else this.expressionMap.selects.find(s=>s.selection===o||s.aliasName===o)?i[this.escape(e)+"."+this.escape(o)]=n[o]:i[o]=n[o]}),[r,i]}async loadRawResults(e){const[n,r]=this.getQueryAndParameters(),i=n+" -- PARAMETERS: "+JSON.stringify(r,(u,d)=>typeof d=="bigint"?d.toString():d),o=typeof this.connection.options.cache=="object"?this.connection.options.cache:{};let s;const a=o.alwaysEnabled&&this.expressionMap.cache!==!1||this.expressionMap.cache===!0;let c=!1;if(this.connection.queryResultCache&&a)try{if(s=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:i,duration:this.expressionMap.cacheDuration||o.duration||1e3},e),s&&!this.connection.queryResultCache.isExpired(s))return JSON.parse(s.result)}catch(u){if(!o.ignoreErrors)throw u;c=!0}const l=await e.query(n,r,!0);if(!c&&this.connection.queryResultCache&&a)try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:i,time:new Date().getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(l.records)},s,e)}catch(u){if(!o.ignoreErrors)throw u}return l.records}mergeExpressionMap(e){return Se.assign(this.expressionMap,e),this}normalizeNumber(e){return typeof e=="number"||e===void 0||e===null?e:Number(e)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner(this.connection.defaultReplicationModeForReads())}buildSelect(e,n,r,i){for(let o in e){if(e[o]===void 0||e[o]===!1)continue;const s=i?i+"."+o:o,a=n.findColumnWithPropertyPathStrict(s),c=n.findEmbeddedWithPropertyPath(s),l=n.findRelationWithPropertyPath(s);if(!c&&!a&&!l)throw new Ge(s,n);a?this.selects.push(r+"."+s):c&&this.buildSelect(e[o],n,r,s)}}buildRelations(e,n,r,i,o){e&&Object.keys(e).forEach(s=>{const a=e[s],c=o?o+"."+s:s,l=r.findEmbeddedWithPropertyPath(c),u=r.findRelationWithPropertyPath(c);if(!l&&!u)throw new Ge(c,r);if(l)this.buildRelations(a,typeof n=="object"?je.deepValue(n,l.propertyPath):void 0,r,i,c);else if(u){let d=i+"_"+c.replace(".","_");d=Q.buildAlias(this.connection.driver,{joiner:"__"},i,d),(a===!0||typeof a=="object")&&(this.expressionMap.relationLoadStrategy==="query"?this.concatRelationMetadata(u):(this.joins.push({type:"left",select:!0,selection:n&&typeof n[s]=="object"?n[s]:void 0,alias:d,parentAlias:i,relationMetadata:u}),n&&typeof n[s]=="object"&&this.buildSelect(n[s],u.inverseEntityMetadata,d))),typeof a=="object"&&this.expressionMap.relationLoadStrategy==="join"&&this.buildRelations(a,typeof n=="object"?je.deepValue(n,u.propertyPath):void 0,u.inverseEntityMetadata,d,void 0)}})}buildEagerRelations(e,n,r,i,o){e&&Object.keys(e).forEach(s=>{const a=e[s],c=o?o+"."+s:s,l=r.findEmbeddedWithPropertyPath(c),u=r.findRelationWithPropertyPath(c);if(!l&&!u)throw new Ge(c,r);if(l)this.buildEagerRelations(a,typeof n=="object"?je.deepValue(n,l.propertyPath):void 0,r,i,c);else if(u){let d=i+"_"+c.replace(".","_");d=Q.buildAlias(this.connection.driver,{joiner:"__"},i,d),(a===!0||typeof a=="object")&&u.inverseEntityMetadata.eagerRelations.forEach(h=>{let p=d+"_"+h.propertyPath.replace(".","_");p=Q.buildAlias(this.connection.driver,{joiner:"__"},d,p),this.joins.find(m=>m.alias===p)||this.joins.push({type:"left",select:!0,alias:p,parentAlias:d,selection:void 0,relationMetadata:h}),n&&typeof n[s]=="object"&&this.buildSelect(n[s],u.inverseEntityMetadata,d)}),typeof a=="object"&&this.buildEagerRelations(a,typeof n=="object"?je.deepValue(n,u.propertyPath):void 0,u.inverseEntityMetadata,d,void 0)}})}buildOrder(e,n,r,i){for(let o in e){if(e[o]===void 0)continue;const s=i?i+"."+o:o,a=n.findColumnWithPropertyPathStrict(s),c=n.findEmbeddedWithPropertyPath(s),l=n.findRelationWithPropertyPath(s);if(!c&&!a&&!l)throw new Ge(s,n);if(a){let u=typeof e[o]=="object"?e[o].direction:e[o];u=u==="DESC"||u==="desc"||u===-1?"DESC":"ASC";let d=typeof e[o]=="object"?e[o].nulls:void 0;d=(d==null?void 0:d.toLowerCase())==="first"?"NULLS FIRST":(d==null?void 0:d.toLowerCase())==="last"?"NULLS LAST":void 0;let h=`${r}.${s}`;this.addOrderBy(h,u,d)}else if(c)this.buildOrder(e[o],n,r,s);else if(l){let u=r+"_"+s.replace(".","_");u=Q.buildAlias(this.connection.driver,{joiner:"__"},r,u),this.joins.find(d=>d.alias===u)||this.joins.push({type:"left",select:!1,alias:u,parentAlias:r,selection:void 0,relationMetadata:l}),this.buildOrder(e[o],l.inverseEntityMetadata,u)}}}buildWhere(e,n,r,i){let o="";if(Array.isArray(e))e.length&&(o=e.map(s=>this.buildWhere(s,n,r,i)).filter(s=>!!s).map(s=>"("+s+")").join(" OR "));else{let s=[];for(let a in e){if(e[a]===void 0||e[a]===null)continue;const c=i?i+"."+a:a,l=n.findColumnWithPropertyPathStrict(c),u=n.findEmbeddedWithPropertyPath(c),d=n.findRelationWithPropertyPath(c);if(!u&&!l&&!d)throw new Ge(c,n);if(l){let h=`${r}.${c}`;l.isVirtualProperty&&l.query&&(h=`(${l.query(r)})`);let p=e[a];me.isEqualOperator(e[a])&&(p=e[a].value),l.transformer&&(p instanceof Gn?p.transformValue(l.transformer):p=ms.transformTo(l.transformer,p)),s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(h,p)))}else if(u){const h=this.buildWhere(e[a],n,r,c);h&&s.push(h)}else if(d){if(typeof e[a]=="object"&&Object.keys(e[a]).every(h=>e[a][h]===void 0))continue;if(me.isFindOperator(e[a]))if(e[a].type==="moreThan"||e[a].type==="lessThan"||e[a].type==="moreThanOrEqual"||e[a].type==="lessThanOrEqual"){let h="";e[a].type==="moreThan"?h=">":e[a].type==="lessThan"?h="<":e[a].type==="moreThanOrEqual"?h=">=":e[a].type==="lessThanOrEqual"&&(h="<=");const p=this.subQuery();if(d.isManyToManyOwner)p.select("COUNT(*)").from(d.joinTableName,d.joinTableName).where(d.joinColumns.map(m=>`${d.joinTableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else if(d.isManyToManyNotOwner)p.select("COUNT(*)").from(d.inverseRelation.joinTableName,d.inverseRelation.joinTableName).where(d.inverseRelation.inverseJoinColumns.map(m=>`${d.inverseRelation.joinTableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else if(d.isOneToMany)p.select("COUNT(*)").from(d.inverseEntityMetadata.target,d.inverseEntityMetadata.tableName).where(d.inverseRelation.joinColumns.map(m=>`${d.inverseEntityMetadata.tableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else throw new Error("This relation isn't supported by given find operator");this.andWhere(p.getSql()+" "+h+" "+parseInt(e[a].value))}else if(d.isManyToOne||d.isOneToOne&&d.isOneToOneOwner){const h=`${r}.${c}`;s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(h,e[a])))}else throw new Error("This relation isn't supported by given find operator");else{let h=r+"_"+d.propertyPath.replace(".","_");h=Q.buildAlias(this.connection.driver,{joiner:"__"},r,h),this.joins.find(m=>m.alias===h)||this.joins.push({type:"left",select:!1,selection:void 0,alias:h,parentAlias:r,relationMetadata:d});const p=this.buildWhere(e[a],d.inverseEntityMetadata,h);p&&s.push(p)}}}o=s.length?"("+s.join(") AND (")+")":s.join(" AND ")}return o.length?"("+o+")":o}}class Wp{constructor(){this.generatedMaps=[]}static from(e){const n=new this;return n.raw=e.records,n.affected=e.affected,n}}class jS extends we{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createUpdateExpression();return e+=this.createCteExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const r=new ys(e,this.expressionMap);this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=r.getSoftDeletionReturningColumns());const[i,o]=this.getQueryAndParameters(),s=await e.query(i,o,!0),a=Wp.from(s);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await r.update(a,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),n&&await e.commitTransaction(),a}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}from(e,n){e=me.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new li;return this.expressionMap.returning=e,this}orderBy(e,n="ASC",r){return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new Y(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(e)?e:[e];return n.forEach(r=>{const i=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!i)throw new Y("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(i)}),this.expressionMap.whereEntities=n,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new Y(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!e.deleteDateColumn)throw new h_(e);const n=[];switch(this.expressionMap.queryType){case"soft-delete":n.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":n.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new Y('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&n.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&n.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),n.length<=0)throw new ls;const r=this.createWhereExpression(),i=this.createReturningExpression("update");return i===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")} OUTPUT ${i}${r}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r} RETURNING ${i}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(n=>typeof e[n]=="string"?this.replacePropertyNames(n)+" "+e[n]:this.replacePropertyNames(n)+" "+e[n].order+" "+e[n].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(Q.isMySQLFamily(this.connection.driver))return" LIMIT "+e;throw new Mp}return""}}class RS extends we{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let r=null,i=null;const o=new ys(e,this.expressionMap),s=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const h of this.expressionMap.returning)s.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(h));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=o.getUpdationReturningColumns(),s.push(...this.expressionMap.extraReturningColumns.filter(h=>!s.includes(h)))),s.length>0&&this.connection.driver.options.type==="mssql"&&(r=this.connection.driver.buildTableVariableDeclaration("@OutputTable",s),i="SELECT * FROM @OutputTable");const[a,c]=this.getQueryAndParameters(),l=[r,a,i],u=await e.query(l.filter(h=>h!=null).join(`;

`),c,!0),d=Wp.from(u);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await o.update(d,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),n&&await e.commitTransaction(),d}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}set(e){return this.expressionMap.valuesSet=e,this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new li;return this.expressionMap.returning=e,this}orderBy(e,n="ASC",r){return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new Y(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(e)?e:[e];return n.forEach(r=>{const i=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!i)throw new Y("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(i)}),this.expressionMap.whereEntities=n,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r={};for(let c in e)e[c]!==void 0&&(r[c]=e[c]);const i=[],o=[];if(n?(this.createPropertyPath(n,r).forEach(c=>{const l=n.findColumnsWithPropertyPath(c);if(l.length<=0)throw new Ge(c,n);l.forEach(u=>{if(!u.isUpdate||o.includes(u))return;o.push(u);let d=u.getEntityValue(r);if(u.referencedColumn&&typeof d=="object"&&!(d instanceof Date)&&d!==null&&!Ef.isBuffer(d)?d=u.referencedColumn.getEntityValue(d):typeof d!="function"&&(d=this.connection.driver.preparePersistentValue(d,u)),typeof d=="function")i.push(this.escape(u.databaseName)+" = "+d());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&d===null)i.push(this.escape(u.databaseName)+" = NULL");else{this.connection.driver.options.type==="mssql"&&(d=this.connection.driver.parametrizeValue(u,d));const h=this.createParameter(d);let p=null;if((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1){const m=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";u.srid!=null?p=`${m}(${h}, ${u.srid})`:p=`${m}(${h})`}else Q.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1?u.srid!=null?p=`ST_SetSRID(ST_GeomFromGeoJSON(${h}), ${u.srid})::${u.type}`:p=`ST_GeomFromGeoJSON(${h})::${u.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1?p=u.type+"::STGeomFromText("+h+", "+(u.srid||"0")+")":p=h;i.push(this.escape(u.databaseName)+" = "+p)}})}),(i.length>0||Object.keys(r).length===0)&&(n.versionColumn&&o.indexOf(n.versionColumn)===-1&&i.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&o.indexOf(n.updateDateColumn)===-1&&i.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(r).map(c=>{let l=r[c];if(typeof l=="function")i.push(this.escape(c)+" = "+l());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&l===null)i.push(this.escape(c)+" = NULL");else{const u=this.createParameter(l);i.push(this.escape(c)+" = "+u)}}),i.length<=0)throw new ls;const s=this.createWhereExpression(),a=this.createReturningExpression("update");return a===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")}${s}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")} OUTPUT ${a}${s}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")}${s} RETURNING ${a}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(n=>typeof e[n]=="string"?this.replacePropertyNames(n)+" "+e[n]:this.replacePropertyNames(n)+" "+e[n].order+" "+e[n].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")return" LIMIT "+e;throw new Mp}return""}getValueSet(){if(typeof this.expressionMap.valuesSet=="object")return this.expressionMap.valuesSet;throw new ls}}function IS(){we.registerQueryBuilderClass("DeleteQueryBuilder",t=>new xS(t)),we.registerQueryBuilderClass("InsertQueryBuilder",t=>new CS(t)),we.registerQueryBuilderClass("RelationQueryBuilder",t=>new SS(t)),we.registerQueryBuilderClass("SelectQueryBuilder",t=>new xs(t)),we.registerQueryBuilderClass("SoftDeleteQueryBuilder",t=>new jS(t)),we.registerQueryBuilderClass("UpdateQueryBuilder",t=>new RS(t))}var Hp;(function(t){t.VIEW="VIEW",t.MATERIALIZED_VIEW="MATERIALIZED_VIEW",t.GENERATED_COLUMN="GENERATED_COLUMN"})(Hp||(Hp={}));var Up={exports:{}},vs,Qp;function $S(){if(Qp)return vs;Qp=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,o=r*365.25;vs=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return s(u);if(h==="number"&&isFinite(u))return d.long?c(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function s(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),p=(d[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*o;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*n;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=n?Math.round(u/n)+"h":d>=e?Math.round(u/e)+"m":d>=t?Math.round(u/t)+"s":u+"ms"}function c(u){var d=Math.abs(u);return d>=r?l(u,d,r,"day"):d>=n?l(u,d,n,"hour"):d>=e?l(u,d,e,"minute"):d>=t?l(u,d,t,"second"):u+" ms"}function l(u,d,h,p){var m=d>=h*1.5;return Math.round(u/h)+" "+p+(m?"s":"")}return vs}function BS(t){n.debug=n,n.default=n,n.coerce=c,n.disable=o,n.enable=i,n.enabled=s,n.humanize=$S(),n.destroy=l,Object.keys(t).forEach(u=>{n[u]=t[u]}),n.names=[],n.skips=[],n.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return n.colors[Math.abs(d)%n.colors.length]}n.selectColor=e;function n(u){let d,h=null,p,m;function f(...y){if(!f.enabled)return;const g=f,b=Number(new Date),x=b-(d||b);g.diff=x,g.prev=d,g.curr=b,d=b,y[0]=n.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let v=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(C,T)=>{if(C==="%%")return"%";v++;const S=n.formatters[T];if(typeof S=="function"){const j=y[v];C=S.call(g,j),y.splice(v,1),v--}return C}),n.formatArgs.call(g,y),(g.log||n.log).apply(g,y)}return f.namespace=u,f.useColors=n.useColors(),f.color=n.selectColor(u),f.extend=r,f.destroy=n.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==n.namespaces&&(p=n.namespaces,m=n.enabled(u)),m),set:y=>{h=y}}),typeof n.init=="function"&&n.init(f),f}function r(u,d){const h=n(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){n.save(u),n.namespaces=u,n.names=[],n.skips=[];let d;const h=(typeof u=="string"?u:"").split(/[\s,]+/),p=h.length;for(d=0;d<p;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?n.skips.push(new RegExp("^"+u.slice(1)+"$")):n.names.push(new RegExp("^"+u+"$")))}function o(){const u=[...n.names.map(a),...n.skips.map(a).map(d=>"-"+d)].join(",");return n.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=n.skips.length;d<h;d++)if(n.skips[d].test(u))return!1;for(d=0,h=n.names.length;d<h;d++)if(n.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var LS=BS;(function(t,e){var n={};e.formatArgs=i,e.save=o,e.load=s,e.useColors=r,e.storage=a(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let d=0,h=0;l[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(d++,p==="%c"&&(h=d))}),l.splice(h,0,u)}e.log=console.debug||console.log||(()=>{});function o(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof Cf<"u"&&"env"in Cf&&(l=n.DEBUG),l}function a(){try{return localStorage}catch{}}t.exports=LS(e);const{formatters:c}=t.exports;c.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Up,Up.exports),IS();let bs,Zp,ws,fi,mi,yi,Kn,Yp,Xp,Gp,Kp,Jp,ef,tf,nf,rf,of,sf,af,cf,lf,uf;bs=(t,e)=>({id:t.id,type:t.node_type,position:{x:t.x||0,y:t.y||0},width:t.width||void 0,height:t.height||void 0,data:{loading:!1,flowNode:t,...e}}),Zp=t=>({id:t.id,target:t.target,source:t.target,targetHandle:t.targetHandle,sourceHandle:t.sourceHandle}),ws=t=>({id:t.id,source:t.source,target:t.target,targetHandle:t.targetHandle,sourceHandle:t.sourceHandle}),Wf=t=>t.filter(e=>"edgeId"in e?`${e.edgeId}`.startsWith("xy-edge__"):!1),fi=(t,e,n)=>{const r=[];return{changes:t.map(i=>{var c;const o=e.find(l=>i.id===l.id);o||r.push(i.id);const s=(c=n==null?void 0:n[i.source_type])==null?void 0:c.find(l=>(l==null?void 0:l.id)===i.source_id),a=bs(i,{...o==null?void 0:o.data,entity:s});return{type:o?"replace":"add",id:i.id,item:o?lr({...o||{},data:void 0},dr(a,hr)):a}}),newIds:[]}},mi=(t,e)=>{const n=[],r=[],i=t.map(o=>{const s=e.find(a=>o.source===a.source&&o.target===a.target);return!s||s.id!==o.id?(s&&r.push(s.id),{type:"add",item:ws(o)}):(n.push(o.id),{type:"replace",item:ws(o)})});return e.forEach(o=>{n.includes(o.id)||r.push(o.id)}),{changes:i,updatedIds:n,deletedIds:r}},yi={width:440,height:360},Kn={width:380,height:650},wn={[ke.Toolbox]:"toolbox",[ke.SessionInfo]:"session-info",[ke.DefaultEmbeddingModel]:"default-embedding-model",[ke.ApplicationBar]:"application-bar"},Yp={id:wn[ke.Toolbox],type:ke.Toolbox,position:{x:10+Kn.width+20,y:10},measured:yi,data:{}},Xp={id:wn[ke.SessionInfo],type:ke.SessionInfo,position:{x:10,y:10},measured:Kn,data:{}},Gp={id:wn[ke.DefaultEmbeddingModel],type:ke.DefaultEmbeddingModel,position:{x:10+Kn.width+yi.width+40,y:10},data:{model:n3}},Kp={id:wn[ke.ApplicationBar],type:ke.ApplicationBar,position:{x:10+Kn.width+yi.width+40,y:80},data:{}},Jp=[Yp,Xp,Gp,Kp],If=[ke.Toolbox,ke.SessionInfo,ke.ApplicationBar,ke.EditorApp,ke.CodeContainerApp],sa={flowNodes:[],flowEdges:[],ready:!0,flowEdgeLoading:!1,flowNodeLoading:!1,syncedNodes:[],syncedEdges:[],syncNodeQueue:[],syncEdgeQueue:[],edges:[],nodes:Jp},Ks=async t=>{const e=await Ae("FlowNode").find(t),n=e.reduce((i,o)=>{var s;return i[o.source_type]||(i[o.source_type]=[]),(s=i[o.source_type])==null||s.push(o),i},{}),r={};return await Promise.all(Object.entries(n).map(async([i,o])=>{const s=i;r[s]=await Ae(s).find({where:{id:bi(o.map(a=>a.source_id))}})})),{flowNodes:e,entityGroups:n,flowNodeDatas:r}},zf=(t,e)=>({reset:()=>{t(sa)},setNodes:n=>{if(typeof n=="function"){t({nodes:n(e().nodes)});return}t({nodes:n})},setEdges:n=>{if(typeof n=="function"){t({edges:n(e().edges)});return}t({edges:n})},updateNodes:n=>{const r=e().nodes;t({nodes:bt(n,r)})},updateEdges:n=>{const r=e().edges;t({edges:Fn(n,r)})},addConnectionToEdges:n=>{const r=e().edges;t({edges:Ac(n,r)})},flowNodesToNodes:(n,r={})=>{const i=e().nodes,{changes:o}=fi(n,i,r);t({nodes:bt(o,i)})},flowEdgesToEdges:n=>{const r=e().edges,{changes:i,updatedIds:o,deletedIds:s}=mi(n,r);r.forEach(a=>{o.includes(a.id)||s.push(a.id)}),s.forEach(a=>{i.push({type:"remove",id:a})}),t({edges:Fn(i,r)})},getNodes:n=>e().nodes.filter(r=>n.includes(r.id)),removeSyncNodeQueue:n=>{const{syncNodeQueue:r}=e();for(const i of n){const o=r.findIndex(s=>s.timestamp===i);o>-1&&r.splice(o,1)}t({syncNodeQueue:r})},removeSyncEdgeQueue:n=>{const{syncEdgeQueue:r}=e();for(const i of n){const o=r.findIndex(s=>s.timestamp===i);o>-1&&r.splice(o,1)}t({syncEdgeQueue:r})},pushSyncNodeQueue:(n,r)=>{const{syncNodeQueue:i}=e();t({syncNodeQueue:[...i,{query:r,timestamp:Date.now(),syncType:n}]})},pushSyncEdgeQueue:()=>{const{syncEdgeQueue:n}=e();t({syncEdgeQueue:[...n,{timestamp:Date.now()}]})},findFlowNodesWithSource:async(n,r)=>{try{t({flowNodeLoading:!0});const{flowNodes:i,flowNodeDatas:o}=await Ks(n);if(r!=null&&r.clean)t({flowNodes:i,nodes:i.map(s=>{var c;const a=(c=o==null?void 0:o[s.source_type])==null?void 0:c.find(l=>l.id===s.source_id);return bs(s,{data:a})})});else{const s=e().flowNodes,a=i.map(u=>u.id),c=e().nodes,{changes:l}=fi(i,c,o);t({flowNodes:[...s.filter(u=>!a.includes(u.id)),...i],nodes:bt(l,c)})}return i}finally{t({flowNodeLoading:!1})}},findFlowEdges:async(n,r)=>{try{t({flowEdgeLoading:!0});const i=await Ae("FlowEdge").find(n),o=e().flowEdges,s=i.map(a=>a.id);if(r!=null&&r.clean)t({flowEdges:i,edges:i.map(a=>Zp(a))});else{const a=e().edges,{changes:c}=mi(i,a);t({flowEdges:[...o.filter(l=>!s.includes(l.id)),...i],edges:Fn(c,a)})}return i}finally{t({flowEdgeLoading:!1})}},deleteFlowNode:async n=>{try{if(!n.id&&!n.source_type&&!n.source_id)throw new Error("Missing flow node indentify");const r=await Ae("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}});if(r){await Ae("FlowNode").delete(r.id);const i=e().flowNodes;r.source_type&&r.source_id&&await Ae(r.source_type).delete(r.source_id).catch(s=>{xt("Failed to delete source entity",r.source_type,r.source_id,s)});const o=e().nodes;t({flowNodes:i.filter(s=>s.id!==r.id),nodes:bt([{type:"remove",id:r.id}],o)})}}catch(r){xt("Failed to delete flow node",r)}},deleteFlowEdge:async n=>{try{if(!n.id&&!n.source&&!n.target)throw new Error("Missing flow edge indentify");const r=await Ae("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}});if(r){await Ae("FlowEdge").delete(r.id);const i=e().flowEdges;t({flowEdges:i.filter(o=>o.id!==r.id)})}}catch(r){xt("Failed to delete flow edge",r)}},updateFlowNode:async(n,r)=>{var i;try{if(!((i=Ps.getState().currentSession)!=null&&i.id))throw new Error("Session not found");if(!n.id)throw new Error("Missing flow node indentify");await Ae("FlowNode").update(n.id,n);const o=e().flowNodes.map(s=>s.id===n.id?{...s,...n}:s);t({flowNodes:r!=null&&r.silent?o:[...o]})}catch(o){xt("Failed to create or update flow node",o,n)}},createOrUpdateFlowNode:async(n,r)=>{var i;try{const o=Ps.getState().currentSession;if(!(o!=null&&o.id))throw new Error("Session not found");if(!n.id&&(!n.source_type||!n.source_id))throw new Error("Missing flow node indentify");let s,a=n!=null&&n.id?e().flowNodes.find(p=>p.id===n.id):void 0;if(!a&&(n.id||n.source_type&&n.source_id)&&(a=await Ae("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}})),a)s=lr(a,dr(n,hr)),r!=null&&r.lazy?Ae("FlowNode").update(a.id,s):await Ae("FlowNode").update(a.id,s);else if(n.source_id&&n.source_type)s={...n,source_id:`${n.source_id}`,source_type:`${n.source_type}`,node_type:n.node_type||"NEW_MESSAGE",session_id:n.session_id||(o==null?void 0:o.id)},r!=null&&r.lazy?(s.id=_f(),Ae("FlowNode").save(s)):s=await Ae("FlowNode").save(s);else throw new Error("Missing source id and type");let c;const l=e().nodes.find(p=>p.id===s.id);s.source_type&&!l?c=await Ae(s.source_type).findOne({where:{id:n.source_id}}):s.source_type&&l&&(c=(i=l==null?void 0:l.data)==null?void 0:i.entity);const u=e().flowNodes,d=e().nodes,{changes:h}=fi([s],d,{[s.source_type]:[c]});return t({flowNodes:[...u.filter(p=>p.id!==s.id),s],nodes:bt(h,d)}),s}catch(o){xt("Failed to create or update flow node",o,n)}},createOrUpdateFlowEdge:async(n,r)=>{try{const i=Ps.getState().currentSession;if(!(i!=null&&i.id))throw new Error("Session not found");if(!n.id&&(!n.source||!n.target))throw new Error("Missing flow node indentify");let o,s=n!=null&&n.id?e().flowEdges.find(l=>l.id===n.id):void 0;if(s&&(n.id||n.source&&n.target)&&(s=await Ae("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}})),s)o=lr(s,dr(n,hr)),r!=null&&r.lazy?Ae("FlowEdge").update(s.id,o):await Ae("FlowEdge").update(s.id,o);else if(n.source&&n.target)o={...n,source:`${n.source}`,target:`${n.target}`,session_id:n.session_id||(i==null?void 0:i.id)},r!=null&&r.lazy?(o.id=_f(),Ae("FlowEdge").save(o)):o=await Ae("FlowEdge").save(o);else throw new Error("Missing source and target");const a=e().flowEdges,c=e().edges;return t({flowEdges:[...a.filter(l=>l.id!==o.id),o],edges:Fn(mi([o],c).changes,c)}),o}catch(i){xt("Failed to create or update flow node",i)}}}),ef=t=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"none",height:192,viewBox:"0 0 150 150",width:192,...t},M.createElement("clipPath",{id:"a"},M.createElement("path",{d:"m0 0h150v150h-150z"})),M.createElement("g",{clipPath:"url(#a)"},M.createElement("path",{d:"m150 0h-150v150h150z",fill:"#29b5e8"}),M.createElement("path",{clipRule:"evenodd",d:"m130.375 67.2532-14.096 8.1221 14.096 8.0536c.843.4872 1.581 1.1357 2.174 1.9084.592.7727 1.026 1.6545 1.278 2.5951.251.9406.315 1.9215.188 2.8867-.128.9652-.444 1.8959-.931 2.7388-.488.843-1.136 1.5817-1.909 2.174s-1.654 1.0267-2.595 1.2782-1.921.3154-2.887.1878c-.965-.1275-1.896-.444-2.739-.9312l-25.2559-14.5496c-1.1575-.6696-2.1128-1.6394-2.765-2.8068-.6523-1.1674-.9773-2.4893-.9408-3.826.0198-.5792.1089-1.1538.2653-1.7117.517-1.8711 1.7458-3.4654 3.4234-4.4419l25.256-14.4983c.847-.4892 1.782-.8067 2.751-.9343.97-.1275 1.955-.0627 2.899.1909.945.2536 1.83.6909 2.605 1.287.775.596 1.425 1.3391 1.913 2.1866.49.8402.808 1.7693.935 2.7334.128.964.063 1.9439-.191 2.8826-.254.9388-.692 1.8177-1.288 2.5859-.597.7681-1.34 1.4101-2.186 1.8887zm-13.343 39.3698-25.2478-14.5243c-1.1296-.6483-2.4091-.9896-3.7115-.9902s-2.5823.3397-3.7124.987c-1.1301.6472-2.0712 1.579-2.7297 2.7026-.6585 1.1237-1.0115 2.4001-1.0239 3.7024v29.0135c.0654 1.928.8772 3.755 2.264 5.095 1.3869 1.341 3.2403 2.09 5.1691 2.09 1.9289 0 3.7823-.749 5.1691-2.09 1.3868-1.34 2.1986-3.167 2.264-5.095v-16.261l14.1301 8.122c.843.488 1.774.805 2.739.933.966.128 1.947.064 2.888-.187s1.823-.685 2.596-1.277c.774-.592 1.423-1.331 1.91-2.174.488-.843.805-1.773.933-2.739.128-.965.065-1.946-.186-2.887s-.685-1.824-1.277-2.597-1.331-1.422-2.174-1.91zm-29.0992-28.3806-10.527 10.3986c-.3601.3349-.8269.5319-1.318.5563h-3.0897c-.49-.0294-.9551-.2257-1.318-.5563l-10.4671-10.4329c-.3274-.3573-.521-.817-.5478-1.3009v-3.081c.0283-.4861.2215-.9481.5478-1.3095l10.4671-10.4329c.3637-.3281.829-.5214 1.318-.5477h3.0897c.4899.0228.9562.2166 1.318.5477l10.4928 10.4329c.3237.3623.514.8243.5392 1.3095v3.081c-.0237.483-.2143.9428-.5392 1.3009zm-8.3874-2.8928c-.0404-.499-.2485-.9696-.5905-1.3352l-3.0383-3.004c-.3641-.3275-.8291-.5207-1.318-.5478h-.1113c-.4867.0255-.9495.2191-1.3094.5478l-3.0383 3.004c-.3262.3676-.5165.8358-.5392 1.3266v.1113c.0215.4834.2124.9439.5392 1.3009l3.0554 2.9955c.3607.3274.823.5208 1.3094.5477h.1113c.4889-.027.9539-.2203 1.318-.5477l3.0383-3.0212c.3282-.3576.5244-.8166.5563-1.3009zm-47.4914-31.2217 25.2563 14.4811c1.1308.648 2.4115.989 3.7149.9889 1.3033 0 2.584-.3409 3.7148-.989 1.1309-.648 2.0725-1.5806 2.7314-2.7051.659-1.1245 1.0123-2.4018 1.0249-3.7051v-28.9879c-.0654-1.9277-.8772-3.7546-2.264-5.0952s-3.2402-2.0899-5.1691-2.0899c-1.9288 0-3.7822.7493-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v16.2613l-14.1473-8.1307c-.8429-.4877-1.7737-.8047-2.7392-.9328-.9654-.1281-1.9466-.0647-2.8876.1864s-1.8232.6852-2.5965 1.2773c-.7732.5921-1.4222 1.3307-1.91 2.1736-.4878.843-.8048 1.7738-.9329 2.7392-.128.9655-.0647 1.9467.1864 2.8876.2512.941.6852 1.8233 1.2773 2.5965.5921.7733 1.3307 1.4223 2.1737 1.9101zm55.4252 15.4739c1.4914.118 2.9836-.2193 4.2793-.9671l25.2475-14.5496c.843-.4877 1.582-1.1368 2.174-1.91s1.026-1.6555 1.277-2.5965.315-1.9222.187-2.8876c-.128-.9655-.445-1.8962-.933-2.7392-.488-.8429-1.137-1.5816-1.91-2.1737-.774-.5921-1.656-1.0261-2.597-1.2772-1.9-.5072-3.924-.2387-5.627.7464l-14.1298 8.1991v-16.2613c-.0654-1.9277-.8772-3.7546-2.264-5.0952-1.3868-1.3405-3.2402-2.0899-5.1691-2.0899-1.9288 0-3.7822.7494-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v29.0136c-.0023 1.8784.7086 3.6876 1.9892 5.0619 1.2805 1.3743 3.0351 2.2111 4.909 2.3412zm-25.8554 31.5298c-1.4916-.1213-2.9847.2162-4.2793.9671l-25.2905 14.4893c-1.7024.985-2.9438 2.607-3.451 4.507s-.2387 3.924.7465 5.627c.9851 1.702 2.6061 2.943 4.5065 3.451 1.9004.507 3.9244.238 5.6268-.747l14.1473-8.122v16.261c.0654 1.928.8772 3.755 2.2641 5.096 1.3868 1.34 3.2402 2.09 5.169 2.09 1.9289 0 3.7823-.75 5.1691-2.09 1.3868-1.341 2.1986-3.168 2.264-5.096v-29.0645c-.0038-1.869-.7144-3.6673-1.9891-5.0341s-3.0192-2.2009-4.8834-2.3348zm-6.8468-13.5825c.4875-1.6032.414-3.3247-.2083-4.8806-.6224-1.5559-1.7564-2.8532-3.2152-3.6779l-25.2306-14.541c-1.704-.976-3.7248-1.2385-5.6216-.7303-1.8968.5083-3.5155 1.7461-4.5032 3.4433-.4889.84-.8065 1.7686-.9343 2.732-.1278.9635-.0632 1.9428.1899 2.8811.2531.9384.6897 1.8173 1.2846 2.5858.595.7686 1.3364 1.4115 2.1814 1.8917l14.096 8.1221-14.096 8.0536c-.8429.4861-1.5819 1.1334-2.1746 1.9051-.5928.7717-1.0277 1.6526-1.2801 2.5923-.2523.9398-.317 1.9201-.1905 2.8849s.4418 1.8952.9279 2.7382c.4861.8429 1.1335 1.5819 1.9051 2.1746.7717.5928 1.6526 1.0277 2.5924 1.2801.9397.2523 1.92.317 2.8848.1905s1.8952-.4418 2.7382-.9279l25.2306-14.5496c1.6248-.9071 2.8451-2.3965 3.4149-4.168z",fill:"#fff",fillRule:"evenodd"}))),tf=t=>M.createElement("svg",{className:"mr-2 w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:48,height:48,...t},M.createElement("path",{fill:"#fbc02d",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20 s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),M.createElement("path",{fill:"#e53935",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039 l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),M.createElement("path",{fill:"#4caf50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36 c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),M.createElement("path",{fill:"#1565c0",d:"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571 c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})),nf=t=>M.createElement("svg",{className:"mr-2 w-5 h-5",width:1024,height:1024,viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},M.createElement("path",{d:"M44.522 44.5217H489.739V489.739H44.522V44.5217Z",fill:"#F35325"}),M.createElement("path",{d:"M534.261 44.5217H979.478V489.739H534.261V44.5217Z",fill:"#81BC06"}),M.createElement("path",{d:"M44.522 534.261H489.739V979.478H44.522V534.261Z",fill:"#05A6F0"}),M.createElement("path",{d:"M534.261 534.261H979.478V979.478H534.261V534.261Z",fill:"#FFBA08"})),rf=t=>M.createElement("svg",{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 287.56 191",...t},M.createElement("defs",null,M.createElement("style",null,".cls-1{fill:#0081fb;}.cls-2{fill:url(#linear-gradient);}.cls-3{fill:url(#linear-gradient-2);}"),M.createElement("linearGradient",{id:"linear-gradient",x1:62.34,y1:101.45,x2:260.34,y2:91.45,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},M.createElement("stop",{offset:0,stopColor:"#0064e1"}),M.createElement("stop",{offset:.4,stopColor:"#0064e1"}),M.createElement("stop",{offset:.83,stopColor:"#0073ee"}),M.createElement("stop",{offset:1,stopColor:"#0082fb"})),M.createElement("linearGradient",{id:"linear-gradient-2",x1:41.42,y1:53,x2:41.42,y2:126,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},M.createElement("stop",{offset:0,stopColor:"#0082fb"}),M.createElement("stop",{offset:1,stopColor:"#0064e0"}))),M.createElement("title",null,"facebook-meta"),M.createElement("path",{className:"cls-1",d:"M31.06,126c0,11,2.41,19.41,5.56,24.51A19,19,0,0,0,53.19,160c8.1,0,15.51-2,29.79-21.76,11.44-15.83,24.92-38,34-52l15.36-23.6c10.67-16.39,23-34.61,37.18-47C181.07,5.6,193.54,0,206.09,0c21.07,0,41.14,12.21,56.5,35.11,16.81,25.08,25,56.67,25,89.27,0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191V160c17.63,0,22-16.2,22-34.74,0-26.42-6.16-55.74-19.73-76.69-9.63-14.86-22.11-23.94-35.84-23.94-14.85,0-26.8,11.2-40.23,31.17-7.14,10.61-14.47,23.54-22.7,38.13l-9.06,16c-18.2,32.27-22.81,39.62-31.91,51.75C84.74,183,71.12,191,53.19,191c-21.27,0-34.72-9.21-43-23.09C3.34,156.6,0,141.76,0,124.85Z"}),M.createElement("path",{className:"cls-2",d:"M24.49,37.3C38.73,15.35,59.28,0,82.85,0c13.65,0,27.22,4,41.39,15.61,15.5,12.65,32,33.48,52.63,67.81l7.39,12.32c17.84,29.72,28,45,33.93,52.22,7.64,9.26,13,12,19.94,12,17.63,0,22-16.2,22-34.74l27.4-.86c0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191c-12.8,0-24.14-2.78-36.68-14.61-9.64-9.08-20.91-25.21-29.58-39.71L146.08,93.6c-12.94-21.62-24.81-37.74-31.68-45C107,40.71,97.51,31.23,82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78Z"}),M.createElement("path",{className:"cls-3",d:"M82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78C38.61,71.62,31.06,99.34,31.06,126c0,11,2.41,19.41,5.56,24.51L10.14,167.91C3.34,156.6,0,141.76,0,124.85,0,94.1,8.44,62.05,24.49,37.3,38.73,15.35,59.28,0,82.85,0Z"})),of=t=>M.createElement("svg",{className:"mr-2 w-5 h-5",width:256,height:233,viewBox:"0 0 256 233",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},M.createElement("path",{d:"M186.182 0h46.545v46.545h-46.545z"}),M.createElement("path",{fill:"#f7d046",d:"M209.455 0H256v46.545h-46.545z"}),M.createElement("path",{d:"M0 0h46.545v46.545H0zm0 46.545h46.545V93.09H0zm0 46.546h46.545v46.545H0zm0 46.545h46.545v46.545H0zm0 46.546h46.545v46.545H0z"}),M.createElement("path",{fill:"#f7d046",d:"M23.273 0h46.545v46.545H23.273z"}),M.createElement("path",{fill:"#f2a73b",d:"M209.455 46.545H256V93.09h-46.545zm-186.182 0h46.545V93.09H23.273z"}),M.createElement("path",{d:"M139.636 46.545h46.545V93.09h-46.545z"}),M.createElement("path",{fill:"#f2a73b",d:"M162.909 46.545h46.545V93.09h-46.545zm-93.091 0h46.545V93.09H69.818z"}),M.createElement("path",{fill:"#ee792f",d:"M116.364 93.091h46.545v46.545h-46.545zm46.545 0h46.545v46.545h-46.545zm-93.091 0h46.545v46.545H69.818z"}),M.createElement("path",{d:"M93.091 139.636h46.545v46.545H93.091z"}),M.createElement("path",{fill:"#eb5829",d:"M116.364 139.636h46.545v46.545h-46.545z"}),M.createElement("path",{fill:"#ee792f",d:"M209.455 93.091H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"}),M.createElement("path",{d:"M186.182 139.636h46.545v46.545h-46.545z"}),M.createElement("path",{fill:"#eb5829",d:"M209.455 139.636H256v46.545h-46.545z"}),M.createElement("path",{d:"M186.182 186.182h46.545v46.545h-46.545z"}),M.createElement("path",{fill:"#eb5829",d:"M23.273 139.636h46.545v46.545H23.273z"}),M.createElement("path",{fill:"#ea3326",d:"M209.455 186.182H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"})),sf="/NoLLMChat/assets/qwen-B-gSh3_v.webp",af="/NoLLMChat/assets/smollm-CikBjd4F.png",cf="/NoLLMChat/assets/stablelm-BquePdQ7.png",lf="/NoLLMChat/assets/nomic-BjJqoFji.webp",uf="/NoLLMChat/assets/joshua-ByaReJuI.webp",Ff=M.memo(({name:t,className:e,...n})=>(t=t.toLowerCase(),t.includes("gemma")?E.jsx(tf,{className:Ne("w-5 h-5",e),...n}):t!=null&&t.includes("qwen")?E.jsx("img",{className:Ne("w-5 h-5",e),src:sf,alt:"qwen",...n}):t!=null&&t.includes("phi")?E.jsx(nf,{className:Ne("w-5 h-5",e),...n}):t!=null&&t.includes("llama")?E.jsx(rf,{className:Ne("w-5 h-5",e),...n}):t!=null&&t.includes("smollm")?E.jsx("img",{className:Ne("w-5 h-5",e),src:af,alt:"smollm",...n}):t!=null&&t.includes("mistral")?E.jsx(of,{className:Ne("w-5 h-5",e),...n}):t!=null&&t.includes("snowflake")?E.jsx(ef,{className:Ne("w-5 h-5 rounded-full",e),...n}):t!=null&&t.includes("stablelm")?E.jsx("img",{className:Ne("w-5 h-5 rounded-full",e),src:cf,alt:"stablelm",...n}):t!=null&&t.includes("nomic")?E.jsx("img",{className:Ne("w-5 h-5 rounded-full",e),src:lf,alt:"nomic",...n}):t!=null&&t.includes("Xenova")||t!=null&&t.includes("janus")?E.jsx("img",{className:Ne("w-5 h-5 rounded-full",e),src:uf,alt:"Xenova",...n}):E.jsx(vi,{className:Ne("w-5 h-5",e),name:"brain"}))),Fs=["Qwen2.5-1.5B-Instruct-q4f32_1-MLC","Qwen2.5-Coder-1.5B-Instruct-q4f16_1-MLC","stablelm-2-zephyr-1_6b-q4f16_1-MLC-1k","Phi-3.5-mini-instruct-q4f16_1-MLC-1k","Llama-3.2-3B-Instruct-q4f32_1-MLC"],Vf=M.memo(t=>{var a;const{name:e,model:n,isCached:r,isFunctionCalling:i}=t,{t:o}=r3("atoms"),s=M.useCallback(c=>c===1?"llm_info.model_types.embedding":c===2?"llm_info.model_types.vlm":"llm_info.model_types.llm",[]);if(n)return E.jsxs(E.Fragment,{children:[E.jsx($t,{className:"",children:o(s(n.model_type))}),Fs.some(c=>e&&c.includes(e))?E.jsx($t,{className:"",variant:"outline",children:o("llm_info.recommended")}):null,r?E.jsx($t,{className:"",variant:"outline",children:o("llm_info.cached")}):null,i?E.jsx($t,{className:"",variant:"outline",children:o("llm_info.function_calling")}):null,n!=null&&n.low_resource_required?E.jsx($t,{className:"",variant:"outline",children:o("llm_info.low_resource_required")}):null,(a=n==null?void 0:n.overrides)!=null&&a.context_window_size?E.jsxs($t,{className:"",variant:"outline",children:[n.overrides.context_window_size.toLocaleString("en-US")," Tokens"]}):null,n!=null&&n.vram_required_MB?E.jsxs($t,{className:"",variant:"outline",children:["VRAM: ",n.vram_required_MB.toLocaleString("en-US")," MB"]}):null]})}),Ci=M.forwardRef(({className:t,...e},n)=>E.jsx("textarea",{className:Ne("flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...e})),Ci.displayName="Textarea";let df;df=i3("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),js=M.forwardRef(({className:t,variant:e,...n},r)=>E.jsx("div",{ref:r,role:"alert",className:Ne(df({variant:e}),t),...n})),js.displayName="Alert",la=M.forwardRef(({className:t,...e},n)=>E.jsx("h5",{ref:n,className:Ne("mb-1 font-medium leading-none tracking-tight",t),...e})),la.displayName="AlertTitle",ua=M.forwardRef(({className:t,...e},n)=>E.jsx("div",{ref:n,className:Ne("text-sm [&_p]:leading-relaxed",t),...e})),ua.displayName="AlertDescription";function DS({minHeight:t,maxHeight:e}){const n=M.useRef(null),r=M.useCallback(i=>{const o=n.current;if(!o)return;if(i){o.style.height=`${t}px`;return}o.style.height=`${t}px`;const s=Math.max(t,Math.min(o.scrollHeight,e??Number.POSITIVE_INFINITY));o.style.height=`${s}px`},[t,e]);return M.useEffect(()=>{const i=n.current;i&&(i.style.height=`${t}px`)},[t]),M.useEffect(()=>{const i=()=>r();return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[r]),{textareaRef:n,adjustHeight:r}}const zS=48,hf=164;Hf=function({onSubmit:t,disabled:e,enableTool:n,enableFile:r,placeholder:i,minHeight:o,maxHeight:s,className:a,onChange:c,value:l}){const[u,d]=M.useState(!1),[h,p]=M.useState(""),{textareaRef:m,adjustHeight:f}=DS({minHeight:o||zS,maxHeight:s||hf}),[y,g]=M.useState(!0),b=async x=>{try{d(!0),await t(h,x)}finally{d(!1)}};return E.jsx("div",{className:Ne("w-full py-4 max-w-xl",a),children:E.jsx("div",{className:"relative w-full mx-auto",children:E.jsxs("div",{className:"relative flex flex-col",children:[E.jsx("div",{className:"overflow-y-auto",style:{maxHeight:`${s||hf}px`},children:E.jsx(Ci,{id:"ai-input-04",value:(c?l:h)||"",disabled:e||u,placeholder:i,className:"w-full rounded-xl rounded-b-none px-4 py-3 bg-black/5 dark:bg-white/5 border-none dark:text-white placeholder:text-black/70 dark:placeholder:text-white/70 resize-none focus-visible:ring-0 leading-[1.2]",ref:m,onKeyDown:x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),b(x))},onChange:x=>{c||p(x.target.value),f(),c==null||c(x)}})}),E.jsxs("div",{className:"h-12 bg-black/5 dark:bg-white/5 rounded-b-xl",children:[E.jsxs("div",{className:"absolute left-3 bottom-3 flex items-center gap-2",children:[r?E.jsxs("label",{className:"cursor-pointer rounded-lg p-2 bg-black/5 dark:bg-white/5",children:[E.jsx("input",{type:"file",className:"hidden"}),E.jsx(vi,{name:"paperclip",className:"w-4 h-4 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors"})]}):void 0,n?E.jsxs("button",{type:"button",onClick:()=>{g(!y)},className:Ne("rounded-full transition-all flex items-center gap-2 px-1.5 py-1 border h-8",y?"bg-sky-500/15 border-sky-400 text-sky-500":"bg-black/5 dark:bg-white/5 border-transparent text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:[E.jsx("div",{className:"w-4 h-4 flex items-center justify-center flex-shrink-0",children:E.jsx(Sf.div,{animate:{rotate:y?180:0,scale:y?1.1:1},whileHover:{rotate:y?180:15,scale:1.1,transition:{type:"spring",stiffness:300,damping:10}},transition:{type:"spring",stiffness:260,damping:25},children:E.jsx(vi,{name:"globe",className:Ne("w-4 h-4",y?"text-sky-500":"text-inherit")})})}),E.jsx(Jf,{children:y&&E.jsx(Sf.span,{initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"text-sm overflow-hidden whitespace-nowrap text-sky-500 flex-shrink-0",children:"Search"})})]}):void 0]}),E.jsx("div",{className:"absolute right-3 bottom-3",children:E.jsx("button",{type:"button",disabled:e||u,onClick:x=>{b(x)},className:Ne("rounded-lg p-2",c&&l||h?"bg-sky-500/15 text-sky-500":"bg-black/5 dark:bg-white/5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:E.jsx(vi,{name:"send",className:"w-4 h-4"})})})]})]})})})};var FS=Object.prototype.toString,ln=Array.isArray||function(t){return FS.call(t)==="[object Array]"};function Ms(t){return typeof t=="function"}function VS(t){return ln(t)?"array":typeof t}function Es(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function pf(t,e){return t!=null&&typeof t=="object"&&e in t}function qS(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var WS=RegExp.prototype.test;function HS(t,e){return WS.call(t,e)}var US=/\S/;function QS(t){return!HS(US,t)}var ZS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function YS(t){return String(t).replace(/[&<>"'`=\/]/g,function(e){return ZS[e]})}var XS=/\s*/,GS=/\s+/,ff=/\s*=/,KS=/\s*\}/,JS=/#|\^|\/|>|\{|&|=|!/;function eO(t,e){if(!t)return[];var n=!1,r=[],i=[],o=[],s=!1,a=!1,c="",l=0;function u(){if(s&&!a)for(;o.length;)delete i[o.pop()];else o=[];s=!1,a=!1}var d,h,p;function m(j){if(typeof j=="string"&&(j=j.split(GS,2)),!ln(j)||j.length!==2)throw new Error("Invalid tags: "+j);d=new RegExp(Es(j[0])+"\\s*"),h=new RegExp("\\s*"+Es(j[1])),p=new RegExp("\\s*"+Es("}"+j[1]))}m(e||Fe.tags);for(var f=new Jn(t),y,g,b,x,v,C;!f.eos();){if(y=f.pos,b=f.scanUntil(d),b)for(var T=0,S=b.length;T<S;++T)x=b.charAt(T),QS(x)?(o.push(i.length),c+=x):(a=!0,n=!0,c+=" "),i.push(["text",x,y,y+1]),y+=1,x===`
`&&(u(),c="",l=0,n=!1);if(!f.scan(d))break;if(s=!0,g=f.scan(JS)||"name",f.scan(XS),g==="="?(b=f.scanUntil(ff),f.scan(ff),f.scanUntil(h)):g==="{"?(b=f.scanUntil(p),f.scan(KS),f.scanUntil(h),g="&"):b=f.scanUntil(h),!f.scan(h))throw new Error("Unclosed tag at "+f.pos);if(g==">"?v=[g,b,y,f.pos,c,l,n]:v=[g,b,y,f.pos],l++,i.push(v),g==="#"||g==="^")r.push(v);else if(g==="/"){if(C=r.pop(),!C)throw new Error('Unopened section "'+b+'" at '+y);if(C[1]!==b)throw new Error('Unclosed section "'+C[1]+'" at '+y)}else g==="name"||g==="{"||g==="&"?a=!0:g==="="&&m(b)}if(u(),C=r.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+f.pos);return nO(tO(i))}function tO(t){for(var e=[],n,r,i=0,o=t.length;i<o;++i)n=t[i],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(e.push(n),r=n));return e}function nO(t){for(var e=[],n=e,r=[],i,o,s=0,a=t.length;s<a;++s)switch(i=t[s],i[0]){case"#":case"^":n.push(i),r.push(i),n=i[4]=[];break;case"/":o=r.pop(),o[5]=i[2],n=r.length>0?r[r.length-1][4]:e;break;default:n.push(i)}return e}function Jn(t){this.string=t,this.tail=t,this.pos=0}Jn.prototype.eos=function(){return this.tail===""},Jn.prototype.scan=function(t){var e=this.tail.match(t);if(!e||e.index!==0)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},Jn.prototype.scanUntil=function(t){var e=this.tail.search(t),n;switch(e){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,e),this.tail=this.tail.substring(e)}return this.pos+=n.length,n};function un(t,e){this.view=t,this.cache={".":this.view},this.parent=e}un.prototype.push=function(t){return new un(t,this)},un.prototype.lookup=function(t){var e=this.cache,n;if(e.hasOwnProperty(t))n=e[t];else{for(var r=this,i,o,s,a=!1;r;){if(t.indexOf(".")>0)for(i=r.view,o=t.split("."),s=0;i!=null&&s<o.length;)s===o.length-1&&(a=pf(i,o[s])||qS(i,o[s])),i=i[o[s++]];else i=r.view[t],a=pf(r.view,t);if(a){n=i;break}r=r.parent}e[t]=n}return Ms(n)&&(n=n.call(this.view)),n};function Re(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}Re.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()},Re.prototype.parse=function(t,e){var n=this.templateCache,r=t+":"+(e||Fe.tags).join(":"),i=typeof n<"u",o=i?n.get(r):void 0;return o==null&&(o=eO(t,e),i&&n.set(r,o)),o},Re.prototype.render=function(t,e,n,r){var i=this.getConfigTags(r),o=this.parse(t,i),s=e instanceof un?e:new un(e,void 0);return this.renderTokens(o,s,n,t,r)},Re.prototype.renderTokens=function(t,e,n,r,i){for(var o="",s,a,c,l=0,u=t.length;l<u;++l)c=void 0,s=t[l],a=s[0],a==="#"?c=this.renderSection(s,e,n,r,i):a==="^"?c=this.renderInverted(s,e,n,r,i):a===">"?c=this.renderPartial(s,e,n,i):a==="&"?c=this.unescapedValue(s,e):a==="name"?c=this.escapedValue(s,e,i):a==="text"&&(c=this.rawValue(s)),c!==void 0&&(o+=c);return o},Re.prototype.renderSection=function(t,e,n,r,i){var o=this,s="",a=e.lookup(t[1]);function c(d){return o.render(d,e,n,i)}if(a){if(ln(a))for(var l=0,u=a.length;l<u;++l)s+=this.renderTokens(t[4],e.push(a[l]),n,r,i);else if(typeof a=="object"||typeof a=="string"||typeof a=="number")s+=this.renderTokens(t[4],e.push(a),n,r,i);else if(Ms(a)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");a=a.call(e.view,r.slice(t[3],t[5]),c),a!=null&&(s+=a)}else s+=this.renderTokens(t[4],e,n,r,i);return s}},Re.prototype.renderInverted=function(t,e,n,r,i){var o=e.lookup(t[1]);if(!o||ln(o)&&o.length===0)return this.renderTokens(t[4],e,n,r,i)},Re.prototype.indentPartial=function(t,e,n){for(var r=e.replace(/[^ \t]/g,""),i=t.split(`
`),o=0;o<i.length;o++)i[o].length&&(o>0||!n)&&(i[o]=r+i[o]);return i.join(`
`)},Re.prototype.renderPartial=function(t,e,n,r){if(n){var i=this.getConfigTags(r),o=Ms(n)?n(t[1]):n[t[1]];if(o!=null){var s=t[6],a=t[5],c=t[4],l=o;a==0&&c&&(l=this.indentPartial(o,c,s));var u=this.parse(l,i);return this.renderTokens(u,e,n,l,r)}}},Re.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(n!=null)return n},Re.prototype.escapedValue=function(t,e,n){var r=this.getConfigEscape(n)||Fe.escape,i=e.lookup(t[1]);if(i!=null)return typeof i=="number"&&r===Fe.escape?String(i):r(i)},Re.prototype.rawValue=function(t){return t[1]},Re.prototype.getConfigTags=function(t){return ln(t)?t:t&&typeof t=="object"?t.tags:void 0},Re.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!ln(t))return t.escape};let dn;Fe={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){dn.templateCache=t},get templateCache(){return dn.templateCache}},dn=new Re,Fe.clearCache=function(){return dn.clearCache()},Fe.parse=function(t,e){return dn.parse(t,e)},Fe.render=function(t,e,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+VS(t)+'" was given as the first argument for mustache#render(template, view, partials)');return dn.render(t,e,n,r)},Fe.escape=YS,Fe.Scanner=Jn,Fe.Context=un,Fe.Writer=Re;let mf,Ee,ct,le,ve;mf=async(t,e)=>{let n="",r="",i;const o=[];await t;for await(const s of t)s&&(Array.isArray(s)?(o.push(...s.map(a=>a.content)),o!=null&&o.length&&(r=o.join(""),e==null||e({chunk:s,content:r}))):(n=typeof s=="object"&&"content"in s?`${s.content}`:`${s}`,e==null||e({chunk:s,content:n})),i=s);return{lastChunk:i,content:n}},Uf=()=>{const t=ks(r=>r.toolsCallingStream),e=ks(r=>r.structuredStream),n=ks(r=>r.stream);return{stream:M.useCallback(async(r,{tools:i,schemas:o,onMessageUpdate:s,onMessageFinish:a})=>{var d,h,p,m;o&&(o==null?void 0:o.length)>1&&xt("Multiple schemas are not supported");let c;if(o!=null&&o.length){const f=(p=(h=(d=o==null?void 0:o[0])==null?void 0:d.node)==null?void 0:h.data)==null?void 0:p.entity;if(!((m=f==null?void 0:f.schema_items)!=null&&m.length))throw new Error("Schema is not found");c=e(f.schema_items,r)}else i!=null&&i.length?c=t(i.reduce((f,y)=>{var x,v,C,T,S;const g=(x=y.node.data)==null?void 0:x.entity,b=(T=(C=(v=y==null?void 0:y.connectedNodes)==null?void 0:v.find(j=>j.type===ke.Schema))==null?void 0:C.data)==null?void 0:T.entity;return g&&((S=b==null?void 0:b.schema_items)!=null&&S.length)&&f.push({name:g.name,description:g.description,schemaItems:b.schema_items}),f},[]),r):c=n(r);if(!c)throw new Error("Stream is not supported");const{lastChunk:l,content:u}=await mf(c,s);return a==null||a({content:u,lastChunk:l}),{lastChunk:l,content:u}},[n,e,t])}},Ee={},ct=typeof globalThis>"u"?window:globalThis,le={status:"created"},ve={},Ee.debug=t=>{lt=typeof t=="function"?t:()=>{}};let lt=()=>{};Ee.detect=()=>yf();const yf=()=>{const t={};["speechSynthesis","speechSynthesisUtterance","speechSynthesisVoice","speechSynthesisEvent","speechSynthesisErrorEvent"].forEach(n=>{t[n]=lO(n)}),t.onvoiceschanged=gi(t.speechSynthesis,"onvoiceschanged");const e=gi(t.speechSynthesisUtterance,"prototype");return _s.forEach(n=>{const r=`on${n}`;t[r]=e&&gi(t.speechSynthesisUtterance.prototype,r)}),ve.isAndroid=rO(),ve.isFirefox=oO()||iO(),ve.isSafari=sO(),lt(`is android: ${!!ve.isAndroid}`),lt(`is firefox: ${!!ve.isFirefox}`),lt(`is safari: ${!!ve.isSafari}`),t},gi=(t={},e)=>Object.hasOwnProperty.call(t,e)||e in t||!!t[e],Cs=()=>(ct.navigator||{}).userAgent||"",rO=()=>/android/i.test(Cs()),iO=()=>/kaios/i.test(Cs()),oO=()=>typeof ct.InstallTrigger<"u"?!0:/firefox/i.test(Cs()),sO=()=>typeof ct.GestureEvent<"u",aO=["webKit","moz","ms","o"],cO=t=>`${t.charAt(0).toUpperCase()}${t.slice(1)}`,lO=t=>{const e=cO(t),n=aO.map(i=>`${i}${e}`),r=[t,e].concat(n).find(uO);return ct[r]},uO=t=>ct[t];Ee.status=()=>({...le}),Ee.filterVoices=({name:t,language:e,localService:n,voiceURI:r})=>{const i=le.voices||[],o=typeof t<"u",s=typeof r<"u",a=typeof n<"u",c=typeof e<"u",l=c&&e.split(/[-_]+/g)[0].toLocaleLowerCase();return i.filter(u=>{if(o&&u.name.includes(t)||s&&u.voiceURI.includes(r)||a&&u.localService===n)return!0;if(c){const d=u.lang&&u.lang.toLocaleLowerCase();return d&&(d===l||d.indexOf(`${l}-`)>-1||d.indexOf(`${l}_`)>-1)}return!1})};const Be=t=>{lt(t),le.status=t};Ee.init=function({maxTimeout:t=5e3,interval:e=250,quiet:n,maxLengthExceeded:r}={}){return new Promise((i,o)=>{if(le.initialized)return i(!1);Ee.reset(),Be("init: start");let s,a,c=!1;le.maxLengthExceeded=r||"warn";const l=f=>(Be(`init: failed (${f})`),clearInterval(s),le.initialized=!1,n?i(!1):o(new Error(`EasySpeech: ${f}`))),u=()=>{if(!c)return Be("init: complete"),c=!0,le.initialized=!0,clearInterval(s),h.onvoiceschanged=null,a&&h.removeEventListener("voiceschanged",a),i(!0)},d=yf();if(!(d.speechSynthesis&&d.speechSynthesisUtterance))return l("browser misses features");Object.keys(d).forEach(f=>{le[f]=d[f]});const{speechSynthesis:h}=le,p=()=>{const f=h.getVoices()||[];if(f.length>0){if(le.voices=f,Be(`voices loaded: ${f.length}`),le.defaultVoice=f.find(y=>y.default),!le.defaultVoice){const y=(ct.navigator||{}).language||"",g=Ee.filterVoices({language:y});g.length>0&&(le.defaultVoice=g[0])}return le.defaultVoice||(le.defaultVoice=f[0]),!0}return!1};if(Be("init: voices"),p())return u();const m=()=>{Be("init: voices (timer)");let f=0;s=setInterval(()=>{if(p())return u();if(f>t)return l("browser has no voices (timeout)");f+=e},e)};d.onvoiceschanged?(Be("init: voices (onvoiceschanged)"),h.onvoiceschanged=()=>p()?u():m(),setTimeout(()=>p()?u():l("browser has no voices (timeout)"),t)):(gi(h,"addEventListener")&&(Be("init: voices (addEventListener)"),a=()=>{if(p())return u()},h.addEventListener("voiceschanged",a)),m())})};const kt=({force:t}={})=>{if(!t&&!le.initialized)throw new Error("EasySpeech: not initialized. Run EasySpeech.init() first")};Ee.voices=()=>(kt(),le.voices),Ee.on=t=>(kt(),_s.forEach(e=>{const n=t[e];yt.handler(n)&&(le.handlers[e]=n)}),{...le.handlers});const _s=["boundary","end","error","mark","pause","resume","start"],yt={isNumber:t=>typeof t=="number"&&!Number.isNaN(t),pitch:t=>yt.isNumber(t)&&t>=0&&t<=2,volume:t=>yt.isNumber(t)&&t>=0&&t<=1,rate:t=>yt.isNumber(t)&&t>=.1&&t<=10,text:t=>typeof t=="string",handler:t=>typeof t=="function",voice:t=>t&&t.lang&&t.name&&t.voiceURI};Ee.defaults=t=>(kt(),t&&(le.defaults=le.defaults||{},["voice","pitch","rate","volume"].forEach(e=>{const n=t[e],r=yt[e];r(n)&&(le.defaults[e]=n)})),{...le.defaults});const dO=t=>{var e,n;return t||((e=le.defaults)==null?void 0:e.voice)||le.defaultVoice||((n=le.voices)==null?void 0:n[0])},hO=t=>{const e=le.speechSynthesisUtterance;return new e(t)};Ee.speak=({text:t,voice:e,pitch:n,rate:r,volume:i,force:o,infiniteResume:s,noStop:a,...c})=>{if(kt({force:o}),!yt.text(t))throw new Error("EasySpeech: at least some valid text is required to speak");if(new TextEncoder().encode(t).length>4096){const u="EasySpeech: text exceeds max length of 4096 bytes, which will not work with some voices.";switch(le.maxLengthExceeded){case"none":break;case"error":throw new Error(u);case"warn":default:console.warn(u)}}const l=u=>{var p;const[d,h]=Object.entries(u)[0];return yt[d](h)?h:(p=le.defaults)==null?void 0:p[d]};return new Promise((u,d)=>{Be("init speak");const h=hO(t),p=dO(e);p&&(h.voice=p,h.lang=p.lang,h.voiceURI=p.voiceURI),h.text=t,h.pitch=l({pitch:n}),h.rate=l({rate:r}),h.volume=l({volume:i});const m=h.voice&&h.voice.name&&h.voice.name.toLocaleLowerCase().includes("(natural)");pO(h,{isMsNatural:m}),_s.forEach(f=>{var g;const y=c[f];yt.handler(y)&&h.addEventListener(f,y),(g=le.handlers)!=null&&g[f]&&h.addEventListener(f,le.handlers[f])}),h.addEventListener("start",()=>{ve.paused=!1,ve.speaking=!0;const f=!m&&!ve.isFirefox&&!ve.isSafari&&ve.isAndroid!==!0;(typeof s=="boolean"?s:f)&&gf(h)}),h.addEventListener("end",f=>{Be("speak complete"),ve.paused=!1,ve.speaking=!1,clearTimeout(hn),u(f)}),h.addEventListener("error",(f={})=>{Be(`speak failed: ${f.message}`),ve.paused=!1,ve.speaking=!1,clearTimeout(hn),d(f)}),clearTimeout(hn),a!==!0&&le.speechSynthesis.cancel(),setTimeout(()=>le.speechSynthesis.speak(h),10)})};const pO=({voice:t,pitch:e,rate:n,volume:r},{isMsNatural:i=!1}={})=>{lt(`utterance: voice=${t==null?void 0:t.name} volume=${r} rate=${n} pitch=${e} isMsNatural=${i}`)};let hn;function gf(t){if(!t&&hn)return lt("force-clear timeout"),ct.clearTimeout(hn);const{paused:e,speaking:n}=le.speechSynthesis,r=n||ve.speaking,i=e||ve.paused;lt(`resumeInfinity isSpeaking=${r} isPaused=${i}`),r&&!i&&(le.speechSynthesis.pause(),le.speechSynthesis.resume()),hn=ct.setTimeout(function(){gf(t)},5e3)}Ee.cancel=()=>{kt(),Be("cancelling"),le.speechSynthesis.cancel(),ve.paused=!1,ve.speaking=!1},Ee.resume=()=>{kt(),Be("resuming"),ve.paused=!1,ve.speaking=!0,le.speechSynthesis.resume()},Ee.pause=()=>{if(kt(),Be("pausing"),ve.isAndroid)return lt("patch pause on Android with cancel"),le.speechSynthesis.cancel();le.speechSynthesis.pause(),ve.paused=!0,ve.speaking=!1},Ee.reset=()=>{Object.assign(le,{status:"reset",initialized:!1,speechSynthesis:null,speechSynthesisUtterance:null,speechSynthesisVoice:null,speechSynthesisEvent:null,speechSynthesisErrorEvent:null,voices:null,defaultVoice:null,defaults:{pitch:1,rate:1,volume:1,voice:null},handlers:{}})};class Ve{constructor(){}static getInstance(){return Ve.instance||(Ve.instance=new Ve),Ve.instance}static async init(){try{Ve.promise=Ee.init({maxTimeout:5e3,interval:100}),await Ve.promise}finally{Ve.promise=void 0}}async speak(e){Ve.promise&&await Ve.promise;const n=Ee.status();if(!("initialized"in n)||!n.initialized)throw new Error("EasySpeech is not ready");return Ee.speak({text:e,pitch:1,rate:1,volume:1,voice:Ee.voices()[0]}).catch(r=>{xt("Error during speech synthesis:",r)})}async stop(){return Ee.cancel()}}Ve.init(),Zf=Ve.getInstance()});export{Ts as $,js as A,Of as B,Af as C,Nf as D,Rs as E,Is as F,$s as G,xn as H,bi as I,Bs as J,Ls as K,Ds as L,zs as M,wi as N,vn as O,re as P,Mi as Q,Fs as R,Ei as S,Ci as T,_i as U,Si as V,rr as W,Oi as X,ir as Y,Vs as Z,Bt as _,a3 as __tla,Lt as a,qs as a0,or as a1,sr as a2,vt as a3,Ze as a4,Ai as a5,Ws as a6,Hs as a7,Us as a8,Pf as a9,Ni as aA,Pi as aB,Qs as aC,Zs as aD,bn as aE,Dt as aF,ar as aG,ki as aH,Ys as aI,Xs as aJ,Gs as aK,kf as aL,Tf as aa,cr as ab,de as ac,ge as ad,jf as ae,Rf as af,wn as ag,If as ah,lr as ai,bt as aj,$f as ak,wt as al,Bf as am,dt as an,Lf as ao,Df as ap,Ks as aq,Ti as ar,Js as as,ea as at,ji as au,ta as av,na as aw,Ri as ax,ra as ay,ia as az,Ii as b,$i as c,oa as d,sa as e,aa as f,zf as g,ca as h,et as i,Ff as j,Vf as k,ur as l,qf as m,Wf as n,la as o,ua as p,Hf as q,Fe as r,Bi as s,Uf as t,Qf as u,dr as v,hr as w,Zf as x,tt as y,zt as z};
