import{r as _,M as oE,j as S,G as Xf,au as sE,I as aE,av as cE,aw as Kf,al as Yt,a1 as lE,m as uE,ax as Zt,ay as dE,az as hE,aA as Jf,aB as em,Y as Ne,aC as pE,y as Ce,a4 as _t,s as La,as as tm,g as Se,L as kr,p as fE,h as mE,q as nm,$ as Fa,__tla as yE}from"./index-CdqVygTZ.js";import{W as Ct,__tla as gE}from"./routes-C5hLUVGL.js";let za,Va,St,Tr,Ot,qa,Wa,Ha,Gt,jr,Ua,Qa,Ya,Za,Rr,Xt,re,Ir,Ga,Br,$r,Dr,Lr,On,Fr,Nn,Xa,Ka,Nt,Pn,An,We,zr,Ja,ec,tc,nc,rm,kn,rc,Vr,Kt,Pt,qr,ic,oc,sc,im,de,ye,om,sm,Jt,am,Tn,ht,cm,pt,lm,st,um,dm,ac,Wr,cc,lc,Hr,uc,dc,Ur,hc,pc,Qr,fc,Yr,Zr,mc,yc,gc,hm,vc,Xe,pm,fm,jn,mm,ym,xc,bc,gm,$e,wc,vm,xm,Rn,In,Mc,At,Ke,vE=Promise.all([(()=>{try{return yE}catch{}})(),(()=>{try{return gE}catch{}})()]).then(async()=>{Ya=(t=>(t.Started="started",t.Downloading="downloading",t.Downloaded="downloaded",t.Loading="loading",t.Loaded="loaded",t))(Ya||{}),vc=(t=>(t.LLM="LLM",t.embedding="embedding",t.VLM="VLM",t))(vc||{}),gc=(t=>(t.WebLLM="WebLLM",t.OpenAI="OpenAI",t))(gc||{}),Wa=(t=>(t.VECTOR_DATABASE_RETREIVER="VECTOR_DATABASE_RETREIVER",t))(Wa||{});class bm extends _.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function wm({children:t,isPresent:e}){const n=_.useId(),r=_.useRef(null),i=_.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=_.useContext(oE);return _.useInsertionEffect(()=>{const{width:s,height:a,top:c,left:l}=i.current;if(e||!r.current||!s||!a)return;r.current.dataset.motionPopId=n;const d=document.createElement("style");return o&&(d.nonce=o),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${s}px !important;
            height: ${a}px !important;
            top: ${c}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[e]),S.jsx(bm,{isPresent:e,childRef:r,sizeRef:i,children:_.cloneElement(t,{ref:r})})}const Mm=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:o,mode:s})=>{const a=Xf(Em),c=_.useId(),l=_.useCallback(u=>{a.set(u,!0);for(const h of a.values())if(!h)return;r&&r()},[a,r]),d=_.useMemo(()=>({id:c,initial:e,isPresent:n,custom:i,onExitComplete:l,register:u=>(a.set(u,!1),()=>a.delete(u))}),o?[Math.random(),l]:[n,l]);return _.useMemo(()=>{a.forEach((u,h)=>a.set(h,!1))},[n]),_.useEffect(()=>{!n&&!a.size&&r&&r()},[n]),s==="popLayout"&&(t=S.jsx(wm,{isPresent:n,children:t})),S.jsx(sE.Provider,{value:d,children:t})};function Em(){return new Map}const Bn=t=>t.key||"";function Ec(t){const e=[];return _.Children.forEach(t,n=>{_.isValidElement(n)&&e.push(n)}),e}const _m=({children:t,exitBeforeEnter:e,custom:n,initial:r=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:s="sync"})=>{const a=_.useMemo(()=>Ec(t),[t]),c=a.map(Bn),l=_.useRef(!0),d=_.useRef(a),u=Xf(()=>new Map),[h,p]=_.useState(a),[m,f]=_.useState(a);aE(()=>{l.current=!1,d.current=a;for(let x=0;x<m.length;x++){const v=Bn(m[x]);c.includes(v)?u.delete(v):u.get(v)!==!0&&u.set(v,!1)}},[m,c.length,c.join("-")]);const g=[];if(a!==h){let x=[...a];for(let v=0;v<m.length;v++){const b=m[v],M=Bn(b);c.includes(M)||(x.splice(v,0,b),g.push(b))}s==="wait"&&g.length&&(x=g),f(Ec(x)),p(a);return}const{forceRender:y}=_.useContext(cE);return S.jsx(S.Fragment,{children:m.map(x=>{const v=Bn(x),b=a===m||c.includes(v),M=()=>{if(u.has(v))u.set(v,!0);else return;let C=!0;u.forEach(E=>{E||(C=!1)}),C&&(y==null||y(),f(d.current),i&&i())};return S.jsx(Mm,{isPresent:b,initial:!l.current||r?void 0:!1,custom:b?void 0:n,presenceAffectsLayout:o,mode:s,onExitComplete:b?void 0:M,children:x},v)})})};function we(t){if(typeof t=="string"||typeof t=="number")return""+t;let e="";if(Array.isArray(t))for(let n=0,r;n<t.length;n++)(r=we(t[n]))!==""&&(e+=(e&&" ")+r);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}var Cm={value:()=>{}};function $n(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Dn(n)}function Dn(t){this._=t}function Sm(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Dn.prototype=$n.prototype={constructor:Dn,on:function(t,e){var n=this._,r=Sm(t+"",n),i,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((i=(t=r[o]).type)&&(i=Om(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(t=r[o]).type)n[i]=_c(n[i],t.name,e);else if(e==null)for(i in n)n[i]=_c(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Dn(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function Om(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function _c(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Cm,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Gr="http://www.w3.org/1999/xhtml";const Cc={svg:"http://www.w3.org/2000/svg",xhtml:Gr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ln(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Cc.hasOwnProperty(e)?{space:Cc[e],local:t}:t}function Nm(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Gr&&e.documentElement.namespaceURI===Gr?e.createElement(t):e.createElementNS(n,t)}}function Pm(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Sc(t){var e=Ln(t);return(e.local?Pm:Nm)(e)}function Am(){}function Xr(t){return t==null?Am:function(){return this.querySelector(t)}}function km(t){typeof t!="function"&&(t=Xr(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=new Array(s),c,l,d=0;d<s;++d)(c=o[d])&&(l=t.call(c,c.__data__,d,o))&&("__data__"in c&&(l.__data__=c.__data__),a[d]=l);return new Re(r,this._parents)}function Tm(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function jm(){return[]}function Oc(t){return t==null?jm:function(){return this.querySelectorAll(t)}}function Rm(t){return function(){return Tm(t.apply(this,arguments))}}function Im(t){typeof t=="function"?t=Rm(t):t=Oc(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var s=e[o],a=s.length,c,l=0;l<a;++l)(c=s[l])&&(r.push(t.call(c,c.__data__,l,s)),i.push(c));return new Re(r,i)}function Nc(t){return function(){return this.matches(t)}}function Pc(t){return function(e){return e.matches(t)}}var Bm=Array.prototype.find;function $m(t){return function(){return Bm.call(this.children,t)}}function Dm(){return this.firstElementChild}function Lm(t){return this.select(t==null?Dm:$m(typeof t=="function"?t:Pc(t)))}var Fm=Array.prototype.filter;function zm(){return Array.from(this.children)}function Vm(t){return function(){return Fm.call(this.children,t)}}function qm(t){return this.selectAll(t==null?zm:Vm(typeof t=="function"?t:Pc(t)))}function Wm(t){typeof t!="function"&&(t=Nc(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],c,l=0;l<s;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&a.push(c);return new Re(r,this._parents)}function Ac(t){return new Array(t.length)}function Hm(){return new Re(this._enter||this._groups.map(Ac),this._parents)}function Fn(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Fn.prototype={constructor:Fn,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Um(t){return function(){return t}}function Qm(t,e,n,r,i,o){for(var s=0,a,c=e.length,l=o.length;s<l;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new Fn(t,o[s]);for(;s<c;++s)(a=e[s])&&(i[s]=a)}function Ym(t,e,n,r,i,o,s){var a,c,l=new Map,d=e.length,u=o.length,h=new Array(d),p;for(a=0;a<d;++a)(c=e[a])&&(h[a]=p=s.call(c,c.__data__,a,e)+"",l.has(p)?i[a]=c:l.set(p,c));for(a=0;a<u;++a)p=s.call(t,o[a],a,o)+"",(c=l.get(p))?(r[a]=c,c.__data__=o[a],l.delete(p)):n[a]=new Fn(t,o[a]);for(a=0;a<d;++a)(c=e[a])&&l.get(h[a])===c&&(i[a]=c)}function Zm(t){return t.__data__}function Gm(t,e){if(!arguments.length)return Array.from(this,Zm);var n=e?Ym:Qm,r=this._parents,i=this._groups;typeof t!="function"&&(t=Um(t));for(var o=i.length,s=new Array(o),a=new Array(o),c=new Array(o),l=0;l<o;++l){var d=r[l],u=i[l],h=u.length,p=Xm(t.call(d,d&&d.__data__,l,r)),m=p.length,f=a[l]=new Array(m),g=s[l]=new Array(m),y=c[l]=new Array(h);n(d,u,f,g,y,p,e);for(var x=0,v=0,b,M;x<m;++x)if(b=f[x]){for(x>=v&&(v=x+1);!(M=g[v])&&++v<m;);b._next=M||null}}return s=new Re(s,r),s._enter=a,s._exit=c,s}function Xm(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Km(){return new Re(this._exit||this._groups.map(Ac),this._parents)}function Jm(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function ey(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),c=0;c<s;++c)for(var l=n[c],d=r[c],u=l.length,h=a[c]=new Array(u),p,m=0;m<u;++m)(p=l[m]||d[m])&&(h[m]=p);for(;c<i;++c)a[c]=n[c];return new Re(a,this._parents)}function ty(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],s;--i>=0;)(s=r[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function ny(t){t||(t=ry);function e(u,h){return u&&h?t(u.__data__,h.__data__):!u-!h}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s=n[o],a=s.length,c=i[o]=new Array(a),l,d=0;d<a;++d)(l=s[d])&&(c[d]=l);c.sort(e)}return new Re(i,this._parents).order()}function ry(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function iy(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function oy(){return Array.from(this)}function sy(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null}function ay(){let t=0;for(const e of this)++t;return t}function cy(){return!this.node()}function ly(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,s=i.length,a;o<s;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this}function uy(t){return function(){this.removeAttribute(t)}}function dy(t){return function(){this.removeAttributeNS(t.space,t.local)}}function hy(t,e){return function(){this.setAttribute(t,e)}}function py(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function fy(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function my(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function yy(t,e){var n=Ln(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?dy:uy:typeof e=="function"?n.local?my:fy:n.local?py:hy)(n,e))}function kc(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function gy(t){return function(){this.style.removeProperty(t)}}function vy(t,e,n){return function(){this.style.setProperty(t,e,n)}}function xy(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function by(t,e,n){return arguments.length>1?this.each((e==null?gy:typeof e=="function"?xy:vy)(t,e,n??"")):kt(this.node(),t)}function kt(t,e){return t.style.getPropertyValue(e)||kc(t).getComputedStyle(t,null).getPropertyValue(e)}function wy(t){return function(){delete this[t]}}function My(t,e){return function(){this[t]=e}}function Ey(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function _y(t,e){return arguments.length>1?this.each((e==null?wy:typeof e=="function"?Ey:My)(t,e)):this.node()[t]}function Tc(t){return t.trim().split(/^|\s+/)}function Kr(t){return t.classList||new jc(t)}function jc(t){this._node=t,this._names=Tc(t.getAttribute("class")||"")}jc.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Rc(t,e){for(var n=Kr(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Ic(t,e){for(var n=Kr(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Cy(t){return function(){Rc(this,t)}}function Sy(t){return function(){Ic(this,t)}}function Oy(t,e){return function(){(e.apply(this,arguments)?Rc:Ic)(this,t)}}function Ny(t,e){var n=Tc(t+"");if(arguments.length<2){for(var r=Kr(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Oy:e?Cy:Sy)(n,e))}function Py(){this.textContent=""}function Ay(t){return function(){this.textContent=t}}function ky(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ty(t){return arguments.length?this.each(t==null?Py:(typeof t=="function"?ky:Ay)(t)):this.node().textContent}function jy(){this.innerHTML=""}function Ry(t){return function(){this.innerHTML=t}}function Iy(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function By(t){return arguments.length?this.each(t==null?jy:(typeof t=="function"?Iy:Ry)(t)):this.node().innerHTML}function $y(){this.nextSibling&&this.parentNode.appendChild(this)}function Dy(){return this.each($y)}function Ly(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Fy(){return this.each(Ly)}function zy(t){var e=typeof t=="function"?t:Sc(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Vy(){return null}function qy(t,e){var n=typeof t=="function"?t:Sc(t),r=e==null?Vy:typeof e=="function"?e:Xr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Wy(){var t=this.parentNode;t&&t.removeChild(this)}function Hy(){return this.each(Wy)}function Uy(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Qy(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Yy(t){return this.select(t?Qy:Uy)}function Zy(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Gy(t){return function(e){t.call(this,e,this.__data__)}}function Xy(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Ky(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function Jy(t,e,n){return function(){var r=this.__on,i,o=Gy(e);if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function eg(t,e,n){var r=Xy(t+""),i,o=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,d;c<l;++c)for(i=0,d=a[c];i<o;++i)if((s=r[i]).type===d.type&&s.name===d.name)return d.value}return}for(a=e?Jy:Ky,i=0;i<o;++i)this.each(a(r[i],e,n));return this}function Bc(t,e,n){var r=kc(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function tg(t,e){return function(){return Bc(this,t,e)}}function ng(t,e){return function(){return Bc(this,t,e.apply(this,arguments))}}function rg(t,e){return this.each((typeof e=="function"?ng:tg)(t,e))}function*ig(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,s;i<o;++i)(s=r[i])&&(yield s)}var $c=[null];function Re(t,e){this._groups=t,this._parents=e}function en(){return new Re([[document.documentElement]],$c)}function og(){return this}Re.prototype=en.prototype={constructor:Re,select:km,selectAll:Im,selectChild:Lm,selectChildren:qm,filter:Wm,data:Gm,enter:Hm,exit:Km,join:Jm,merge:ey,selection:og,order:ty,sort:ny,call:iy,nodes:oy,node:sy,size:ay,empty:cy,each:ly,attr:yy,style:by,property:_y,classed:Ny,text:Ty,html:By,raise:Dy,lower:Fy,append:zy,insert:qy,remove:Hy,clone:Yy,datum:Zy,on:eg,dispatch:rg,[Symbol.iterator]:ig};function Ie(t){return typeof t=="string"?new Re([[document.querySelector(t)]],[document.documentElement]):new Re([[t]],$c)}function sg(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Le(t,e){if(t=sg(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const ag={passive:!1},tn={capture:!0,passive:!1};function Jr(t){t.stopImmediatePropagation()}function Tt(t){t.preventDefault(),t.stopImmediatePropagation()}function Dc(t){var e=t.document.documentElement,n=Ie(t).on("dragstart.drag",Tt,tn);"onselectstart"in e?n.on("selectstart.drag",Tt,tn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Lc(t,e){var n=t.document.documentElement,r=Ie(t).on("dragstart.drag",null);e&&(r.on("click.drag",Tt,tn),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const zn=t=>()=>t;function ei(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:s,y:a,dx:c,dy:l,dispatch:d}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:d}})}ei.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function cg(t){return!t.ctrlKey&&!t.button}function lg(){return this.parentNode}function ug(t,e){return e??{x:t.x,y:t.y}}function dg(){return navigator.maxTouchPoints||"ontouchstart"in this}function Fc(){var t=cg,e=lg,n=ug,r=dg,i={},o=$n("start","drag","end"),s=0,a,c,l,d,u=0;function h(b){b.on("mousedown.drag",p).filter(r).on("touchstart.drag",g).on("touchmove.drag",y,ag).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(b,M){if(!(d||!t.call(this,b,M))){var C=v(this,e.call(this,b,M),b,M,"mouse");C&&(Ie(b.view).on("mousemove.drag",m,tn).on("mouseup.drag",f,tn),Dc(b.view),Jr(b),l=!1,a=b.clientX,c=b.clientY,C("start",b))}}function m(b){if(Tt(b),!l){var M=b.clientX-a,C=b.clientY-c;l=M*M+C*C>u}i.mouse("drag",b)}function f(b){Ie(b.view).on("mousemove.drag mouseup.drag",null),Lc(b.view,l),Tt(b),i.mouse("end",b)}function g(b,M){if(t.call(this,b,M)){var C=b.changedTouches,E=e.call(this,b,M),A=C.length,R,B;for(R=0;R<A;++R)(B=v(this,E,b,M,C[R].identifier,C[R]))&&(Jr(b),B("start",b,C[R]))}}function y(b){var M=b.changedTouches,C=M.length,E,A;for(E=0;E<C;++E)(A=i[M[E].identifier])&&(Tt(b),A("drag",b,M[E]))}function x(b){var M=b.changedTouches,C=M.length,E,A;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),E=0;E<C;++E)(A=i[M[E].identifier])&&(Jr(b),A("end",b,M[E]))}function v(b,M,C,E,A,R){var B=o.copy(),$=Le(R||C,M),F,D,w;if((w=n.call(b,new ei("beforestart",{sourceEvent:C,target:h,identifier:A,active:s,x:$[0],y:$[1],dx:0,dy:0,dispatch:B}),E))!=null)return F=w.x-$[0]||0,D=w.y-$[1]||0,function k(O,T,N){var j=$,L;switch(O){case"start":i[A]=k,L=s++;break;case"end":delete i[A],--s;case"drag":$=Le(N||T,M),L=s;break}B.call(O,b,new ei(O,{sourceEvent:T,subject:w,target:h,identifier:A,active:L,x:$[0]+F,y:$[1]+D,dx:$[0]-j[0],dy:$[1]-j[1],dispatch:B}),E)}}return h.filter=function(b){return arguments.length?(t=typeof b=="function"?b:zn(!!b),h):t},h.container=function(b){return arguments.length?(e=typeof b=="function"?b:zn(b),h):e},h.subject=function(b){return arguments.length?(n=typeof b=="function"?b:zn(b),h):n},h.touchable=function(b){return arguments.length?(r=typeof b=="function"?b:zn(!!b),h):r},h.on=function(){var b=o.on.apply(o,arguments);return b===o?h:b},h.clickDistance=function(b){return arguments.length?(u=(b=+b)*b,h):Math.sqrt(u)},h}function ti(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function zc(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function nn(){}var rn=.7,Vn=1/rn,jt="\\s*([+-]?\\d+)\\s*",on="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",He="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",hg=/^#([0-9a-f]{3,8})$/,pg=new RegExp(`^rgb\\(${jt},${jt},${jt}\\)$`),fg=new RegExp(`^rgb\\(${He},${He},${He}\\)$`),mg=new RegExp(`^rgba\\(${jt},${jt},${jt},${on}\\)$`),yg=new RegExp(`^rgba\\(${He},${He},${He},${on}\\)$`),gg=new RegExp(`^hsl\\(${on},${He},${He}\\)$`),vg=new RegExp(`^hsla\\(${on},${He},${He},${on}\\)$`),Vc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ti(nn,Nt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:qc,formatHex:qc,formatHex8:xg,formatHsl:bg,formatRgb:Wc,toString:Wc});function qc(){return this.rgb().formatHex()}function xg(){return this.rgb().formatHex8()}function bg(){return Zc(this).formatHsl()}function Wc(){return this.rgb().formatRgb()}Nt=function(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=hg.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Hc(e):n===3?new je(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?qn(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?qn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=pg.exec(t))?new je(e[1],e[2],e[3],1):(e=fg.exec(t))?new je(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=mg.exec(t))?qn(e[1],e[2],e[3],e[4]):(e=yg.exec(t))?qn(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=gg.exec(t))?Yc(e[1],e[2]/100,e[3]/100,1):(e=vg.exec(t))?Yc(e[1],e[2]/100,e[3]/100,e[4]):Vc.hasOwnProperty(t)?Hc(Vc[t]):t==="transparent"?new je(NaN,NaN,NaN,0):null};function Hc(t){return new je(t>>16&255,t>>8&255,t&255,1)}function qn(t,e,n,r){return r<=0&&(t=e=n=NaN),new je(t,e,n,r)}function wg(t){return t instanceof nn||(t=Nt(t)),t?(t=t.rgb(),new je(t.r,t.g,t.b,t.opacity)):new je}function ni(t,e,n,r){return arguments.length===1?wg(t):new je(t,e,n,r??1)}function je(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}ti(je,ni,zc(nn,{brighter(t){return t=t==null?Vn:Math.pow(Vn,t),new je(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?rn:Math.pow(rn,t),new je(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new je(ft(this.r),ft(this.g),ft(this.b),Wn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Uc,formatHex:Uc,formatHex8:Mg,formatRgb:Qc,toString:Qc}));function Uc(){return`#${mt(this.r)}${mt(this.g)}${mt(this.b)}`}function Mg(){return`#${mt(this.r)}${mt(this.g)}${mt(this.b)}${mt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Qc(){const t=Wn(this.opacity);return`${t===1?"rgb(":"rgba("}${ft(this.r)}, ${ft(this.g)}, ${ft(this.b)}${t===1?")":`, ${t})`}`}function Wn(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ft(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function mt(t){return t=ft(t),(t<16?"0":"")+t.toString(16)}function Yc(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Fe(t,e,n,r)}function Zc(t){if(t instanceof Fe)return new Fe(t.h,t.s,t.l,t.opacity);if(t instanceof nn||(t=Nt(t)),!t)return new Fe;if(t instanceof Fe)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,a=o-i,c=(o+i)/2;return a?(e===o?s=(n-r)/a+(n<r)*6:n===o?s=(r-e)/a+2:s=(e-n)/a+4,a/=c<.5?o+i:2-o-i,s*=60):a=c>0&&c<1?0:s,new Fe(s,a,c,t.opacity)}function Eg(t,e,n,r){return arguments.length===1?Zc(t):new Fe(t,e,n,r??1)}function Fe(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}ti(Fe,Eg,zc(nn,{brighter(t){return t=t==null?Vn:Math.pow(Vn,t),new Fe(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?rn:Math.pow(rn,t),new Fe(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new je(ri(t>=240?t-240:t+120,i,r),ri(t,i,r),ri(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Fe(Gc(this.h),Hn(this.s),Hn(this.l),Wn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Wn(this.opacity);return`${t===1?"hsl(":"hsla("}${Gc(this.h)}, ${Hn(this.s)*100}%, ${Hn(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Gc(t){return t=(t||0)%360,t<0?t+360:t}function Hn(t){return Math.max(0,Math.min(1,t||0))}function ri(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}Zr=t=>()=>t;function _g(t,e){return function(n){return t+n*e}}function Cg(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Sg(t){return(t=+t)==1?Xc:function(e,n){return n-e?Cg(e,n,t):Zr(isNaN(e)?n:e)}}function Xc(t,e){var n=e-t;return n?_g(t,n):Zr(isNaN(t)?e:t)}Yr=function t(e){var n=Sg(e);function r(i,o){var s=n((i=ni(i)).r,(o=ni(o)).r),a=n(i.g,o.g),c=n(i.b,o.b),l=Xc(i.opacity,o.opacity);return function(d){return i.r=s(d),i.g=a(d),i.b=c(d),i.opacity=l(d),i+""}}return r.gamma=t,r}(1),Xe=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}};var ii=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,oi=new RegExp(ii.source,"g");function Og(t){return function(){return t}}function Ng(t){return function(e){return t(e)+""}}mc=function(t,e){var n=ii.lastIndex=oi.lastIndex=0,r,i,o,s=-1,a=[],c=[];for(t=t+"",e=e+"";(r=ii.exec(t))&&(i=oi.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,c.push({i:s,x:Xe(r,i)})),n=oi.lastIndex;return n<e.length&&(o=e.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?c[0]?Ng(c[0].x):Og(e):(e=c.length,function(l){for(var d=0,u;d<e;++d)a[(u=c[d]).i]=u.x(l);return a.join("")})};var Kc=180/Math.PI,Jc={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function el(t,e,n,r,i,o){var s,a,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),t*r<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*Kc,skewX:Math.atan(c)*Kc,scaleX:s,scaleY:a}}var Un;function Pg(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Jc:el(e.a,e.b,e.c,e.d,e.e,e.f)}function Ag(t){return t==null||(Un||(Un=document.createElementNS("http://www.w3.org/2000/svg","g")),Un.setAttribute("transform",t),!(t=Un.transform.baseVal.consolidate()))?Jc:(t=t.matrix,el(t.a,t.b,t.c,t.d,t.e,t.f))}function tl(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function o(l,d,u,h,p,m){if(l!==u||d!==h){var f=p.push("translate(",null,e,null,n);m.push({i:f-4,x:Xe(l,u)},{i:f-2,x:Xe(d,h)})}else(u||h)&&p.push("translate("+u+e+h+n)}function s(l,d,u,h){l!==d?(l-d>180?d+=360:d-l>180&&(l+=360),h.push({i:u.push(i(u)+"rotate(",null,r)-2,x:Xe(l,d)})):d&&u.push(i(u)+"rotate("+d+r)}function a(l,d,u,h){l!==d?h.push({i:u.push(i(u)+"skewX(",null,r)-2,x:Xe(l,d)}):d&&u.push(i(u)+"skewX("+d+r)}function c(l,d,u,h,p,m){if(l!==u||d!==h){var f=p.push(i(p)+"scale(",null,",",null,")");m.push({i:f-4,x:Xe(l,u)},{i:f-2,x:Xe(d,h)})}else(u!==1||h!==1)&&p.push(i(p)+"scale("+u+","+h+")")}return function(l,d){var u=[],h=[];return l=t(l),d=t(d),o(l.translateX,l.translateY,d.translateX,d.translateY,u,h),s(l.rotate,d.rotate,u,h),a(l.skewX,d.skewX,u,h),c(l.scaleX,l.scaleY,d.scaleX,d.scaleY,u,h),l=d=null,function(p){for(var m=-1,f=h.length,g;++m<f;)u[(g=h[m]).i]=g.x(p);return u.join("")}}}var kg=tl(Pg,"px, ","px)","deg)"),Tg=tl(Ag,", ",")",")"),jg=1e-12;function nl(t){return((t=Math.exp(t))+1/t)/2}function Rg(t){return((t=Math.exp(t))-1/t)/2}function Ig(t){return((t=Math.exp(2*t))-1)/(t+1)}const Bg=function t(e,n,r){function i(o,s){var a=o[0],c=o[1],l=o[2],d=s[0],u=s[1],h=s[2],p=d-a,m=u-c,f=p*p+m*m,g,y;if(f<jg)y=Math.log(h/l)/e,g=function(E){return[a+E*p,c+E*m,l*Math.exp(e*E*y)]};else{var x=Math.sqrt(f),v=(h*h-l*l+r*f)/(2*l*n*x),b=(h*h-l*l-r*f)/(2*h*n*x),M=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(b*b+1)-b);y=(C-M)/e,g=function(E){var A=E*y,R=nl(M),B=l/(n*x)*(R*Ig(e*A+M)-Rg(M));return[a+B*p,c+B*m,l*R/nl(e*A+M)]}}return g.duration=y*1e3*e/Math.SQRT2,g}return i.rho=function(o){var s=Math.max(.001,+o),a=s*s,c=a*a;return t(s,a,c)},i}(Math.SQRT2,2,4);var Rt=0,sn=0,an=0,rl=1e3,Qn,cn,Yn=0,yt=0,Zn=0,ln=typeof performance=="object"&&performance.now?performance:Date,il=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function si(){return yt||(il($g),yt=ln.now()+Zn)}function $g(){yt=0}function Gn(){this._call=this._time=this._next=null}Gn.prototype=ol.prototype={constructor:Gn,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?si():+n)+(e==null?0:+e),!this._next&&cn!==this&&(cn?cn._next=this:Qn=this,cn=this),this._call=t,this._time=n,ai()},stop:function(){this._call&&(this._call=null,this._time=1/0,ai())}};function ol(t,e,n){var r=new Gn;return r.restart(t,e,n),r}function Dg(){si(),++Rt;for(var t=Qn,e;t;)(e=yt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Rt}function sl(){yt=(Yn=ln.now())+Zn,Rt=sn=0;try{Dg()}finally{Rt=0,Fg(),yt=0}}function Lg(){var t=ln.now(),e=t-Yn;e>rl&&(Zn-=e,Yn=t)}function Fg(){for(var t,e=Qn,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Qn=n);cn=t,ai(r)}function ai(t){if(!Rt){sn&&(sn=clearTimeout(sn));var e=t-yt;e>24?(t<1/0&&(sn=setTimeout(sl,t-ln.now()-Zn)),an&&(an=clearInterval(an))):(an||(Yn=ln.now(),an=setInterval(Lg,rl)),Rt=1,il(sl))}}function al(t,e,n){var r=new Gn;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var zg=$n("start","end","cancel","interrupt"),Vg=[],cl=0,ll=1,ci=2,Xn=3,ul=4,li=5,Kn=6;function Jn(t,e,n,r,i,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;qg(t,n,{name:e,index:r,group:i,on:zg,tween:Vg,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:cl})}function ui(t,e){var n=ze(t,e);if(n.state>cl)throw new Error("too late; already scheduled");return n}function Ue(t,e){var n=ze(t,e);if(n.state>Xn)throw new Error("too late; already running");return n}function ze(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function qg(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=ol(o,0,n.time);function o(l){n.state=ll,n.timer.restart(s,n.delay,n.time),n.delay<=l&&s(l-n.delay)}function s(l){var d,u,h,p;if(n.state!==ll)return c();for(d in r)if(p=r[d],p.name===n.name){if(p.state===Xn)return al(s);p.state===ul?(p.state=Kn,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[d]):+d<e&&(p.state=Kn,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[d])}if(al(function(){n.state===Xn&&(n.state=ul,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=ci,n.on.call("start",t,t.__data__,n.index,n.group),n.state===ci){for(n.state=Xn,i=new Array(h=n.tween.length),d=0,u=-1;d<h;++d)(p=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=p);i.length=u+1}}function a(l){for(var d=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=li,1),u=-1,h=i.length;++u<h;)i[u].call(t,d);n.state===li&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=Kn,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function er(t,e){var n=t.__transition,r,i,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){o=!1;continue}i=r.state>ci&&r.state<li,r.state=Kn,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}o&&delete t.__transition}}function Wg(t){return this.each(function(){er(this,t)})}function Hg(t,e){var n,r;return function(){var i=Ue(this,t),o=i.tween;if(o!==n){r=n=o;for(var s=0,a=r.length;s<a;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function Ug(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=Ue(this,t),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:e,value:n},c=0,l=i.length;c<l;++c)if(i[c].name===e){i[c]=a;break}c===l&&i.push(a)}o.tween=i}}function Qg(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=ze(this.node(),n).tween,i=0,o=r.length,s;i<o;++i)if((s=r[i]).name===t)return s.value;return null}return this.each((e==null?Hg:Ug)(n,t,e))}function di(t,e,n){var r=t._id;return t.each(function(){var i=Ue(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return ze(i,r).value[e]}}function dl(t,e){var n;return(typeof e=="number"?Xe:e instanceof Nt?Yr:(n=Nt(e))?(e=n,Yr):mc)(t,e)}function Yg(t){return function(){this.removeAttribute(t)}}function Zg(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Gg(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttribute(t);return s===i?null:s===r?o:o=e(r=s,n)}}function Xg(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===r?o:o=e(r=s,n)}}function Kg(t,e,n){var r,i,o;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=a+"",s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a)))}}function Jg(t,e,n){var r,i,o;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=a+"",s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a)))}}function e0(t,e){var n=Ln(t),r=n==="transform"?Tg:dl;return this.attrTween(t,typeof e=="function"?(n.local?Jg:Kg)(n,r,di(this,"attr."+t,e)):e==null?(n.local?Zg:Yg)(n):(n.local?Xg:Gg)(n,r,e))}function t0(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function n0(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function r0(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&n0(t,o)),n}return i._value=e,i}function i0(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&t0(t,o)),n}return i._value=e,i}function o0(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ln(t);return this.tween(n,(r.local?r0:i0)(r,e))}function s0(t,e){return function(){ui(this,t).delay=+e.apply(this,arguments)}}function a0(t,e){return e=+e,function(){ui(this,t).delay=e}}function c0(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?s0:a0)(e,t)):ze(this.node(),e).delay}function l0(t,e){return function(){Ue(this,t).duration=+e.apply(this,arguments)}}function u0(t,e){return e=+e,function(){Ue(this,t).duration=e}}function d0(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?l0:u0)(e,t)):ze(this.node(),e).duration}function h0(t,e){if(typeof e!="function")throw new Error;return function(){Ue(this,t).ease=e}}function p0(t){var e=this._id;return arguments.length?this.each(h0(e,t)):ze(this.node(),e).ease}function f0(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Ue(this,t).ease=n}}function m0(t){if(typeof t!="function")throw new Error;return this.each(f0(this._id,t))}function y0(t){typeof t!="function"&&(t=Nc(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],c,l=0;l<s;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&a.push(c);return new Je(r,this._parents,this._name,this._id)}function g0(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var c=e[a],l=n[a],d=c.length,u=s[a]=new Array(d),h,p=0;p<d;++p)(h=c[p]||l[p])&&(u[p]=h);for(;a<r;++a)s[a]=e[a];return new Je(s,this._parents,this._name,this._id)}function v0(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function x0(t,e,n){var r,i,o=v0(e)?ui:Ue;return function(){var s=o(this,t),a=s.on;a!==r&&(i=(r=a).copy()).on(e,n),s.on=i}}function b0(t,e){var n=this._id;return arguments.length<2?ze(this.node(),n).on.on(t):this.each(x0(n,t,e))}function w0(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function M0(){return this.on("end.remove",w0(this._id))}function E0(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Xr(t));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a=r[s],c=a.length,l=o[s]=new Array(c),d,u,h=0;h<c;++h)(d=a[h])&&(u=t.call(d,d.__data__,h,a))&&("__data__"in d&&(u.__data__=d.__data__),l[h]=u,Jn(l[h],e,n,h,l,ze(d,n)));return new Je(o,this._parents,e,n)}function _0(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Oc(t));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var c=r[a],l=c.length,d,u=0;u<l;++u)if(d=c[u]){for(var h=t.call(d,d.__data__,u,c),p,m=ze(d,n),f=0,g=h.length;f<g;++f)(p=h[f])&&Jn(p,e,n,f,h,m);o.push(h),s.push(d)}return new Je(o,s,e,n)}var C0=en.prototype.constructor;function S0(){return new C0(this._groups,this._parents)}function O0(t,e){var n,r,i;return function(){var o=kt(this,t),s=(this.style.removeProperty(t),kt(this,t));return o===s?null:o===n&&s===r?i:i=e(n=o,r=s)}}function hl(t){return function(){this.style.removeProperty(t)}}function N0(t,e,n){var r,i=n+"",o;return function(){var s=kt(this,t);return s===i?null:s===r?o:o=e(r=s,n)}}function P0(t,e,n){var r,i,o;return function(){var s=kt(this,t),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(t),kt(this,t))),s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a))}}function A0(t,e){var n,r,i,o="style."+e,s="end."+o,a;return function(){var c=Ue(this,t),l=c.on,d=c.value[o]==null?a||(a=hl(e)):void 0;(l!==n||i!==d)&&(r=(n=l).copy()).on(s,i=d),c.on=r}}function k0(t,e,n){var r=(t+="")=="transform"?kg:dl;return e==null?this.styleTween(t,O0(t,r)).on("end.style."+t,hl(t)):typeof e=="function"?this.styleTween(t,P0(t,r,di(this,"style."+t,e))).each(A0(this._id,t)):this.styleTween(t,N0(t,r,e),n).on("end.style."+t,null)}function T0(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function j0(t,e,n){var r,i;function o(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&T0(t,s,n)),r}return o._value=e,o}function R0(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,j0(t,e,n??""))}function I0(t){return function(){this.textContent=t}}function B0(t){return function(){var e=t(this);this.textContent=e??""}}function $0(t){return this.tween("text",typeof t=="function"?B0(di(this,"text",t)):I0(t==null?"":t+""))}function D0(t){return function(e){this.textContent=t.call(this,e)}}function L0(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&D0(i)),e}return r._value=t,r}function F0(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,L0(t))}function z0(){for(var t=this._name,e=this._id,n=pl(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,c,l=0;l<a;++l)if(c=s[l]){var d=ze(c,e);Jn(c,t,n,l,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Je(r,this._parents,t,n)}function V0(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},c={value:function(){--i===0&&o()}};n.each(function(){var l=Ue(this,r),d=l.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(c)),l.on=e}),i===0&&o()})}var q0=0;function Je(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function pl(){return++q0}var et=en.prototype;Je.prototype={constructor:Je,select:E0,selectAll:_0,selectChild:et.selectChild,selectChildren:et.selectChildren,filter:y0,merge:g0,selection:S0,transition:z0,call:et.call,nodes:et.nodes,node:et.node,size:et.size,empty:et.empty,each:et.each,on:b0,attr:e0,attrTween:o0,style:k0,styleTween:R0,text:$0,textTween:F0,remove:M0,tween:Qg,delay:c0,duration:d0,ease:p0,easeVarying:m0,end:V0,[Symbol.iterator]:et[Symbol.iterator]};function W0(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var H0={time:null,delay:0,duration:250,ease:W0};function U0(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Q0(t){var e,n;t instanceof Je?(e=t._id,t=t._name):(e=pl(),(n=H0).time=si(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,c,l=0;l<a;++l)(c=s[l])&&Jn(c,t,e,l,s,n||U0(c,e));return new Je(r,this._parents,t,e)}en.prototype.interrupt=Wg,en.prototype.transition=Q0;const tr=t=>()=>t;function Y0(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function tt(t,e,n){this.k=t,this.x=e,this.y=n}tt.prototype={constructor:tt,scale:function(t){return t===1?this:new tt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new tt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var nr=new tt(1,0,0);fl.prototype=tt.prototype;function fl(t){for(;!t.__zoom;)if(!(t=t.parentNode))return nr;return t.__zoom}function hi(t){t.stopImmediatePropagation()}function un(t){t.preventDefault(),t.stopImmediatePropagation()}function Z0(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function G0(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function ml(){return this.__zoom||nr}function X0(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function K0(){return navigator.maxTouchPoints||"ontouchstart"in this}function J0(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function yl(){var t=Z0,e=G0,n=J0,r=X0,i=K0,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,c=Bg,l=$n("start","zoom","end"),d,u,h,p=500,m=150,f=0,g=10;function y(w){w.property("__zoom",ml).on("wheel.zoom",A,{passive:!1}).on("mousedown.zoom",R).on("dblclick.zoom",B).filter(i).on("touchstart.zoom",$).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",D).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(w,k,O,T){var N=w.selection?w.selection():w;N.property("__zoom",ml),w!==N?M(w,k,O,T):N.interrupt().each(function(){C(this,arguments).event(T).start().zoom(null,typeof k=="function"?k.apply(this,arguments):k).end()})},y.scaleBy=function(w,k,O,T){y.scaleTo(w,function(){var N=this.__zoom.k,j=typeof k=="function"?k.apply(this,arguments):k;return N*j},O,T)},y.scaleTo=function(w,k,O,T){y.transform(w,function(){var N=e.apply(this,arguments),j=this.__zoom,L=O==null?b(N):typeof O=="function"?O.apply(this,arguments):O,q=j.invert(L),U=typeof k=="function"?k.apply(this,arguments):k;return n(v(x(j,U),L,q),N,s)},O,T)},y.translateBy=function(w,k,O,T){y.transform(w,function(){return n(this.__zoom.translate(typeof k=="function"?k.apply(this,arguments):k,typeof O=="function"?O.apply(this,arguments):O),e.apply(this,arguments),s)},null,T)},y.translateTo=function(w,k,O,T,N){y.transform(w,function(){var j=e.apply(this,arguments),L=this.__zoom,q=T==null?b(j):typeof T=="function"?T.apply(this,arguments):T;return n(nr.translate(q[0],q[1]).scale(L.k).translate(typeof k=="function"?-k.apply(this,arguments):-k,typeof O=="function"?-O.apply(this,arguments):-O),j,s)},T,N)};function x(w,k){return k=Math.max(o[0],Math.min(o[1],k)),k===w.k?w:new tt(k,w.x,w.y)}function v(w,k,O){var T=k[0]-O[0]*w.k,N=k[1]-O[1]*w.k;return T===w.x&&N===w.y?w:new tt(w.k,T,N)}function b(w){return[(+w[0][0]+ +w[1][0])/2,(+w[0][1]+ +w[1][1])/2]}function M(w,k,O,T){w.on("start.zoom",function(){C(this,arguments).event(T).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(T).end()}).tween("zoom",function(){var N=this,j=arguments,L=C(N,j).event(T),q=e.apply(N,j),U=O==null?b(q):typeof O=="function"?O.apply(N,j):O,V=Math.max(q[1][0]-q[0][0],q[1][1]-q[0][1]),Y=N.__zoom,X=typeof k=="function"?k.apply(N,j):k,K=c(Y.invert(U).concat(V/Y.k),X.invert(U).concat(V/X.k));return function(ne){if(ne===1)ne=X;else{var W=K(ne),ie=V/W[2];ne=new tt(ie,U[0]-W[0]*ie,U[1]-W[1]*ie)}L.zoom(null,ne)}})}function C(w,k,O){return!O&&w.__zooming||new E(w,k)}function E(w,k){this.that=w,this.args=k,this.active=0,this.sourceEvent=null,this.extent=e.apply(w,k),this.taps=0}E.prototype={event:function(w){return w&&(this.sourceEvent=w),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(w,k){return this.mouse&&w!=="mouse"&&(this.mouse[1]=k.invert(this.mouse[0])),this.touch0&&w!=="touch"&&(this.touch0[1]=k.invert(this.touch0[0])),this.touch1&&w!=="touch"&&(this.touch1[1]=k.invert(this.touch1[0])),this.that.__zoom=k,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(w){var k=Ie(this.that).datum();l.call(w,this.that,new Y0(w,{sourceEvent:this.sourceEvent,target:y,type:w,transform:this.that.__zoom,dispatch:l}),k)}};function A(w,...k){if(!t.apply(this,arguments))return;var O=C(this,k).event(w),T=this.__zoom,N=Math.max(o[0],Math.min(o[1],T.k*Math.pow(2,r.apply(this,arguments)))),j=Le(w);if(O.wheel)(O.mouse[0][0]!==j[0]||O.mouse[0][1]!==j[1])&&(O.mouse[1]=T.invert(O.mouse[0]=j)),clearTimeout(O.wheel);else{if(T.k===N)return;O.mouse=[j,T.invert(j)],er(this),O.start()}un(w),O.wheel=setTimeout(L,m),O.zoom("mouse",n(v(x(T,N),O.mouse[0],O.mouse[1]),O.extent,s));function L(){O.wheel=null,O.end()}}function R(w,...k){if(h||!t.apply(this,arguments))return;var O=w.currentTarget,T=C(this,k,!0).event(w),N=Ie(w.view).on("mousemove.zoom",U,!0).on("mouseup.zoom",V,!0),j=Le(w,O),L=w.clientX,q=w.clientY;Dc(w.view),hi(w),T.mouse=[j,this.__zoom.invert(j)],er(this),T.start();function U(Y){if(un(Y),!T.moved){var X=Y.clientX-L,K=Y.clientY-q;T.moved=X*X+K*K>f}T.event(Y).zoom("mouse",n(v(T.that.__zoom,T.mouse[0]=Le(Y,O),T.mouse[1]),T.extent,s))}function V(Y){N.on("mousemove.zoom mouseup.zoom",null),Lc(Y.view,T.moved),un(Y),T.event(Y).end()}}function B(w,...k){if(t.apply(this,arguments)){var O=this.__zoom,T=Le(w.changedTouches?w.changedTouches[0]:w,this),N=O.invert(T),j=O.k*(w.shiftKey?.5:2),L=n(v(x(O,j),T,N),e.apply(this,k),s);un(w),a>0?Ie(this).transition().duration(a).call(M,L,T,w):Ie(this).call(y.transform,L,T,w)}}function $(w,...k){if(t.apply(this,arguments)){var O=w.touches,T=O.length,N=C(this,k,w.changedTouches.length===T).event(w),j,L,q,U;for(hi(w),L=0;L<T;++L)q=O[L],U=Le(q,this),U=[U,this.__zoom.invert(U),q.identifier],N.touch0?!N.touch1&&N.touch0[2]!==U[2]&&(N.touch1=U,N.taps=0):(N.touch0=U,j=!0,N.taps=1+!!d);d&&(d=clearTimeout(d)),j&&(N.taps<2&&(u=U[0],d=setTimeout(function(){d=null},p)),er(this),N.start())}}function F(w,...k){if(this.__zooming){var O=C(this,k).event(w),T=w.changedTouches,N=T.length,j,L,q,U;for(un(w),j=0;j<N;++j)L=T[j],q=Le(L,this),O.touch0&&O.touch0[2]===L.identifier?O.touch0[0]=q:O.touch1&&O.touch1[2]===L.identifier&&(O.touch1[0]=q);if(L=O.that.__zoom,O.touch1){var V=O.touch0[0],Y=O.touch0[1],X=O.touch1[0],K=O.touch1[1],ne=(ne=X[0]-V[0])*ne+(ne=X[1]-V[1])*ne,W=(W=K[0]-Y[0])*W+(W=K[1]-Y[1])*W;L=x(L,Math.sqrt(ne/W)),q=[(V[0]+X[0])/2,(V[1]+X[1])/2],U=[(Y[0]+K[0])/2,(Y[1]+K[1])/2]}else if(O.touch0)q=O.touch0[0],U=O.touch0[1];else return;O.zoom("touch",n(v(L,q,U),O.extent,s))}}function D(w,...k){if(this.__zooming){var O=C(this,k).event(w),T=w.changedTouches,N=T.length,j,L;for(hi(w),h&&clearTimeout(h),h=setTimeout(function(){h=null},p),j=0;j<N;++j)L=T[j],O.touch0&&O.touch0[2]===L.identifier?delete O.touch0:O.touch1&&O.touch1[2]===L.identifier&&delete O.touch1;if(O.touch1&&!O.touch0&&(O.touch0=O.touch1,delete O.touch1),O.touch0)O.touch0[1]=this.__zoom.invert(O.touch0[0]);else if(O.end(),O.taps===2&&(L=Le(L,this),Math.hypot(u[0]-L[0],u[1]-L[1])<g)){var q=Ie(this).on("dblclick.zoom");q&&q.apply(this,arguments)}}}return y.wheelDelta=function(w){return arguments.length?(r=typeof w=="function"?w:tr(+w),y):r},y.filter=function(w){return arguments.length?(t=typeof w=="function"?w:tr(!!w),y):t},y.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:tr(!!w),y):i},y.extent=function(w){return arguments.length?(e=typeof w=="function"?w:tr([[+w[0][0],+w[0][1]],[+w[1][0],+w[1][1]]]),y):e},y.scaleExtent=function(w){return arguments.length?(o[0]=+w[0],o[1]=+w[1],y):[o[0],o[1]]},y.translateExtent=function(w){return arguments.length?(s[0][0]=+w[0][0],s[1][0]=+w[1][0],s[0][1]=+w[0][1],s[1][1]=+w[1][1],y):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},y.constrain=function(w){return arguments.length?(n=w,y):n},y.duration=function(w){return arguments.length?(a=+w,y):a},y.interpolate=function(w){return arguments.length?(c=w,y):c},y.on=function(){var w=l.on.apply(l,arguments);return w===l?y:w},y.clickDistance=function(w){return arguments.length?(f=(w=+w)*w,y):Math.sqrt(f)},y.tapDistance=function(w){return arguments.length?(g=+w,y):g},y}const nt={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`},dn=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],gl=["Enter"," ","Escape"];var It;(function(t){t.Strict="strict",t.Loose="loose"})(It||(It={})),function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"}(pt||(pt={}));var hn;(function(t){t.Partial="partial",t.Full="full"})(hn||(hn={}));const vl={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var at;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(at||(at={}));var rr;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(rr||(rr={})),function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"}(re||(re={}));const xl={[re.Left]:re.Right,[re.Right]:re.Left,[re.Top]:re.Bottom,[re.Bottom]:re.Top};function e1(t,e){if(!t&&!e)return!0;if(!t||!e||t.size!==e.size)return!1;if(!t.size&&!e.size)return!0;for(const n of t.keys())if(!e.has(n))return!1;return!0}function bl(t,e,n){if(!n)return;const r=[];t.forEach((i,o)=>{e!=null&&e.has(o)||r.push(i)}),r.length&&n(r)}function wl(t){return t===null?null:t?"valid":"invalid"}const Ml=t=>"id"in t&&"source"in t&&"target"in t,t1=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),pi=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),pn=(t,e=[0,0])=>{const{width:n,height:r}=rt(t),i=t.origin??e,o=n*i[0],s=r*i[1];return{x:t.position.x-o,y:t.position.y-s}},n1=(t,e={nodeOrigin:[0,0],nodeLookup:void 0})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,i)=>{const o=typeof i=="string";let s=!e.nodeLookup&&!o?i:void 0;e.nodeLookup&&(s=o?e.nodeLookup.get(i):pi(i)?i:e.nodeLookup.get(i.id));const a=s?sr(s,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return ir(r,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return or(n)},fn=(t,e={})=>{if(t.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return t.forEach(r=>{if(e.filter===void 0||e.filter(r)){const i=sr(r);n=ir(n,i)}}),or(n)},El=(t,e,[n,r,i]=[0,0,1],o=!1,s=!1)=>{const a={...yn(e,[n,r,i]),width:e.width/i,height:e.height/i},c=[];for(const l of t.values()){const{measured:d,selectable:u=!0,hidden:h=!1}=l;if(s&&!u||h)continue;const p=d.width??l.width??l.initialWidth??null,m=d.height??l.height??l.initialHeight??null,f=mn(a,$t(l)),g=(p??0)*(m??0),y=o&&f>0;(!l.internals.handleBounds||y||f>=g||l.dragging)&&c.push(l)}return c},r1=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function fi(t,e){const n=new Map,r=e!=null&&e.nodes?new Set(e.nodes.map(i=>i.id)):null;return t.forEach(i=>{i.measured.width&&i.measured.height&&(e!=null&&e.includeHiddenNodes||!i.hidden)&&(!r||r.has(i.id))&&n.set(i.id,i)}),n}async function mi({nodes:t,width:e,height:n,panZoom:r,minZoom:i,maxZoom:o},s){if(t.size===0)return Promise.resolve(!1);const a=fn(t),c=gi(a,e,n,(s==null?void 0:s.minZoom)??i,(s==null?void 0:s.maxZoom)??o,(s==null?void 0:s.padding)??.1);return await r.setViewport(c,{duration:s==null?void 0:s.duration}),Promise.resolve(!0)}function _l({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:i,onError:o}){const s=n.get(t),a=s.parentId?n.get(s.parentId):void 0,{x:c,y:l}=a?a.internals.positionAbsolute:{x:0,y:0},d=s.origin??r;let u=i;if(s.extent==="parent"&&!s.expandParent)if(!a)o==null||o("005",nt.error005());else{const p=a.measured.width,m=a.measured.height;p&&m&&(u=[[c,l],[c+p,l+m]])}else a&&Dt(s.extent)&&(u=[[s.extent[0][0]+c,s.extent[0][1]+l],[s.extent[1][0]+c,s.extent[1][1]+l]]);const h=Dt(u)?gt(e,u,s.measured):e;return{position:{x:h.x-c+s.measured.width*d[0],y:h.y-l+s.measured.height*d[1]},positionAbsolute:h}}async function i1({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:i}){const o=new Set(t.map(u=>u.id)),s=[];for(const u of n){if(u.deletable===!1)continue;const h=o.has(u.id),p=!h&&u.parentId&&s.find(m=>m.id===u.parentId);(h||p)&&s.push(u)}const a=new Set(e.map(u=>u.id)),c=r.filter(u=>u.deletable!==!1),l=r1(s,c);for(const u of c)a.has(u.id)&&!l.find(h=>h.id===u.id)&&l.push(u);if(!i)return{edges:l,nodes:s};const d=await i({nodes:s,edges:l});return typeof d=="boolean"?d?{edges:l,nodes:s}:{edges:[],nodes:[]}:d}const Bt=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),gt=(t={x:0,y:0},e,n)=>({x:Bt(t.x,e[0][0],e[1][0]-((n==null?void 0:n.width)??0)),y:Bt(t.y,e[0][1],e[1][1]-((n==null?void 0:n.height)??0))});function Cl(t,e,n){const{width:r,height:i}=rt(n),{x:o,y:s}=n.internals.positionAbsolute;return gt(t,[[o,s],[o+r,s+i]],e)}const Sl=(t,e,n)=>t<e?Bt(Math.abs(t-e),1,e)/e:t>n?-Bt(Math.abs(t-n),1,e)/e:0,Ol=(t,e,n=15,r=40)=>{const i=Sl(t.x,r,e.width-r)*n,o=Sl(t.y,r,e.height-r)*n;return[i,o]},ir=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),yi=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),or=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),$t=(t,e=[0,0])=>{var i,o;const{x:n,y:r}=pi(t)?t.internals.positionAbsolute:pn(t,e);return{x:n,y:r,width:((i=t.measured)==null?void 0:i.width)??t.width??t.initialWidth??0,height:((o=t.measured)==null?void 0:o.height)??t.height??t.initialHeight??0}},sr=(t,e=[0,0])=>{var i,o;const{x:n,y:r}=pi(t)?t.internals.positionAbsolute:pn(t,e);return{x:n,y:r,x2:n+(((i=t.measured)==null?void 0:i.width)??t.width??t.initialWidth??0),y2:r+(((o=t.measured)==null?void 0:o.height)??t.height??t.initialHeight??0)}},Nl=(t,e)=>or(ir(yi(t),yi(e))),mn=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},Pl=t=>Ve(t.width)&&Ve(t.height)&&Ve(t.x)&&Ve(t.y),Ve=t=>!isNaN(t)&&isFinite(t),o1=(t,e)=>{},ar=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),yn=({x:t,y:e},[n,r,i],o=!1,s=[1,1])=>{const a={x:(t-n)/i,y:(e-r)/i};return o?ar(a,s):a},Al=({x:t,y:e},[n,r,i])=>({x:t*i+n,y:e*i+r}),gi=(t,e,n,r,i,o)=>{const s=e/(t.width*(1+o)),a=n/(t.height*(1+o)),c=Math.min(s,a),l=Bt(c,r,i),d=t.x+t.width/2,u=t.y+t.height/2,h=e/2-d*l,p=n/2-u*l;return{x:h,y:p,zoom:l}},cr=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function Dt(t){return t!==void 0&&t!=="parent"}function rt(t){var e,n;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight??0}}function kl(t){var e,n;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight)!==void 0}function Tl(t,e={width:0,height:0},n,r,i){const o={...t},s=r.get(n);if(s){const a=s.origin||i;o.x+=s.internals.positionAbsolute.x-(e.width??0)*a[0],o.y+=s.internals.positionAbsolute.y-(e.height??0)*a[1]}return o}function gn(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:i}){const{x:o,y:s}=it(t),a=yn({x:o-((i==null?void 0:i.left)??0),y:s-((i==null?void 0:i.top)??0)},r),{x:c,y:l}=n?ar(a,e):a;return{xSnapped:c,ySnapped:l,...a}}const lr=t=>({width:t.offsetWidth,height:t.offsetHeight}),jl=t=>{var e;return((e=t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},s1=["INPUT","SELECT","TEXTAREA"];function vi(t){var n,r;const e=((r=(n=t.composedPath)==null?void 0:n.call(t))==null?void 0:r[0])||t.target;return s1.includes(e==null?void 0:e.nodeName)||(e==null?void 0:e.hasAttribute("contenteditable"))||!!(e!=null&&e.closest(".nokey"))}const Rl=t=>"clientX"in t,it=(t,e)=>{var o,s;const n=Rl(t),r=n?t.clientX:(o=t.touches)==null?void 0:o[0].clientX,i=n?t.clientY:(s=t.touches)==null?void 0:s[0].clientY;return{x:r-((e==null?void 0:e.left)??0),y:i-((e==null?void 0:e.top)??0)}},Il=(t,e,n,r,i)=>{const o=e.querySelectorAll(`.${t}`);return!o||!o.length?null:Array.from(o).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:t,nodeId:i,position:s.getAttribute("data-handlepos"),x:(a.left-n.left)/r,y:(a.top-n.top)/r,...lr(s)}})};function Bl({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:i,sourceControlY:o,targetControlX:s,targetControlY:a}){const c=t*.125+i*.375+s*.375+n*.125,l=e*.125+o*.375+a*.375+r*.125,d=Math.abs(c-t),u=Math.abs(l-e);return[c,l,d,u]}function ur(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function $l({pos:t,x1:e,y1:n,x2:r,y2:i,c:o}){switch(t){case re.Left:return[e-ur(e-r,o),n];case re.Right:return[e+ur(r-e,o),n];case re.Top:return[e,n-ur(n-i,o)];case re.Bottom:return[e,n+ur(i-n,o)]}}function Dl({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top,curvature:s=.25}){const[a,c]=$l({pos:n,x1:t,y1:e,x2:r,y2:i,c:s}),[l,d]=$l({pos:o,x1:r,y1:i,x2:t,y2:e,c:s}),[u,h,p,m]=Bl({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:a,sourceControlY:c,targetControlX:l,targetControlY:d});return[`M${t},${e} C${a},${c} ${l},${d} ${r},${i}`,u,h,p,m]}function Ll({sourceX:t,sourceY:e,targetX:n,targetY:r}){const i=Math.abs(n-t)/2,o=n<t?n+i:n-i,s=Math.abs(r-e)/2,a=r<e?r+s:r-s;return[o,a,i,s]}function a1({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:i=!1}){if(!i)return r;const o=n||e.selected||t.selected,s=Math.max(t.internals.z||0,e.internals.z||0,1e3);return r+(o?s:0)}function c1({sourceNode:t,targetNode:e,width:n,height:r,transform:i}){const o=ir(sr(t),sr(e));o.x===o.x2&&(o.x2+=1),o.y===o.y2&&(o.y2+=1);const s={x:-i[0]/i[2],y:-i[1]/i[2],width:n/i[2],height:r/i[2]};return mn(s,or(o))>0}const l1=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,u1=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),Fl=(t,e)=>{if(!t.source||!t.target)return e;let n;return Ml(t)?n={...t}:n={...t,id:l1(t)},u1(n,e)?e:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,e.concat(n))};function zl({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[i,o,s,a]=Ll({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,i,o,s,a]}const Vl={[re.Left]:{x:-1,y:0},[re.Right]:{x:1,y:0},[re.Top]:{x:0,y:-1},[re.Bottom]:{x:0,y:1}},d1=({source:t,sourcePosition:e=re.Bottom,target:n})=>e===re.Left||e===re.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},ql=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function h1({source:t,sourcePosition:e=re.Bottom,target:n,targetPosition:r=re.Top,center:i,offset:o}){const s=Vl[e],a=Vl[r],c={x:t.x+s.x*o,y:t.y+s.y*o},l={x:n.x+a.x*o,y:n.y+a.y*o},d=d1({source:c,sourcePosition:e,target:l}),u=d.x!==0?"x":"y",h=d[u];let p=[],m,f;const g={x:0,y:0},y={x:0,y:0},[x,v,b,M]=Ll({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(s[u]*a[u]===-1){m=i.x??x,f=i.y??v;const C=[{x:m,y:c.y},{x:m,y:l.y}],E=[{x:c.x,y:f},{x:l.x,y:f}];s[u]===h?p=u==="x"?C:E:p=u==="x"?E:C}else{const C=[{x:c.x,y:l.y}],E=[{x:l.x,y:c.y}];if(u==="x"?p=s.x===h?E:C:p=s.y===h?C:E,e===r){const F=Math.abs(t[u]-n[u]);if(F<=o){const D=Math.min(o-1,o-F);s[u]===h?g[u]=(c[u]>t[u]?-1:1)*D:y[u]=(l[u]>n[u]?-1:1)*D}}if(e!==r){const F=u==="x"?"y":"x",D=s[u]===a[F],w=c[F]>l[F],k=c[F]<l[F];(s[u]===1&&(!D&&w||D&&k)||s[u]!==1&&(!D&&k||D&&w))&&(p=u==="x"?C:E)}const A={x:c.x+g.x,y:c.y+g.y},R={x:l.x+y.x,y:l.y+y.y},B=Math.max(Math.abs(A.x-p[0].x),Math.abs(R.x-p[0].x)),$=Math.max(Math.abs(A.y-p[0].y),Math.abs(R.y-p[0].y));B>=$?(m=(A.x+R.x)/2,f=p[0].y):(m=p[0].x,f=(A.y+R.y)/2)}return[[t,{x:c.x+g.x,y:c.y+g.y},...p,{x:l.x+y.x,y:l.y+y.y},n],m,f,b,M]}function p1(t,e,n,r){const i=Math.min(ql(t,e)/2,ql(e,n)/2,r),{x:o,y:s}=e;if(t.x===o&&o===n.x||t.y===s&&s===n.y)return`L${o} ${s}`;if(t.y===s){const l=t.x<n.x?-1:1,d=t.y<n.y?1:-1;return`L ${o+i*l},${s}Q ${o},${s} ${o},${s+i*d}`}const a=t.x<n.x?1:-1,c=t.y<n.y?-1:1;return`L ${o},${s+i*c}Q ${o},${s} ${o+i*a},${s}`}function xi({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top,borderRadius:s=5,centerX:a,centerY:c,offset:l=20}){const[d,u,h,p,m]=h1({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:i},targetPosition:o,center:{x:a,y:c},offset:l});return[d.reduce((f,g,y)=>{let x="";return y>0&&y<d.length-1?x=p1(d[y-1],g,d[y+1],s):x=`${y===0?"M":"L"}${g.x} ${g.y}`,f+=x,f},""),u,h,p,m]}function Wl(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function f1(t){var u;const{sourceNode:e,targetNode:n}=t;if(!Wl(e)||!Wl(n))return null;const r=e.internals.handleBounds||Hl(e.handles),i=n.internals.handleBounds||Hl(n.handles),o=Ul((r==null?void 0:r.source)??[],t.sourceHandle),s=Ul(t.connectionMode===It.Strict?(i==null?void 0:i.target)??[]:((i==null?void 0:i.target)??[]).concat((i==null?void 0:i.source)??[]),t.targetHandle);if(!o||!s)return(u=t.onError)==null||u.call(t,"008",nt.error008(o?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const a=(o==null?void 0:o.position)||re.Bottom,c=(s==null?void 0:s.position)||re.Top,l=vn(e,o,a),d=vn(n,s,c);return{sourceX:l.x,sourceY:l.y,targetX:d.x,targetY:d.y,sourcePosition:a,targetPosition:c}}function Hl(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function vn(t,e,n=re.Left,r=!1){const i=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,o=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:s,height:a}=e??rt(t);if(r)return{x:i+s/2,y:o+a/2};switch((e==null?void 0:e.position)??n){case re.Top:return{x:i+s/2,y:o};case re.Right:return{x:i+s,y:o+a/2};case re.Bottom:return{x:i+s/2,y:o+a};case re.Left:return{x:i,y:o+a/2}}}function Ul(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function bi(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(n=>`${n}=${t[n]}`).join("&")}`:""}function m1(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:i}){const o=new Set;return t.reduce((s,a)=>([a.markerStart||r,a.markerEnd||i].forEach(c=>{if(c&&typeof c=="object"){const l=bi(c,e);o.has(l)||(s.push({id:l,color:c.color||n,...c}),o.add(l))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const wi={nodeOrigin:[0,0],nodeExtent:dn,elevateNodesOnSelect:!0,defaults:{}},y1={...wi,checkEquality:!0};function Mi(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function g1(t,e,n){const r=Mi(wi,n);for(const i of t.values())if(i.parentId)_i(i,t,e,r);else{const o=pn(i,r.nodeOrigin),s=Dt(i.extent)?i.extent:r.nodeExtent,a=gt(o,s,rt(i));i.internals.positionAbsolute=a}}function Ei(t,e,n,r){var a,c;const i=Mi(y1,r),o=new Map(e),s=i!=null&&i.elevateNodesOnSelect?1e3:0;e.clear(),n.clear();for(const l of t){let d=o.get(l.id);if(i.checkEquality&&l===(d==null?void 0:d.internals.userNode))e.set(l.id,d);else{const u=pn(l,i.nodeOrigin),h=Dt(l.extent)?l.extent:i.nodeExtent,p=gt(u,h,rt(l));d={...i.defaults,...l,measured:{width:(a=l.measured)==null?void 0:a.width,height:(c=l.measured)==null?void 0:c.height},internals:{positionAbsolute:p,handleBounds:l.measured?d==null?void 0:d.internals.handleBounds:void 0,z:Ql(l,s),userNode:l}},e.set(l.id,d)}l.parentId&&_i(d,e,n,r)}}function v1(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function _i(t,e,n,r){const{elevateNodesOnSelect:i,nodeOrigin:o,nodeExtent:s}=Mi(wi,r),a=t.parentId,c=e.get(a);if(!c){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}v1(t,n);const l=i?1e3:0,{x:d,y:u,z:h}=x1(t,c,o,s,l),{positionAbsolute:p}=t.internals,m=d!==p.x||u!==p.y;(m||h!==t.internals.z)&&(t.internals={...t.internals,positionAbsolute:m?{x:d,y:u}:p,z:h})}function Ql(t,e){return(Ve(t.zIndex)?t.zIndex:0)+(t.selected?e:0)}function x1(t,e,n,r,i){const{x:o,y:s}=e.internals.positionAbsolute,a=rt(t),c=pn(t,n),l=Dt(t.extent)?gt(c,t.extent,a):c;let d=gt({x:o+l.x,y:s+l.y},r,a);t.extent==="parent"&&(d=Cl(d,a,e));const u=Ql(t,i),h=e.internals.z??0;return{x:d.x,y:d.y,z:h>u?h:u}}function Ci(t,e,n,r=[0,0]){var s;const i=[],o=new Map;for(const a of t){const c=e.get(a.parentId);if(!c)continue;const l=((s=o.get(a.parentId))==null?void 0:s.expandedRect)??$t(c),d=Nl(l,a.rect);o.set(a.parentId,{expandedRect:d,parent:c})}return o.size>0&&o.forEach(({expandedRect:a,parent:c},l)=>{var v;const d=c.internals.positionAbsolute,u=rt(c),h=c.origin??r,p=a.x<d.x?Math.round(Math.abs(d.x-a.x)):0,m=a.y<d.y?Math.round(Math.abs(d.y-a.y)):0,f=Math.max(u.width,Math.round(a.width)),g=Math.max(u.height,Math.round(a.height)),y=(f-u.width)*h[0],x=(g-u.height)*h[1];(p>0||m>0||y||x)&&(i.push({id:l,type:"position",position:{x:c.position.x-p+y,y:c.position.y-m+x}}),(v=n.get(l))==null||v.forEach(b=>{t.some(M=>M.id===b.id)||i.push({id:b.id,type:"position",position:{x:b.position.x+p,y:b.position.y+m}})})),(u.width<a.width||u.height<a.height||p||m)&&i.push({id:l,type:"dimensions",setAttributes:!0,dimensions:{width:f+(p?h[0]*p-y:0),height:g+(m?h[1]*m-x:0)}})}),i}function b1(t,e,n,r,i,o){const s=r==null?void 0:r.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const c=[],l=window.getComputedStyle(s),{m22:d}=new window.DOMMatrixReadOnly(l.transform),u=[];for(const h of t.values()){const p=e.get(h.id);if(p)if(p.hidden)p.internals={...p.internals,handleBounds:void 0},a=!0;else{const m=lr(h.nodeElement),f=p.measured.width!==m.width||p.measured.height!==m.height;if(m.width&&m.height&&(f||!p.internals.handleBounds||h.force)){const g=h.nodeElement.getBoundingClientRect(),y=Dt(p.extent)?p.extent:o;let{positionAbsolute:x}=p.internals;p.parentId&&p.extent==="parent"?x=Cl(x,m,e.get(p.parentId)):y&&(x=gt(x,y,m)),p.measured=m,p.internals={...p.internals,positionAbsolute:x,handleBounds:{source:Il("source",h.nodeElement,g,d,p.id),target:Il("target",h.nodeElement,g,d,p.id)}},p.parentId&&_i(p,e,n,{nodeOrigin:i}),a=!0,f&&(c.push({id:p.id,type:"dimensions",dimensions:m}),p.expandParent&&p.parentId&&u.push({id:p.id,parentId:p.parentId,rect:$t(p,i)}))}}}if(u.length>0){const h=Ci(u,e,n,i);c.push(...h)}return{changes:c,updatedInternals:a}}async function w1({delta:t,panZoom:e,transform:n,translateExtent:r,width:i,height:o}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const s=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[i,o]],r),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}function Yl(t,e,n){t.clear(),e.clear();for(const r of n){const{source:i,target:o,sourceHandle:s=null,targetHandle:a=null}=r,c=`${i}-source-${s}`,l=`${o}-target-${a}`,d=t.get(c)||new Map,u=t.get(l)||new Map,h={edgeId:r.id,source:i,target:o,sourceHandle:s,targetHandle:a};e.set(r.id,r),t.set(c,d.set(`${o}-${a}`,h)),t.set(l,u.set(`${i}-${s}`,h))}}function Zl(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:Zl(n,e):!1}function Gl(t,e,n){let r=t;do{if(r!=null&&r.matches(e))return!0;if(r===n)return!1;r=r.parentElement}while(r);return!1}function M1(t,e,n,r){const i=new Map;for(const[o,s]of t)if((s.selected||s.id===r)&&(!s.parentId||!Zl(s,t))&&(s.draggable||e&&typeof s.draggable>"u")){const a=t.get(o);a&&i.set(o,{id:o,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return i}function Si({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){var s,a,c;const i=[];for(const[l,d]of e){const u=(s=n.get(l))==null?void 0:s.internals.userNode;u&&i.push({...u,position:d.position,dragging:r})}if(!t)return[i[0],i];const o=(a=n.get(t))==null?void 0:a.internals.userNode;return[o?{...o,position:((c=e.get(t))==null?void 0:c.position)||o.position,dragging:r}:i[0],i]}function E1({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:i}){let o={x:null,y:null},s=0,a=new Map,c=!1,l={x:0,y:0},d=null,u=!1,h=null,p=!1;function m({noDragClassName:g,handleSelector:y,domNode:x,isSelectable:v,nodeId:b,nodeClickDistance:M=0}){h=Ie(x);function C({x:B,y:$},F){const{nodeLookup:D,nodeExtent:w,snapGrid:k,snapToGrid:O,nodeOrigin:T,onNodeDrag:N,onSelectionDrag:j,onError:L,updateNodePositions:q}=e();o={x:B,y:$};let U=!1,V={x:0,y:0,x2:0,y2:0};if(a.size>1&&w){const Y=fn(a);V=yi(Y)}for(const[Y,X]of a){if(!D.has(Y))continue;let K={x:B-X.distance.x,y:$-X.distance.y};O&&(K=ar(K,k));let ne=[[w[0][0],w[0][1]],[w[1][0],w[1][1]]];if(a.size>1&&w&&!X.extent){const{positionAbsolute:ce}=X.internals,oe=ce.x-V.x+w[0][0],ae=ce.x+X.measured.width-V.x2+w[1][0],he=ce.y-V.y+w[0][1],pe=ce.y+X.measured.height-V.y2+w[1][1];ne=[[oe,he],[ae,pe]]}const{position:W,positionAbsolute:ie}=_l({nodeId:Y,nextPosition:K,nodeLookup:D,nodeExtent:ne,nodeOrigin:T,onError:L});U=U||X.position.x!==W.x||X.position.y!==W.y,X.position=W,X.internals.positionAbsolute=ie}if(U&&(q(a,!0),F&&(r||N||!b&&j))){const[Y,X]=Si({nodeId:b,dragItems:a,nodeLookup:D});r==null||r(F,a,Y,X),N==null||N(F,Y,X),b||(j==null||j(F,X))}}async function E(){if(!d)return;const{transform:B,panBy:$,autoPanSpeed:F}=e(),[D,w]=Ol(l,d,F);(D!==0||w!==0)&&(o.x=(o.x??0)-D/B[2],o.y=(o.y??0)-w/B[2],await $({x:D,y:w})&&C(o,null)),s=requestAnimationFrame(E)}function A(B){var U;const{nodeLookup:$,multiSelectionActive:F,nodesDraggable:D,transform:w,snapGrid:k,snapToGrid:O,selectNodesOnDrag:T,onNodeDragStart:N,onSelectionDragStart:j,unselectNodesAndEdges:L}=e();u=!0,(!T||!v)&&!F&&b&&((U=$.get(b))!=null&&U.selected||L()),v&&T&&b&&(t==null||t(b));const q=gn(B.sourceEvent,{transform:w,snapGrid:k,snapToGrid:O,containerBounds:d});if(o=q,a=M1($,D,q,b),a.size>0&&(n||N||!b&&j)){const[V,Y]=Si({nodeId:b,dragItems:a,nodeLookup:$});n==null||n(B.sourceEvent,a,V,Y),N==null||N(B.sourceEvent,V,Y),b||(j==null||j(B.sourceEvent,Y))}}const R=Fc().clickDistance(M).on("start",B=>{const{domNode:$,nodeDragThreshold:F,transform:D,snapGrid:w,snapToGrid:k}=e();d=($==null?void 0:$.getBoundingClientRect())||null,p=!1,F===0&&A(B),o=gn(B.sourceEvent,{transform:D,snapGrid:w,snapToGrid:k,containerBounds:d}),l=it(B.sourceEvent,d)}).on("drag",B=>{const{autoPanOnNodeDrag:$,transform:F,snapGrid:D,snapToGrid:w,nodeDragThreshold:k,nodeLookup:O}=e(),T=gn(B.sourceEvent,{transform:F,snapGrid:D,snapToGrid:w,containerBounds:d});if((B.sourceEvent.type==="touchmove"&&B.sourceEvent.touches.length>1||b&&!O.has(b))&&(p=!0),!p){if(!c&&$&&u&&(c=!0,E()),!u){const N=T.xSnapped-(o.x??0),j=T.ySnapped-(o.y??0);Math.sqrt(N*N+j*j)>k&&A(B)}(o.x!==T.xSnapped||o.y!==T.ySnapped)&&a&&u&&(l=it(B.sourceEvent,d),C(T,B.sourceEvent))}}).on("end",B=>{if(!(!u||p)&&(c=!1,u=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:$,updateNodePositions:F,onNodeDragStop:D,onSelectionDragStop:w}=e();if(F(a,!1),i||D||!b&&w){const[k,O]=Si({nodeId:b,dragItems:a,nodeLookup:$,dragging:!1});i==null||i(B.sourceEvent,a,k,O),D==null||D(B.sourceEvent,k,O),b||(w==null||w(B.sourceEvent,O))}}}).filter(B=>{const $=B.target;return!B.button&&(!g||!Gl($,`.${g}`,x))&&(!y||Gl($,y,x))});h.call(R)}function f(){h==null||h.on(".drag",null)}return{update:m,destroy:f}}function _1(t,e,n){const r=[],i={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const o of e.values())mn(i,$t(o))>0&&r.push(o);return r}const C1=250;function S1(t,e,n,r){var a,c;let i=[],o=1/0;const s=_1(t,n,e+C1);for(const l of s){const d=[...((a=l.internals.handleBounds)==null?void 0:a.source)??[],...((c=l.internals.handleBounds)==null?void 0:c.target)??[]];for(const u of d){if(r.nodeId===u.nodeId&&r.type===u.type&&r.id===u.id)continue;const{x:h,y:p}=vn(l,u,u.position,!0),m=Math.sqrt(Math.pow(h-t.x,2)+Math.pow(p-t.y,2));m>e||(m<o?(i=[{...u,x:h,y:p}],o=m):m===o&&i.push({...u,x:h,y:p}))}}if(!i.length)return null;if(i.length>1){const l=r.type==="source"?"target":"source";return i.find(d=>d.type===l)??i[0]}return i[0]}function Xl(t,e,n,r,i,o=!1){var l,d,u;const s=r.get(t);if(!s)return null;const a=i==="strict"?(l=s.internals.handleBounds)==null?void 0:l[e]:[...((d=s.internals.handleBounds)==null?void 0:d.source)??[],...((u=s.internals.handleBounds)==null?void 0:u.target)??[]],c=(n?a==null?void 0:a.find(h=>h.id===n):a==null?void 0:a[0])??null;return c&&o?{...c,...vn(s,c,c.position,!0)}:c}function Kl(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function O1(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const Jl=()=>!0;function N1(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:i,edgeUpdaterType:o,isTarget:s,domNode:a,nodeLookup:c,lib:l,autoPanOnConnect:d,flowId:u,panBy:h,cancelConnection:p,onConnectStart:m,onConnect:f,onConnectEnd:g,isValidConnection:y=Jl,onReconnectEnd:x,updateConnection:v,getTransform:b,getFromHandle:M,autoPanSpeed:C}){const E=jl(t.target);let A=0,R;const{x:B,y:$}=it(t),F=E==null?void 0:E.elementFromPoint(B,$),D=Kl(o,F),w=a==null?void 0:a.getBoundingClientRect();if(!w||!D)return;const k=Xl(i,D,r,c,e);if(!k)return;let O=it(t,w),T=!1,N=null,j=!1,L=null;function q(){if(!d||!w)return;const[W,ie]=Ol(O,w,C);h({x:W,y:ie}),A=requestAnimationFrame(q)}const U={...k,nodeId:i,type:D,position:k.position},V=c.get(i),Y={inProgress:!0,isValid:null,from:vn(V,U,re.Left,!0),fromHandle:U,fromPosition:U.position,fromNode:V,to:O,toHandle:null,toPosition:xl[U.position],toNode:null};v(Y);let X=Y;m==null||m(t,{nodeId:i,handleId:r,handleType:D});function K(W){if(!M()||!U){ne(W);return}const ie=b();O=it(W,w),R=S1(yn(O,ie,!1,[1,1]),n,c,U),T||(q(),T=!0);const ce=eu(W,{handle:R,connectionMode:e,fromNodeId:i,fromHandleId:r,fromType:s?"target":"source",isValidConnection:y,doc:E,lib:l,flowId:u,nodeLookup:c});L=ce.handleDomNode,N=ce.connection,j=O1(!!R,ce.isValid);const oe={...X,isValid:j,to:R&&j?Al({x:R.x,y:R.y},ie):O,toHandle:ce.toHandle,toPosition:j&&ce.toHandle?ce.toHandle.position:xl[U.position],toNode:ce.toHandle?c.get(ce.toHandle.nodeId):null};j&&R&&X.toHandle&&oe.toHandle&&X.toHandle.type===oe.toHandle.type&&X.toHandle.nodeId===oe.toHandle.nodeId&&X.toHandle.id===oe.toHandle.id&&X.to.x===oe.to.x&&X.to.y===oe.to.y||(v(oe),X=oe)}function ne(W){(R||L)&&N&&j&&(f==null||f(N));const{inProgress:ie,...ce}=X,oe={...ce,toPosition:X.toHandle?X.toPosition:null};g==null||g(W,oe),o&&(x==null||x(W,oe)),p(),cancelAnimationFrame(A),T=!1,j=!1,N=null,L=null,E.removeEventListener("mousemove",K),E.removeEventListener("mouseup",ne),E.removeEventListener("touchmove",K),E.removeEventListener("touchend",ne)}E.addEventListener("mousemove",K),E.addEventListener("mouseup",ne),E.addEventListener("touchmove",K),E.addEventListener("touchend",ne)}function eu(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:i,fromType:o,doc:s,lib:a,flowId:c,isValidConnection:l=Jl,nodeLookup:d}){const u=o==="target",h=e?s.querySelector(`.${a}-flow__handle[data-id="${c}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:p,y:m}=it(t),f=s.elementFromPoint(p,m),g=f!=null&&f.classList.contains(`${a}-flow__handle`)?f:h,y={handleDomNode:g,isValid:!1,connection:null,toHandle:null};if(g){const x=Kl(void 0,g),v=g.getAttribute("data-nodeid"),b=g.getAttribute("data-handleid"),M=g.classList.contains("connectable"),C=g.classList.contains("connectableend");if(!v||!x)return y;const E={source:u?v:r,sourceHandle:u?b:i,target:u?r:v,targetHandle:u?i:b};y.connection=E;const A=M&&C&&(n===It.Strict?u&&x==="source"||!u&&x==="target":v!==r||b!==i);y.isValid=A&&l(E),y.toHandle=Xl(v,x,b,d,n,!1)}return y}const Oi={onPointerDown:N1,isValid:eu};function P1({domNode:t,panZoom:e,getTransform:n,getViewScale:r}){const i=Ie(t);function o({translateExtent:a,width:c,height:l,zoomStep:d=10,pannable:u=!0,zoomable:h=!0,inversePan:p=!1}){const m=v=>{const b=n();if(v.sourceEvent.type!=="wheel"||!e)return;const M=-v.sourceEvent.deltaY*(v.sourceEvent.deltaMode===1?.05:v.sourceEvent.deltaMode?1:.002)*d,C=b[2]*Math.pow(2,M);e.scaleTo(C)};let f=[0,0];const g=v=>{(v.sourceEvent.type==="mousedown"||v.sourceEvent.type==="touchstart")&&(f=[v.sourceEvent.clientX??v.sourceEvent.touches[0].clientX,v.sourceEvent.clientY??v.sourceEvent.touches[0].clientY])},y=v=>{const b=n();if(v.sourceEvent.type!=="mousemove"&&v.sourceEvent.type!=="touchmove"||!e)return;const M=[v.sourceEvent.clientX??v.sourceEvent.touches[0].clientX,v.sourceEvent.clientY??v.sourceEvent.touches[0].clientY],C=[M[0]-f[0],M[1]-f[1]];f=M;const E=r()*Math.max(b[2],Math.log(b[2]))*(p?-1:1),A={x:b[0]-C[0]*E,y:b[1]-C[1]*E},R=[[0,0],[c,l]];e.setViewportConstrained({x:A.x,y:A.y,zoom:b[2]},R,a)},x=yl().on("start",g).on("zoom",u?y:null).on("zoom.wheel",h?m:null);i.call(x,{})}function s(){i.on("zoom",null)}return{update:o,destroy:s,pointer:Le}}const A1=(t,e)=>t.x!==e.x||t.y!==e.y||t.zoom!==e.k,dr=t=>({x:t.x,y:t.y,zoom:t.k}),Ni=({x:t,y:e,zoom:n})=>nr.translate(t,e).scale(n),Lt=(t,e)=>t.target.closest(`.${e}`),tu=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),Pi=(t,e=0,n=()=>{})=>{const r=typeof e=="number"&&e>0;return r||n(),r?t.transition().duration(e).on("end",n):t},nu=t=>{const e=t.ctrlKey&&cr()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function k1({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:i,panOnScrollSpeed:o,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:l}){return d=>{if(Lt(d,e))return!1;d.preventDefault(),d.stopImmediatePropagation();const u=n.property("__zoom").k||1;if(d.ctrlKey&&s){const g=Le(d),y=nu(d),x=u*Math.pow(2,y);r.scaleTo(n,x,g,d);return}const h=d.deltaMode===1?20:1;let p=i===pt.Vertical?0:d.deltaX*h,m=i===pt.Horizontal?0:d.deltaY*h;!cr()&&d.shiftKey&&i!==pt.Vertical&&(p=d.deltaY*h,m=0),r.translateBy(n,-(p/u)*o,-(m/u)*o,{internal:!0});const f=dr(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling||(t.isPanScrolling=!0,a==null||a(d,f)),t.isPanScrolling&&(c==null||c(d,f),t.panScrollTimeout=setTimeout(()=>{l==null||l(d,f),t.isPanScrolling=!1},150))}}function T1({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,i){if(!e&&r.type==="wheel"&&!r.ctrlKey||Lt(r,t))return null;r.preventDefault(),n.call(this,r,i)}}function j1({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{var o,s,a;if((o=r.sourceEvent)!=null&&o.internal)return;const i=dr(r.transform);t.mouseButton=((s=r.sourceEvent)==null?void 0:s.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=i,((a=r.sourceEvent)==null?void 0:a.type)==="mousedown"&&e(!0),n&&(n==null||n(r.sourceEvent,i))}}function R1({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:i}){return o=>{var s,a;t.usedRightMouseButton=!!(n&&tu(e,t.mouseButton??0)),(s=o.sourceEvent)!=null&&s.sync||r([o.transform.x,o.transform.y,o.transform.k]),i&&!((a=o.sourceEvent)!=null&&a.internal)&&(i==null||i(o.sourceEvent,dr(o.transform)))}}function I1({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:i,onPaneContextMenu:o}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(t.isZoomingOrPanning=!1,o&&tu(e,t.mouseButton??0)&&!t.usedRightMouseButton&&s.sourceEvent&&o(s.sourceEvent),t.usedRightMouseButton=!1,r(!1),i&&A1(t.prevViewport,s.transform))){const c=dr(s.transform);t.prevViewport=c,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{i==null||i(s.sourceEvent,c)},n?150:0)}}}function B1({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:i,zoomOnDoubleClick:o,userSelectionActive:s,noWheelClassName:a,noPanClassName:c,lib:l}){return d=>{var m;const u=t||e,h=n&&d.ctrlKey;if(d.button===1&&d.type==="mousedown"&&(Lt(d,`${l}-flow__node`)||Lt(d,`${l}-flow__edge`)))return!0;if(!r&&!u&&!i&&!o&&!n||s||Lt(d,a)&&d.type==="wheel"||Lt(d,c)&&(d.type!=="wheel"||i&&d.type==="wheel"&&!t)||!n&&d.ctrlKey&&d.type==="wheel")return!1;if(!n&&d.type==="touchstart"&&((m=d.touches)==null?void 0:m.length)>1)return d.preventDefault(),!1;if(!u&&!i&&!h&&d.type==="wheel"||!r&&(d.type==="mousedown"||d.type==="touchstart")||Array.isArray(r)&&!r.includes(d.button)&&d.type==="mousedown")return!1;const p=Array.isArray(r)&&r.includes(d.button)||!d.button||d.button<=1;return(!d.ctrlKey||d.type==="wheel")&&p}}function $1({domNode:t,minZoom:e,maxZoom:n,paneClickDistance:r,translateExtent:i,viewport:o,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:c,onDraggingChange:l}){const d={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},u=t.getBoundingClientRect(),h=yl().clickDistance(!Ve(r)||r<0?0:r).scaleExtent([e,n]).translateExtent(i),p=Ie(t).call(h);v({x:o.x,y:o.y,zoom:Bt(o.zoom,e,n)},[[0,0],[u.width,u.height]],i);const m=p.on("wheel.zoom"),f=p.on("dblclick.zoom");h.wheelDelta(nu);function g(F,D){return p?new Promise(w=>{h==null||h.transform(Pi(p,D==null?void 0:D.duration,()=>w(!0)),F)}):Promise.resolve(!1)}function y({noWheelClassName:F,noPanClassName:D,onPaneContextMenu:w,userSelectionActive:k,panOnScroll:O,panOnDrag:T,panOnScrollMode:N,panOnScrollSpeed:j,preventScrolling:L,zoomOnPinch:q,zoomOnScroll:U,zoomOnDoubleClick:V,zoomActivationKeyPressed:Y,lib:X,onTransformChange:K}){k&&!d.isZoomingOrPanning&&x();const ne=O&&!Y&&!k?k1({zoomPanValues:d,noWheelClassName:F,d3Selection:p,d3Zoom:h,panOnScrollMode:N,panOnScrollSpeed:j,zoomOnPinch:q,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:c}):T1({noWheelClassName:F,preventScrolling:L,d3ZoomHandler:m});if(p.on("wheel.zoom",ne,{passive:!1}),!k){const ie=j1({zoomPanValues:d,onDraggingChange:l,onPanZoomStart:a});h.on("start",ie);const ce=R1({zoomPanValues:d,panOnDrag:T,onPaneContextMenu:!!w,onPanZoom:s,onTransformChange:K});h.on("zoom",ce);const oe=I1({zoomPanValues:d,panOnDrag:T,panOnScroll:O,onPaneContextMenu:w,onPanZoomEnd:c,onDraggingChange:l});h.on("end",oe)}const W=B1({zoomActivationKeyPressed:Y,panOnDrag:T,zoomOnScroll:U,panOnScroll:O,zoomOnDoubleClick:V,zoomOnPinch:q,userSelectionActive:k,noPanClassName:D,noWheelClassName:F,lib:X});h.filter(W),V?p.on("dblclick.zoom",f):p.on("dblclick.zoom",null)}function x(){h.on("zoom",null)}async function v(F,D,w){const k=Ni(F),O=h==null?void 0:h.constrain()(k,D,w);return O&&await g(O),new Promise(T=>T(O))}async function b(F,D){const w=Ni(F);return await g(w,D),new Promise(k=>k(w))}function M(F){if(p){const D=Ni(F),w=p.property("__zoom");(w.k!==F.zoom||w.x!==F.x||w.y!==F.y)&&(h==null||h.transform(p,D,null,{sync:!0}))}}function C(){const F=p?fl(p.node()):{x:0,y:0,k:1};return{x:F.x,y:F.y,zoom:F.k}}function E(F,D){return p?new Promise(w=>{h==null||h.scaleTo(Pi(p,D==null?void 0:D.duration,()=>w(!0)),F)}):Promise.resolve(!1)}function A(F,D){return p?new Promise(w=>{h==null||h.scaleBy(Pi(p,D==null?void 0:D.duration,()=>w(!0)),F)}):Promise.resolve(!1)}function R(F){h==null||h.scaleExtent(F)}function B(F){h==null||h.translateExtent(F)}function $(F){const D=!Ve(F)||F<0?0:F;h==null||h.clickDistance(D)}return{update:y,destroy:x,setViewport:b,setViewportConstrained:v,getViewport:C,scaleTo:E,scaleBy:A,setScaleExtent:R,setTranslateExtent:B,syncViewport:M,setClickDistance:$}}var Ft;(function(t){t.Line="line",t.Handle="handle"})(Ft||(Ft={}));const D1=["top-left","top-right","bottom-left","bottom-right"],L1=["top","right","bottom","left"];function F1({width:t,prevWidth:e,height:n,prevHeight:r,affectsX:i,affectsY:o}){const s=t-e,a=n-r,c=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&i&&(c[0]=c[0]*-1),a&&o&&(c[1]=c[1]*-1),c}function z1(t){const e=t.includes("right")||t.includes("left"),n=t.includes("bottom")||t.includes("top"),r=t.includes("left"),i=t.includes("top");return{isHorizontal:e,isVertical:n,affectsX:r,affectsY:i}}function ct(t,e){return Math.max(0,e-t)}function lt(t,e){return Math.max(0,t-e)}function hr(t,e,n){return Math.max(0,e-t,t-n)}function ru(t,e){return t?!e:e}function V1(t,e,n,r,i,o,s,a){let{affectsX:c,affectsY:l}=e;const{isHorizontal:d,isVertical:u}=e,h=d&&u,{xSnapped:p,ySnapped:m}=n,{minWidth:f,maxWidth:g,minHeight:y,maxHeight:x}=r,{x:v,y:b,width:M,height:C,aspectRatio:E}=t;let A=Math.floor(d?p-t.pointerX:0),R=Math.floor(u?m-t.pointerY:0);const B=M+(c?-A:A),$=C+(l?-R:R),F=-o[0]*M,D=-o[1]*C;let w=hr(B,f,g),k=hr($,y,x);if(s){let N=0,j=0;c&&A<0?N=ct(v+A+F,s[0][0]):!c&&A>0&&(N=lt(v+B+F,s[1][0])),l&&R<0?j=ct(b+R+D,s[0][1]):!l&&R>0&&(j=lt(b+$+D,s[1][1])),w=Math.max(w,N),k=Math.max(k,j)}if(a){let N=0,j=0;c&&A>0?N=lt(v+A,a[0][0]):!c&&A<0&&(N=ct(v+B,a[1][0])),l&&R>0?j=lt(b+R,a[0][1]):!l&&R<0&&(j=ct(b+$,a[1][1])),w=Math.max(w,N),k=Math.max(k,j)}if(i){if(d){const N=hr(B/E,y,x)*E;if(w=Math.max(w,N),s){let j=0;!c&&!l||c&&!l&&h?j=lt(b+D+B/E,s[1][1])*E:j=ct(b+D+(c?A:-A)/E,s[0][1])*E,w=Math.max(w,j)}if(a){let j=0;!c&&!l||c&&!l&&h?j=ct(b+B/E,a[1][1])*E:j=lt(b+(c?A:-A)/E,a[0][1])*E,w=Math.max(w,j)}}if(u){const N=hr($*E,f,g)/E;if(k=Math.max(k,N),s){let j=0;!c&&!l||l&&!c&&h?j=lt(v+$*E+F,s[1][0])/E:j=ct(v+(l?R:-R)*E+F,s[0][0])/E,k=Math.max(k,j)}if(a){let j=0;!c&&!l||l&&!c&&h?j=ct(v+$*E,a[1][0])/E:j=lt(v+(l?R:-R)*E,a[0][0])/E,k=Math.max(k,j)}}}R=R+(R<0?k:-k),A=A+(A<0?w:-w),i&&(h?B>$*E?R=(ru(c,l)?-A:A)/E:A=(ru(c,l)?-R:R)*E:d?(R=A/E,l=c):(A=R*E,c=l));const O=c?v+A:v,T=l?b+R:b;return{width:M+(c?-A:A),height:C+(l?-R:R),x:o[0]*A*(c?-1:1)+O,y:o[1]*R*(l?-1:1)+T}}const iu={width:0,height:0,x:0,y:0},q1={...iu,pointerX:0,pointerY:0,aspectRatio:1};function W1(t){return[[0,0],[t.measured.width,t.measured.height]]}function H1(t,e,n){const r=e.position.x+t.position.x,i=e.position.y+t.position.y,o=t.measured.width??0,s=t.measured.height??0,a=n[0]*o,c=n[1]*s;return[[r-a,i-c],[r+o-a,i+s-c]]}function U1({domNode:t,nodeId:e,getStoreItems:n,onChange:r,onEnd:i}){const o=Ie(t);function s({controlPosition:c,boundaries:l,keepAspectRatio:d,onResizeStart:u,onResize:h,onResizeEnd:p,shouldResize:m}){let f={...iu},g={...q1};const y=z1(c);let x,v=null,b=[],M,C,E;const A=Fc().on("start",R=>{const{nodeLookup:B,transform:$,snapGrid:F,snapToGrid:D,nodeOrigin:w,paneDomNode:k}=n();if(x=B.get(e),!x)return;v=(k==null?void 0:k.getBoundingClientRect())??null;const{xSnapped:O,ySnapped:T}=gn(R.sourceEvent,{transform:$,snapGrid:F,snapToGrid:D,containerBounds:v});f={width:x.measured.width??0,height:x.measured.height??0,x:x.position.x??0,y:x.position.y??0},g={...f,pointerX:O,pointerY:T,aspectRatio:f.width/f.height},M=void 0,x.parentId&&(x.extent==="parent"||x.expandParent)&&(M=B.get(x.parentId),C=M&&x.extent==="parent"?W1(M):void 0),b=[],E=void 0;for(const[N,j]of B)if(j.parentId===e&&(b.push({id:N,position:{...j.position},extent:j.extent}),j.extent==="parent"||j.expandParent)){const L=H1(j,x,j.origin??w);E?E=[[Math.min(L[0][0],E[0][0]),Math.min(L[0][1],E[0][1])],[Math.max(L[1][0],E[1][0]),Math.max(L[1][1],E[1][1])]]:E=L}u==null||u(R,{...f})}).on("drag",R=>{const{transform:B,snapGrid:$,snapToGrid:F,nodeOrigin:D}=n(),w=gn(R.sourceEvent,{transform:B,snapGrid:$,snapToGrid:F,containerBounds:v}),k=[];if(!x)return;const{x:O,y:T,width:N,height:j}=f,L={},q=x.origin??D,{width:U,height:V,x:Y,y:X}=V1(g,y,w,l,d,q,C,E),K=U!==N,ne=V!==j,W=Y!==O&&K,ie=X!==T&&ne;if(!W&&!ie&&!K&&!ne)return;if((W||ie||q[0]===1||q[1]===1)&&(L.x=W?Y:f.x,L.y=ie?X:f.y,f.x=L.x,f.y=L.y,b.length>0)){const ae=Y-O,he=X-T;for(const pe of b)pe.position={x:pe.position.x-ae+q[0]*(U-N),y:pe.position.y-he+q[1]*(V-j)},k.push(pe)}if((K||ne)&&(L.width=K?U:f.width,L.height=ne?V:f.height,f.width=L.width,f.height=L.height),M&&x.expandParent){const ae=q[0]*(L.width??0);L.x&&L.x<ae&&(f.x=ae,g.x=g.x-(L.x-ae));const he=q[1]*(L.height??0);L.y&&L.y<he&&(f.y=he,g.y=g.y-(L.y-he))}const ce=F1({width:f.width,prevWidth:N,height:f.height,prevHeight:j,affectsX:y.affectsX,affectsY:y.affectsY}),oe={...f,direction:ce};(m==null?void 0:m(R,oe))!==!1&&(h==null||h(R,oe),r(L,k))}).on("end",R=>{p==null||p(R,{...f}),i==null||i()});o.call(A)}function a(){o.on(".drag",null)}return{update:s,destroy:a}}var ou={exports:{}},Ai={},su={exports:{}},ki={},au;function Q1(){if(au)return ki;au=1;var t=Kf();function e(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,i=t.useEffect,o=t.useLayoutEffect,s=t.useDebugValue;function a(u,h){var p=h(),m=r({inst:{value:p,getSnapshot:h}}),f=m[0].inst,g=m[1];return o(function(){f.value=p,f.getSnapshot=h,c(f)&&g({inst:f})},[u,p,h]),i(function(){return c(f)&&g({inst:f}),u(function(){c(f)&&g({inst:f})})},[u]),s(p),p}function c(u){var h=u.getSnapshot;u=u.value;try{var p=h();return!n(u,p)}catch{return!0}}function l(u,h){return h()}var d=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:a;return ki.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:d,ki}var cu;function lu(){return cu||(cu=1,su.exports=Q1()),su.exports}var uu;function Y1(){if(uu)return Ai;uu=1;var t=Kf(),e=lu();function n(l,d){return l===d&&(l!==0||1/l===1/d)||l!==l&&d!==d}var r=typeof Object.is=="function"?Object.is:n,i=e.useSyncExternalStore,o=t.useRef,s=t.useEffect,a=t.useMemo,c=t.useDebugValue;return Ai.useSyncExternalStoreWithSelector=function(l,d,u,h,p){var m=o(null);if(m.current===null){var f={hasValue:!1,value:null};m.current=f}else f=m.current;m=a(function(){function y(C){if(!x){if(x=!0,v=C,C=h(C),p!==void 0&&f.hasValue){var E=f.value;if(p(E,C))return b=E}return b=C}if(E=b,r(v,C))return E;var A=h(C);return p!==void 0&&p(E,A)?E:(v=C,b=A)}var x=!1,v,b,M=u===void 0?null:u;return[function(){return y(d())},M===null?void 0:function(){return y(M())}]},[d,u,h,p]);var g=i(l,m[0],m[1]);return s(function(){f.hasValue=!0,f.value=g},[g]),c(g),g},Ai}var du;function Z1(){return du||(du=1,ou.exports=Y1()),ou.exports}var G1=Z1();let hu,Ti,pu,fu,mu,yu;ic=Yt(G1),hu={BASE_URL:"/NoLLMChat/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BASE_URL:"/NoLLMChat/"},Ti=t=>{let e;const n=new Set,r=(a,c)=>{const l=typeof a=="function"?a(e):a;if(!Object.is(l,e)){const d=e;e=c??(typeof l!="object"||l===null)?l:Object.assign({},e,l),n.forEach(u=>u(e,d))}},i=()=>e,o={setState:r,getState:i,getInitialState:()=>s,subscribe:a=>(n.add(a),()=>n.delete(a)),destroy:()=>{(hu?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},s=e=t(r,i,o);return o},pu=t=>t?Ti(t):Ti,{useDebugValue:fu}=lE,{useSyncExternalStoreWithSelector:mu}=ic,yu=t=>t;function gu(t,e=yu,n){const r=mu(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return fu(r),r}const vu=(t,e)=>{const n=pu(t),r=(i,o=e)=>gu(n,i,o);return Object.assign(r,n),r},X1=(t,e)=>t?vu(t,e):vu;function ge(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[r,i]of t)if(!Object.is(i,e.get(r)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(t[r],e[r]))return!1;return!0}const pr=_.createContext(null),K1=pr.Provider,xu=nt.error001();de=function(t,e){const n=_.useContext(pr);if(n===null)throw new Error(xu);return gu(n,t,e)},ye=function(){const t=_.useContext(pr);if(t===null)throw new Error(xu);return _.useMemo(()=>({getState:t.getState,setState:t.setState,subscribe:t.subscribe}),[t])};const bu={display:"none"},J1={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},wu="react-flow__node-desc",Mu="react-flow__edge-desc",ev="react-flow__aria-live",tv=t=>t.ariaLiveMessage;function nv({rfId:t}){const e=de(tv);return S.jsx("div",{id:`${ev}-${t}`,"aria-live":"assertive","aria-atomic":"true",style:J1,children:e})}function rv({rfId:t,disableKeyboardA11y:e}){return S.jsxs(S.Fragment,{children:[S.jsxs("div",{id:`${wu}-${t}`,style:bu,children:["Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "]}),S.jsx("div",{id:`${Mu}-${t}`,style:bu,children:"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."}),!e&&S.jsx(nv,{rfId:t})]})}const iv=t=>t.userSelectionActive?"none":"all";kn=function({position:t="top-left",children:e,className:n,style:r,...i}){const o=de(iv),s=`${t}`.split("-");return S.jsx("div",{className:we(["react-flow__panel",n,...s]),style:{...r,pointerEvents:o},...i,children:e})};function ov({proOptions:t,position:e="bottom-right"}){return t!=null&&t.hideAttribution?null:S.jsx(kn,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:S.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const sv=t=>{const e=[],n=[];for(const[,r]of t.nodeLookup)r.selected&&e.push(r.internals.userNode);for(const[,r]of t.edgeLookup)r.selected&&n.push(r);return{selectedNodes:e,selectedEdges:n}},fr=t=>t.id;function av(t,e){return ge(t.selectedNodes.map(fr),e.selectedNodes.map(fr))&&ge(t.selectedEdges.map(fr),e.selectedEdges.map(fr))}function cv({onSelectionChange:t}){const e=ye(),{selectedNodes:n,selectedEdges:r}=de(sv,av);return _.useEffect(()=>{const i={nodes:n,edges:r};t==null||t(i),e.getState().onSelectionChangeHandlers.forEach(o=>o(i))},[n,r,t]),null}const lv=t=>!!t.onSelectionChangeHandlers;function uv({onSelectionChange:t}){const e=de(lv);return t||e?S.jsx(cv,{onSelectionChange:t}):null}const Eu=[0,0],dv={x:0,y:0,zoom:1},hv=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance"],_u=[...hv,"rfId"],pv=t=>({setNodes:t.setNodes,setEdges:t.setEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setPaneClickDistance:t.setPaneClickDistance}),Cu={translateExtent:dn,nodeOrigin:Eu,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function fv(t){const{setNodes:e,setEdges:n,setMinZoom:r,setMaxZoom:i,setTranslateExtent:o,setNodeExtent:s,reset:a,setDefaultNodesAndEdges:c,setPaneClickDistance:l}=de(pv,ge),d=ye();_.useEffect(()=>(c(t.defaultNodes,t.defaultEdges),()=>{u.current=Cu,a()}),[]);const u=_.useRef(Cu);return _.useEffect(()=>{for(const h of _u){const p=t[h],m=u.current[h];p!==m&&(typeof t[h]>"u"||(h==="nodes"?e(p):h==="edges"?n(p):h==="minZoom"?r(p):h==="maxZoom"?i(p):h==="translateExtent"?o(p):h==="nodeExtent"?s(p):h==="paneClickDistance"?l(p):h==="fitView"?d.setState({fitViewOnInit:p}):h==="fitViewOptions"?d.setState({fitViewOnInitOptions:p}):d.setState({[h]:p})))}u.current=t},_u.map(h=>t[h])),null}function Su(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function mv(t){var r;const[e,n]=_.useState(t==="system"?null:t);return _.useEffect(()=>{if(t!=="system"){n(t);return}const i=Su(),o=()=>n(i!=null&&i.matches?"dark":"light");return o(),i==null||i.addEventListener("change",o),()=>{i==null||i.removeEventListener("change",o)}},[t]),e!==null?e:(r=Su())!=null&&r.matches?"dark":"light"}const Ou=typeof document<"u"?document:null;function xn(t=null,e={target:Ou,actInsideInputWithModifier:!0}){const[n,r]=_.useState(!1),i=_.useRef(!1),o=_.useRef(new Set([])),[s,a]=_.useMemo(()=>{if(t!==null){const c=(Array.isArray(t)?t:[t]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=c.reduce((d,u)=>d.concat(...u),[]);return[c,l]}return[[],[]]},[t]);return _.useEffect(()=>{const c=(e==null?void 0:e.target)||Ou;if(t!==null){const l=h=>{if(i.current=h.ctrlKey||h.metaKey||h.shiftKey,(!i.current||i.current&&!e.actInsideInputWithModifier)&&vi(h))return!1;const p=Pu(h.code,a);o.current.add(h[p]),Nu(s,o.current,!1)&&(h.preventDefault(),r(!0))},d=h=>{if((!i.current||i.current&&!e.actInsideInputWithModifier)&&vi(h))return!1;const p=Pu(h.code,a);Nu(s,o.current,!0)?(r(!1),o.current.clear()):o.current.delete(h[p]),h.key==="Meta"&&o.current.clear(),i.current=!1},u=()=>{o.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",l),c==null||c.addEventListener("keyup",d),window.addEventListener("blur",u),window.addEventListener("contextmenu",u),()=>{c==null||c.removeEventListener("keydown",l),c==null||c.removeEventListener("keyup",d),window.removeEventListener("blur",u),window.removeEventListener("contextmenu",u)}}},[t,r]),n}function Nu(t,e,n){return t.filter(r=>n||r.length===e.size).some(r=>r.every(i=>e.has(i)))}function Pu(t,e){return e.includes(t)?"code":"key"}const yv=()=>{const t=ye();return _.useMemo(()=>({zoomIn:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1/1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomTo:(e,n)=>{const{panZoom:r}=t.getState();return r?r.scaleTo(e,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>t.getState().transform[2],setViewport:async(e,n)=>{const{transform:[r,i,o],panZoom:s}=t.getState();return s?(await s.setViewport({x:e.x??r,y:e.y??i,zoom:e.zoom??o},{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,n,r]=t.getState().transform;return{x:e,y:n,zoom:r}},fitView:e=>{const{nodeLookup:n,minZoom:r,maxZoom:i,panZoom:o,domNode:s}=t.getState();if(!o||!s)return Promise.resolve(!1);const a=fi(n,e),{width:c,height:l}=lr(s);return mi({nodes:a,width:c,height:l,minZoom:r,maxZoom:i,panZoom:o},e)},setCenter:async(e,n,r)=>{const{width:i,height:o,maxZoom:s,panZoom:a}=t.getState(),c=typeof(r==null?void 0:r.zoom)<"u"?r.zoom:s,l=i/2-e*c,d=o/2-n*c;return a?(await a.setViewport({x:l,y:d,zoom:c},{duration:r==null?void 0:r.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitBounds:async(e,n)=>{const{width:r,height:i,minZoom:o,maxZoom:s,panZoom:a}=t.getState(),c=gi(e,r,i,o,s,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(c,{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,n={snapToGrid:!0})=>{const{transform:r,snapGrid:i,domNode:o}=t.getState();if(!o)return e;const{x:s,y:a}=o.getBoundingClientRect(),c={x:e.x-s,y:e.y-a};return yn(c,r,n.snapToGrid,i)},flowToScreenPosition:e=>{const{transform:n,domNode:r}=t.getState();if(!r)return e;const{x:i,y:o}=r.getBoundingClientRect(),s=Al(e,n);return{x:s.x+i,y:s.y+o}}}),[])};function Au(t,e){const n=[],r=new Map,i=[];for(const o of t)if(o.type==="add"){i.push(o);continue}else if(o.type==="remove"||o.type==="replace")r.set(o.id,[o]);else{const s=r.get(o.id);s?s.push(o):r.set(o.id,[o])}for(const o of e){const s=r.get(o.id);if(!s){n.push(o);continue}if(s[0].type==="remove")continue;if(s[0].type==="replace"){n.push({...s[0].item});continue}const a={...o};for(const c of s)gv(c,a);n.push(a)}return i.length&&i.forEach(o=>{o.index!==void 0?n.splice(o.index,0,{...o.item}):n.push({...o.item})}),n}function gv(t,e){switch(t.type){case"select":{e.selected=t.selected;break}case"position":{typeof t.position<"u"&&(e.position=t.position),typeof t.dragging<"u"&&(e.dragging=t.dragging);break}case"dimensions":{typeof t.dimensions<"u"&&(e.measured??(e.measured={}),e.measured.width=t.dimensions.width,e.measured.height=t.dimensions.height,t.setAttributes&&(e.width=t.dimensions.width,e.height=t.dimensions.height)),typeof t.resizing=="boolean"&&(e.resizing=t.resizing);break}}}ht=function(t,e){return Au(t,e)};function bn(t,e){return Au(t,e)}function vt(t,e){return{id:t,type:"select",selected:e}}function zt(t,e=new Set,n=!1){const r=[];for(const[i,o]of t){const s=e.has(i);!(o.selected===void 0&&!s)&&o.selected!==s&&(n&&(o.selected=s),r.push(vt(o.id,s)))}return r}function ku({items:t=[],lookup:e}){var i;const n=[],r=new Map(t.map(o=>[o.id,o]));for(const[o,s]of t.entries()){const a=e.get(s.id),c=((i=a==null?void 0:a.internals)==null?void 0:i.userNode)??a;c!==void 0&&c!==s&&n.push({id:s.id,item:s,type:"replace"}),c===void 0&&n.push({item:s,type:"add",index:o})}for(const[o]of e)r.get(o)===void 0&&n.push({id:o,type:"remove"});return n}function Tu(t){return{id:t.id,type:"remove"}}const ju=t=>t1(t),vv=t=>Ml(t);function Ru(t){return _.forwardRef(t)}const xv=typeof window<"u"?_.useLayoutEffect:_.useEffect;function Iu(t){const[e,n]=_.useState(BigInt(0)),[r]=_.useState(()=>bv(()=>n(i=>i+BigInt(1))));return xv(()=>{const i=r.get();i.length&&(t(i),r.reset())},[e]),r}function bv(t){let e=[];return{get:()=>e,reset:()=>{e=[]},push:n=>{e.push(n),t()}}}const Bu=_.createContext(null);function wv({children:t}){const e=ye(),n=_.useCallback(a=>{const{nodes:c=[],setNodes:l,hasDefaultNodes:d,onNodesChange:u,nodeLookup:h}=e.getState();let p=c;for(const m of a)p=typeof m=="function"?m(p):m;d?l(p):u&&u(ku({items:p,lookup:h}))},[]),r=Iu(n),i=_.useCallback(a=>{const{edges:c=[],setEdges:l,hasDefaultEdges:d,onEdgesChange:u,edgeLookup:h}=e.getState();let p=c;for(const m of a)p=typeof m=="function"?m(p):m;d?l(p):u&&u(ku({items:p,lookup:h}))},[]),o=Iu(i),s=_.useMemo(()=>({nodeQueue:r,edgeQueue:o}),[]);return S.jsx(Bu.Provider,{value:s,children:t})}function Mv(){const t=_.useContext(Bu);if(!t)throw new Error("useBatchContext must be used within a BatchProvider");return t}const Ev=t=>!!t.panZoom;jn=function(){const t=yv(),e=ye(),n=Mv(),r=de(Ev),i=_.useMemo(()=>{const o=u=>e.getState().nodeLookup.get(u),s=u=>{n.nodeQueue.push(u)},a=u=>{n.edgeQueue.push(u)},c=u=>{var y,x;const{nodeLookup:h,nodeOrigin:p}=e.getState(),m=ju(u)?u:h.get(u.id),f=m.parentId?Tl(m.position,m.measured,m.parentId,h,p):m.position,g={id:m.id,position:f,width:((y=m.measured)==null?void 0:y.width)??m.width,height:((x=m.measured)==null?void 0:x.height)??m.height,data:m.data};return $t(g)},l=(u,h,p={replace:!1})=>{s(m=>m.map(f=>{if(f.id===u){const g=typeof h=="function"?h(f):h;return p.replace&&ju(g)?g:{...f,...g}}return f}))},d=(u,h,p={replace:!1})=>{a(m=>m.map(f=>{if(f.id===u){const g=typeof h=="function"?h(f):h;return p.replace&&vv(g)?g:{...f,...g}}return f}))};return{getNodes:()=>e.getState().nodes.map(u=>({...u})),getNode:u=>{var h;return(h=o(u))==null?void 0:h.internals.userNode},getInternalNode:o,getEdges:()=>{const{edges:u=[]}=e.getState();return u.map(h=>({...h}))},getEdge:u=>e.getState().edgeLookup.get(u),setNodes:s,setEdges:a,addNodes:u=>{const h=Array.isArray(u)?u:[u];n.nodeQueue.push(p=>[...p,...h])},addEdges:u=>{const h=Array.isArray(u)?u:[u];n.edgeQueue.push(p=>[...p,...h])},toObject:()=>{const{nodes:u=[],edges:h=[],transform:p}=e.getState(),[m,f,g]=p;return{nodes:u.map(y=>({...y})),edges:h.map(y=>({...y})),viewport:{x:m,y:f,zoom:g}}},deleteElements:async({nodes:u=[],edges:h=[]})=>{const{nodes:p,edges:m,onNodesDelete:f,onEdgesDelete:g,triggerNodeChanges:y,triggerEdgeChanges:x,onDelete:v,onBeforeDelete:b}=e.getState(),{nodes:M,edges:C}=await i1({nodesToRemove:u,edgesToRemove:h,nodes:p,edges:m,onBeforeDelete:b}),E=C.length>0,A=M.length>0;if(E){const R=C.map(Tu);g==null||g(C),x(R)}if(A){const R=M.map(Tu);f==null||f(M),y(R)}return(A||E)&&(v==null||v({nodes:M,edges:C})),{deletedNodes:M,deletedEdges:C}},getIntersectingNodes:(u,h=!0,p)=>{const m=Pl(u),f=m?u:c(u),g=p!==void 0;return f?(p||e.getState().nodes).filter(y=>{const x=e.getState().nodeLookup.get(y.id);if(x&&!m&&(y.id===u.id||!x.internals.positionAbsolute))return!1;const v=$t(g?y:x),b=mn(v,f);return h&&b>0||b>=f.width*f.height}):[]},isNodeIntersecting:(u,h,p=!0)=>{const m=Pl(u)?u:c(u);if(!m)return!1;const f=mn(m,h);return p&&f>0||f>=m.width*m.height},updateNode:l,updateNodeData:(u,h,p={replace:!1})=>{l(u,m=>{const f=typeof h=="function"?h(m):h;return p.replace?{...m,data:f}:{...m,data:{...m.data,...f}}},p)},updateEdge:d,updateEdgeData:(u,h,p={replace:!1})=>{d(u,m=>{const f=typeof h=="function"?h(m):h;return p.replace?{...m,data:f}:{...m,data:{...m.data,...f}}},p)},getNodesBounds:u=>{const{nodeLookup:h,nodeOrigin:p}=e.getState();return n1(u,{nodeLookup:h,nodeOrigin:p})},getHandleConnections:({type:u,id:h,nodeId:p})=>{var m;return Array.from(((m=e.getState().connectionLookup.get(`${p}-${u}-${h??null}`))==null?void 0:m.values())??[])}}},[]);return _.useMemo(()=>({...i,...t,viewportInitialized:r}),[r])};const $u=t=>t.selected,_v={actInsideInputWithModifier:!1},Cv=typeof window<"u"?window:void 0;function Sv({deleteKeyCode:t,multiSelectionKeyCode:e}){const n=ye(),{deleteElements:r}=jn(),i=xn(t,_v),o=xn(e,{target:Cv});_.useEffect(()=>{if(i){const{edges:s,nodes:a}=n.getState();r({nodes:a.filter($u),edges:s.filter($u)}),n.setState({nodesSelectionActive:!1})}},[i]),_.useEffect(()=>{n.setState({multiSelectionActive:o})},[o])}function Ov(t){const e=ye();_.useEffect(()=>{const n=()=>{var i,o;if(!t.current)return!1;const r=lr(t.current);(r.height===0||r.width===0)&&((o=(i=e.getState()).onError)==null||o.call(i,"004",nt.error004())),e.setState({width:r.width||500,height:r.height||500})};if(t.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(t.current),()=>{window.removeEventListener("resize",n),r&&t.current&&r.unobserve(t.current)}}},[])}const mr={position:"absolute",width:"100%",height:"100%",top:0,left:0},Nv=t=>({userSelectionActive:t.userSelectionActive,lib:t.lib});function Pv({onPaneContextMenu:t,zoomOnScroll:e=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:i=.5,panOnScrollMode:o=pt.Free,zoomOnDoubleClick:s=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:l,minZoom:d,maxZoom:u,zoomActivationKeyCode:h,preventScrolling:p=!0,children:m,noWheelClassName:f,noPanClassName:g,onViewportChange:y,isControlledViewport:x,paneClickDistance:v}){const b=ye(),M=_.useRef(null),{userSelectionActive:C,lib:E}=de(Nv,ge),A=xn(h),R=_.useRef();Ov(M);const B=_.useCallback($=>{y==null||y({x:$[0],y:$[1],zoom:$[2]}),x||b.setState({transform:$})},[y,x]);return _.useEffect(()=>{if(M.current){R.current=$1({domNode:M.current,minZoom:d,maxZoom:u,translateExtent:l,viewport:c,paneClickDistance:v,onDraggingChange:w=>b.setState({paneDragging:w}),onPanZoomStart:(w,k)=>{const{onViewportChangeStart:O,onMoveStart:T}=b.getState();T==null||T(w,k),O==null||O(k)},onPanZoom:(w,k)=>{const{onViewportChange:O,onMove:T}=b.getState();T==null||T(w,k),O==null||O(k)},onPanZoomEnd:(w,k)=>{const{onViewportChangeEnd:O,onMoveEnd:T}=b.getState();T==null||T(w,k),O==null||O(k)}});const{x:$,y:F,zoom:D}=R.current.getViewport();return b.setState({panZoom:R.current,transform:[$,F,D],domNode:M.current.closest(".react-flow")}),()=>{var w;(w=R.current)==null||w.destroy()}}},[]),_.useEffect(()=>{var $;($=R.current)==null||$.update({onPaneContextMenu:t,zoomOnScroll:e,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:i,panOnScrollMode:o,zoomOnDoubleClick:s,panOnDrag:a,zoomActivationKeyPressed:A,preventScrolling:p,noPanClassName:g,userSelectionActive:C,noWheelClassName:f,lib:E,onTransformChange:B})},[t,e,n,r,i,o,s,a,A,p,g,C,f,E,B]),S.jsx("div",{className:"react-flow__renderer",ref:M,style:mr,children:m})}const Av=t=>({userSelectionActive:t.userSelectionActive,userSelectionRect:t.userSelectionRect});function kv(){const{userSelectionActive:t,userSelectionRect:e}=de(Av,ge);return t&&e?S.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const ji=(t,e)=>n=>{n.target===e.current&&(t==null||t(n))},Tv=t=>({userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable,dragging:t.paneDragging});function jv({isSelecting:t,selectionKeyPressed:e,selectionMode:n=hn.Full,panOnDrag:r,selectionOnDrag:i,onSelectionStart:o,onSelectionEnd:s,onPaneClick:a,onPaneContextMenu:c,onPaneScroll:l,onPaneMouseEnter:d,onPaneMouseMove:u,onPaneMouseLeave:h,children:p}){const m=_.useRef(null),f=ye(),g=_.useRef(0),y=_.useRef(0),x=_.useRef(),v=_.useRef(new Map),{userSelectionActive:b,elementsSelectable:M,dragging:C}=de(Tv,ge),E=M&&(t||b),A=_.useRef(!1),R=_.useRef(!1),B=()=>{f.setState({userSelectionActive:!1,userSelectionRect:null}),g.current=0,y.current=0},$=N=>{if(A.current){A.current=!1;return}a==null||a(N),f.getState().resetSelectedElements(),f.setState({nodesSelectionActive:!1})},F=N=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){N.preventDefault();return}c==null||c(N)},D=l?N=>l(N):void 0,w=N=>{var Y,X,K,ne;const{resetSelectedElements:j,domNode:L,edgeLookup:q}=f.getState();if(x.current=L==null?void 0:L.getBoundingClientRect(),!M||!t||N.button!==0||N.target!==m.current||!x.current)return;(X=(Y=N.target)==null?void 0:Y.setPointerCapture)==null||X.call(Y,N.pointerId),R.current=!0,A.current=!1,v.current=new Map;for(const[W,ie]of q)v.current.set(ie.source,((K=v.current.get(ie.source))==null?void 0:K.add(W))||new Set([W])),v.current.set(ie.target,((ne=v.current.get(ie.target))==null?void 0:ne.add(W))||new Set([W]));const{x:U,y:V}=it(N.nativeEvent,x.current);j(),f.setState({userSelectionRect:{width:0,height:0,startX:U,startY:V,x:U,y:V}}),o==null||o(N)},k=N=>{const{userSelectionRect:j,edgeLookup:L,transform:q,nodeLookup:U,triggerNodeChanges:V,triggerEdgeChanges:Y}=f.getState();if(!x.current||!j)return;A.current=!0;const{x:X,y:K}=it(N.nativeEvent,x.current),{startX:ne,startY:W}=j,ie={startX:ne,startY:W,x:X<ne?X:ne,y:K<W?K:W,width:Math.abs(X-ne),height:Math.abs(K-W)},ce=El(U,ie,q,n===hn.Partial,!0),oe=new Set,ae=new Set;for(const he of ce){ae.add(he.id);const pe=v.current.get(he.id);if(pe)for(const Te of pe)oe.add(Te)}if(g.current!==ae.size){g.current=ae.size;const he=zt(U,ae,!0);V(he)}if(y.current!==oe.size){y.current=oe.size;const he=zt(L,oe);Y(he)}f.setState({userSelectionRect:ie,userSelectionActive:!0,nodesSelectionActive:!1})},O=N=>{var L,q;if(N.button!==0||!R.current)return;(q=(L=N.target)==null?void 0:L.releasePointerCapture)==null||q.call(L,N.pointerId);const{userSelectionRect:j}=f.getState();!b&&j&&N.target===m.current&&($==null||$(N)),g.current>0&&f.setState({nodesSelectionActive:!0}),B(),s==null||s(N),(e||i)&&(A.current=!1),R.current=!1},T=r===!0||Array.isArray(r)&&r.includes(0);return S.jsxs("div",{className:we(["react-flow__pane",{draggable:T,dragging:C,selection:t}]),onClick:E?void 0:ji($,m),onContextMenu:ji(F,m),onWheel:ji(D,m),onPointerEnter:E?void 0:d,onPointerDown:E?w:u,onPointerMove:E?k:u,onPointerUp:E?O:void 0,onPointerLeave:h,ref:m,style:mr,children:[p,S.jsx(kv,{})]})}function Ri({id:t,store:e,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:i,unselectNodesAndEdges:o,multiSelectionActive:s,nodeLookup:a,onError:c}=e.getState(),l=a.get(t);if(!l){c==null||c("012",nt.error012(t));return}e.setState({nodesSelectionActive:!1}),l.selected?(n||l.selected&&s)&&(o({nodes:[l],edges:[]}),requestAnimationFrame(()=>{var d;return(d=r==null?void 0:r.current)==null?void 0:d.blur()})):i([t])}function Du({nodeRef:t,disabled:e=!1,noDragClassName:n,handleSelector:r,nodeId:i,isSelectable:o,nodeClickDistance:s}){const a=ye(),[c,l]=_.useState(!1),d=_.useRef();return _.useEffect(()=>{d.current=E1({getStoreItems:()=>a.getState(),onNodeMouseDown:u=>{Ri({id:u,store:a,nodeRef:t})},onDragStart:()=>{l(!0)},onDragStop:()=>{l(!1)}})},[]),_.useEffect(()=>{var u,h;if(e)(u=d.current)==null||u.destroy();else if(t.current)return(h=d.current)==null||h.update({noDragClassName:n,handleSelector:r,domNode:t.current,isSelectable:o,nodeId:i,nodeClickDistance:s}),()=>{var p;(p=d.current)==null||p.destroy()}},[n,r,e,o,t,i]),c}const Rv=t=>e=>e.selected&&(e.draggable||t&&typeof e.draggable>"u");function Lu(){const t=ye();return _.useCallback(e=>{const{nodeExtent:n,snapToGrid:r,snapGrid:i,nodesDraggable:o,onError:s,updateNodePositions:a,nodeLookup:c,nodeOrigin:l}=t.getState(),d=new Map,u=Rv(o),h=r?i[0]:5,p=r?i[1]:5,m=e.direction.x*h*e.factor,f=e.direction.y*p*e.factor;for(const[,g]of c){if(!u(g))continue;let y={x:g.internals.positionAbsolute.x+m,y:g.internals.positionAbsolute.y+f};r&&(y=ar(y,i));const{position:x,positionAbsolute:v}=_l({nodeId:g.id,nextPosition:y,nodeLookup:c,nodeExtent:n,nodeOrigin:l,onError:s});g.position=x,g.internals.positionAbsolute=v,d.set(g.id,g)}a(d)},[])}const Ii=_.createContext(null),Iv=Ii.Provider;Ii.Consumer;const Bi=()=>_.useContext(Ii),Bv=t=>({connectOnClick:t.connectOnClick,noPanClassName:t.noPanClassName,rfId:t.rfId}),$v=(t,e,n)=>r=>{const{connectionClickStartHandle:i,connectionMode:o,connection:s}=r,{fromHandle:a,toHandle:c,isValid:l}=s,d=(c==null?void 0:c.nodeId)===t&&(c==null?void 0:c.id)===e&&(c==null?void 0:c.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===t&&(a==null?void 0:a.id)===e&&(a==null?void 0:a.type)===n,connectingTo:d,clickConnecting:(i==null?void 0:i.nodeId)===t&&(i==null?void 0:i.id)===e&&(i==null?void 0:i.type)===n,isPossibleEndHandle:o===It.Strict?(a==null?void 0:a.type)!==n:t!==(a==null?void 0:a.nodeId)||e!==(a==null?void 0:a.id),connectionInProcess:!!a,valid:d&&l}};function Dv({type:t="source",position:e=re.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:o=!0,id:s,onConnect:a,children:c,className:l,onMouseDown:d,onTouchStart:u,...h},p){var w,k;const m=s||null,f=t==="target",g=ye(),y=Bi(),{connectOnClick:x,noPanClassName:v,rfId:b}=de(Bv,ge),{connectingFrom:M,connectingTo:C,clickConnecting:E,isPossibleEndHandle:A,connectionInProcess:R,valid:B}=de($v(y,m,t),ge);y||((k=(w=g.getState()).onError)==null||k.call(w,"010",nt.error010()));const $=O=>{const{defaultEdgeOptions:T,onConnect:N,hasDefaultEdges:j}=g.getState(),L={...T,...O};if(j){const{edges:q,setEdges:U}=g.getState();U(Fl(L,q))}N==null||N(L),a==null||a(L)},F=O=>{if(!y)return;const T=Rl(O.nativeEvent);if(i&&(T&&O.button===0||!T)){const N=g.getState();Oi.onPointerDown(O.nativeEvent,{autoPanOnConnect:N.autoPanOnConnect,connectionMode:N.connectionMode,connectionRadius:N.connectionRadius,domNode:N.domNode,nodeLookup:N.nodeLookup,lib:N.lib,isTarget:f,handleId:m,nodeId:y,flowId:N.rfId,panBy:N.panBy,cancelConnection:N.cancelConnection,onConnectStart:N.onConnectStart,onConnectEnd:N.onConnectEnd,updateConnection:N.updateConnection,onConnect:$,isValidConnection:n||N.isValidConnection,getTransform:()=>g.getState().transform,getFromHandle:()=>g.getState().connection.fromHandle,autoPanSpeed:N.autoPanSpeed})}T?d==null||d(O):u==null||u(O)},D=O=>{const{onClickConnectStart:T,onClickConnectEnd:N,connectionClickStartHandle:j,connectionMode:L,isValidConnection:q,lib:U,rfId:V,nodeLookup:Y,connection:X}=g.getState();if(!y||!j&&!i)return;if(!j){T==null||T(O.nativeEvent,{nodeId:y,handleId:m,handleType:t}),g.setState({connectionClickStartHandle:{nodeId:y,type:t,id:m}});return}const K=jl(O.target),ne=n||q,{connection:W,isValid:ie}=Oi.isValid(O.nativeEvent,{handle:{nodeId:y,id:m,type:t},connectionMode:L,fromNodeId:j.nodeId,fromHandleId:j.id||null,fromType:j.type,isValidConnection:ne,flowId:V,doc:K,lib:U,nodeLookup:Y});ie&&W&&$(W);const ce=structuredClone(X);delete ce.inProgress,ce.toPosition=ce.toHandle?ce.toHandle.position:null,N==null||N(O,ce),g.setState({connectionClickStartHandle:null})};return S.jsx("div",{"data-handleid":m,"data-nodeid":y,"data-handlepos":e,"data-id":`${b}-${y}-${m}-${t}`,className:we(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",v,l,{source:!f,target:f,connectable:r,connectablestart:i,connectableend:o,clickconnecting:E,connectingfrom:M,connectingto:C,valid:B,connectionindicator:r&&(!R||A)&&(R?o:i)}]),onMouseDown:F,onTouchStart:F,onClick:x?D:void 0,ref:p,...h,children:c})}Gt=_.memo(Ru(Dv));function Lv({data:t,isConnectable:e,sourcePosition:n=re.Bottom}){return S.jsxs(S.Fragment,{children:[t==null?void 0:t.label,S.jsx(Gt,{type:"source",position:n,isConnectable:e})]})}function Fv({data:t,isConnectable:e,targetPosition:n=re.Top,sourcePosition:r=re.Bottom}){return S.jsxs(S.Fragment,{children:[S.jsx(Gt,{type:"target",position:n,isConnectable:e}),t==null?void 0:t.label,S.jsx(Gt,{type:"source",position:r,isConnectable:e})]})}function zv(){return null}function Vv({data:t,isConnectable:e,targetPosition:n=re.Top}){return S.jsxs(S.Fragment,{children:[S.jsx(Gt,{type:"target",position:n,isConnectable:e}),t==null?void 0:t.label]})}const yr={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Fu={input:Lv,default:Fv,output:Vv,group:zv};function qv(t){var e,n,r,i;return t.internals.handleBounds===void 0?{width:t.width??t.initialWidth??((e=t.style)==null?void 0:e.width),height:t.height??t.initialHeight??((n=t.style)==null?void 0:n.height)}:{width:t.width??((r=t.style)==null?void 0:r.width),height:t.height??((i=t.style)==null?void 0:i.height)}}const Wv=t=>{const{width:e,height:n,x:r,y:i}=fn(t.nodeLookup,{filter:o=>!!o.selected});return{width:Ve(e)?e:null,height:Ve(n)?n:null,userSelectionActive:t.userSelectionActive,transformString:`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]}) translate(${r}px,${i}px)`}};function Hv({onSelectionContextMenu:t,noPanClassName:e,disableKeyboardA11y:n}){const r=ye(),{width:i,height:o,transformString:s,userSelectionActive:a}=de(Wv,ge),c=Lu(),l=_.useRef(null);if(_.useEffect(()=>{var h;n||((h=l.current)==null||h.focus({preventScroll:!0}))},[n]),Du({nodeRef:l}),a||!i||!o)return null;const d=t?h=>{const p=r.getState().nodes.filter(m=>m.selected);t(h,p)}:void 0,u=h=>{Object.prototype.hasOwnProperty.call(yr,h.key)&&c({direction:yr[h.key],factor:h.shiftKey?4:1})};return S.jsx("div",{className:we(["react-flow__nodesselection","react-flow__container",e]),style:{transform:s},children:S.jsx("div",{ref:l,className:"react-flow__nodesselection-rect",onContextMenu:d,tabIndex:n?void 0:-1,onKeyDown:n?void 0:u,style:{width:i,height:o}})})}const zu=typeof window<"u"?window:void 0,Uv=t=>({nodesSelectionActive:t.nodesSelectionActive,userSelectionActive:t.userSelectionActive});function Vu({children:t,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:o,onPaneScroll:s,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:l,selectionOnDrag:d,selectionMode:u,onSelectionStart:h,onSelectionEnd:p,multiSelectionKeyCode:m,panActivationKeyCode:f,zoomActivationKeyCode:g,elementsSelectable:y,zoomOnScroll:x,zoomOnPinch:v,panOnScroll:b,panOnScrollSpeed:M,panOnScrollMode:C,zoomOnDoubleClick:E,panOnDrag:A,defaultViewport:R,translateExtent:B,minZoom:$,maxZoom:F,preventScrolling:D,onSelectionContextMenu:w,noWheelClassName:k,noPanClassName:O,disableKeyboardA11y:T,onViewportChange:N,isControlledViewport:j}){const{nodesSelectionActive:L,userSelectionActive:q}=de(Uv),U=xn(l,{target:zu}),V=xn(f,{target:zu}),Y=V||A,X=V||b,K=d&&Y!==!0,ne=U||q||K;return Sv({deleteKeyCode:c,multiSelectionKeyCode:m}),S.jsx(Pv,{onPaneContextMenu:o,elementsSelectable:y,zoomOnScroll:x,zoomOnPinch:v,panOnScroll:X,panOnScrollSpeed:M,panOnScrollMode:C,zoomOnDoubleClick:E,panOnDrag:!U&&Y,defaultViewport:R,translateExtent:B,minZoom:$,maxZoom:F,zoomActivationKeyCode:g,preventScrolling:D,noWheelClassName:k,noPanClassName:O,onViewportChange:N,isControlledViewport:j,paneClickDistance:a,children:S.jsxs(jv,{onSelectionStart:h,onSelectionEnd:p,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:o,onPaneScroll:s,panOnDrag:Y,isSelecting:!!ne,selectionMode:u,selectionKeyPressed:U,selectionOnDrag:K,children:[t,L&&S.jsx(Hv,{onSelectionContextMenu:w,noPanClassName:O,disableKeyboardA11y:T})]})})}Vu.displayName="FlowRenderer";const Qv=_.memo(Vu),Yv=t=>e=>t?El(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(n=>n.id):Array.from(e.nodeLookup.keys());function Zv(t){return de(_.useCallback(Yv(t),[t]),ge)}const Gv=t=>t.updateNodeInternals;function Xv(){const t=de(Gv),[e]=_.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(i=>{const o=i.target.getAttribute("data-id");r.set(o,{id:o,nodeElement:i.target,force:!0})}),t(r)}));return _.useEffect(()=>()=>{e==null||e.disconnect()},[e]),e}function Kv({node:t,nodeType:e,hasDimensions:n,resizeObserver:r}){const i=ye(),o=_.useRef(null),s=_.useRef(null),a=_.useRef(t.sourcePosition),c=_.useRef(t.targetPosition),l=_.useRef(e),d=n&&!!t.internals.handleBounds;return _.useEffect(()=>{o.current&&!t.hidden&&(!d||s.current!==o.current)&&(s.current&&(r==null||r.unobserve(s.current)),r==null||r.observe(o.current),s.current=o.current)},[d,t.hidden]),_.useEffect(()=>()=>{s.current&&(r==null||r.unobserve(s.current),s.current=null)},[]),_.useEffect(()=>{if(o.current){const u=l.current!==e,h=a.current!==t.sourcePosition,p=c.current!==t.targetPosition;(u||h||p)&&(l.current=e,a.current=t.sourcePosition,c.current=t.targetPosition,i.getState().updateNodeInternals(new Map([[t.id,{id:t.id,nodeElement:o.current,force:!0}]])))}},[t.id,e,t.sourcePosition,t.targetPosition]),o}function Jv({id:t,onClick:e,onMouseEnter:n,onMouseMove:r,onMouseLeave:i,onContextMenu:o,onDoubleClick:s,nodesDraggable:a,elementsSelectable:c,nodesConnectable:l,nodesFocusable:d,resizeObserver:u,noDragClassName:h,noPanClassName:p,disableKeyboardA11y:m,rfId:f,nodeTypes:g,nodeExtent:y,nodeClickDistance:x,onError:v}){const{node:b,internals:M,isParent:C}=de(W=>{const ie=W.nodeLookup.get(t),ce=W.parentLookup.has(t);return{node:ie,internals:ie.internals,isParent:ce}},ge);let E=b.type||"default",A=(g==null?void 0:g[E])||Fu[E];A===void 0&&(v==null||v("003",nt.error003(E)),E="default",A=Fu.default);const R=!!(b.draggable||a&&typeof b.draggable>"u"),B=!!(b.selectable||c&&typeof b.selectable>"u"),$=!!(b.connectable||l&&typeof b.connectable>"u"),F=!!(b.focusable||d&&typeof b.focusable>"u"),D=ye(),w=kl(b),k=Kv({node:b,nodeType:E,hasDimensions:w,resizeObserver:u}),O=Du({nodeRef:k,disabled:b.hidden||!R,noDragClassName:h,handleSelector:b.dragHandle,nodeId:t,isSelectable:B,nodeClickDistance:x}),T=Lu();if(b.hidden)return null;const N=rt(b),j=qv(b),L=B||R||e||n||r||i,q=n?W=>n(W,{...M.userNode}):void 0,U=r?W=>r(W,{...M.userNode}):void 0,V=i?W=>i(W,{...M.userNode}):void 0,Y=o?W=>o(W,{...M.userNode}):void 0,X=s?W=>s(W,{...M.userNode}):void 0,K=W=>{const{selectNodesOnDrag:ie,nodeDragThreshold:ce}=D.getState();B&&(!ie||!R||ce>0)&&Ri({id:t,store:D,nodeRef:k}),e&&e(W,{...M.userNode})},ne=W=>{if(!(vi(W.nativeEvent)||m))if(gl.includes(W.key)&&B){const ie=W.key==="Escape";Ri({id:t,store:D,unselect:ie,nodeRef:k})}else R&&b.selected&&Object.prototype.hasOwnProperty.call(yr,W.key)&&(D.setState({ariaLiveMessage:`Moved selected node ${W.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~M.positionAbsolute.x}, y: ${~~M.positionAbsolute.y}`}),T({direction:yr[W.key],factor:W.shiftKey?4:1}))};return S.jsx("div",{className:we(["react-flow__node",`react-flow__node-${E}`,{[p]:R},b.className,{selected:b.selected,selectable:B,parent:C,draggable:R,dragging:O}]),ref:k,style:{zIndex:M.z,transform:`translate(${M.positionAbsolute.x}px,${M.positionAbsolute.y}px)`,pointerEvents:L?"all":"none",visibility:w?"visible":"hidden",...b.style,...j},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:q,onMouseMove:U,onMouseLeave:V,onContextMenu:Y,onClick:K,onDoubleClick:X,onKeyDown:F?ne:void 0,tabIndex:F?0:void 0,role:F?"button":void 0,"aria-describedby":m?void 0:`${wu}-${f}`,"aria-label":b.ariaLabel,children:S.jsx(Iv,{value:t,children:S.jsx(A,{id:t,data:b.data,type:E,positionAbsoluteX:M.positionAbsolute.x,positionAbsoluteY:M.positionAbsolute.y,selected:b.selected,selectable:B,draggable:R,deletable:b.deletable??!0,isConnectable:$,sourcePosition:b.sourcePosition,targetPosition:b.targetPosition,dragging:O,dragHandle:b.dragHandle,zIndex:M.z,parentId:b.parentId,...N})})})}const ex=t=>({nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,nodesFocusable:t.nodesFocusable,elementsSelectable:t.elementsSelectable,onError:t.onError});function qu(t){const{nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,onError:o}=de(ex,ge),s=Zv(t.onlyRenderVisibleElements),a=Xv();return S.jsx("div",{className:"react-flow__nodes",style:mr,children:s.map(c=>S.jsx(Jv,{id:c,nodeTypes:t.nodeTypes,nodeExtent:t.nodeExtent,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,resizeObserver:a,nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,nodeClickDistance:t.nodeClickDistance,onError:o},c))})}qu.displayName="NodeRenderer";const tx=_.memo(qu);function nx(t){return de(_.useCallback(e=>{if(!t)return e.edges.map(r=>r.id);const n=[];if(e.width&&e.height)for(const r of e.edges){const i=e.nodeLookup.get(r.source),o=e.nodeLookup.get(r.target);i&&o&&c1({sourceNode:i,targetNode:o,width:e.width,height:e.height,transform:e.transform})&&n.push(r.id)}return n},[t]),ge)}const rx=({color:t="none",strokeWidth:e=1})=>S.jsx("polyline",{style:{stroke:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),ix=({color:t="none",strokeWidth:e=1})=>S.jsx("polyline",{style:{stroke:t,fill:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),Wu={[rr.Arrow]:rx,[rr.ArrowClosed]:ix};function ox(t){const e=ye();return _.useMemo(()=>{var n,r;return Object.prototype.hasOwnProperty.call(Wu,t)?Wu[t]:((r=(n=e.getState()).onError)==null||r.call(n,"009",nt.error009(t)),null)},[t])}const sx=({id:t,type:e,color:n,width:r=12.5,height:i=12.5,markerUnits:o="strokeWidth",strokeWidth:s,orient:a="auto-start-reverse"})=>{const c=ox(e);return c?S.jsx("marker",{className:"react-flow__arrowhead",id:t,markerWidth:`${r}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:o,orient:a,refX:"0",refY:"0",children:S.jsx(c,{color:n,strokeWidth:s})}):null},Hu=({defaultColor:t,rfId:e})=>{const n=de(o=>o.edges),r=de(o=>o.defaultEdgeOptions),i=_.useMemo(()=>m1(n,{id:e,defaultColor:t,defaultMarkerStart:r==null?void 0:r.markerStart,defaultMarkerEnd:r==null?void 0:r.markerEnd}),[n,r,e,t]);return i.length?S.jsx("svg",{className:"react-flow__marker",children:S.jsx("defs",{children:i.map(o=>S.jsx(sx,{id:o.id,type:o.type,color:o.color,width:o.width,height:o.height,markerUnits:o.markerUnits,strokeWidth:o.strokeWidth,orient:o.orient},o.id))})}):null};Hu.displayName="MarkerDefinitions";var ax=_.memo(Hu);function Uu({x:t,y:e,label:n,labelStyle:r={},labelShowBg:i=!0,labelBgStyle:o={},labelBgPadding:s=[2,4],labelBgBorderRadius:a=2,children:c,className:l,...d}){const[u,h]=_.useState({x:1,y:0,width:0,height:0}),p=we(["react-flow__edge-textwrapper",l]),m=_.useRef(null);return _.useEffect(()=>{if(m.current){const f=m.current.getBBox();h({x:f.x,y:f.y,width:f.width,height:f.height})}},[n]),typeof n>"u"||!n?null:S.jsxs("g",{transform:`translate(${t-u.width/2} ${e-u.height/2})`,className:p,visibility:u.width?"visible":"hidden",...d,children:[i&&S.jsx("rect",{width:u.width+2*s[0],x:-s[0],y:-s[1],height:u.height+2*s[1],className:"react-flow__edge-textbg",style:o,rx:a,ry:a}),S.jsx("text",{className:"react-flow__edge-text",y:u.height/2,dy:"0.3em",ref:m,style:r,children:n}),c]})}Uu.displayName="EdgeText";const cx=_.memo(Uu);function gr({id:t,path:e,labelX:n,labelY:r,label:i,labelStyle:o,labelShowBg:s,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,style:d,markerEnd:u,markerStart:h,className:p,interactionWidth:m=20}){return S.jsxs(S.Fragment,{children:[S.jsx("path",{id:t,style:d,d:e,fill:"none",className:we(["react-flow__edge-path",p]),markerEnd:u,markerStart:h}),m&&S.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:m,className:"react-flow__edge-interaction"}),i&&Ve(n)&&Ve(r)?S.jsx(cx,{x:n,y:r,label:i,labelStyle:o,labelShowBg:s,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l}):null]})}function Qu({pos:t,x1:e,y1:n,x2:r,y2:i}){return t===re.Left||t===re.Right?[.5*(e+r),n]:[e,.5*(n+i)]}function Yu({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top}){const[s,a]=Qu({pos:n,x1:t,y1:e,x2:r,y2:i}),[c,l]=Qu({pos:o,x1:r,y1:i,x2:t,y2:e}),[d,u,h,p]=Bl({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:s,sourceControlY:a,targetControlX:c,targetControlY:l});return[`M${t},${e} C${s},${a} ${c},${l} ${r},${i}`,d,u,h,p]}function Zu(t){return _.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,sourcePosition:s=re.Bottom,targetPosition:a=re.Top,label:c,labelStyle:l,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:g,interactionWidth:y})=>{const[x,v,b]=Yu({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:o,targetPosition:a}),M=t.isInternal?void 0:e;return S.jsx(gr,{id:M,path:x,labelX:v,labelY:b,label:c,labelStyle:l,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:g,interactionWidth:y})})}const lx=Zu({isInternal:!1}),Gu=Zu({isInternal:!0});lx.displayName="SimpleBezierEdge",Gu.displayName="SimpleBezierEdgeInternal";function Xu(t){return _.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:u,style:h,sourcePosition:p=re.Bottom,targetPosition:m=re.Top,markerEnd:f,markerStart:g,pathOptions:y,interactionWidth:x})=>{const[v,b,M]=xi({sourceX:n,sourceY:r,sourcePosition:p,targetX:i,targetY:o,targetPosition:m,borderRadius:y==null?void 0:y.borderRadius,offset:y==null?void 0:y.offset}),C=t.isInternal?void 0:e;return S.jsx(gr,{id:C,path:v,labelX:b,labelY:M,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:g,interactionWidth:x})})}const Ku=Xu({isInternal:!1}),Ju=Xu({isInternal:!0});Ku.displayName="SmoothStepEdge",Ju.displayName="SmoothStepEdgeInternal";function ed(t){return _.memo(({id:e,...n})=>{var i;const r=t.isInternal?void 0:e;return S.jsx(Ku,{...n,id:r,pathOptions:_.useMemo(()=>{var o;return{borderRadius:0,offset:(o=n.pathOptions)==null?void 0:o.offset}},[(i=n.pathOptions)==null?void 0:i.offset])})})}const ux=ed({isInternal:!1}),td=ed({isInternal:!0});ux.displayName="StepEdge",td.displayName="StepEdgeInternal";function nd(t){return _.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:p,markerStart:m,interactionWidth:f})=>{const[g,y,x]=zl({sourceX:n,sourceY:r,targetX:i,targetY:o}),v=t.isInternal?void 0:e;return S.jsx(gr,{id:v,path:g,labelX:y,labelY:x,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:p,markerStart:m,interactionWidth:f})})}const dx=nd({isInternal:!1}),rd=nd({isInternal:!0});dx.displayName="StraightEdge",rd.displayName="StraightEdgeInternal";function id(t){return _.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,sourcePosition:s=re.Bottom,targetPosition:a=re.Top,label:c,labelStyle:l,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:g,pathOptions:y,interactionWidth:x})=>{const[v,b,M]=Dl({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:o,targetPosition:a,curvature:y==null?void 0:y.curvature}),C=t.isInternal?void 0:e;return S.jsx(gr,{id:C,path:v,labelX:b,labelY:M,label:c,labelStyle:l,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:f,markerStart:g,interactionWidth:x})})}const hx=id({isInternal:!1}),od=id({isInternal:!0});hx.displayName="BezierEdge",od.displayName="BezierEdgeInternal";const sd={default:od,straight:rd,step:td,smoothstep:Ju,simplebezier:Gu},ad={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},px=(t,e,n)=>n===re.Left?t-e:n===re.Right?t+e:t,fx=(t,e,n)=>n===re.Top?t-e:n===re.Bottom?t+e:t,cd="react-flow__edgeupdater";function ld({position:t,centerX:e,centerY:n,radius:r=10,onMouseDown:i,onMouseEnter:o,onMouseOut:s,type:a}){return S.jsx("circle",{onMouseDown:i,onMouseEnter:o,onMouseOut:s,className:we([cd,`${cd}-${a}`]),cx:px(e,r,t),cy:fx(n,r,t),r,stroke:"transparent",fill:"transparent"})}function mx({isReconnectable:t,reconnectRadius:e,edge:n,sourceX:r,sourceY:i,targetX:o,targetY:s,sourcePosition:a,targetPosition:c,onReconnect:l,onReconnectStart:d,onReconnectEnd:u,setReconnecting:h,setUpdateHover:p}){const m=ye(),f=(b,M)=>{if(b.button!==0)return;const{autoPanOnConnect:C,domNode:E,isValidConnection:A,connectionMode:R,connectionRadius:B,lib:$,onConnectStart:F,onConnectEnd:D,cancelConnection:w,nodeLookup:k,rfId:O,panBy:T,updateConnection:N}=m.getState(),j=M.type==="target";h(!0),d==null||d(b,n,M.type);const L=(U,V)=>{h(!1),u==null||u(U,n,M.type,V)},q=U=>l==null?void 0:l(n,U);Oi.onPointerDown(b.nativeEvent,{autoPanOnConnect:C,connectionMode:R,connectionRadius:B,domNode:E,handleId:M.id,nodeId:M.nodeId,nodeLookup:k,isTarget:j,edgeUpdaterType:M.type,lib:$,flowId:O,cancelConnection:w,panBy:T,isValidConnection:A,onConnect:q,onConnectStart:F,onConnectEnd:D,onReconnectEnd:L,updateConnection:N,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle})},g=b=>f(b,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),y=b=>f(b,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),x=()=>p(!0),v=()=>p(!1);return S.jsxs(S.Fragment,{children:[(t===!0||t==="source")&&S.jsx(ld,{position:a,centerX:r,centerY:i,radius:e,onMouseDown:g,onMouseEnter:x,onMouseOut:v,type:"source"}),(t===!0||t==="target")&&S.jsx(ld,{position:c,centerX:o,centerY:s,radius:e,onMouseDown:y,onMouseEnter:x,onMouseOut:v,type:"target"})]})}function yx({id:t,edgesFocusable:e,edgesReconnectable:n,elementsSelectable:r,onClick:i,onDoubleClick:o,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,reconnectRadius:d,onReconnect:u,onReconnectStart:h,onReconnectEnd:p,rfId:m,edgeTypes:f,noPanClassName:g,onError:y,disableKeyboardA11y:x}){let v=de(ae=>ae.edgeLookup.get(t));const b=de(ae=>ae.defaultEdgeOptions);v=b?{...b,...v}:v;let M=v.type||"default",C=(f==null?void 0:f[M])||sd[M];C===void 0&&(y==null||y("011",nt.error011(M)),M="default",C=sd.default);const E=!!(v.focusable||e&&typeof v.focusable>"u"),A=typeof u<"u"&&(v.reconnectable||n&&typeof v.reconnectable>"u"),R=!!(v.selectable||r&&typeof v.selectable>"u"),B=_.useRef(null),[$,F]=_.useState(!1),[D,w]=_.useState(!1),k=ye(),{zIndex:O,sourceX:T,sourceY:N,targetX:j,targetY:L,sourcePosition:q,targetPosition:U}=de(_.useCallback(ae=>{const he=ae.nodeLookup.get(v.source),pe=ae.nodeLookup.get(v.target);if(!he||!pe)return{zIndex:v.zIndex,...ad};const Te=f1({id:t,sourceNode:he,targetNode:pe,sourceHandle:v.sourceHandle||null,targetHandle:v.targetHandle||null,connectionMode:ae.connectionMode,onError:y});return{zIndex:a1({selected:v.selected,zIndex:v.zIndex,sourceNode:he,targetNode:pe,elevateOnSelect:ae.elevateEdgesOnSelect}),...Te||ad}},[v.source,v.target,v.sourceHandle,v.targetHandle,v.selected,v.zIndex]),ge),V=_.useMemo(()=>v.markerStart?`url('#${bi(v.markerStart,m)}')`:void 0,[v.markerStart,m]),Y=_.useMemo(()=>v.markerEnd?`url('#${bi(v.markerEnd,m)}')`:void 0,[v.markerEnd,m]);if(v.hidden||T===null||N===null||j===null||L===null)return null;const X=ae=>{var De;const{addSelectedEdges:he,unselectNodesAndEdges:pe,multiSelectionActive:Te}=k.getState();R&&(k.setState({nodesSelectionActive:!1}),v.selected&&Te?(pe({nodes:[],edges:[v]}),(De=B.current)==null||De.blur()):he([t])),i&&i(ae,v)},K=o?ae=>{o(ae,{...v})}:void 0,ne=s?ae=>{s(ae,{...v})}:void 0,W=a?ae=>{a(ae,{...v})}:void 0,ie=c?ae=>{c(ae,{...v})}:void 0,ce=l?ae=>{l(ae,{...v})}:void 0,oe=ae=>{var he;if(!x&&gl.includes(ae.key)&&R){const{unselectNodesAndEdges:pe,addSelectedEdges:Te}=k.getState();ae.key==="Escape"?((he=B.current)==null||he.blur(),pe({edges:[v]})):Te([t])}};return S.jsx("svg",{style:{zIndex:O},children:S.jsxs("g",{className:we(["react-flow__edge",`react-flow__edge-${M}`,v.className,g,{selected:v.selected,animated:v.animated,inactive:!R&&!i,updating:$,selectable:R}]),onClick:X,onDoubleClick:K,onContextMenu:ne,onMouseEnter:W,onMouseMove:ie,onMouseLeave:ce,onKeyDown:E?oe:void 0,tabIndex:E?0:void 0,role:E?"button":"img","data-id":t,"data-testid":`rf__edge-${t}`,"aria-label":v.ariaLabel===null?void 0:v.ariaLabel||`Edge from ${v.source} to ${v.target}`,"aria-describedby":E?`${Mu}-${m}`:void 0,ref:B,children:[!D&&S.jsx(C,{id:t,source:v.source,target:v.target,type:v.type,selected:v.selected,animated:v.animated,selectable:R,deletable:v.deletable??!0,label:v.label,labelStyle:v.labelStyle,labelShowBg:v.labelShowBg,labelBgStyle:v.labelBgStyle,labelBgPadding:v.labelBgPadding,labelBgBorderRadius:v.labelBgBorderRadius,sourceX:T,sourceY:N,targetX:j,targetY:L,sourcePosition:q,targetPosition:U,data:v.data,style:v.style,sourceHandleId:v.sourceHandle,targetHandleId:v.targetHandle,markerStart:V,markerEnd:Y,pathOptions:"pathOptions"in v?v.pathOptions:void 0,interactionWidth:v.interactionWidth}),A&&S.jsx(mx,{edge:v,isReconnectable:A,reconnectRadius:d,onReconnect:u,onReconnectStart:h,onReconnectEnd:p,sourceX:T,sourceY:N,targetX:j,targetY:L,sourcePosition:q,targetPosition:U,setUpdateHover:F,setReconnecting:w})]})})}const gx=t=>({width:t.width,height:t.height,edgesFocusable:t.edgesFocusable,edgesReconnectable:t.edgesReconnectable,elementsSelectable:t.elementsSelectable,connectionMode:t.connectionMode,onError:t.onError});function ud({defaultMarkerColor:t,onlyRenderVisibleElements:e,rfId:n,edgeTypes:r,noPanClassName:i,onReconnect:o,onEdgeContextMenu:s,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:l,onEdgeClick:d,reconnectRadius:u,onEdgeDoubleClick:h,onReconnectStart:p,onReconnectEnd:m,disableKeyboardA11y:f}){const{edgesFocusable:g,edgesReconnectable:y,elementsSelectable:x,onError:v}=de(gx,ge),b=nx(e);return S.jsxs("div",{className:"react-flow__edges",children:[S.jsx(ax,{defaultColor:t,rfId:n}),b.map(M=>S.jsx(yx,{id:M,edgesFocusable:g,edgesReconnectable:y,elementsSelectable:x,noPanClassName:i,onReconnect:o,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,onClick:d,reconnectRadius:u,onDoubleClick:h,onReconnectStart:p,onReconnectEnd:m,rfId:n,onError:v,edgeTypes:r,disableKeyboardA11y:f},M))]})}ud.displayName="EdgeRenderer";const vx=_.memo(ud),xx=t=>`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`;function bx({children:t}){const e=de(xx);return S.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:t})}function wx(t){const e=jn(),n=_.useRef(!1);_.useEffect(()=>{!n.current&&e.viewportInitialized&&t&&(setTimeout(()=>t(e),1),n.current=!0)},[t,e.viewportInitialized])}const Mx=t=>{var e;return(e=t.panZoom)==null?void 0:e.syncViewport};function Ex(t){const e=de(Mx),n=ye();return _.useEffect(()=>{t&&(e==null||e(t),n.setState({transform:[t.x,t.y,t.zoom]}))},[t,e]),null}function _x(t){return t.connection.inProgress?{...t.connection,to:yn(t.connection.to,t.transform)}:{...t.connection}}function Cx(t){return _x}function Sx(t){const e=Cx();return de(e,ge)}const Ox=t=>({nodesConnectable:t.nodesConnectable,isValid:t.connection.isValid,inProgress:t.connection.inProgress,width:t.width,height:t.height});function Nx({containerStyle:t,style:e,type:n,component:r}){const{nodesConnectable:i,width:o,height:s,isValid:a,inProgress:c}=de(Ox,ge);return o&&i&&c?S.jsx("svg",{style:t,width:o,height:s,className:"react-flow__connectionline react-flow__container",children:S.jsx("g",{className:we(["react-flow__connection",wl(a)]),children:S.jsx(dd,{style:e,type:n,CustomComponent:r,isValid:a})})}):null}const dd=({style:t,type:e=at.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:i,from:o,fromNode:s,fromHandle:a,fromPosition:c,to:l,toNode:d,toHandle:u,toPosition:h}=Sx();if(!i)return;if(n)return S.jsx(n,{connectionLineType:e,connectionLineStyle:t,fromNode:s,fromHandle:a,fromX:o.x,fromY:o.y,toX:l.x,toY:l.y,fromPosition:c,toPosition:h,connectionStatus:wl(r),toNode:d,toHandle:u});let p="";const m={sourceX:o.x,sourceY:o.y,sourcePosition:c,targetX:l.x,targetY:l.y,targetPosition:h};switch(e){case at.Bezier:[p]=Dl(m);break;case at.SimpleBezier:[p]=Yu(m);break;case at.Step:[p]=xi({...m,borderRadius:0});break;case at.SmoothStep:[p]=xi(m);break;default:[p]=zl(m)}return S.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:t})};dd.displayName="ConnectionLine";const Px={};function hd(t=Px){_.useRef(t),ye(),_.useEffect(()=>{},[t])}function Ax(){ye(),_.useRef(!1),_.useEffect(()=>{},[])}function pd({nodeTypes:t,edgeTypes:e,onInit:n,onNodeClick:r,onEdgeClick:i,onNodeDoubleClick:o,onEdgeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:d,onSelectionContextMenu:u,onSelectionStart:h,onSelectionEnd:p,connectionLineType:m,connectionLineStyle:f,connectionLineComponent:g,connectionLineContainerStyle:y,selectionKeyCode:x,selectionOnDrag:v,selectionMode:b,multiSelectionKeyCode:M,panActivationKeyCode:C,zoomActivationKeyCode:E,deleteKeyCode:A,onlyRenderVisibleElements:R,elementsSelectable:B,defaultViewport:$,translateExtent:F,minZoom:D,maxZoom:w,preventScrolling:k,defaultMarkerColor:O,zoomOnScroll:T,zoomOnPinch:N,panOnScroll:j,panOnScrollSpeed:L,panOnScrollMode:q,zoomOnDoubleClick:U,panOnDrag:V,onPaneClick:Y,onPaneMouseEnter:X,onPaneMouseMove:K,onPaneMouseLeave:ne,onPaneScroll:W,onPaneContextMenu:ie,paneClickDistance:ce,nodeClickDistance:oe,onEdgeContextMenu:ae,onEdgeMouseEnter:he,onEdgeMouseMove:pe,onEdgeMouseLeave:Te,reconnectRadius:De,onReconnect:ut,onReconnectStart:ot,onReconnectEnd:dt,noDragClassName:qe,noWheelClassName:Ee,noPanClassName:Oe,disableKeyboardA11y:Ze,nodeExtent:wt,rfId:Mt,viewport:Et,onViewportChange:Ge}){return hd(t),hd(e),Ax(),wx(n),Ex(Et),S.jsx(Qv,{onPaneClick:Y,onPaneMouseEnter:X,onPaneMouseMove:K,onPaneMouseLeave:ne,onPaneContextMenu:ie,onPaneScroll:W,paneClickDistance:ce,deleteKeyCode:A,selectionKeyCode:x,selectionOnDrag:v,selectionMode:b,onSelectionStart:h,onSelectionEnd:p,multiSelectionKeyCode:M,panActivationKeyCode:C,zoomActivationKeyCode:E,elementsSelectable:B,zoomOnScroll:T,zoomOnPinch:N,zoomOnDoubleClick:U,panOnScroll:j,panOnScrollSpeed:L,panOnScrollMode:q,panOnDrag:V,defaultViewport:$,translateExtent:F,minZoom:D,maxZoom:w,onSelectionContextMenu:u,preventScrolling:k,noDragClassName:qe,noWheelClassName:Ee,noPanClassName:Oe,disableKeyboardA11y:Ze,onViewportChange:Ge,isControlledViewport:!!Et,children:S.jsxs(bx,{children:[S.jsx(vx,{edgeTypes:e,onEdgeClick:i,onEdgeDoubleClick:s,onReconnect:ut,onReconnectStart:ot,onReconnectEnd:dt,onlyRenderVisibleElements:R,onEdgeContextMenu:ae,onEdgeMouseEnter:he,onEdgeMouseMove:pe,onEdgeMouseLeave:Te,reconnectRadius:De,defaultMarkerColor:O,noPanClassName:Oe,disableKeyboardA11y:Ze,rfId:Mt}),S.jsx(Nx,{style:f,type:m,component:g,containerStyle:y}),S.jsx("div",{className:"react-flow__edgelabel-renderer"}),S.jsx(tx,{nodeTypes:t,onNodeClick:r,onNodeDoubleClick:o,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:d,nodeClickDistance:oe,onlyRenderVisibleElements:R,noPanClassName:Oe,noDragClassName:qe,disableKeyboardA11y:Ze,nodeExtent:wt,rfId:Mt}),S.jsx("div",{className:"react-flow__viewport-portal"})]})})}pd.displayName="GraphView";const kx=_.memo(pd),fd=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c}={})=>{const l=new Map,d=new Map,u=new Map,h=new Map,p=r??e??[],m=n??t??[],f=a??[0,0],g=c??dn;Yl(u,h,p),Ei(m,l,d,{nodeOrigin:f,nodeExtent:g,elevateNodesOnSelect:!1});let y=[0,0,1];if(s&&i&&o){const x=fn(l,{filter:C=>!!((C.width||C.initialWidth)&&(C.height||C.initialHeight))}),{x:v,y:b,zoom:M}=gi(x,i,o,.5,2,.1);y=[v,b,M]}return{rfId:"1",width:0,height:0,transform:y,nodes:m,nodeLookup:l,parentLookup:d,edges:p,edgeLookup:h,connectionLookup:u,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:.5,maxZoom:2,translateExtent:dn,nodeExtent:g,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:It.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:f,nodeDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,fitViewOnInit:!1,fitViewDone:!1,fitViewOnInitOptions:void 0,selectNodesOnDrag:!0,multiSelectionActive:!1,connection:{...vl},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanSpeed:15,connectionRadius:20,onError:o1,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1}},Tx=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c})=>X1((l,d)=>({...fd({nodes:t,edges:e,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c,defaultNodes:n,defaultEdges:r}),setNodes:u=>{const{nodeLookup:h,parentLookup:p,nodeOrigin:m,elevateNodesOnSelect:f}=d();Ei(u,h,p,{nodeOrigin:m,nodeExtent:c,elevateNodesOnSelect:f,checkEquality:!0}),l({nodes:u})},setEdges:u=>{const{connectionLookup:h,edgeLookup:p}=d();Yl(h,p,u),l({edges:u})},setDefaultNodesAndEdges:(u,h)=>{if(u){const{setNodes:p}=d();p(u),l({hasDefaultNodes:!0})}if(h){const{setEdges:p}=d();p(h),l({hasDefaultEdges:!0})}},updateNodeInternals:(u,h={triggerFitView:!0})=>{const{triggerNodeChanges:p,nodeLookup:m,parentLookup:f,fitViewOnInit:g,fitViewDone:y,fitViewOnInitOptions:x,domNode:v,nodeOrigin:b,nodeExtent:M,debug:C,fitViewSync:E}=d(),{changes:A,updatedInternals:R}=b1(u,m,f,v,b,M);if(R){if(g1(m,f,{nodeOrigin:b,nodeExtent:M}),h.triggerFitView){let B=y;!y&&g&&(B=E({...x,nodes:x==null?void 0:x.nodes})),l({fitViewDone:B})}else l({});(A==null?void 0:A.length)>0&&(C&&console.log("React Flow: trigger node changes",A),p==null||p(A))}},updateNodePositions:(u,h=!1)=>{const p=[],m=[];for(const[f,g]of u){const y={id:f,type:"position",position:g.position,dragging:h};g!=null&&g.expandParent&&(g!=null&&g.parentId)&&y.position&&(p.push({id:f,parentId:g.parentId,rect:{...g.internals.positionAbsolute,width:g.measured.width,height:g.measured.height}}),y.position.x=Math.max(0,y.position.x),y.position.y=Math.max(0,y.position.y)),m.push(y)}if(p.length>0){const{nodeLookup:f,parentLookup:g,nodeOrigin:y}=d(),x=Ci(p,f,g,y);m.push(...x)}d().triggerNodeChanges(m)},triggerNodeChanges:u=>{const{onNodesChange:h,setNodes:p,nodes:m,hasDefaultNodes:f,debug:g}=d();if(u!=null&&u.length){if(f){const y=ht(u,m);p(y)}g&&console.log("React Flow: trigger node changes",u),h==null||h(u)}},triggerEdgeChanges:u=>{const{onEdgesChange:h,setEdges:p,edges:m,hasDefaultEdges:f,debug:g}=d();if(u!=null&&u.length){if(f){const y=bn(u,m);p(y)}g&&console.log("React Flow: trigger edge changes",u),h==null||h(u)}},addSelectedNodes:u=>{const{multiSelectionActive:h,edgeLookup:p,nodeLookup:m,triggerNodeChanges:f,triggerEdgeChanges:g}=d();if(h){const y=u.map(x=>vt(x,!0));f(y);return}f(zt(m,new Set([...u]),!0)),g(zt(p))},addSelectedEdges:u=>{const{multiSelectionActive:h,edgeLookup:p,nodeLookup:m,triggerNodeChanges:f,triggerEdgeChanges:g}=d();if(h){const y=u.map(x=>vt(x,!0));g(y);return}g(zt(p,new Set([...u]))),f(zt(m,new Set,!0))},unselectNodesAndEdges:({nodes:u,edges:h}={})=>{const{edges:p,nodes:m,nodeLookup:f,triggerNodeChanges:g,triggerEdgeChanges:y}=d(),x=u||m,v=h||p,b=x.map(C=>{const E=f.get(C.id);return E&&(E.selected=!1),vt(C.id,!1)}),M=v.map(C=>vt(C.id,!1));g(b),y(M)},setMinZoom:u=>{const{panZoom:h,maxZoom:p}=d();h==null||h.setScaleExtent([u,p]),l({minZoom:u})},setMaxZoom:u=>{const{panZoom:h,minZoom:p}=d();h==null||h.setScaleExtent([p,u]),l({maxZoom:u})},setTranslateExtent:u=>{var h;(h=d().panZoom)==null||h.setTranslateExtent(u),l({translateExtent:u})},setPaneClickDistance:u=>{var h;(h=d().panZoom)==null||h.setClickDistance(u)},resetSelectedElements:()=>{const{edges:u,nodes:h,triggerNodeChanges:p,triggerEdgeChanges:m}=d(),f=h.reduce((y,x)=>x.selected?[...y,vt(x.id,!1)]:y,[]),g=u.reduce((y,x)=>x.selected?[...y,vt(x.id,!1)]:y,[]);p(f),m(g)},setNodeExtent:u=>{const{nodes:h,nodeLookup:p,parentLookup:m,nodeOrigin:f,elevateNodesOnSelect:g,nodeExtent:y}=d();u[0][0]===y[0][0]&&u[0][1]===y[0][1]&&u[1][0]===y[1][0]&&u[1][1]===y[1][1]||(Ei(h,p,m,{nodeOrigin:f,nodeExtent:u,elevateNodesOnSelect:g,checkEquality:!1}),l({nodeExtent:u}))},panBy:u=>{const{transform:h,width:p,height:m,panZoom:f,translateExtent:g}=d();return w1({delta:u,panZoom:f,transform:h,translateExtent:g,width:p,height:m})},fitView:u=>{const{panZoom:h,width:p,height:m,minZoom:f,maxZoom:g,nodeLookup:y}=d();if(!h)return Promise.resolve(!1);const x=fi(y,u);return mi({nodes:x,width:p,height:m,panZoom:h,minZoom:f,maxZoom:g},u)},fitViewSync:u=>{const{panZoom:h,width:p,height:m,minZoom:f,maxZoom:g,nodeLookup:y}=d();if(!h)return!1;const x=fi(y,u);return mi({nodes:x,width:p,height:m,panZoom:h,minZoom:f,maxZoom:g},u),x.size>0},cancelConnection:()=>{l({connection:{...vl}})},updateConnection:u=>{l({connection:u})},reset:()=>l({...fd()})}),Object.is);function jx({initialNodes:t,initialEdges:e,defaultNodes:n,defaultEdges:r,initialWidth:i,initialHeight:o,fitView:s,nodeOrigin:a,nodeExtent:c,children:l}){const[d]=_.useState(()=>Tx({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c}));return S.jsx(K1,{value:d,children:S.jsx(wv,{children:l})})}function Rx({children:t,nodes:e,edges:n,defaultNodes:r,defaultEdges:i,width:o,height:s,fitView:a,nodeOrigin:c,nodeExtent:l}){return _.useContext(pr)?S.jsx(S.Fragment,{children:t}):S.jsx(jx,{initialNodes:e,initialEdges:n,defaultNodes:r,defaultEdges:i,initialWidth:o,initialHeight:s,fitView:a,nodeOrigin:c,nodeExtent:l,children:t})}const Ix={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Bx({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,className:i,nodeTypes:o,edgeTypes:s,onNodeClick:a,onEdgeClick:c,onInit:l,onMove:d,onMoveStart:u,onMoveEnd:h,onConnect:p,onConnectStart:m,onConnectEnd:f,onClickConnectStart:g,onClickConnectEnd:y,onNodeMouseEnter:x,onNodeMouseMove:v,onNodeMouseLeave:b,onNodeContextMenu:M,onNodeDoubleClick:C,onNodeDragStart:E,onNodeDrag:A,onNodeDragStop:R,onNodesDelete:B,onEdgesDelete:$,onDelete:F,onSelectionChange:D,onSelectionDragStart:w,onSelectionDrag:k,onSelectionDragStop:O,onSelectionContextMenu:T,onSelectionStart:N,onSelectionEnd:j,onBeforeDelete:L,connectionMode:q,connectionLineType:U=at.Bezier,connectionLineStyle:V,connectionLineComponent:Y,connectionLineContainerStyle:X,deleteKeyCode:K="Backspace",selectionKeyCode:ne="Shift",selectionOnDrag:W=!1,selectionMode:ie=hn.Full,panActivationKeyCode:ce="Space",multiSelectionKeyCode:oe=cr()?"Meta":"Control",zoomActivationKeyCode:ae=cr()?"Meta":"Control",snapToGrid:he,snapGrid:pe,onlyRenderVisibleElements:Te=!1,selectNodesOnDrag:De,nodesDraggable:ut,nodesConnectable:ot,nodesFocusable:dt,nodeOrigin:qe=Eu,edgesFocusable:Ee,edgesReconnectable:Oe,elementsSelectable:Ze=!0,defaultViewport:wt=dv,minZoom:Mt=.5,maxZoom:Et=2,translateExtent:Ge=dn,preventScrolling:Ra=!0,nodeExtent:Cn,defaultMarkerColor:Ia="#b1b1b7",zoomOnScroll:Sn=!0,zoomOnPinch:P=!0,panOnScroll:I=!1,panOnScrollSpeed:z=.5,panOnScrollMode:H=pt.Free,zoomOnDoubleClick:se=!0,panOnDrag:_e=!0,onPaneClick:be,onPaneMouseEnter:le,onPaneMouseMove:Z,onPaneMouseLeave:J,onPaneScroll:ee,onPaneContextMenu:te,paneClickDistance:ue=0,nodeClickDistance:me=0,children:xe,onReconnect:Be,onReconnectStart:Ar,onReconnectEnd:Ba,onEdgeContextMenu:$a,onEdgeDoubleClick:SM,onEdgeMouseEnter:OM,onEdgeMouseMove:NM,onEdgeMouseLeave:PM,reconnectRadius:AM=10,onNodesChange:kM,onEdgesChange:TM,noDragClassName:jM="nodrag",noWheelClassName:RM="nowheel",noPanClassName:Qf="nopan",fitView:Yf,fitViewOptions:IM,connectOnClick:BM,attributionPosition:$M,proOptions:DM,defaultEdgeOptions:LM,elevateNodesOnSelect:FM,elevateEdgesOnSelect:zM,disableKeyboardA11y:Zf=!1,autoPanOnConnect:VM,autoPanOnNodeDrag:qM,autoPanSpeed:WM,connectionRadius:HM,isValidConnection:UM,onError:QM,style:YM,id:Gf,nodeDragThreshold:ZM,viewport:GM,onViewportChange:XM,width:KM,height:JM,colorMode:eE="light",debug:tE,...nE},rE){const Da=Gf||"1",iE=mv(eE);return S.jsx("div",{...nE,style:{...YM,...Ix},ref:rE,className:we(["react-flow",i,iE]),"data-testid":"rf__wrapper",id:Gf,children:S.jsxs(Rx,{nodes:t,edges:e,width:KM,height:JM,fitView:Yf,nodeOrigin:qe,nodeExtent:Cn,children:[S.jsx(kx,{onInit:l,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:x,onNodeMouseMove:v,onNodeMouseLeave:b,onNodeContextMenu:M,onNodeDoubleClick:C,nodeTypes:o,edgeTypes:s,connectionLineType:U,connectionLineStyle:V,connectionLineComponent:Y,connectionLineContainerStyle:X,selectionKeyCode:ne,selectionOnDrag:W,selectionMode:ie,deleteKeyCode:K,multiSelectionKeyCode:oe,panActivationKeyCode:ce,zoomActivationKeyCode:ae,onlyRenderVisibleElements:Te,defaultViewport:wt,translateExtent:Ge,minZoom:Mt,maxZoom:Et,preventScrolling:Ra,zoomOnScroll:Sn,zoomOnPinch:P,zoomOnDoubleClick:se,panOnScroll:I,panOnScrollSpeed:z,panOnScrollMode:H,panOnDrag:_e,onPaneClick:be,onPaneMouseEnter:le,onPaneMouseMove:Z,onPaneMouseLeave:J,onPaneScroll:ee,onPaneContextMenu:te,paneClickDistance:ue,nodeClickDistance:me,onSelectionContextMenu:T,onSelectionStart:N,onSelectionEnd:j,onReconnect:Be,onReconnectStart:Ar,onReconnectEnd:Ba,onEdgeContextMenu:$a,onEdgeDoubleClick:SM,onEdgeMouseEnter:OM,onEdgeMouseMove:NM,onEdgeMouseLeave:PM,reconnectRadius:AM,defaultMarkerColor:Ia,noDragClassName:jM,noWheelClassName:RM,noPanClassName:Qf,rfId:Da,disableKeyboardA11y:Zf,nodeExtent:Cn,viewport:GM,onViewportChange:XM}),S.jsx(fv,{nodes:t,edges:e,defaultNodes:n,defaultEdges:r,onConnect:p,onConnectStart:m,onConnectEnd:f,onClickConnectStart:g,onClickConnectEnd:y,nodesDraggable:ut,nodesConnectable:ot,nodesFocusable:dt,edgesFocusable:Ee,edgesReconnectable:Oe,elementsSelectable:Ze,elevateNodesOnSelect:FM,elevateEdgesOnSelect:zM,minZoom:Mt,maxZoom:Et,nodeExtent:Cn,onNodesChange:kM,onEdgesChange:TM,snapToGrid:he,snapGrid:pe,connectionMode:q,translateExtent:Ge,connectOnClick:BM,defaultEdgeOptions:LM,fitView:Yf,fitViewOptions:IM,onNodesDelete:B,onEdgesDelete:$,onDelete:F,onNodeDragStart:E,onNodeDrag:A,onNodeDragStop:R,onSelectionDrag:k,onSelectionDragStart:w,onSelectionDragStop:O,onMove:d,onMoveStart:u,onMoveEnd:h,noPanClassName:Qf,nodeOrigin:qe,rfId:Da,autoPanOnConnect:VM,autoPanOnNodeDrag:qM,autoPanSpeed:WM,onError:QM,connectionRadius:HM,isValidConnection:UM,selectNodesOnDrag:De,nodeDragThreshold:ZM,onBeforeDelete:L,paneClickDistance:ue,debug:tE}),S.jsx(uv,{onSelectionChange:D}),xe,S.jsx(ov,{proOptions:DM,position:$M}),S.jsx(rv,{rfId:Da,disableKeyboardA11y:Zf})]})})}cm=Ru(Bx);const $x=t=>{var e;return(e=t.domNode)==null?void 0:e.querySelector(".react-flow__viewport-portal")};sm=function({children:t}){const e=de($x);return e?uE.createPortal(t,e):null};const Dx=t=>t.nodes;om=function(){return de(Dx,ge)},mm=function({type:t,id:e=null,nodeId:n,onConnect:r,onDisconnect:i}){const o=Bi(),s=n??o,a=_.useRef(null),c=de(l=>l.connectionLookup.get(`${s}-${t}-${e}`),e1);return _.useEffect(()=>{if(a.current&&a.current!==c){const l=c??new Map;bl(a.current,l,i),bl(l,a.current,r)}a.current=c??new Map},[c,r,i]),_.useMemo(()=>Array.from((c==null?void 0:c.values())??[]),[c])},xm=function(t){return de(_.useCallback(e=>e.nodeLookup.get(t),[t]),ge)};function Lx({dimensions:t,lineWidth:e,variant:n,className:r}){return S.jsx("path",{strokeWidth:e,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`,className:we(["react-flow__background-pattern",n,r])})}function Fx({radius:t,className:e}){return S.jsx("circle",{cx:t,cy:t,r:t,className:we(["react-flow__background-pattern","dots",e])})}(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(st||(st={}));const zx={[st.Dots]:1,[st.Lines]:1,[st.Cross]:6},Vx=t=>({transform:t.transform,patternId:`pattern-${t.rfId}`});function md({id:t,variant:e=st.Dots,gap:n=20,size:r,lineWidth:i=1,offset:o=0,color:s,bgColor:a,style:c,className:l,patternClassName:d}){const u=_.useRef(null),{transform:h,patternId:p}=de(Vx,ge),m=r||zx[e],f=e===st.Dots,g=e===st.Cross,y=Array.isArray(n)?n:[n,n],x=[y[0]*h[2]||1,y[1]*h[2]||1],v=m*h[2],b=Array.isArray(o)?o:[o,o],M=g?[v,v]:x,C=[b[0]*h[2]||1+M[0]/2,b[1]*h[2]||1+M[1]/2],E=`${p}${t||""}`;return S.jsxs("svg",{className:we(["react-flow__background",l]),style:{...c,...mr,"--xy-background-color-props":a,"--xy-background-pattern-color-props":s},ref:u,"data-testid":"rf__background",children:[S.jsx("pattern",{id:E,x:h[0]%x[0],y:h[1]%x[1],width:x[0],height:x[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${C[0]},-${C[1]})`,children:f?S.jsx(Fx,{radius:v/2,className:d}):S.jsx(Lx,{dimensions:M,lineWidth:i,variant:e,className:d})}),S.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${E})`})]})}md.displayName="Background",lm=_.memo(md);function qx(){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:S.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Wx(){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:S.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Hx(){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:S.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Ux(){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:S.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Qx(){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:S.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function vr({children:t,className:e,...n}){return S.jsx("button",{type:"button",className:we(["react-flow__controls-button",e]),...n,children:t})}const Yx=t=>({isInteractive:t.nodesDraggable||t.nodesConnectable||t.elementsSelectable,minZoomReached:t.transform[2]<=t.minZoom,maxZoomReached:t.transform[2]>=t.maxZoom});function yd({style:t,showZoom:e=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:o,onZoomOut:s,onFitView:a,onInteractiveChange:c,className:l,children:d,position:u="bottom-left",orientation:h="vertical","aria-label":p="React Flow controls"}){const m=ye(),{isInteractive:f,minZoomReached:g,maxZoomReached:y}=de(Yx,ge),{zoomIn:x,zoomOut:v,fitView:b}=jn(),M=()=>{x(),o==null||o()},C=()=>{v(),s==null||s()},E=()=>{b(i),a==null||a()},A=()=>{m.setState({nodesDraggable:!f,nodesConnectable:!f,elementsSelectable:!f}),c==null||c(!f)},R=h==="horizontal"?"horizontal":"vertical";return S.jsxs(kn,{className:we(["react-flow__controls",R,l]),position:u,style:t,"data-testid":"rf__controls","aria-label":p,children:[e&&S.jsxs(S.Fragment,{children:[S.jsx(vr,{onClick:M,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:y,children:S.jsx(qx,{})}),S.jsx(vr,{onClick:C,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:g,children:S.jsx(Wx,{})})]}),n&&S.jsx(vr,{className:"react-flow__controls-fitview",onClick:E,title:"fit view","aria-label":"fit view",children:S.jsx(Hx,{})}),r&&S.jsx(vr,{className:"react-flow__controls-interactive",onClick:A,title:"toggle interactivity","aria-label":"toggle interactivity",children:f?S.jsx(Qx,{}):S.jsx(Ux,{})}),d]})}yd.displayName="Controls",um=_.memo(yd);function Zx({id:t,x:e,y:n,width:r,height:i,style:o,color:s,strokeColor:a,strokeWidth:c,className:l,borderRadius:d,shapeRendering:u,selected:h,onClick:p}){const{background:m,backgroundColor:f}=o||{},g=s||m||f;return S.jsx("rect",{className:we(["react-flow__minimap-node",{selected:h},l]),x:e,y:n,rx:d,ry:d,width:r,height:i,style:{fill:g,stroke:a,strokeWidth:c},shapeRendering:u,onClick:p?y=>p(y,t):void 0})}const Gx=_.memo(Zx),Xx=t=>t.nodes.map(e=>e.id),$i=t=>t instanceof Function?t:()=>t;function Kx({nodeStrokeColor:t,nodeColor:e,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:o=Gx,onClick:s}){const a=de(Xx,ge),c=$i(e),l=$i(t),d=$i(n),u=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return S.jsx(S.Fragment,{children:a.map(h=>S.jsx(eb,{id:h,nodeColorFunc:c,nodeStrokeColorFunc:l,nodeClassNameFunc:d,nodeBorderRadius:r,nodeStrokeWidth:i,NodeComponent:o,onClick:s,shapeRendering:u},h))})}function Jx({id:t,nodeColorFunc:e,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:i,nodeStrokeWidth:o,shapeRendering:s,NodeComponent:a,onClick:c}){const{node:l,x:d,y:u,width:h,height:p}=de(m=>{const f=m.nodeLookup.get(t),{x:g,y}=f.internals.positionAbsolute,{width:x,height:v}=rt(f);return{node:f,x:g,y,width:x,height:v}},ge);return!l||l.hidden||!kl(l)?null:S.jsx(a,{x:d,y:u,width:h,height:p,style:l.style,selected:!!l.selected,className:r(l),color:e(l),borderRadius:i,strokeColor:n(l),strokeWidth:o,shapeRendering:s,onClick:c,id:l.id})}const eb=_.memo(Jx);var tb=_.memo(Kx);const nb=200,rb=150,ib=t=>{const e={x:-t.transform[0]/t.transform[2],y:-t.transform[1]/t.transform[2],width:t.width/t.transform[2],height:t.height/t.transform[2]};return{viewBB:e,boundingRect:t.nodeLookup.size>0?Nl(fn(t.nodeLookup),e):e,rfId:t.rfId,panZoom:t.panZoom,translateExtent:t.translateExtent,flowWidth:t.width,flowHeight:t.height}},ob="react-flow__minimap-desc";function gd({style:t,className:e,nodeStrokeColor:n,nodeColor:r,nodeClassName:i="",nodeBorderRadius:o=5,nodeStrokeWidth:s,nodeComponent:a,bgColor:c,maskColor:l,maskStrokeColor:d,maskStrokeWidth:u,position:h="bottom-right",onClick:p,onNodeClick:m,pannable:f=!1,zoomable:g=!1,ariaLabel:y="React Flow mini map",inversePan:x,zoomStep:v=10,offsetScale:b=5}){const M=ye(),C=_.useRef(null),{boundingRect:E,viewBB:A,rfId:R,panZoom:B,translateExtent:$,flowWidth:F,flowHeight:D}=de(ib,ge),w=(t==null?void 0:t.width)??nb,k=(t==null?void 0:t.height)??rb,O=E.width/w,T=E.height/k,N=Math.max(O,T),j=N*w,L=N*k,q=b*N,U=E.x-(j-E.width)/2-q,V=E.y-(L-E.height)/2-q,Y=j+q*2,X=L+q*2,K=`${ob}-${R}`,ne=_.useRef(0),W=_.useRef();ne.current=N,_.useEffect(()=>{if(C.current&&B)return W.current=P1({domNode:C.current,panZoom:B,getTransform:()=>M.getState().transform,getViewScale:()=>ne.current}),()=>{var oe;(oe=W.current)==null||oe.destroy()}},[B]),_.useEffect(()=>{var oe;(oe=W.current)==null||oe.update({translateExtent:$,width:F,height:D,inversePan:x,pannable:f,zoomStep:v,zoomable:g})},[f,g,x,v,$,F,D]);const ie=p?oe=>{var pe;const[ae,he]=((pe=W.current)==null?void 0:pe.pointer(oe))||[0,0];p(oe,{x:ae,y:he})}:void 0,ce=m?_.useCallback((oe,ae)=>{const he=M.getState().nodeLookup.get(ae);m(oe,he)},[]):void 0;return S.jsx(kn,{position:h,style:{...t,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-width-props":typeof u=="number"?u*N:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof s=="string"?s:void 0},className:we(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:S.jsxs("svg",{width:w,height:k,viewBox:`${U} ${V} ${Y} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":K,ref:C,onClick:ie,children:[y&&S.jsx("title",{id:K,children:y}),S.jsx(tb,{onClick:ce,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:o,nodeClassName:i,nodeStrokeWidth:s,nodeComponent:a}),S.jsx("path",{className:"react-flow__minimap-mask",d:`M${U-q},${V-q}h${Y+q*2}v${X+q*2}h${-Y-q*2}z
        M${A.x},${A.y}h${A.width}v${A.height}h${-A.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}gd.displayName="MiniMap",dm=_.memo(gd);function sb({nodeId:t,position:e,variant:n=Ft.Handle,className:r,style:i={},children:o,color:s,minWidth:a=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:u=!1,shouldResize:h,onResizeStart:p,onResize:m,onResizeEnd:f}){const g=Bi(),y=typeof t=="string"?t:g,x=ye(),v=_.useRef(null),b=n===Ft.Line?"right":"bottom-right",M=e??b,C=_.useRef(null);_.useEffect(()=>{if(!(!v.current||!y))return C.current||(C.current=U1({domNode:v.current,nodeId:y,getStoreItems:()=>{const{nodeLookup:B,transform:$,snapGrid:F,snapToGrid:D,nodeOrigin:w,domNode:k}=x.getState();return{nodeLookup:B,transform:$,snapGrid:F,snapToGrid:D,nodeOrigin:w,paneDomNode:k}},onChange:(B,$)=>{const{triggerNodeChanges:F,nodeLookup:D,parentLookup:w,nodeOrigin:k}=x.getState(),O=[],T={x:B.x,y:B.y},N=D.get(y);if(N&&N.expandParent&&N.parentId){const j=N.origin??k,L=B.width??N.measured.width,q=B.height??N.measured.height,U={id:N.id,parentId:N.parentId,rect:{width:L,height:q,...Tl({x:B.x??N.position.x,y:B.y??N.position.y},{width:L,height:q},N.parentId,D,j)}},V=Ci([U],D,w,k);O.push(...V),T.x=B.x?Math.max(j[0]*L,B.x):void 0,T.y=B.y?Math.max(j[1]*q,B.y):void 0}if(T.x!==void 0&&T.y!==void 0){const j={id:y,type:"position",position:{...T}};O.push(j)}if(B.width!==void 0&&B.height!==void 0){const j={id:y,type:"dimensions",resizing:!0,setAttributes:!0,dimensions:{width:B.width,height:B.height}};O.push(j)}for(const j of $){const L={...j,type:"position"};O.push(L)}F(O)},onEnd:()=>{const B={id:y,type:"dimensions",resizing:!1};x.getState().triggerNodeChanges([B])}})),C.current.update({controlPosition:M,boundaries:{minWidth:a,minHeight:c,maxWidth:l,maxHeight:d},keepAspectRatio:u,onResizeStart:p,onResize:m,onResizeEnd:f,shouldResize:h}),()=>{var B;(B=C.current)==null||B.destroy()}},[M,a,c,l,d,u,p,m,f,h]);const E=M.split("-"),A=n===Ft.Line?"borderColor":"backgroundColor",R=s?{...i,[A]:s}:i;return S.jsx("div",{className:we(["react-flow__resize-control","nodrag",...E,n,r]),ref:v,style:R,children:o})}const vd=_.memo(sb);rm=function({nodeId:t,isVisible:e=!0,handleClassName:n,handleStyle:r,lineClassName:i,lineStyle:o,color:s,minWidth:a=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:u=!1,shouldResize:h,onResizeStart:p,onResize:m,onResizeEnd:f}){return e?S.jsxs(S.Fragment,{children:[L1.map(g=>S.jsx(vd,{className:i,style:o,nodeId:t,position:g,variant:Ft.Line,color:s,minWidth:a,minHeight:c,maxWidth:l,maxHeight:d,onResizeStart:p,keepAspectRatio:u,shouldResize:h,onResize:m,onResizeEnd:f},g)),D1.map(g=>S.jsx(vd,{className:n,style:r,nodeId:t,position:g,color:s,minWidth:a,minHeight:c,maxWidth:l,maxHeight:d,onResizeStart:p,keepAspectRatio:u,shouldResize:h,onResize:m,onResizeEnd:f},g))]}):null};var Di,xd;function ab(){if(xd)return Di;xd=1;function t(){this.__data__=[],this.size=0}return Di=t,Di}var Li,bd;Pn=function(){if(bd)return Li;bd=1;function t(e,n){return e===n||e!==e&&n!==n}return Li=t,Li};var Fi,wd;function xr(){if(wd)return Fi;wd=1;var t=Pn();function e(n,r){for(var i=n.length;i--;)if(t(n[i][0],r))return i;return-1}return Fi=e,Fi}var zi,Md;function cb(){if(Md)return zi;Md=1;var t=xr(),e=Array.prototype,n=e.splice;function r(i){var o=this.__data__,s=t(o,i);if(s<0)return!1;var a=o.length-1;return s==a?o.pop():n.call(o,s,1),--this.size,!0}return zi=r,zi}var Vi,Ed;function lb(){if(Ed)return Vi;Ed=1;var t=xr();function e(n){var r=this.__data__,i=t(r,n);return i<0?void 0:r[i][1]}return Vi=e,Vi}var qi,_d;function ub(){if(_d)return qi;_d=1;var t=xr();function e(n){return t(this.__data__,n)>-1}return qi=e,qi}var Wi,Cd;function db(){if(Cd)return Wi;Cd=1;var t=xr();function e(n,r){var i=this.__data__,o=t(i,n);return o<0?(++this.size,i.push([n,r])):i[o][1]=r,this}return Wi=e,Wi}var Hi,Sd;function br(){if(Sd)return Hi;Sd=1;var t=ab(),e=cb(),n=lb(),r=ub(),i=db();function o(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var l=s[a];this.set(l[0],l[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=n,o.prototype.has=r,o.prototype.set=i,Hi=o,Hi}var Ui,Od;function hb(){if(Od)return Ui;Od=1;var t=br();function e(){this.__data__=new t,this.size=0}return Ui=e,Ui}var Qi,Nd;function pb(){if(Nd)return Qi;Nd=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return Qi=t,Qi}var Yi,Pd;function fb(){if(Pd)return Yi;Pd=1;function t(e){return this.__data__.get(e)}return Yi=t,Yi}var Zi,Ad;function mb(){if(Ad)return Zi;Ad=1;function t(e){return this.__data__.has(e)}return Zi=t,Zi}var Gi,kd;function Td(){if(kd)return Gi;kd=1;var t=typeof Zt=="object"&&Zt&&Zt.Object===Object&&Zt;return Gi=t,Gi}var Xi,jd;We=function(){if(jd)return Xi;jd=1;var t=Td(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return Xi=n,Xi};var Ki,Rd;Xt=function(){if(Rd)return Ki;Rd=1;var t=We(),e=t.Symbol;return Ki=e,Ki};var Ji,Id;function yb(){if(Id)return Ji;Id=1;var t=Xt(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,i=t?t.toStringTag:void 0;function o(s){var a=n.call(s,i),c=s[i];try{s[i]=void 0;var l=!0}catch{}var d=r.call(s);return l&&(a?s[i]=c:delete s[i]),d}return Ji=o,Ji}var eo,Bd;function gb(){if(Bd)return eo;Bd=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return eo=n,eo}var to,$d;At=function(){if($d)return to;$d=1;var t=Xt(),e=yb(),n=gb(),r="[object Null]",i="[object Undefined]",o=t?t.toStringTag:void 0;function s(a){return a==null?a===void 0?i:r:o&&o in Object(a)?e(a):n(a)}return to=s,to};var no,Dd;Ot=function(){if(Dd)return no;Dd=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return no=t,no};var ro,Ld;Tr=function(){if(Ld)return ro;Ld=1;var t=At(),e=Ot(),n="[object AsyncFunction]",r="[object Function]",i="[object GeneratorFunction]",o="[object Proxy]";function s(a){if(!e(a))return!1;var c=t(a);return c==r||c==i||c==n||c==o}return ro=s,ro};var io,Fd;function vb(){if(Fd)return io;Fd=1;var t=We(),e=t["__core-js_shared__"];return io=e,io}var oo,zd;function xb(){if(zd)return oo;zd=1;var t=vb(),e=function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(r){return!!e&&e in r}return oo=n,oo}var so,Vd;function qd(){if(Vd)return so;Vd=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return so=n,so}var ao,Wd;function bb(){if(Wd)return ao;Wd=1;var t=Tr(),e=xb(),n=Ot(),r=qd(),i=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,s=Function.prototype,a=Object.prototype,c=s.toString,l=a.hasOwnProperty,d=RegExp("^"+c.call(l).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function u(h){if(!n(h)||e(h))return!1;var p=t(h)?d:o;return p.test(r(h))}return ao=u,ao}var co,Hd;function wb(){if(Hd)return co;Hd=1;function t(e,n){return e==null?void 0:e[n]}return co=t,co}var lo,Ud;function xt(){if(Ud)return lo;Ud=1;var t=bb(),e=wb();function n(r,i){var o=e(r,i);return t(o)?o:void 0}return lo=n,lo}var uo,Qd;function ho(){if(Qd)return uo;Qd=1;var t=xt(),e=We(),n=t(e,"Map");return uo=n,uo}var po,Yd;function wr(){if(Yd)return po;Yd=1;var t=xt(),e=t(Object,"create");return po=e,po}var fo,Zd;function Mb(){if(Zd)return fo;Zd=1;var t=wr();function e(){this.__data__=t?t(null):{},this.size=0}return fo=e,fo}var mo,Gd;function Eb(){if(Gd)return mo;Gd=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return mo=t,mo}var yo,Xd;function _b(){if(Xd)return yo;Xd=1;var t=wr(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function i(o){var s=this.__data__;if(t){var a=s[o];return a===e?void 0:a}return r.call(s,o)?s[o]:void 0}return yo=i,yo}var go,Kd;function Cb(){if(Kd)return go;Kd=1;var t=wr(),e=Object.prototype,n=e.hasOwnProperty;function r(i){var o=this.__data__;return t?o[i]!==void 0:n.call(o,i)}return go=r,go}var vo,Jd;function Sb(){if(Jd)return vo;Jd=1;var t=wr(),e="__lodash_hash_undefined__";function n(r,i){var o=this.__data__;return this.size+=this.has(r)?0:1,o[r]=t&&i===void 0?e:i,this}return vo=n,vo}var xo,eh;function Ob(){if(eh)return xo;eh=1;var t=Mb(),e=Eb(),n=_b(),r=Cb(),i=Sb();function o(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var l=s[a];this.set(l[0],l[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=n,o.prototype.has=r,o.prototype.set=i,xo=o,xo}var bo,th;function Nb(){if(th)return bo;th=1;var t=Ob(),e=br(),n=ho();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return bo=r,bo}var wo,nh;function Pb(){if(nh)return wo;nh=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return wo=t,wo}var Mo,rh;function Mr(){if(rh)return Mo;rh=1;var t=Pb();function e(n,r){var i=n.__data__;return t(r)?i[typeof r=="string"?"string":"hash"]:i.map}return Mo=e,Mo}var Eo,ih;function Ab(){if(ih)return Eo;ih=1;var t=Mr();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return Eo=e,Eo}var _o,oh;function kb(){if(oh)return _o;oh=1;var t=Mr();function e(n){return t(this,n).get(n)}return _o=e,_o}var Co,sh;function Tb(){if(sh)return Co;sh=1;var t=Mr();function e(n){return t(this,n).has(n)}return Co=e,Co}var So,ah;function jb(){if(ah)return So;ah=1;var t=Mr();function e(n,r){var i=t(this,n),o=i.size;return i.set(n,r),this.size+=i.size==o?0:1,this}return So=e,So}var Oo,ch;function No(){if(ch)return Oo;ch=1;var t=Nb(),e=Ab(),n=kb(),r=Tb(),i=jb();function o(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var l=s[a];this.set(l[0],l[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=n,o.prototype.has=r,o.prototype.set=i,Oo=o,Oo}var Po,lh;function Rb(){if(lh)return Po;lh=1;var t=br(),e=ho(),n=No(),r=200;function i(o,s){var a=this.__data__;if(a instanceof t){var c=a.__data__;if(!e||c.length<r-1)return c.push([o,s]),this.size=++a.size,this;a=this.__data__=new n(c)}return a.set(o,s),this.size=a.size,this}return Po=i,Po}var Ao,uh;Qr=function(){if(uh)return Ao;uh=1;var t=br(),e=hb(),n=pb(),r=fb(),i=mb(),o=Rb();function s(a){var c=this.__data__=new t(a);this.size=c.size}return s.prototype.clear=e,s.prototype.delete=n,s.prototype.get=r,s.prototype.has=i,s.prototype.set=o,Ao=s,Ao};var ko,dh;function Ib(){if(dh)return ko;dh=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return ko=e,ko}var To,hh;function Bb(){if(hh)return To;hh=1;function t(e){return this.__data__.has(e)}return To=t,To}var jo,ph;Qa=function(){if(ph)return jo;ph=1;var t=No(),e=Ib(),n=Bb();function r(i){var o=-1,s=i==null?0:i.length;for(this.__data__=new t;++o<s;)this.add(i[o])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,jo=r,jo};var Ro,fh;ec=function(){if(fh)return Ro;fh=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(e[r],r,e))return!0;return!1}return Ro=t,Ro};var Io,mh;Za=function(){if(mh)return Io;mh=1;function t(e,n){return e.has(n)}return Io=t,Io};var Bo,yh;function gh(){if(yh)return Bo;yh=1;var t=Qa(),e=ec(),n=Za(),r=1,i=2;function o(s,a,c,l,d,u){var h=c&r,p=s.length,m=a.length;if(p!=m&&!(h&&m>p))return!1;var f=u.get(s),g=u.get(a);if(f&&g)return f==a&&g==s;var y=-1,x=!0,v=c&i?new t:void 0;for(u.set(s,a),u.set(a,s);++y<p;){var b=s[y],M=a[y];if(l)var C=h?l(M,b,y,a,s,u):l(b,M,y,s,a,u);if(C!==void 0){if(C)continue;x=!1;break}if(v){if(!e(a,function(E,A){if(!n(v,A)&&(b===E||d(b,E,c,l,u)))return v.push(A)})){x=!1;break}}else if(!(b===M||d(b,M,c,l,u))){x=!1;break}}return u.delete(s),u.delete(a),x}return Bo=o,Bo}var $o,vh;dc=function(){if(vh)return $o;vh=1;var t=We(),e=t.Uint8Array;return $o=e,$o};var Do,xh;function $b(){if(xh)return Do;xh=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i,o){r[++n]=[o,i]}),r}return Do=t,Do}var Lo,bh;Ua=function(){if(bh)return Lo;bh=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i){r[++n]=i}),r}return Lo=t,Lo};var Fo,wh;function Db(){if(wh)return Fo;wh=1;var t=Xt(),e=dc(),n=Pn(),r=gh(),i=$b(),o=Ua(),s=1,a=2,c="[object Boolean]",l="[object Date]",d="[object Error]",u="[object Map]",h="[object Number]",p="[object RegExp]",m="[object Set]",f="[object String]",g="[object Symbol]",y="[object ArrayBuffer]",x="[object DataView]",v=t?t.prototype:void 0,b=v?v.valueOf:void 0;function M(C,E,A,R,B,$,F){switch(A){case x:if(C.byteLength!=E.byteLength||C.byteOffset!=E.byteOffset)return!1;C=C.buffer,E=E.buffer;case y:return!(C.byteLength!=E.byteLength||!$(new e(C),new e(E)));case c:case l:case h:return n(+C,+E);case d:return C.name==E.name&&C.message==E.message;case p:case f:return C==E+"";case u:var D=i;case m:var w=R&s;if(D||(D=o),C.size!=E.size&&!w)return!1;var k=F.get(C);if(k)return k==E;R|=a,F.set(C,E);var O=r(D(C),D(E),R,B,$,F);return F.delete(C),O;case g:if(b)return b.call(C)==b.call(E)}return!1}return Fo=M,Fo}var zo,Mh;Br=function(){if(Mh)return zo;Mh=1;function t(e,n){for(var r=-1,i=n.length,o=e.length;++r<i;)e[o+r]=n[r];return e}return zo=t,zo};var Vo,Eh;Ke=function(){if(Eh)return Vo;Eh=1;var t=Array.isArray;return Vo=t,Vo};var qo,_h;function Ch(){if(_h)return qo;_h=1;var t=Br(),e=Ke();function n(r,i,o){var s=i(r);return e(r)?s:t(s,o(r))}return qo=n,qo}var Wo,Sh;function Lb(){if(Sh)return Wo;Sh=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,o=0,s=[];++r<i;){var a=e[r];n(a,r,e)&&(s[o++]=a)}return s}return Wo=t,Wo}var Ho,Oh;function Nh(){if(Oh)return Ho;Oh=1;function t(){return[]}return Ho=t,Ho}var Uo,Ph;Hr=function(){if(Ph)return Uo;Ph=1;var t=Lb(),e=Nh(),n=Object.prototype,r=n.propertyIsEnumerable,i=Object.getOwnPropertySymbols,o=i?function(s){return s==null?[]:(s=Object(s),t(i(s),function(a){return r.call(s,a)}))}:e;return Uo=o,Uo};var Qo,Ah;function Fb(){if(Ah)return Qo;Ah=1;function t(e,n){for(var r=-1,i=Array(e);++r<e;)i[r]=n(r);return i}return Qo=t,Qo}var Yo,kh;St=function(){if(kh)return Yo;kh=1;function t(e){return e!=null&&typeof e=="object"}return Yo=t,Yo};var Zo,Th;function zb(){if(Th)return Zo;Th=1;var t=At(),e=St(),n="[object Arguments]";function r(i){return e(i)&&t(i)==n}return Zo=r,Zo}var Go,jh;Ir=function(){if(jh)return Go;jh=1;var t=zb(),e=St(),n=Object.prototype,r=n.hasOwnProperty,i=n.propertyIsEnumerable,o=t(function(){return arguments}())?t:function(s){return e(s)&&r.call(s,"callee")&&!i.call(s,"callee")};return Go=o,Go};var Er={exports:{}},Xo,Rh;function Vb(){if(Rh)return Xo;Rh=1;function t(){return!1}return Xo=t,Xo}Er.exports;var Ih;Vr=function(){return Ih||(Ih=1,function(t,e){var n=We(),r=Vb(),i=e&&!e.nodeType&&e,o=i&&!0&&t&&!t.nodeType&&t,s=o&&o.exports===i,a=s?n.Buffer:void 0,c=a?a.isBuffer:void 0,l=c||r;t.exports=l}(Er,Er.exports)),Er.exports};var Ko,Bh;An=function(){if(Bh)return Ko;Bh=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,i){var o=typeof r;return i=i??t,!!i&&(o=="number"||o!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<i}return Ko=n,Ko};var Jo,$h;function es(){if($h)return Jo;$h=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return Jo=e,Jo}var ts,Dh;function qb(){if(Dh)return ts;Dh=1;var t=At(),e=es(),n=St(),r="[object Arguments]",i="[object Array]",o="[object Boolean]",s="[object Date]",a="[object Error]",c="[object Function]",l="[object Map]",d="[object Number]",u="[object Object]",h="[object RegExp]",p="[object Set]",m="[object String]",f="[object WeakMap]",g="[object ArrayBuffer]",y="[object DataView]",x="[object Float32Array]",v="[object Float64Array]",b="[object Int8Array]",M="[object Int16Array]",C="[object Int32Array]",E="[object Uint8Array]",A="[object Uint8ClampedArray]",R="[object Uint16Array]",B="[object Uint32Array]",$={};$[x]=$[v]=$[b]=$[M]=$[C]=$[E]=$[A]=$[R]=$[B]=!0,$[r]=$[i]=$[g]=$[o]=$[y]=$[s]=$[a]=$[c]=$[l]=$[d]=$[u]=$[h]=$[p]=$[m]=$[f]=!1;function F(D){return n(D)&&e(D.length)&&!!$[t(D)]}return ts=F,ts}var ns,Lh;Ka=function(){if(Lh)return ns;Lh=1;function t(e){return function(n){return e(n)}}return ns=t,ns};var _r={exports:{}};_r.exports;var Fh;pc=function(){return Fh||(Fh=1,function(t,e){var n=Td(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,o=i&&i.exports===r,s=o&&n.process,a=function(){try{var c=i&&i.require&&i.require("util").types;return c||s&&s.binding&&s.binding("util")}catch{}}();t.exports=a}(_r,_r.exports)),_r.exports};var rs,zh;qr=function(){if(zh)return rs;zh=1;var t=qb(),e=Ka(),n=pc(),r=n&&n.isTypedArray,i=r?e(r):t;return rs=i,rs};var is,Vh;function qh(){if(Vh)return is;Vh=1;var t=Fb(),e=Ir(),n=Ke(),r=Vr(),i=An(),o=qr(),s=Object.prototype,a=s.hasOwnProperty;function c(l,d){var u=n(l),h=!u&&e(l),p=!u&&!h&&r(l),m=!u&&!h&&!p&&o(l),f=u||h||p||m,g=f?t(l.length,String):[],y=g.length;for(var x in l)(d||a.call(l,x))&&!(f&&(x=="length"||p&&(x=="offset"||x=="parent")||m&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||i(x,y)))&&g.push(x);return g}return is=c,is}var os,Wh;Ur=function(){if(Wh)return os;Wh=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,i=typeof r=="function"&&r.prototype||t;return n===i}return os=e,os};var ss,Hh;function Uh(){if(Hh)return ss;Hh=1;function t(e,n){return function(r){return e(n(r))}}return ss=t,ss}var as,Qh;function Wb(){if(Qh)return as;Qh=1;var t=Uh(),e=t(Object.keys,Object);return as=e,as}var cs,Yh;function Hb(){if(Yh)return cs;Yh=1;var t=Ur(),e=Wb(),n=Object.prototype,r=n.hasOwnProperty;function i(o){if(!t(o))return e(o);var s=[];for(var a in Object(o))r.call(o,a)&&a!="constructor"&&s.push(a);return s}return cs=i,cs}var ls,Zh;Lr=function(){if(Zh)return ls;Zh=1;var t=Tr(),e=es();function n(r){return r!=null&&e(r.length)&&!t(r)}return ls=n,ls};var us,Gh;Dr=function(){if(Gh)return us;Gh=1;var t=qh(),e=Hb(),n=Lr();function r(i){return n(i)?t(i):e(i)}return us=r,us};var ds,Xh;fc=function(){if(Xh)return ds;Xh=1;var t=Ch(),e=Hr(),n=Dr();function r(i){return t(i,n,e)}return ds=r,ds};var hs,Kh;function Ub(){if(Kh)return hs;Kh=1;var t=fc(),e=1,n=Object.prototype,r=n.hasOwnProperty;function i(o,s,a,c,l,d){var u=a&e,h=t(o),p=h.length,m=t(s),f=m.length;if(p!=f&&!u)return!1;for(var g=p;g--;){var y=h[g];if(!(u?y in s:r.call(s,y)))return!1}var x=d.get(o),v=d.get(s);if(x&&v)return x==s&&v==o;var b=!0;d.set(o,s),d.set(s,o);for(var M=u;++g<p;){y=h[g];var C=o[y],E=s[y];if(c)var A=u?c(E,C,y,s,o,d):c(C,E,y,o,s,d);if(!(A===void 0?C===E||l(C,E,a,c,d):A)){b=!1;break}M||(M=y=="constructor")}if(b&&!M){var R=o.constructor,B=s.constructor;R!=B&&"constructor"in o&&"constructor"in s&&!(typeof R=="function"&&R instanceof R&&typeof B=="function"&&B instanceof B)&&(b=!1)}return d.delete(o),d.delete(s),b}return hs=i,hs}var ps,Jh;function Qb(){if(Jh)return ps;Jh=1;var t=xt(),e=We(),n=t(e,"DataView");return ps=n,ps}var fs,ep;function Yb(){if(ep)return fs;ep=1;var t=xt(),e=We(),n=t(e,"Promise");return fs=n,fs}var ms,tp;Ha=function(){if(tp)return ms;tp=1;var t=xt(),e=We(),n=t(e,"Set");return ms=n,ms};var ys,np;function Zb(){if(np)return ys;np=1;var t=xt(),e=We(),n=t(e,"WeakMap");return ys=n,ys}var gs,rp;hc=function(){if(rp)return gs;rp=1;var t=Qb(),e=ho(),n=Yb(),r=Ha(),i=Zb(),o=At(),s=qd(),a="[object Map]",c="[object Object]",l="[object Promise]",d="[object Set]",u="[object WeakMap]",h="[object DataView]",p=s(t),m=s(e),f=s(n),g=s(r),y=s(i),x=o;return(t&&x(new t(new ArrayBuffer(1)))!=h||e&&x(new e)!=a||n&&x(n.resolve())!=l||r&&x(new r)!=d||i&&x(new i)!=u)&&(x=function(v){var b=o(v),M=b==c?v.constructor:void 0,C=M?s(M):"";if(C)switch(C){case p:return h;case m:return a;case f:return l;case g:return d;case y:return u}return b}),gs=x,gs};var vs,ip;function Gb(){if(ip)return vs;ip=1;var t=Qr(),e=gh(),n=Db(),r=Ub(),i=hc(),o=Ke(),s=Vr(),a=qr(),c=1,l="[object Arguments]",d="[object Array]",u="[object Object]",h=Object.prototype,p=h.hasOwnProperty;function m(f,g,y,x,v,b){var M=o(f),C=o(g),E=M?d:i(f),A=C?d:i(g);E=E==l?u:E,A=A==l?u:A;var R=E==u,B=A==u,$=E==A;if($&&s(f)){if(!s(g))return!1;M=!0,R=!1}if($&&!R)return b||(b=new t),M||a(f)?e(f,g,y,x,v,b):n(f,g,E,y,x,v,b);if(!(y&c)){var F=R&&p.call(f,"__wrapped__"),D=B&&p.call(g,"__wrapped__");if(F||D){var w=F?f.value():f,k=D?g.value():g;return b||(b=new t),v(w,k,y,x,b)}}return $?(b||(b=new t),r(f,g,y,x,v,b)):!1}return vs=m,vs}var xs,op;zr=function(){if(op)return xs;op=1;var t=Gb(),e=St();function n(r,i,o,s,a){return r===i?!0:r==null||i==null||!e(r)&&!e(i)?r!==r&&i!==i:t(r,i,o,s,n,a)}return xs=n,xs};var bs,sp;function Xb(){if(sp)return bs;sp=1;var t=Qr(),e=zr(),n=1,r=2;function i(o,s,a,c){var l=a.length,d=l,u=!c;if(o==null)return!d;for(o=Object(o);l--;){var h=a[l];if(u&&h[2]?h[1]!==o[h[0]]:!(h[0]in o))return!1}for(;++l<d;){h=a[l];var p=h[0],m=o[p],f=h[1];if(u&&h[2]){if(m===void 0&&!(p in o))return!1}else{var g=new t;if(c)var y=c(m,f,p,o,s,g);if(!(y===void 0?e(f,m,n|r,c,g):y))return!1}}return!0}return bs=i,bs}var ws,ap;function cp(){if(ap)return ws;ap=1;var t=Ot();function e(n){return n===n&&!t(n)}return ws=e,ws}var Ms,lp;function Kb(){if(lp)return Ms;lp=1;var t=cp(),e=Dr();function n(r){for(var i=e(r),o=i.length;o--;){var s=i[o],a=r[s];i[o]=[s,a,t(a)]}return i}return Ms=n,Ms}var Es,up;function dp(){if(up)return Es;up=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return Es=t,Es}var _s,hp;function Jb(){if(hp)return _s;hp=1;var t=Xb(),e=Kb(),n=dp();function r(i){var o=e(i);return o.length==1&&o[0][2]?n(o[0][0],o[0][1]):function(s){return s===i||t(s,i,o)}}return _s=r,_s}var Cs,pp;On=function(){if(pp)return Cs;pp=1;var t=At(),e=St(),n="[object Symbol]";function r(i){return typeof i=="symbol"||e(i)&&t(i)==n}return Cs=r,Cs};var Ss,fp;function Os(){if(fp)return Ss;fp=1;var t=Ke(),e=On(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function i(o,s){if(t(o))return!1;var a=typeof o;return a=="number"||a=="symbol"||a=="boolean"||o==null||e(o)?!0:r.test(o)||!n.test(o)||s!=null&&o in Object(s)}return Ss=i,Ss}var Ns,mp;nc=function(){if(mp)return Ns;mp=1;var t=No(),e="Expected a function";function n(r,i){if(typeof r!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var o=function(){var s=arguments,a=i?i.apply(this,s):s[0],c=o.cache;if(c.has(a))return c.get(a);var l=r.apply(this,s);return o.cache=c.set(a,l)||c,l};return o.cache=new(n.Cache||t),o}return n.Cache=t,Ns=n,Ns};var Ps,yp;function ew(){if(yp)return Ps;yp=1;var t=nc(),e=500;function n(r){var i=t(r,function(s){return o.size===e&&o.clear(),s}),o=i.cache;return i}return Ps=n,Ps}var As,gp;function tw(){if(gp)return As;gp=1;var t=ew(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(i){var o=[];return i.charCodeAt(0)===46&&o.push(""),i.replace(e,function(s,a,c,l){o.push(c?l.replace(n,"$1"):a||s)}),o});return As=r,As}var ks,vp;Fr=function(){if(vp)return ks;vp=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,o=Array(i);++r<i;)o[r]=n(e[r],r,e);return o}return ks=t,ks};var Ts,xp;function nw(){if(xp)return Ts;xp=1;var t=Xt(),e=Fr(),n=Ke(),r=On(),i=1/0,o=t?t.prototype:void 0,s=o?o.toString:void 0;function a(c){if(typeof c=="string")return c;if(n(c))return e(c,a)+"";if(r(c))return s?s.call(c):"";var l=c+"";return l=="0"&&1/c==-i?"-0":l}return Ts=a,Ts}var js,bp;qa=function(){if(bp)return js;bp=1;var t=nw();function e(n){return n==null?"":t(n)}return js=e,js};var Rs,wp;Kt=function(){if(wp)return Rs;wp=1;var t=Ke(),e=Os(),n=tw(),r=qa();function i(o,s){return t(o)?o:e(o,s)?[o]:n(r(o))}return Rs=i,Rs};var Is,Mp;Pt=function(){if(Mp)return Is;Mp=1;var t=On(),e=1/0;function n(r){if(typeof r=="string"||t(r))return r;var i=r+"";return i=="0"&&1/r==-e?"-0":i}return Is=n,Is};var Bs,Ep;Nn=function(){if(Ep)return Bs;Ep=1;var t=Kt(),e=Pt();function n(r,i){i=t(i,r);for(var o=0,s=i.length;r!=null&&o<s;)r=r[e(i[o++])];return o&&o==s?r:void 0}return Bs=n,Bs};var $s,_p;Mc=function(){if(_p)return $s;_p=1;var t=Nn();function e(n,r,i){var o=n==null?void 0:t(n,r);return o===void 0?i:o}return $s=e,$s};var Ds,Cp;function rw(){if(Cp)return Ds;Cp=1;function t(e,n){return e!=null&&n in Object(e)}return Ds=t,Ds}var Ls,Sp;function iw(){if(Sp)return Ls;Sp=1;var t=Kt(),e=Ir(),n=Ke(),r=An(),i=es(),o=Pt();function s(a,c,l){c=t(c,a);for(var d=-1,u=c.length,h=!1;++d<u;){var p=o(c[d]);if(!(h=a!=null&&l(a,p)))break;a=a[p]}return h||++d!=u?h:(u=a==null?0:a.length,!!u&&i(u)&&r(p,u)&&(n(a)||e(a)))}return Ls=s,Ls}var Fs,Op;sc=function(){if(Op)return Fs;Op=1;var t=rw(),e=iw();function n(r,i){return r!=null&&e(r,i,t)}return Fs=n,Fs};var zs,Np;function ow(){if(Np)return zs;Np=1;var t=zr(),e=Mc(),n=sc(),r=Os(),i=cp(),o=dp(),s=Pt(),a=1,c=2;function l(d,u){return r(d)&&i(u)?o(s(d),u):function(h){var p=e(h,d);return p===void 0&&p===u?n(h,d):t(u,p,a|c)}}return zs=l,zs}var Vs,Pp;Xa=function(){if(Pp)return Vs;Pp=1;function t(e){return e}return Vs=t,Vs};var qs,Ap;function sw(){if(Ap)return qs;Ap=1;function t(e){return function(n){return n==null?void 0:n[e]}}return qs=t,qs}var Ws,kp;function aw(){if(kp)return Ws;kp=1;var t=Nn();function e(n){return function(r){return t(r,n)}}return Ws=e,Ws}var Hs,Tp;function cw(){if(Tp)return Hs;Tp=1;var t=sw(),e=aw(),n=Os(),r=Pt();function i(o){return n(o)?t(r(o)):e(o)}return Hs=i,Hs}var Us,jp;Rr=function(){if(jp)return Us;jp=1;var t=Jb(),e=ow(),n=Xa(),r=Ke(),i=cw();function o(s){return typeof s=="function"?s:s==null?n:typeof s=="object"?r(s)?e(s[0],s[1]):t(s):i(s)}return Us=o,Us};var Qs,Rp;function lw(){if(Rp)return Qs;Rp=1;var t="Expected a function";function e(n){if(typeof n!="function")throw new TypeError(t);return function(){var r=arguments;switch(r.length){case 0:return!n.call(this);case 1:return!n.call(this,r[0]);case 2:return!n.call(this,r[0],r[1]);case 3:return!n.call(this,r[0],r[1],r[2])}return!n.apply(this,r)}}return Qs=e,Qs}var Ys,Ip;za=function(){if(Ip)return Ys;Ip=1;var t=xt(),e=function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}}();return Ys=e,Ys};var Zs,Bp;tc=function(){if(Bp)return Zs;Bp=1;var t=za();function e(n,r,i){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[r]=i}return Zs=e,Zs};var Gs,$p;cc=function(){if($p)return Gs;$p=1;var t=tc(),e=Pn(),n=Object.prototype,r=n.hasOwnProperty;function i(o,s,a){var c=o[s];(!(r.call(o,s)&&e(c,a))||a===void 0&&!(s in o))&&t(o,s,a)}return Gs=i,Gs};var Xs,Dp;function uw(){if(Dp)return Xs;Dp=1;var t=cc(),e=Kt(),n=An(),r=Ot(),i=Pt();function o(s,a,c,l){if(!r(s))return s;a=e(a,s);for(var d=-1,u=a.length,h=u-1,p=s;p!=null&&++d<u;){var m=i(a[d]),f=c;if(m==="__proto__"||m==="constructor"||m==="prototype")return s;if(d!=h){var g=p[m];f=l?l(g,m,p):void 0,f===void 0&&(f=r(g)?g:n(a[d+1])?[]:{})}t(p,m,f),p=p[m]}return s}return Xs=o,Xs}var Ks,Lp;oc=function(){if(Lp)return Ks;Lp=1;var t=Nn(),e=uw(),n=Kt();function r(i,o,s){for(var a=-1,c=o.length,l={};++a<c;){var d=o[a],u=t(i,d);s(u,d)&&e(l,n(d,i),u)}return l}return Ks=r,Ks};var Js,Fp;Ja=function(){if(Fp)return Js;Fp=1;var t=Uh(),e=t(Object.getPrototypeOf,Object);return Js=e,Js};var ea,zp;uc=function(){if(zp)return ea;zp=1;var t=Br(),e=Ja(),n=Hr(),r=Nh(),i=Object.getOwnPropertySymbols,o=i?function(s){for(var a=[];s;)t(a,n(s)),s=e(s);return a}:r;return ea=o,ea};var ta,Vp;function dw(){if(Vp)return ta;Vp=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return ta=t,ta}var na,qp;function hw(){if(qp)return na;qp=1;var t=Ot(),e=Ur(),n=dw(),r=Object.prototype,i=r.hasOwnProperty;function o(s){if(!t(s))return n(s);var a=e(s),c=[];for(var l in s)l=="constructor"&&(a||!i.call(s,l))||c.push(l);return c}return na=o,na}var ra,Wp;lc=function(){if(Wp)return ra;Wp=1;var t=qh(),e=hw(),n=Lr();function r(i){return n(i)?t(i,!0):e(i)}return ra=r,ra};var ia,Hp;rc=function(){if(Hp)return ia;Hp=1;var t=Ch(),e=uc(),n=lc();function r(i){return t(i,n,e)}return ia=r,ia};var oa,Up;function pw(){if(Up)return oa;Up=1;var t=Fr(),e=Rr(),n=oc(),r=rc();function i(o,s){if(o==null)return{};var a=t(r(o),function(c){return[c]});return s=e(s),n(o,a,function(c,l){return s(c,l[0])})}return oa=i,oa}var sa,Qp;function fw(){if(Qp)return sa;Qp=1;var t=Rr(),e=lw(),n=pw();function r(i,o){return n(i,e(t(o)))}return sa=r,sa}var mw=fw();Rn=Yt(mw);var aa,Yp;function yw(){if(Yp)return aa;Yp=1;function t(e){return e===void 0}return aa=t,aa}var gw=yw();In=Yt(gw);var ca,Zp;function vw(){if(Zp)return ca;Zp=1;var t=function(y){return e(y)&&!n(y)};function e(y){return!!y&&typeof y=="object"}function n(y){var x=Object.prototype.toString.call(y);return x==="[object RegExp]"||x==="[object Date]"||o(y)}var r=typeof Symbol=="function"&&Symbol.for,i=r?Symbol.for("react.element"):60103;function o(y){return y.$$typeof===i}function s(y){return Array.isArray(y)?[]:{}}function a(y,x){return x.clone!==!1&&x.isMergeableObject(y)?f(s(y),y,x):y}function c(y,x,v){return y.concat(x).map(function(b){return a(b,v)})}function l(y,x){if(!x.customMerge)return f;var v=x.customMerge(y);return typeof v=="function"?v:f}function d(y){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(y).filter(function(x){return Object.propertyIsEnumerable.call(y,x)}):[]}function u(y){return Object.keys(y).concat(d(y))}function h(y,x){try{return x in y}catch{return!1}}function p(y,x){return h(y,x)&&!(Object.hasOwnProperty.call(y,x)&&Object.propertyIsEnumerable.call(y,x))}function m(y,x,v){var b={};return v.isMergeableObject(y)&&u(y).forEach(function(M){b[M]=a(y[M],v)}),u(x).forEach(function(M){p(y,M)||(h(y,M)&&v.isMergeableObject(x[M])?b[M]=l(M,v)(y[M],x[M],v):b[M]=a(x[M],v))}),b}function f(y,x,v){v=v||{},v.arrayMerge=v.arrayMerge||c,v.isMergeableObject=v.isMergeableObject||t,v.cloneUnlessOtherwiseSpecified=a;var b=Array.isArray(x),M=Array.isArray(y),C=b===M;return C?b?v.arrayMerge(y,x,v):m(y,x,v):a(x,v)}f.all=function(y,x){if(!Array.isArray(y))throw new Error("first argument should be an array");return y.reduce(function(v,b){return f(v,b,x)},{})};var g=f;return ca=g,ca}var xw=vw();Tn=Yt(xw);var Gp={},Xp;function bw(){if(Xp)return Gp;Xp=1;var t;return function(e){(function(n){var r=typeof globalThis=="object"?globalThis:typeof Zt=="object"?Zt:typeof self=="object"?self:typeof this=="object"?this:c(),i=o(e);typeof r.Reflect<"u"&&(i=o(r.Reflect,i)),n(i,r),typeof r.Reflect>"u"&&(r.Reflect=e);function o(l,d){return function(u,h){Object.defineProperty(l,u,{configurable:!0,writable:!0,value:h}),d&&d(u,h)}}function s(){try{return Function("return this;")()}catch{}}function a(){try{return(0,eval)("(function() { return this; })()")}catch{}}function c(){return s()||a()}})(function(n,r){var i=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",s=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",c=typeof Object.create=="function",l={__proto__:[]}instanceof Array,d=!c&&!l,u={create:c?function(){return Sn(Object.create(null))}:l?function(){return Sn({__proto__:null})}:function(){return Sn({})},has:d?function(P,I){return i.call(P,I)}:function(P,I){return I in P},get:d?function(P,I){return i.call(P,I)?P[I]:void 0}:function(P,I){return P[I]}},h=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ra(),m=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Cn(),f=typeof WeakMap=="function"?WeakMap:Ia(),g=o?Symbol.for("@reflect-metadata:registry"):void 0,y=wt(),x=Mt(y);function v(P,I,z,H){if(V(z)){if(!ae(P))throw new TypeError;if(!pe(I))throw new TypeError;return D(P,I)}else{if(!ae(P))throw new TypeError;if(!K(I))throw new TypeError;if(!K(H)&&!V(H)&&!Y(H))throw new TypeError;return Y(H)&&(H=void 0),z=oe(z),w(P,I,z,H)}}n("decorate",v);function b(P,I){function z(H,se){if(!K(H))throw new TypeError;if(!V(se)&&!Te(se))throw new TypeError;j(P,I,H,se)}return z}n("metadata",b);function M(P,I,z,H){if(!K(z))throw new TypeError;return V(H)||(H=oe(H)),j(P,I,z,H)}n("defineMetadata",M);function C(P,I,z){if(!K(I))throw new TypeError;return V(z)||(z=oe(z)),k(P,I,z)}n("hasMetadata",C);function E(P,I,z){if(!K(I))throw new TypeError;return V(z)||(z=oe(z)),O(P,I,z)}n("hasOwnMetadata",E);function A(P,I,z){if(!K(I))throw new TypeError;return V(z)||(z=oe(z)),T(P,I,z)}n("getMetadata",A);function R(P,I,z){if(!K(I))throw new TypeError;return V(z)||(z=oe(z)),N(P,I,z)}n("getOwnMetadata",R);function B(P,I){if(!K(P))throw new TypeError;return V(I)||(I=oe(I)),L(P,I)}n("getMetadataKeys",B);function $(P,I){if(!K(P))throw new TypeError;return V(I)||(I=oe(I)),q(P,I)}n("getOwnMetadataKeys",$);function F(P,I,z){if(!K(I))throw new TypeError;if(V(z)||(z=oe(z)),!K(I))throw new TypeError;V(z)||(z=oe(z));var H=Ge(I,z,!1);return V(H)?!1:H.OrdinaryDeleteMetadata(P,I,z)}n("deleteMetadata",F);function D(P,I){for(var z=P.length-1;z>=0;--z){var H=P[z],se=H(I);if(!V(se)&&!Y(se)){if(!pe(se))throw new TypeError;I=se}}return I}function w(P,I,z,H){for(var se=P.length-1;se>=0;--se){var _e=P[se],be=_e(I,z,H);if(!V(be)&&!Y(be)){if(!K(be))throw new TypeError;H=be}}return H}function k(P,I,z){var H=O(P,I,z);if(H)return!0;var se=Oe(I);return Y(se)?!1:k(P,se,z)}function O(P,I,z){var H=Ge(I,z,!1);return V(H)?!1:ie(H.OrdinaryHasOwnMetadata(P,I,z))}function T(P,I,z){var H=O(P,I,z);if(H)return N(P,I,z);var se=Oe(I);if(!Y(se))return T(P,se,z)}function N(P,I,z){var H=Ge(I,z,!1);if(!V(H))return H.OrdinaryGetOwnMetadata(P,I,z)}function j(P,I,z,H){var se=Ge(z,H,!0);se.OrdinaryDefineOwnMetadata(P,I,z,H)}function L(P,I){var z=q(P,I),H=Oe(P);if(H===null)return z;var se=L(H,I);if(se.length<=0)return z;if(z.length<=0)return se;for(var _e=new m,be=[],le=0,Z=z;le<Z.length;le++){var J=Z[le],ee=_e.has(J);ee||(_e.add(J),be.push(J))}for(var te=0,ue=se;te<ue.length;te++){var J=ue[te],ee=_e.has(J);ee||(_e.add(J),be.push(J))}return be}function q(P,I){var z=Ge(P,I,!1);return z?z.OrdinaryOwnMetadataKeys(P,I):[]}function U(P){if(P===null)return 1;switch(typeof P){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return P===null?1:6;default:return 6}}function V(P){return P===void 0}function Y(P){return P===null}function X(P){return typeof P=="symbol"}function K(P){return typeof P=="object"?P!==null:typeof P=="function"}function ne(P,I){switch(U(P)){case 0:return P;case 1:return P;case 2:return P;case 3:return P;case 4:return P;case 5:return P}var z="string",H=ut(P,s);if(H!==void 0){var se=H.call(P,z);if(K(se))throw new TypeError;return se}return W(P)}function W(P,I){var z,H;{var se=P.toString;if(he(se)){var H=se.call(P);if(!K(H))return H}var z=P.valueOf;if(he(z)){var H=z.call(P);if(!K(H))return H}}throw new TypeError}function ie(P){return!!P}function ce(P){return""+P}function oe(P){var I=ne(P);return X(I)?I:ce(I)}function ae(P){return Array.isArray?Array.isArray(P):P instanceof Object?P instanceof Array:Object.prototype.toString.call(P)==="[object Array]"}function he(P){return typeof P=="function"}function pe(P){return typeof P=="function"}function Te(P){switch(U(P)){case 3:return!0;case 4:return!0;default:return!1}}function De(P,I){return P===I||P!==P&&I!==I}function ut(P,I){var z=P[I];if(z!=null){if(!he(z))throw new TypeError;return z}}function ot(P){var I=ut(P,a);if(!he(I))throw new TypeError;var z=I.call(P);if(!K(z))throw new TypeError;return z}function dt(P){return P.value}function qe(P){var I=P.next();return I.done?!1:I}function Ee(P){var I=P.return;I&&I.call(P)}function Oe(P){var I=Object.getPrototypeOf(P);if(typeof P!="function"||P===h||I!==h)return I;var z=P.prototype,H=z&&Object.getPrototypeOf(z);if(H==null||H===Object.prototype)return I;var se=H.constructor;return typeof se!="function"||se===P?I:se}function Ze(){var P;!V(g)&&typeof r.Reflect<"u"&&!(g in r.Reflect)&&typeof r.Reflect.defineMetadata=="function"&&(P=Et(r.Reflect));var I,z,H,se=new f,_e={registerProvider:be,getProvider:Z,setProvider:ee};return _e;function be(te){if(!Object.isExtensible(_e))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case P===te:break;case V(I):I=te;break;case I===te:break;case V(z):z=te;break;case z===te:break;default:H===void 0&&(H=new m),H.add(te);break}}function le(te,ue){if(!V(I)){if(I.isProviderFor(te,ue))return I;if(!V(z)){if(z.isProviderFor(te,ue))return I;if(!V(H))for(var me=ot(H);;){var xe=qe(me);if(!xe)return;var Be=dt(xe);if(Be.isProviderFor(te,ue))return Ee(me),Be}}}if(!V(P)&&P.isProviderFor(te,ue))return P}function Z(te,ue){var me=se.get(te),xe;return V(me)||(xe=me.get(ue)),V(xe)&&(xe=le(te,ue),V(xe)||(V(me)&&(me=new p,se.set(te,me)),me.set(ue,xe))),xe}function J(te){if(V(te))throw new TypeError;return I===te||z===te||!V(H)&&H.has(te)}function ee(te,ue,me){if(!J(me))throw new Error("Metadata provider not registered.");var xe=Z(te,ue);if(xe!==me){if(!V(xe))return!1;var Be=se.get(te);V(Be)&&(Be=new p,se.set(te,Be)),Be.set(ue,me)}return!0}}function wt(){var P;return!V(g)&&K(r.Reflect)&&Object.isExtensible(r.Reflect)&&(P=r.Reflect[g]),V(P)&&(P=Ze()),!V(g)&&K(r.Reflect)&&Object.isExtensible(r.Reflect)&&Object.defineProperty(r.Reflect,g,{enumerable:!1,configurable:!1,writable:!1,value:P}),P}function Mt(P){var I=new f,z={isProviderFor:function(J,ee){var te=I.get(J);return V(te)?!1:te.has(ee)},OrdinaryDefineOwnMetadata:be,OrdinaryHasOwnMetadata:se,OrdinaryGetOwnMetadata:_e,OrdinaryOwnMetadataKeys:le,OrdinaryDeleteMetadata:Z};return y.registerProvider(z),z;function H(J,ee,te){var ue=I.get(J),me=!1;if(V(ue)){if(!te)return;ue=new p,I.set(J,ue),me=!0}var xe=ue.get(ee);if(V(xe)){if(!te)return;if(xe=new p,ue.set(ee,xe),!P.setProvider(J,ee,z))throw ue.delete(ee),me&&I.delete(J),new Error("Wrong provider for target.")}return xe}function se(J,ee,te){var ue=H(ee,te,!1);return V(ue)?!1:ie(ue.has(J))}function _e(J,ee,te){var ue=H(ee,te,!1);if(!V(ue))return ue.get(J)}function be(J,ee,te,ue){var me=H(te,ue,!0);me.set(J,ee)}function le(J,ee){var te=[],ue=H(J,ee,!1);if(V(ue))return te;for(var me=ue.keys(),xe=ot(me),Be=0;;){var Ar=qe(xe);if(!Ar)return te.length=Be,te;var Ba=dt(Ar);try{te[Be]=Ba}catch($a){try{Ee(xe)}finally{throw $a}}Be++}}function Z(J,ee,te){var ue=H(ee,te,!1);if(V(ue)||!ue.delete(J))return!1;if(ue.size===0){var me=I.get(ee);V(me)||(me.delete(te),me.size===0&&I.delete(me))}return!0}}function Et(P){var I=P.defineMetadata,z=P.hasOwnMetadata,H=P.getOwnMetadata,se=P.getOwnMetadataKeys,_e=P.deleteMetadata,be=new f,le={isProviderFor:function(Z,J){var ee=be.get(Z);return!V(ee)&&ee.has(J)?!0:se(Z,J).length?(V(ee)&&(ee=new m,be.set(Z,ee)),ee.add(J),!0):!1},OrdinaryDefineOwnMetadata:I,OrdinaryHasOwnMetadata:z,OrdinaryGetOwnMetadata:H,OrdinaryOwnMetadataKeys:se,OrdinaryDeleteMetadata:_e};return le}function Ge(P,I,z){var H=y.getProvider(P,I);if(!V(H))return H;if(z){if(y.setProvider(P,I,x))return x;throw new Error("Illegal state.")}}function Ra(){var P={},I=[],z=function(){function le(Z,J,ee){this._index=0,this._keys=Z,this._values=J,this._selector=ee}return le.prototype["@@iterator"]=function(){return this},le.prototype[a]=function(){return this},le.prototype.next=function(){var Z=this._index;if(Z>=0&&Z<this._keys.length){var J=this._selector(this._keys[Z],this._values[Z]);return Z+1>=this._keys.length?(this._index=-1,this._keys=I,this._values=I):this._index++,{value:J,done:!1}}return{value:void 0,done:!0}},le.prototype.throw=function(Z){throw this._index>=0&&(this._index=-1,this._keys=I,this._values=I),Z},le.prototype.return=function(Z){return this._index>=0&&(this._index=-1,this._keys=I,this._values=I),{value:Z,done:!0}},le}(),H=function(){function le(){this._keys=[],this._values=[],this._cacheKey=P,this._cacheIndex=-2}return Object.defineProperty(le.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),le.prototype.has=function(Z){return this._find(Z,!1)>=0},le.prototype.get=function(Z){var J=this._find(Z,!1);return J>=0?this._values[J]:void 0},le.prototype.set=function(Z,J){var ee=this._find(Z,!0);return this._values[ee]=J,this},le.prototype.delete=function(Z){var J=this._find(Z,!1);if(J>=0){for(var ee=this._keys.length,te=J+1;te<ee;te++)this._keys[te-1]=this._keys[te],this._values[te-1]=this._values[te];return this._keys.length--,this._values.length--,De(Z,this._cacheKey)&&(this._cacheKey=P,this._cacheIndex=-2),!0}return!1},le.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=P,this._cacheIndex=-2},le.prototype.keys=function(){return new z(this._keys,this._values,se)},le.prototype.values=function(){return new z(this._keys,this._values,_e)},le.prototype.entries=function(){return new z(this._keys,this._values,be)},le.prototype["@@iterator"]=function(){return this.entries()},le.prototype[a]=function(){return this.entries()},le.prototype._find=function(Z,J){if(!De(this._cacheKey,Z)){this._cacheIndex=-1;for(var ee=0;ee<this._keys.length;ee++)if(De(this._keys[ee],Z)){this._cacheIndex=ee;break}}return this._cacheIndex<0&&J&&(this._cacheIndex=this._keys.length,this._keys.push(Z),this._values.push(void 0)),this._cacheIndex},le}();return H;function se(le,Z){return le}function _e(le,Z){return Z}function be(le,Z){return[le,Z]}}function Cn(){var P=function(){function I(){this._map=new p}return Object.defineProperty(I.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),I.prototype.has=function(z){return this._map.has(z)},I.prototype.add=function(z){return this._map.set(z,z),this},I.prototype.delete=function(z){return this._map.delete(z)},I.prototype.clear=function(){this._map.clear()},I.prototype.keys=function(){return this._map.keys()},I.prototype.values=function(){return this._map.keys()},I.prototype.entries=function(){return this._map.entries()},I.prototype["@@iterator"]=function(){return this.keys()},I.prototype[a]=function(){return this.keys()},I}();return P}function Ia(){var P=16,I=u.create(),z=H();return function(){function Z(){this._key=H()}return Z.prototype.has=function(J){var ee=se(J,!1);return ee!==void 0?u.has(ee,this._key):!1},Z.prototype.get=function(J){var ee=se(J,!1);return ee!==void 0?u.get(ee,this._key):void 0},Z.prototype.set=function(J,ee){var te=se(J,!0);return te[this._key]=ee,this},Z.prototype.delete=function(J){var ee=se(J,!1);return ee!==void 0?delete ee[this._key]:!1},Z.prototype.clear=function(){this._key=H()},Z}();function H(){var Z;do Z="@@WeakMap@@"+le();while(u.has(I,Z));return I[Z]=!0,Z}function se(Z,J){if(!i.call(Z,z)){if(!J)return;Object.defineProperty(Z,z,{value:u.create()})}return Z[z]}function _e(Z,J){for(var ee=0;ee<J;++ee)Z[ee]=Math.random()*255|0;return Z}function be(Z){if(typeof Uint8Array=="function"){var J=new Uint8Array(Z);return typeof crypto<"u"?crypto.getRandomValues(J):typeof msCrypto<"u"?msCrypto.getRandomValues(J):_e(J,Z),J}return _e(new Array(Z),Z)}function le(){var Z=be(P);Z[6]=Z[6]&79|64,Z[8]=Z[8]&191|128;for(var J="",ee=0;ee<P;++ee){var te=Z[ee];(ee===4||ee===6||ee===8)&&(J+="-"),te<16&&(J+="0"),J+=te.toString(16).toLowerCase()}return J}}function Sn(P){return P.__=void 0,delete P.__,P}})}(t||(t={})),Gp}bw(),Wr=globalThis||void 0||self,typeof window<"u"&&(window.Buffer=dE),typeof Wr<"u"&&typeof require<"u"&&(Wr.Buffer=require("buffer/").Buffer);class Me{static isObject(e){return e!==null&&typeof e=="object"}static isObjectWithName(e){return e!==null&&typeof e=="object"&&e.name!==void 0}static assign(e,...n){for(const r of n)for(const i of Object.getOwnPropertyNames(r))e[i]=r[i]}static mixedListToArray(e){return e!==null&&typeof e=="object"?Object.keys(e).map(n=>e[n]):e}}class G extends Error{get name(){return this.constructor.name}constructor(e){super(e),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}class Vt extends G{constructor(){super("Locking not supported on given driver.")}}class la extends G{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}class fe{static isMssqlParameter(e){return this.check(e,"MssqlParameter")}static isEntityMetadata(e){return this.check(e,"EntityMetadata")}static isColumnMetadata(e){return this.check(e,"ColumnMetadata")}static isSelectQueryBuilder(e){return this.check(e,"SelectQueryBuilder")}static isInsertQueryBuilder(e){return this.check(e,"InsertQueryBuilder")}static isDeleteQueryBuilder(e){return this.check(e,"DeleteQueryBuilder")}static isUpdateQueryBuilder(e){return this.check(e,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(e){return this.check(e,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(e){return this.check(e,"RelationQueryBuilder")}static isBrackets(e){return this.check(e,"Brackets")||this.check(e,"NotBrackets")}static isNotBrackets(e){return this.check(e,"NotBrackets")}static isSubject(e){return this.check(e,"Subject")}static isRdbmsSchemaBuilder(e){return this.check(e,"RdbmsSchemaBuilder")}static isMongoEntityManager(e){return this.check(e,"MongoEntityManager")}static isSqljsEntityManager(e){return this.check(e,"SqljsEntityManager")}static isEntitySchema(e){return this.check(e,"EntitySchema")}static isBaseEntityConstructor(e){return typeof e=="function"&&typeof e.hasId=="function"&&typeof e.save=="function"&&typeof e.useDataSource=="function"}static isFindOperator(e){return this.check(e,"FindOperator")||this.check(e,"EqualOperator")}static isEqualOperator(e){return this.check(e,"EqualOperator")}static isQuery(e){return this.check(e,"Query")}static isTable(e){return this.check(e,"Table")}static isTableCheck(e){return this.check(e,"TableCheck")}static isTableColumn(e){return this.check(e,"TableColumn")}static isTableExclusion(e){return this.check(e,"TableExclusion")}static isTableForeignKey(e){return this.check(e,"TableForeignKey")}static isTableIndex(e){return this.check(e,"TableIndex")}static isTableUnique(e){return this.check(e,"TableUnique")}static isView(e){return this.check(e,"View")}static isDataSource(e){return this.check(e,"DataSource")}static check(e,n){return typeof e=="object"&&e!==null&&e["@instanceof"]===Symbol.for(n)}}class ww extends G{constructor(e,n){super(),this.entityClass=e,this.criteria=n,this.message=`Could not find any entity of type "${this.stringifyTarget(e)}" matching: ${this.stringifyCriteria(n)}`}stringifyTarget(e){return fe.isEntitySchema(e)?e.options.name:typeof e=="function"||Me.isObject(e)&&"name"in e?e.name:e}stringifyCriteria(e){try{return JSON.stringify(e,null,4)}catch{}return""+e}}class Kp extends G{constructor(e,n,r){super(`The optimistic lock on entity ${e} failed, version ${n} was expected, but is actually ${r}.`)}}class Jp extends G{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}class Mw extends G{constructor(e){super(`Entity "${e.name}" does not have delete date columns.`)}}class Cr extends G{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}class Qe extends G{constructor(e,n){super(e),Object.setPrototypeOf(this,Qe.prototype),this.message=`Property "${e}" was not found in "${n.targetName}". Make sure your query is correct.`}}class Ew extends G{constructor(e){super(`Entity ${e} does not have version or update date columns.`)}}class _w extends G{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}class wn extends G{constructor(){super("The optimistic lock can be used only with getOne() method.")}}class Cw extends G{constructor(e){super(),e.length===1?this.message=`Relation "${e[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${e.map(n=>`"${n}"`).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}class Sw extends G{constructor(){super("An open transaction is required for pessimistic lock.")}}class Ow extends G{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}class ef{constructor(e){Me.assign(this,e||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(e){this._metadata=e}get metadata(){if(!this._metadata)throw new G(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}class Ye{static isAliasProperty(e){if(typeof e!="string"||e.indexOf(".")===-1)return!1;const[n,r]=e.split(".");return!(!n||!r||e.indexOf("(")!==-1||e.indexOf(")")!==-1)}}var ua={exports:{}},da={exports:{}},tf;function qt(){return tf||(tf=1,typeof Object.create=="function"?da.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:da.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),da.exports}var ha={exports:{}},nf;function bt(){return nf||(nf=1,function(t,e){var n=hE(),r=n.Buffer;function i(s,a){for(var c in s)a[c]=s[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(i(n,e),e.Buffer=o);function o(s,a,c){return r(s,a,c)}o.prototype=Object.create(r.prototype),i(r,o),o.from=function(s,a,c){if(typeof s=="number")throw new TypeError("Argument must not be a number");return r(s,a,c)},o.alloc=function(s,a,c){if(typeof s!="number")throw new TypeError("Argument must be a number");var l=r(s);return a!==void 0?typeof c=="string"?l.fill(a,c):l.fill(a):l.fill(0),l},o.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return r(s)},o.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(s)}}(ha,ha.exports)),ha.exports}var pa,rf;function Wt(){if(rf)return pa;rf=1;var t=bt().Buffer;function e(n,r){this._block=t.alloc(n),this._finalSize=r,this._blockSize=n,this._len=0}return e.prototype.update=function(n,r){typeof n=="string"&&(r=r||"utf8",n=t.from(n,r));for(var i=this._block,o=this._blockSize,s=n.length,a=this._len,c=0;c<s;){for(var l=a%o,d=Math.min(s-c,o-l),u=0;u<d;u++)i[l+u]=n[c+u];a+=d,c+=d,a%o===0&&this._update(i)}return this._len+=s,this},e.prototype.digest=function(n){var r=this._len%this._blockSize;this._block[r]=128,this._block.fill(0,r+1),r>=this._finalSize&&(this._update(this._block),this._block.fill(0));var i=this._len*8;if(i<=4294967295)this._block.writeUInt32BE(i,this._blockSize-4);else{var o=(i&4294967295)>>>0,s=(i-o)/4294967296;this._block.writeUInt32BE(s,this._blockSize-8),this._block.writeUInt32BE(o,this._blockSize-4)}this._update(this._block);var a=this._hash();return n?a.toString(n):a},e.prototype._update=function(){throw new Error("_update must be implemented by subclass")},pa=e,pa}var fa,of;function Nw(){if(of)return fa;of=1;var t=qt(),e=Wt(),n=bt().Buffer,r=[1518500249,1859775393,-1894007588,-899497514],i=new Array(80);function o(){this.init(),this._w=i,e.call(this,64,56)}t(o,e),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function s(l){return l<<5|l>>>27}function a(l){return l<<30|l>>>2}function c(l,d,u,h){return l===0?d&u|~d&h:l===2?d&u|d&h|u&h:d^u^h}return o.prototype._update=function(l){for(var d=this._w,u=this._a|0,h=this._b|0,p=this._c|0,m=this._d|0,f=this._e|0,g=0;g<16;++g)d[g]=l.readInt32BE(g*4);for(;g<80;++g)d[g]=d[g-3]^d[g-8]^d[g-14]^d[g-16];for(var y=0;y<80;++y){var x=~~(y/20),v=s(u)+c(x,h,p,m)+f+d[y]+r[x]|0;f=m,m=p,p=a(h),h=u,u=v}this._a=u+this._a|0,this._b=h+this._b|0,this._c=p+this._c|0,this._d=m+this._d|0,this._e=f+this._e|0},o.prototype._hash=function(){var l=n.allocUnsafe(20);return l.writeInt32BE(this._a|0,0),l.writeInt32BE(this._b|0,4),l.writeInt32BE(this._c|0,8),l.writeInt32BE(this._d|0,12),l.writeInt32BE(this._e|0,16),l},fa=o,fa}var ma,sf;function Pw(){if(sf)return ma;sf=1;var t=qt(),e=Wt(),n=bt().Buffer,r=[1518500249,1859775393,-1894007588,-899497514],i=new Array(80);function o(){this.init(),this._w=i,e.call(this,64,56)}t(o,e),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function s(d){return d<<1|d>>>31}function a(d){return d<<5|d>>>27}function c(d){return d<<30|d>>>2}function l(d,u,h,p){return d===0?u&h|~u&p:d===2?u&h|u&p|h&p:u^h^p}return o.prototype._update=function(d){for(var u=this._w,h=this._a|0,p=this._b|0,m=this._c|0,f=this._d|0,g=this._e|0,y=0;y<16;++y)u[y]=d.readInt32BE(y*4);for(;y<80;++y)u[y]=s(u[y-3]^u[y-8]^u[y-14]^u[y-16]);for(var x=0;x<80;++x){var v=~~(x/20),b=a(h)+l(v,p,m,f)+g+u[x]+r[v]|0;g=f,f=m,m=c(p),p=h,h=b}this._a=h+this._a|0,this._b=p+this._b|0,this._c=m+this._c|0,this._d=f+this._d|0,this._e=g+this._e|0},o.prototype._hash=function(){var d=n.allocUnsafe(20);return d.writeInt32BE(this._a|0,0),d.writeInt32BE(this._b|0,4),d.writeInt32BE(this._c|0,8),d.writeInt32BE(this._d|0,12),d.writeInt32BE(this._e|0,16),d},ma=o,ma}var ya,af;function cf(){if(af)return ya;af=1;var t=qt(),e=Wt(),n=bt().Buffer,r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=new Array(64);function o(){this.init(),this._w=i,e.call(this,64,56)}t(o,e),o.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function s(h,p,m){return m^h&(p^m)}function a(h,p,m){return h&p|m&(h|p)}function c(h){return(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10)}function l(h){return(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7)}function d(h){return(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3}function u(h){return(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10}return o.prototype._update=function(h){for(var p=this._w,m=this._a|0,f=this._b|0,g=this._c|0,y=this._d|0,x=this._e|0,v=this._f|0,b=this._g|0,M=this._h|0,C=0;C<16;++C)p[C]=h.readInt32BE(C*4);for(;C<64;++C)p[C]=u(p[C-2])+p[C-7]+d(p[C-15])+p[C-16]|0;for(var E=0;E<64;++E){var A=M+l(x)+s(x,v,b)+r[E]+p[E]|0,R=c(m)+a(m,f,g)|0;M=b,b=v,v=x,x=y+A|0,y=g,g=f,f=m,m=A+R|0}this._a=m+this._a|0,this._b=f+this._b|0,this._c=g+this._c|0,this._d=y+this._d|0,this._e=x+this._e|0,this._f=v+this._f|0,this._g=b+this._g|0,this._h=M+this._h|0},o.prototype._hash=function(){var h=n.allocUnsafe(32);return h.writeInt32BE(this._a,0),h.writeInt32BE(this._b,4),h.writeInt32BE(this._c,8),h.writeInt32BE(this._d,12),h.writeInt32BE(this._e,16),h.writeInt32BE(this._f,20),h.writeInt32BE(this._g,24),h.writeInt32BE(this._h,28),h},ya=o,ya}var ga,lf;function Aw(){if(lf)return ga;lf=1;var t=qt(),e=cf(),n=Wt(),r=bt().Buffer,i=new Array(64);function o(){this.init(),this._w=i,n.call(this,64,56)}return t(o,e),o.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},o.prototype._hash=function(){var s=r.allocUnsafe(28);return s.writeInt32BE(this._a,0),s.writeInt32BE(this._b,4),s.writeInt32BE(this._c,8),s.writeInt32BE(this._d,12),s.writeInt32BE(this._e,16),s.writeInt32BE(this._f,20),s.writeInt32BE(this._g,24),s},ga=o,ga}var va,uf;function df(){if(uf)return va;uf=1;var t=qt(),e=Wt(),n=bt().Buffer,r=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],i=new Array(160);function o(){this.init(),this._w=i,e.call(this,128,112)}t(o,e),o.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function s(f,g,y){return y^f&(g^y)}function a(f,g,y){return f&g|y&(f|g)}function c(f,g){return(f>>>28|g<<4)^(g>>>2|f<<30)^(g>>>7|f<<25)}function l(f,g){return(f>>>14|g<<18)^(f>>>18|g<<14)^(g>>>9|f<<23)}function d(f,g){return(f>>>1|g<<31)^(f>>>8|g<<24)^f>>>7}function u(f,g){return(f>>>1|g<<31)^(f>>>8|g<<24)^(f>>>7|g<<25)}function h(f,g){return(f>>>19|g<<13)^(g>>>29|f<<3)^f>>>6}function p(f,g){return(f>>>19|g<<13)^(g>>>29|f<<3)^(f>>>6|g<<26)}function m(f,g){return f>>>0<g>>>0?1:0}return o.prototype._update=function(f){for(var g=this._w,y=this._ah|0,x=this._bh|0,v=this._ch|0,b=this._dh|0,M=this._eh|0,C=this._fh|0,E=this._gh|0,A=this._hh|0,R=this._al|0,B=this._bl|0,$=this._cl|0,F=this._dl|0,D=this._el|0,w=this._fl|0,k=this._gl|0,O=this._hl|0,T=0;T<32;T+=2)g[T]=f.readInt32BE(T*4),g[T+1]=f.readInt32BE(T*4+4);for(;T<160;T+=2){var N=g[T-30],j=g[T-15*2+1],L=d(N,j),q=u(j,N);N=g[T-2*2],j=g[T-2*2+1];var U=h(N,j),V=p(j,N),Y=g[T-7*2],X=g[T-7*2+1],K=g[T-16*2],ne=g[T-16*2+1],W=q+X|0,ie=L+Y+m(W,q)|0;W=W+V|0,ie=ie+U+m(W,V)|0,W=W+ne|0,ie=ie+K+m(W,ne)|0,g[T]=ie,g[T+1]=W}for(var ce=0;ce<160;ce+=2){ie=g[ce],W=g[ce+1];var oe=a(y,x,v),ae=a(R,B,$),he=c(y,R),pe=c(R,y),Te=l(M,D),De=l(D,M),ut=r[ce],ot=r[ce+1],dt=s(M,C,E),qe=s(D,w,k),Ee=O+De|0,Oe=A+Te+m(Ee,O)|0;Ee=Ee+qe|0,Oe=Oe+dt+m(Ee,qe)|0,Ee=Ee+ot|0,Oe=Oe+ut+m(Ee,ot)|0,Ee=Ee+W|0,Oe=Oe+ie+m(Ee,W)|0;var Ze=pe+ae|0,wt=he+oe+m(Ze,pe)|0;A=E,O=k,E=C,k=w,C=M,w=D,D=F+Ee|0,M=b+Oe+m(D,F)|0,b=v,F=$,v=x,$=B,x=y,B=R,R=Ee+Ze|0,y=Oe+wt+m(R,Ee)|0}this._al=this._al+R|0,this._bl=this._bl+B|0,this._cl=this._cl+$|0,this._dl=this._dl+F|0,this._el=this._el+D|0,this._fl=this._fl+w|0,this._gl=this._gl+k|0,this._hl=this._hl+O|0,this._ah=this._ah+y+m(this._al,R)|0,this._bh=this._bh+x+m(this._bl,B)|0,this._ch=this._ch+v+m(this._cl,$)|0,this._dh=this._dh+b+m(this._dl,F)|0,this._eh=this._eh+M+m(this._el,D)|0,this._fh=this._fh+C+m(this._fl,w)|0,this._gh=this._gh+E+m(this._gl,k)|0,this._hh=this._hh+A+m(this._hl,O)|0},o.prototype._hash=function(){var f=n.allocUnsafe(64);function g(y,x,v){f.writeInt32BE(y,v),f.writeInt32BE(x,v+4)}return g(this._ah,this._al,0),g(this._bh,this._bl,8),g(this._ch,this._cl,16),g(this._dh,this._dl,24),g(this._eh,this._el,32),g(this._fh,this._fl,40),g(this._gh,this._gl,48),g(this._hh,this._hl,56),f},va=o,va}var xa,hf;function kw(){if(hf)return xa;hf=1;var t=qt(),e=df(),n=Wt(),r=bt().Buffer,i=new Array(160);function o(){this.init(),this._w=i,n.call(this,128,112)}return t(o,e),o.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},o.prototype._hash=function(){var s=r.allocUnsafe(48);function a(c,l,d){s.writeInt32BE(c,d),s.writeInt32BE(l,d+4)}return a(this._ah,this._al,0),a(this._bh,this._bl,8),a(this._ch,this._cl,16),a(this._dh,this._dl,24),a(this._eh,this._el,32),a(this._fh,this._fl,40),s},xa=o,xa}var pf;function Tw(){if(pf)return ua.exports;pf=1;var t=ua.exports=function(e){e=e.toLowerCase();var n=t[e];if(!n)throw new Error(e+" is not supported (we accept pull requests)");return new n};return t.sha=Nw(),t.sha1=Pw(),t.sha224=Aw(),t.sha256=cf(),t.sha384=kw(),t.sha512=df(),ua.exports}var jw=Tw();const Rw=Yt(jw);function Iw(t,e={}){const{segmentLength:n=4,separator:r="__",termLength:i=2}=e;return t.split(r).reduce((o,s)=>{const a=s.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),c=a.length>1?i:n,l=a.map(d=>d.substr(0,c)).join("");return o.push(l),o},[]).join(r)}function Bw(t,e={}){const n=Rw("sha1");n.update(t,"utf8");const r=n.digest("hex");return e.length?r.slice(0,e.length):r}class $w{static isGreaterOrEqual(e,n){const r=ff(e),i=ff(n);return r[0]>i[0]||r[0]===i[0]&&r[1]>i[1]||r[0]===i[0]&&r[1]===i[1]&&r[2]>=i[2]}}function ff(t=""){const e=[0,0,0];return t.split(".").forEach((n,r)=>e[r]=parseInt(n,10)),e}class Q{static isSQLiteFamily(e){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(e.options.type)}static isMySQLFamily(e){return["mysql","mariadb"].includes(e.options.type)}static isReleaseVersionOrGreater(e,n){return e.version!=null&&$w.isGreaterOrEqual(e.version,n)}static isPostgresFamily(e){return["postgres","aurora-postgres","cockroachdb"].includes(e.options.type)}static buildDriverOptions(e,n){if(e.url){const r=this.parseConnectionUrl(e.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const i of Object.keys(r))typeof r[i]>"u"&&delete r[i];return Object.assign({},e,r)}return Object.assign({},e)}static buildMongoDBDriverOptions(e,n){if(e.url){const r=this.parseMongoDBConnectionUrl(e.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const i of Object.keys(r))typeof r[i]>"u"&&delete r[i];return Object.assign({},e,r)}return Object.assign({},e)}static buildAlias({maxAliasLength:e},n,...r){const i=n&&n.joiner?n.joiner:"_";let o=r.length===1?r[0]:r.join(i);if(e&&e>0&&o.length>e){if(n&&n.shorten===!0){const s=Iw(o);if(s.length<e)return s}return Bw(o,{length:e})}return o}static buildColumnAlias({maxAliasLength:e},n,...r){return typeof n=="string"?(r.unshift(n),n={shorten:!1,joiner:"_"}):n=Object.assign({shorten:!1,joiner:"_"},n),this.buildAlias({maxAliasLength:e},n,...r)}static parseConnectionUrl(e){const n=e.split(":")[0],r=e.indexOf("//"),i=e.substr(r+2),o=i.indexOf("/"),s=o!==-1?i.substr(0,o):i;let a=o!==-1?i.substr(o+1):void 0;a&&a.indexOf("?")!==-1&&(a=a.substr(0,a.indexOf("?")));const c=s.lastIndexOf("@"),l=s.substr(0,c),d=s.substr(c+1);let u=l,h="";const p=l.indexOf(":");p!==-1&&(u=l.substr(0,p),h=l.substr(p+1));const[m,f]=d.split(":");return{type:n,host:m,username:decodeURIComponent(u),password:decodeURIComponent(h),port:f?parseInt(f):void 0,database:a||void 0}}static parseMongoDBConnectionUrl(e){const n=e.split(":")[0],r=e.indexOf("//"),i=e.substr(r+2),o=i.indexOf("/"),s=o!==-1?i.substr(0,o):i;let a=o!==-1?i.substr(o+1):void 0,c="",l,d,u,h,p={};if(a&&a.indexOf("?")!==-1){c=a.substr(a.indexOf("?")+1,a.length);const M=c.split("&");let C,E;M.forEach(A=>{C=A.split("=")[0],E=A.split("=")[1],p[C]=E}),h=p.replicaSet,a=a.substr(0,a.indexOf("?"))}const m=s.lastIndexOf("@"),f=s.substr(0,m),g=s.substr(m+1);let y=f,x="";const v=f.indexOf(":");v!==-1&&(y=f.substr(0,v),x=f.substr(v+1)),h?u=g:[l,d]=g.split(":");let b={type:n,host:l,hostReplicaSet:u,username:decodeURIComponent(y),password:decodeURIComponent(x),port:d?parseInt(d):void 0,database:a||void 0};for(const[M,C]of Object.entries(p))b[M]=C;return b}}class mf{constructor(e,n,r){this.connection=e,this.queryExpressionMap=n,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,r&&Me.assign(this,r)}get isMany(){return this.isMappingMany!==void 0?this.isMappingMany:this.relation?this.relation.isManyToMany||this.relation.isOneToMany:!1}get isSelected(){if(!this.isSelectedEvaluated){let e=()=>{for(const n of this.queryExpressionMap.selects)if(n.selection===this.alias.name||this.metadata&&this.metadata.columns.find(r=>n.selection===this.alias.name+"."+r.propertyPath))return!0;return!1};this.isSelectedCache=e(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(Ye.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(Ye.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let e=()=>{if(!Ye.isAliasProperty(this.entityOrProperty))return;const n=this.queryExpressionMap.findAliasByName(this.parentAlias);let r=n.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(r||n.metadata.parentEntityMetadata&&(r=n.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),r))return r;throw new G(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=e.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){if(this.relation)return this.relation.inverseEntityMetadata;if(this.connection.hasMetadata(this.entityOrProperty))return this.connection.getMetadata(this.entityOrProperty);if(this.mapAsEntity&&this.connection.hasMetadata(this.mapAsEntity))return this.connection.getMetadata(this.mapAsEntity)}get junctionAlias(){if(!this.relation)throw new G("Cannot get junction table for join without relation.");if(typeof this.entityOrProperty!="string")throw new G("Junction property is not defined.");const e=this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."));return this.relation.isOwning?Q.buildAlias(this.connection.driver,void 0,e,this.alias.name):Q.buildAlias(this.connection.driver,void 0,this.alias.name,e)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}class ba{constructor(e,n){this.queryExpressionMap=e,this.disableMixedMap=!1,Me.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!Ye.isAliasProperty(this.relationName))throw new G("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!Ye.isAliasProperty(this.relationName))throw new G("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!Ye.isAliasProperty(this.relationName))throw new G("Given value must be a string representation of alias property");const e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new G(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return e}get junctionAlias(){const[e,n]=this.relationName.split(".");return e+"_"+n+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}class wa{constructor(e,n){this.expressionMap=e,Me.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!Ye.isAliasProperty(this.relationName))throw new G("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!Ye.isAliasProperty(this.relationName))throw new G("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[e,n]=this.relationName.split(".");return e+"_"+n+"_rc"}get relation(){if(!Ye.isAliasProperty(this.relationName))throw new G("Given value is a string representation of alias property");const[e,n]=this.relationName.split("."),r=this.expressionMap.findAliasByName(e).metadata.findRelationWithPropertyPath(n);if(!r)throw new G(`Relation with property path ${n} in entity was not found.`);return r}get metadata(){if(!Ye.isAliasProperty(this.relationName))throw new G("Given value is a string representation of alias property");const e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}class Ma{constructor(e){var n;this.connection=e,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],e.options.relationLoadStrategy&&(this.relationLoadStrategy=e.options.relationLoadStrategy),this.timeTravel=((n=e.options)==null?void 0:n.timeTravelQueries)||!1}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&this.options.indexOf("disable-global-order")===-1){const e=this.mainAlias.metadata.orderBy||{};return Object.keys(e).reduce((n,r)=>(n[this.mainAlias.name+"."+r]=e[r],n),{})}return this.orderBys}setMainAlias(e){return this.mainAlias=e,e}createAlias(e){let n=e.name;!n&&e.tablePath&&(n=e.tablePath),!n&&typeof e.target=="function"&&(n=e.target.name),!n&&typeof e.target=="string"&&(n=e.target);const r=new ef;return r.type=e.type,n&&(r.name=n),e.metadata&&(r.metadata=e.metadata),e.target&&!r.hasMetadata&&(r.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(r.tablePath=e.tablePath),e.subQuery&&(r.subQuery=e.subQuery),this.aliases.push(r),r}findAliasByName(e){const n=this.aliases.find(r=>r.name===e);if(!n)throw new G(`"${e}" alias was not found. Maybe you forgot to join it?`);return n}findColumnByAliasExpression(e){const[n,r]=e.split(".");return this.findAliasByName(n).metadata.findColumnWithPropertyName(r)}get relationMetadata(){if(!this.mainAlias)throw new G("Entity to work with is not specified!");const e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new G(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return e}clone(){const e=new Ma(this.connection);return e.queryType=this.queryType,e.selects=this.selects.map(n=>n),e.maxExecutionTime=this.maxExecutionTime,e.selectDistinct=this.selectDistinct,e.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(n=>e.aliases.push(new ef(n))),e.relationLoadStrategy=this.relationLoadStrategy,e.mainAlias=this.mainAlias,e.valuesSet=this.valuesSet,e.returning=this.returning,e.onConflict=this.onConflict,e.onIgnore=this.onIgnore,e.onUpdate=this.onUpdate,e.joinAttributes=this.joinAttributes.map(n=>new mf(this.connection,this,n)),e.relationIdAttributes=this.relationIdAttributes.map(n=>new ba(this,n)),e.relationCountAttributes=this.relationCountAttributes.map(n=>new wa(this,n)),e.wheres=this.wheres.map(n=>({...n})),e.havings=this.havings.map(n=>({...n})),e.orderBys=Object.assign({},this.orderBys),e.groupBys=this.groupBys.map(n=>n),e.limit=this.limit,e.offset=this.offset,e.skip=this.skip,e.take=this.take,e.lockMode=this.lockMode,e.onLocked=this.onLocked,e.lockVersion=this.lockVersion,e.lockTables=this.lockTables,e.withDeleted=this.withDeleted,e.parameters=Object.assign({},this.parameters),e.disableEscaping=this.disableEscaping,e.enableRelationIdValues=this.enableRelationIdValues,e.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,e.subQuery=this.subQuery,e.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,e.cache=this.cache,e.cacheId=this.cacheId,e.cacheDuration=this.cacheDuration,e.relationPropertyPath=this.relationPropertyPath,e.of=this.of,e.insertColumns=this.insertColumns,e.whereEntities=this.whereEntities,e.updateEntity=this.updateEntity,e.callListeners=this.callListeners,e.useTransaction=this.useTransaction,e.timeTravel=this.timeTravel,e.nativeParameters=Object.assign({},this.nativeParameters),e.comment=this.comment,e.commonTableExpressions=this.commonTableExpressions.map(n=>({alias:n.alias,queryBuilder:typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.clone(),options:n.options})),e}}class yf{constructor(e){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=e}}class Ea{static transformFrom(e,n){return Array.isArray(e)?e.slice().reverse().reduce((r,i)=>i.from(r),n):e.from(n)}static transformTo(e,n){return Array.isArray(e)?e.reduce((r,i)=>i.to(r),n):e.to(n)}}class Mn{constructor(e,n,r=!0,i=!1,o,s){this["@instanceof"]=Symbol.for("FindOperator"),this._type=e,this._value=n,this._useParameter=r,this._multipleParameters=i,this._getSql=o,this._objectLiteralParameters=s}get useParameter(){return fe.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return fe.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return fe.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return fe.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(fe.isFindOperator(this._value))return this._value}get getSql(){return fe.isFindOperator(this._value)?this._value.getSql:this._getSql}transformValue(e){this._value instanceof Mn?this._value.transformValue(e):this._value=Array.isArray(this._value)&&this._multipleParameters?this._value.map(n=>e&&Ea.transformTo(e,n)):Ea.transformTo(e,this._value)}}jr=function(t){return new Mn("in",t,!0,!0)};const Dw=/[.*+\-?^${}()|[\]\\]/g,Lw=t=>t.replace(Dw,"\\$&");class ve{constructor(e,n){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,fe.isDataSource(e)?(this.connection=e,this.queryRunner=n,this.expressionMap=new Ma(this.connection)):(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone())}static registerQueryBuilderClass(e,n){ve.queryBuilderRegistry[e]=n}get alias(){if(!this.expressionMap.mainAlias)throw new G("Main alias is not set");return this.expressionMap.mainAlias.name}select(e,n){return this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map(r=>({selection:r})):e&&(this.expressionMap.selects=[{selection:e,aliasName:n}]),fe.isSelectQueryBuilder(this)?this:ve.queryBuilderRegistry.SelectQueryBuilder(this)}insert(){return this.expressionMap.queryType="insert",fe.isInsertQueryBuilder(this)?this:ve.queryBuilderRegistry.InsertQueryBuilder(this)}update(e,n){const r=n||e;if(e=fe.isEntitySchema(e)?e.options.name:e,typeof e=="function"||typeof e=="string"){const i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}return this.expressionMap.queryType="update",this.expressionMap.valuesSet=r,fe.isUpdateQueryBuilder(this)?this:ve.queryBuilderRegistry.UpdateQueryBuilder(this)}delete(){return this.expressionMap.queryType="delete",fe.isDeleteQueryBuilder(this)?this:ve.queryBuilderRegistry.DeleteQueryBuilder(this)}softDelete(){return this.expressionMap.queryType="soft-delete",fe.isSoftDeleteQueryBuilder(this)?this:ve.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}restore(){return this.expressionMap.queryType="restore",fe.isSoftDeleteQueryBuilder(this)?this:ve.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}relation(e,n){const r=arguments.length===2?e:void 0,i=arguments.length===2?n:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){const o=this.createFromAlias(r);this.expressionMap.setMainAlias(o)}return fe.isRelationQueryBuilder(this)?this:ve.queryBuilderRegistry.RelationQueryBuilder(this)}hasRelation(e,n){const r=this.connection.getMetadata(e);return(Array.isArray(n)?n:[n]).every(i=>!!r.findRelationWithPropertyPath(i))}hasParameter(e){var n;return((n=this.parentQueryBuilder)==null?void 0:n.hasParameter(e))||e in this.expressionMap.parameters}setParameter(e,n){if(typeof n=="function")throw new G(`Function parameter isn't supported in the parameters. Please check "${e}" parameter.`);if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new G("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,n),this.expressionMap.parameters[e]=n,this}setParameters(e){for(const[n,r]of Object.entries(e))this.setParameter(n,r);return this}createParameter(e){let n;do n=`orm_param_${this.parameterIndex++}`;while(this.hasParameter(n));return this.setParameter(n,e),`:${n}`}setNativeParameters(e){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(n=>{this.expressionMap.nativeParameters[n]=e[n]}),this}getParameters(){const e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const n=this.expressionMap.mainAlias.metadata;if(n.discriminatorColumn&&n.parentEntityMetadata){const r=n.childEntityMetadatas.filter(i=>i.discriminatorColumn).map(i=>i.discriminatorValue);r.push(n.discriminatorValue),e.discriminatorColumnValues=r}}return e}printSql(){const[e,n]=this.getQueryAndParameters();return this.connection.logger.logQuery(e,n),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const e=this.getQuery(),n=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,n,this.expressionMap.nativeParameters)}async execute(){const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();try{return await r.query(e,n)}finally{r!==this.queryRunner&&await r.release()}}createQueryBuilder(e){return new this.constructor(this.connection,e??this.queryRunner)}clone(){return new this.constructor(this)}comment(e){return this.expressionMap.comment=e,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e}setQueryRunner(e){return this.queryRunner=e,this}callListeners(e){return this.expressionMap.callListeners=e,this}useTransaction(e){return this.expressionMap.useTransaction=e,this}addCommonTableExpression(e,n,r){return this.expressionMap.commonTableExpressions.push({queryBuilder:e,alias:n,options:r||{}}),this}getTableName(e){return e.split(".").map(n=>n===""?n:this.escape(n)).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new G('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(e,n){if(this.connection.hasMetadata(e)){const r=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:n,metadata:this.connection.getMetadata(e),tablePath:r.tablePath})}else{if(typeof e=="string"){const o=e.substr(0,1)==="("&&e.substr(-1)===")";return this.expressionMap.createAlias({type:"from",name:n,tablePath:o?void 0:e,subQuery:o?e:void 0})}const r=e(this.subQuery());this.setParameters(r.getParameters());const i=r.getQuery();return this.expressionMap.createAlias({type:"from",name:n,subQuery:i})}}replacePropertyNames(e){return e}replacePropertyNamesForTheWholeQuery(e){const n={};for(const o of this.expressionMap.aliases){if(!o.hasMetadata)continue;const s=this.expressionMap.aliasNamePrefixingEnabled&&o.name?`${o.name}.`:"";n[s]||(n[s]={});for(const a of o.metadata.relations)a.joinColumns.length>0&&(n[s][a.propertyPath]=a.joinColumns[0].databaseName);for(const a of o.metadata.relations){const c=[...a.joinColumns,...a.inverseJoinColumns];for(const l of c){const d=`${a.propertyPath}.${l.referencedColumn.propertyPath}`;n[s][d]=l.databaseName}}for(const a of o.metadata.columns)n[s][a.databaseName]=a.databaseName;for(const a of o.metadata.columns)n[s][a.propertyName]=a.databaseName;for(const a of o.metadata.columns)n[s][a.propertyPath]=a.databaseName}const r=Object.keys(n),i=r.map(o=>Lw(o)).join("|");return r.length>0&&(e=e.replace(new RegExp(`([ =(]|^.{0})${i?"("+i+")":""}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),(...o)=>{let s,a,c;if(i){if(s=o[0],a=o[1],c=o[3],n[o[2]][c])return`${a}${this.escape(o[2].substring(0,o[2].length-1))}.${this.escape(n[o[2]][c])}`}else if(s=o[0],a=o[1],c=o[2],n[""][c])return`${a}${this.escape(n[""][c])}`;return s})),e}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace(/\*\//g,"")} */ `:""}createTimeTravelQuery(){return this.expressionMap.queryType==="select"&&this.expressionMap.timeTravel?` AS OF SYSTEM TIME ${this.expressionMap.timeTravel}`:""}createWhereExpression(){const e=[],n=this.createWhereClausesExpression(this.expressionMap.wheres);if(n.length>0&&n!=="1=1"&&e.push(this.replacePropertyNames(n)),this.expressionMap.mainAlias.hasMetadata){const i=this.expressionMap.mainAlias.metadata;if(this.expressionMap.queryType==="select"&&!this.expressionMap.withDeleted&&i.deleteDateColumn){const o=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+i.deleteDateColumn.propertyName:i.deleteDateColumn.propertyName,s=`${this.replacePropertyNames(o)} IS NULL`;e.push(s)}if(i.discriminatorColumn&&i.parentEntityMetadata){const o=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+i.discriminatorColumn.databaseName:i.discriminatorColumn.databaseName,s=`${this.replacePropertyNames(o)} IN (:...discriminatorColumnValues)`;e.push(s)}}if(this.expressionMap.extraAppendedAndWhereCondition){const i=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(i)}let r="";return r+=this.createTimeTravelQuery(),e.length?e.length===1?r+=` WHERE ${e[0]}`:r+=` WHERE ( ${e.join(" ) AND ( ")} )`:r+="",r}createReturningExpression(e){const n=this.getReturningColumns(),r=this.connection.driver;if(typeof this.expressionMap.returning!="string"&&this.expressionMap.extraReturningColumns.length>0&&r.isReturningSqlSupported(e)&&n.push(...this.expressionMap.extraReturningColumns.filter(i=>n.indexOf(i)===-1)),n.length){let i=n.map(o=>{const s=this.escape(o.databaseName);return r.options.type==="mssql"?this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update"||this.expressionMap.queryType==="soft-delete"||this.expressionMap.queryType==="restore"?"INSERTED."+s:this.escape(this.getMainTableName())+"."+s:s}).join(", ");return r.options.type==="oracle"&&(i+=" INTO "+n.map(o=>this.createParameter({type:r.columnTypeToNativeParameter(o.type),dir:r.oracle.BIND_OUT})).join(", ")),r.options.type==="mssql"&&(this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update")&&(i+=" INTO @OutputTable"),i}else if(typeof this.expressionMap.returning=="string")return this.expressionMap.returning;return""}getReturningColumns(){const e=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(n=>{this.expressionMap.mainAlias.hasMetadata&&e.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n))}),e}createWhereClausesExpression(e){return e.map((n,r)=>{const i=this.createWhereConditionExpression(n.condition);switch(n.type){case"and":return(r>0?"AND ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${i}${this.connection.options.isolateWhereStatements?")":""}`;case"or":return(r>0?"OR ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${i}${this.connection.options.isolateWhereStatements?")":""}`}return i}).join(" ").trim()}createWhereConditionExpression(e,n=!1){if(typeof e=="string")return e;if(Array.isArray(e))return e.length===0?"1=1":e.length===1&&!n?this.createWhereClausesExpression(e):"("+this.createWhereClausesExpression(e)+")";const{driver:r}=this.connection;switch(e.operator){case"lessThan":return`${e.parameters[0]} < ${e.parameters[1]}`;case"lessThanOrEqual":return`${e.parameters[0]} <= ${e.parameters[1]}`;case"arrayContains":return`${e.parameters[0]} @> ${e.parameters[1]}`;case"jsonContains":return`${e.parameters[0]} ::jsonb @> ${e.parameters[1]}`;case"arrayContainedBy":return`${e.parameters[0]} <@ ${e.parameters[1]}`;case"arrayOverlap":return`${e.parameters[0]} && ${e.parameters[1]}`;case"moreThan":return`${e.parameters[0]} > ${e.parameters[1]}`;case"moreThanOrEqual":return`${e.parameters[0]} >= ${e.parameters[1]}`;case"notEqual":return`${e.parameters[0]} != ${e.parameters[1]}`;case"equal":return`${e.parameters[0]} = ${e.parameters[1]}`;case"ilike":return r.options.type==="postgres"||r.options.type==="cockroachdb"?`${e.parameters[0]} ILIKE ${e.parameters[1]}`:`UPPER(${e.parameters[0]}) LIKE UPPER(${e.parameters[1]})`;case"like":return`${e.parameters[0]} LIKE ${e.parameters[1]}`;case"between":return`${e.parameters[0]} BETWEEN ${e.parameters[1]} AND ${e.parameters[2]}`;case"in":return e.parameters.length<=1?"0=1":`${e.parameters[0]} IN (${e.parameters.slice(1).join(", ")})`;case"any":return r.options.type==="cockroachdb"?`${e.parameters[0]}::STRING = ANY(${e.parameters[1]}::STRING[])`:`${e.parameters[0]} = ANY(${e.parameters[1]})`;case"isNull":return`${e.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(e.condition)})`;case"brackets":return`${this.createWhereConditionExpression(e.condition,!0)}`;case"and":return"("+e.parameters.join(" AND ")+")";case"or":return"("+e.parameters.join(" OR ")+")"}throw new TypeError(`Unsupported FindOperator ${Mn.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const e=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map(n=>{const r=typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.getQuery();if(typeof n.queryBuilder!="string"){if(n.queryBuilder.hasCommonTableExpressions())throw new G(`Nested CTEs aren't supported (CTE: ${n.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!fe.isSelectQueryBuilder(n.queryBuilder))throw new G(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${n.alias})`);this.setParameters(n.queryBuilder.getParameters())}let i=this.escape(n.alias);if(n.options.columnNames){const a=n.options.columnNames.map(c=>this.escape(c));if(fe.isSelectQueryBuilder(n.queryBuilder)&&n.queryBuilder.expressionMap.selects.length&&n.options.columnNames.length!==n.queryBuilder.expressionMap.selects.length)throw new G(`cte.options.columnNames length (${n.options.columnNames.length}) doesn't match subquery select list length ${n.queryBuilder.expressionMap.selects.length} (CTE: ${n.alias})`);i+=`(${a.join(", ")})`}const o=n.options.recursive&&e?"RECURSIVE":"";let s="";return this.connection.driver.cteCapabilities.materializedHint&&n.options.materialized!==void 0&&(s=n.options.materialized?"MATERIALIZED":"NOT MATERIALIZED"),[o,i,"AS",s,`(${r})`].filter(Boolean).join(" ")}).join(", ")+" "}getWhereInIdsCondition(e){const n=this.expressionMap.mainAlias.metadata,r=(Array.isArray(e)?e:[e]).map(i=>n.ensureEntityIdMap(i));if(!n.hasMultiplePrimaryKeys){const i=n.primaryColumns[0];if(!i.transformer&&!i.relationMetadata&&!i.embeddedMetadata)return{[i.propertyName]:jr(r.map(o=>i.getEntityValue(o,!1)))}}return new yf(i=>{for(const o of r)i.orWhere(new yf(s=>s.where(o)))})}getExistsCondition(e){const n=e.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select("1").setOption("disable-global-order");return[`EXISTS (${n.getQuery()})`,n.getParameters()]}findColumnsForPropertyPath(e){let n=this.expressionMap.mainAlias;const r=[],i=e.split(".");for(;i.length>1;){const a=i[0];if(!(n!=null&&n.hasMetadata))break;if(n.metadata.hasEmbeddedWithPropertyPath(a)){i.unshift(`${i.shift()}.${i.shift()}`);continue}if(n.metadata.hasRelationWithPropertyPath(a)){const c=this.expressionMap.joinAttributes.find(l=>l.relationPropertyPath===a);if(!(c!=null&&c.alias)){const l=r.length>0?`${r.join(".")}.${a}`:a;throw new Error(`Cannot find alias for relation at ${l}`)}n=c.alias,r.push(...a.split(".")),i.shift();continue}break}if(!n)throw new Error(`Cannot find alias for property ${e}`);const o=i.join("."),s=n.metadata.findColumnsWithPropertyPath(o);if(!s.length)throw new Qe(e,n.metadata);return[n,r,s]}createPropertyPath(e,n,r=""){const i=[];for(const o of Object.keys(n)){const s=r?`${r}.${o}`:o;if(n[o]===null||typeof n[o]!="object"||fe.isFindOperator(n[o])){i.push(s);continue}if(e.hasEmbeddedWithPropertyPath(s)){const a=this.createPropertyPath(e,n[o],s);i.push(...a);continue}if(e.hasRelationWithPropertyPath(s)){const a=e.findRelationWithPropertyPath(s);if(a.relationType==="one-to-one"||a.relationType==="many-to-one"){const d=a.joinColumns.map(u=>u.referencedColumn).filter(u=>!!u);if(d.length>0&&d.every(u=>u.getEntityValue(n[o],!1))){i.push(s);continue}}if(a.relationType==="one-to-many"||a.relationType==="many-to-many")throw new Error(`Cannot query across ${a.relationType} for property ${s}`);const c=a.inverseEntityMetadata.primaryColumns;if(c.length>0&&c.every(d=>d.getEntityValue(n[o],!1))){const d=c.map(u=>`${s}.${u.propertyPath}`);i.push(...d);continue}const l=this.createPropertyPath(a.inverseEntityMetadata,n[o]).map(d=>`${s}.${d}`);i.push(...l);continue}i.push(s)}return i}*getPredicates(e){if(this.expressionMap.mainAlias.hasMetadata){const n=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e);for(const r of n){const[i,o,s]=this.findColumnsForPropertyPath(r);for(const a of s){let c=e;for(const u of o){if(!c||!(u in c)){c={};break}c=c[u]}const l=this.expressionMap.aliasNamePrefixingEnabled?`${i.name}.${a.propertyPath}`:a.propertyPath,d=a.getEntityValue(c,!0);yield[l,d]}}}else for(const n of Object.keys(e)){const r=e[n];yield[this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${n}`:n,r]}}getWherePredicateCondition(e,n){if(fe.isFindOperator(n)){let r=[];if(n.useParameter)if(n.objectLiteralParameters)this.setParameters(n.objectLiteralParameters);else if(n.multipleParameters)for(const i of n.value)r.push(this.createParameter(i));else r.push(this.createParameter(n.value));if(n.type==="raw")return n.getSql?n.getSql(e):{operator:"equal",parameters:[e,n.value]};if(n.type==="not")return n.child?{operator:n.type,condition:this.getWherePredicateCondition(e,n.child)}:{operator:"notEqual",parameters:[e,...r]};if(n.type==="and"){const i=n.value;return{operator:n.type,parameters:i.map(o=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,o)))}}else if(n.type==="or"){const i=n.value;return{operator:n.type,parameters:i.map(o=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,o)))}}else return{operator:n.type,parameters:[e,...r]}}else return{operator:"equal",parameters:[e,this.createParameter(n)]}}getWhereCondition(e){if(typeof e=="string")return e;if(fe.isBrackets(e)){const i=this.createQueryBuilder();return i.parentQueryBuilder=this,i.expressionMap.mainAlias=this.expressionMap.mainAlias,i.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,i.expressionMap.parameters=this.expressionMap.parameters,i.expressionMap.nativeParameters=this.expressionMap.nativeParameters,i.expressionMap.wheres=[],e.whereFactory(i),{operator:fe.isNotBrackets(e)?"not":"brackets",condition:i.expressionMap.wheres}}if(typeof e=="function")return e(this);const n=Array.isArray(e)?e:[e],r=[];for(const i of n){const o=[];for(const[s,a]of this.getPredicates(i))o.push({type:"and",condition:this.getWherePredicateCondition(s,a)});r.push({type:"or",condition:o})}return r.length===1?r[0].condition:r}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}ve.queryBuilderRegistry={};class Fw{static from(e){const n=new this;return n.raw=e.records,n.affected=e.affected,n}}class zw extends ve{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createDeleteExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let i=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),i=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const o=await r.query(e,n,!0),s=Fw.from(o);return this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),i&&await r.commitTransaction(),s}catch(o){if(i)try{await r.rollbackTransaction()}catch{}throw o}finally{r!==this.queryRunner&&await r.release()}}from(e,n){e=fe.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new Cr;return this.expressionMap.returning=e,this}createDeleteExpression(){const e=this.getTableName(this.getMainTableName()),n=this.createWhereExpression(),r=this.createReturningExpression("delete");return r===""?`DELETE FROM ${e}${n}`:this.connection.driver.options.type==="mssql"?`DELETE FROM ${e} OUTPUT ${r}${n}`:`DELETE FROM ${e}${n} RETURNING ${r}`}}let Sr;const Vw=new Uint8Array(16);function qw(){if(!Sr&&(Sr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Sr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sr(Vw)}const Pe=[];for(let t=0;t<256;++t)Pe.push((t+256).toString(16).slice(1));function Ww(t,e=0){return Pe[t[e+0]]+Pe[t[e+1]]+Pe[t[e+2]]+Pe[t[e+3]]+"-"+Pe[t[e+4]]+Pe[t[e+5]]+"-"+Pe[t[e+6]]+Pe[t[e+7]]+"-"+Pe[t[e+8]]+Pe[t[e+9]]+"-"+Pe[t[e+10]]+Pe[t[e+11]]+Pe[t[e+12]]+Pe[t[e+13]]+Pe[t[e+14]]+Pe[t[e+15]]}const Hw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),gf={randomUUID:Hw};function Uw(t,e,n){if(gf.randomUUID&&!e&&!t)return gf.randomUUID();t=t||{};const r=t.random||(t.rng||qw)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ww(r)}class vf{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}class xf{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(e){const n=new this;return n.raw=e.raw,n}}class _a{constructor(e,n){this.queryRunner=e,this.expressionMap=n}async update(e,n){const r=this.expressionMap.mainAlias.metadata;await Promise.all(n.map(async(i,o)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((c,l,d)=>(c[this.expressionMap.extraReturningColumns[d].databaseName]=l[0],c),{}));const s=Array.isArray(e.raw)?e.raw[o]:e.raw,a=this.queryRunner.connection.driver.createGeneratedMap(r,s);a&&(this.queryRunner.manager.merge(r.target,i,a),e.generatedMaps.push(a))}else{const s=this.expressionMap.extraReturningColumns;if(s.length>0){const a=this.expressionMap.mainAlias.metadata.getEntityIdMap(i);if(!a)throw new G("Cannot update entity because entity id is not set in the entity.");const c=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(l=>r.targetName+"."+l.propertyPath)).addSelect(s.map(l=>r.targetName+"."+l.propertyPath)).from(r.target,r.targetName).where(a).withDeleted().setOption("create-pojo").getOne();c&&(this.queryRunner.manager.merge(r.target,i,c),e.generatedMaps.push(c))}}}))}async insert(e,n){const r=this.expressionMap.mainAlias.metadata;let i=r.getInsertionReturningColumns();const o=this.queryRunner.connection.driver.isReturningSqlSupported("insert");i=i.filter(a=>a.isGenerated?o===!0:!0);const s=n.map((a,c)=>{this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((u,h,p)=>(u[this.expressionMap.extraReturningColumns[p].databaseName]=h[0],u),{}));const l=Array.isArray(e.raw)?e.raw[c]:e.raw,d=this.queryRunner.connection.driver.createGeneratedMap(r,l,c,n.length)||{};return c in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(r.target,d,this.expressionMap.locallyGenerated[c]),this.queryRunner.manager.merge(r.target,a,d),d});if(i.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const a=n.map(l=>{const d=r.getEntityIdMap(l);if(!d)throw new G("Cannot update entity because entity id is not set in the entity.");return d}),c=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(l=>r.targetName+"."+l.propertyPath)).addSelect(i.map(l=>r.targetName+"."+l.propertyPath)).from(r.target,r.targetName).where(a).setOption("create-pojo").getMany();n.forEach((l,d)=>{this.queryRunner.manager.merge(r.target,s[d],c[d]),this.queryRunner.manager.merge(r.target,l,c[d])})}n.forEach((a,c)=>{const l=r.getEntityIdMap(a);e.identifiers.push(l),e.generatedMaps.push(s[c])})}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion)}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion||e.isDeleteDate)}}class Qw extends ve{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createInsertExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.getValueSets();if(e.length===0)return new xf;const n=this.obtainQueryRunner();let r=!1;try{if(this.expressionMap.useTransaction===!0&&n.isTransactionActive===!1&&(await n.startTransaction(),r=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const p=new vf;e.forEach(m=>{n.broadcaster.broadcastBeforeInsertEvent(p,this.expressionMap.mainAlias.metadata,m)}),await p.wait()}let i=null,o=null;const s=new _a(n,this.expressionMap),a=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const p of this.expressionMap.returning)a.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(p));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver.options.type==="oracle"||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),a.push(...this.expressionMap.extraReturningColumns.filter(p=>!a.includes(p)))),a.length>0&&this.connection.driver.options.type==="mssql"&&(i=this.connection.driver.buildTableVariableDeclaration("@OutputTable",a),o="SELECT * FROM @OutputTable");const[c,l]=this.getQueryAndParameters(),d=[i,c,o].filter(p=>p!=null).join(`;

`),u=await n.query(d,l,!0),h=xf.from(u);if(this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&await s.insert(h,e),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const p=new vf;e.forEach(m=>{n.broadcaster.broadcastAfterInsertEvent(p,this.expressionMap.mainAlias.metadata,m)}),await p.wait()}return r&&await n.commitTransaction(),h}catch(i){if(r)try{await n.rollbackTransaction()}catch{}throw i}finally{n!==this.queryRunner&&await n.release()}}into(e,n){e=fe.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e);return this.expressionMap.setMainAlias(r),this.expressionMap.insertColumns=n||[],this}values(e){return this.expressionMap.valuesSet=e,this}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new Cr;return this.expressionMap.returning=e,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}onConflict(e){return this.expressionMap.onConflict=e,this}orIgnore(e=!0){return this.expressionMap.onIgnore=!!e,this}orUpdate(e,n,r){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:n,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,indexPredicate:r==null?void 0:r.indexPredicate,upsertType:r==null?void 0:r.upsertType},this):(this.expressionMap.onUpdate={conflict:e==null?void 0:e.conflict_target,columns:e==null?void 0:e.columns,overwrite:e==null?void 0:e.overwrite,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,upsertType:r==null?void 0:r.upsertType},this)}createInsertExpression(){var s,a;const e=this.getTableName(this.getMainTableName()),n=this.createValuesExpression(),r=this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),i=this.createColumnNamesExpression();let o="INSERT ";if(((s=this.expressionMap.onUpdate)==null?void 0:s.upsertType)==="primary-key"&&(o="UPSERT "),(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(o+=`${this.expressionMap.onIgnore?" IGNORE ":""}`),o+=`INTO ${e}`,this.alias!==this.getMainTableName()&&Q.isPostgresFamily(this.connection.driver)&&(o+=` AS "${this.alias}"`),i?o+=`(${i})`:!n&&(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(o+="()"),r&&this.connection.driver.options.type==="mssql"&&(o+=` OUTPUT ${r}`),n?(this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="sap")&&this.getValueSets().length>1?o+=` ${n}`:o+=` VALUES ${n}`:Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"?o+=" VALUES ()":o+=" DEFAULT VALUES",((a=this.expressionMap.onUpdate)==null?void 0:a.upsertType)!=="primary-key"){if(this.connection.driver.supportedUpsertTypes.includes("on-conflict-do-update")){if(this.expressionMap.onIgnore)o+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)o+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:c,columns:l,conflict:d,skipUpdateIfNoValuesChanged:u,indexPredicate:h}=this.expressionMap.onUpdate;let p="ON CONFLICT";if(Array.isArray(d)){if(p+=` ( ${d.map(f=>this.escape(f)).join(", ")} )`,h&&!Q.isPostgresFamily(this.connection.driver))throw new G("indexPredicate option is not supported by the current database driver");h&&Q.isPostgresFamily(this.connection.driver)&&(p+=` WHERE ( ${h} )`)}else d&&(p+=` ON CONSTRAINT ${this.escape(d)}`);const m=[];Array.isArray(c)?m.push(...c.map(f=>`${this.escape(f)} = EXCLUDED.${this.escape(f)}`)):l&&m.push(...l.map(f=>`${this.escape(f)} = :${f}`)),m.length>0&&(o+=` ${p} DO UPDATE SET `,m.push(...this.expressionMap.mainAlias.metadata.columns.filter(f=>f.isUpdateDate&&!(c!=null&&c.includes(f.databaseName))&&!(this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")).map(f=>`${this.escape(f.databaseName)} = DEFAULT`)),o+=m.join(", "),o+=" "),Array.isArray(c)&&u&&Q.isPostgresFamily(this.connection.driver)&&(o+=" WHERE (",o+=c.map(f=>`${e}.${this.escape(f)} IS DISTINCT FROM EXCLUDED.${this.escape(f)}`).join(" OR "),o+=") ")}}else if(this.connection.driver.supportedUpsertTypes.includes("on-duplicate-key-update")){if(this.expressionMap.onUpdate){const{overwrite:c,columns:l}=this.expressionMap.onUpdate;Array.isArray(c)?(o+=" ON DUPLICATE KEY UPDATE ",o+=c.map(d=>`${this.escape(d)} = VALUES(${this.escape(d)})`).join(", "),o+=" "):Array.isArray(l)&&(o+=" ON DUPLICATE KEY UPDATE ",o+=l.map(d=>`${this.escape(d)} = :${d}`).join(", "),o+=" ")}}else if(this.expressionMap.onUpdate)throw new G("onUpdate is not supported by the current database driver")}return r&&(Q.isPostgresFamily(this.connection.driver)||this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="cockroachdb"||Q.isMySQLFamily(this.connection.driver))&&(o+=` RETURNING ${r}`),this.connection.driver.options.type==="mssql"&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter(c=>this.expressionMap.insertColumns.length>0?this.expressionMap.insertColumns.indexOf(c.propertyPath)!==-1:c.isInsert).some(c=>this.isOverridingAutoIncrementBehavior(c))&&(o=`SET IDENTITY_INSERT ${e} ON; ${o}; SET IDENTITY_INSERT ${e} OFF`),o}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(e=>this.expressionMap.insertColumns.length?this.expressionMap.insertColumns.indexOf(e.propertyPath)!==-1:!(!e.isInsert||e.isGenerated&&e.generationStrategy==="increment"&&this.connection.driver.options.type!=="spanner"&&this.connection.driver.options.type!=="oracle"&&!Q.isSQLiteFamily(this.connection.driver)&&!Q.isMySQLFamily(this.connection.driver)&&this.connection.driver.options.type!=="aurora-mysql"&&!(this.connection.driver.options.type==="mssql"&&this.isOverridingAutoIncrementBehavior(e)))):[]}createColumnNamesExpression(){const e=this.getInsertedColumns();if(e.length>0)return e.map(n=>this.escape(n.databaseName)).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const n=this.getValueSets();if(n.length===1)return Object.keys(n[0]).map(r=>this.escape(r)).join(", ")}return this.expressionMap.insertColumns.map(n=>this.escape(n)).join(", ")}createValuesExpression(){const e=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){let r="";return e.forEach((i,o)=>{n.forEach((s,a)=>{a===0&&(this.connection.driver.options.type==="oracle"&&e.length>1||this.connection.driver.options.type==="sap"&&e.length>1?r+=" SELECT ":r+="(");let c=s.getEntityValue(i);if(typeof c!="function"&&(c=this.connection.driver.preparePersistentValue(c,s)),s.isVersion&&c===void 0)r+="1";else if(s.isDiscriminator)r+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(s.isGenerated&&s.generationStrategy==="uuid"&&!this.connection.driver.isUUIDGenerationSupported()&&c===void 0)c=Uw(),r+=this.createParameter(c),o in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[o]={}),s.setEntityValue(this.expressionMap.locallyGenerated[o],c);else if(c===void 0)this.connection.driver.options.type==="oracle"&&e.length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?s.default!==void 0&&s.default!==null?r+=this.connection.driver.normalizeDefault(s):r+="NULL":r+="DEFAULT";else if(c===null&&this.connection.driver.options.type==="spanner")r+="NULL";else if(typeof c=="function")r+=c();else{this.connection.driver.options.type==="mssql"&&(c=this.connection.driver.parametrizeValue(s,c));const l=this.createParameter(c);if((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1){const d=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";s.srid!=null?r+=`${d}(${l}, ${s.srid})`:r+=`${d}(${l})`}else Q.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1?s.srid!=null?r+=`ST_SetSRID(ST_GeomFromGeoJSON(${l}), ${s.srid})::${s.type}`:r+=`ST_GeomFromGeoJSON(${l})::${s.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1?r+=s.type+"::STGeomFromText("+l+", "+(s.srid||"0")+")":r+=l}a===n.length-1?o===e.length-1?this.connection.driver.options.type==="oracle"&&e.length>1?r+=" FROM DUAL ":this.connection.driver.options.type==="sap"&&e.length>1?r+=" FROM dummy ":r+=")":this.connection.driver.options.type==="oracle"&&e.length>1?r+=" FROM DUAL UNION ALL ":this.connection.driver.options.type==="sap"&&e.length>1?r+=" FROM dummy UNION ALL ":r+="), ":r+=", "})}),r==="()"?"":r}else{let r="";return e.forEach((i,o)=>{Object.keys(i).forEach((s,a)=>{a===0&&(r+="(");const c=i[s];typeof c=="function"?r+=c():c===void 0?this.connection.driver.options.type==="oracle"&&e.length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?r+="NULL":r+="DEFAULT":c===null&&this.connection.driver.options.type==="spanner"||(r+=this.createParameter(c)),a===Object.keys(i).length-1?o===e.length-1?r+=")":r+="), ":r+=", "})}),r==="()"?"":r}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(Me.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new _w}isOverridingAutoIncrementBehavior(e){return e.isPrimary&&e.isGenerated&&e.generationStrategy==="increment"&&this.getValueSets().some(n=>e.getEntityValue(n)!==void 0&&e.getEntityValue(n)!==null)}}class bf{constructor(e,n){this.queryBuilder=e,this.expressionMap=n}async update(e){const n=this.expressionMap.relationMetadata;if(n.isManyToOne||n.isOneToOneOwner){const r=n.joinColumns.reduce((i,o)=>{const s=Me.isObject(e)?o.referencedColumn.getEntityValue(e):e;return o.setEntityValue(i,s),i},{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(n.entityMetadata.target).set(r).whereInIds(this.expressionMap.of).execute()}else if((n.isOneToOneNotOwner||n.isOneToMany)&&e===null){const r={};n.inverseRelation.joinColumns.forEach(c=>{r[c.propertyName]=null});const i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o={},s=[];i.forEach((c,l)=>{n.inverseRelation.joinColumns.map((d,u)=>{const h="joinColumn_"+l+"_"+u;o[h]=Me.isObject(c)?d.referencedColumn.getEntityValue(c):c,s.push(`${d.propertyPath} = :${h}`)})});const a=s.map(c=>"("+c+")").join(" OR ");if(!a)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(r).where(a).setParameters(o).execute()}else if(n.isOneToOneNotOwner||n.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new G("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const r=this.expressionMap.of,i=n.inverseRelation.joinColumns.reduce((o,s)=>{const a=Me.isObject(r)?s.referencedColumn.getEntityValue(r):r;return s.setEntityValue(o,a),o},{});if(!e||Array.isArray(e)&&!e.length)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(i).whereInIds(e).execute()}else{const r=n.junctionEntityMetadata,i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(e)?e:[e],s=n.isManyToManyOwner?i:o,a=n.isManyToManyOwner?o:i,c=[];if(s.forEach(l=>{a.forEach(d=>{const u={};r.ownerColumns.forEach(h=>{u[h.databaseName]=Me.isObject(l)?h.referencedColumn.getEntityValue(l):l}),r.inverseColumns.forEach(h=>{u[h.databaseName]=Me.isObject(d)?h.referencedColumn.getEntityValue(d):d}),c.push(u)})}),!c.length)return;this.queryBuilder.connection.driver.options.type==="oracle"||this.queryBuilder.connection.driver.options.type==="sap"?await Promise.all(c.map(l=>this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(l).execute())):await this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(c).execute()}}}class Yw{constructor(e,n){this.queryBuilder=e,this.expressionMap=n}async remove(e){const n=this.expressionMap.relationMetadata;if(n.isOneToMany){const r=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i=Array.isArray(e)?e:[e],o={};n.inverseRelation.joinColumns.forEach(l=>{o[l.propertyName]=null});const s={},a=[];r.forEach((l,d)=>{a.push(...i.map((u,h)=>[...n.inverseRelation.joinColumns.map((p,m)=>{const f="joinColumn_"+d+"_"+h+"_"+m;return s[f]=Me.isObject(l)?p.referencedColumn.getEntityValue(l):l,`${p.propertyPath} = :${f}`}),...n.inverseRelation.entityMetadata.primaryColumns.map((p,m)=>{const f="primaryColumn_"+h+"_"+h+"_"+m;return s[f]=Me.isObject(u)?p.getEntityValue(u):u,`${p.propertyPath} = :${f}`})].join(" AND ")))});const c=a.map(l=>"("+l+")").join(" OR ");if(!c)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(o).where(c).setParameters(s).execute()}else{const r=n.junctionEntityMetadata,i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(e)?e:[e],s=n.isManyToManyOwner?i:o,a=n.isManyToManyOwner?o:i,c={},l=[];s.forEach((u,h)=>{l.push(...a.map((p,m)=>[...r.ownerColumns.map((f,g)=>{const y="firstValue_"+h+"_"+m+"_"+g;return c[y]=Me.isObject(u)?f.referencedColumn.getEntityValue(u):u,`${f.databaseName} = :${y}`}),...r.inverseColumns.map((f,g)=>{const y="secondValue_"+h+"_"+m+"_"+g;return c[y]=Me.isObject(p)?f.referencedColumn.getEntityValue(p):p,`${f.databaseName} = :${y}`})].join(" AND ")))});const d=l.map(u=>"("+u+")").join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(r.tableName).where(d).setParameters(c).execute()}}}class Zw extends ve{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(e){return this.expressionMap.of=e,this}async set(e){const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new G("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToMany||n.isOneToMany)throw new G(`Set operation is only supported for many-to-one and one-to-one relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .add() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!Me.isObject(e)||Object.keys(e).length<n.joinColumns.length))throw new G('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new bf(this,this.expressionMap).update(e)}async add(e){if(Array.isArray(e)&&e.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new G("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new G(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!Me.isObject(e)||Object.keys(e).length<n.joinColumns.length))throw new G('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new bf(this,this.expressionMap).update(e)}async remove(e){if(Array.isArray(e)&&e.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new G("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new G(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set(null) method instead.`);return new Yw(this,this.expressionMap).remove(e)}async addAndRemove(e,n){await this.remove(n),await this.add(e)}async loadOne(){return this.loadMany().then(e=>e[0])}async loadMany(){let e=this.expressionMap.of;if(!Me.isObject(e)){const n=this.expressionMap.mainAlias.metadata;if(n.hasMultiplePrimaryKeys)throw new G("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=n.primaryColumns[0].createValueMap(e)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)}}class Ae{static chunk(e,n){return Array.from(Array(Math.ceil(e.length/n)),(r,i)=>e.slice(i*n,i*n+n))}static splitClassesAndStrings(e){return[e.filter(n=>typeof n!="string"),e.filter(n=>typeof n=="string")]}static groupBy(e,n){return e.reduce((r,i)=>{const o=n(i);let s=r.find(a=>a.id===o);return s||(s={id:o,items:[]},r.push(s)),s.items.push(i),r},[])}static uniq(e,n){return e.reduce((r,i)=>{let o=!1;if(typeof n=="function"){const s=n(i);o=!!r.find(a=>n(a)===s)}else typeof n=="string"?o=!!r.find(s=>s[n]===i[n]):o=r.indexOf(i)!==-1;return o||r.push(i),r},[])}static isPlainObject(e){return e==null?!1:!e.constructor||e.constructor===Object}static mergeArrayKey(e,n,r,i){if(i.has(r)){e[n]=i.get(r);return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){e[n]=r;return}e[n]||(e[n]=Array.isArray(r)?[]:{}),i.set(r,e[n]),this.merge(e[n],r,i),i.delete(r)}}static mergeObjectKey(e,n,r,i){if(i.has(r)){Object.assign(e,{[n]:i.get(r)});return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){Object.assign(e,{[n]:r});return}e[n]||Object.assign(e,{[n]:Array.isArray(r)?[]:{}}),i.set(r,e[n]),this.merge(e[n],r,i),i.delete(r)}}static merge(e,n,r=new Map){if(this.isPlainObject(e)&&this.isPlainObject(n))for(const i of Object.keys(n))i!=="__proto__"&&this.mergeObjectKey(e,i,n[i],r);if(Array.isArray(e)&&Array.isArray(n))for(let i=0;i<n.length;i++)this.mergeArrayKey(e,i,n[i],r)}static mergeDeep(e,...n){if(!n.length)return e;for(const r of n)Ae.merge(e,r);return e}static deepCompare(...e){let n,r,i,o;if(arguments.length<1)return!0;for(n=1,r=arguments.length;n<r;n++)if(i=[],o=[],!this.compare2Objects(i,o,arguments[0],arguments[n]))return!1;return!0}static deepValue(e,n){const r=n.split(".");for(let i=0,o=r.length;i<o;i++)e=e[r[i]];return e}static replaceEmptyObjectsWithBooleans(e){for(let n in e)e[n]&&typeof e[n]=="object"&&(Object.keys(e[n]).length===0?e[n]=!0:this.replaceEmptyObjectsWithBooleans(e[n]))}static propertyPathsToTruthyObject(e){let n={};for(let r of e){const i=r.split(".");if(!i.length)continue;(!n[i[0]]||n[i[0]]===!0)&&(n[i[0]]={});let o=n[i[0]];for(let[s,a]of i.entries())s!==0&&(o[a]?o=o[a]:s===i.length-1?(o[a]={},o=null):(o[a]={},o=o[a]))}return this.replaceEmptyObjectsWithBooleans(n),n}static compareIds(e,n){return e==null||n===void 0||n===null?!1:(typeof e.id=="string"&&typeof n.id=="string"||typeof e.id=="number"&&typeof n.id=="number")&&Object.keys(e).length===1&&Object.keys(n).length===1?e.id===n.id:Ae.deepCompare(e,n)}static toBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e==="true"||e==="1":typeof e=="number"?e>0:!1}static zipObject(e,n){return e.reduce((r,i,o)=>(r[i]=n[o],r),{})}static isArraysEqual(e,n){return e.length!==n.length?!1:e.every(r=>n.indexOf(r)!==-1)}static areMutuallyExclusive(...e){return!e.some(n=>{const r=e.filter(i=>i!==n);return n.some(i=>r.some(o=>o.includes(i)))})}static parseSqlCheckExpression(e,n){const r=e.match(new RegExp(`"${n}" varchar CHECK\\s*\\(\\s*"${n}"\\s+IN\\s*`));if(r&&r.index){const i=e.substring(r.index+r[0].length);let o="",s="";const a=[];for(let c=0;c<i.length;c++){const l=i[c];switch(l){case",":o==""?(a.push(s),s=""):s+=l;break;case"'":o==l?i[c+1]===l?(s+=l,c+=1):o="":o=l;break;case")":if(o=="")return a.push(s),a;s+=l;break;default:o!=""&&(s+=l)}}}}static compare2Objects(e,n,r,i){let o;if(Number.isNaN(r)&&Number.isNaN(i)||r===i)return!0;if(r===null||i===null||r===void 0||i===void 0)return!1;if((typeof r.equals=="function"||typeof r.equals=="function")&&r.equals(i))return!0;if(typeof r=="function"&&typeof i=="function"||r instanceof Date&&i instanceof Date||r instanceof RegExp&&i instanceof RegExp||typeof r=="string"&&typeof i=="string"||typeof r=="number"&&typeof i=="number")return r.toString()===i.toString();if(!(typeof r=="object"&&typeof i=="object")||Object.prototype.isPrototypeOf.call(r,i)||Object.prototype.isPrototypeOf.call(i,r)||r.constructor!==i.constructor||r.prototype!==i.prototype||e.indexOf(r)>-1||n.indexOf(i)>-1)return!1;for(o in i)if(i.hasOwnProperty(o)!==r.hasOwnProperty(o)||typeof i[o]!=typeof r[o])return!1;for(o in r){if(i.hasOwnProperty(o)!==r.hasOwnProperty(o)||typeof i[o]!=typeof r[o])return!1;switch(typeof r[o]){case"object":case"function":if(e.push(r),n.push(i),!this.compare2Objects(e,n,r[o],i[o]))return!1;e.pop(),n.pop();break;default:if(r[o]!==i[o])return!1;break}}return!0}}class Gw{constructor(e,n,r,i,o){this.expressionMap=e,this.driver=n,this.rawRelationIdResults=r,this.rawRelationCountResults=i,this.queryRunner=o}transform(e,n){const r=this.group(e,n),i=[];return r.forEach(o=>{const s=this.transformRawResultsGroup(o,n);s!==void 0&&!Object.values(s).every(a=>a===null)&&i.push(s)}),i}group(e,n){const r=new Map,i=[];return n.metadata.tableType==="view"?i.push(...n.metadata.columns.map(o=>Q.buildAlias(this.driver,void 0,n.name,o.databaseName))):i.push(...n.metadata.primaryColumns.map(o=>Q.buildAlias(this.driver,void 0,n.name,o.databaseName))),e.forEach(o=>{const s=i.map(c=>{const l=o[c];return Jf.isBuffer(l)?l.toString("hex"):Me.isObject(l)?JSON.stringify(l):l}).join("_"),a=r.get(s);a?a.push(o):r.set(s,[o])}),r}transformRawResultsGroup(e,n){let r=n.metadata;if(r.discriminatorColumn){const l=e.map(u=>u[Q.buildAlias(this.driver,void 0,n.name,n.metadata.discriminatorColumn.databaseName)]),d=r.childEntityMetadatas.find(u=>typeof l.find(h=>h===u.discriminatorValue)<"u");d&&(r=d)}let i=r.create(this.queryRunner,{fromDeserializer:!0,pojo:this.expressionMap.options.indexOf("create-pojo")!==-1});const o=this.transformColumns(e,n,i,r),s=this.transformJoins(e,i,n,r),a=this.transformRelationIds(e,n,i,r),c=this.transformRelationCounts(e,n,i);if(o||r.primaryColumns.filter(l=>l.isVirtual===!1).length===0&&(s||a||c))return i}transformColumns(e,n,r,i){let o=!1;return i.columns.forEach(s=>{if(i.childEntityMetadatas.length>0&&i.childEntityMetadatas.findIndex(c=>c.target===s.target)!==-1)return;const a=e[0][Q.buildAlias(this.driver,void 0,n.name,s.databaseName)];a===void 0||s.isVirtual||this.expressionMap.selects.find(c=>c.selection===n.name||c.selection===n.name+"."+s.propertyPath)&&(s.setEntityValue(r,this.driver.prepareHydratedValue(a,s)),a!==null&&(o=!0))}),o}transformJoins(e,n,r,i){let o=!1;return this.expressionMap.joinAttributes.forEach(s=>{if(!s.metadata||!s.isSelected||s.relation&&!i.relations.find(c=>c===s.relation))return;if(s.mapToProperty){if(s.mapToPropertyParentAlias!==r.name)return}else if(!s.relation||s.parentAlias!==r.name||s.relationPropertyPath!==s.relation.propertyPath)return;let a=this.transform(e,s.alias);a=s.isMany?a:a[0],a=!s.isMany&&a===void 0?null:a,a!==void 0&&(s.mapToPropertyPropertyName?n[s.mapToPropertyPropertyName]=a:s.relation.setEntityValue(n,a),o=!0)}),o}transformRelationIds(e,n,r,i){let o=!1;return this.rawRelationIdResults.forEach((s,a)=>{if(s.relationIdAttribute.parentAlias!==n.name)return;const c=s.relationIdAttribute.relation,l=this.createValueMapFromJoinColumns(c,s.relationIdAttribute.parentAlias,e);if(l==null)return;this.prepareDataForTransformRelationIds();const d=this.hashEntityIds(c,l),u=this.relationIdMaps[a][d]||[],h=s.relationIdAttribute.mapToPropertyPropertyPath.split("."),p=(m,f,g)=>{const y=m.shift();if(y&&m.length===0)return f[y]=g,f;if(y&&m.length>0)p(m,f[y],g);else return f};c.isOneToOne||c.isManyToOne?u[0]!==void 0&&(p(h,r,u[0]),o=!0):(p(h,r,u),o=o||u.length>0)}),o}transformRelationCounts(e,n,r){let i=!1;return this.rawRelationCountResults.filter(o=>o.relationCountAttribute.parentAlias===n.name).forEach(o=>{const s=o.relationCountAttribute.relation;let a;s.isOneToMany?a=s.inverseRelation.joinColumns[0].referencedColumn.databaseName:a=s.isOwning?s.joinColumns[0].referencedColumn.databaseName:s.inverseRelation.joinColumns[0].referencedColumn.databaseName;const c=e[0][Q.buildAlias(this.driver,void 0,n.name,a)];c!=null&&(r[o.relationCountAttribute.mapToPropertyPropertyName]=0,o.results.filter(l=>l.parentId===c).forEach(l=>{r[o.relationCountAttribute.mapToPropertyPropertyName]=parseInt(l.cnt),i=!0}))}),i}createValueMapFromJoinColumns(e,n,r){let i;return e.isManyToOne||e.isOneToOneOwner?i=e.entityMetadata.primaryColumns.map(o=>o):e.isOneToMany||e.isOneToOneNotOwner?i=e.inverseRelation.joinColumns.map(o=>o):e.isOwning?i=e.joinColumns.map(o=>o):i=e.inverseRelation.inverseJoinColumns.map(o=>o),i.reduce((o,s)=>(r.forEach(a=>{e.isManyToOne||e.isOneToOneOwner?o[s.databaseName]=this.driver.prepareHydratedValue(a[Q.buildAlias(this.driver,void 0,n,s.databaseName)],s):o[s.databaseName]=this.driver.prepareHydratedValue(a[Q.buildAlias(this.driver,void 0,n,s.referencedColumn.databaseName)],s.referencedColumn)}),o),{})}extractEntityPrimaryIds(e,n){let r;return e.isManyToOne||e.isOneToOneOwner?r=e.entityMetadata.primaryColumns.map(i=>i):e.isOneToMany||e.isOneToOneNotOwner?r=e.inverseRelation.joinColumns.map(i=>i):e.isOwning?r=e.joinColumns.map(i=>i):r=e.inverseRelation.inverseJoinColumns.map(i=>i),r.reduce((i,o)=>(i[o.databaseName]=n[o.databaseName],i),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map(e=>{const n=e.relationIdAttribute.relation;let r;return n.isManyToOne||n.isOneToOneOwner?r=n.joinColumns:n.isOneToMany||n.isOneToOneNotOwner?r=n.inverseEntityMetadata.primaryColumns:n.isOwning?r=n.inverseJoinColumns:r=n.inverseRelation.joinColumns,e.results.reduce((i,o)=>{let s=r.reduce((a,c)=>{let l=o[c.databaseName];return n.isOneToMany||n.isOneToOneNotOwner?(c.isVirtual&&c.referencedColumn&&c.referencedColumn.propertyName!==c.propertyName&&(l=c.referencedColumn.createValueMap(l)),Ae.mergeDeep(a,c.createValueMap(l))):(!c.isPrimary&&c.referencedColumn.referencedColumn&&(l=c.referencedColumn.referencedColumn.createValueMap(l)),Ae.mergeDeep(a,c.referencedColumn.createValueMap(l)))},{});if(r.length===1&&!e.relationIdAttribute.disableMixedMap&&(n.isOneToMany||n.isOneToOneNotOwner?s=r[0].getEntityValue(s):s=r[0].referencedColumn.getEntityValue(s)),s!==void 0){const a=this.hashEntityIds(n,o);i[a]?i[a].push(s):i[a]=[s]}return i},{})}))}hashEntityIds(e,n){const r=this.extractEntityPrimaryIds(e,n);return JSON.stringify(r)}}let Xw=class{constructor(t,e,n){this.connection=t,this.queryRunner=e,this.relationIdAttributes=n}async load(t){const e=this.relationIdAttributes.map(async n=>{if(n.relation.isManyToOne||n.relation.isOneToOneOwner){if(n.queryBuilderFactory)throw new G("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const r={},i=t.map(o=>{const s={},a=[];n.relation.joinColumns.forEach(l=>{s[l.databaseName]=this.connection.driver.prepareHydratedValue(o[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,l.databaseName)],l.referencedColumn);const d=`${l.databaseName}:${s[l.databaseName]}`;a.indexOf(d)===-1&&a.push(d)}),n.relation.entityMetadata.primaryColumns.forEach(l=>{s[l.databaseName]=this.connection.driver.prepareHydratedValue(o[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,l.databaseName)],l);const d=`${l.databaseName}:${s[l.databaseName]}`;a.indexOf(d)===-1&&a.push(d)}),a.sort();const c=a.join("::");return r[c]?null:(r[c]=!0,s)}).filter(o=>o);return{relationIdAttribute:n,results:i}}else if(n.relation.isOneToMany||n.relation.isOneToOneNotOwner){const r=n.relation,i=r.isOwning?r.joinColumns:r.inverseRelation.joinColumns,o=r.inverseEntityMetadata.target,s=r.inverseEntityMetadata.tableName,a=n.alias||s,c={},l={},d=t.map((p,m)=>{const f=[],g={},y=i.map(v=>{const b=v.databaseName+m,M=p[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,v.referencedColumn.databaseName)],C=`${a}:${v.propertyPath}:${M}`;return f.indexOf(C)!==-1?"":(f.push(C),g[b]=M,a+"."+v.propertyPath+" = :"+b)}).filter(v=>v).join(" AND ");f.sort();const x=f.join("::");return c[x]?"":(c[x]=!0,Object.assign(l,g),y)}).filter(p=>p).map(p=>"("+p+")").join(" OR ");if(!d)return{relationIdAttribute:n,results:[]};const u=this.connection.createQueryBuilder(this.queryRunner);Ae.uniq([...i,...r.inverseRelation.entityMetadata.primaryColumns],p=>p.propertyPath).forEach(p=>{u.addSelect(a+"."+p.propertyPath,p.databaseName)}),u.from(o,a).where("("+d+")").setParameters(l),n.queryBuilderFactory&&n.queryBuilderFactory(u);const h=await u.getRawMany();return h.forEach(p=>{i.forEach(m=>{p[m.databaseName]=this.connection.driver.prepareHydratedValue(p[m.databaseName],m.referencedColumn)}),r.inverseRelation.entityMetadata.primaryColumns.forEach(m=>{p[m.databaseName]=this.connection.driver.prepareHydratedValue(p[m.databaseName],m)})}),{relationIdAttribute:n,results:h}}else{const r=n.relation,i=r.isOwning?r.joinColumns:r.inverseRelation.inverseJoinColumns,o=r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns,s=n.junctionAlias,a=n.joinInverseSideMetadata.tableName,c=n.alias||a,l=r.isOwning?r.junctionEntityMetadata.tableName:r.inverseRelation.junctionEntityMetadata.tableName,d=t.map(x=>i.reduce((v,b)=>(v[b.propertyPath]=x[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,b.referencedColumn.databaseName)],v),{}));if(d.length===0)return{relationIdAttribute:n,results:[]};const u={},h={},p=d.map((x,v)=>{const b=[],M={},C=Object.keys(x).map(A=>{const R=A+v,B=x[A],$=`${s}:${A}:${B}`;return b.indexOf($)!==-1?"":(b.push($),M[R]=B,s+"."+A+" = :"+R)}).filter(A=>A).join(" AND ");b.sort();const E=b.join("::");return h[E]?"":(h[E]=!0,Object.assign(u,M),C)}).filter(x=>x),m=o.map(x=>s+"."+x.propertyPath+" = "+c+"."+x.referencedColumn.propertyPath).join(" AND "),f=p.map(x=>"("+x+" AND "+m+")").join(" OR "),g=this.connection.createQueryBuilder(this.queryRunner);o.forEach(x=>{g.addSelect(s+"."+x.propertyPath,x.databaseName).addOrderBy(s+"."+x.propertyPath)}),i.forEach(x=>{g.addSelect(s+"."+x.propertyPath,x.databaseName).addOrderBy(s+"."+x.propertyPath)}),g.from(a,c).innerJoin(l,s,f).setParameters(u),n.queryBuilderFactory&&n.queryBuilderFactory(g);const y=await g.getRawMany();return y.forEach(x=>{[...i,...o].forEach(v=>{x[v.databaseName]=this.connection.driver.prepareHydratedValue(x[v.databaseName],v.referencedColumn)})}),{relationIdAttribute:n,results:y}}});return Promise.all(e)}};class Kw{constructor(e,n){this.connection=e,this.queryRunner=n}load(e,n,r){const i=Array.isArray(n)?n:[n],o=Array.isArray(r)?r:r?[r]:void 0;return e.isManyToMany?this.loadForManyToMany(e,i,o):e.isManyToOne||e.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(e,i,o):this.loadForOneToManyAndOneToOneNotOwner(e,i,o)}async loadManyToManyRelationIdsAndGroup(e,n,r,i){const o=e.isManyToMany||e.isOneToMany,s=Array.isArray(n)?n:[n];if(!r&&(r=await this.connection.relationLoader.load(e,n,this.queryRunner,i),!r.length))return s.map(u=>({entity:u,related:o?[]:void 0}));const a=await this.load(e,n,r),c=Array.isArray(r)?r:[r];let l=[],d=[];return e.isManyToManyOwner?(l=e.junctionEntityMetadata.inverseColumns.map(u=>u.referencedColumn),d=e.junctionEntityMetadata.ownerColumns.map(u=>u.referencedColumn)):e.isManyToManyNotOwner?(l=e.junctionEntityMetadata.ownerColumns.map(u=>u.referencedColumn),d=e.junctionEntityMetadata.inverseColumns.map(u=>u.referencedColumn)):e.isManyToOne||e.isOneToOneOwner?(l=e.joinColumns.map(u=>u.referencedColumn),d=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(l=e.inverseRelation.entityMetadata.primaryColumns,d=e.inverseRelation.joinColumns.map(u=>u.referencedColumn)),s.map(u=>{const h={entity:u,related:o?[]:void 0},p=a.filter(m=>d.every(f=>f.compareEntityValue(u,m[f.entityMetadata.name+"_"+f.propertyAliasName])));return p.length&&c.forEach(m=>{p.forEach(f=>{l.every(g=>g.compareEntityValue(m,f[Q.buildAlias(this.connection.driver,void 0,g.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+g.propertyPath.replace(".","_"))]))&&(o?h.related.push(m):h.related=m)})}),h})}loadForManyToMany(e,n,r){const i=e.junctionEntityMetadata,o=i.name,s=e.isOwning?i.ownerColumns:i.inverseColumns,a=e.isOwning?i.inverseColumns:i.ownerColumns,c=this.connection.createQueryBuilder(this.queryRunner);s.forEach(h=>{const p=Q.buildAlias(this.connection.driver,void 0,h.referencedColumn.entityMetadata.name+"_"+h.referencedColumn.propertyPath.replace(".","_"));c.addSelect(o+"."+h.propertyPath,p)}),a.forEach(h=>{const p=Q.buildAlias(this.connection.driver,void 0,h.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+h.referencedColumn.propertyPath.replace(".","_"));c.addSelect(o+"."+h.propertyPath,p)});let l="";if(s.length===1){const h=n.map(p=>s[0].referencedColumn.getEntityValue(p));h.every(p=>typeof p=="number")?l=`${o}.${s[0].propertyPath} IN (${h.join(", ")})`:(c.setParameter("values1",h),l=o+"."+s[0].propertyPath+" IN (:...values1)")}else l="("+n.map((h,p)=>s.map(m=>{const f="entity1_"+p+"_"+m.propertyName;return c.setParameter(f,m.referencedColumn.getEntityValue(h)),o+"."+m.propertyPath+" = :"+f}).join(" AND ")).map(h=>"("+h+")").join(" OR ")+")";let d="";if(r)if(a.length===1){const h=r.map(p=>a[0].referencedColumn.getEntityValue(p));h.every(p=>typeof p=="number")?d=`${o}.${a[0].propertyPath} IN (${h.join(", ")})`:(c.setParameter("values2",h),d=o+"."+a[0].propertyPath+" IN (:...values2)")}else d="("+r.map((h,p)=>a.map(m=>{const f="entity2_"+p+"_"+m.propertyName;return c.setParameter(f,m.referencedColumn.getEntityValue(h)),o+"."+m.propertyPath+" = :"+f}).join(" AND ")).map(h=>"("+h+")").join(" OR ")+")";const u=[l,d].filter(h=>h.length>0).join(" AND ");return c.from(i.target,o).where(u).getRawMany()}loadForManyToOneAndOneToOneOwner(e,n,r){const i=e.entityMetadata.targetName,o=e.joinColumns.every(c=>!!e.entityMetadata.nonVirtualColumns.find(l=>l===c));if(r&&o){let c=[];if(n.forEach(l=>{let d={};e.entityMetadata.primaryColumns.forEach(u=>{const h=u.entityMetadata.name+"_"+u.propertyPath.replace(".","_");d[h]=u.getEntityValue(l)}),r.forEach(u=>{e.joinColumns.forEach(h=>{const p=h.getEntityValue(l),m=h.referencedColumn.getEntityValue(u);if(!(p===void 0||m===void 0)&&p===m){const f=h.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+h.referencedColumn.propertyPath.replace(".","_");d[f]=m}})}),Object.keys(d).length===e.entityMetadata.primaryColumns.length+e.joinColumns.length&&c.push(d)}),c.length===n.length)return Promise.resolve(c)}const s=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(c=>{const l=Q.buildAlias(this.connection.driver,void 0,c.entityMetadata.name+"_"+c.propertyPath.replace(".","_"));s.addSelect(i+"."+c.propertyPath,l)}),e.joinColumns.forEach(c=>{const l=Q.buildAlias(this.connection.driver,void 0,c.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+c.referencedColumn.propertyPath.replace(".","_"));s.addSelect(i+"."+c.propertyPath,l)});let a="";if(e.entityMetadata.primaryColumns.length===1){const c=n.map(l=>e.entityMetadata.primaryColumns[0].getEntityValue(l));c.every(l=>typeof l=="number")?a=`${i}.${e.entityMetadata.primaryColumns[0].propertyPath} IN (${c.join(", ")})`:(s.setParameter("values",c),a=i+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else a=n.map((c,l)=>e.entityMetadata.primaryColumns.map((d,u)=>{const h="entity"+l+"_"+u;return s.setParameter(h,d.getEntityValue(c)),i+"."+d.propertyPath+" = :"+h}).join(" AND ")).map(c=>"("+c+")").join(" OR ");return s.from(e.entityMetadata.target,i).where(a).getRawMany()}loadForOneToManyAndOneToOneNotOwner(e,n,r){if(e=e.inverseRelation,e.entityMetadata.primaryColumns.length===e.joinColumns.length&&e.entityMetadata.primaryColumns.every(a=>e.joinColumns.indexOf(a)!==-1))return Promise.resolve(n.map(a=>{const c={};return e.joinColumns.forEach(function(l){const d=l.referencedColumn.getEntityValue(a),u=l.referencedColumn.entityMetadata.name+"_"+l.referencedColumn.propertyPath.replace(".","_"),h=l.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+l.propertyPath.replace(".","_");c[u]=d,c[h]=d}),c}));const i=e.entityMetadata.targetName,o=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(a=>{const c=Q.buildAlias(this.connection.driver,void 0,a.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+a.propertyPath.replace(".","_"));o.addSelect(i+"."+a.propertyPath,c)}),e.joinColumns.forEach(a=>{const c=Q.buildAlias(this.connection.driver,void 0,a.referencedColumn.entityMetadata.name+"_"+a.referencedColumn.propertyPath.replace(".","_"));o.addSelect(i+"."+a.propertyPath,c)});let s="";if(e.joinColumns.length===1){const a=n.map(c=>e.joinColumns[0].referencedColumn.getEntityValue(c));a.every(c=>typeof c=="number")?s=`${i}.${e.joinColumns[0].propertyPath} IN (${a.join(", ")})`:(o.setParameter("values",a),s=i+"."+e.joinColumns[0].propertyPath+" IN (:...values)")}else s=n.map((a,c)=>e.joinColumns.map((l,d)=>{const u="entity"+c+"_"+d;return o.setParameter(u,l.referencedColumn.getEntityValue(a)),i+"."+l.propertyPath+" = :"+u}).join(" AND ")).map(a=>"("+a+")").join(" OR ");return o.from(e.entityMetadata.target,i).where(s).getRawMany()}}class Jw{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(e=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationIds.forEach(n=>{const r=this.metadataToAttribute(e.alias.name,n);this.expressionMap.relationIdAttributes.push(r)})})}metadataToAttribute(e,n){return new ba(this.expressionMap,{relationName:e+"."+n.relation.propertyName,mapToProperty:e+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class eM{constructor(e,n,r){this.connection=e,this.queryRunner=n,this.relationCountAttributes=r}async load(e){const n=(i,o,s)=>s.indexOf(i)===o,r=this.relationCountAttributes.map(async i=>{if(i.relation.isOneToMany){const o=i.relation,s=o.inverseRelation,a=s.joinColumns[0].referencedColumn.propertyName,c=o.inverseEntityMetadata.target,l=o.inverseEntityMetadata.tableName,d=i.alias||l,u=s.propertyName;let h=e.map(m=>m[i.parentAlias+"_"+a]).filter(m=>!!m);if(h=h.filter(n),h.length===0)return{relationCountAttribute:i,results:[]};const p=this.connection.createQueryBuilder(this.queryRunner);return p.select(d+"."+u,"parentId").addSelect("COUNT(*)","cnt").from(c,d).where(d+"."+u+" IN (:...ids)").addGroupBy(d+"."+u).setParameter("ids",h),i.queryBuilderFactory&&i.queryBuilderFactory(p),{relationCountAttribute:i,results:await p.getRawMany()}}else{let o,s,a,c;i.relation.isOwning?(o=i.relation.joinColumns[0].referencedColumn.databaseName,s=i.relation.inverseJoinColumns[0].referencedColumn.databaseName,a=i.relation.junctionEntityMetadata.columns[0],c=i.relation.junctionEntityMetadata.columns[1]):(o=i.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,s=i.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,a=i.relation.junctionEntityMetadata.columns[1],c=i.relation.junctionEntityMetadata.columns[0]);let l=e.map(g=>g[i.parentAlias+"_"+o]).filter(g=>!!g);if(l=l.filter(n),l.length===0)return{relationCountAttribute:i,results:[]};const d=i.junctionAlias,u=i.joinInverseSideMetadata.tableName,h=i.alias||u,p=i.relation.junctionEntityMetadata.tableName,m=d+"."+a.propertyName+" IN ("+l.map(g=>isNaN(g)?"'"+g+"'":g)+") AND "+d+"."+c.propertyName+" = "+h+"."+s,f=this.connection.createQueryBuilder(this.queryRunner);return f.select(d+"."+a.propertyName,"parentId").addSelect("COUNT("+f.escape(h)+"."+f.escape(s)+")","cnt").from(u,h).innerJoin(p,d,m).addGroupBy(d+"."+a.propertyName),i.queryBuilderFactory&&i.queryBuilderFactory(f),{relationCountAttribute:i,results:await f.getRawMany()}}});return Promise.all(r)}}class tM{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(e=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationCounts.forEach(n=>{const r=this.metadataToAttribute(e.alias.name,n);this.expressionMap.relationCountAttributes.push(r)})})}metadataToAttribute(e,n){return new wa(this.expressionMap,{relationName:e+"."+n.relation.propertyName,mapToProperty:e+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class Ca{static isFindOneOptions(e){const n=e;return n&&(Array.isArray(n.select)||Array.isArray(n.relations)||typeof n.select=="object"||typeof n.relations=="object"||typeof n.where=="object"||typeof n.join=="object"||typeof n.order=="object"||typeof n.cache=="object"||typeof n.cache=="boolean"||typeof n.cache=="number"||typeof n.comment=="string"||typeof n.lock=="object"||typeof n.loadRelationIds=="object"||typeof n.loadRelationIds=="boolean"||typeof n.loadEagerRelations=="boolean"||typeof n.withDeleted=="boolean"||typeof n.relationLoadStrategy=="string"||typeof n.transaction=="boolean")}static isFindManyOptions(e){const n=e;return n&&(this.isFindOneOptions(n)||typeof n.skip=="number"||typeof n.take=="number"||typeof n.skip=="string"||typeof n.take=="string")}static extractFindManyOptionsAlias(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias}static applyOptionsToTreeQueryBuilder(e,n){if(n!=null&&n.relations){const r=[...n.relations];if(Ca.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),r.length>0)throw new Cw(r)}return e}static applyRelationsRecursively(e,n,r,i,o){let s=[];if(o){const a=new RegExp("^"+o.replace(".","\\.")+"\\.");s=n.filter(c=>c.match(a)).map(c=>i.findRelationWithPropertyPath(c.replace(a,""))).filter(c=>c)}else s=n.map(a=>i.findRelationWithPropertyPath(a)).filter(a=>a);s.forEach(a=>{let c=Q.buildAlias(e.connection.driver,{joiner:"__"},r,a.propertyPath);const l=r+"."+a.propertyPath;e.expressionMap.relationLoadStrategy==="query"?e.concatRelationMetadata(a):e.leftJoinAndSelect(l,c),n.splice(n.indexOf(o?o+"."+a.propertyPath:a.propertyPath),1);let d,u;if(e.expressionMap.relationLoadStrategy==="query")d=a.inverseEntityMetadata,u=c;else{const h=e.expressionMap.joinAttributes.find(p=>p.entityOrProperty===l);d=h.metadata,u=h.alias.name}if(!u||!d)throw new Qe(a.propertyPath,i);if(this.applyRelationsRecursively(e,n,u,d,o?o+"."+a.propertyPath:a.propertyPath),e.expressionMap.relationLoadStrategy==="join"){const h=i.relations.find(p=>p.propertyName===a.propertyPath);h&&this.joinEagerRelations(e,c,h.inverseEntityMetadata)}})}static joinEagerRelations(e,n,r){r.eagerRelations.forEach(i=>{let o=Q.buildAlias(e.connection.driver,{joiner:"__"},n,i.propertyName),s=!0;for(const l of e.expressionMap.joinAttributes)if(!(l.condition!==void 0||l.mapToProperty!==void 0||l.isMappingMany!==void 0||l.direction!=="LEFT"||l.entityOrProperty!==`${n}.${i.propertyPath}`)){s=!1,o=l.alias.name;break}const a=!!e.expressionMap.joinAttributes.find(l=>l.alias.name===o);s&&!a&&e.leftJoin(n+"."+i.propertyPath,o);let c=!0;for(const l of e.expressionMap.selects)if(!(l.aliasName!==void 0||l.virtual!==void 0||l.selection!==o)){c=!1;break}c&&e.addSelect(o),this.joinEagerRelations(e,o,i.inverseEntityMetadata)})}}class Sa extends ve{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),this.replacePropertyNamesForTheWholeQuery(e)}setFindOptions(e){return this.findOptions=e,this.applyFindOptions(),this}subQuery(){const e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e}select(e,n){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map(r=>({selection:r}));else if(typeof e=="function"){const r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:n}]);return this}addSelect(e,n){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map(r=>({selection:r})));else if(typeof e=="function"){const r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else e&&this.expressionMap.selects.push({selection:e,aliasName:n});return this}maxExecutionTime(e){return this.expressionMap.maxExecutionTime=e,this}distinct(e=!0){return this.expressionMap.selectDistinct=e,this}distinctOn(e){return this.expressionMap.selectDistinctOn=e,this}fromDummy(){return this.from(this.connection.driver.dummyTableName??"(SELECT 1 AS dummy_column)","dummy_table")}from(e,n){const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}addFrom(e,n){const r=this.createFromAlias(e,n);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(r),this}innerJoin(e,n,r,i){return this.join("INNER",e,n,r,i),this}leftJoin(e,n,r,i){return this.join("LEFT",e,n,r,i),this}innerJoinAndSelect(e,n,r,i){return this.addSelect(n),this.innerJoin(e,n,r,i),this}leftJoinAndSelect(e,n,r,i){return this.addSelect(n),this.leftJoin(e,n,r,i),this}innerJoinAndMapMany(e,n,r,i,o){return this.addSelect(r),this.join("INNER",n,r,i,o,e,!0),this}innerJoinAndMapOne(e,n,r,i,o,s){return this.addSelect(r),this.join("INNER",n,r,i,o,e,!1,s),this}leftJoinAndMapMany(e,n,r,i,o){return this.addSelect(r),this.join("LEFT",n,r,i,o,e,!0),this}leftJoinAndMapOne(e,n,r,i,o,s){return this.addSelect(r),this.join("LEFT",n,r,i,o,e,!1,s),this}loadRelationIdAndMap(e,n,r,i){const o=new ba(this.expressionMap);return o.mapToProperty=e,o.relationName=n,typeof r=="string"&&(o.alias=r),typeof r=="object"&&r.disableMixedMap&&(o.disableMixedMap=!0),o.queryBuilderFactory=i,this.expressionMap.relationIdAttributes.push(o),o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(e,n,r,i){const o=new wa(this.expressionMap);return o.mapToProperty=e,o.relationName=n,o.alias=r,o.queryBuilderFactory=i,this.expressionMap.relationCountAttributes.push(o),this.expressionMap.createAlias({type:"other",name:o.junctionAlias}),o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata}),this}loadAllRelationIds(e){return this.expressionMap.mainAlias.metadata.relations.forEach(n=>{e!==void 0&&e.relations!==void 0&&e.relations.indexOf(n.propertyPath)===-1||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+n.propertyPath,this.expressionMap.mainAlias.name+"."+n.propertyPath,e)}),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereExists(e){return this.where(...this.getExistsCondition(e))}andWhereExists(e){return this.andWhere(...this.getExistsCondition(e))}orWhereExists(e){return this.orWhere(...this.getExistsCondition(e))}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}having(e,n){return this.expressionMap.havings.push({type:"simple",condition:e}),n&&this.setParameters(n),this}andHaving(e,n){return this.expressionMap.havings.push({type:"and",condition:e}),n&&this.setParameters(n),this}orHaving(e,n){return this.expressionMap.havings.push({type:"or",condition:e}),n&&this.setParameters(n),this}groupBy(e){return e?this.expressionMap.groupBys=[e]:this.expressionMap.groupBys=[],this}addGroupBy(e){return this.expressionMap.groupBys.push(e),this}timeTravelQuery(e){return this.connection.driver.options.type==="cockroachdb"&&(e===void 0?this.expressionMap.timeTravel="follower_read_timestamp()":this.expressionMap.timeTravel=e),this}orderBy(e,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new G('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new G('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new G('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new G('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){if(this.expressionMap.limit=this.normalizeNumber(e),this.expressionMap.limit!==void 0&&isNaN(this.expressionMap.limit))throw new G('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(e){if(this.expressionMap.offset=this.normalizeNumber(e),this.expressionMap.offset!==void 0&&isNaN(this.expressionMap.offset))throw new G('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(e){if(this.expressionMap.take=this.normalizeNumber(e),this.expressionMap.take!==void 0&&isNaN(this.expressionMap.take))throw new G('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(e){if(this.expressionMap.skip=this.normalizeNumber(e),this.expressionMap.skip!==void 0&&isNaN(this.expressionMap.skip))throw new G('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(e){return this.expressionMap.useIndex=e,this}setLock(e,n,r){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=n,this.expressionMap.lockTables=r,this}setOnLocked(e){return this.expressionMap.onLocked=e,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if(this.expressionMap.lockMode==="optimistic")throw new wn;this.expressionMap.queryEntity=!1;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0);const r=await this.loadRawResults(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getRawAndEntities(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getOne(){const e=(await this.getRawAndEntities()).entities[0];if(e&&this.expressionMap.lockMode==="optimistic"&&this.expressionMap.lockVersion){const n=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const r=n.updateDateColumn.getEntityValue(e);if(r.getTime()!==this.expressionMap.lockVersion.getTime())throw new Kp(n.name,this.expressionMap.lockVersion,r)}else{const r=n.versionColumn.getEntityValue(e);if(r!==this.expressionMap.lockVersion)throw new Kp(n.name,this.expressionMap.lockVersion,r)}}return e===void 0?null:e}async getOneOrFail(){const e=await this.getOne();if(!e)throw new ww(this.expressionMap.mainAlias.target,this.expressionMap.parameters);return e}async getMany(){if(this.expressionMap.lockMode==="optimistic")throw new wn;return(await this.getRawAndEntities()).entities}async getCount(){if(this.expressionMap.lockMode==="optimistic")throw new wn;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeCountQuery(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getExists(){if(this.expressionMap.lockMode==="optimistic")throw new wn;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeExistsQuery(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getManyAndCount(){if(this.expressionMap.lockMode==="optimistic")throw new wn;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(e);this.expressionMap.queryEntity=!1;const i=this.expressionMap.cacheId;this.expressionMap.cacheId=i&&`${i}-count`;const o=await this.executeCountQuery(e),s=[r.entities,o];return n&&await e.commitTransaction(),s}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async stream(){this.expressionMap.queryEntity=!1;const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let i=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),i=!0);const o=()=>{if(r!==this.queryRunner)return r.release()},s=r.stream(e,n,o,o);return i&&await r.commitTransaction(),s}catch(o){if(i)try{await r.rollbackTransaction()}catch{}throw o}}cache(e,n){return typeof e=="boolean"?this.expressionMap.cache=e:typeof e=="number"?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):(typeof e=="string"||typeof e=="number")&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),n&&(this.expressionMap.cacheDuration=n),this}setOption(e){return this.expressionMap.options.push(e),this}join(e,n,r,i,o,s,a,c){o&&this.setParameters(o);const l=new mf(this.connection,this.expressionMap);l.direction=e,l.mapAsEntity=c,l.mapToProperty=s,l.isMappingMany=a,l.entityOrProperty=n,l.condition=i,this.expressionMap.joinAttributes.push(l);const d=l.metadata;if(d){if(d.deleteDateColumn&&!this.expressionMap.withDeleted){const u=`${r}.${d.deleteDateColumn.propertyName} IS NULL`;l.condition=l.condition?` ${l.condition} AND ${u}`:`${u}`}l.alias=this.expressionMap.createAlias({type:"join",name:r,metadata:d}),l.relation&&l.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:l.junctionAlias,metadata:l.relation.junctionEntityMetadata})}else{let u="";if(typeof n=="function"){const p=n(this.subQuery());this.setParameters(p.getParameters()),u=p.getQuery()}else u=n;const h=typeof n=="function"||n.substr(0,1)==="("&&n.substr(-1)===")";l.alias=this.expressionMap.createAlias({type:"join",name:r,tablePath:h===!1?n:void 0,subQuery:h===!0?u:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new G("Cannot build query because main alias is not set (call qb#from method)");const e=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){const a=this.expressionMap.mainAlias.metadata;e.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,a)),n.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,a))}this.expressionMap.joinAttributes.forEach(a=>{if(a.metadata)e.push(...this.buildEscapedEntityColumnSelects(a.alias.name,a.metadata)),n.push(...this.findEntityColumnSelects(a.alias.name,a.metadata));else if(this.expressionMap.selects.some(c=>c.selection===a.alias.name)){e.push({selection:this.escape(a.alias.name)+".*"});const c=this.expressionMap.selects.find(l=>l.selection===a.alias.name);n.push(c)}}),this.expressionMap.selects.filter(a=>n.indexOf(a)===-1).forEach(a=>e.push({selection:this.replacePropertyNames(a.selection),aliasName:a.aliasName})),e.length===0&&e.push({selection:"*"});let r="";this.expressionMap.useIndex&&Q.isMySQLFamily(this.connection.driver)&&(r=` USE INDEX (${this.expressionMap.useIndex})`);const i=this.expressionMap.aliases.filter(a=>a.type==="from"&&(a.tablePath||a.subQuery)).map(a=>a.subQuery?a.subQuery+" "+this.escape(a.name):this.getTableName(a.tablePath)+" "+this.escape(a.name)),o=this.createSelectDistinctExpression(),s=e.map(a=>a.selection+(a.aliasName?" AS "+this.escape(a.aliasName):"")).join(", ");return o+s+" FROM "+i.join(", ")+this.createTableLockExpression()+r}createSelectDistinctExpression(){const{selectDistinct:e,selectDistinctOn:n,maxExecutionTime:r}=this.expressionMap,{driver:i}=this.connection;let o="SELECT ";return r>0&&Q.isMySQLFamily(i)&&(o+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),Q.isPostgresFamily(i)&&n.length>0?o=`SELECT DISTINCT ON (${n.map(s=>this.replacePropertyNames(s)).join(", ")}) `:e&&(o="SELECT DISTINCT "),o}createJoinExpression(){return this.expressionMap.joinAttributes.map(e=>{const n=e.relation,r=e.tablePath,i=e.alias.name;let o=e.condition?" AND ("+e.condition+")":"";const s=e.parentAlias;if(!s||!n){const a=e.alias.subQuery?e.alias.subQuery:this.getTableName(r);return" "+e.direction+" JOIN "+a+" "+this.escape(i)+this.createTableLockExpression()+(e.condition?" ON "+this.replacePropertyNames(e.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){const a=n.joinColumns.map(c=>i+"."+c.referencedColumn.propertyPath+"="+s+"."+n.propertyPath+"."+c.referencedColumn.propertyPath).join(" AND ");return" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(a+o)}else if(n.isOneToMany||n.isOneToOneNotOwner){const a=n.inverseRelation.joinColumns.map(c=>(n.inverseEntityMetadata.tableType==="entity-child"&&n.inverseEntityMetadata.discriminatorColumn&&(o+=" AND "+i+"."+n.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+n.inverseEntityMetadata.discriminatorValue+"'"),i+"."+n.inverseRelation.propertyPath+"."+c.referencedColumn.propertyPath+"="+s+"."+c.referencedColumn.propertyPath)).join(" AND ");if(!a)throw new G(`Relation ${n.entityMetadata.name}.${n.propertyName} does not have join columns.`);return" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(a+o)}else{const a=n.junctionEntityMetadata.tablePath,c=e.junctionAlias;let l="",d="";return n.isOwning?(l=n.joinColumns.map(u=>c+"."+u.propertyPath+"="+s+"."+u.referencedColumn.propertyPath).join(" AND "),d=n.inverseJoinColumns.map(u=>i+"."+u.referencedColumn.propertyPath+"="+c+"."+u.propertyPath).join(" AND ")):(l=n.inverseRelation.inverseJoinColumns.map(u=>c+"."+u.propertyPath+"="+s+"."+u.referencedColumn.propertyPath).join(" AND "),d=n.inverseRelation.joinColumns.map(u=>i+"."+u.referencedColumn.propertyPath+"="+c+"."+u.propertyPath).join(" AND "))," "+e.direction+" JOIN "+this.getTableName(a)+" "+this.escape(c)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(l)+" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(d+o)}}).join(" ")}createGroupByExpression(){return!this.expressionMap.groupBys||!this.expressionMap.groupBys.length?"":" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", "))}createOrderByExpression(){const e=this.expressionMap.allOrderBys;return Object.keys(e).length===0?"":" ORDER BY "+Object.keys(e).map(n=>{const r=typeof e[n]=="string"?e[n]:e[n].order+" "+e[n].nulls,i=this.expressionMap.selects.find(o=>o.selection===n);if(i&&!i.aliasName&&n.indexOf(".")!==-1){const o=n.split("."),s=o[0],a=o.slice(1).join("."),c=this.expressionMap.aliases.find(l=>l.name===s);if(c){const l=c.metadata.findColumnWithPropertyPath(a);if(l){const d=Q.buildAlias(this.connection.driver,void 0,s,l.databaseName);return this.escape(d)+" "+r}}}return this.replacePropertyNames(n)+" "+r}).join(", ")}createLimitOffsetExpression(){let e=this.expressionMap.offset,n=this.expressionMap.limit;if(!e&&!n&&this.expressionMap.joinAttributes.length===0&&(e=this.expressionMap.skip,n=this.expressionMap.take),this.connection.driver.options.type==="mssql"){let r="";if((n||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(r=" ORDER BY (SELECT NULL)"),n&&e)return r+" OFFSET "+e+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return r+" OFFSET 0 ROWS FETCH NEXT "+n+" ROWS ONLY";if(e)return r+" OFFSET "+e+" ROWS"}else if(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)throw new Ow}else if(Q.isSQLiteFamily(this.connection.driver)){if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver.options.type==="oracle"){if(n&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return" FETCH NEXT "+n+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)return" OFFSET "+e}return""}createTableLockExpression(){if(this.connection.driver.options.type==="mssql")switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const e=this.connection.driver;let n="";if(this.expressionMap.lockTables){if(!(Q.isPostgresFamily(e)||e.options.type==="cockroachdb"))throw new G("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new G("lockTables cannot be an empty array");n=" OF "+this.expressionMap.lockTables.join(", ")}let r="";switch(this.expressionMap.onLocked==="nowait"?r=" NOWAIT":this.expressionMap.onLocked==="skip_locked"&&(r=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if(e.options.type==="mysql"||e.options.type==="aurora-mysql")return Q.isReleaseVersionOrGreater(e,"8.0.0")?" FOR SHARE"+n+r:" LOCK IN SHARE MODE";if(e.options.type==="mariadb")return" LOCK IN SHARE MODE";if(Q.isPostgresFamily(e))return" FOR SHARE"+n+r;if(e.options.type==="oracle")return" FOR UPDATE";if(e.options.type==="mssql")return"";throw new Vt;case"pessimistic_write":if(Q.isMySQLFamily(e)||e.options.type==="aurora-mysql"||e.options.type==="oracle")return" FOR UPDATE"+r;if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+n+r;if(e.options.type==="mssql")return"";throw new Vt;case"pessimistic_partial_write":if(Q.isPostgresFamily(e))return" FOR UPDATE"+n+" SKIP LOCKED";if(Q.isMySQLFamily(e))return" FOR UPDATE SKIP LOCKED";throw new Vt;case"pessimistic_write_or_fail":if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+n+" NOWAIT";if(Q.isMySQLFamily(e))return" FOR UPDATE NOWAIT";throw new Vt;case"for_no_key_update":if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR NO KEY UPDATE"+n+r;throw new Vt;case"for_key_share":if(Q.isPostgresFamily(e))return" FOR KEY SHARE"+n+r;throw new Vt;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const e=this.expressionMap.havings.map((n,r)=>{switch(n.type){case"and":return(r>0?"AND ":"")+this.replacePropertyNames(n.condition);case"or":return(r>0?"OR ":"")+this.replacePropertyNames(n.condition);default:return this.replacePropertyNames(n.condition)}}).join(" ");return e.length?" HAVING "+e:""}buildEscapedEntityColumnSelects(e,n){const r=this.expressionMap.selects.some(l=>l.selection===e),i=[];if(r&&i.push(...n.columns.filter(l=>l.isSelect===!0)),i.push(...n.columns.filter(l=>this.expressionMap.selects.some(d=>d.selection===e+"."+l.propertyPath))),i.length===0)return[];const o=this.expressionMap.queryEntity?n.primaryColumns.filter(l=>i.indexOf(l)===-1):[],s=[...i,...o],a=[],c=this.escape(e);return s.forEach(l=>{let d=c+"."+this.escape(l.databaseName);l.isVirtualProperty&&l.query&&(d=`(${l.query(c)})`),this.connection.driver.spatialTypes.indexOf(l.type)!==-1&&((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(d=`${this.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText"}(${d})`),Q.isPostgresFamily(this.connection.driver)&&(l.precision?d=`ST_AsGeoJSON(${d}, ${l.precision})::json`:d=`ST_AsGeoJSON(${d})::json`),this.connection.driver.options.type==="mssql"&&(d=`${d}.ToString()`));const u=this.expressionMap.selects.filter(h=>h.selection===e+"."+l.propertyPath);if(u.length)u.forEach(h=>{a.push({selection:d,aliasName:h.aliasName?h.aliasName:Q.buildAlias(this.connection.driver,void 0,e,l.databaseName),virtual:h.virtual})});else{if(l.isVirtualProperty)return;a.push({selection:d,aliasName:Q.buildAlias(this.connection.driver,void 0,e,l.databaseName),virtual:r})}}),a}findEntityColumnSelects(e,n){const r=this.expressionMap.selects.find(i=>i.selection===e);return r?[r]:this.expressionMap.selects.filter(i=>n.columns.some(o=>i.selection===e+"."+o.propertyPath))}computeCountExpression(){const e=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata.primaryColumns,r=this.escape(e);if(this.expressionMap.joinAttributes.length===0&&this.expressionMap.relationIdAttributes.length===0&&this.expressionMap.relationCountAttributes.length===0)return"COUNT(1)";if(this.connection.driver.options.type==="cockroachdb"||Q.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(", ")+"))";if(Q.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(", ")+")";if(this.connection.driver.options.type==="mssql"){const i=n.map(o=>`${r}.${this.escape(o.databaseName)}`).join(", '|;|', ");return n.length===1?`COUNT(DISTINCT(${i}))`:`COUNT(DISTINCT(CONCAT(${i})))`}return this.connection.driver.options.type==="spanner"?n.length===1?`COUNT(DISTINCT(${r}.${this.escape(n[0].databaseName)}))`:`COUNT(DISTINCT(CONCAT(${n.map(i=>`CAST(${r}.${this.escape(i.databaseName)} AS STRING)`).join(", '|;|', ")})))`:"COUNT(DISTINCT("+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(" || '|;|' || ")+"))"}async executeCountQuery(e){const n=this.computeCountExpression(),r=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(n,"cnt").setOption("disable-global-order").loadRawResults(e);return!r||!r[0]||!r[0].cnt?0:parseInt(r[0].cnt)}async executeExistsQuery(e){return(await this.connection.createQueryBuilder().fromDummy().select("1","row_exists").whereExists(this).limit(1).loadRawResults(e)).length>0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const e=Array.isArray(this.findOptions.select)?Ae.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(e,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const e=Array.isArray(this.findOptions.relations)?Ae.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.findOptions.loadEagerRelations!==!1&&this.expressionMap.relationLoadStrategy==="join"&&this.buildEagerRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere(this.conditions.substr(0,1)!=="("?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach(e=>{e.select&&!e.selection?e.type==="inner"?this.innerJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):e.type==="inner"?this.innerJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias)}),this.findOptions.skip!==void 0&&this.skip(this.findOptions.skip),this.findOptions.take!==void 0&&this.take(this.findOptions.take),typeof this.findOptions.cache=="number"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="boolean"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="object"&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach(e=>{this.leftJoin(this.findOptions.join.leftJoin[e],e)}),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach(e=>{this.innerJoin(this.findOptions.join.innerJoin[e],e)}),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach(e=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[e],e)}),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach(e=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[e],e)})),this.findOptions.lock){if(this.findOptions.lock.mode==="optimistic")this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if(this.findOptions.lock.mode==="pessimistic_read"||this.findOptions.lock.mode==="pessimistic_write"||this.findOptions.lock.mode==="dirty_read"||this.findOptions.lock.mode==="pessimistic_partial_write"||this.findOptions.lock.mode==="pessimistic_write_or_fail"||this.findOptions.lock.mode==="for_no_key_update"||this.findOptions.lock.mode==="for_key_share"){const e=this.findOptions.lock.tables?this.findOptions.lock.tables.map(n=>{const r=this.expressionMap.aliases.find(i=>i.metadata.tableNameWithoutPrefix===n);if(!r)throw new G(`"${n}" is not part of this query`);return this.escape(r.name)}):void 0;this.setLock(this.findOptions.lock.mode,void 0,e),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}}this.findOptions.loadRelationIds===!0?this.loadAllRelationIds():typeof this.findOptions.loadRelationIds=="object"&&this.loadAllRelationIds(this.findOptions.loadRelationIds),this.findOptions.loadEagerRelations!==!1&&Ca.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),this.findOptions.transaction===!0&&(this.expressionMap.useTransaction=!0)}}concatRelationMetadata(e){this.relationMetadatas.push(e)}async executeEntitiesAndRawResults(e){if(!this.expressionMap.mainAlias)throw new G('Alias is not set. Use "from" method to set an alias.');if((this.expressionMap.lockMode==="pessimistic_read"||this.expressionMap.lockMode==="pessimistic_write"||this.expressionMap.lockMode==="pessimistic_partial_write"||this.expressionMap.lockMode==="pessimistic_write_or_fail"||this.expressionMap.lockMode==="for_no_key_update"||this.expressionMap.lockMode==="for_key_share")&&!e.isTransactionActive)throw new Sw;if(this.expressionMap.lockMode==="optimistic"){const s=this.expressionMap.mainAlias.metadata;if(!s.versionColumn&&!s.updateDateColumn)throw new Ew(s.name)}const n=new Xw(this.connection,e,this.expressionMap.relationIdAttributes),r=new eM(this.connection,e,this.expressionMap.relationCountAttributes);new Jw(this.expressionMap).transform(),new tM(this.expressionMap).transform();let i=[],o=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[s,a]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),c=this.expressionMap.mainAlias.metadata,l=this.expressionMap.mainAlias.name,d=c.primaryColumns.map(p=>{const m=this.escape("distinctAlias"),f=this.escape(Q.buildAlias(this.connection.driver,void 0,l,p.databaseName));a[f]||(a[f]="ASC");const g=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,p.databaseName);return`${m}.${f} AS ${this.escape(g)}`}),u=this.clone(),h=u.expressionMap.timeTravel;if(i=await new Sa(this.connection,e).select(`DISTINCT ${d.join(", ")}`).addSelect(s).from(`(${u.orderBy().timeTravelQuery(!1).getQuery()})`,"distinctAlias").timeTravelQuery(h).offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(a).cache(this.expressionMap.cache&&this.expressionMap.cacheId?`${this.expressionMap.cacheId}-pagination`:this.expressionMap.cache,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),i.length>0){let p="";const m={};if(c.hasMultiplePrimaryKeys)p=i.map((f,g)=>c.primaryColumns.map(y=>{const x=`orm_distinct_ids_${g}_${y.databaseName}`,v=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,y.databaseName);return m[x]=f[v],`${l}.${y.propertyPath}=:${x}`}).join(" AND ")).join(" OR ");else{const f=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,c.primaryColumns[0].databaseName),g=i.map(y=>y[f]);g.every(y=>typeof y=="number")?p=`${l}.${c.primaryColumns[0].propertyPath} IN (${g.join(", ")})`:(m.orm_distinct_ids=g,p=l+"."+c.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}i=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:p}).setParameters(m).loadRawResults(e)}}else i=await this.loadRawResults(e);if(i.length>0){const s=await n.load(i),a=await r.load(i);o=new Gw(this.expressionMap,this.connection.driver,s,a,this.queryRunner).transform(i,this.expressionMap.mainAlias),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,o)}if(this.expressionMap.relationLoadStrategy==="query"){const s=new Kw(this.connection,e);await Promise.all(this.relationMetadatas.map(async a=>{const c=a.inverseEntityMetadata.target,l=a.inverseEntityMetadata.targetName,d=Array.isArray(this.findOptions.select)?Ae.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,u=Array.isArray(this.findOptions.relations)?Ae.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,h=this.createQueryBuilder(e).select(l).from(c,l).setFindOptions({select:d?Ae.deepValue(d,a.propertyPath):void 0,order:this.findOptions.order?Ae.deepValue(this.findOptions.order,a.propertyPath):void 0,relations:u?Ae.deepValue(u,a.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(o.length>0){const p=await s.loadManyToManyRelationIdsAndGroup(a,o,void 0,h);o.forEach(m=>{const f=p.find(g=>g.entity===m);if(f){const g=f.related===void 0?null:f.related;a.setEntityValue(m,g)}})}}))}return{raw:i,entities:o}}createOrderByCombinedWithSelectExpression(e){const n=this.expressionMap.allOrderBys,r=Object.keys(n).map(o=>{if(o.indexOf(".")!==-1){const s=o.split("."),a=s[0],c=s.slice(1).join("."),l=this.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyPath(c);return this.escape(e)+"."+this.escape(Q.buildAlias(this.connection.driver,void 0,a,l.databaseName))}else return this.expressionMap.selects.find(s=>s.selection===o||s.aliasName===o)?this.escape(e)+"."+this.escape(o):""}).join(", "),i={};return Object.keys(n).forEach(o=>{if(o.indexOf(".")!==-1){const s=o.split("."),a=s[0],c=s.slice(1).join("."),l=this.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyPath(c);i[this.escape(e)+"."+this.escape(Q.buildAlias(this.connection.driver,void 0,a,l.databaseName))]=n[o]}else this.expressionMap.selects.find(s=>s.selection===o||s.aliasName===o)?i[this.escape(e)+"."+this.escape(o)]=n[o]:i[o]=n[o]}),[r,i]}async loadRawResults(e){const[n,r]=this.getQueryAndParameters(),i=n+" -- PARAMETERS: "+JSON.stringify(r,(d,u)=>typeof u=="bigint"?u.toString():u),o=typeof this.connection.options.cache=="object"?this.connection.options.cache:{};let s;const a=o.alwaysEnabled&&this.expressionMap.cache!==!1||this.expressionMap.cache===!0;let c=!1;if(this.connection.queryResultCache&&a)try{if(s=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:i,duration:this.expressionMap.cacheDuration||o.duration||1e3},e),s&&!this.connection.queryResultCache.isExpired(s))return JSON.parse(s.result)}catch(d){if(!o.ignoreErrors)throw d;c=!0}const l=await e.query(n,r,!0);if(!c&&this.connection.queryResultCache&&a)try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:i,time:new Date().getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(l.records)},s,e)}catch(d){if(!o.ignoreErrors)throw d}return l.records}mergeExpressionMap(e){return Me.assign(this.expressionMap,e),this}normalizeNumber(e){return typeof e=="number"||e===void 0||e===null?e:Number(e)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner(this.connection.defaultReplicationModeForReads())}buildSelect(e,n,r,i){for(let o in e){if(e[o]===void 0||e[o]===!1)continue;const s=i?i+"."+o:o,a=n.findColumnWithPropertyPathStrict(s),c=n.findEmbeddedWithPropertyPath(s),l=n.findRelationWithPropertyPath(s);if(!c&&!a&&!l)throw new Qe(s,n);a?this.selects.push(r+"."+s):c&&this.buildSelect(e[o],n,r,s)}}buildRelations(e,n,r,i,o){e&&Object.keys(e).forEach(s=>{const a=e[s],c=o?o+"."+s:s,l=r.findEmbeddedWithPropertyPath(c),d=r.findRelationWithPropertyPath(c);if(!l&&!d)throw new Qe(c,r);if(l)this.buildRelations(a,typeof n=="object"?Ae.deepValue(n,l.propertyPath):void 0,r,i,c);else if(d){let u=i+"_"+c.replace(".","_");u=Q.buildAlias(this.connection.driver,{joiner:"__"},i,u),(a===!0||typeof a=="object")&&(this.expressionMap.relationLoadStrategy==="query"?this.concatRelationMetadata(d):(this.joins.push({type:"left",select:!0,selection:n&&typeof n[s]=="object"?n[s]:void 0,alias:u,parentAlias:i,relationMetadata:d}),n&&typeof n[s]=="object"&&this.buildSelect(n[s],d.inverseEntityMetadata,u))),typeof a=="object"&&this.expressionMap.relationLoadStrategy==="join"&&this.buildRelations(a,typeof n=="object"?Ae.deepValue(n,d.propertyPath):void 0,d.inverseEntityMetadata,u,void 0)}})}buildEagerRelations(e,n,r,i,o){e&&Object.keys(e).forEach(s=>{const a=e[s],c=o?o+"."+s:s,l=r.findEmbeddedWithPropertyPath(c),d=r.findRelationWithPropertyPath(c);if(!l&&!d)throw new Qe(c,r);if(l)this.buildEagerRelations(a,typeof n=="object"?Ae.deepValue(n,l.propertyPath):void 0,r,i,c);else if(d){let u=i+"_"+c.replace(".","_");u=Q.buildAlias(this.connection.driver,{joiner:"__"},i,u),(a===!0||typeof a=="object")&&d.inverseEntityMetadata.eagerRelations.forEach(h=>{let p=u+"_"+h.propertyPath.replace(".","_");p=Q.buildAlias(this.connection.driver,{joiner:"__"},u,p),this.joins.find(m=>m.alias===p)||this.joins.push({type:"left",select:!0,alias:p,parentAlias:u,selection:void 0,relationMetadata:h}),n&&typeof n[s]=="object"&&this.buildSelect(n[s],d.inverseEntityMetadata,u)}),typeof a=="object"&&this.buildEagerRelations(a,typeof n=="object"?Ae.deepValue(n,d.propertyPath):void 0,d.inverseEntityMetadata,u,void 0)}})}buildOrder(e,n,r,i){for(let o in e){if(e[o]===void 0)continue;const s=i?i+"."+o:o,a=n.findColumnWithPropertyPathStrict(s),c=n.findEmbeddedWithPropertyPath(s),l=n.findRelationWithPropertyPath(s);if(!c&&!a&&!l)throw new Qe(s,n);if(a){let d=typeof e[o]=="object"?e[o].direction:e[o];d=d==="DESC"||d==="desc"||d===-1?"DESC":"ASC";let u=typeof e[o]=="object"?e[o].nulls:void 0;u=(u==null?void 0:u.toLowerCase())==="first"?"NULLS FIRST":(u==null?void 0:u.toLowerCase())==="last"?"NULLS LAST":void 0;let h=`${r}.${s}`;this.addOrderBy(h,d,u)}else if(c)this.buildOrder(e[o],n,r,s);else if(l){let d=r+"_"+s.replace(".","_");d=Q.buildAlias(this.connection.driver,{joiner:"__"},r,d),this.joins.find(u=>u.alias===d)||this.joins.push({type:"left",select:!1,alias:d,parentAlias:r,selection:void 0,relationMetadata:l}),this.buildOrder(e[o],l.inverseEntityMetadata,d)}}}buildWhere(e,n,r,i){let o="";if(Array.isArray(e))e.length&&(o=e.map(s=>this.buildWhere(s,n,r,i)).filter(s=>!!s).map(s=>"("+s+")").join(" OR "));else{let s=[];for(let a in e){if(e[a]===void 0||e[a]===null)continue;const c=i?i+"."+a:a,l=n.findColumnWithPropertyPathStrict(c),d=n.findEmbeddedWithPropertyPath(c),u=n.findRelationWithPropertyPath(c);if(!d&&!l&&!u)throw new Qe(c,n);if(l){let h=`${r}.${c}`;l.isVirtualProperty&&l.query&&(h=`(${l.query(r)})`);let p=e[a];fe.isEqualOperator(e[a])&&(p=e[a].value),l.transformer&&(p instanceof Mn?p.transformValue(l.transformer):p=Ea.transformTo(l.transformer,p)),s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(h,p)))}else if(d){const h=this.buildWhere(e[a],n,r,c);h&&s.push(h)}else if(u){if(typeof e[a]=="object"&&Object.keys(e[a]).every(h=>e[a][h]===void 0))continue;if(fe.isFindOperator(e[a]))if(e[a].type==="moreThan"||e[a].type==="lessThan"||e[a].type==="moreThanOrEqual"||e[a].type==="lessThanOrEqual"){let h="";e[a].type==="moreThan"?h=">":e[a].type==="lessThan"?h="<":e[a].type==="moreThanOrEqual"?h=">=":e[a].type==="lessThanOrEqual"&&(h="<=");const p=this.subQuery();if(u.isManyToManyOwner)p.select("COUNT(*)").from(u.joinTableName,u.joinTableName).where(u.joinColumns.map(m=>`${u.joinTableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else if(u.isManyToManyNotOwner)p.select("COUNT(*)").from(u.inverseRelation.joinTableName,u.inverseRelation.joinTableName).where(u.inverseRelation.inverseJoinColumns.map(m=>`${u.inverseRelation.joinTableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else if(u.isOneToMany)p.select("COUNT(*)").from(u.inverseEntityMetadata.target,u.inverseEntityMetadata.tableName).where(u.inverseRelation.joinColumns.map(m=>`${u.inverseEntityMetadata.tableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else throw new Error("This relation isn't supported by given find operator");this.andWhere(p.getSql()+" "+h+" "+parseInt(e[a].value))}else if(u.isManyToOne||u.isOneToOne&&u.isOneToOneOwner){const h=`${r}.${c}`;s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(h,e[a])))}else throw new Error("This relation isn't supported by given find operator");else{let h=r+"_"+u.propertyPath.replace(".","_");h=Q.buildAlias(this.connection.driver,{joiner:"__"},r,h),this.joins.find(m=>m.alias===h)||this.joins.push({type:"left",select:!1,selection:void 0,alias:h,parentAlias:r,relationMetadata:u});const p=this.buildWhere(e[a],u.inverseEntityMetadata,h);p&&s.push(p)}}}o=s.length?"("+s.join(") AND (")+")":s.join(" AND ")}return o.length?"("+o+")":o}}class wf{constructor(){this.generatedMaps=[]}static from(e){const n=new this;return n.raw=e.records,n.affected=e.affected,n}}class nM extends ve{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createUpdateExpression();return e+=this.createCteExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const r=new _a(e,this.expressionMap);this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=r.getSoftDeletionReturningColumns());const[i,o]=this.getQueryAndParameters(),s=await e.query(i,o,!0),a=wf.from(s);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await r.update(a,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),n&&await e.commitTransaction(),a}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}from(e,n){e=fe.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new Cr;return this.expressionMap.returning=e,this}orderBy(e,n="ASC",r){return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new G(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(e)?e:[e];return n.forEach(r=>{const i=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!i)throw new G("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(i)}),this.expressionMap.whereEntities=n,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new G(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!e.deleteDateColumn)throw new Mw(e);const n=[];switch(this.expressionMap.queryType){case"soft-delete":n.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":n.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new G('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&n.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&n.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),n.length<=0)throw new la;const r=this.createWhereExpression(),i=this.createReturningExpression("update");return i===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")} OUTPUT ${i}${r}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r} RETURNING ${i}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(n=>typeof e[n]=="string"?this.replacePropertyNames(n)+" "+e[n]:this.replacePropertyNames(n)+" "+e[n].order+" "+e[n].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(Q.isMySQLFamily(this.connection.driver))return" LIMIT "+e;throw new Jp}return""}}class rM extends ve{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let r=null,i=null;const o=new _a(e,this.expressionMap),s=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const h of this.expressionMap.returning)s.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(h));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=o.getUpdationReturningColumns(),s.push(...this.expressionMap.extraReturningColumns.filter(h=>!s.includes(h)))),s.length>0&&this.connection.driver.options.type==="mssql"&&(r=this.connection.driver.buildTableVariableDeclaration("@OutputTable",s),i="SELECT * FROM @OutputTable");const[a,c]=this.getQueryAndParameters(),l=[r,a,i],d=await e.query(l.filter(h=>h!=null).join(`;

`),c,!0),u=wf.from(d);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await o.update(u,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),n&&await e.commitTransaction(),u}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}set(e){return this.expressionMap.valuesSet=e,this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new Cr;return this.expressionMap.returning=e,this}orderBy(e,n="ASC",r){return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new G(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(e)?e:[e];return n.forEach(r=>{const i=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!i)throw new G("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(i)}),this.expressionMap.whereEntities=n,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r={};for(let c in e)e[c]!==void 0&&(r[c]=e[c]);const i=[],o=[];if(n?(this.createPropertyPath(n,r).forEach(c=>{const l=n.findColumnsWithPropertyPath(c);if(l.length<=0)throw new Qe(c,n);l.forEach(d=>{if(!d.isUpdate||o.includes(d))return;o.push(d);let u=d.getEntityValue(r);if(d.referencedColumn&&typeof u=="object"&&!(u instanceof Date)&&u!==null&&!Jf.isBuffer(u)?u=d.referencedColumn.getEntityValue(u):typeof u!="function"&&(u=this.connection.driver.preparePersistentValue(u,d)),typeof u=="function")i.push(this.escape(d.databaseName)+" = "+u());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&u===null)i.push(this.escape(d.databaseName)+" = NULL");else{this.connection.driver.options.type==="mssql"&&(u=this.connection.driver.parametrizeValue(d,u));const h=this.createParameter(u);let p=null;if((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(d.type)!==-1){const m=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";d.srid!=null?p=`${m}(${h}, ${d.srid})`:p=`${m}(${h})`}else Q.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(d.type)!==-1?d.srid!=null?p=`ST_SetSRID(ST_GeomFromGeoJSON(${h}), ${d.srid})::${d.type}`:p=`ST_GeomFromGeoJSON(${h})::${d.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(d.type)!==-1?p=d.type+"::STGeomFromText("+h+", "+(d.srid||"0")+")":p=h;i.push(this.escape(d.databaseName)+" = "+p)}})}),(i.length>0||Object.keys(r).length===0)&&(n.versionColumn&&o.indexOf(n.versionColumn)===-1&&i.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&o.indexOf(n.updateDateColumn)===-1&&i.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(r).map(c=>{let l=r[c];if(typeof l=="function")i.push(this.escape(c)+" = "+l());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&l===null)i.push(this.escape(c)+" = NULL");else{const d=this.createParameter(l);i.push(this.escape(c)+" = "+d)}}),i.length<=0)throw new la;const s=this.createWhereExpression(),a=this.createReturningExpression("update");return a===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")}${s}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")} OUTPUT ${a}${s}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")}${s} RETURNING ${a}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(n=>typeof e[n]=="string"?this.replacePropertyNames(n)+" "+e[n]:this.replacePropertyNames(n)+" "+e[n].order+" "+e[n].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")return" LIMIT "+e;throw new Jp}return""}getValueSet(){if(typeof this.expressionMap.valuesSet=="object")return this.expressionMap.valuesSet;throw new la}}function iM(){ve.registerQueryBuilderClass("DeleteQueryBuilder",t=>new zw(t)),ve.registerQueryBuilderClass("InsertQueryBuilder",t=>new Qw(t)),ve.registerQueryBuilderClass("RelationQueryBuilder",t=>new Zw(t)),ve.registerQueryBuilderClass("SelectQueryBuilder",t=>new Sa(t)),ve.registerQueryBuilderClass("SoftDeleteQueryBuilder",t=>new nM(t)),ve.registerQueryBuilderClass("UpdateQueryBuilder",t=>new rM(t))}var Mf;(function(t){t.VIEW="VIEW",t.MATERIALIZED_VIEW="MATERIALIZED_VIEW",t.GENERATED_COLUMN="GENERATED_COLUMN"})(Mf||(Mf={}));var Oa={exports:{}},Na,Ef;function oM(){if(Ef)return Na;Ef=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,o=r*365.25;Na=function(d,u){u=u||{};var h=typeof d;if(h==="string"&&d.length>0)return s(d);if(h==="number"&&isFinite(d))return u.long?c(d):a(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function s(d){if(d=String(d),!(d.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(u){var h=parseFloat(u[1]),p=(u[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*o;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*n;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(d){var u=Math.abs(d);return u>=r?Math.round(d/r)+"d":u>=n?Math.round(d/n)+"h":u>=e?Math.round(d/e)+"m":u>=t?Math.round(d/t)+"s":d+"ms"}function c(d){var u=Math.abs(d);return u>=r?l(d,u,r,"day"):u>=n?l(d,u,n,"hour"):u>=e?l(d,u,e,"minute"):u>=t?l(d,u,t,"second"):d+" ms"}function l(d,u,h,p){var m=u>=h*1.5;return Math.round(d/h)+" "+p+(m?"s":"")}return Na}var Pa,_f;function sM(){if(_f)return Pa;_f=1;function t(e){r.debug=r,r.default=r,r.coerce=l,r.disable=s,r.enable=o,r.enabled=a,r.humanize=oM(),r.destroy=d,Object.keys(e).forEach(u=>{r[u]=e[u]}),r.names=[],r.skips=[],r.formatters={};function n(u){let h=0;for(let p=0;p<u.length;p++)h=(h<<5)-h+u.charCodeAt(p),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=n;function r(u){let h,p=null,m,f;function g(...y){if(!g.enabled)return;const x=g,v=Number(new Date),b=v-(h||v);x.diff=b,x.prev=h,x.curr=v,h=v,y[0]=r.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let M=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(C,E)=>{if(C==="%%")return"%";M++;const A=r.formatters[E];if(typeof A=="function"){const R=y[M];C=A.call(x,R),y.splice(M,1),M--}return C}),r.formatArgs.call(x,y),(x.log||r.log).apply(x,y)}return g.namespace=u,g.useColors=r.useColors(),g.color=r.selectColor(u),g.extend=i,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(m!==r.namespaces&&(m=r.namespaces,f=r.enabled(u)),f),set:y=>{p=y}}),typeof r.init=="function"&&r.init(g),g}function i(u,h){const p=r(this.namespace+(typeof h>"u"?":":h)+u);return p.log=this.log,p}function o(u){r.save(u),r.namespaces=u,r.names=[],r.skips=[];let h;const p=(typeof u=="string"?u:"").split(/[\s,]+/),m=p.length;for(h=0;h<m;h++)p[h]&&(u=p[h].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.slice(1)+"$")):r.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...r.names.map(c),...r.skips.map(c).map(h=>"-"+h)].join(",");return r.enable(""),u}function a(u){if(u[u.length-1]==="*")return!0;let h,p;for(h=0,p=r.skips.length;h<p;h++)if(r.skips[h].test(u))return!1;for(h=0,p=r.names.length;h<p;h++)if(r.names[h].test(u))return!0;return!1}function c(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return Pa=t,Pa}var Cf;function aM(){return Cf||(Cf=1,function(t,e){var n={};e.formatArgs=i,e.save=o,e.load=s,e.useColors=r,e.storage=a(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;l.splice(1,0,d,"color: inherit");let u=0,h=0;l[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(u++,p==="%c"&&(h=u))}),l.splice(h,0,d)}e.log=console.debug||console.log||(()=>{});function o(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof em<"u"&&"env"in em&&(l=n.DEBUG),l}function a(){try{return localStorage}catch{}}t.exports=sM()(e);const{formatters:c}=t.exports;c.j=function(l){try{return JSON.stringify(l)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}(Oa,Oa.exports)),Oa.exports}aM(),iM();let Aa,Sf,ka,Or,Nr,Pr,En,Of,Nf,Pf,Af,kf,Tf,jf,Rf,If,Bf,$f,Df,Lf,Ff,zf;Aa=(t,e)=>({id:t.id,type:t.node_type,position:{x:t.x||0,y:t.y||0},width:t.width||void 0,height:t.height||void 0,data:{loading:!1,flowNode:t,...e}}),Sf=t=>({id:t.id,target:t.target,source:t.target,targetHandle:t.targetHandle,sourceHandle:t.sourceHandle}),ka=t=>({id:t.id,source:t.source,target:t.target,targetHandle:t.targetHandle,sourceHandle:t.sourceHandle}),ym=t=>t.filter(e=>"edgeId"in e?`${e.edgeId}`.startsWith("xy-edge__"):!1),Or=(t,e,n)=>{const r=[];return{changes:t.map(i=>{var c;const o=e.find(l=>i.id===l.id);o||r.push(i.id);const s=(c=n==null?void 0:n[i.source_type])==null?void 0:c.find(l=>(l==null?void 0:l.id)===i.source_id),a=Aa(i,{...o==null?void 0:o.data,entity:s});return{type:o?"replace":"add",id:i.id,item:o?Tn({...o||{},data:void 0},Rn(a,In)):a}}),newIds:[]}},Nr=(t,e)=>{const n=[],r=[],i=t.map(o=>{const s=e.find(a=>o.source===a.source&&o.target===a.target);return!s||s.id!==o.id?(s&&r.push(s.id),{type:"add",item:ka(o)}):(n.push(o.id),{type:"replace",item:ka(o)})});return e.forEach(o=>{n.includes(o.id)||r.push(o.id)}),{changes:i,updatedIds:n,deletedIds:r}},Pr={width:440,height:360},En={width:380,height:650},Jt={[Ne.Toolbox]:"toolbox",[Ne.SessionInfo]:"session-info",[Ne.DefaultEmbeddingModel]:"default-embedding-model",[Ne.ApplicationBar]:"application-bar"},Of={id:Jt[Ne.Toolbox],type:Ne.Toolbox,position:{x:10+En.width+20,y:10},measured:Pr,data:{}},Nf={id:Jt[Ne.SessionInfo],type:Ne.SessionInfo,position:{x:10,y:10},measured:En,data:{}},Pf={id:Jt[Ne.DefaultEmbeddingModel],type:Ne.DefaultEmbeddingModel,position:{x:10+En.width+Pr.width+40,y:10},data:{model:pE}},Af={id:Jt[Ne.ApplicationBar],type:Ne.ApplicationBar,position:{x:10+En.width+Pr.width+40,y:80},data:{}},kf=[Of,Nf,Pf,Af],am=[Ne.Toolbox,Ne.SessionInfo,Ne.ApplicationBar,Ne.EditorApp,Ne.CodeContainerApp],yc={flowNodes:[],flowEdges:[],ready:!0,flowEdgeLoading:!1,flowNodeLoading:!1,syncedNodes:[],syncedEdges:[],syncNodeQueue:[],syncEdgeQueue:[],edges:[],nodes:kf},ac=async t=>{const e=await Ce("FlowNode").find(t),n=e.reduce((i,o)=>{var s;return i[o.source_type]||(i[o.source_type]=[]),(s=i[o.source_type])==null||s.push(o),i},{}),r={};return await Promise.all(Object.entries(n).map(async([i,o])=>{const s=i;r[s]=await Ce(s).find({where:{id:jr(o.map(a=>a.source_id))}})})),{flowNodes:e,entityGroups:n,flowNodeDatas:r}},hm=(t,e)=>({reset:()=>{t(yc)},setNodes:n=>{if(typeof n=="function"){t({nodes:n(e().nodes)});return}t({nodes:n})},setEdges:n=>{if(typeof n=="function"){t({edges:n(e().edges)});return}t({edges:n})},updateNodes:n=>{const r=e().nodes;t({nodes:ht(n,r)})},updateEdges:n=>{const r=e().edges;t({edges:bn(n,r)})},addConnectionToEdges:n=>{const r=e().edges;t({edges:Fl(n,r)})},flowNodesToNodes:(n,r={})=>{const i=e().nodes,{changes:o}=Or(n,i,r);t({nodes:ht(o,i)})},flowEdgesToEdges:n=>{const r=e().edges,{changes:i,updatedIds:o,deletedIds:s}=Nr(n,r);r.forEach(a=>{o.includes(a.id)||s.push(a.id)}),s.forEach(a=>{i.push({type:"remove",id:a})}),t({edges:bn(i,r)})},getNodes:n=>e().nodes.filter(r=>n.includes(r.id)),removeSyncNodeQueue:n=>{const{syncNodeQueue:r}=e();for(const i of n){const o=r.findIndex(s=>s.timestamp===i);o>-1&&r.splice(o,1)}t({syncNodeQueue:r})},removeSyncEdgeQueue:n=>{const{syncEdgeQueue:r}=e();for(const i of n){const o=r.findIndex(s=>s.timestamp===i);o>-1&&r.splice(o,1)}t({syncEdgeQueue:r})},pushSyncNodeQueue:(n,r)=>{const{syncNodeQueue:i}=e();t({syncNodeQueue:[...i,{query:r,timestamp:Date.now(),syncType:n}]})},pushSyncEdgeQueue:()=>{const{syncEdgeQueue:n}=e();t({syncEdgeQueue:[...n,{timestamp:Date.now()}]})},findFlowNodesWithSource:async(n,r)=>{try{t({flowNodeLoading:!0});const{flowNodes:i,flowNodeDatas:o}=await ac(n);if(r!=null&&r.clean)t({flowNodes:i,nodes:i.map(s=>{var c;const a=(c=o==null?void 0:o[s.source_type])==null?void 0:c.find(l=>l.id===s.source_id);return Aa(s,{data:a})})});else{const s=e().flowNodes,a=i.map(d=>d.id),c=e().nodes,{changes:l}=Or(i,c,o);t({flowNodes:[...s.filter(d=>!a.includes(d.id)),...i],nodes:ht(l,c)})}return i}finally{t({flowNodeLoading:!1})}},findFlowEdges:async(n,r)=>{try{t({flowEdgeLoading:!0});const i=await Ce("FlowEdge").find(n),o=e().flowEdges,s=i.map(a=>a.id);if(r!=null&&r.clean)t({flowEdges:i,edges:i.map(a=>Sf(a))});else{const a=e().edges,{changes:c}=Nr(i,a);t({flowEdges:[...o.filter(l=>!s.includes(l.id)),...i],edges:bn(c,a)})}return i}finally{t({flowEdgeLoading:!1})}},deleteFlowNode:async n=>{try{if(!n.id&&!n.source_type&&!n.source_id)throw new Error("Missing flow node indentify");const r=await Ce("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}});if(r){await Ce("FlowNode").delete(r.id);const i=e().flowNodes;r.source_type&&r.source_id&&await Ce(r.source_type).delete(r.source_id).catch(s=>{_t("Failed to delete source entity",r.source_type,r.source_id,s)});const o=e().nodes;t({flowNodes:i.filter(s=>s.id!==r.id),nodes:ht([{type:"remove",id:r.id}],o)})}}catch(r){_t("Failed to delete flow node",r)}},deleteFlowEdge:async n=>{try{if(!n.id&&!n.source&&!n.target)throw new Error("Missing flow edge indentify");const r=await Ce("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}});if(r){await Ce("FlowEdge").delete(r.id);const i=e().flowEdges;t({flowEdges:i.filter(o=>o.id!==r.id)})}}catch(r){_t("Failed to delete flow edge",r)}},updateFlowNode:async(n,r)=>{var i;try{if(!((i=La.getState().currentSession)!=null&&i.id))throw new Error("Session not found");if(!n.id)throw new Error("Missing flow node indentify");await Ce("FlowNode").update(n.id,n);const o=e().flowNodes.map(s=>s.id===n.id?{...s,...n}:s);t({flowNodes:r!=null&&r.silent?o:[...o]})}catch(o){_t("Failed to create or update flow node",o,n)}},createOrUpdateFlowNode:async(n,r)=>{var i;try{const o=La.getState().currentSession;if(!(o!=null&&o.id))throw new Error("Session not found");if(!n.id&&(!n.source_type||!n.source_id))throw new Error("Missing flow node indentify");let s,a=n!=null&&n.id?e().flowNodes.find(p=>p.id===n.id):void 0;if(!a&&(n.id||n.source_type&&n.source_id)&&(a=await Ce("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}})),a)s=Tn(a,Rn(n,In)),r!=null&&r.lazy?Ce("FlowNode").update(a.id,s):await Ce("FlowNode").update(a.id,s);else if(n.source_id&&n.source_type)s={...n,source_id:`${n.source_id}`,source_type:`${n.source_type}`,node_type:n.node_type||"NEW_MESSAGE",session_id:n.session_id||(o==null?void 0:o.id)},r!=null&&r.lazy?(s.id=tm(),Ce("FlowNode").save(s)):s=await Ce("FlowNode").save(s);else throw new Error("Missing source id and type");let c;const l=e().nodes.find(p=>p.id===s.id);s.source_type&&!l?c=await Ce(s.source_type).findOne({where:{id:n.source_id}}):s.source_type&&l&&(c=(i=l==null?void 0:l.data)==null?void 0:i.entity);const d=e().flowNodes,u=e().nodes,{changes:h}=Or([s],u,{[s.source_type]:[c]});return t({flowNodes:[...d.filter(p=>p.id!==s.id),s],nodes:ht(h,u)}),s}catch(o){_t("Failed to create or update flow node",o,n)}},createOrUpdateFlowEdge:async(n,r)=>{try{const i=La.getState().currentSession;if(!(i!=null&&i.id))throw new Error("Session not found");if(!n.id&&(!n.source||!n.target))throw new Error("Missing flow node indentify");let o,s=n!=null&&n.id?e().flowEdges.find(l=>l.id===n.id):void 0;if(s&&(n.id||n.source&&n.target)&&(s=await Ce("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}})),s)o=Tn(s,Rn(n,In)),r!=null&&r.lazy?Ce("FlowEdge").update(s.id,o):await Ce("FlowEdge").update(s.id,o);else if(n.source&&n.target)o={...n,source:`${n.source}`,target:`${n.target}`,session_id:n.session_id||(i==null?void 0:i.id)},r!=null&&r.lazy?(o.id=tm(),Ce("FlowEdge").save(o)):o=await Ce("FlowEdge").save(o);else throw new Error("Missing source and target");const a=e().flowEdges,c=e().edges;return t({flowEdges:[...a.filter(l=>l.id!==o.id),o],edges:bn(Nr([o],c).changes,c)}),o}catch(i){_t("Failed to create or update flow node",i)}}}),Tf=t=>_.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"none",height:192,viewBox:"0 0 150 150",width:192,...t},_.createElement("clipPath",{id:"a"},_.createElement("path",{d:"m0 0h150v150h-150z"})),_.createElement("g",{clipPath:"url(#a)"},_.createElement("path",{d:"m150 0h-150v150h150z",fill:"#29b5e8"}),_.createElement("path",{clipRule:"evenodd",d:"m130.375 67.2532-14.096 8.1221 14.096 8.0536c.843.4872 1.581 1.1357 2.174 1.9084.592.7727 1.026 1.6545 1.278 2.5951.251.9406.315 1.9215.188 2.8867-.128.9652-.444 1.8959-.931 2.7388-.488.843-1.136 1.5817-1.909 2.174s-1.654 1.0267-2.595 1.2782-1.921.3154-2.887.1878c-.965-.1275-1.896-.444-2.739-.9312l-25.2559-14.5496c-1.1575-.6696-2.1128-1.6394-2.765-2.8068-.6523-1.1674-.9773-2.4893-.9408-3.826.0198-.5792.1089-1.1538.2653-1.7117.517-1.8711 1.7458-3.4654 3.4234-4.4419l25.256-14.4983c.847-.4892 1.782-.8067 2.751-.9343.97-.1275 1.955-.0627 2.899.1909.945.2536 1.83.6909 2.605 1.287.775.596 1.425 1.3391 1.913 2.1866.49.8402.808 1.7693.935 2.7334.128.964.063 1.9439-.191 2.8826-.254.9388-.692 1.8177-1.288 2.5859-.597.7681-1.34 1.4101-2.186 1.8887zm-13.343 39.3698-25.2478-14.5243c-1.1296-.6483-2.4091-.9896-3.7115-.9902s-2.5823.3397-3.7124.987c-1.1301.6472-2.0712 1.579-2.7297 2.7026-.6585 1.1237-1.0115 2.4001-1.0239 3.7024v29.0135c.0654 1.928.8772 3.755 2.264 5.095 1.3869 1.341 3.2403 2.09 5.1691 2.09 1.9289 0 3.7823-.749 5.1691-2.09 1.3868-1.34 2.1986-3.167 2.264-5.095v-16.261l14.1301 8.122c.843.488 1.774.805 2.739.933.966.128 1.947.064 2.888-.187s1.823-.685 2.596-1.277c.774-.592 1.423-1.331 1.91-2.174.488-.843.805-1.773.933-2.739.128-.965.065-1.946-.186-2.887s-.685-1.824-1.277-2.597-1.331-1.422-2.174-1.91zm-29.0992-28.3806-10.527 10.3986c-.3601.3349-.8269.5319-1.318.5563h-3.0897c-.49-.0294-.9551-.2257-1.318-.5563l-10.4671-10.4329c-.3274-.3573-.521-.817-.5478-1.3009v-3.081c.0283-.4861.2215-.9481.5478-1.3095l10.4671-10.4329c.3637-.3281.829-.5214 1.318-.5477h3.0897c.4899.0228.9562.2166 1.318.5477l10.4928 10.4329c.3237.3623.514.8243.5392 1.3095v3.081c-.0237.483-.2143.9428-.5392 1.3009zm-8.3874-2.8928c-.0404-.499-.2485-.9696-.5905-1.3352l-3.0383-3.004c-.3641-.3275-.8291-.5207-1.318-.5478h-.1113c-.4867.0255-.9495.2191-1.3094.5478l-3.0383 3.004c-.3262.3676-.5165.8358-.5392 1.3266v.1113c.0215.4834.2124.9439.5392 1.3009l3.0554 2.9955c.3607.3274.823.5208 1.3094.5477h.1113c.4889-.027.9539-.2203 1.318-.5477l3.0383-3.0212c.3282-.3576.5244-.8166.5563-1.3009zm-47.4914-31.2217 25.2563 14.4811c1.1308.648 2.4115.989 3.7149.9889 1.3033 0 2.584-.3409 3.7148-.989 1.1309-.648 2.0725-1.5806 2.7314-2.7051.659-1.1245 1.0123-2.4018 1.0249-3.7051v-28.9879c-.0654-1.9277-.8772-3.7546-2.264-5.0952s-3.2402-2.0899-5.1691-2.0899c-1.9288 0-3.7822.7493-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v16.2613l-14.1473-8.1307c-.8429-.4877-1.7737-.8047-2.7392-.9328-.9654-.1281-1.9466-.0647-2.8876.1864s-1.8232.6852-2.5965 1.2773c-.7732.5921-1.4222 1.3307-1.91 2.1736-.4878.843-.8048 1.7738-.9329 2.7392-.128.9655-.0647 1.9467.1864 2.8876.2512.941.6852 1.8233 1.2773 2.5965.5921.7733 1.3307 1.4223 2.1737 1.9101zm55.4252 15.4739c1.4914.118 2.9836-.2193 4.2793-.9671l25.2475-14.5496c.843-.4877 1.582-1.1368 2.174-1.91s1.026-1.6555 1.277-2.5965.315-1.9222.187-2.8876c-.128-.9655-.445-1.8962-.933-2.7392-.488-.8429-1.137-1.5816-1.91-2.1737-.774-.5921-1.656-1.0261-2.597-1.2772-1.9-.5072-3.924-.2387-5.627.7464l-14.1298 8.1991v-16.2613c-.0654-1.9277-.8772-3.7546-2.264-5.0952-1.3868-1.3405-3.2402-2.0899-5.1691-2.0899-1.9288 0-3.7822.7494-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v29.0136c-.0023 1.8784.7086 3.6876 1.9892 5.0619 1.2805 1.3743 3.0351 2.2111 4.909 2.3412zm-25.8554 31.5298c-1.4916-.1213-2.9847.2162-4.2793.9671l-25.2905 14.4893c-1.7024.985-2.9438 2.607-3.451 4.507s-.2387 3.924.7465 5.627c.9851 1.702 2.6061 2.943 4.5065 3.451 1.9004.507 3.9244.238 5.6268-.747l14.1473-8.122v16.261c.0654 1.928.8772 3.755 2.2641 5.096 1.3868 1.34 3.2402 2.09 5.169 2.09 1.9289 0 3.7823-.75 5.1691-2.09 1.3868-1.341 2.1986-3.168 2.264-5.096v-29.0645c-.0038-1.869-.7144-3.6673-1.9891-5.0341s-3.0192-2.2009-4.8834-2.3348zm-6.8468-13.5825c.4875-1.6032.414-3.3247-.2083-4.8806-.6224-1.5559-1.7564-2.8532-3.2152-3.6779l-25.2306-14.541c-1.704-.976-3.7248-1.2385-5.6216-.7303-1.8968.5083-3.5155 1.7461-4.5032 3.4433-.4889.84-.8065 1.7686-.9343 2.732-.1278.9635-.0632 1.9428.1899 2.8811.2531.9384.6897 1.8173 1.2846 2.5858.595.7686 1.3364 1.4115 2.1814 1.8917l14.096 8.1221-14.096 8.0536c-.8429.4861-1.5819 1.1334-2.1746 1.9051-.5928.7717-1.0277 1.6526-1.2801 2.5923-.2523.9398-.317 1.9201-.1905 2.8849s.4418 1.8952.9279 2.7382c.4861.8429 1.1335 1.5819 1.9051 2.1746.7717.5928 1.6526 1.0277 2.5924 1.2801.9397.2523 1.92.317 2.8848.1905s1.8952-.4418 2.7382-.9279l25.2306-14.5496c1.6248-.9071 2.8451-2.3965 3.4149-4.168z",fill:"#fff",fillRule:"evenodd"}))),jf=t=>_.createElement("svg",{className:"mr-2 w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:48,height:48,...t},_.createElement("path",{fill:"#fbc02d",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20 s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),_.createElement("path",{fill:"#e53935",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039 l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),_.createElement("path",{fill:"#4caf50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36 c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),_.createElement("path",{fill:"#1565c0",d:"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571 c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})),Rf=t=>_.createElement("svg",{className:"mr-2 w-5 h-5",width:1024,height:1024,viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},_.createElement("path",{d:"M44.522 44.5217H489.739V489.739H44.522V44.5217Z",fill:"#F35325"}),_.createElement("path",{d:"M534.261 44.5217H979.478V489.739H534.261V44.5217Z",fill:"#81BC06"}),_.createElement("path",{d:"M44.522 534.261H489.739V979.478H44.522V534.261Z",fill:"#05A6F0"}),_.createElement("path",{d:"M534.261 534.261H979.478V979.478H534.261V534.261Z",fill:"#FFBA08"})),If=t=>_.createElement("svg",{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 287.56 191",...t},_.createElement("defs",null,_.createElement("style",null,".cls-1{fill:#0081fb;}.cls-2{fill:url(#linear-gradient);}.cls-3{fill:url(#linear-gradient-2);}"),_.createElement("linearGradient",{id:"linear-gradient",x1:62.34,y1:101.45,x2:260.34,y2:91.45,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},_.createElement("stop",{offset:0,stopColor:"#0064e1"}),_.createElement("stop",{offset:.4,stopColor:"#0064e1"}),_.createElement("stop",{offset:.83,stopColor:"#0073ee"}),_.createElement("stop",{offset:1,stopColor:"#0082fb"})),_.createElement("linearGradient",{id:"linear-gradient-2",x1:41.42,y1:53,x2:41.42,y2:126,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},_.createElement("stop",{offset:0,stopColor:"#0082fb"}),_.createElement("stop",{offset:1,stopColor:"#0064e0"}))),_.createElement("title",null,"facebook-meta"),_.createElement("path",{className:"cls-1",d:"M31.06,126c0,11,2.41,19.41,5.56,24.51A19,19,0,0,0,53.19,160c8.1,0,15.51-2,29.79-21.76,11.44-15.83,24.92-38,34-52l15.36-23.6c10.67-16.39,23-34.61,37.18-47C181.07,5.6,193.54,0,206.09,0c21.07,0,41.14,12.21,56.5,35.11,16.81,25.08,25,56.67,25,89.27,0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191V160c17.63,0,22-16.2,22-34.74,0-26.42-6.16-55.74-19.73-76.69-9.63-14.86-22.11-23.94-35.84-23.94-14.85,0-26.8,11.2-40.23,31.17-7.14,10.61-14.47,23.54-22.7,38.13l-9.06,16c-18.2,32.27-22.81,39.62-31.91,51.75C84.74,183,71.12,191,53.19,191c-21.27,0-34.72-9.21-43-23.09C3.34,156.6,0,141.76,0,124.85Z"}),_.createElement("path",{className:"cls-2",d:"M24.49,37.3C38.73,15.35,59.28,0,82.85,0c13.65,0,27.22,4,41.39,15.61,15.5,12.65,32,33.48,52.63,67.81l7.39,12.32c17.84,29.72,28,45,33.93,52.22,7.64,9.26,13,12,19.94,12,17.63,0,22-16.2,22-34.74l27.4-.86c0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191c-12.8,0-24.14-2.78-36.68-14.61-9.64-9.08-20.91-25.21-29.58-39.71L146.08,93.6c-12.94-21.62-24.81-37.74-31.68-45C107,40.71,97.51,31.23,82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78Z"}),_.createElement("path",{className:"cls-3",d:"M82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78C38.61,71.62,31.06,99.34,31.06,126c0,11,2.41,19.41,5.56,24.51L10.14,167.91C3.34,156.6,0,141.76,0,124.85,0,94.1,8.44,62.05,24.49,37.3,38.73,15.35,59.28,0,82.85,0Z"})),Bf=t=>_.createElement("svg",{className:"mr-2 w-5 h-5",width:256,height:233,viewBox:"0 0 256 233",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},_.createElement("path",{d:"M186.182 0h46.545v46.545h-46.545z"}),_.createElement("path",{fill:"#f7d046",d:"M209.455 0H256v46.545h-46.545z"}),_.createElement("path",{d:"M0 0h46.545v46.545H0zm0 46.545h46.545V93.09H0zm0 46.546h46.545v46.545H0zm0 46.545h46.545v46.545H0zm0 46.546h46.545v46.545H0z"}),_.createElement("path",{fill:"#f7d046",d:"M23.273 0h46.545v46.545H23.273z"}),_.createElement("path",{fill:"#f2a73b",d:"M209.455 46.545H256V93.09h-46.545zm-186.182 0h46.545V93.09H23.273z"}),_.createElement("path",{d:"M139.636 46.545h46.545V93.09h-46.545z"}),_.createElement("path",{fill:"#f2a73b",d:"M162.909 46.545h46.545V93.09h-46.545zm-93.091 0h46.545V93.09H69.818z"}),_.createElement("path",{fill:"#ee792f",d:"M116.364 93.091h46.545v46.545h-46.545zm46.545 0h46.545v46.545h-46.545zm-93.091 0h46.545v46.545H69.818z"}),_.createElement("path",{d:"M93.091 139.636h46.545v46.545H93.091z"}),_.createElement("path",{fill:"#eb5829",d:"M116.364 139.636h46.545v46.545h-46.545z"}),_.createElement("path",{fill:"#ee792f",d:"M209.455 93.091H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"}),_.createElement("path",{d:"M186.182 139.636h46.545v46.545h-46.545z"}),_.createElement("path",{fill:"#eb5829",d:"M209.455 139.636H256v46.545h-46.545z"}),_.createElement("path",{d:"M186.182 186.182h46.545v46.545h-46.545z"}),_.createElement("path",{fill:"#eb5829",d:"M23.273 139.636h46.545v46.545H23.273z"}),_.createElement("path",{fill:"#ea3326",d:"M209.455 186.182H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"})),$f="/NoLLMChat/assets/qwen-B-gSh3_v.webp",Df="/NoLLMChat/assets/smollm-CikBjd4F.png",Lf="/NoLLMChat/assets/stablelm-BquePdQ7.png",Ff="/NoLLMChat/assets/nomic-BjJqoFji.webp",zf="/NoLLMChat/assets/joshua-ByaReJuI.webp",pm=_.memo(({name:t,className:e,...n})=>(t=t.toLowerCase(),t.includes("gemma")?S.jsx(jf,{className:Se("w-5 h-5",e),...n}):t!=null&&t.includes("qwen")?S.jsx("img",{className:Se("w-5 h-5",e),src:$f,alt:"qwen",...n}):t!=null&&t.includes("phi")?S.jsx(Rf,{className:Se("w-5 h-5",e),...n}):t!=null&&t.includes("llama")?S.jsx(If,{className:Se("w-5 h-5",e),...n}):t!=null&&t.includes("smollm")?S.jsx("img",{className:Se("w-5 h-5",e),src:Df,alt:"smollm",...n}):t!=null&&t.includes("mistral")?S.jsx(Bf,{className:Se("w-5 h-5",e),...n}):t!=null&&t.includes("snowflake")?S.jsx(Tf,{className:Se("w-5 h-5 rounded-full",e),...n}):t!=null&&t.includes("stablelm")?S.jsx("img",{className:Se("w-5 h-5 rounded-full",e),src:Lf,alt:"stablelm",...n}):t!=null&&t.includes("nomic")?S.jsx("img",{className:Se("w-5 h-5 rounded-full",e),src:Ff,alt:"nomic",...n}):t!=null&&t.includes("Xenova")||t!=null&&t.includes("janus")?S.jsx("img",{className:Se("w-5 h-5 rounded-full",e),src:zf,alt:"Xenova",...n}):S.jsx(kr,{className:Se("w-5 h-5",e),name:"brain"}))),wc=lu(),im=Yt(wc),Ga=["Qwen2.5-1.5B-Instruct-q4f32_1-MLC","Qwen2.5-Coder-1.5B-Instruct-q4f16_1-MLC","stablelm-2-zephyr-1_6b-q4f16_1-MLC-1k","Phi-3.5-mini-instruct-q4f16_1-MLC-1k","Llama-3.2-3B-Instruct-q4f32_1-MLC"],fm=_.memo(t=>{var a;const{name:e,model:n,isCached:r,isFunctionCalling:i}=t,{t:o}=fE("atoms"),s=_.useCallback(c=>c===1?"llm_info.model_types.embedding":c===2?"llm_info.model_types.vlm":"llm_info.model_types.llm",[]);if(n)return S.jsxs(S.Fragment,{children:[S.jsx(Ct,{className:"",children:o(s(n.model_type))}),Ga.some(c=>e&&c.includes(e))?S.jsx(Ct,{className:"",variant:"outline",children:o("llm_info.recommended")}):null,r?S.jsx(Ct,{className:"",variant:"outline",children:o("llm_info.cached")}):null,i?S.jsx(Ct,{className:"",variant:"outline",children:o("llm_info.function_calling")}):null,n!=null&&n.low_resource_required?S.jsx(Ct,{className:"",variant:"outline",children:o("llm_info.low_resource_required")}):null,(a=n==null?void 0:n.overrides)!=null&&a.context_window_size?S.jsxs(Ct,{className:"",variant:"outline",children:[n.overrides.context_window_size.toLocaleString("en-US")," Tokens"]}):null,n!=null&&n.vram_required_MB?S.jsxs(Ct,{className:"",variant:"outline",children:["VRAM: ",n.vram_required_MB.toLocaleString("en-US")," MB"]}):null]})}),$r=_.forwardRef(({className:t,...e},n)=>S.jsx("textarea",{className:Se("flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...e})),$r.displayName="Textarea";let Vf;Vf=mE("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Va=_.forwardRef(({className:t,variant:e,...n},r)=>S.jsx("div",{ref:r,role:"alert",className:Se(Vf({variant:e}),t),...n})),Va.displayName="Alert",xc=_.forwardRef(({className:t,...e},n)=>S.jsx("h5",{ref:n,className:Se("mb-1 font-medium leading-none tracking-tight",t),...e})),xc.displayName="AlertTitle",bc=_.forwardRef(({className:t,...e},n)=>S.jsx("div",{ref:n,className:Se("text-sm [&_p]:leading-relaxed",t),...e})),bc.displayName="AlertDescription";function cM({minHeight:t,maxHeight:e}){const n=_.useRef(null),r=_.useCallback(i=>{const o=n.current;if(!o)return;if(i){o.style.height=`${t}px`;return}o.style.height=`${t}px`;const s=Math.max(t,Math.min(o.scrollHeight,e??Number.POSITIVE_INFINITY));o.style.height=`${s}px`},[t,e]);return _.useEffect(()=>{const i=n.current;i&&(i.style.height=`${t}px`)},[t]),_.useEffect(()=>{const i=()=>r();return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[r]),{textareaRef:n,adjustHeight:r}}const lM=48,qf=164;gm=function({onSubmit:t,disabled:e,enableTool:n,enableFile:r,placeholder:i,minHeight:o,maxHeight:s,className:a,onChange:c,value:l}){const[d,u]=_.useState(!1),[h,p]=_.useState(""),{textareaRef:m,adjustHeight:f}=cM({minHeight:o||lM,maxHeight:s||qf}),[g,y]=_.useState(!0),x=async v=>{try{u(!0),await t(h,v)}finally{u(!1)}};return S.jsx("div",{className:Se("w-full py-4 max-w-xl",a),children:S.jsx("div",{className:"relative w-full mx-auto",children:S.jsxs("div",{className:"relative flex flex-col",children:[S.jsx("div",{className:"overflow-y-auto",style:{maxHeight:`${s||qf}px`},children:S.jsx($r,{id:"ai-input-04",value:(c?l:h)||"",disabled:e||d,placeholder:i,className:"w-full rounded-xl rounded-b-none px-4 py-3 bg-black/5 dark:bg-white/5 border-none dark:text-white placeholder:text-black/70 dark:placeholder:text-white/70 resize-none focus-visible:ring-0 leading-[1.2]",ref:m,onKeyDown:v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),x(v))},onChange:v=>{c||p(v.target.value),f(),c==null||c(v)}})}),S.jsxs("div",{className:"h-12 bg-black/5 dark:bg-white/5 rounded-b-xl",children:[S.jsxs("div",{className:"absolute left-3 bottom-3 flex items-center gap-2",children:[r?S.jsxs("label",{className:"cursor-pointer rounded-lg p-2 bg-black/5 dark:bg-white/5",children:[S.jsx("input",{type:"file",className:"hidden"}),S.jsx(kr,{name:"paperclip",className:"w-4 h-4 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors"})]}):void 0,n?S.jsxs("button",{type:"button",onClick:()=>{y(!g)},className:Se("rounded-full transition-all flex items-center gap-2 px-1.5 py-1 border h-8",g?"bg-sky-500/15 border-sky-400 text-sky-500":"bg-black/5 dark:bg-white/5 border-transparent text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:[S.jsx("div",{className:"w-4 h-4 flex items-center justify-center flex-shrink-0",children:S.jsx(nm.div,{animate:{rotate:g?180:0,scale:g?1.1:1},whileHover:{rotate:g?180:15,scale:1.1,transition:{type:"spring",stiffness:300,damping:10}},transition:{type:"spring",stiffness:260,damping:25},children:S.jsx(kr,{name:"globe",className:Se("w-4 h-4",g?"text-sky-500":"text-inherit")})})}),S.jsx(_m,{children:g&&S.jsx(nm.span,{initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"text-sm overflow-hidden whitespace-nowrap text-sky-500 flex-shrink-0",children:"Search"})})]}):void 0]}),S.jsx("div",{className:"absolute right-3 bottom-3",children:S.jsx("button",{type:"button",disabled:e||d,onClick:v=>{x(v)},className:Se("rounded-lg p-2",c&&l||h?"bg-sky-500/15 text-sky-500":"bg-black/5 dark:bg-white/5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:S.jsx(kr,{name:"send",className:"w-4 h-4"})})})]})]})})})};var uM=Object.prototype.toString,Ht=Array.isArray||function(t){return uM.call(t)==="[object Array]"};function Ta(t){return typeof t=="function"}function dM(t){return Ht(t)?"array":typeof t}function ja(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Wf(t,e){return t!=null&&typeof t=="object"&&e in t}function hM(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var pM=RegExp.prototype.test;function fM(t,e){return pM.call(t,e)}var mM=/\S/;function yM(t){return!fM(mM,t)}var gM={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function vM(t){return String(t).replace(/[&<>"'`=\/]/g,function(e){return gM[e]})}var xM=/\s*/,bM=/\s+/,Hf=/\s*=/,wM=/\s*\}/,MM=/#|\^|\/|>|\{|&|=|!/;function EM(t,e){if(!t)return[];var n=!1,r=[],i=[],o=[],s=!1,a=!1,c="",l=0;function d(){if(s&&!a)for(;o.length;)delete i[o.pop()];else o=[];s=!1,a=!1}var u,h,p;function m(A){if(typeof A=="string"&&(A=A.split(bM,2)),!Ht(A)||A.length!==2)throw new Error("Invalid tags: "+A);u=new RegExp(ja(A[0])+"\\s*"),h=new RegExp("\\s*"+ja(A[1])),p=new RegExp("\\s*"+ja("}"+A[1]))}m(e||$e.tags);for(var f=new _n(t),g,y,x,v,b,M;!f.eos();){if(g=f.pos,x=f.scanUntil(u),x)for(var C=0,E=x.length;C<E;++C)v=x.charAt(C),yM(v)?(o.push(i.length),c+=v):(a=!0,n=!0,c+=" "),i.push(["text",v,g,g+1]),g+=1,v===`
`&&(d(),c="",l=0,n=!1);if(!f.scan(u))break;if(s=!0,y=f.scan(MM)||"name",f.scan(xM),y==="="?(x=f.scanUntil(Hf),f.scan(Hf),f.scanUntil(h)):y==="{"?(x=f.scanUntil(p),f.scan(wM),f.scanUntil(h),y="&"):x=f.scanUntil(h),!f.scan(h))throw new Error("Unclosed tag at "+f.pos);if(y==">"?b=[y,x,g,f.pos,c,l,n]:b=[y,x,g,f.pos],l++,i.push(b),y==="#"||y==="^")r.push(b);else if(y==="/"){if(M=r.pop(),!M)throw new Error('Unopened section "'+x+'" at '+g);if(M[1]!==x)throw new Error('Unclosed section "'+M[1]+'" at '+g)}else y==="name"||y==="{"||y==="&"?a=!0:y==="="&&m(x)}if(d(),M=r.pop(),M)throw new Error('Unclosed section "'+M[1]+'" at '+f.pos);return CM(_M(i))}function _M(t){for(var e=[],n,r,i=0,o=t.length;i<o;++i)n=t[i],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(e.push(n),r=n));return e}function CM(t){for(var e=[],n=e,r=[],i,o,s=0,a=t.length;s<a;++s)switch(i=t[s],i[0]){case"#":case"^":n.push(i),r.push(i),n=i[4]=[];break;case"/":o=r.pop(),o[5]=i[2],n=r.length>0?r[r.length-1][4]:e;break;default:n.push(i)}return e}function _n(t){this.string=t,this.tail=t,this.pos=0}_n.prototype.eos=function(){return this.tail===""},_n.prototype.scan=function(t){var e=this.tail.match(t);if(!e||e.index!==0)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},_n.prototype.scanUntil=function(t){var e=this.tail.search(t),n;switch(e){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,e),this.tail=this.tail.substring(e)}return this.pos+=n.length,n};function Ut(t,e){this.view=t,this.cache={".":this.view},this.parent=e}Ut.prototype.push=function(t){return new Ut(t,this)},Ut.prototype.lookup=function(t){var e=this.cache,n;if(e.hasOwnProperty(t))n=e[t];else{for(var r=this,i,o,s,a=!1;r;){if(t.indexOf(".")>0)for(i=r.view,o=t.split("."),s=0;i!=null&&s<o.length;)s===o.length-1&&(a=Wf(i,o[s])||hM(i,o[s])),i=i[o[s++]];else i=r.view[t],a=Wf(r.view,t);if(a){n=i;break}r=r.parent}e[t]=n}return Ta(n)&&(n=n.call(this.view)),n};function ke(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}ke.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()},ke.prototype.parse=function(t,e){var n=this.templateCache,r=t+":"+(e||$e.tags).join(":"),i=typeof n<"u",o=i?n.get(r):void 0;return o==null&&(o=EM(t,e),i&&n.set(r,o)),o},ke.prototype.render=function(t,e,n,r){var i=this.getConfigTags(r),o=this.parse(t,i),s=e instanceof Ut?e:new Ut(e,void 0);return this.renderTokens(o,s,n,t,r)},ke.prototype.renderTokens=function(t,e,n,r,i){for(var o="",s,a,c,l=0,d=t.length;l<d;++l)c=void 0,s=t[l],a=s[0],a==="#"?c=this.renderSection(s,e,n,r,i):a==="^"?c=this.renderInverted(s,e,n,r,i):a===">"?c=this.renderPartial(s,e,n,i):a==="&"?c=this.unescapedValue(s,e):a==="name"?c=this.escapedValue(s,e,i):a==="text"&&(c=this.rawValue(s)),c!==void 0&&(o+=c);return o},ke.prototype.renderSection=function(t,e,n,r,i){var o=this,s="",a=e.lookup(t[1]);function c(u){return o.render(u,e,n,i)}if(a){if(Ht(a))for(var l=0,d=a.length;l<d;++l)s+=this.renderTokens(t[4],e.push(a[l]),n,r,i);else if(typeof a=="object"||typeof a=="string"||typeof a=="number")s+=this.renderTokens(t[4],e.push(a),n,r,i);else if(Ta(a)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");a=a.call(e.view,r.slice(t[3],t[5]),c),a!=null&&(s+=a)}else s+=this.renderTokens(t[4],e,n,r,i);return s}},ke.prototype.renderInverted=function(t,e,n,r,i){var o=e.lookup(t[1]);if(!o||Ht(o)&&o.length===0)return this.renderTokens(t[4],e,n,r,i)},ke.prototype.indentPartial=function(t,e,n){for(var r=e.replace(/[^ \t]/g,""),i=t.split(`
`),o=0;o<i.length;o++)i[o].length&&(o>0||!n)&&(i[o]=r+i[o]);return i.join(`
`)},ke.prototype.renderPartial=function(t,e,n,r){if(n){var i=this.getConfigTags(r),o=Ta(n)?n(t[1]):n[t[1]];if(o!=null){var s=t[6],a=t[5],c=t[4],l=o;a==0&&c&&(l=this.indentPartial(o,c,s));var d=this.parse(l,i);return this.renderTokens(d,e,n,l,r)}}},ke.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(n!=null)return n},ke.prototype.escapedValue=function(t,e,n){var r=this.getConfigEscape(n)||$e.escape,i=e.lookup(t[1]);if(i!=null)return typeof i=="number"&&r===$e.escape?String(i):r(i)},ke.prototype.rawValue=function(t){return t[1]},ke.prototype.getConfigTags=function(t){return Ht(t)?t:t&&typeof t=="object"?t.tags:void 0},ke.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!Ht(t))return t.escape};let Qt;$e={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){Qt.templateCache=t},get templateCache(){return Qt.templateCache}},Qt=new ke,$e.clearCache=function(){return Qt.clearCache()},$e.parse=function(t,e){return Qt.parse(t,e)},$e.render=function(t,e,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+dM(t)+'" was given as the first argument for mustache#render(template, view, partials)');return Qt.render(t,e,n,r)},$e.escape=vM,$e.Scanner=_n,$e.Context=Ut,$e.Writer=ke;let Uf;Uf=async(t,e)=>{let n="",r="",i;const o=[];await t;for await(const s of t)s&&(Array.isArray(s)?(o.push(...s.map(a=>a.content)),o!=null&&o.length&&(r=o.join(""),e==null||e({chunk:s,content:r}))):(n=typeof s=="object"&&"content"in s?`${s.content}`:`${s}`,e==null||e({chunk:s,content:n})),i=s);return{lastChunk:i,content:n}},vm=()=>{const t=Fa(r=>r.toolsCallingStream),e=Fa(r=>r.structuredStream),n=Fa(r=>r.stream);return{stream:_.useCallback(async(r,{tools:i,schemas:o,onMessageUpdate:s,onMessageFinish:a})=>{var u,h,p,m;o&&(o==null?void 0:o.length)>1&&_t("Multiple schemas are not supported");let c;if(o!=null&&o.length){const f=(p=(h=(u=o==null?void 0:o[0])==null?void 0:u.node)==null?void 0:h.data)==null?void 0:p.entity;if(!((m=f==null?void 0:f.schema_items)!=null&&m.length))throw new Error("Schema is not found");c=e(f.schema_items,r)}else i!=null&&i.length?c=t(i.reduce((f,g)=>{var v,b,M,C,E;const y=(v=g.node.data)==null?void 0:v.entity,x=(C=(M=(b=g==null?void 0:g.connectedNodes)==null?void 0:b.find(A=>A.type===Ne.Schema))==null?void 0:M.data)==null?void 0:C.entity;return y&&((E=x==null?void 0:x.schema_items)!=null&&E.length)&&f.push({name:y.name,description:y.description,schemaItems:x.schema_items}),f},[]),r):c=n(r);if(!c)throw new Error("Stream is not supported");const{lastChunk:l,content:d}=await Uf(c,s);return a==null||a({content:d,lastChunk:l}),{lastChunk:l,content:d}},[n,e,t])}}});export{za as $,Va as A,St as B,Tr as C,Ot as D,qa as E,Wa as F,Ha as G,Gt as H,jr as I,Ua as J,Qa as K,Ya as L,Za as M,Rr as N,Xt as O,re as P,Ir as Q,Ga as R,Br as S,$r as T,Dr as U,Lr as V,On as W,Fr as X,Nn as Y,Xa as Z,Ka as _,vE as __tla,Nt as a,Pn as a0,An as a1,We as a2,zr as a3,Ja as a4,ec as a5,tc as a6,nc as a7,rm as a8,kn as a9,rc as aA,Vr as aB,Kt as aC,Pt as aD,qr as aE,ic as aF,oc as aG,sc as aH,im as aI,de as aa,ye as ab,om as ac,sm as ad,Jt as ae,am as af,Tn as ag,ht as ah,cm as ai,pt as aj,lm as ak,st as al,um as am,dm as an,ac as ao,Wr as ap,cc as aq,lc as ar,Hr as as,uc as at,dc as au,Ur as av,hc as aw,pc as ax,Qr as ay,fc as az,Yr as b,Zr as c,mc as d,yc as e,gc as f,hm as g,vc as h,Xe as i,pm as j,fm as k,jn as l,mm as m,ym as n,xc as o,bc as p,gm as q,$e as r,wc as s,vm as t,xm as u,Rn as v,In as w,Mc as x,At as y,Ke as z};
