import{r as M,M as wO,j as E,G as af,au as MO,I as EO,av as CO,al as Ze,a1 as _O,m as SO,aw as an,ax as OO,ay as NO,az as cf,aA as lf,Y as Ne,aB as AO,y as _e,a4 as St,s as gs,as as uf,g as Se,L as ci,p as PO,h as kO,q as df,$ as xs,__tla as TO}from"./index-BL-fuuU1.js";import{W as Ot,__tla as jO}from"./routes-XM45Th12.js";let vs,bs,hf,pf,ws,Ms,Es,Cs,cn,li,_s,Ss,Os,ui,ln,di,re,hi,Ns,pi,fi,mi,Qn,yi,Zn,As,Ps,Nt,At,Yn,Xn,ut,qe,gi,ks,Ts,js,ff,mf,xi,Rs,Is,un,Pt,Gn,vi,$s,Bs,Ls,yf,Kn,ue,ye,gf,xf,dn,vf,Jn,dt,bf,ht,wf,it,Mf,Ef,Ds,bi,Fs,zs,wi,Vs,qs,Mi,Ws,Hs,Ei,Ci,_i,Us,Qs,Zs,Cf,Ys,Ye,_f,Sf,er,Of,Nf,Xs,Gs,Af,Be,Si,Pf,kf,tr,nr,Xe,kt,Tf,RO=Promise.all([(()=>{try{return TO}catch{}})(),(()=>{try{return jO}catch{}})()]).then(async()=>{Os=(t=>(t.Started="started",t.Downloading="downloading",t.Downloaded="downloaded",t.Loading="loading",t.Loaded="loaded",t))(Os||{}),Ys=(t=>(t.LLM="LLM",t.embedding="embedding",t.VLM="VLM",t))(Ys||{}),Zs=(t=>(t.WebLLM="WebLLM",t.OpenAI="OpenAI",t))(Zs||{}),Es=(t=>(t.VECTOR_DATABASE_RETREIVER="VECTOR_DATABASE_RETREIVER",t))(Es||{});class jf extends M.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Rf({children:t,isPresent:e}){const n=M.useId(),r=M.useRef(null),i=M.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=M.useContext(wO);return M.useInsertionEffect(()=>{const{width:s,height:a,top:c,left:l}=i.current;if(e||!r.current||!s||!a)return;r.current.dataset.motionPopId=n;const u=document.createElement("style");return o&&(u.nonce=o),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${s}px !important;
            height: ${a}px !important;
            top: ${c}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[e]),E.jsx(jf,{isPresent:e,childRef:r,sizeRef:i,children:M.cloneElement(t,{ref:r})})}const If=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:o,mode:s})=>{const a=af($f),c=M.useId(),l=M.useCallback(d=>{a.set(d,!0);for(const h of a.values())if(!h)return;r&&r()},[a,r]),u=M.useMemo(()=>({id:c,initial:e,isPresent:n,custom:i,onExitComplete:l,register:d=>(a.set(d,!1),()=>a.delete(d))}),o?[Math.random(),l]:[n,l]);return M.useMemo(()=>{a.forEach((d,h)=>a.set(h,!1))},[n]),M.useEffect(()=>{!n&&!a.size&&r&&r()},[n]),s==="popLayout"&&(t=E.jsx(Rf,{isPresent:n,children:t})),E.jsx(MO.Provider,{value:u,children:t})};function $f(){return new Map}const rr=t=>t.key||"";function Ks(t){const e=[];return M.Children.forEach(t,n=>{M.isValidElement(n)&&e.push(n)}),e}const Bf=({children:t,exitBeforeEnter:e,custom:n,initial:r=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:s="sync"})=>{const a=M.useMemo(()=>Ks(t),[t]),c=a.map(rr),l=M.useRef(!0),u=M.useRef(a),d=af(()=>new Map),[h,p]=M.useState(a),[f,m]=M.useState(a);EO(()=>{l.current=!1,u.current=a;for(let b=0;b<f.length;b++){const x=rr(f[b]);c.includes(x)?d.delete(x):d.get(x)!==!0&&d.set(x,!1)}},[f,c.length,c.join("-")]);const y=[];if(a!==h){let b=[...a];for(let x=0;x<f.length;x++){const v=f[x],C=rr(v);c.includes(C)||(b.splice(x,0,v),y.push(v))}s==="wait"&&y.length&&(b=y),m(Ks(b)),p(a);return}const{forceRender:g}=M.useContext(CO);return E.jsx(E.Fragment,{children:f.map(b=>{const x=rr(b),v=a===f||c.includes(x),C=()=>{if(d.has(x))d.set(x,!0);else return;let T=!0;d.forEach(S=>{S||(T=!1)}),T&&(g==null||g(),m(u.current),i&&i())};return E.jsx(If,{isPresent:v,initial:!l.current||r?void 0:!1,custom:v?void 0:n,presenceAffectsLayout:o,mode:s,onExitComplete:v?void 0:C,children:b},x)})})};function Me(t){if(typeof t=="string"||typeof t=="number")return""+t;let e="";if(Array.isArray(t))for(let n=0,r;n<t.length;n++)(r=Me(t[n]))!==""&&(e+=(e&&" ")+r);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}var Lf={value:()=>{}};function ir(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new or(n)}function or(t){this._=t}function Df(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}or.prototype=ir.prototype={constructor:or,on:function(t,e){var n=this._,r=Df(t+"",n),i,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((i=(t=r[o]).type)&&(i=Ff(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(t=r[o]).type)n[i]=Js(n[i],t.name,e);else if(e==null)for(i in n)n[i]=Js(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new or(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function Ff(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function Js(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Lf,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Oi="http://www.w3.org/1999/xhtml";const ea={svg:"http://www.w3.org/2000/svg",xhtml:Oi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function sr(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),ea.hasOwnProperty(e)?{space:ea[e],local:t}:t}function zf(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Oi&&e.documentElement.namespaceURI===Oi?e.createElement(t):e.createElementNS(n,t)}}function Vf(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function ta(t){var e=sr(t);return(e.local?Vf:zf)(e)}function qf(){}function Ni(t){return t==null?qf:function(){return this.querySelector(t)}}function Wf(t){typeof t!="function"&&(t=Ni(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=new Array(s),c,l,u=0;u<s;++u)(c=o[u])&&(l=t.call(c,c.__data__,u,o))&&("__data__"in c&&(l.__data__=c.__data__),a[u]=l);return new Re(r,this._parents)}function Hf(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Uf(){return[]}function na(t){return t==null?Uf:function(){return this.querySelectorAll(t)}}function Qf(t){return function(){return Hf(t.apply(this,arguments))}}function Zf(t){typeof t=="function"?t=Qf(t):t=na(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var s=e[o],a=s.length,c,l=0;l<a;++l)(c=s[l])&&(r.push(t.call(c,c.__data__,l,s)),i.push(c));return new Re(r,i)}function ra(t){return function(){return this.matches(t)}}function ia(t){return function(e){return e.matches(t)}}var Yf=Array.prototype.find;function Xf(t){return function(){return Yf.call(this.children,t)}}function Gf(){return this.firstElementChild}function Kf(t){return this.select(t==null?Gf:Xf(typeof t=="function"?t:ia(t)))}var Jf=Array.prototype.filter;function em(){return Array.from(this.children)}function tm(t){return function(){return Jf.call(this.children,t)}}function nm(t){return this.selectAll(t==null?em:tm(typeof t=="function"?t:ia(t)))}function rm(t){typeof t!="function"&&(t=ra(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],c,l=0;l<s;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&a.push(c);return new Re(r,this._parents)}function oa(t){return new Array(t.length)}function im(){return new Re(this._enter||this._groups.map(oa),this._parents)}function ar(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ar.prototype={constructor:ar,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function om(t){return function(){return t}}function sm(t,e,n,r,i,o){for(var s=0,a,c=e.length,l=o.length;s<l;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new ar(t,o[s]);for(;s<c;++s)(a=e[s])&&(i[s]=a)}function am(t,e,n,r,i,o,s){var a,c,l=new Map,u=e.length,d=o.length,h=new Array(u),p;for(a=0;a<u;++a)(c=e[a])&&(h[a]=p=s.call(c,c.__data__,a,e)+"",l.has(p)?i[a]=c:l.set(p,c));for(a=0;a<d;++a)p=s.call(t,o[a],a,o)+"",(c=l.get(p))?(r[a]=c,c.__data__=o[a],l.delete(p)):n[a]=new ar(t,o[a]);for(a=0;a<u;++a)(c=e[a])&&l.get(h[a])===c&&(i[a]=c)}function cm(t){return t.__data__}function lm(t,e){if(!arguments.length)return Array.from(this,cm);var n=e?am:sm,r=this._parents,i=this._groups;typeof t!="function"&&(t=om(t));for(var o=i.length,s=new Array(o),a=new Array(o),c=new Array(o),l=0;l<o;++l){var u=r[l],d=i[l],h=d.length,p=um(t.call(u,u&&u.__data__,l,r)),f=p.length,m=a[l]=new Array(f),y=s[l]=new Array(f),g=c[l]=new Array(h);n(u,d,m,y,g,p,e);for(var b=0,x=0,v,C;b<f;++b)if(v=m[b]){for(b>=x&&(x=b+1);!(C=y[x])&&++x<f;);v._next=C||null}}return s=new Re(s,r),s._enter=a,s._exit=c,s}function um(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function dm(){return new Re(this._exit||this._groups.map(oa),this._parents)}function hm(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function pm(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),c=0;c<s;++c)for(var l=n[c],u=r[c],d=l.length,h=a[c]=new Array(d),p,f=0;f<d;++f)(p=l[f]||u[f])&&(h[f]=p);for(;c<i;++c)a[c]=n[c];return new Re(a,this._parents)}function fm(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],s;--i>=0;)(s=r[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function mm(t){t||(t=ym);function e(d,h){return d&&h?t(d.__data__,h.__data__):!d-!h}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s=n[o],a=s.length,c=i[o]=new Array(a),l,u=0;u<a;++u)(l=s[u])&&(c[u]=l);c.sort(e)}return new Re(i,this._parents).order()}function ym(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function gm(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function xm(){return Array.from(this)}function vm(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null}function bm(){let t=0;for(const e of this)++t;return t}function wm(){return!this.node()}function Mm(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,s=i.length,a;o<s;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this}function Em(t){return function(){this.removeAttribute(t)}}function Cm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function _m(t,e){return function(){this.setAttribute(t,e)}}function Sm(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Om(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Nm(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Am(t,e){var n=sr(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Cm:Em:typeof e=="function"?n.local?Nm:Om:n.local?Sm:_m)(n,e))}function sa(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Pm(t){return function(){this.style.removeProperty(t)}}function km(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Tm(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function jm(t,e,n){return arguments.length>1?this.each((e==null?Pm:typeof e=="function"?Tm:km)(t,e,n??"")):Tt(this.node(),t)}function Tt(t,e){return t.style.getPropertyValue(e)||sa(t).getComputedStyle(t,null).getPropertyValue(e)}function Rm(t){return function(){delete this[t]}}function Im(t,e){return function(){this[t]=e}}function $m(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Bm(t,e){return arguments.length>1?this.each((e==null?Rm:typeof e=="function"?$m:Im)(t,e)):this.node()[t]}function aa(t){return t.trim().split(/^|\s+/)}function Ai(t){return t.classList||new ca(t)}function ca(t){this._node=t,this._names=aa(t.getAttribute("class")||"")}ca.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function la(t,e){for(var n=Ai(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function ua(t,e){for(var n=Ai(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Lm(t){return function(){la(this,t)}}function Dm(t){return function(){ua(this,t)}}function Fm(t,e){return function(){(e.apply(this,arguments)?la:ua)(this,t)}}function zm(t,e){var n=aa(t+"");if(arguments.length<2){for(var r=Ai(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Fm:e?Lm:Dm)(n,e))}function Vm(){this.textContent=""}function qm(t){return function(){this.textContent=t}}function Wm(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Hm(t){return arguments.length?this.each(t==null?Vm:(typeof t=="function"?Wm:qm)(t)):this.node().textContent}function Um(){this.innerHTML=""}function Qm(t){return function(){this.innerHTML=t}}function Zm(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Ym(t){return arguments.length?this.each(t==null?Um:(typeof t=="function"?Zm:Qm)(t)):this.node().innerHTML}function Xm(){this.nextSibling&&this.parentNode.appendChild(this)}function Gm(){return this.each(Xm)}function Km(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Jm(){return this.each(Km)}function ey(t){var e=typeof t=="function"?t:ta(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function ty(){return null}function ny(t,e){var n=typeof t=="function"?t:ta(t),r=e==null?ty:typeof e=="function"?e:Ni(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ry(){var t=this.parentNode;t&&t.removeChild(this)}function iy(){return this.each(ry)}function oy(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function sy(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ay(t){return this.select(t?sy:oy)}function cy(t){return arguments.length?this.property("__data__",t):this.node().__data__}function ly(t){return function(e){t.call(this,e,this.__data__)}}function uy(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function dy(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function hy(t,e,n){return function(){var r=this.__on,i,o=ly(e);if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function py(t,e,n){var r=uy(t+""),i,o=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,u;c<l;++c)for(i=0,u=a[c];i<o;++i)if((s=r[i]).type===u.type&&s.name===u.name)return u.value}return}for(a=e?hy:dy,i=0;i<o;++i)this.each(a(r[i],e,n));return this}function da(t,e,n){var r=sa(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function fy(t,e){return function(){return da(this,t,e)}}function my(t,e){return function(){return da(this,t,e.apply(this,arguments))}}function yy(t,e){return this.each((typeof e=="function"?my:fy)(t,e))}function*gy(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,s;i<o;++i)(s=r[i])&&(yield s)}var ha=[null];function Re(t,e){this._groups=t,this._parents=e}function hn(){return new Re([[document.documentElement]],ha)}function xy(){return this}Re.prototype=hn.prototype={constructor:Re,select:Wf,selectAll:Zf,selectChild:Kf,selectChildren:nm,filter:rm,data:lm,enter:im,exit:dm,join:hm,merge:pm,selection:xy,order:fm,sort:mm,call:gm,nodes:xm,node:vm,size:bm,empty:wm,each:Mm,attr:Am,style:jm,property:Bm,classed:zm,text:Hm,html:Ym,raise:Gm,lower:Jm,append:ey,insert:ny,remove:iy,clone:ay,datum:cy,on:py,dispatch:yy,[Symbol.iterator]:gy};function Ie(t){return typeof t=="string"?new Re([[document.querySelector(t)]],[document.documentElement]):new Re([[t]],ha)}function vy(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Le(t,e){if(t=vy(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const by={passive:!1},pn={capture:!0,passive:!1};function Pi(t){t.stopImmediatePropagation()}function jt(t){t.preventDefault(),t.stopImmediatePropagation()}function pa(t){var e=t.document.documentElement,n=Ie(t).on("dragstart.drag",jt,pn);"onselectstart"in e?n.on("selectstart.drag",jt,pn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function fa(t,e){var n=t.document.documentElement,r=Ie(t).on("dragstart.drag",null);e&&(r.on("click.drag",jt,pn),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const cr=t=>()=>t;function ki(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:s,y:a,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}ki.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function wy(t){return!t.ctrlKey&&!t.button}function My(){return this.parentNode}function Ey(t,e){return e??{x:t.x,y:t.y}}function Cy(){return navigator.maxTouchPoints||"ontouchstart"in this}function ma(){var t=wy,e=My,n=Ey,r=Cy,i={},o=ir("start","drag","end"),s=0,a,c,l,u,d=0;function h(v){v.on("mousedown.drag",p).filter(r).on("touchstart.drag",y).on("touchmove.drag",g,by).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(v,C){if(!(u||!t.call(this,v,C))){var T=x(this,e.call(this,v,C),v,C,"mouse");T&&(Ie(v.view).on("mousemove.drag",f,pn).on("mouseup.drag",m,pn),pa(v.view),Pi(v),l=!1,a=v.clientX,c=v.clientY,T("start",v))}}function f(v){if(jt(v),!l){var C=v.clientX-a,T=v.clientY-c;l=C*C+T*T>d}i.mouse("drag",v)}function m(v){Ie(v.view).on("mousemove.drag mouseup.drag",null),fa(v.view,l),jt(v),i.mouse("end",v)}function y(v,C){if(t.call(this,v,C)){var T=v.changedTouches,S=e.call(this,v,C),j=T.length,$,B;for($=0;$<j;++$)(B=x(this,S,v,C,T[$].identifier,T[$]))&&(Pi(v),B("start",v,T[$]))}}function g(v){var C=v.changedTouches,T=C.length,S,j;for(S=0;S<T;++S)(j=i[C[S].identifier])&&(jt(v),j("drag",v,C[S]))}function b(v){var C=v.changedTouches,T=C.length,S,j;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),S=0;S<T;++S)(j=i[C[S].identifier])&&(Pi(v),j("end",v,C[S]))}function x(v,C,T,S,j,$){var B=o.copy(),V=Le($||T,C),z,F,w;if((w=n.call(v,new ki("beforestart",{sourceEvent:T,target:h,identifier:j,active:s,x:V[0],y:V[1],dx:0,dy:0,dispatch:B}),S))!=null)return z=w.x-V[0]||0,F=w.y-V[1]||0,function A(_,R,N){var P=V,L;switch(_){case"start":i[j]=A,L=s++;break;case"end":delete i[j],--s;case"drag":V=Le(N||R,C),L=s;break}B.call(_,v,new ki(_,{sourceEvent:R,subject:w,target:h,identifier:j,active:L,x:V[0]+z,y:V[1]+F,dx:V[0]-P[0],dy:V[1]-P[1],dispatch:B}),S)}}return h.filter=function(v){return arguments.length?(t=typeof v=="function"?v:cr(!!v),h):t},h.container=function(v){return arguments.length?(e=typeof v=="function"?v:cr(v),h):e},h.subject=function(v){return arguments.length?(n=typeof v=="function"?v:cr(v),h):n},h.touchable=function(v){return arguments.length?(r=typeof v=="function"?v:cr(!!v),h):r},h.on=function(){var v=o.on.apply(o,arguments);return v===o?h:v},h.clickDistance=function(v){return arguments.length?(d=(v=+v)*v,h):Math.sqrt(d)},h}function Ti(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function ya(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function fn(){}var mn=.7,lr=1/mn,Rt="\\s*([+-]?\\d+)\\s*",yn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",We="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_y=/^#([0-9a-f]{3,8})$/,Sy=new RegExp(`^rgb\\(${Rt},${Rt},${Rt}\\)$`),Oy=new RegExp(`^rgb\\(${We},${We},${We}\\)$`),Ny=new RegExp(`^rgba\\(${Rt},${Rt},${Rt},${yn}\\)$`),Ay=new RegExp(`^rgba\\(${We},${We},${We},${yn}\\)$`),Py=new RegExp(`^hsl\\(${yn},${We},${We}\\)$`),ky=new RegExp(`^hsla\\(${yn},${We},${We},${yn}\\)$`),ga={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ti(fn,At,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:xa,formatHex:xa,formatHex8:Ty,formatHsl:jy,formatRgb:va,toString:va});function xa(){return this.rgb().formatHex()}function Ty(){return this.rgb().formatHex8()}function jy(){return Ca(this).formatHsl()}function va(){return this.rgb().formatRgb()}At=function(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=_y.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?ba(e):n===3?new je(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ur(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ur(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Sy.exec(t))?new je(e[1],e[2],e[3],1):(e=Oy.exec(t))?new je(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ny.exec(t))?ur(e[1],e[2],e[3],e[4]):(e=Ay.exec(t))?ur(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Py.exec(t))?Ea(e[1],e[2]/100,e[3]/100,1):(e=ky.exec(t))?Ea(e[1],e[2]/100,e[3]/100,e[4]):ga.hasOwnProperty(t)?ba(ga[t]):t==="transparent"?new je(NaN,NaN,NaN,0):null};function ba(t){return new je(t>>16&255,t>>8&255,t&255,1)}function ur(t,e,n,r){return r<=0&&(t=e=n=NaN),new je(t,e,n,r)}function Ry(t){return t instanceof fn||(t=At(t)),t?(t=t.rgb(),new je(t.r,t.g,t.b,t.opacity)):new je}function ji(t,e,n,r){return arguments.length===1?Ry(t):new je(t,e,n,r??1)}function je(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Ti(je,ji,ya(fn,{brighter(t){return t=t==null?lr:Math.pow(lr,t),new je(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?mn:Math.pow(mn,t),new je(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new je(pt(this.r),pt(this.g),pt(this.b),dr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wa,formatHex:wa,formatHex8:Iy,formatRgb:Ma,toString:Ma}));function wa(){return`#${ft(this.r)}${ft(this.g)}${ft(this.b)}`}function Iy(){return`#${ft(this.r)}${ft(this.g)}${ft(this.b)}${ft((isNaN(this.opacity)?1:this.opacity)*255)}`}function Ma(){const t=dr(this.opacity);return`${t===1?"rgb(":"rgba("}${pt(this.r)}, ${pt(this.g)}, ${pt(this.b)}${t===1?")":`, ${t})`}`}function dr(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function pt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ft(t){return t=pt(t),(t<16?"0":"")+t.toString(16)}function Ea(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new De(t,e,n,r)}function Ca(t){if(t instanceof De)return new De(t.h,t.s,t.l,t.opacity);if(t instanceof fn||(t=At(t)),!t)return new De;if(t instanceof De)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,a=o-i,c=(o+i)/2;return a?(e===o?s=(n-r)/a+(n<r)*6:n===o?s=(r-e)/a+2:s=(e-n)/a+4,a/=c<.5?o+i:2-o-i,s*=60):a=c>0&&c<1?0:s,new De(s,a,c,t.opacity)}function $y(t,e,n,r){return arguments.length===1?Ca(t):new De(t,e,n,r??1)}function De(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Ti(De,$y,ya(fn,{brighter(t){return t=t==null?lr:Math.pow(lr,t),new De(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?mn:Math.pow(mn,t),new De(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new je(Ri(t>=240?t-240:t+120,i,r),Ri(t,i,r),Ri(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new De(_a(this.h),hr(this.s),hr(this.l),dr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=dr(this.opacity);return`${t===1?"hsl(":"hsla("}${_a(this.h)}, ${hr(this.s)*100}%, ${hr(this.l)*100}%${t===1?")":`, ${t})`}`}}));function _a(t){return t=(t||0)%360,t<0?t+360:t}function hr(t){return Math.max(0,Math.min(1,t||0))}function Ri(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}_i=t=>()=>t;function By(t,e){return function(n){return t+n*e}}function Ly(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Dy(t){return(t=+t)==1?Sa:function(e,n){return n-e?Ly(e,n,t):_i(isNaN(e)?n:e)}}function Sa(t,e){var n=e-t;return n?By(t,n):_i(isNaN(t)?e:t)}Ci=function t(e){var n=Dy(e);function r(i,o){var s=n((i=ji(i)).r,(o=ji(o)).r),a=n(i.g,o.g),c=n(i.b,o.b),l=Sa(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=c(u),i.opacity=l(u),i+""}}return r.gamma=t,r}(1),Ye=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}};var Ii=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$i=new RegExp(Ii.source,"g");function Fy(t){return function(){return t}}function zy(t){return function(e){return t(e)+""}}Us=function(t,e){var n=Ii.lastIndex=$i.lastIndex=0,r,i,o,s=-1,a=[],c=[];for(t=t+"",e=e+"";(r=Ii.exec(t))&&(i=$i.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,c.push({i:s,x:Ye(r,i)})),n=$i.lastIndex;return n<e.length&&(o=e.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?c[0]?zy(c[0].x):Fy(e):(e=c.length,function(l){for(var u=0,d;u<e;++u)a[(d=c[u]).i]=d.x(l);return a.join("")})};var Oa=180/Math.PI,Na={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Aa(t,e,n,r,i,o){var s,a,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),t*r<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*Oa,skewX:Math.atan(c)*Oa,scaleX:s,scaleY:a}}var pr;function Vy(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Na:Aa(e.a,e.b,e.c,e.d,e.e,e.f)}function qy(t){return t==null||(pr||(pr=document.createElementNS("http://www.w3.org/2000/svg","g")),pr.setAttribute("transform",t),!(t=pr.transform.baseVal.consolidate()))?Na:(t=t.matrix,Aa(t.a,t.b,t.c,t.d,t.e,t.f))}function Pa(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function o(l,u,d,h,p,f){if(l!==d||u!==h){var m=p.push("translate(",null,e,null,n);f.push({i:m-4,x:Ye(l,d)},{i:m-2,x:Ye(u,h)})}else(d||h)&&p.push("translate("+d+e+h+n)}function s(l,u,d,h){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),h.push({i:d.push(i(d)+"rotate(",null,r)-2,x:Ye(l,u)})):u&&d.push(i(d)+"rotate("+u+r)}function a(l,u,d,h){l!==u?h.push({i:d.push(i(d)+"skewX(",null,r)-2,x:Ye(l,u)}):u&&d.push(i(d)+"skewX("+u+r)}function c(l,u,d,h,p,f){if(l!==d||u!==h){var m=p.push(i(p)+"scale(",null,",",null,")");f.push({i:m-4,x:Ye(l,d)},{i:m-2,x:Ye(u,h)})}else(d!==1||h!==1)&&p.push(i(p)+"scale("+d+","+h+")")}return function(l,u){var d=[],h=[];return l=t(l),u=t(u),o(l.translateX,l.translateY,u.translateX,u.translateY,d,h),s(l.rotate,u.rotate,d,h),a(l.skewX,u.skewX,d,h),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,d,h),l=u=null,function(p){for(var f=-1,m=h.length,y;++f<m;)d[(y=h[f]).i]=y.x(p);return d.join("")}}}var Wy=Pa(Vy,"px, ","px)","deg)"),Hy=Pa(qy,", ",")",")"),Uy=1e-12;function ka(t){return((t=Math.exp(t))+1/t)/2}function Qy(t){return((t=Math.exp(t))-1/t)/2}function Zy(t){return((t=Math.exp(2*t))-1)/(t+1)}const Yy=function t(e,n,r){function i(o,s){var a=o[0],c=o[1],l=o[2],u=s[0],d=s[1],h=s[2],p=u-a,f=d-c,m=p*p+f*f,y,g;if(m<Uy)g=Math.log(h/l)/e,y=function(S){return[a+S*p,c+S*f,l*Math.exp(e*S*g)]};else{var b=Math.sqrt(m),x=(h*h-l*l+r*m)/(2*l*n*b),v=(h*h-l*l-r*m)/(2*h*n*b),C=Math.log(Math.sqrt(x*x+1)-x),T=Math.log(Math.sqrt(v*v+1)-v);g=(T-C)/e,y=function(S){var j=S*g,$=ka(C),B=l/(n*b)*($*Zy(e*j+C)-Qy(C));return[a+B*p,c+B*f,l*$/ka(e*j+C)]}}return y.duration=g*1e3*e/Math.SQRT2,y}return i.rho=function(o){var s=Math.max(.001,+o),a=s*s,c=a*a;return t(s,a,c)},i}(Math.SQRT2,2,4);var It=0,gn=0,xn=0,Ta=1e3,fr,vn,mr=0,mt=0,yr=0,bn=typeof performance=="object"&&performance.now?performance:Date,ja=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Bi(){return mt||(ja(Xy),mt=bn.now()+yr)}function Xy(){mt=0}function gr(){this._call=this._time=this._next=null}gr.prototype=Ra.prototype={constructor:gr,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Bi():+n)+(e==null?0:+e),!this._next&&vn!==this&&(vn?vn._next=this:fr=this,vn=this),this._call=t,this._time=n,Li()},stop:function(){this._call&&(this._call=null,this._time=1/0,Li())}};function Ra(t,e,n){var r=new gr;return r.restart(t,e,n),r}function Gy(){Bi(),++It;for(var t=fr,e;t;)(e=mt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--It}function Ia(){mt=(mr=bn.now())+yr,It=gn=0;try{Gy()}finally{It=0,Jy(),mt=0}}function Ky(){var t=bn.now(),e=t-mr;e>Ta&&(yr-=e,mr=t)}function Jy(){for(var t,e=fr,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:fr=n);vn=t,Li(r)}function Li(t){if(!It){gn&&(gn=clearTimeout(gn));var e=t-mt;e>24?(t<1/0&&(gn=setTimeout(Ia,t-bn.now()-yr)),xn&&(xn=clearInterval(xn))):(xn||(mr=bn.now(),xn=setInterval(Ky,Ta)),It=1,ja(Ia))}}function $a(t,e,n){var r=new gr;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var eg=ir("start","end","cancel","interrupt"),tg=[],Ba=0,La=1,Di=2,xr=3,Da=4,Fi=5,vr=6;function br(t,e,n,r,i,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;ng(t,n,{name:e,index:r,group:i,on:eg,tween:tg,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Ba})}function zi(t,e){var n=Fe(t,e);if(n.state>Ba)throw new Error("too late; already scheduled");return n}function He(t,e){var n=Fe(t,e);if(n.state>xr)throw new Error("too late; already running");return n}function Fe(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function ng(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Ra(o,0,n.time);function o(l){n.state=La,n.timer.restart(s,n.delay,n.time),n.delay<=l&&s(l-n.delay)}function s(l){var u,d,h,p;if(n.state!==La)return c();for(u in r)if(p=r[u],p.name===n.name){if(p.state===xr)return $a(s);p.state===Da?(p.state=vr,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[u]):+u<e&&(p.state=vr,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[u])}if($a(function(){n.state===xr&&(n.state=Da,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=Di,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Di){for(n.state=xr,i=new Array(h=n.tween.length),u=0,d=-1;u<h;++u)(p=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(i[++d]=p);i.length=d+1}}function a(l){for(var u=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=Fi,1),d=-1,h=i.length;++d<h;)i[d].call(t,u);n.state===Fi&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=vr,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function wr(t,e){var n=t.__transition,r,i,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){o=!1;continue}i=r.state>Di&&r.state<Fi,r.state=vr,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}o&&delete t.__transition}}function rg(t){return this.each(function(){wr(this,t)})}function ig(t,e){var n,r;return function(){var i=He(this,t),o=i.tween;if(o!==n){r=n=o;for(var s=0,a=r.length;s<a;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function og(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=He(this,t),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:e,value:n},c=0,l=i.length;c<l;++c)if(i[c].name===e){i[c]=a;break}c===l&&i.push(a)}o.tween=i}}function sg(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Fe(this.node(),n).tween,i=0,o=r.length,s;i<o;++i)if((s=r[i]).name===t)return s.value;return null}return this.each((e==null?ig:og)(n,t,e))}function Vi(t,e,n){var r=t._id;return t.each(function(){var i=He(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return Fe(i,r).value[e]}}function Fa(t,e){var n;return(typeof e=="number"?Ye:e instanceof At?Ci:(n=At(e))?(e=n,Ci):Us)(t,e)}function ag(t){return function(){this.removeAttribute(t)}}function cg(t){return function(){this.removeAttributeNS(t.space,t.local)}}function lg(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttribute(t);return s===i?null:s===r?o:o=e(r=s,n)}}function ug(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===r?o:o=e(r=s,n)}}function dg(t,e,n){var r,i,o;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=a+"",s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a)))}}function hg(t,e,n){var r,i,o;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=a+"",s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a)))}}function pg(t,e){var n=sr(t),r=n==="transform"?Hy:Fa;return this.attrTween(t,typeof e=="function"?(n.local?hg:dg)(n,r,Vi(this,"attr."+t,e)):e==null?(n.local?cg:ag)(n):(n.local?ug:lg)(n,r,e))}function fg(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function mg(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function yg(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&mg(t,o)),n}return i._value=e,i}function gg(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&fg(t,o)),n}return i._value=e,i}function xg(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=sr(t);return this.tween(n,(r.local?yg:gg)(r,e))}function vg(t,e){return function(){zi(this,t).delay=+e.apply(this,arguments)}}function bg(t,e){return e=+e,function(){zi(this,t).delay=e}}function wg(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?vg:bg)(e,t)):Fe(this.node(),e).delay}function Mg(t,e){return function(){He(this,t).duration=+e.apply(this,arguments)}}function Eg(t,e){return e=+e,function(){He(this,t).duration=e}}function Cg(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Mg:Eg)(e,t)):Fe(this.node(),e).duration}function _g(t,e){if(typeof e!="function")throw new Error;return function(){He(this,t).ease=e}}function Sg(t){var e=this._id;return arguments.length?this.each(_g(e,t)):Fe(this.node(),e).ease}function Og(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;He(this,t).ease=n}}function Ng(t){if(typeof t!="function")throw new Error;return this.each(Og(this._id,t))}function Ag(t){typeof t!="function"&&(t=ra(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],c,l=0;l<s;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&a.push(c);return new Ge(r,this._parents,this._name,this._id)}function Pg(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var c=e[a],l=n[a],u=c.length,d=s[a]=new Array(u),h,p=0;p<u;++p)(h=c[p]||l[p])&&(d[p]=h);for(;a<r;++a)s[a]=e[a];return new Ge(s,this._parents,this._name,this._id)}function kg(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Tg(t,e,n){var r,i,o=kg(e)?zi:He;return function(){var s=o(this,t),a=s.on;a!==r&&(i=(r=a).copy()).on(e,n),s.on=i}}function jg(t,e){var n=this._id;return arguments.length<2?Fe(this.node(),n).on.on(t):this.each(Tg(n,t,e))}function Rg(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Ig(){return this.on("end.remove",Rg(this._id))}function $g(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Ni(t));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a=r[s],c=a.length,l=o[s]=new Array(c),u,d,h=0;h<c;++h)(u=a[h])&&(d=t.call(u,u.__data__,h,a))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d,br(l[h],e,n,h,l,Fe(u,n)));return new Ge(o,this._parents,e,n)}function Bg(t){var e=this._name,n=this._id;typeof t!="function"&&(t=na(t));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var c=r[a],l=c.length,u,d=0;d<l;++d)if(u=c[d]){for(var h=t.call(u,u.__data__,d,c),p,f=Fe(u,n),m=0,y=h.length;m<y;++m)(p=h[m])&&br(p,e,n,m,h,f);o.push(h),s.push(u)}return new Ge(o,s,e,n)}var Lg=hn.prototype.constructor;function Dg(){return new Lg(this._groups,this._parents)}function Fg(t,e){var n,r,i;return function(){var o=Tt(this,t),s=(this.style.removeProperty(t),Tt(this,t));return o===s?null:o===n&&s===r?i:i=e(n=o,r=s)}}function za(t){return function(){this.style.removeProperty(t)}}function zg(t,e,n){var r,i=n+"",o;return function(){var s=Tt(this,t);return s===i?null:s===r?o:o=e(r=s,n)}}function Vg(t,e,n){var r,i,o;return function(){var s=Tt(this,t),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(t),Tt(this,t))),s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a))}}function qg(t,e){var n,r,i,o="style."+e,s="end."+o,a;return function(){var c=He(this,t),l=c.on,u=c.value[o]==null?a||(a=za(e)):void 0;(l!==n||i!==u)&&(r=(n=l).copy()).on(s,i=u),c.on=r}}function Wg(t,e,n){var r=(t+="")=="transform"?Wy:Fa;return e==null?this.styleTween(t,Fg(t,r)).on("end.style."+t,za(t)):typeof e=="function"?this.styleTween(t,Vg(t,r,Vi(this,"style."+t,e))).each(qg(this._id,t)):this.styleTween(t,zg(t,r,e),n).on("end.style."+t,null)}function Hg(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Ug(t,e,n){var r,i;function o(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&Hg(t,s,n)),r}return o._value=e,o}function Qg(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Ug(t,e,n??""))}function Zg(t){return function(){this.textContent=t}}function Yg(t){return function(){var e=t(this);this.textContent=e??""}}function Xg(t){return this.tween("text",typeof t=="function"?Yg(Vi(this,"text",t)):Zg(t==null?"":t+""))}function Gg(t){return function(e){this.textContent=t.call(this,e)}}function Kg(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Gg(i)),e}return r._value=t,r}function Jg(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Kg(t))}function e0(){for(var t=this._name,e=this._id,n=Va(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,c,l=0;l<a;++l)if(c=s[l]){var u=Fe(c,e);br(c,t,n,l,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Ge(r,this._parents,t,n)}function t0(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},c={value:function(){--i===0&&o()}};n.each(function(){var l=He(this,r),u=l.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(c)),l.on=e}),i===0&&o()})}var n0=0;function Ge(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Va(){return++n0}var Ke=hn.prototype;Ge.prototype={constructor:Ge,select:$g,selectAll:Bg,selectChild:Ke.selectChild,selectChildren:Ke.selectChildren,filter:Ag,merge:Pg,selection:Dg,transition:e0,call:Ke.call,nodes:Ke.nodes,node:Ke.node,size:Ke.size,empty:Ke.empty,each:Ke.each,on:jg,attr:pg,attrTween:xg,style:Wg,styleTween:Qg,text:Xg,textTween:Jg,remove:Ig,tween:sg,delay:wg,duration:Cg,ease:Sg,easeVarying:Ng,end:t0,[Symbol.iterator]:Ke[Symbol.iterator]};function r0(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var i0={time:null,delay:0,duration:250,ease:r0};function o0(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function s0(t){var e,n;t instanceof Ge?(e=t._id,t=t._name):(e=Va(),(n=i0).time=Bi(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,c,l=0;l<a;++l)(c=s[l])&&br(c,t,e,l,s,n||o0(c,e));return new Ge(r,this._parents,t,e)}hn.prototype.interrupt=rg,hn.prototype.transition=s0;const Mr=t=>()=>t;function a0(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Je(t,e,n){this.k=t,this.x=e,this.y=n}Je.prototype={constructor:Je,scale:function(t){return t===1?this:new Je(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Je(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Er=new Je(1,0,0);qa.prototype=Je.prototype;function qa(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Er;return t.__zoom}function qi(t){t.stopImmediatePropagation()}function wn(t){t.preventDefault(),t.stopImmediatePropagation()}function c0(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function l0(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Wa(){return this.__zoom||Er}function u0(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function d0(){return navigator.maxTouchPoints||"ontouchstart"in this}function h0(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function Ha(){var t=c0,e=l0,n=h0,r=u0,i=d0,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,c=Yy,l=ir("start","zoom","end"),u,d,h,p=500,f=150,m=0,y=10;function g(w){w.property("__zoom",Wa).on("wheel.zoom",j,{passive:!1}).on("mousedown.zoom",$).on("dblclick.zoom",B).filter(i).on("touchstart.zoom",V).on("touchmove.zoom",z).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(w,A,_,R){var N=w.selection?w.selection():w;N.property("__zoom",Wa),w!==N?C(w,A,_,R):N.interrupt().each(function(){T(this,arguments).event(R).start().zoom(null,typeof A=="function"?A.apply(this,arguments):A).end()})},g.scaleBy=function(w,A,_,R){g.scaleTo(w,function(){var N=this.__zoom.k,P=typeof A=="function"?A.apply(this,arguments):A;return N*P},_,R)},g.scaleTo=function(w,A,_,R){g.transform(w,function(){var N=e.apply(this,arguments),P=this.__zoom,L=_==null?v(N):typeof _=="function"?_.apply(this,arguments):_,W=P.invert(L),I=typeof A=="function"?A.apply(this,arguments):A;return n(x(b(P,I),L,W),N,s)},_,R)},g.translateBy=function(w,A,_,R){g.transform(w,function(){return n(this.__zoom.translate(typeof A=="function"?A.apply(this,arguments):A,typeof _=="function"?_.apply(this,arguments):_),e.apply(this,arguments),s)},null,R)},g.translateTo=function(w,A,_,R,N){g.transform(w,function(){var P=e.apply(this,arguments),L=this.__zoom,W=R==null?v(P):typeof R=="function"?R.apply(this,arguments):R;return n(Er.translate(W[0],W[1]).scale(L.k).translate(typeof A=="function"?-A.apply(this,arguments):-A,typeof _=="function"?-_.apply(this,arguments):-_),P,s)},R,N)};function b(w,A){return A=Math.max(o[0],Math.min(o[1],A)),A===w.k?w:new Je(A,w.x,w.y)}function x(w,A,_){var R=A[0]-_[0]*w.k,N=A[1]-_[1]*w.k;return R===w.x&&N===w.y?w:new Je(w.k,R,N)}function v(w){return[(+w[0][0]+ +w[1][0])/2,(+w[0][1]+ +w[1][1])/2]}function C(w,A,_,R){w.on("start.zoom",function(){T(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(R).end()}).tween("zoom",function(){var N=this,P=arguments,L=T(N,P).event(R),W=e.apply(N,P),I=_==null?v(W):typeof _=="function"?_.apply(N,P):_,J=Math.max(W[1][0]-W[0][0],W[1][1]-W[0][1]),X=N.__zoom,q=typeof A=="function"?A.apply(N,P):A,ee=c(X.invert(I).concat(J/X.k),q.invert(I).concat(J/q.k));return function(ne){if(ne===1)ne=q;else{var H=ee(ne),ae=J/H[2];ne=new Je(ae,I[0]-H[0]*ae,I[1]-H[1]*ae)}L.zoom(null,ne)}})}function T(w,A,_){return!_&&w.__zooming||new S(w,A)}function S(w,A){this.that=w,this.args=A,this.active=0,this.sourceEvent=null,this.extent=e.apply(w,A),this.taps=0}S.prototype={event:function(w){return w&&(this.sourceEvent=w),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(w,A){return this.mouse&&w!=="mouse"&&(this.mouse[1]=A.invert(this.mouse[0])),this.touch0&&w!=="touch"&&(this.touch0[1]=A.invert(this.touch0[0])),this.touch1&&w!=="touch"&&(this.touch1[1]=A.invert(this.touch1[0])),this.that.__zoom=A,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(w){var A=Ie(this.that).datum();l.call(w,this.that,new a0(w,{sourceEvent:this.sourceEvent,target:g,type:w,transform:this.that.__zoom,dispatch:l}),A)}};function j(w,...A){if(!t.apply(this,arguments))return;var _=T(this,A).event(w),R=this.__zoom,N=Math.max(o[0],Math.min(o[1],R.k*Math.pow(2,r.apply(this,arguments)))),P=Le(w);if(_.wheel)(_.mouse[0][0]!==P[0]||_.mouse[0][1]!==P[1])&&(_.mouse[1]=R.invert(_.mouse[0]=P)),clearTimeout(_.wheel);else{if(R.k===N)return;_.mouse=[P,R.invert(P)],wr(this),_.start()}wn(w),_.wheel=setTimeout(L,f),_.zoom("mouse",n(x(b(R,N),_.mouse[0],_.mouse[1]),_.extent,s));function L(){_.wheel=null,_.end()}}function $(w,...A){if(h||!t.apply(this,arguments))return;var _=w.currentTarget,R=T(this,A,!0).event(w),N=Ie(w.view).on("mousemove.zoom",I,!0).on("mouseup.zoom",J,!0),P=Le(w,_),L=w.clientX,W=w.clientY;pa(w.view),qi(w),R.mouse=[P,this.__zoom.invert(P)],wr(this),R.start();function I(X){if(wn(X),!R.moved){var q=X.clientX-L,ee=X.clientY-W;R.moved=q*q+ee*ee>m}R.event(X).zoom("mouse",n(x(R.that.__zoom,R.mouse[0]=Le(X,_),R.mouse[1]),R.extent,s))}function J(X){N.on("mousemove.zoom mouseup.zoom",null),fa(X.view,R.moved),wn(X),R.event(X).end()}}function B(w,...A){if(t.apply(this,arguments)){var _=this.__zoom,R=Le(w.changedTouches?w.changedTouches[0]:w,this),N=_.invert(R),P=_.k*(w.shiftKey?.5:2),L=n(x(b(_,P),R,N),e.apply(this,A),s);wn(w),a>0?Ie(this).transition().duration(a).call(C,L,R,w):Ie(this).call(g.transform,L,R,w)}}function V(w,...A){if(t.apply(this,arguments)){var _=w.touches,R=_.length,N=T(this,A,w.changedTouches.length===R).event(w),P,L,W,I;for(qi(w),L=0;L<R;++L)W=_[L],I=Le(W,this),I=[I,this.__zoom.invert(I),W.identifier],N.touch0?!N.touch1&&N.touch0[2]!==I[2]&&(N.touch1=I,N.taps=0):(N.touch0=I,P=!0,N.taps=1+!!u);u&&(u=clearTimeout(u)),P&&(N.taps<2&&(d=I[0],u=setTimeout(function(){u=null},p)),wr(this),N.start())}}function z(w,...A){if(this.__zooming){var _=T(this,A).event(w),R=w.changedTouches,N=R.length,P,L,W,I;for(wn(w),P=0;P<N;++P)L=R[P],W=Le(L,this),_.touch0&&_.touch0[2]===L.identifier?_.touch0[0]=W:_.touch1&&_.touch1[2]===L.identifier&&(_.touch1[0]=W);if(L=_.that.__zoom,_.touch1){var J=_.touch0[0],X=_.touch0[1],q=_.touch1[0],ee=_.touch1[1],ne=(ne=q[0]-J[0])*ne+(ne=q[1]-J[1])*ne,H=(H=ee[0]-X[0])*H+(H=ee[1]-X[1])*H;L=b(L,Math.sqrt(ne/H)),W=[(J[0]+q[0])/2,(J[1]+q[1])/2],I=[(X[0]+ee[0])/2,(X[1]+ee[1])/2]}else if(_.touch0)W=_.touch0[0],I=_.touch0[1];else return;_.zoom("touch",n(x(L,W,I),_.extent,s))}}function F(w,...A){if(this.__zooming){var _=T(this,A).event(w),R=w.changedTouches,N=R.length,P,L;for(qi(w),h&&clearTimeout(h),h=setTimeout(function(){h=null},p),P=0;P<N;++P)L=R[P],_.touch0&&_.touch0[2]===L.identifier?delete _.touch0:_.touch1&&_.touch1[2]===L.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(L=Le(L,this),Math.hypot(d[0]-L[0],d[1]-L[1])<y)){var W=Ie(this).on("dblclick.zoom");W&&W.apply(this,arguments)}}}return g.wheelDelta=function(w){return arguments.length?(r=typeof w=="function"?w:Mr(+w),g):r},g.filter=function(w){return arguments.length?(t=typeof w=="function"?w:Mr(!!w),g):t},g.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:Mr(!!w),g):i},g.extent=function(w){return arguments.length?(e=typeof w=="function"?w:Mr([[+w[0][0],+w[0][1]],[+w[1][0],+w[1][1]]]),g):e},g.scaleExtent=function(w){return arguments.length?(o[0]=+w[0],o[1]=+w[1],g):[o[0],o[1]]},g.translateExtent=function(w){return arguments.length?(s[0][0]=+w[0][0],s[1][0]=+w[1][0],s[0][1]=+w[0][1],s[1][1]=+w[1][1],g):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},g.constrain=function(w){return arguments.length?(n=w,g):n},g.duration=function(w){return arguments.length?(a=+w,g):a},g.interpolate=function(w){return arguments.length?(c=w,g):c},g.on=function(){var w=l.on.apply(l,arguments);return w===l?g:w},g.clickDistance=function(w){return arguments.length?(m=(w=+w)*w,g):Math.sqrt(m)},g.tapDistance=function(w){return arguments.length?(y=+w,g):y},g}const et={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`},Mn=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ua=["Enter"," ","Escape"];var $t;(function(t){t.Strict="strict",t.Loose="loose"})($t||($t={})),function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"}(ht||(ht={}));var En;(function(t){t.Partial="partial",t.Full="full"})(En||(En={}));const Qa={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var ot;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(ot||(ot={}));var Cr;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(Cr||(Cr={})),function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"}(re||(re={}));const Za={[re.Left]:re.Right,[re.Right]:re.Left,[re.Top]:re.Bottom,[re.Bottom]:re.Top};function p0(t,e){if(!t&&!e)return!0;if(!t||!e||t.size!==e.size)return!1;if(!t.size&&!e.size)return!0;for(const n of t.keys())if(!e.has(n))return!1;return!0}function Ya(t,e,n){if(!n)return;const r=[];t.forEach((i,o)=>{e!=null&&e.has(o)||r.push(i)}),r.length&&n(r)}function Xa(t){return t===null?null:t?"valid":"invalid"}const Ga=t=>"id"in t&&"source"in t&&"target"in t,f0=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),Wi=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),Cn=(t,e=[0,0])=>{const{width:n,height:r}=tt(t),i=t.origin??e,o=n*i[0],s=r*i[1];return{x:t.position.x-o,y:t.position.y-s}},m0=(t,e={nodeOrigin:[0,0],nodeLookup:void 0})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,i)=>{const o=typeof i=="string";let s=!e.nodeLookup&&!o?i:void 0;e.nodeLookup&&(s=o?e.nodeLookup.get(i):Wi(i)?i:e.nodeLookup.get(i.id));const a=s?Or(s,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return _r(r,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Sr(n)},_n=(t,e={})=>{if(t.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return t.forEach(r=>{if(e.filter===void 0||e.filter(r)){const i=Or(r);n=_r(n,i)}}),Sr(n)},Ka=(t,e,[n,r,i]=[0,0,1],o=!1,s=!1)=>{const a={...On(e,[n,r,i]),width:e.width/i,height:e.height/i},c=[];for(const l of t.values()){const{measured:u,selectable:d=!0,hidden:h=!1}=l;if(s&&!d||h)continue;const p=u.width??l.width??l.initialWidth??null,f=u.height??l.height??l.initialHeight??null,m=Sn(a,Lt(l)),y=(p??0)*(f??0),g=o&&m>0;(!l.internals.handleBounds||g||m>=y||l.dragging)&&c.push(l)}return c},y0=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function Hi(t,e){const n=new Map,r=e!=null&&e.nodes?new Set(e.nodes.map(i=>i.id)):null;return t.forEach(i=>{i.measured.width&&i.measured.height&&(e!=null&&e.includeHiddenNodes||!i.hidden)&&(!r||r.has(i.id))&&n.set(i.id,i)}),n}async function Ui({nodes:t,width:e,height:n,panZoom:r,minZoom:i,maxZoom:o},s){if(t.size===0)return Promise.resolve(!1);const a=_n(t),c=Zi(a,e,n,(s==null?void 0:s.minZoom)??i,(s==null?void 0:s.maxZoom)??o,(s==null?void 0:s.padding)??.1);return await r.setViewport(c,{duration:s==null?void 0:s.duration}),Promise.resolve(!0)}function Ja({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:i,onError:o}){const s=n.get(t),a=s.parentId?n.get(s.parentId):void 0,{x:c,y:l}=a?a.internals.positionAbsolute:{x:0,y:0},u=s.origin??r;let d=i;if(s.extent==="parent"&&!s.expandParent)if(!a)o==null||o("005",et.error005());else{const p=a.measured.width,f=a.measured.height;p&&f&&(d=[[c,l],[c+p,l+f]])}else a&&Dt(s.extent)&&(d=[[s.extent[0][0]+c,s.extent[0][1]+l],[s.extent[1][0]+c,s.extent[1][1]+l]]);const h=Dt(d)?yt(e,d,s.measured):e;return{position:{x:h.x-c+s.measured.width*u[0],y:h.y-l+s.measured.height*u[1]},positionAbsolute:h}}async function g0({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:i}){const o=new Set(t.map(d=>d.id)),s=[];for(const d of n){if(d.deletable===!1)continue;const h=o.has(d.id),p=!h&&d.parentId&&s.find(f=>f.id===d.parentId);(h||p)&&s.push(d)}const a=new Set(e.map(d=>d.id)),c=r.filter(d=>d.deletable!==!1),l=y0(s,c);for(const d of c)a.has(d.id)&&!l.find(h=>h.id===d.id)&&l.push(d);if(!i)return{edges:l,nodes:s};const u=await i({nodes:s,edges:l});return typeof u=="boolean"?u?{edges:l,nodes:s}:{edges:[],nodes:[]}:u}const Bt=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),yt=(t={x:0,y:0},e,n)=>({x:Bt(t.x,e[0][0],e[1][0]-((n==null?void 0:n.width)??0)),y:Bt(t.y,e[0][1],e[1][1]-((n==null?void 0:n.height)??0))});function ec(t,e,n){const{width:r,height:i}=tt(n),{x:o,y:s}=n.internals.positionAbsolute;return yt(t,[[o,s],[o+r,s+i]],e)}const tc=(t,e,n)=>t<e?Bt(Math.abs(t-e),1,e)/e:t>n?-Bt(Math.abs(t-n),1,e)/e:0,nc=(t,e,n=15,r=40)=>{const i=tc(t.x,r,e.width-r)*n,o=tc(t.y,r,e.height-r)*n;return[i,o]},_r=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),Qi=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),Sr=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),Lt=(t,e=[0,0])=>{var i,o;const{x:n,y:r}=Wi(t)?t.internals.positionAbsolute:Cn(t,e);return{x:n,y:r,width:((i=t.measured)==null?void 0:i.width)??t.width??t.initialWidth??0,height:((o=t.measured)==null?void 0:o.height)??t.height??t.initialHeight??0}},Or=(t,e=[0,0])=>{var i,o;const{x:n,y:r}=Wi(t)?t.internals.positionAbsolute:Cn(t,e);return{x:n,y:r,x2:n+(((i=t.measured)==null?void 0:i.width)??t.width??t.initialWidth??0),y2:r+(((o=t.measured)==null?void 0:o.height)??t.height??t.initialHeight??0)}},rc=(t,e)=>Sr(_r(Qi(t),Qi(e))),Sn=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},ic=t=>ze(t.width)&&ze(t.height)&&ze(t.x)&&ze(t.y),ze=t=>!isNaN(t)&&isFinite(t),x0=(t,e)=>{},Nr=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),On=({x:t,y:e},[n,r,i],o=!1,s=[1,1])=>{const a={x:(t-n)/i,y:(e-r)/i};return o?Nr(a,s):a},oc=({x:t,y:e},[n,r,i])=>({x:t*i+n,y:e*i+r}),Zi=(t,e,n,r,i,o)=>{const s=e/(t.width*(1+o)),a=n/(t.height*(1+o)),c=Math.min(s,a),l=Bt(c,r,i),u=t.x+t.width/2,d=t.y+t.height/2,h=e/2-u*l,p=n/2-d*l;return{x:h,y:p,zoom:l}},Ar=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function Dt(t){return t!==void 0&&t!=="parent"}function tt(t){var e,n;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight??0}}function sc(t){var e,n;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight)!==void 0}function ac(t,e={width:0,height:0},n,r,i){const o={...t},s=r.get(n);if(s){const a=s.origin||i;o.x+=s.internals.positionAbsolute.x-(e.width??0)*a[0],o.y+=s.internals.positionAbsolute.y-(e.height??0)*a[1]}return o}function Nn(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:i}){const{x:o,y:s}=nt(t),a=On({x:o-((i==null?void 0:i.left)??0),y:s-((i==null?void 0:i.top)??0)},r),{x:c,y:l}=n?Nr(a,e):a;return{xSnapped:c,ySnapped:l,...a}}const Pr=t=>({width:t.offsetWidth,height:t.offsetHeight}),cc=t=>{var e;return((e=t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},v0=["INPUT","SELECT","TEXTAREA"];function Yi(t){var n,r;const e=((r=(n=t.composedPath)==null?void 0:n.call(t))==null?void 0:r[0])||t.target;return v0.includes(e==null?void 0:e.nodeName)||(e==null?void 0:e.hasAttribute("contenteditable"))||!!(e!=null&&e.closest(".nokey"))}const lc=t=>"clientX"in t,nt=(t,e)=>{var o,s;const n=lc(t),r=n?t.clientX:(o=t.touches)==null?void 0:o[0].clientX,i=n?t.clientY:(s=t.touches)==null?void 0:s[0].clientY;return{x:r-((e==null?void 0:e.left)??0),y:i-((e==null?void 0:e.top)??0)}},uc=(t,e,n,r,i)=>{const o=e.querySelectorAll(`.${t}`);return!o||!o.length?null:Array.from(o).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:t,nodeId:i,position:s.getAttribute("data-handlepos"),x:(a.left-n.left)/r,y:(a.top-n.top)/r,...Pr(s)}})};function dc({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:i,sourceControlY:o,targetControlX:s,targetControlY:a}){const c=t*.125+i*.375+s*.375+n*.125,l=e*.125+o*.375+a*.375+r*.125,u=Math.abs(c-t),d=Math.abs(l-e);return[c,l,u,d]}function kr(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function hc({pos:t,x1:e,y1:n,x2:r,y2:i,c:o}){switch(t){case re.Left:return[e-kr(e-r,o),n];case re.Right:return[e+kr(r-e,o),n];case re.Top:return[e,n-kr(n-i,o)];case re.Bottom:return[e,n+kr(i-n,o)]}}function pc({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top,curvature:s=.25}){const[a,c]=hc({pos:n,x1:t,y1:e,x2:r,y2:i,c:s}),[l,u]=hc({pos:o,x1:r,y1:i,x2:t,y2:e,c:s}),[d,h,p,f]=dc({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:a,sourceControlY:c,targetControlX:l,targetControlY:u});return[`M${t},${e} C${a},${c} ${l},${u} ${r},${i}`,d,h,p,f]}function fc({sourceX:t,sourceY:e,targetX:n,targetY:r}){const i=Math.abs(n-t)/2,o=n<t?n+i:n-i,s=Math.abs(r-e)/2,a=r<e?r+s:r-s;return[o,a,i,s]}function b0({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:i=!1}){if(!i)return r;const o=n||e.selected||t.selected,s=Math.max(t.internals.z||0,e.internals.z||0,1e3);return r+(o?s:0)}function w0({sourceNode:t,targetNode:e,width:n,height:r,transform:i}){const o=_r(Or(t),Or(e));o.x===o.x2&&(o.x2+=1),o.y===o.y2&&(o.y2+=1);const s={x:-i[0]/i[2],y:-i[1]/i[2],width:n/i[2],height:r/i[2]};return Sn(s,Sr(o))>0}const M0=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,E0=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),mc=(t,e)=>{if(!t.source||!t.target)return e;let n;return Ga(t)?n={...t}:n={...t,id:M0(t)},E0(n,e)?e:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,e.concat(n))};function yc({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[i,o,s,a]=fc({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,i,o,s,a]}const gc={[re.Left]:{x:-1,y:0},[re.Right]:{x:1,y:0},[re.Top]:{x:0,y:-1},[re.Bottom]:{x:0,y:1}},C0=({source:t,sourcePosition:e=re.Bottom,target:n})=>e===re.Left||e===re.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},xc=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function _0({source:t,sourcePosition:e=re.Bottom,target:n,targetPosition:r=re.Top,center:i,offset:o}){const s=gc[e],a=gc[r],c={x:t.x+s.x*o,y:t.y+s.y*o},l={x:n.x+a.x*o,y:n.y+a.y*o},u=C0({source:c,sourcePosition:e,target:l}),d=u.x!==0?"x":"y",h=u[d];let p=[],f,m;const y={x:0,y:0},g={x:0,y:0},[b,x,v,C]=fc({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(s[d]*a[d]===-1){f=i.x??b,m=i.y??x;const T=[{x:f,y:c.y},{x:f,y:l.y}],S=[{x:c.x,y:m},{x:l.x,y:m}];s[d]===h?p=d==="x"?T:S:p=d==="x"?S:T}else{const T=[{x:c.x,y:l.y}],S=[{x:l.x,y:c.y}];if(d==="x"?p=s.x===h?S:T:p=s.y===h?T:S,e===r){const z=Math.abs(t[d]-n[d]);if(z<=o){const F=Math.min(o-1,o-z);s[d]===h?y[d]=(c[d]>t[d]?-1:1)*F:g[d]=(l[d]>n[d]?-1:1)*F}}if(e!==r){const z=d==="x"?"y":"x",F=s[d]===a[z],w=c[z]>l[z],A=c[z]<l[z];(s[d]===1&&(!F&&w||F&&A)||s[d]!==1&&(!F&&A||F&&w))&&(p=d==="x"?T:S)}const j={x:c.x+y.x,y:c.y+y.y},$={x:l.x+g.x,y:l.y+g.y},B=Math.max(Math.abs(j.x-p[0].x),Math.abs($.x-p[0].x)),V=Math.max(Math.abs(j.y-p[0].y),Math.abs($.y-p[0].y));B>=V?(f=(j.x+$.x)/2,m=p[0].y):(f=p[0].x,m=(j.y+$.y)/2)}return[[t,{x:c.x+y.x,y:c.y+y.y},...p,{x:l.x+g.x,y:l.y+g.y},n],f,m,v,C]}function S0(t,e,n,r){const i=Math.min(xc(t,e)/2,xc(e,n)/2,r),{x:o,y:s}=e;if(t.x===o&&o===n.x||t.y===s&&s===n.y)return`L${o} ${s}`;if(t.y===s){const l=t.x<n.x?-1:1,u=t.y<n.y?1:-1;return`L ${o+i*l},${s}Q ${o},${s} ${o},${s+i*u}`}const a=t.x<n.x?1:-1,c=t.y<n.y?-1:1;return`L ${o},${s+i*c}Q ${o},${s} ${o+i*a},${s}`}function Xi({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top,borderRadius:s=5,centerX:a,centerY:c,offset:l=20}){const[u,d,h,p,f]=_0({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:i},targetPosition:o,center:{x:a,y:c},offset:l});return[u.reduce((m,y,g)=>{let b="";return g>0&&g<u.length-1?b=S0(u[g-1],y,u[g+1],s):b=`${g===0?"M":"L"}${y.x} ${y.y}`,m+=b,m},""),d,h,p,f]}function vc(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function O0(t){var d;const{sourceNode:e,targetNode:n}=t;if(!vc(e)||!vc(n))return null;const r=e.internals.handleBounds||bc(e.handles),i=n.internals.handleBounds||bc(n.handles),o=wc((r==null?void 0:r.source)??[],t.sourceHandle),s=wc(t.connectionMode===$t.Strict?(i==null?void 0:i.target)??[]:((i==null?void 0:i.target)??[]).concat((i==null?void 0:i.source)??[]),t.targetHandle);if(!o||!s)return(d=t.onError)==null||d.call(t,"008",et.error008(o?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const a=(o==null?void 0:o.position)||re.Bottom,c=(s==null?void 0:s.position)||re.Top,l=An(e,o,a),u=An(n,s,c);return{sourceX:l.x,sourceY:l.y,targetX:u.x,targetY:u.y,sourcePosition:a,targetPosition:c}}function bc(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function An(t,e,n=re.Left,r=!1){const i=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,o=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:s,height:a}=e??tt(t);if(r)return{x:i+s/2,y:o+a/2};switch((e==null?void 0:e.position)??n){case re.Top:return{x:i+s/2,y:o};case re.Right:return{x:i+s,y:o+a/2};case re.Bottom:return{x:i+s/2,y:o+a};case re.Left:return{x:i,y:o+a/2}}}function wc(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function Gi(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(n=>`${n}=${t[n]}`).join("&")}`:""}function N0(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:i}){const o=new Set;return t.reduce((s,a)=>([a.markerStart||r,a.markerEnd||i].forEach(c=>{if(c&&typeof c=="object"){const l=Gi(c,e);o.has(l)||(s.push({id:l,color:c.color||n,...c}),o.add(l))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const Ki={nodeOrigin:[0,0],nodeExtent:Mn,elevateNodesOnSelect:!0,defaults:{}},A0={...Ki,checkEquality:!0};function Ji(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function P0(t,e,n){const r=Ji(Ki,n);for(const i of t.values())if(i.parentId)to(i,t,e,r);else{const o=Cn(i,r.nodeOrigin),s=Dt(i.extent)?i.extent:r.nodeExtent,a=yt(o,s,tt(i));i.internals.positionAbsolute=a}}function eo(t,e,n,r){var a,c;const i=Ji(A0,r),o=new Map(e),s=i!=null&&i.elevateNodesOnSelect?1e3:0;e.clear(),n.clear();for(const l of t){let u=o.get(l.id);if(i.checkEquality&&l===(u==null?void 0:u.internals.userNode))e.set(l.id,u);else{const d=Cn(l,i.nodeOrigin),h=Dt(l.extent)?l.extent:i.nodeExtent,p=yt(d,h,tt(l));u={...i.defaults,...l,measured:{width:(a=l.measured)==null?void 0:a.width,height:(c=l.measured)==null?void 0:c.height},internals:{positionAbsolute:p,handleBounds:l.measured?u==null?void 0:u.internals.handleBounds:void 0,z:Mc(l,s),userNode:l}},e.set(l.id,u)}l.parentId&&to(u,e,n,r)}}function k0(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function to(t,e,n,r){const{elevateNodesOnSelect:i,nodeOrigin:o,nodeExtent:s}=Ji(Ki,r),a=t.parentId,c=e.get(a);if(!c){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}k0(t,n);const l=i?1e3:0,{x:u,y:d,z:h}=T0(t,c,o,s,l),{positionAbsolute:p}=t.internals,f=u!==p.x||d!==p.y;(f||h!==t.internals.z)&&(t.internals={...t.internals,positionAbsolute:f?{x:u,y:d}:p,z:h})}function Mc(t,e){return(ze(t.zIndex)?t.zIndex:0)+(t.selected?e:0)}function T0(t,e,n,r,i){const{x:o,y:s}=e.internals.positionAbsolute,a=tt(t),c=Cn(t,n),l=Dt(t.extent)?yt(c,t.extent,a):c;let u=yt({x:o+l.x,y:s+l.y},r,a);t.extent==="parent"&&(u=ec(u,a,e));const d=Mc(t,i),h=e.internals.z??0;return{x:u.x,y:u.y,z:h>d?h:d}}function no(t,e,n,r=[0,0]){var s;const i=[],o=new Map;for(const a of t){const c=e.get(a.parentId);if(!c)continue;const l=((s=o.get(a.parentId))==null?void 0:s.expandedRect)??Lt(c),u=rc(l,a.rect);o.set(a.parentId,{expandedRect:u,parent:c})}return o.size>0&&o.forEach(({expandedRect:a,parent:c},l)=>{var x;const u=c.internals.positionAbsolute,d=tt(c),h=c.origin??r,p=a.x<u.x?Math.round(Math.abs(u.x-a.x)):0,f=a.y<u.y?Math.round(Math.abs(u.y-a.y)):0,m=Math.max(d.width,Math.round(a.width)),y=Math.max(d.height,Math.round(a.height)),g=(m-d.width)*h[0],b=(y-d.height)*h[1];(p>0||f>0||g||b)&&(i.push({id:l,type:"position",position:{x:c.position.x-p+g,y:c.position.y-f+b}}),(x=n.get(l))==null||x.forEach(v=>{t.some(C=>C.id===v.id)||i.push({id:v.id,type:"position",position:{x:v.position.x+p,y:v.position.y+f}})})),(d.width<a.width||d.height<a.height||p||f)&&i.push({id:l,type:"dimensions",setAttributes:!0,dimensions:{width:m+(p?h[0]*p-g:0),height:y+(f?h[1]*f-b:0)}})}),i}function j0(t,e,n,r,i,o){const s=r==null?void 0:r.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const c=[],l=window.getComputedStyle(s),{m22:u}=new window.DOMMatrixReadOnly(l.transform),d=[];for(const h of t.values()){const p=e.get(h.id);if(p)if(p.hidden)p.internals={...p.internals,handleBounds:void 0},a=!0;else{const f=Pr(h.nodeElement),m=p.measured.width!==f.width||p.measured.height!==f.height;if(f.width&&f.height&&(m||!p.internals.handleBounds||h.force)){const y=h.nodeElement.getBoundingClientRect(),g=Dt(p.extent)?p.extent:o;let{positionAbsolute:b}=p.internals;p.parentId&&p.extent==="parent"?b=ec(b,f,e.get(p.parentId)):g&&(b=yt(b,g,f)),p.measured=f,p.internals={...p.internals,positionAbsolute:b,handleBounds:{source:uc("source",h.nodeElement,y,u,p.id),target:uc("target",h.nodeElement,y,u,p.id)}},p.parentId&&to(p,e,n,{nodeOrigin:i}),a=!0,m&&(c.push({id:p.id,type:"dimensions",dimensions:f}),p.expandParent&&p.parentId&&d.push({id:p.id,parentId:p.parentId,rect:Lt(p,i)}))}}}if(d.length>0){const h=no(d,e,n,i);c.push(...h)}return{changes:c,updatedInternals:a}}async function R0({delta:t,panZoom:e,transform:n,translateExtent:r,width:i,height:o}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const s=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[i,o]],r),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}function Ec(t,e,n){t.clear(),e.clear();for(const r of n){const{source:i,target:o,sourceHandle:s=null,targetHandle:a=null}=r,c=`${i}-source-${s}`,l=`${o}-target-${a}`,u=t.get(c)||new Map,d=t.get(l)||new Map,h={edgeId:r.id,source:i,target:o,sourceHandle:s,targetHandle:a};e.set(r.id,r),t.set(c,u.set(`${o}-${a}`,h)),t.set(l,d.set(`${i}-${s}`,h))}}function Cc(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:Cc(n,e):!1}function _c(t,e,n){let r=t;do{if(r!=null&&r.matches(e))return!0;if(r===n)return!1;r=r.parentElement}while(r);return!1}function I0(t,e,n,r){const i=new Map;for(const[o,s]of t)if((s.selected||s.id===r)&&(!s.parentId||!Cc(s,t))&&(s.draggable||e&&typeof s.draggable>"u")){const a=t.get(o);a&&i.set(o,{id:o,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return i}function ro({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){var s,a,c;const i=[];for(const[l,u]of e){const d=(s=n.get(l))==null?void 0:s.internals.userNode;d&&i.push({...d,position:u.position,dragging:r})}if(!t)return[i[0],i];const o=(a=n.get(t))==null?void 0:a.internals.userNode;return[o?{...o,position:((c=e.get(t))==null?void 0:c.position)||o.position,dragging:r}:i[0],i]}function $0({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:i}){let o={x:null,y:null},s=0,a=new Map,c=!1,l={x:0,y:0},u=null,d=!1,h=null,p=!1;function f({noDragClassName:y,handleSelector:g,domNode:b,isSelectable:x,nodeId:v,nodeClickDistance:C=0}){h=Ie(b);function T({x:B,y:V},z){const{nodeLookup:F,nodeExtent:w,snapGrid:A,snapToGrid:_,nodeOrigin:R,onNodeDrag:N,onSelectionDrag:P,onError:L,updateNodePositions:W}=e();o={x:B,y:V};let I=!1,J={x:0,y:0,x2:0,y2:0};if(a.size>1&&w){const X=_n(a);J=Qi(X)}for(const[X,q]of a){if(!F.has(X))continue;let ee={x:B-q.distance.x,y:V-q.distance.y};_&&(ee=Nr(ee,A));let ne=[[w[0][0],w[0][1]],[w[1][0],w[1][1]]];if(a.size>1&&w&&!q.extent){const{positionAbsolute:oe}=q.internals,ce=oe.x-J.x+w[0][0],se=oe.x+q.measured.width-J.x2+w[1][0],he=oe.y-J.y+w[0][1],me=oe.y+q.measured.height-J.y2+w[1][1];ne=[[ce,he],[se,me]]}const{position:H,positionAbsolute:ae}=Ja({nodeId:X,nextPosition:ee,nodeLookup:F,nodeExtent:ne,nodeOrigin:R,onError:L});I=I||q.position.x!==H.x||q.position.y!==H.y,q.position=H,q.internals.positionAbsolute=ae}if(I&&(W(a,!0),z&&(r||N||!v&&P))){const[X,q]=ro({nodeId:v,dragItems:a,nodeLookup:F});r==null||r(z,a,X,q),N==null||N(z,X,q),v||(P==null||P(z,q))}}async function S(){if(!u)return;const{transform:B,panBy:V,autoPanSpeed:z}=e(),[F,w]=nc(l,u,z);(F!==0||w!==0)&&(o.x=(o.x??0)-F/B[2],o.y=(o.y??0)-w/B[2],await V({x:F,y:w})&&T(o,null)),s=requestAnimationFrame(S)}function j(B){var I;const{nodeLookup:V,multiSelectionActive:z,nodesDraggable:F,transform:w,snapGrid:A,snapToGrid:_,selectNodesOnDrag:R,onNodeDragStart:N,onSelectionDragStart:P,unselectNodesAndEdges:L}=e();d=!0,(!R||!x)&&!z&&v&&((I=V.get(v))!=null&&I.selected||L()),x&&R&&v&&(t==null||t(v));const W=Nn(B.sourceEvent,{transform:w,snapGrid:A,snapToGrid:_,containerBounds:u});if(o=W,a=I0(V,F,W,v),a.size>0&&(n||N||!v&&P)){const[J,X]=ro({nodeId:v,dragItems:a,nodeLookup:V});n==null||n(B.sourceEvent,a,J,X),N==null||N(B.sourceEvent,J,X),v||(P==null||P(B.sourceEvent,X))}}const $=ma().clickDistance(C).on("start",B=>{const{domNode:V,nodeDragThreshold:z,transform:F,snapGrid:w,snapToGrid:A}=e();u=(V==null?void 0:V.getBoundingClientRect())||null,p=!1,z===0&&j(B),o=Nn(B.sourceEvent,{transform:F,snapGrid:w,snapToGrid:A,containerBounds:u}),l=nt(B.sourceEvent,u)}).on("drag",B=>{const{autoPanOnNodeDrag:V,transform:z,snapGrid:F,snapToGrid:w,nodeDragThreshold:A,nodeLookup:_}=e(),R=Nn(B.sourceEvent,{transform:z,snapGrid:F,snapToGrid:w,containerBounds:u});if((B.sourceEvent.type==="touchmove"&&B.sourceEvent.touches.length>1||v&&!_.has(v))&&(p=!0),!p){if(!c&&V&&d&&(c=!0,S()),!d){const N=R.xSnapped-(o.x??0),P=R.ySnapped-(o.y??0);Math.sqrt(N*N+P*P)>A&&j(B)}(o.x!==R.xSnapped||o.y!==R.ySnapped)&&a&&d&&(l=nt(B.sourceEvent,u),T(R,B.sourceEvent))}}).on("end",B=>{if(!(!d||p)&&(c=!1,d=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:V,updateNodePositions:z,onNodeDragStop:F,onSelectionDragStop:w}=e();if(z(a,!1),i||F||!v&&w){const[A,_]=ro({nodeId:v,dragItems:a,nodeLookup:V,dragging:!1});i==null||i(B.sourceEvent,a,A,_),F==null||F(B.sourceEvent,A,_),v||(w==null||w(B.sourceEvent,_))}}}).filter(B=>{const V=B.target;return!B.button&&(!y||!_c(V,`.${y}`,b))&&(!g||_c(V,g,b))});h.call($)}function m(){h==null||h.on(".drag",null)}return{update:f,destroy:m}}function B0(t,e,n){const r=[],i={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const o of e.values())Sn(i,Lt(o))>0&&r.push(o);return r}const L0=250;function D0(t,e,n,r){var a,c;let i=[],o=1/0;const s=B0(t,n,e+L0);for(const l of s){const u=[...((a=l.internals.handleBounds)==null?void 0:a.source)??[],...((c=l.internals.handleBounds)==null?void 0:c.target)??[]];for(const d of u){if(r.nodeId===d.nodeId&&r.type===d.type&&r.id===d.id)continue;const{x:h,y:p}=An(l,d,d.position,!0),f=Math.sqrt(Math.pow(h-t.x,2)+Math.pow(p-t.y,2));f>e||(f<o?(i=[{...d,x:h,y:p}],o=f):f===o&&i.push({...d,x:h,y:p}))}}if(!i.length)return null;if(i.length>1){const l=r.type==="source"?"target":"source";return i.find(u=>u.type===l)??i[0]}return i[0]}function Sc(t,e,n,r,i,o=!1){var l,u,d;const s=r.get(t);if(!s)return null;const a=i==="strict"?(l=s.internals.handleBounds)==null?void 0:l[e]:[...((u=s.internals.handleBounds)==null?void 0:u.source)??[],...((d=s.internals.handleBounds)==null?void 0:d.target)??[]],c=(n?a==null?void 0:a.find(h=>h.id===n):a==null?void 0:a[0])??null;return c&&o?{...c,...An(s,c,c.position,!0)}:c}function Oc(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function F0(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const Nc=()=>!0;function z0(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:i,edgeUpdaterType:o,isTarget:s,domNode:a,nodeLookup:c,lib:l,autoPanOnConnect:u,flowId:d,panBy:h,cancelConnection:p,onConnectStart:f,onConnect:m,onConnectEnd:y,isValidConnection:g=Nc,onReconnectEnd:b,updateConnection:x,getTransform:v,getFromHandle:C,autoPanSpeed:T}){const S=cc(t.target);let j=0,$;const{x:B,y:V}=nt(t),z=S==null?void 0:S.elementFromPoint(B,V),F=Oc(o,z),w=a==null?void 0:a.getBoundingClientRect();if(!w||!F)return;const A=Sc(i,F,r,c,e);if(!A)return;let _=nt(t,w),R=!1,N=null,P=!1,L=null;function W(){if(!u||!w)return;const[H,ae]=nc(_,w,T);h({x:H,y:ae}),j=requestAnimationFrame(W)}const I={...A,nodeId:i,type:F,position:A.position},J=c.get(i),X={inProgress:!0,isValid:null,from:An(J,I,re.Left,!0),fromHandle:I,fromPosition:I.position,fromNode:J,to:_,toHandle:null,toPosition:Za[I.position],toNode:null};x(X);let q=X;f==null||f(t,{nodeId:i,handleId:r,handleType:F});function ee(H){if(!C()||!I){ne(H);return}const ae=v();_=nt(H,w),$=D0(On(_,ae,!1,[1,1]),n,c,I),R||(W(),R=!0);const oe=Ac(H,{handle:$,connectionMode:e,fromNodeId:i,fromHandleId:r,fromType:s?"target":"source",isValidConnection:g,doc:S,lib:l,flowId:d,nodeLookup:c});L=oe.handleDomNode,N=oe.connection,P=F0(!!$,oe.isValid);const ce={...q,isValid:P,to:$&&P?oc({x:$.x,y:$.y},ae):_,toHandle:oe.toHandle,toPosition:P&&oe.toHandle?oe.toHandle.position:Za[I.position],toNode:oe.toHandle?c.get(oe.toHandle.nodeId):null};P&&$&&q.toHandle&&ce.toHandle&&q.toHandle.type===ce.toHandle.type&&q.toHandle.nodeId===ce.toHandle.nodeId&&q.toHandle.id===ce.toHandle.id&&q.to.x===ce.to.x&&q.to.y===ce.to.y||(x(ce),q=ce)}function ne(H){($||L)&&N&&P&&(m==null||m(N));const{inProgress:ae,...oe}=q,ce={...oe,toPosition:q.toHandle?q.toPosition:null};y==null||y(H,ce),o&&(b==null||b(H,ce)),p(),cancelAnimationFrame(j),R=!1,P=!1,N=null,L=null,S.removeEventListener("mousemove",ee),S.removeEventListener("mouseup",ne),S.removeEventListener("touchmove",ee),S.removeEventListener("touchend",ne)}S.addEventListener("mousemove",ee),S.addEventListener("mouseup",ne),S.addEventListener("touchmove",ee),S.addEventListener("touchend",ne)}function Ac(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:i,fromType:o,doc:s,lib:a,flowId:c,isValidConnection:l=Nc,nodeLookup:u}){const d=o==="target",h=e?s.querySelector(`.${a}-flow__handle[data-id="${c}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:p,y:f}=nt(t),m=s.elementFromPoint(p,f),y=m!=null&&m.classList.contains(`${a}-flow__handle`)?m:h,g={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const b=Oc(void 0,y),x=y.getAttribute("data-nodeid"),v=y.getAttribute("data-handleid"),C=y.classList.contains("connectable"),T=y.classList.contains("connectableend");if(!x||!b)return g;const S={source:d?x:r,sourceHandle:d?v:i,target:d?r:x,targetHandle:d?i:v};g.connection=S;const j=C&&T&&(n===$t.Strict?d&&b==="source"||!d&&b==="target":x!==r||v!==i);g.isValid=j&&l(S),g.toHandle=Sc(x,b,v,u,n,!1)}return g}const io={onPointerDown:z0,isValid:Ac};function V0({domNode:t,panZoom:e,getTransform:n,getViewScale:r}){const i=Ie(t);function o({translateExtent:a,width:c,height:l,zoomStep:u=10,pannable:d=!0,zoomable:h=!0,inversePan:p=!1}){const f=x=>{const v=n();if(x.sourceEvent.type!=="wheel"||!e)return;const C=-x.sourceEvent.deltaY*(x.sourceEvent.deltaMode===1?.05:x.sourceEvent.deltaMode?1:.002)*u,T=v[2]*Math.pow(2,C);e.scaleTo(T)};let m=[0,0];const y=x=>{(x.sourceEvent.type==="mousedown"||x.sourceEvent.type==="touchstart")&&(m=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY])},g=x=>{const v=n();if(x.sourceEvent.type!=="mousemove"&&x.sourceEvent.type!=="touchmove"||!e)return;const C=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY],T=[C[0]-m[0],C[1]-m[1]];m=C;const S=r()*Math.max(v[2],Math.log(v[2]))*(p?-1:1),j={x:v[0]-T[0]*S,y:v[1]-T[1]*S},$=[[0,0],[c,l]];e.setViewportConstrained({x:j.x,y:j.y,zoom:v[2]},$,a)},b=Ha().on("start",y).on("zoom",d?g:null).on("zoom.wheel",h?f:null);i.call(b,{})}function s(){i.on("zoom",null)}return{update:o,destroy:s,pointer:Le}}const q0=(t,e)=>t.x!==e.x||t.y!==e.y||t.zoom!==e.k,Tr=t=>({x:t.x,y:t.y,zoom:t.k}),oo=({x:t,y:e,zoom:n})=>Er.translate(t,e).scale(n),Ft=(t,e)=>t.target.closest(`.${e}`),Pc=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),so=(t,e=0,n=()=>{})=>{const r=typeof e=="number"&&e>0;return r||n(),r?t.transition().duration(e).on("end",n):t},kc=t=>{const e=t.ctrlKey&&Ar()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function W0({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:i,panOnScrollSpeed:o,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:l}){return u=>{if(Ft(u,e))return!1;u.preventDefault(),u.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(u.ctrlKey&&s){const y=Le(u),g=kc(u),b=d*Math.pow(2,g);r.scaleTo(n,b,y,u);return}const h=u.deltaMode===1?20:1;let p=i===ht.Vertical?0:u.deltaX*h,f=i===ht.Horizontal?0:u.deltaY*h;!Ar()&&u.shiftKey&&i!==ht.Vertical&&(p=u.deltaY*h,f=0),r.translateBy(n,-(p/d)*o,-(f/d)*o,{internal:!0});const m=Tr(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling||(t.isPanScrolling=!0,a==null||a(u,m)),t.isPanScrolling&&(c==null||c(u,m),t.panScrollTimeout=setTimeout(()=>{l==null||l(u,m),t.isPanScrolling=!1},150))}}function H0({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,i){if(!e&&r.type==="wheel"&&!r.ctrlKey||Ft(r,t))return null;r.preventDefault(),n.call(this,r,i)}}function U0({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{var o,s,a;if((o=r.sourceEvent)!=null&&o.internal)return;const i=Tr(r.transform);t.mouseButton=((s=r.sourceEvent)==null?void 0:s.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=i,((a=r.sourceEvent)==null?void 0:a.type)==="mousedown"&&e(!0),n&&(n==null||n(r.sourceEvent,i))}}function Q0({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:i}){return o=>{var s,a;t.usedRightMouseButton=!!(n&&Pc(e,t.mouseButton??0)),(s=o.sourceEvent)!=null&&s.sync||r([o.transform.x,o.transform.y,o.transform.k]),i&&!((a=o.sourceEvent)!=null&&a.internal)&&(i==null||i(o.sourceEvent,Tr(o.transform)))}}function Z0({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:i,onPaneContextMenu:o}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(t.isZoomingOrPanning=!1,o&&Pc(e,t.mouseButton??0)&&!t.usedRightMouseButton&&s.sourceEvent&&o(s.sourceEvent),t.usedRightMouseButton=!1,r(!1),i&&q0(t.prevViewport,s.transform))){const c=Tr(s.transform);t.prevViewport=c,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{i==null||i(s.sourceEvent,c)},n?150:0)}}}function Y0({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:i,zoomOnDoubleClick:o,userSelectionActive:s,noWheelClassName:a,noPanClassName:c,lib:l}){return u=>{var f;const d=t||e,h=n&&u.ctrlKey;if(u.button===1&&u.type==="mousedown"&&(Ft(u,`${l}-flow__node`)||Ft(u,`${l}-flow__edge`)))return!0;if(!r&&!d&&!i&&!o&&!n||s||Ft(u,a)&&u.type==="wheel"||Ft(u,c)&&(u.type!=="wheel"||i&&u.type==="wheel"&&!t)||!n&&u.ctrlKey&&u.type==="wheel")return!1;if(!n&&u.type==="touchstart"&&((f=u.touches)==null?void 0:f.length)>1)return u.preventDefault(),!1;if(!d&&!i&&!h&&u.type==="wheel"||!r&&(u.type==="mousedown"||u.type==="touchstart")||Array.isArray(r)&&!r.includes(u.button)&&u.type==="mousedown")return!1;const p=Array.isArray(r)&&r.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||u.type==="wheel")&&p}}function X0({domNode:t,minZoom:e,maxZoom:n,paneClickDistance:r,translateExtent:i,viewport:o,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:c,onDraggingChange:l}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=t.getBoundingClientRect(),h=Ha().clickDistance(!ze(r)||r<0?0:r).scaleExtent([e,n]).translateExtent(i),p=Ie(t).call(h);x({x:o.x,y:o.y,zoom:Bt(o.zoom,e,n)},[[0,0],[d.width,d.height]],i);const f=p.on("wheel.zoom"),m=p.on("dblclick.zoom");h.wheelDelta(kc);function y(z,F){return p?new Promise(w=>{h==null||h.transform(so(p,F==null?void 0:F.duration,()=>w(!0)),z)}):Promise.resolve(!1)}function g({noWheelClassName:z,noPanClassName:F,onPaneContextMenu:w,userSelectionActive:A,panOnScroll:_,panOnDrag:R,panOnScrollMode:N,panOnScrollSpeed:P,preventScrolling:L,zoomOnPinch:W,zoomOnScroll:I,zoomOnDoubleClick:J,zoomActivationKeyPressed:X,lib:q,onTransformChange:ee}){A&&!u.isZoomingOrPanning&&b();const ne=_&&!X&&!A?W0({zoomPanValues:u,noWheelClassName:z,d3Selection:p,d3Zoom:h,panOnScrollMode:N,panOnScrollSpeed:P,zoomOnPinch:W,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:c}):H0({noWheelClassName:z,preventScrolling:L,d3ZoomHandler:f});if(p.on("wheel.zoom",ne,{passive:!1}),!A){const ae=U0({zoomPanValues:u,onDraggingChange:l,onPanZoomStart:a});h.on("start",ae);const oe=Q0({zoomPanValues:u,panOnDrag:R,onPaneContextMenu:!!w,onPanZoom:s,onTransformChange:ee});h.on("zoom",oe);const ce=Z0({zoomPanValues:u,panOnDrag:R,panOnScroll:_,onPaneContextMenu:w,onPanZoomEnd:c,onDraggingChange:l});h.on("end",ce)}const H=Y0({zoomActivationKeyPressed:X,panOnDrag:R,zoomOnScroll:I,panOnScroll:_,zoomOnDoubleClick:J,zoomOnPinch:W,userSelectionActive:A,noPanClassName:F,noWheelClassName:z,lib:q});h.filter(H),J?p.on("dblclick.zoom",m):p.on("dblclick.zoom",null)}function b(){h.on("zoom",null)}async function x(z,F,w){const A=oo(z),_=h==null?void 0:h.constrain()(A,F,w);return _&&await y(_),new Promise(R=>R(_))}async function v(z,F){const w=oo(z);return await y(w,F),new Promise(A=>A(w))}function C(z){if(p){const F=oo(z),w=p.property("__zoom");(w.k!==z.zoom||w.x!==z.x||w.y!==z.y)&&(h==null||h.transform(p,F,null,{sync:!0}))}}function T(){const z=p?qa(p.node()):{x:0,y:0,k:1};return{x:z.x,y:z.y,zoom:z.k}}function S(z,F){return p?new Promise(w=>{h==null||h.scaleTo(so(p,F==null?void 0:F.duration,()=>w(!0)),z)}):Promise.resolve(!1)}function j(z,F){return p?new Promise(w=>{h==null||h.scaleBy(so(p,F==null?void 0:F.duration,()=>w(!0)),z)}):Promise.resolve(!1)}function $(z){h==null||h.scaleExtent(z)}function B(z){h==null||h.translateExtent(z)}function V(z){const F=!ze(z)||z<0?0:z;h==null||h.clickDistance(F)}return{update:g,destroy:b,setViewport:v,setViewportConstrained:x,getViewport:T,scaleTo:S,scaleBy:j,setScaleExtent:$,setTranslateExtent:B,syncViewport:C,setClickDistance:V}}var zt;(function(t){t.Line="line",t.Handle="handle"})(zt||(zt={}));const G0=["top-left","top-right","bottom-left","bottom-right"],K0=["top","right","bottom","left"];function J0({width:t,prevWidth:e,height:n,prevHeight:r,affectsX:i,affectsY:o}){const s=t-e,a=n-r,c=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&i&&(c[0]=c[0]*-1),a&&o&&(c[1]=c[1]*-1),c}function ex(t){const e=t.includes("right")||t.includes("left"),n=t.includes("bottom")||t.includes("top"),r=t.includes("left"),i=t.includes("top");return{isHorizontal:e,isVertical:n,affectsX:r,affectsY:i}}function st(t,e){return Math.max(0,e-t)}function at(t,e){return Math.max(0,t-e)}function jr(t,e,n){return Math.max(0,e-t,t-n)}function Tc(t,e){return t?!e:e}function tx(t,e,n,r,i,o,s,a){let{affectsX:c,affectsY:l}=e;const{isHorizontal:u,isVertical:d}=e,h=u&&d,{xSnapped:p,ySnapped:f}=n,{minWidth:m,maxWidth:y,minHeight:g,maxHeight:b}=r,{x,y:v,width:C,height:T,aspectRatio:S}=t;let j=Math.floor(u?p-t.pointerX:0),$=Math.floor(d?f-t.pointerY:0);const B=C+(c?-j:j),V=T+(l?-$:$),z=-o[0]*C,F=-o[1]*T;let w=jr(B,m,y),A=jr(V,g,b);if(s){let N=0,P=0;c&&j<0?N=st(x+j+z,s[0][0]):!c&&j>0&&(N=at(x+B+z,s[1][0])),l&&$<0?P=st(v+$+F,s[0][1]):!l&&$>0&&(P=at(v+V+F,s[1][1])),w=Math.max(w,N),A=Math.max(A,P)}if(a){let N=0,P=0;c&&j>0?N=at(x+j,a[0][0]):!c&&j<0&&(N=st(x+B,a[1][0])),l&&$>0?P=at(v+$,a[0][1]):!l&&$<0&&(P=st(v+V,a[1][1])),w=Math.max(w,N),A=Math.max(A,P)}if(i){if(u){const N=jr(B/S,g,b)*S;if(w=Math.max(w,N),s){let P=0;!c&&!l||c&&!l&&h?P=at(v+F+B/S,s[1][1])*S:P=st(v+F+(c?j:-j)/S,s[0][1])*S,w=Math.max(w,P)}if(a){let P=0;!c&&!l||c&&!l&&h?P=st(v+B/S,a[1][1])*S:P=at(v+(c?j:-j)/S,a[0][1])*S,w=Math.max(w,P)}}if(d){const N=jr(V*S,m,y)/S;if(A=Math.max(A,N),s){let P=0;!c&&!l||l&&!c&&h?P=at(x+V*S+z,s[1][0])/S:P=st(x+(l?$:-$)*S+z,s[0][0])/S,A=Math.max(A,P)}if(a){let P=0;!c&&!l||l&&!c&&h?P=st(x+V*S,a[1][0])/S:P=at(x+(l?$:-$)*S,a[0][0])/S,A=Math.max(A,P)}}}$=$+($<0?A:-A),j=j+(j<0?w:-w),i&&(h?B>V*S?$=(Tc(c,l)?-j:j)/S:j=(Tc(c,l)?-$:$)*S:u?($=j/S,l=c):(j=$*S,c=l));const _=c?x+j:x,R=l?v+$:v;return{width:C+(c?-j:j),height:T+(l?-$:$),x:o[0]*j*(c?-1:1)+_,y:o[1]*$*(l?-1:1)+R}}const jc={width:0,height:0,x:0,y:0},nx={...jc,pointerX:0,pointerY:0,aspectRatio:1};function rx(t){return[[0,0],[t.measured.width,t.measured.height]]}function ix(t,e,n){const r=e.position.x+t.position.x,i=e.position.y+t.position.y,o=t.measured.width??0,s=t.measured.height??0,a=n[0]*o,c=n[1]*s;return[[r-a,i-c],[r+o-a,i+s-c]]}function ox({domNode:t,nodeId:e,getStoreItems:n,onChange:r,onEnd:i}){const o=Ie(t);function s({controlPosition:c,boundaries:l,keepAspectRatio:u,onResizeStart:d,onResize:h,onResizeEnd:p,shouldResize:f}){let m={...jc},y={...nx};const g=ex(c);let b,x=null,v=[],C,T,S;const j=ma().on("start",$=>{const{nodeLookup:B,transform:V,snapGrid:z,snapToGrid:F,nodeOrigin:w,paneDomNode:A}=n();if(b=B.get(e),!b)return;x=(A==null?void 0:A.getBoundingClientRect())??null;const{xSnapped:_,ySnapped:R}=Nn($.sourceEvent,{transform:V,snapGrid:z,snapToGrid:F,containerBounds:x});m={width:b.measured.width??0,height:b.measured.height??0,x:b.position.x??0,y:b.position.y??0},y={...m,pointerX:_,pointerY:R,aspectRatio:m.width/m.height},C=void 0,b.parentId&&(b.extent==="parent"||b.expandParent)&&(C=B.get(b.parentId),T=C&&b.extent==="parent"?rx(C):void 0),v=[],S=void 0;for(const[N,P]of B)if(P.parentId===e&&(v.push({id:N,position:{...P.position},extent:P.extent}),P.extent==="parent"||P.expandParent)){const L=ix(P,b,P.origin??w);S?S=[[Math.min(L[0][0],S[0][0]),Math.min(L[0][1],S[0][1])],[Math.max(L[1][0],S[1][0]),Math.max(L[1][1],S[1][1])]]:S=L}d==null||d($,{...m})}).on("drag",$=>{const{transform:B,snapGrid:V,snapToGrid:z,nodeOrigin:F}=n(),w=Nn($.sourceEvent,{transform:B,snapGrid:V,snapToGrid:z,containerBounds:x}),A=[];if(!b)return;const{x:_,y:R,width:N,height:P}=m,L={},W=b.origin??F,{width:I,height:J,x:X,y:q}=tx(y,g,w,l,u,W,T,S),ee=I!==N,ne=J!==P,H=X!==_&&ee,ae=q!==R&&ne;if(!H&&!ae&&!ee&&!ne)return;if((H||ae||W[0]===1||W[1]===1)&&(L.x=H?X:m.x,L.y=ae?q:m.y,m.x=L.x,m.y=L.y,v.length>0)){const se=X-_,he=q-R;for(const me of v)me.position={x:me.position.x-se+W[0]*(I-N),y:me.position.y-he+W[1]*(J-P)},A.push(me)}if((ee||ne)&&(L.width=ee?I:m.width,L.height=ne?J:m.height,m.width=L.width,m.height=L.height),C&&b.expandParent){const se=W[0]*(L.width??0);L.x&&L.x<se&&(m.x=se,y.x=y.x-(L.x-se));const he=W[1]*(L.height??0);L.y&&L.y<he&&(m.y=he,y.y=y.y-(L.y-he))}const oe=J0({width:m.width,prevWidth:N,height:m.height,prevHeight:P,affectsX:g.affectsX,affectsY:g.affectsY}),ce={...m,direction:oe};(f==null?void 0:f($,ce))!==!1&&(h==null||h($,ce),r(L,A))}).on("end",$=>{p==null||p($,{...m}),i==null||i()});o.call(j)}function a(){o.on(".drag",null)}return{update:s,destroy:a}}var Rc={exports:{}},Ic={},$c={exports:{}},Bc={},Vt=M;function sx(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ax=typeof Object.is=="function"?Object.is:sx,cx=Vt.useState,lx=Vt.useEffect,ux=Vt.useLayoutEffect,dx=Vt.useDebugValue;function hx(t,e){var n=e(),r=cx({inst:{value:n,getSnapshot:e}}),i=r[0].inst,o=r[1];return ux(function(){i.value=n,i.getSnapshot=e,ao(i)&&o({inst:i})},[t,n,e]),lx(function(){return ao(i)&&o({inst:i}),t(function(){ao(i)&&o({inst:i})})},[t]),dx(n),n}function ao(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ax(t,n)}catch{return!0}}function px(t,e){return e()}var fx=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?px:hx;Bc.useSyncExternalStore=Vt.useSyncExternalStore!==void 0?Vt.useSyncExternalStore:fx,$c.exports=Bc,Si=$c.exports,yf=Ze(Si);var Rr=M,mx=Si;function yx(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var gx=typeof Object.is=="function"?Object.is:yx,xx=mx.useSyncExternalStore,vx=Rr.useRef,bx=Rr.useEffect,wx=Rr.useMemo,Mx=Rr.useDebugValue;Ic.useSyncExternalStoreWithSelector=function(t,e,n,r,i){var o=vx(null);if(o.current===null){var s={hasValue:!1,value:null};o.current=s}else s=o.current;o=wx(function(){function c(p){if(!l){if(l=!0,u=p,p=r(p),i!==void 0&&s.hasValue){var f=s.value;if(i(f,p))return d=f}return d=p}if(f=d,gx(u,p))return f;var m=r(p);return i!==void 0&&i(f,m)?f:(u=p,d=m)}var l=!1,u,d,h=n===void 0?null:n;return[function(){return c(e())},h===null?void 0:function(){return c(h())}]},[e,n,r,i]);var a=xx(t,o[0],o[1]);return bx(function(){s.hasValue=!0,s.value=a},[a]),Mx(a),a},Rc.exports=Ic;var Ex=Rc.exports;let Lc,co,Dc,Fc,zc,Vc;$s=Ze(Ex),Lc={BASE_URL:"/NoLLMChat/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BASE_URL:"/NoLLMChat/"},co=t=>{let e;const n=new Set,r=(a,c)=>{const l=typeof a=="function"?a(e):a;if(!Object.is(l,e)){const u=e;e=c??(typeof l!="object"||l===null)?l:Object.assign({},e,l),n.forEach(d=>d(e,u))}},i=()=>e,o={setState:r,getState:i,getInitialState:()=>s,subscribe:a=>(n.add(a),()=>n.delete(a)),destroy:()=>{(Lc?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},s=e=t(r,i,o);return o},Dc=t=>t?co(t):co,{useDebugValue:Fc}=_O,{useSyncExternalStoreWithSelector:zc}=$s,Vc=t=>t;function qc(t,e=Vc,n){const r=zc(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return Fc(r),r}const Wc=(t,e)=>{const n=Dc(t),r=(i,o=e)=>qc(n,i,o);return Object.assign(r,n),r},Cx=(t,e)=>t?Wc(t,e):Wc;function xe(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[r,i]of t)if(!Object.is(i,e.get(r)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(t[r],e[r]))return!1;return!0}const Ir=M.createContext(null),_x=Ir.Provider,Hc=et.error001();ue=function(t,e){const n=M.useContext(Ir);if(n===null)throw new Error(Hc);return qc(n,t,e)},ye=function(){const t=M.useContext(Ir);if(t===null)throw new Error(Hc);return M.useMemo(()=>({getState:t.getState,setState:t.setState,subscribe:t.subscribe}),[t])};const Uc={display:"none"},Sx={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Qc="react-flow__node-desc",Zc="react-flow__edge-desc",Ox="react-flow__aria-live",Nx=t=>t.ariaLiveMessage;function Ax({rfId:t}){const e=ue(Nx);return E.jsx("div",{id:`${Ox}-${t}`,"aria-live":"assertive","aria-atomic":"true",style:Sx,children:e})}function Px({rfId:t,disableKeyboardA11y:e}){return E.jsxs(E.Fragment,{children:[E.jsxs("div",{id:`${Qc}-${t}`,style:Uc,children:["Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "]}),E.jsx("div",{id:`${Zc}-${t}`,style:Uc,children:"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."}),!e&&E.jsx(Ax,{rfId:t})]})}const kx=t=>t.userSelectionActive?"none":"all";Kn=function({position:t="top-left",children:e,className:n,style:r,...i}){const o=ue(kx),s=`${t}`.split("-");return E.jsx("div",{className:Me(["react-flow__panel",n,...s]),style:{...r,pointerEvents:o},...i,children:e})};function Tx({proOptions:t,position:e="bottom-right"}){return t!=null&&t.hideAttribution?null:E.jsx(Kn,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:E.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const jx=t=>{const e=[],n=[];for(const[,r]of t.nodeLookup)r.selected&&e.push(r.internals.userNode);for(const[,r]of t.edgeLookup)r.selected&&n.push(r);return{selectedNodes:e,selectedEdges:n}},$r=t=>t.id;function Rx(t,e){return xe(t.selectedNodes.map($r),e.selectedNodes.map($r))&&xe(t.selectedEdges.map($r),e.selectedEdges.map($r))}function Ix({onSelectionChange:t}){const e=ye(),{selectedNodes:n,selectedEdges:r}=ue(jx,Rx);return M.useEffect(()=>{const i={nodes:n,edges:r};t==null||t(i),e.getState().onSelectionChangeHandlers.forEach(o=>o(i))},[n,r,t]),null}const $x=t=>!!t.onSelectionChangeHandlers;function Bx({onSelectionChange:t}){const e=ue($x);return t||e?E.jsx(Ix,{onSelectionChange:t}):null}const Yc=[0,0],Lx={x:0,y:0,zoom:1},Dx=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance"],Xc=[...Dx,"rfId"],Fx=t=>({setNodes:t.setNodes,setEdges:t.setEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setPaneClickDistance:t.setPaneClickDistance}),Gc={translateExtent:Mn,nodeOrigin:Yc,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function zx(t){const{setNodes:e,setEdges:n,setMinZoom:r,setMaxZoom:i,setTranslateExtent:o,setNodeExtent:s,reset:a,setDefaultNodesAndEdges:c,setPaneClickDistance:l}=ue(Fx,xe),u=ye();M.useEffect(()=>(c(t.defaultNodes,t.defaultEdges),()=>{d.current=Gc,a()}),[]);const d=M.useRef(Gc);return M.useEffect(()=>{for(const h of Xc){const p=t[h],f=d.current[h];p!==f&&(typeof t[h]>"u"||(h==="nodes"?e(p):h==="edges"?n(p):h==="minZoom"?r(p):h==="maxZoom"?i(p):h==="translateExtent"?o(p):h==="nodeExtent"?s(p):h==="paneClickDistance"?l(p):h==="fitView"?u.setState({fitViewOnInit:p}):h==="fitViewOptions"?u.setState({fitViewOnInitOptions:p}):u.setState({[h]:p})))}d.current=t},Xc.map(h=>t[h])),null}function Kc(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function Vx(t){var r;const[e,n]=M.useState(t==="system"?null:t);return M.useEffect(()=>{if(t!=="system"){n(t);return}const i=Kc(),o=()=>n(i!=null&&i.matches?"dark":"light");return o(),i==null||i.addEventListener("change",o),()=>{i==null||i.removeEventListener("change",o)}},[t]),e!==null?e:(r=Kc())!=null&&r.matches?"dark":"light"}const Jc=typeof document<"u"?document:null;function Pn(t=null,e={target:Jc,actInsideInputWithModifier:!0}){const[n,r]=M.useState(!1),i=M.useRef(!1),o=M.useRef(new Set([])),[s,a]=M.useMemo(()=>{if(t!==null){const c=(Array.isArray(t)?t:[t]).filter(u=>typeof u=="string").map(u=>u.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=c.reduce((u,d)=>u.concat(...d),[]);return[c,l]}return[[],[]]},[t]);return M.useEffect(()=>{const c=(e==null?void 0:e.target)||Jc;if(t!==null){const l=h=>{if(i.current=h.ctrlKey||h.metaKey||h.shiftKey,(!i.current||i.current&&!e.actInsideInputWithModifier)&&Yi(h))return!1;const p=tl(h.code,a);o.current.add(h[p]),el(s,o.current,!1)&&(h.preventDefault(),r(!0))},u=h=>{if((!i.current||i.current&&!e.actInsideInputWithModifier)&&Yi(h))return!1;const p=tl(h.code,a);el(s,o.current,!0)?(r(!1),o.current.clear()):o.current.delete(h[p]),h.key==="Meta"&&o.current.clear(),i.current=!1},d=()=>{o.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",l),c==null||c.addEventListener("keyup",u),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{c==null||c.removeEventListener("keydown",l),c==null||c.removeEventListener("keyup",u),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[t,r]),n}function el(t,e,n){return t.filter(r=>n||r.length===e.size).some(r=>r.every(i=>e.has(i)))}function tl(t,e){return e.includes(t)?"code":"key"}const qx=()=>{const t=ye();return M.useMemo(()=>({zoomIn:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1/1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomTo:(e,n)=>{const{panZoom:r}=t.getState();return r?r.scaleTo(e,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>t.getState().transform[2],setViewport:async(e,n)=>{const{transform:[r,i,o],panZoom:s}=t.getState();return s?(await s.setViewport({x:e.x??r,y:e.y??i,zoom:e.zoom??o},{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,n,r]=t.getState().transform;return{x:e,y:n,zoom:r}},fitView:e=>{const{nodeLookup:n,minZoom:r,maxZoom:i,panZoom:o,domNode:s}=t.getState();if(!o||!s)return Promise.resolve(!1);const a=Hi(n,e),{width:c,height:l}=Pr(s);return Ui({nodes:a,width:c,height:l,minZoom:r,maxZoom:i,panZoom:o},e)},setCenter:async(e,n,r)=>{const{width:i,height:o,maxZoom:s,panZoom:a}=t.getState(),c=typeof(r==null?void 0:r.zoom)<"u"?r.zoom:s,l=i/2-e*c,u=o/2-n*c;return a?(await a.setViewport({x:l,y:u,zoom:c},{duration:r==null?void 0:r.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitBounds:async(e,n)=>{const{width:r,height:i,minZoom:o,maxZoom:s,panZoom:a}=t.getState(),c=Zi(e,r,i,o,s,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(c,{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,n={snapToGrid:!0})=>{const{transform:r,snapGrid:i,domNode:o}=t.getState();if(!o)return e;const{x:s,y:a}=o.getBoundingClientRect(),c={x:e.x-s,y:e.y-a};return On(c,r,n.snapToGrid,i)},flowToScreenPosition:e=>{const{transform:n,domNode:r}=t.getState();if(!r)return e;const{x:i,y:o}=r.getBoundingClientRect(),s=oc(e,n);return{x:s.x+i,y:s.y+o}}}),[])};function nl(t,e){const n=[],r=new Map,i=[];for(const o of t)if(o.type==="add"){i.push(o);continue}else if(o.type==="remove"||o.type==="replace")r.set(o.id,[o]);else{const s=r.get(o.id);s?s.push(o):r.set(o.id,[o])}for(const o of e){const s=r.get(o.id);if(!s){n.push(o);continue}if(s[0].type==="remove")continue;if(s[0].type==="replace"){n.push({...s[0].item});continue}const a={...o};for(const c of s)Wx(c,a);n.push(a)}return i.length&&i.forEach(o=>{o.index!==void 0?n.splice(o.index,0,{...o.item}):n.push({...o.item})}),n}function Wx(t,e){switch(t.type){case"select":{e.selected=t.selected;break}case"position":{typeof t.position<"u"&&(e.position=t.position),typeof t.dragging<"u"&&(e.dragging=t.dragging);break}case"dimensions":{typeof t.dimensions<"u"&&(e.measured??(e.measured={}),e.measured.width=t.dimensions.width,e.measured.height=t.dimensions.height,t.setAttributes&&(e.width=t.dimensions.width,e.height=t.dimensions.height)),typeof t.resizing=="boolean"&&(e.resizing=t.resizing);break}}}dt=function(t,e){return nl(t,e)};function kn(t,e){return nl(t,e)}function gt(t,e){return{id:t,type:"select",selected:e}}function qt(t,e=new Set,n=!1){const r=[];for(const[i,o]of t){const s=e.has(i);!(o.selected===void 0&&!s)&&o.selected!==s&&(n&&(o.selected=s),r.push(gt(o.id,s)))}return r}function rl({items:t=[],lookup:e}){var i;const n=[],r=new Map(t.map(o=>[o.id,o]));for(const[o,s]of t.entries()){const a=e.get(s.id),c=((i=a==null?void 0:a.internals)==null?void 0:i.userNode)??a;c!==void 0&&c!==s&&n.push({id:s.id,item:s,type:"replace"}),c===void 0&&n.push({item:s,type:"add",index:o})}for(const[o]of e)r.get(o)===void 0&&n.push({id:o,type:"remove"});return n}function il(t){return{id:t.id,type:"remove"}}const ol=t=>f0(t),Hx=t=>Ga(t);function sl(t){return M.forwardRef(t)}const Ux=typeof window<"u"?M.useLayoutEffect:M.useEffect;function al(t){const[e,n]=M.useState(BigInt(0)),[r]=M.useState(()=>Qx(()=>n(i=>i+BigInt(1))));return Ux(()=>{const i=r.get();i.length&&(t(i),r.reset())},[e]),r}function Qx(t){let e=[];return{get:()=>e,reset:()=>{e=[]},push:n=>{e.push(n),t()}}}const cl=M.createContext(null);function Zx({children:t}){const e=ye(),n=M.useCallback(a=>{const{nodes:c=[],setNodes:l,hasDefaultNodes:u,onNodesChange:d,nodeLookup:h}=e.getState();let p=c;for(const f of a)p=typeof f=="function"?f(p):f;u?l(p):d&&d(rl({items:p,lookup:h}))},[]),r=al(n),i=M.useCallback(a=>{const{edges:c=[],setEdges:l,hasDefaultEdges:u,onEdgesChange:d,edgeLookup:h}=e.getState();let p=c;for(const f of a)p=typeof f=="function"?f(p):f;u?l(p):d&&d(rl({items:p,lookup:h}))},[]),o=al(i),s=M.useMemo(()=>({nodeQueue:r,edgeQueue:o}),[]);return E.jsx(cl.Provider,{value:s,children:t})}function Yx(){const t=M.useContext(cl);if(!t)throw new Error("useBatchContext must be used within a BatchProvider");return t}const Xx=t=>!!t.panZoom;er=function(){const t=qx(),e=ye(),n=Yx(),r=ue(Xx),i=M.useMemo(()=>{const o=d=>e.getState().nodeLookup.get(d),s=d=>{n.nodeQueue.push(d)},a=d=>{n.edgeQueue.push(d)},c=d=>{var g,b;const{nodeLookup:h,nodeOrigin:p}=e.getState(),f=ol(d)?d:h.get(d.id),m=f.parentId?ac(f.position,f.measured,f.parentId,h,p):f.position,y={id:f.id,position:m,width:((g=f.measured)==null?void 0:g.width)??f.width,height:((b=f.measured)==null?void 0:b.height)??f.height,data:f.data};return Lt(y)},l=(d,h,p={replace:!1})=>{s(f=>f.map(m=>{if(m.id===d){const y=typeof h=="function"?h(m):h;return p.replace&&ol(y)?y:{...m,...y}}return m}))},u=(d,h,p={replace:!1})=>{a(f=>f.map(m=>{if(m.id===d){const y=typeof h=="function"?h(m):h;return p.replace&&Hx(y)?y:{...m,...y}}return m}))};return{getNodes:()=>e.getState().nodes.map(d=>({...d})),getNode:d=>{var h;return(h=o(d))==null?void 0:h.internals.userNode},getInternalNode:o,getEdges:()=>{const{edges:d=[]}=e.getState();return d.map(h=>({...h}))},getEdge:d=>e.getState().edgeLookup.get(d),setNodes:s,setEdges:a,addNodes:d=>{const h=Array.isArray(d)?d:[d];n.nodeQueue.push(p=>[...p,...h])},addEdges:d=>{const h=Array.isArray(d)?d:[d];n.edgeQueue.push(p=>[...p,...h])},toObject:()=>{const{nodes:d=[],edges:h=[],transform:p}=e.getState(),[f,m,y]=p;return{nodes:d.map(g=>({...g})),edges:h.map(g=>({...g})),viewport:{x:f,y:m,zoom:y}}},deleteElements:async({nodes:d=[],edges:h=[]})=>{const{nodes:p,edges:f,onNodesDelete:m,onEdgesDelete:y,triggerNodeChanges:g,triggerEdgeChanges:b,onDelete:x,onBeforeDelete:v}=e.getState(),{nodes:C,edges:T}=await g0({nodesToRemove:d,edgesToRemove:h,nodes:p,edges:f,onBeforeDelete:v}),S=T.length>0,j=C.length>0;if(S){const $=T.map(il);y==null||y(T),b($)}if(j){const $=C.map(il);m==null||m(C),g($)}return(j||S)&&(x==null||x({nodes:C,edges:T})),{deletedNodes:C,deletedEdges:T}},getIntersectingNodes:(d,h=!0,p)=>{const f=ic(d),m=f?d:c(d),y=p!==void 0;return m?(p||e.getState().nodes).filter(g=>{const b=e.getState().nodeLookup.get(g.id);if(b&&!f&&(g.id===d.id||!b.internals.positionAbsolute))return!1;const x=Lt(y?g:b),v=Sn(x,m);return h&&v>0||v>=m.width*m.height}):[]},isNodeIntersecting:(d,h,p=!0)=>{const f=ic(d)?d:c(d);if(!f)return!1;const m=Sn(f,h);return p&&m>0||m>=f.width*f.height},updateNode:l,updateNodeData:(d,h,p={replace:!1})=>{l(d,f=>{const m=typeof h=="function"?h(f):h;return p.replace?{...f,data:m}:{...f,data:{...f.data,...m}}},p)},updateEdge:u,updateEdgeData:(d,h,p={replace:!1})=>{u(d,f=>{const m=typeof h=="function"?h(f):h;return p.replace?{...f,data:m}:{...f,data:{...f.data,...m}}},p)},getNodesBounds:d=>{const{nodeLookup:h,nodeOrigin:p}=e.getState();return m0(d,{nodeLookup:h,nodeOrigin:p})},getHandleConnections:({type:d,id:h,nodeId:p})=>{var f;return Array.from(((f=e.getState().connectionLookup.get(`${p}-${d}-${h??null}`))==null?void 0:f.values())??[])}}},[]);return M.useMemo(()=>({...i,...t,viewportInitialized:r}),[r])};const ll=t=>t.selected,Gx={actInsideInputWithModifier:!1},Kx=typeof window<"u"?window:void 0;function Jx({deleteKeyCode:t,multiSelectionKeyCode:e}){const n=ye(),{deleteElements:r}=er(),i=Pn(t,Gx),o=Pn(e,{target:Kx});M.useEffect(()=>{if(i){const{edges:s,nodes:a}=n.getState();r({nodes:a.filter(ll),edges:s.filter(ll)}),n.setState({nodesSelectionActive:!1})}},[i]),M.useEffect(()=>{n.setState({multiSelectionActive:o})},[o])}function e1(t){const e=ye();M.useEffect(()=>{const n=()=>{var i,o;if(!t.current)return!1;const r=Pr(t.current);(r.height===0||r.width===0)&&((o=(i=e.getState()).onError)==null||o.call(i,"004",et.error004())),e.setState({width:r.width||500,height:r.height||500})};if(t.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(t.current),()=>{window.removeEventListener("resize",n),r&&t.current&&r.unobserve(t.current)}}},[])}const Br={position:"absolute",width:"100%",height:"100%",top:0,left:0},t1=t=>({userSelectionActive:t.userSelectionActive,lib:t.lib});function n1({onPaneContextMenu:t,zoomOnScroll:e=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:i=.5,panOnScrollMode:o=ht.Free,zoomOnDoubleClick:s=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:l,minZoom:u,maxZoom:d,zoomActivationKeyCode:h,preventScrolling:p=!0,children:f,noWheelClassName:m,noPanClassName:y,onViewportChange:g,isControlledViewport:b,paneClickDistance:x}){const v=ye(),C=M.useRef(null),{userSelectionActive:T,lib:S}=ue(t1,xe),j=Pn(h),$=M.useRef();e1(C);const B=M.useCallback(V=>{g==null||g({x:V[0],y:V[1],zoom:V[2]}),b||v.setState({transform:V})},[g,b]);return M.useEffect(()=>{if(C.current){$.current=X0({domNode:C.current,minZoom:u,maxZoom:d,translateExtent:l,viewport:c,paneClickDistance:x,onDraggingChange:w=>v.setState({paneDragging:w}),onPanZoomStart:(w,A)=>{const{onViewportChangeStart:_,onMoveStart:R}=v.getState();R==null||R(w,A),_==null||_(A)},onPanZoom:(w,A)=>{const{onViewportChange:_,onMove:R}=v.getState();R==null||R(w,A),_==null||_(A)},onPanZoomEnd:(w,A)=>{const{onViewportChangeEnd:_,onMoveEnd:R}=v.getState();R==null||R(w,A),_==null||_(A)}});const{x:V,y:z,zoom:F}=$.current.getViewport();return v.setState({panZoom:$.current,transform:[V,z,F],domNode:C.current.closest(".react-flow")}),()=>{var w;(w=$.current)==null||w.destroy()}}},[]),M.useEffect(()=>{var V;(V=$.current)==null||V.update({onPaneContextMenu:t,zoomOnScroll:e,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:i,panOnScrollMode:o,zoomOnDoubleClick:s,panOnDrag:a,zoomActivationKeyPressed:j,preventScrolling:p,noPanClassName:y,userSelectionActive:T,noWheelClassName:m,lib:S,onTransformChange:B})},[t,e,n,r,i,o,s,a,j,p,y,T,m,S,B]),E.jsx("div",{className:"react-flow__renderer",ref:C,style:Br,children:f})}const r1=t=>({userSelectionActive:t.userSelectionActive,userSelectionRect:t.userSelectionRect});function i1(){const{userSelectionActive:t,userSelectionRect:e}=ue(r1,xe);return t&&e?E.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const lo=(t,e)=>n=>{n.target===e.current&&(t==null||t(n))},o1=t=>({userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable,dragging:t.paneDragging});function s1({isSelecting:t,selectionKeyPressed:e,selectionMode:n=En.Full,panOnDrag:r,selectionOnDrag:i,onSelectionStart:o,onSelectionEnd:s,onPaneClick:a,onPaneContextMenu:c,onPaneScroll:l,onPaneMouseEnter:u,onPaneMouseMove:d,onPaneMouseLeave:h,children:p}){const f=M.useRef(null),m=ye(),y=M.useRef(0),g=M.useRef(0),b=M.useRef(),x=M.useRef(new Map),{userSelectionActive:v,elementsSelectable:C,dragging:T}=ue(o1,xe),S=C&&(t||v),j=M.useRef(!1),$=M.useRef(!1),B=()=>{m.setState({userSelectionActive:!1,userSelectionRect:null}),y.current=0,g.current=0},V=N=>{if(j.current){j.current=!1;return}a==null||a(N),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1})},z=N=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){N.preventDefault();return}c==null||c(N)},F=l?N=>l(N):void 0,w=N=>{var X,q,ee,ne;const{resetSelectedElements:P,domNode:L,edgeLookup:W}=m.getState();if(b.current=L==null?void 0:L.getBoundingClientRect(),!C||!t||N.button!==0||N.target!==f.current||!b.current)return;(q=(X=N.target)==null?void 0:X.setPointerCapture)==null||q.call(X,N.pointerId),$.current=!0,j.current=!1,x.current=new Map;for(const[H,ae]of W)x.current.set(ae.source,((ee=x.current.get(ae.source))==null?void 0:ee.add(H))||new Set([H])),x.current.set(ae.target,((ne=x.current.get(ae.target))==null?void 0:ne.add(H))||new Set([H]));const{x:I,y:J}=nt(N.nativeEvent,b.current);P(),m.setState({userSelectionRect:{width:0,height:0,startX:I,startY:J,x:I,y:J}}),o==null||o(N)},A=N=>{const{userSelectionRect:P,edgeLookup:L,transform:W,nodeLookup:I,triggerNodeChanges:J,triggerEdgeChanges:X}=m.getState();if(!b.current||!P)return;j.current=!0;const{x:q,y:ee}=nt(N.nativeEvent,b.current),{startX:ne,startY:H}=P,ae={startX:ne,startY:H,x:q<ne?q:ne,y:ee<H?ee:H,width:Math.abs(q-ne),height:Math.abs(ee-H)},oe=Ka(I,ae,W,n===En.Partial,!0),ce=new Set,se=new Set;for(const he of oe){se.add(he.id);const me=x.current.get(he.id);if(me)for(const Te of me)ce.add(Te)}if(y.current!==se.size){y.current=se.size;const he=qt(I,se,!0);J(he)}if(g.current!==ce.size){g.current=ce.size;const he=qt(L,ce);X(he)}m.setState({userSelectionRect:ae,userSelectionActive:!0,nodesSelectionActive:!1})},_=N=>{var L,W;if(N.button!==0||!$.current)return;(W=(L=N.target)==null?void 0:L.releasePointerCapture)==null||W.call(L,N.pointerId);const{userSelectionRect:P}=m.getState();!v&&P&&N.target===f.current&&(V==null||V(N)),y.current>0&&m.setState({nodesSelectionActive:!0}),B(),s==null||s(N),(e||i)&&(j.current=!1),$.current=!1},R=r===!0||Array.isArray(r)&&r.includes(0);return E.jsxs("div",{className:Me(["react-flow__pane",{draggable:R,dragging:T,selection:t}]),onClick:S?void 0:lo(V,f),onContextMenu:lo(z,f),onWheel:lo(F,f),onPointerEnter:S?void 0:u,onPointerDown:S?w:d,onPointerMove:S?A:d,onPointerUp:S?_:void 0,onPointerLeave:h,ref:f,style:Br,children:[p,E.jsx(i1,{})]})}function uo({id:t,store:e,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:i,unselectNodesAndEdges:o,multiSelectionActive:s,nodeLookup:a,onError:c}=e.getState(),l=a.get(t);if(!l){c==null||c("012",et.error012(t));return}e.setState({nodesSelectionActive:!1}),l.selected?(n||l.selected&&s)&&(o({nodes:[l],edges:[]}),requestAnimationFrame(()=>{var u;return(u=r==null?void 0:r.current)==null?void 0:u.blur()})):i([t])}function ul({nodeRef:t,disabled:e=!1,noDragClassName:n,handleSelector:r,nodeId:i,isSelectable:o,nodeClickDistance:s}){const a=ye(),[c,l]=M.useState(!1),u=M.useRef();return M.useEffect(()=>{u.current=$0({getStoreItems:()=>a.getState(),onNodeMouseDown:d=>{uo({id:d,store:a,nodeRef:t})},onDragStart:()=>{l(!0)},onDragStop:()=>{l(!1)}})},[]),M.useEffect(()=>{var d,h;if(e)(d=u.current)==null||d.destroy();else if(t.current)return(h=u.current)==null||h.update({noDragClassName:n,handleSelector:r,domNode:t.current,isSelectable:o,nodeId:i,nodeClickDistance:s}),()=>{var p;(p=u.current)==null||p.destroy()}},[n,r,e,o,t,i]),c}const a1=t=>e=>e.selected&&(e.draggable||t&&typeof e.draggable>"u");function dl(){const t=ye();return M.useCallback(e=>{const{nodeExtent:n,snapToGrid:r,snapGrid:i,nodesDraggable:o,onError:s,updateNodePositions:a,nodeLookup:c,nodeOrigin:l}=t.getState(),u=new Map,d=a1(o),h=r?i[0]:5,p=r?i[1]:5,f=e.direction.x*h*e.factor,m=e.direction.y*p*e.factor;for(const[,y]of c){if(!d(y))continue;let g={x:y.internals.positionAbsolute.x+f,y:y.internals.positionAbsolute.y+m};r&&(g=Nr(g,i));const{position:b,positionAbsolute:x}=Ja({nodeId:y.id,nextPosition:g,nodeLookup:c,nodeExtent:n,nodeOrigin:l,onError:s});y.position=b,y.internals.positionAbsolute=x,u.set(y.id,y)}a(u)},[])}const ho=M.createContext(null),c1=ho.Provider;ho.Consumer;const po=()=>M.useContext(ho),l1=t=>({connectOnClick:t.connectOnClick,noPanClassName:t.noPanClassName,rfId:t.rfId}),u1=(t,e,n)=>r=>{const{connectionClickStartHandle:i,connectionMode:o,connection:s}=r,{fromHandle:a,toHandle:c,isValid:l}=s,u=(c==null?void 0:c.nodeId)===t&&(c==null?void 0:c.id)===e&&(c==null?void 0:c.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===t&&(a==null?void 0:a.id)===e&&(a==null?void 0:a.type)===n,connectingTo:u,clickConnecting:(i==null?void 0:i.nodeId)===t&&(i==null?void 0:i.id)===e&&(i==null?void 0:i.type)===n,isPossibleEndHandle:o===$t.Strict?(a==null?void 0:a.type)!==n:t!==(a==null?void 0:a.nodeId)||e!==(a==null?void 0:a.id),connectionInProcess:!!a,valid:u&&l}};function d1({type:t="source",position:e=re.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:o=!0,id:s,onConnect:a,children:c,className:l,onMouseDown:u,onTouchStart:d,...h},p){var w,A;const f=s||null,m=t==="target",y=ye(),g=po(),{connectOnClick:b,noPanClassName:x,rfId:v}=ue(l1,xe),{connectingFrom:C,connectingTo:T,clickConnecting:S,isPossibleEndHandle:j,connectionInProcess:$,valid:B}=ue(u1(g,f,t),xe);g||((A=(w=y.getState()).onError)==null||A.call(w,"010",et.error010()));const V=_=>{const{defaultEdgeOptions:R,onConnect:N,hasDefaultEdges:P}=y.getState(),L={...R,..._};if(P){const{edges:W,setEdges:I}=y.getState();I(mc(L,W))}N==null||N(L),a==null||a(L)},z=_=>{if(!g)return;const R=lc(_.nativeEvent);if(i&&(R&&_.button===0||!R)){const N=y.getState();io.onPointerDown(_.nativeEvent,{autoPanOnConnect:N.autoPanOnConnect,connectionMode:N.connectionMode,connectionRadius:N.connectionRadius,domNode:N.domNode,nodeLookup:N.nodeLookup,lib:N.lib,isTarget:m,handleId:f,nodeId:g,flowId:N.rfId,panBy:N.panBy,cancelConnection:N.cancelConnection,onConnectStart:N.onConnectStart,onConnectEnd:N.onConnectEnd,updateConnection:N.updateConnection,onConnect:V,isValidConnection:n||N.isValidConnection,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,autoPanSpeed:N.autoPanSpeed})}R?u==null||u(_):d==null||d(_)},F=_=>{const{onClickConnectStart:R,onClickConnectEnd:N,connectionClickStartHandle:P,connectionMode:L,isValidConnection:W,lib:I,rfId:J,nodeLookup:X,connection:q}=y.getState();if(!g||!P&&!i)return;if(!P){R==null||R(_.nativeEvent,{nodeId:g,handleId:f,handleType:t}),y.setState({connectionClickStartHandle:{nodeId:g,type:t,id:f}});return}const ee=cc(_.target),ne=n||W,{connection:H,isValid:ae}=io.isValid(_.nativeEvent,{handle:{nodeId:g,id:f,type:t},connectionMode:L,fromNodeId:P.nodeId,fromHandleId:P.id||null,fromType:P.type,isValidConnection:ne,flowId:J,doc:ee,lib:I,nodeLookup:X});ae&&H&&V(H);const oe=structuredClone(q);delete oe.inProgress,oe.toPosition=oe.toHandle?oe.toHandle.position:null,N==null||N(_,oe),y.setState({connectionClickStartHandle:null})};return E.jsx("div",{"data-handleid":f,"data-nodeid":g,"data-handlepos":e,"data-id":`${v}-${g}-${f}-${t}`,className:Me(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",x,l,{source:!m,target:m,connectable:r,connectablestart:i,connectableend:o,clickconnecting:S,connectingfrom:C,connectingto:T,valid:B,connectionindicator:r&&(!$||j)&&($?o:i)}]),onMouseDown:z,onTouchStart:z,onClick:b?F:void 0,ref:p,...h,children:c})}cn=M.memo(sl(d1));function h1({data:t,isConnectable:e,sourcePosition:n=re.Bottom}){return E.jsxs(E.Fragment,{children:[t==null?void 0:t.label,E.jsx(cn,{type:"source",position:n,isConnectable:e})]})}function p1({data:t,isConnectable:e,targetPosition:n=re.Top,sourcePosition:r=re.Bottom}){return E.jsxs(E.Fragment,{children:[E.jsx(cn,{type:"target",position:n,isConnectable:e}),t==null?void 0:t.label,E.jsx(cn,{type:"source",position:r,isConnectable:e})]})}function f1(){return null}function m1({data:t,isConnectable:e,targetPosition:n=re.Top}){return E.jsxs(E.Fragment,{children:[E.jsx(cn,{type:"target",position:n,isConnectable:e}),t==null?void 0:t.label]})}const Lr={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},hl={input:h1,default:p1,output:m1,group:f1};function y1(t){var e,n,r,i;return t.internals.handleBounds===void 0?{width:t.width??t.initialWidth??((e=t.style)==null?void 0:e.width),height:t.height??t.initialHeight??((n=t.style)==null?void 0:n.height)}:{width:t.width??((r=t.style)==null?void 0:r.width),height:t.height??((i=t.style)==null?void 0:i.height)}}const g1=t=>{const{width:e,height:n,x:r,y:i}=_n(t.nodeLookup,{filter:o=>!!o.selected});return{width:ze(e)?e:null,height:ze(n)?n:null,userSelectionActive:t.userSelectionActive,transformString:`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]}) translate(${r}px,${i}px)`}};function x1({onSelectionContextMenu:t,noPanClassName:e,disableKeyboardA11y:n}){const r=ye(),{width:i,height:o,transformString:s,userSelectionActive:a}=ue(g1,xe),c=dl(),l=M.useRef(null);if(M.useEffect(()=>{var h;n||((h=l.current)==null||h.focus({preventScroll:!0}))},[n]),ul({nodeRef:l}),a||!i||!o)return null;const u=t?h=>{const p=r.getState().nodes.filter(f=>f.selected);t(h,p)}:void 0,d=h=>{Object.prototype.hasOwnProperty.call(Lr,h.key)&&c({direction:Lr[h.key],factor:h.shiftKey?4:1})};return E.jsx("div",{className:Me(["react-flow__nodesselection","react-flow__container",e]),style:{transform:s},children:E.jsx("div",{ref:l,className:"react-flow__nodesselection-rect",onContextMenu:u,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:i,height:o}})})}const pl=typeof window<"u"?window:void 0,v1=t=>({nodesSelectionActive:t.nodesSelectionActive,userSelectionActive:t.userSelectionActive});function fl({children:t,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:o,onPaneScroll:s,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:l,selectionOnDrag:u,selectionMode:d,onSelectionStart:h,onSelectionEnd:p,multiSelectionKeyCode:f,panActivationKeyCode:m,zoomActivationKeyCode:y,elementsSelectable:g,zoomOnScroll:b,zoomOnPinch:x,panOnScroll:v,panOnScrollSpeed:C,panOnScrollMode:T,zoomOnDoubleClick:S,panOnDrag:j,defaultViewport:$,translateExtent:B,minZoom:V,maxZoom:z,preventScrolling:F,onSelectionContextMenu:w,noWheelClassName:A,noPanClassName:_,disableKeyboardA11y:R,onViewportChange:N,isControlledViewport:P}){const{nodesSelectionActive:L,userSelectionActive:W}=ue(v1),I=Pn(l,{target:pl}),J=Pn(m,{target:pl}),X=J||j,q=J||v,ee=u&&X!==!0,ne=I||W||ee;return Jx({deleteKeyCode:c,multiSelectionKeyCode:f}),E.jsx(n1,{onPaneContextMenu:o,elementsSelectable:g,zoomOnScroll:b,zoomOnPinch:x,panOnScroll:q,panOnScrollSpeed:C,panOnScrollMode:T,zoomOnDoubleClick:S,panOnDrag:!I&&X,defaultViewport:$,translateExtent:B,minZoom:V,maxZoom:z,zoomActivationKeyCode:y,preventScrolling:F,noWheelClassName:A,noPanClassName:_,onViewportChange:N,isControlledViewport:P,paneClickDistance:a,children:E.jsxs(s1,{onSelectionStart:h,onSelectionEnd:p,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:o,onPaneScroll:s,panOnDrag:X,isSelecting:!!ne,selectionMode:d,selectionKeyPressed:I,selectionOnDrag:ee,children:[t,L&&E.jsx(x1,{onSelectionContextMenu:w,noPanClassName:_,disableKeyboardA11y:R})]})})}fl.displayName="FlowRenderer";const b1=M.memo(fl),w1=t=>e=>t?Ka(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(n=>n.id):Array.from(e.nodeLookup.keys());function M1(t){return ue(M.useCallback(w1(t),[t]),xe)}const E1=t=>t.updateNodeInternals;function C1(){const t=ue(E1),[e]=M.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(i=>{const o=i.target.getAttribute("data-id");r.set(o,{id:o,nodeElement:i.target,force:!0})}),t(r)}));return M.useEffect(()=>()=>{e==null||e.disconnect()},[e]),e}function _1({node:t,nodeType:e,hasDimensions:n,resizeObserver:r}){const i=ye(),o=M.useRef(null),s=M.useRef(null),a=M.useRef(t.sourcePosition),c=M.useRef(t.targetPosition),l=M.useRef(e),u=n&&!!t.internals.handleBounds;return M.useEffect(()=>{o.current&&!t.hidden&&(!u||s.current!==o.current)&&(s.current&&(r==null||r.unobserve(s.current)),r==null||r.observe(o.current),s.current=o.current)},[u,t.hidden]),M.useEffect(()=>()=>{s.current&&(r==null||r.unobserve(s.current),s.current=null)},[]),M.useEffect(()=>{if(o.current){const d=l.current!==e,h=a.current!==t.sourcePosition,p=c.current!==t.targetPosition;(d||h||p)&&(l.current=e,a.current=t.sourcePosition,c.current=t.targetPosition,i.getState().updateNodeInternals(new Map([[t.id,{id:t.id,nodeElement:o.current,force:!0}]])))}},[t.id,e,t.sourcePosition,t.targetPosition]),o}function S1({id:t,onClick:e,onMouseEnter:n,onMouseMove:r,onMouseLeave:i,onContextMenu:o,onDoubleClick:s,nodesDraggable:a,elementsSelectable:c,nodesConnectable:l,nodesFocusable:u,resizeObserver:d,noDragClassName:h,noPanClassName:p,disableKeyboardA11y:f,rfId:m,nodeTypes:y,nodeExtent:g,nodeClickDistance:b,onError:x}){const{node:v,internals:C,isParent:T}=ue(H=>{const ae=H.nodeLookup.get(t),oe=H.parentLookup.has(t);return{node:ae,internals:ae.internals,isParent:oe}},xe);let S=v.type||"default",j=(y==null?void 0:y[S])||hl[S];j===void 0&&(x==null||x("003",et.error003(S)),S="default",j=hl.default);const $=!!(v.draggable||a&&typeof v.draggable>"u"),B=!!(v.selectable||c&&typeof v.selectable>"u"),V=!!(v.connectable||l&&typeof v.connectable>"u"),z=!!(v.focusable||u&&typeof v.focusable>"u"),F=ye(),w=sc(v),A=_1({node:v,nodeType:S,hasDimensions:w,resizeObserver:d}),_=ul({nodeRef:A,disabled:v.hidden||!$,noDragClassName:h,handleSelector:v.dragHandle,nodeId:t,isSelectable:B,nodeClickDistance:b}),R=dl();if(v.hidden)return null;const N=tt(v),P=y1(v),L=B||$||e||n||r||i,W=n?H=>n(H,{...C.userNode}):void 0,I=r?H=>r(H,{...C.userNode}):void 0,J=i?H=>i(H,{...C.userNode}):void 0,X=o?H=>o(H,{...C.userNode}):void 0,q=s?H=>s(H,{...C.userNode}):void 0,ee=H=>{const{selectNodesOnDrag:ae,nodeDragThreshold:oe}=F.getState();B&&(!ae||!$||oe>0)&&uo({id:t,store:F,nodeRef:A}),e&&e(H,{...C.userNode})},ne=H=>{if(!(Yi(H.nativeEvent)||f))if(Ua.includes(H.key)&&B){const ae=H.key==="Escape";uo({id:t,store:F,unselect:ae,nodeRef:A})}else $&&v.selected&&Object.prototype.hasOwnProperty.call(Lr,H.key)&&(F.setState({ariaLiveMessage:`Moved selected node ${H.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~C.positionAbsolute.x}, y: ${~~C.positionAbsolute.y}`}),R({direction:Lr[H.key],factor:H.shiftKey?4:1}))};return E.jsx("div",{className:Me(["react-flow__node",`react-flow__node-${S}`,{[p]:$},v.className,{selected:v.selected,selectable:B,parent:T,draggable:$,dragging:_}]),ref:A,style:{zIndex:C.z,transform:`translate(${C.positionAbsolute.x}px,${C.positionAbsolute.y}px)`,pointerEvents:L?"all":"none",visibility:w?"visible":"hidden",...v.style,...P},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:W,onMouseMove:I,onMouseLeave:J,onContextMenu:X,onClick:ee,onDoubleClick:q,onKeyDown:z?ne:void 0,tabIndex:z?0:void 0,role:z?"button":void 0,"aria-describedby":f?void 0:`${Qc}-${m}`,"aria-label":v.ariaLabel,children:E.jsx(c1,{value:t,children:E.jsx(j,{id:t,data:v.data,type:S,positionAbsoluteX:C.positionAbsolute.x,positionAbsoluteY:C.positionAbsolute.y,selected:v.selected,selectable:B,draggable:$,deletable:v.deletable??!0,isConnectable:V,sourcePosition:v.sourcePosition,targetPosition:v.targetPosition,dragging:_,dragHandle:v.dragHandle,zIndex:C.z,parentId:v.parentId,...N})})})}const O1=t=>({nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,nodesFocusable:t.nodesFocusable,elementsSelectable:t.elementsSelectable,onError:t.onError});function ml(t){const{nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,onError:o}=ue(O1,xe),s=M1(t.onlyRenderVisibleElements),a=C1();return E.jsx("div",{className:"react-flow__nodes",style:Br,children:s.map(c=>E.jsx(S1,{id:c,nodeTypes:t.nodeTypes,nodeExtent:t.nodeExtent,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,resizeObserver:a,nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,nodeClickDistance:t.nodeClickDistance,onError:o},c))})}ml.displayName="NodeRenderer";const N1=M.memo(ml);function A1(t){return ue(M.useCallback(e=>{if(!t)return e.edges.map(r=>r.id);const n=[];if(e.width&&e.height)for(const r of e.edges){const i=e.nodeLookup.get(r.source),o=e.nodeLookup.get(r.target);i&&o&&w0({sourceNode:i,targetNode:o,width:e.width,height:e.height,transform:e.transform})&&n.push(r.id)}return n},[t]),xe)}const P1=({color:t="none",strokeWidth:e=1})=>E.jsx("polyline",{style:{stroke:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),k1=({color:t="none",strokeWidth:e=1})=>E.jsx("polyline",{style:{stroke:t,fill:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),yl={[Cr.Arrow]:P1,[Cr.ArrowClosed]:k1};function T1(t){const e=ye();return M.useMemo(()=>{var n,r;return Object.prototype.hasOwnProperty.call(yl,t)?yl[t]:((r=(n=e.getState()).onError)==null||r.call(n,"009",et.error009(t)),null)},[t])}const j1=({id:t,type:e,color:n,width:r=12.5,height:i=12.5,markerUnits:o="strokeWidth",strokeWidth:s,orient:a="auto-start-reverse"})=>{const c=T1(e);return c?E.jsx("marker",{className:"react-flow__arrowhead",id:t,markerWidth:`${r}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:o,orient:a,refX:"0",refY:"0",children:E.jsx(c,{color:n,strokeWidth:s})}):null},gl=({defaultColor:t,rfId:e})=>{const n=ue(o=>o.edges),r=ue(o=>o.defaultEdgeOptions),i=M.useMemo(()=>N0(n,{id:e,defaultColor:t,defaultMarkerStart:r==null?void 0:r.markerStart,defaultMarkerEnd:r==null?void 0:r.markerEnd}),[n,r,e,t]);return i.length?E.jsx("svg",{className:"react-flow__marker",children:E.jsx("defs",{children:i.map(o=>E.jsx(j1,{id:o.id,type:o.type,color:o.color,width:o.width,height:o.height,markerUnits:o.markerUnits,strokeWidth:o.strokeWidth,orient:o.orient},o.id))})}):null};gl.displayName="MarkerDefinitions";var R1=M.memo(gl);function xl({x:t,y:e,label:n,labelStyle:r={},labelShowBg:i=!0,labelBgStyle:o={},labelBgPadding:s=[2,4],labelBgBorderRadius:a=2,children:c,className:l,...u}){const[d,h]=M.useState({x:1,y:0,width:0,height:0}),p=Me(["react-flow__edge-textwrapper",l]),f=M.useRef(null);return M.useEffect(()=>{if(f.current){const m=f.current.getBBox();h({x:m.x,y:m.y,width:m.width,height:m.height})}},[n]),typeof n>"u"||!n?null:E.jsxs("g",{transform:`translate(${t-d.width/2} ${e-d.height/2})`,className:p,visibility:d.width?"visible":"hidden",...u,children:[i&&E.jsx("rect",{width:d.width+2*s[0],x:-s[0],y:-s[1],height:d.height+2*s[1],className:"react-flow__edge-textbg",style:o,rx:a,ry:a}),E.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:f,style:r,children:n}),c]})}xl.displayName="EdgeText";const I1=M.memo(xl);function Dr({id:t,path:e,labelX:n,labelY:r,label:i,labelStyle:o,labelShowBg:s,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,style:u,markerEnd:d,markerStart:h,className:p,interactionWidth:f=20}){return E.jsxs(E.Fragment,{children:[E.jsx("path",{id:t,style:u,d:e,fill:"none",className:Me(["react-flow__edge-path",p]),markerEnd:d,markerStart:h}),f&&E.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),i&&ze(n)&&ze(r)?E.jsx(I1,{x:n,y:r,label:i,labelStyle:o,labelShowBg:s,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l}):null]})}function vl({pos:t,x1:e,y1:n,x2:r,y2:i}){return t===re.Left||t===re.Right?[.5*(e+r),n]:[e,.5*(n+i)]}function bl({sourceX:t,sourceY:e,sourcePosition:n=re.Bottom,targetX:r,targetY:i,targetPosition:o=re.Top}){const[s,a]=vl({pos:n,x1:t,y1:e,x2:r,y2:i}),[c,l]=vl({pos:o,x1:r,y1:i,x2:t,y2:e}),[u,d,h,p]=dc({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:s,sourceControlY:a,targetControlX:c,targetControlY:l});return[`M${t},${e} C${s},${a} ${c},${l} ${r},${i}`,u,d,h,p]}function wl(t){return M.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,sourcePosition:s=re.Bottom,targetPosition:a=re.Top,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:y,interactionWidth:g})=>{const[b,x,v]=bl({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:o,targetPosition:a}),C=t.isInternal?void 0:e;return E.jsx(Dr,{id:C,path:b,labelX:x,labelY:v,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:y,interactionWidth:g})})}const $1=wl({isInternal:!1}),Ml=wl({isInternal:!0});$1.displayName="SimpleBezierEdge",Ml.displayName="SimpleBezierEdgeInternal";function El(t){return M.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,sourcePosition:p=re.Bottom,targetPosition:f=re.Top,markerEnd:m,markerStart:y,pathOptions:g,interactionWidth:b})=>{const[x,v,C]=Xi({sourceX:n,sourceY:r,sourcePosition:p,targetX:i,targetY:o,targetPosition:f,borderRadius:g==null?void 0:g.borderRadius,offset:g==null?void 0:g.offset}),T=t.isInternal?void 0:e;return E.jsx(Dr,{id:T,path:x,labelX:v,labelY:C,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:m,markerStart:y,interactionWidth:b})})}const Cl=El({isInternal:!1}),_l=El({isInternal:!0});Cl.displayName="SmoothStepEdge",_l.displayName="SmoothStepEdgeInternal";function Sl(t){return M.memo(({id:e,...n})=>{var i;const r=t.isInternal?void 0:e;return E.jsx(Cl,{...n,id:r,pathOptions:M.useMemo(()=>{var o;return{borderRadius:0,offset:(o=n.pathOptions)==null?void 0:o.offset}},[(i=n.pathOptions)==null?void 0:i.offset])})})}const B1=Sl({isInternal:!1}),Ol=Sl({isInternal:!0});B1.displayName="StepEdge",Ol.displayName="StepEdgeInternal";function Nl(t){return M.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:f,interactionWidth:m})=>{const[y,g,b]=yc({sourceX:n,sourceY:r,targetX:i,targetY:o}),x=t.isInternal?void 0:e;return E.jsx(Dr,{id:x,path:y,labelX:g,labelY:b,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:f,interactionWidth:m})})}const L1=Nl({isInternal:!1}),Al=Nl({isInternal:!0});L1.displayName="StraightEdge",Al.displayName="StraightEdgeInternal";function Pl(t){return M.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:o,sourcePosition:s=re.Bottom,targetPosition:a=re.Top,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:y,pathOptions:g,interactionWidth:b})=>{const[x,v,C]=pc({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:o,targetPosition:a,curvature:g==null?void 0:g.curvature}),T=t.isInternal?void 0:e;return E.jsx(Dr,{id:T,path:x,labelX:v,labelY:C,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:y,interactionWidth:b})})}const D1=Pl({isInternal:!1}),kl=Pl({isInternal:!0});D1.displayName="BezierEdge",kl.displayName="BezierEdgeInternal";const Tl={default:kl,straight:Al,step:Ol,smoothstep:_l,simplebezier:Ml},jl={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},F1=(t,e,n)=>n===re.Left?t-e:n===re.Right?t+e:t,z1=(t,e,n)=>n===re.Top?t-e:n===re.Bottom?t+e:t,Rl="react-flow__edgeupdater";function Il({position:t,centerX:e,centerY:n,radius:r=10,onMouseDown:i,onMouseEnter:o,onMouseOut:s,type:a}){return E.jsx("circle",{onMouseDown:i,onMouseEnter:o,onMouseOut:s,className:Me([Rl,`${Rl}-${a}`]),cx:F1(e,r,t),cy:z1(n,r,t),r,stroke:"transparent",fill:"transparent"})}function V1({isReconnectable:t,reconnectRadius:e,edge:n,sourceX:r,sourceY:i,targetX:o,targetY:s,sourcePosition:a,targetPosition:c,onReconnect:l,onReconnectStart:u,onReconnectEnd:d,setReconnecting:h,setUpdateHover:p}){const f=ye(),m=(v,C)=>{if(v.button!==0)return;const{autoPanOnConnect:T,domNode:S,isValidConnection:j,connectionMode:$,connectionRadius:B,lib:V,onConnectStart:z,onConnectEnd:F,cancelConnection:w,nodeLookup:A,rfId:_,panBy:R,updateConnection:N}=f.getState(),P=C.type==="target";h(!0),u==null||u(v,n,C.type);const L=(I,J)=>{h(!1),d==null||d(I,n,C.type,J)},W=I=>l==null?void 0:l(n,I);io.onPointerDown(v.nativeEvent,{autoPanOnConnect:T,connectionMode:$,connectionRadius:B,domNode:S,handleId:C.id,nodeId:C.nodeId,nodeLookup:A,isTarget:P,edgeUpdaterType:C.type,lib:V,flowId:_,cancelConnection:w,panBy:R,isValidConnection:j,onConnect:W,onConnectStart:z,onConnectEnd:F,onReconnectEnd:L,updateConnection:N,getTransform:()=>f.getState().transform,getFromHandle:()=>f.getState().connection.fromHandle})},y=v=>m(v,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),g=v=>m(v,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),b=()=>p(!0),x=()=>p(!1);return E.jsxs(E.Fragment,{children:[(t===!0||t==="source")&&E.jsx(Il,{position:a,centerX:r,centerY:i,radius:e,onMouseDown:y,onMouseEnter:b,onMouseOut:x,type:"source"}),(t===!0||t==="target")&&E.jsx(Il,{position:c,centerX:o,centerY:s,radius:e,onMouseDown:g,onMouseEnter:b,onMouseOut:x,type:"target"})]})}function q1({id:t,edgesFocusable:e,edgesReconnectable:n,elementsSelectable:r,onClick:i,onDoubleClick:o,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,reconnectRadius:u,onReconnect:d,onReconnectStart:h,onReconnectEnd:p,rfId:f,edgeTypes:m,noPanClassName:y,onError:g,disableKeyboardA11y:b}){let x=ue(se=>se.edgeLookup.get(t));const v=ue(se=>se.defaultEdgeOptions);x=v?{...v,...x}:x;let C=x.type||"default",T=(m==null?void 0:m[C])||Tl[C];T===void 0&&(g==null||g("011",et.error011(C)),C="default",T=Tl.default);const S=!!(x.focusable||e&&typeof x.focusable>"u"),j=typeof d<"u"&&(x.reconnectable||n&&typeof x.reconnectable>"u"),$=!!(x.selectable||r&&typeof x.selectable>"u"),B=M.useRef(null),[V,z]=M.useState(!1),[F,w]=M.useState(!1),A=ye(),{zIndex:_,sourceX:R,sourceY:N,targetX:P,targetY:L,sourcePosition:W,targetPosition:I}=ue(M.useCallback(se=>{const he=se.nodeLookup.get(x.source),me=se.nodeLookup.get(x.target);if(!he||!me)return{zIndex:x.zIndex,...jl};const Te=O0({id:t,sourceNode:he,targetNode:me,sourceHandle:x.sourceHandle||null,targetHandle:x.targetHandle||null,connectionMode:se.connectionMode,onError:g});return{zIndex:b0({selected:x.selected,zIndex:x.zIndex,sourceNode:he,targetNode:me,elevateOnSelect:se.elevateEdgesOnSelect}),...Te||jl}},[x.source,x.target,x.sourceHandle,x.targetHandle,x.selected,x.zIndex]),xe),J=M.useMemo(()=>x.markerStart?`url('#${Gi(x.markerStart,f)}')`:void 0,[x.markerStart,f]),X=M.useMemo(()=>x.markerEnd?`url('#${Gi(x.markerEnd,f)}')`:void 0,[x.markerEnd,f]);if(x.hidden||R===null||N===null||P===null||L===null)return null;const q=se=>{var rt;const{addSelectedEdges:he,unselectNodesAndEdges:me,multiSelectionActive:Te}=A.getState();$&&(A.setState({nodesSelectionActive:!1}),x.selected&&Te?(me({nodes:[],edges:[x]}),(rt=B.current)==null||rt.blur()):he([t])),i&&i(se,x)},ee=o?se=>{o(se,{...x})}:void 0,ne=s?se=>{s(se,{...x})}:void 0,H=a?se=>{a(se,{...x})}:void 0,ae=c?se=>{c(se,{...x})}:void 0,oe=l?se=>{l(se,{...x})}:void 0,ce=se=>{var he;if(!b&&Ua.includes(se.key)&&$){const{unselectNodesAndEdges:me,addSelectedEdges:Te}=A.getState();se.key==="Escape"?((he=B.current)==null||he.blur(),me({edges:[x]})):Te([t])}};return E.jsx("svg",{style:{zIndex:_},children:E.jsxs("g",{className:Me(["react-flow__edge",`react-flow__edge-${C}`,x.className,y,{selected:x.selected,animated:x.animated,inactive:!$&&!i,updating:V,selectable:$}]),onClick:q,onDoubleClick:ee,onContextMenu:ne,onMouseEnter:H,onMouseMove:ae,onMouseLeave:oe,onKeyDown:S?ce:void 0,tabIndex:S?0:void 0,role:S?"button":"img","data-id":t,"data-testid":`rf__edge-${t}`,"aria-label":x.ariaLabel===null?void 0:x.ariaLabel||`Edge from ${x.source} to ${x.target}`,"aria-describedby":S?`${Zc}-${f}`:void 0,ref:B,children:[!F&&E.jsx(T,{id:t,source:x.source,target:x.target,type:x.type,selected:x.selected,animated:x.animated,selectable:$,deletable:x.deletable??!0,label:x.label,labelStyle:x.labelStyle,labelShowBg:x.labelShowBg,labelBgStyle:x.labelBgStyle,labelBgPadding:x.labelBgPadding,labelBgBorderRadius:x.labelBgBorderRadius,sourceX:R,sourceY:N,targetX:P,targetY:L,sourcePosition:W,targetPosition:I,data:x.data,style:x.style,sourceHandleId:x.sourceHandle,targetHandleId:x.targetHandle,markerStart:J,markerEnd:X,pathOptions:"pathOptions"in x?x.pathOptions:void 0,interactionWidth:x.interactionWidth}),j&&E.jsx(V1,{edge:x,isReconnectable:j,reconnectRadius:u,onReconnect:d,onReconnectStart:h,onReconnectEnd:p,sourceX:R,sourceY:N,targetX:P,targetY:L,sourcePosition:W,targetPosition:I,setUpdateHover:z,setReconnecting:w})]})})}const W1=t=>({width:t.width,height:t.height,edgesFocusable:t.edgesFocusable,edgesReconnectable:t.edgesReconnectable,elementsSelectable:t.elementsSelectable,connectionMode:t.connectionMode,onError:t.onError});function $l({defaultMarkerColor:t,onlyRenderVisibleElements:e,rfId:n,edgeTypes:r,noPanClassName:i,onReconnect:o,onEdgeContextMenu:s,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:l,onEdgeClick:u,reconnectRadius:d,onEdgeDoubleClick:h,onReconnectStart:p,onReconnectEnd:f,disableKeyboardA11y:m}){const{edgesFocusable:y,edgesReconnectable:g,elementsSelectable:b,onError:x}=ue(W1,xe),v=A1(e);return E.jsxs("div",{className:"react-flow__edges",children:[E.jsx(R1,{defaultColor:t,rfId:n}),v.map(C=>E.jsx(q1,{id:C,edgesFocusable:y,edgesReconnectable:g,elementsSelectable:b,noPanClassName:i,onReconnect:o,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,onClick:u,reconnectRadius:d,onDoubleClick:h,onReconnectStart:p,onReconnectEnd:f,rfId:n,onError:x,edgeTypes:r,disableKeyboardA11y:m},C))]})}$l.displayName="EdgeRenderer";const H1=M.memo($l),U1=t=>`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`;function Q1({children:t}){const e=ue(U1);return E.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:t})}function Z1(t){const e=er(),n=M.useRef(!1);M.useEffect(()=>{!n.current&&e.viewportInitialized&&t&&(setTimeout(()=>t(e),1),n.current=!0)},[t,e.viewportInitialized])}const Y1=t=>{var e;return(e=t.panZoom)==null?void 0:e.syncViewport};function X1(t){const e=ue(Y1),n=ye();return M.useEffect(()=>{t&&(e==null||e(t),n.setState({transform:[t.x,t.y,t.zoom]}))},[t,e]),null}function G1(t){return t.connection.inProgress?{...t.connection,to:On(t.connection.to,t.transform)}:{...t.connection}}function K1(t){return G1}function J1(t){const e=K1();return ue(e,xe)}const ev=t=>({nodesConnectable:t.nodesConnectable,isValid:t.connection.isValid,inProgress:t.connection.inProgress,width:t.width,height:t.height});function tv({containerStyle:t,style:e,type:n,component:r}){const{nodesConnectable:i,width:o,height:s,isValid:a,inProgress:c}=ue(ev,xe);return o&&i&&c?E.jsx("svg",{style:t,width:o,height:s,className:"react-flow__connectionline react-flow__container",children:E.jsx("g",{className:Me(["react-flow__connection",Xa(a)]),children:E.jsx(Bl,{style:e,type:n,CustomComponent:r,isValid:a})})}):null}const Bl=({style:t,type:e=ot.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:i,from:o,fromNode:s,fromHandle:a,fromPosition:c,to:l,toNode:u,toHandle:d,toPosition:h}=J1();if(!i)return;if(n)return E.jsx(n,{connectionLineType:e,connectionLineStyle:t,fromNode:s,fromHandle:a,fromX:o.x,fromY:o.y,toX:l.x,toY:l.y,fromPosition:c,toPosition:h,connectionStatus:Xa(r),toNode:u,toHandle:d});let p="";const f={sourceX:o.x,sourceY:o.y,sourcePosition:c,targetX:l.x,targetY:l.y,targetPosition:h};switch(e){case ot.Bezier:[p]=pc(f);break;case ot.SimpleBezier:[p]=bl(f);break;case ot.Step:[p]=Xi({...f,borderRadius:0});break;case ot.SmoothStep:[p]=Xi(f);break;default:[p]=yc(f)}return E.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:t})};Bl.displayName="ConnectionLine";const nv={};function Ll(t=nv){M.useRef(t),ye(),M.useEffect(()=>{},[t])}function rv(){ye(),M.useRef(!1),M.useEffect(()=>{},[])}function Dl({nodeTypes:t,edgeTypes:e,onInit:n,onNodeClick:r,onEdgeClick:i,onNodeDoubleClick:o,onEdgeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:u,onSelectionContextMenu:d,onSelectionStart:h,onSelectionEnd:p,connectionLineType:f,connectionLineStyle:m,connectionLineComponent:y,connectionLineContainerStyle:g,selectionKeyCode:b,selectionOnDrag:x,selectionMode:v,multiSelectionKeyCode:C,panActivationKeyCode:T,zoomActivationKeyCode:S,deleteKeyCode:j,onlyRenderVisibleElements:$,elementsSelectable:B,defaultViewport:V,translateExtent:z,minZoom:F,maxZoom:w,preventScrolling:A,defaultMarkerColor:_,zoomOnScroll:R,zoomOnPinch:N,panOnScroll:P,panOnScrollSpeed:L,panOnScrollMode:W,zoomOnDoubleClick:I,panOnDrag:J,onPaneClick:X,onPaneMouseEnter:q,onPaneMouseMove:ee,onPaneMouseLeave:ne,onPaneScroll:H,onPaneContextMenu:ae,paneClickDistance:oe,nodeClickDistance:ce,onEdgeContextMenu:se,onEdgeMouseEnter:he,onEdgeMouseMove:me,onEdgeMouseLeave:Te,reconnectRadius:rt,onReconnect:nn,onReconnectStart:rn,onReconnectEnd:on,noDragClassName:lt,noWheelClassName:Mt,noPanClassName:Et,disableKeyboardA11y:Ct,nodeExtent:Wn,rfId:_t,viewport:Ve,onViewportChange:sn}){return Ll(t),Ll(e),rv(),Z1(n),X1(Ve),E.jsx(b1,{onPaneClick:X,onPaneMouseEnter:q,onPaneMouseMove:ee,onPaneMouseLeave:ne,onPaneContextMenu:ae,onPaneScroll:H,paneClickDistance:oe,deleteKeyCode:j,selectionKeyCode:b,selectionOnDrag:x,selectionMode:v,onSelectionStart:h,onSelectionEnd:p,multiSelectionKeyCode:C,panActivationKeyCode:T,zoomActivationKeyCode:S,elementsSelectable:B,zoomOnScroll:R,zoomOnPinch:N,zoomOnDoubleClick:I,panOnScroll:P,panOnScrollSpeed:L,panOnScrollMode:W,panOnDrag:J,defaultViewport:V,translateExtent:z,minZoom:F,maxZoom:w,onSelectionContextMenu:d,preventScrolling:A,noDragClassName:lt,noWheelClassName:Mt,noPanClassName:Et,disableKeyboardA11y:Ct,onViewportChange:sn,isControlledViewport:!!Ve,children:E.jsxs(Q1,{children:[E.jsx(H1,{edgeTypes:e,onEdgeClick:i,onEdgeDoubleClick:s,onReconnect:nn,onReconnectStart:rn,onReconnectEnd:on,onlyRenderVisibleElements:$,onEdgeContextMenu:se,onEdgeMouseEnter:he,onEdgeMouseMove:me,onEdgeMouseLeave:Te,reconnectRadius:rt,defaultMarkerColor:_,noPanClassName:Et,disableKeyboardA11y:Ct,rfId:_t}),E.jsx(tv,{style:m,type:f,component:y,containerStyle:g}),E.jsx("div",{className:"react-flow__edgelabel-renderer"}),E.jsx(N1,{nodeTypes:t,onNodeClick:r,onNodeDoubleClick:o,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:u,nodeClickDistance:ce,onlyRenderVisibleElements:$,noPanClassName:Et,noDragClassName:lt,disableKeyboardA11y:Ct,nodeExtent:Wn,rfId:_t}),E.jsx("div",{className:"react-flow__viewport-portal"})]})})}Dl.displayName="GraphView";const iv=M.memo(Dl),Fl=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c}={})=>{const l=new Map,u=new Map,d=new Map,h=new Map,p=r??e??[],f=n??t??[],m=a??[0,0],y=c??Mn;Ec(d,h,p),eo(f,l,u,{nodeOrigin:m,nodeExtent:y,elevateNodesOnSelect:!1});let g=[0,0,1];if(s&&i&&o){const b=_n(l,{filter:T=>!!((T.width||T.initialWidth)&&(T.height||T.initialHeight))}),{x,y:v,zoom:C}=Zi(b,i,o,.5,2,.1);g=[x,v,C]}return{rfId:"1",width:0,height:0,transform:g,nodes:f,nodeLookup:l,parentLookup:u,edges:p,edgeLookup:h,connectionLookup:d,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:.5,maxZoom:2,translateExtent:Mn,nodeExtent:y,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:$t.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:m,nodeDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,fitViewOnInit:!1,fitViewDone:!1,fitViewOnInitOptions:void 0,selectNodesOnDrag:!0,multiSelectionActive:!1,connection:{...Qa},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanSpeed:15,connectionRadius:20,onError:x0,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1}},ov=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c})=>Cx((l,u)=>({...Fl({nodes:t,edges:e,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c,defaultNodes:n,defaultEdges:r}),setNodes:d=>{const{nodeLookup:h,parentLookup:p,nodeOrigin:f,elevateNodesOnSelect:m}=u();eo(d,h,p,{nodeOrigin:f,nodeExtent:c,elevateNodesOnSelect:m,checkEquality:!0}),l({nodes:d})},setEdges:d=>{const{connectionLookup:h,edgeLookup:p}=u();Ec(h,p,d),l({edges:d})},setDefaultNodesAndEdges:(d,h)=>{if(d){const{setNodes:p}=u();p(d),l({hasDefaultNodes:!0})}if(h){const{setEdges:p}=u();p(h),l({hasDefaultEdges:!0})}},updateNodeInternals:(d,h={triggerFitView:!0})=>{const{triggerNodeChanges:p,nodeLookup:f,parentLookup:m,fitViewOnInit:y,fitViewDone:g,fitViewOnInitOptions:b,domNode:x,nodeOrigin:v,nodeExtent:C,debug:T,fitViewSync:S}=u(),{changes:j,updatedInternals:$}=j0(d,f,m,x,v,C);if($){if(P0(f,m,{nodeOrigin:v,nodeExtent:C}),h.triggerFitView){let B=g;!g&&y&&(B=S({...b,nodes:b==null?void 0:b.nodes})),l({fitViewDone:B})}else l({});(j==null?void 0:j.length)>0&&(T&&console.log("React Flow: trigger node changes",j),p==null||p(j))}},updateNodePositions:(d,h=!1)=>{const p=[],f=[];for(const[m,y]of d){const g={id:m,type:"position",position:y.position,dragging:h};y!=null&&y.expandParent&&(y!=null&&y.parentId)&&g.position&&(p.push({id:m,parentId:y.parentId,rect:{...y.internals.positionAbsolute,width:y.measured.width,height:y.measured.height}}),g.position.x=Math.max(0,g.position.x),g.position.y=Math.max(0,g.position.y)),f.push(g)}if(p.length>0){const{nodeLookup:m,parentLookup:y,nodeOrigin:g}=u(),b=no(p,m,y,g);f.push(...b)}u().triggerNodeChanges(f)},triggerNodeChanges:d=>{const{onNodesChange:h,setNodes:p,nodes:f,hasDefaultNodes:m,debug:y}=u();if(d!=null&&d.length){if(m){const g=dt(d,f);p(g)}y&&console.log("React Flow: trigger node changes",d),h==null||h(d)}},triggerEdgeChanges:d=>{const{onEdgesChange:h,setEdges:p,edges:f,hasDefaultEdges:m,debug:y}=u();if(d!=null&&d.length){if(m){const g=kn(d,f);p(g)}y&&console.log("React Flow: trigger edge changes",d),h==null||h(d)}},addSelectedNodes:d=>{const{multiSelectionActive:h,edgeLookup:p,nodeLookup:f,triggerNodeChanges:m,triggerEdgeChanges:y}=u();if(h){const g=d.map(b=>gt(b,!0));m(g);return}m(qt(f,new Set([...d]),!0)),y(qt(p))},addSelectedEdges:d=>{const{multiSelectionActive:h,edgeLookup:p,nodeLookup:f,triggerNodeChanges:m,triggerEdgeChanges:y}=u();if(h){const g=d.map(b=>gt(b,!0));y(g);return}y(qt(p,new Set([...d]))),m(qt(f,new Set,!0))},unselectNodesAndEdges:({nodes:d,edges:h}={})=>{const{edges:p,nodes:f,nodeLookup:m,triggerNodeChanges:y,triggerEdgeChanges:g}=u(),b=d||f,x=h||p,v=b.map(T=>{const S=m.get(T.id);return S&&(S.selected=!1),gt(T.id,!1)}),C=x.map(T=>gt(T.id,!1));y(v),g(C)},setMinZoom:d=>{const{panZoom:h,maxZoom:p}=u();h==null||h.setScaleExtent([d,p]),l({minZoom:d})},setMaxZoom:d=>{const{panZoom:h,minZoom:p}=u();h==null||h.setScaleExtent([p,d]),l({maxZoom:d})},setTranslateExtent:d=>{var h;(h=u().panZoom)==null||h.setTranslateExtent(d),l({translateExtent:d})},setPaneClickDistance:d=>{var h;(h=u().panZoom)==null||h.setClickDistance(d)},resetSelectedElements:()=>{const{edges:d,nodes:h,triggerNodeChanges:p,triggerEdgeChanges:f}=u(),m=h.reduce((g,b)=>b.selected?[...g,gt(b.id,!1)]:g,[]),y=d.reduce((g,b)=>b.selected?[...g,gt(b.id,!1)]:g,[]);p(m),f(y)},setNodeExtent:d=>{const{nodes:h,nodeLookup:p,parentLookup:f,nodeOrigin:m,elevateNodesOnSelect:y,nodeExtent:g}=u();d[0][0]===g[0][0]&&d[0][1]===g[0][1]&&d[1][0]===g[1][0]&&d[1][1]===g[1][1]||(eo(h,p,f,{nodeOrigin:m,nodeExtent:d,elevateNodesOnSelect:y,checkEquality:!1}),l({nodeExtent:d}))},panBy:d=>{const{transform:h,width:p,height:f,panZoom:m,translateExtent:y}=u();return R0({delta:d,panZoom:m,transform:h,translateExtent:y,width:p,height:f})},fitView:d=>{const{panZoom:h,width:p,height:f,minZoom:m,maxZoom:y,nodeLookup:g}=u();if(!h)return Promise.resolve(!1);const b=Hi(g,d);return Ui({nodes:b,width:p,height:f,panZoom:h,minZoom:m,maxZoom:y},d)},fitViewSync:d=>{const{panZoom:h,width:p,height:f,minZoom:m,maxZoom:y,nodeLookup:g}=u();if(!h)return!1;const b=Hi(g,d);return Ui({nodes:b,width:p,height:f,panZoom:h,minZoom:m,maxZoom:y},d),b.size>0},cancelConnection:()=>{l({connection:{...Qa}})},updateConnection:d=>{l({connection:d})},reset:()=>l({...Fl()})}),Object.is);function sv({initialNodes:t,initialEdges:e,defaultNodes:n,defaultEdges:r,initialWidth:i,initialHeight:o,fitView:s,nodeOrigin:a,nodeExtent:c,children:l}){const[u]=M.useState(()=>ov({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:o,fitView:s,nodeOrigin:a,nodeExtent:c}));return E.jsx(_x,{value:u,children:E.jsx(Zx,{children:l})})}function av({children:t,nodes:e,edges:n,defaultNodes:r,defaultEdges:i,width:o,height:s,fitView:a,nodeOrigin:c,nodeExtent:l}){return M.useContext(Ir)?E.jsx(E.Fragment,{children:t}):E.jsx(sv,{initialNodes:e,initialEdges:n,defaultNodes:r,defaultEdges:i,initialWidth:o,initialHeight:s,fitView:a,nodeOrigin:c,nodeExtent:l,children:t})}const cv={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function lv({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,className:i,nodeTypes:o,edgeTypes:s,onNodeClick:a,onEdgeClick:c,onInit:l,onMove:u,onMoveStart:d,onMoveEnd:h,onConnect:p,onConnectStart:f,onConnectEnd:m,onClickConnectStart:y,onClickConnectEnd:g,onNodeMouseEnter:b,onNodeMouseMove:x,onNodeMouseLeave:v,onNodeContextMenu:C,onNodeDoubleClick:T,onNodeDragStart:S,onNodeDrag:j,onNodeDragStop:$,onNodesDelete:B,onEdgesDelete:V,onDelete:z,onSelectionChange:F,onSelectionDragStart:w,onSelectionDrag:A,onSelectionDragStop:_,onSelectionContextMenu:R,onSelectionStart:N,onSelectionEnd:P,onBeforeDelete:L,connectionMode:W,connectionLineType:I=ot.Bezier,connectionLineStyle:J,connectionLineComponent:X,connectionLineContainerStyle:q,deleteKeyCode:ee="Backspace",selectionKeyCode:ne="Shift",selectionOnDrag:H=!1,selectionMode:ae=En.Full,panActivationKeyCode:oe="Space",multiSelectionKeyCode:ce=Ar()?"Meta":"Control",zoomActivationKeyCode:se=Ar()?"Meta":"Control",snapToGrid:he,snapGrid:me,onlyRenderVisibleElements:Te=!1,selectNodesOnDrag:rt,nodesDraggable:nn,nodesConnectable:rn,nodesFocusable:on,nodeOrigin:lt=Yc,edgesFocusable:Mt,edgesReconnectable:Et,elementsSelectable:Ct=!0,defaultViewport:Wn=Lx,minZoom:_t=.5,maxZoom:Ve=2,translateExtent:sn=Mn,preventScrolling:ps=!0,nodeExtent:Hn,defaultMarkerColor:Un="#b1b1b7",zoomOnScroll:O=!0,zoomOnPinch:k=!0,panOnScroll:D=!1,panOnScrollSpeed:U=.5,panOnScrollMode:ie=ht.Free,zoomOnDoubleClick:Ce=!0,panOnDrag:we=!0,onPaneClick:le,onPaneMouseEnter:Z,onPaneMouseMove:G,onPaneMouseLeave:K,onPaneScroll:te,onPaneContextMenu:de,paneClickDistance:pe=0,nodeClickDistance:be=0,children:$e,onReconnect:ai,onReconnectStart:fs,onReconnectEnd:ms,onEdgeContextMenu:zS,onEdgeDoubleClick:VS,onEdgeMouseEnter:qS,onEdgeMouseMove:WS,onEdgeMouseLeave:HS,reconnectRadius:US=10,onNodesChange:QS,onEdgesChange:ZS,noDragClassName:YS="nodrag",noWheelClassName:XS="nowheel",noPanClassName:nf="nopan",fitView:rf,fitViewOptions:GS,connectOnClick:KS,attributionPosition:JS,proOptions:eO,defaultEdgeOptions:tO,elevateNodesOnSelect:nO,elevateEdgesOnSelect:rO,disableKeyboardA11y:of=!1,autoPanOnConnect:iO,autoPanOnNodeDrag:oO,autoPanSpeed:sO,connectionRadius:aO,isValidConnection:cO,onError:lO,style:uO,id:sf,nodeDragThreshold:dO,viewport:hO,onViewportChange:pO,width:fO,height:mO,colorMode:yO="light",debug:gO,...xO},vO){const ys=sf||"1",bO=Vx(yO);return E.jsx("div",{...xO,style:{...uO,...cv},ref:vO,className:Me(["react-flow",i,bO]),"data-testid":"rf__wrapper",id:sf,children:E.jsxs(av,{nodes:t,edges:e,width:fO,height:mO,fitView:rf,nodeOrigin:lt,nodeExtent:Hn,children:[E.jsx(iv,{onInit:l,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:b,onNodeMouseMove:x,onNodeMouseLeave:v,onNodeContextMenu:C,onNodeDoubleClick:T,nodeTypes:o,edgeTypes:s,connectionLineType:I,connectionLineStyle:J,connectionLineComponent:X,connectionLineContainerStyle:q,selectionKeyCode:ne,selectionOnDrag:H,selectionMode:ae,deleteKeyCode:ee,multiSelectionKeyCode:ce,panActivationKeyCode:oe,zoomActivationKeyCode:se,onlyRenderVisibleElements:Te,defaultViewport:Wn,translateExtent:sn,minZoom:_t,maxZoom:Ve,preventScrolling:ps,zoomOnScroll:O,zoomOnPinch:k,zoomOnDoubleClick:Ce,panOnScroll:D,panOnScrollSpeed:U,panOnScrollMode:ie,panOnDrag:we,onPaneClick:le,onPaneMouseEnter:Z,onPaneMouseMove:G,onPaneMouseLeave:K,onPaneScroll:te,onPaneContextMenu:de,paneClickDistance:pe,nodeClickDistance:be,onSelectionContextMenu:R,onSelectionStart:N,onSelectionEnd:P,onReconnect:ai,onReconnectStart:fs,onReconnectEnd:ms,onEdgeContextMenu:zS,onEdgeDoubleClick:VS,onEdgeMouseEnter:qS,onEdgeMouseMove:WS,onEdgeMouseLeave:HS,reconnectRadius:US,defaultMarkerColor:Un,noDragClassName:YS,noWheelClassName:XS,noPanClassName:nf,rfId:ys,disableKeyboardA11y:of,nodeExtent:Hn,viewport:hO,onViewportChange:pO}),E.jsx(zx,{nodes:t,edges:e,defaultNodes:n,defaultEdges:r,onConnect:p,onConnectStart:f,onConnectEnd:m,onClickConnectStart:y,onClickConnectEnd:g,nodesDraggable:nn,nodesConnectable:rn,nodesFocusable:on,edgesFocusable:Mt,edgesReconnectable:Et,elementsSelectable:Ct,elevateNodesOnSelect:nO,elevateEdgesOnSelect:rO,minZoom:_t,maxZoom:Ve,nodeExtent:Hn,onNodesChange:QS,onEdgesChange:ZS,snapToGrid:he,snapGrid:me,connectionMode:W,translateExtent:sn,connectOnClick:KS,defaultEdgeOptions:tO,fitView:rf,fitViewOptions:GS,onNodesDelete:B,onEdgesDelete:V,onDelete:z,onNodeDragStart:S,onNodeDrag:j,onNodeDragStop:$,onSelectionDrag:A,onSelectionDragStart:w,onSelectionDragStop:_,onMove:u,onMoveStart:d,onMoveEnd:h,noPanClassName:nf,nodeOrigin:lt,rfId:ys,autoPanOnConnect:iO,autoPanOnNodeDrag:oO,autoPanSpeed:sO,onError:lO,connectionRadius:aO,isValidConnection:cO,selectNodesOnDrag:rt,nodeDragThreshold:dO,onBeforeDelete:L,paneClickDistance:pe,debug:gO}),E.jsx(Bx,{onSelectionChange:F}),$e,E.jsx(Tx,{proOptions:eO,position:JS}),E.jsx(Px,{rfId:ys,disableKeyboardA11y:of})]})})}bf=sl(lv);const uv=t=>{var e;return(e=t.domNode)==null?void 0:e.querySelector(".react-flow__viewport-portal")};xf=function({children:t}){const e=ue(uv);return e?SO.createPortal(t,e):null};const dv=t=>t.nodes;gf=function(){return ue(dv,xe)},Of=function({type:t,id:e=null,nodeId:n,onConnect:r,onDisconnect:i}){const o=po(),s=n??o,a=M.useRef(null),c=ue(l=>l.connectionLookup.get(`${s}-${t}-${e}`),p0);return M.useEffect(()=>{if(a.current&&a.current!==c){const l=c??new Map;Ya(a.current,l,i),Ya(l,a.current,r)}a.current=c??new Map},[c,r,i]),M.useMemo(()=>Array.from((c==null?void 0:c.values())??[]),[c])},kf=function(t){return ue(M.useCallback(e=>e.nodeLookup.get(t),[t]),xe)};function hv({dimensions:t,lineWidth:e,variant:n,className:r}){return E.jsx("path",{strokeWidth:e,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`,className:Me(["react-flow__background-pattern",n,r])})}function pv({radius:t,className:e}){return E.jsx("circle",{cx:t,cy:t,r:t,className:Me(["react-flow__background-pattern","dots",e])})}(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(it||(it={}));const fv={[it.Dots]:1,[it.Lines]:1,[it.Cross]:6},mv=t=>({transform:t.transform,patternId:`pattern-${t.rfId}`});function zl({id:t,variant:e=it.Dots,gap:n=20,size:r,lineWidth:i=1,offset:o=0,color:s,bgColor:a,style:c,className:l,patternClassName:u}){const d=M.useRef(null),{transform:h,patternId:p}=ue(mv,xe),f=r||fv[e],m=e===it.Dots,y=e===it.Cross,g=Array.isArray(n)?n:[n,n],b=[g[0]*h[2]||1,g[1]*h[2]||1],x=f*h[2],v=Array.isArray(o)?o:[o,o],C=y?[x,x]:b,T=[v[0]*h[2]||1+C[0]/2,v[1]*h[2]||1+C[1]/2],S=`${p}${t||""}`;return E.jsxs("svg",{className:Me(["react-flow__background",l]),style:{...c,...Br,"--xy-background-color-props":a,"--xy-background-pattern-color-props":s},ref:d,"data-testid":"rf__background",children:[E.jsx("pattern",{id:S,x:h[0]%b[0],y:h[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${T[0]},-${T[1]})`,children:m?E.jsx(pv,{radius:x/2,className:u}):E.jsx(hv,{dimensions:C,lineWidth:i,variant:e,className:u})}),E.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${S})`})]})}zl.displayName="Background",wf=M.memo(zl);function yv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:E.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function gv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:E.jsx("path",{d:"M0 0h32v4.2H0z"})})}function xv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:E.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function vv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:E.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function bv(){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:E.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Fr({children:t,className:e,...n}){return E.jsx("button",{type:"button",className:Me(["react-flow__controls-button",e]),...n,children:t})}const wv=t=>({isInteractive:t.nodesDraggable||t.nodesConnectable||t.elementsSelectable,minZoomReached:t.transform[2]<=t.minZoom,maxZoomReached:t.transform[2]>=t.maxZoom});function Vl({style:t,showZoom:e=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:o,onZoomOut:s,onFitView:a,onInteractiveChange:c,className:l,children:u,position:d="bottom-left",orientation:h="vertical","aria-label":p="React Flow controls"}){const f=ye(),{isInteractive:m,minZoomReached:y,maxZoomReached:g}=ue(wv,xe),{zoomIn:b,zoomOut:x,fitView:v}=er(),C=()=>{b(),o==null||o()},T=()=>{x(),s==null||s()},S=()=>{v(i),a==null||a()},j=()=>{f.setState({nodesDraggable:!m,nodesConnectable:!m,elementsSelectable:!m}),c==null||c(!m)},$=h==="horizontal"?"horizontal":"vertical";return E.jsxs(Kn,{className:Me(["react-flow__controls",$,l]),position:d,style:t,"data-testid":"rf__controls","aria-label":p,children:[e&&E.jsxs(E.Fragment,{children:[E.jsx(Fr,{onClick:C,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:g,children:E.jsx(yv,{})}),E.jsx(Fr,{onClick:T,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y,children:E.jsx(gv,{})})]}),n&&E.jsx(Fr,{className:"react-flow__controls-fitview",onClick:S,title:"fit view","aria-label":"fit view",children:E.jsx(xv,{})}),r&&E.jsx(Fr,{className:"react-flow__controls-interactive",onClick:j,title:"toggle interactivity","aria-label":"toggle interactivity",children:m?E.jsx(bv,{}):E.jsx(vv,{})}),u]})}Vl.displayName="Controls",Mf=M.memo(Vl);function Mv({id:t,x:e,y:n,width:r,height:i,style:o,color:s,strokeColor:a,strokeWidth:c,className:l,borderRadius:u,shapeRendering:d,selected:h,onClick:p}){const{background:f,backgroundColor:m}=o||{},y=s||f||m;return E.jsx("rect",{className:Me(["react-flow__minimap-node",{selected:h},l]),x:e,y:n,rx:u,ry:u,width:r,height:i,style:{fill:y,stroke:a,strokeWidth:c},shapeRendering:d,onClick:p?g=>p(g,t):void 0})}const Ev=M.memo(Mv),Cv=t=>t.nodes.map(e=>e.id),fo=t=>t instanceof Function?t:()=>t;function _v({nodeStrokeColor:t,nodeColor:e,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:o=Ev,onClick:s}){const a=ue(Cv,xe),c=fo(e),l=fo(t),u=fo(n),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return E.jsx(E.Fragment,{children:a.map(h=>E.jsx(Ov,{id:h,nodeColorFunc:c,nodeStrokeColorFunc:l,nodeClassNameFunc:u,nodeBorderRadius:r,nodeStrokeWidth:i,NodeComponent:o,onClick:s,shapeRendering:d},h))})}function Sv({id:t,nodeColorFunc:e,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:i,nodeStrokeWidth:o,shapeRendering:s,NodeComponent:a,onClick:c}){const{node:l,x:u,y:d,width:h,height:p}=ue(f=>{const m=f.nodeLookup.get(t),{x:y,y:g}=m.internals.positionAbsolute,{width:b,height:x}=tt(m);return{node:m,x:y,y:g,width:b,height:x}},xe);return!l||l.hidden||!sc(l)?null:E.jsx(a,{x:u,y:d,width:h,height:p,style:l.style,selected:!!l.selected,className:r(l),color:e(l),borderRadius:i,strokeColor:n(l),strokeWidth:o,shapeRendering:s,onClick:c,id:l.id})}const Ov=M.memo(Sv);var Nv=M.memo(_v);const Av=200,Pv=150,kv=t=>{const e={x:-t.transform[0]/t.transform[2],y:-t.transform[1]/t.transform[2],width:t.width/t.transform[2],height:t.height/t.transform[2]};return{viewBB:e,boundingRect:t.nodeLookup.size>0?rc(_n(t.nodeLookup),e):e,rfId:t.rfId,panZoom:t.panZoom,translateExtent:t.translateExtent,flowWidth:t.width,flowHeight:t.height}},Tv="react-flow__minimap-desc";function ql({style:t,className:e,nodeStrokeColor:n,nodeColor:r,nodeClassName:i="",nodeBorderRadius:o=5,nodeStrokeWidth:s,nodeComponent:a,bgColor:c,maskColor:l,maskStrokeColor:u,maskStrokeWidth:d,position:h="bottom-right",onClick:p,onNodeClick:f,pannable:m=!1,zoomable:y=!1,ariaLabel:g="React Flow mini map",inversePan:b,zoomStep:x=10,offsetScale:v=5}){const C=ye(),T=M.useRef(null),{boundingRect:S,viewBB:j,rfId:$,panZoom:B,translateExtent:V,flowWidth:z,flowHeight:F}=ue(kv,xe),w=(t==null?void 0:t.width)??Av,A=(t==null?void 0:t.height)??Pv,_=S.width/w,R=S.height/A,N=Math.max(_,R),P=N*w,L=N*A,W=v*N,I=S.x-(P-S.width)/2-W,J=S.y-(L-S.height)/2-W,X=P+W*2,q=L+W*2,ee=`${Tv}-${$}`,ne=M.useRef(0),H=M.useRef();ne.current=N,M.useEffect(()=>{if(T.current&&B)return H.current=V0({domNode:T.current,panZoom:B,getTransform:()=>C.getState().transform,getViewScale:()=>ne.current}),()=>{var ce;(ce=H.current)==null||ce.destroy()}},[B]),M.useEffect(()=>{var ce;(ce=H.current)==null||ce.update({translateExtent:V,width:z,height:F,inversePan:b,pannable:m,zoomStep:x,zoomable:y})},[m,y,b,x,V,z,F]);const ae=p?ce=>{var me;const[se,he]=((me=H.current)==null?void 0:me.pointer(ce))||[0,0];p(ce,{x:se,y:he})}:void 0,oe=f?M.useCallback((ce,se)=>{const he=C.getState().nodeLookup.get(se);f(ce,he)},[]):void 0;return E.jsx(Kn,{position:h,style:{...t,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*N:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof s=="string"?s:void 0},className:Me(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:E.jsxs("svg",{width:w,height:A,viewBox:`${I} ${J} ${X} ${q}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":ee,ref:T,onClick:ae,children:[g&&E.jsx("title",{id:ee,children:g}),E.jsx(Nv,{onClick:oe,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:o,nodeClassName:i,nodeStrokeWidth:s,nodeComponent:a}),E.jsx("path",{className:"react-flow__minimap-mask",d:`M${I-W},${J-W}h${X+W*2}v${q+W*2}h${-X-W*2}z
        M${j.x},${j.y}h${j.width}v${j.height}h${-j.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}ql.displayName="MiniMap",Ef=M.memo(ql);function jv({nodeId:t,position:e,variant:n=zt.Handle,className:r,style:i={},children:o,color:s,minWidth:a=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:d=!1,shouldResize:h,onResizeStart:p,onResize:f,onResizeEnd:m}){const y=po(),g=typeof t=="string"?t:y,b=ye(),x=M.useRef(null),v=n===zt.Line?"right":"bottom-right",C=e??v,T=M.useRef(null);M.useEffect(()=>{if(!(!x.current||!g))return T.current||(T.current=ox({domNode:x.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:B,transform:V,snapGrid:z,snapToGrid:F,nodeOrigin:w,domNode:A}=b.getState();return{nodeLookup:B,transform:V,snapGrid:z,snapToGrid:F,nodeOrigin:w,paneDomNode:A}},onChange:(B,V)=>{const{triggerNodeChanges:z,nodeLookup:F,parentLookup:w,nodeOrigin:A}=b.getState(),_=[],R={x:B.x,y:B.y},N=F.get(g);if(N&&N.expandParent&&N.parentId){const P=N.origin??A,L=B.width??N.measured.width,W=B.height??N.measured.height,I={id:N.id,parentId:N.parentId,rect:{width:L,height:W,...ac({x:B.x??N.position.x,y:B.y??N.position.y},{width:L,height:W},N.parentId,F,P)}},J=no([I],F,w,A);_.push(...J),R.x=B.x?Math.max(P[0]*L,B.x):void 0,R.y=B.y?Math.max(P[1]*W,B.y):void 0}if(R.x!==void 0&&R.y!==void 0){const P={id:g,type:"position",position:{...R}};_.push(P)}if(B.width!==void 0&&B.height!==void 0){const P={id:g,type:"dimensions",resizing:!0,setAttributes:!0,dimensions:{width:B.width,height:B.height}};_.push(P)}for(const P of V){const L={...P,type:"position"};_.push(L)}z(_)},onEnd:()=>{const B={id:g,type:"dimensions",resizing:!1};b.getState().triggerNodeChanges([B])}})),T.current.update({controlPosition:C,boundaries:{minWidth:a,minHeight:c,maxWidth:l,maxHeight:u},keepAspectRatio:d,onResizeStart:p,onResize:f,onResizeEnd:m,shouldResize:h}),()=>{var B;(B=T.current)==null||B.destroy()}},[C,a,c,l,u,d,p,f,m,h]);const S=C.split("-"),j=n===zt.Line?"borderColor":"backgroundColor",$=s?{...i,[j]:s}:i;return E.jsx("div",{className:Me(["react-flow__resize-control","nodrag",...S,n,r]),ref:x,style:$,children:o})}const Wl=M.memo(jv);mf=function({nodeId:t,isVisible:e=!0,handleClassName:n,handleStyle:r,lineClassName:i,lineStyle:o,color:s,minWidth:a=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:d=!1,shouldResize:h,onResizeStart:p,onResize:f,onResizeEnd:m}){return e?E.jsxs(E.Fragment,{children:[K0.map(y=>E.jsx(Wl,{className:i,style:o,nodeId:t,position:y,variant:zt.Line,color:s,minWidth:a,minHeight:c,maxWidth:l,maxHeight:u,onResizeStart:p,keepAspectRatio:d,shouldResize:h,onResize:f,onResizeEnd:m},y)),G0.map(y=>E.jsx(Wl,{className:n,style:r,nodeId:t,position:y,color:s,minWidth:a,minHeight:c,maxWidth:l,maxHeight:u,onResizeStart:p,keepAspectRatio:d,shouldResize:h,onResize:f,onResizeEnd:m},y))]}):null};function Rv(){this.__data__=[],this.size=0}var Iv=Rv;function $v(t,e){return t===e||t!==t&&e!==e}let Hl;Yn=$v,Hl=Yn;function Bv(t,e){for(var n=t.length;n--;)if(Hl(t[n][0],e))return n;return-1}var zr=Bv,Lv=zr,Dv=Array.prototype,Fv=Dv.splice;function zv(t){var e=this.__data__,n=Lv(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Fv.call(e,n,1),--this.size,!0}var Vv=zv,qv=zr;function Wv(t){var e=this.__data__,n=qv(e,t);return n<0?void 0:e[n][1]}var Hv=Wv,Uv=zr;function Qv(t){return Uv(this.__data__,t)>-1}var Zv=Qv,Yv=zr;function Xv(t,e){var n=this.__data__,r=Yv(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}var Gv=Xv,Kv=Iv,Jv=Vv,eb=Hv,tb=Zv,nb=Gv;function Wt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Wt.prototype.clear=Kv,Wt.prototype.delete=Jv,Wt.prototype.get=eb,Wt.prototype.has=tb,Wt.prototype.set=nb;var Vr=Wt,rb=Vr;function ib(){this.__data__=new rb,this.size=0}var ob=ib;function sb(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}var ab=sb;function cb(t){return this.__data__.get(t)}var lb=cb;function ub(t){return this.__data__.has(t)}let Ul,Ql,mo,Zl,Yl,Xl,Gl,Kl,yo,go,Jl,eu,Ht;Ul=ub,Ql=typeof an=="object"&&an&&an.Object===Object&&an,mo=Ql,Zl=mo,Yl=typeof self=="object"&&self&&self.Object===Object&&self,Xl=Zl||Yl||Function("return this")(),qe=Xl,Gl=qe,Kl=Gl.Symbol,ln=Kl,yo=ln,go=Object.prototype,Jl=go.hasOwnProperty,eu=go.toString,Ht=yo?yo.toStringTag:void 0;function db(t){var e=Jl.call(t,Ht),n=t[Ht];try{t[Ht]=void 0;var r=!0}catch{}var i=eu.call(t);return r&&(e?t[Ht]=n:delete t[Ht]),i}var hb=db,pb=Object.prototype,fb=pb.toString;function mb(t){return fb.call(t)}var yb=mb,tu=ln,gb=hb,xb=yb,vb="[object Null]",bb="[object Undefined]",nu=tu?tu.toStringTag:void 0;function wb(t){return t==null?t===void 0?bb:vb:nu&&nu in Object(t)?gb(t):xb(t)}Nt=wb;function Mb(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}ut=Mb,hf=Ze(ut);var Eb=Nt,Cb=ut,_b="[object AsyncFunction]",Sb="[object Function]",Ob="[object GeneratorFunction]",Nb="[object Proxy]";function Ab(t){if(!Cb(t))return!1;var e=Eb(t);return e==Sb||e==Ob||e==_b||e==Nb}Gn=Ab,pf=Ze(Gn);var Pb=qe,kb=Pb["__core-js_shared__"],Tb=kb,xo=Tb,ru=function(){var t=/[^.]+$/.exec(xo&&xo.keys&&xo.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function jb(t){return!!ru&&ru in t}var Rb=jb,Ib=Function.prototype,$b=Ib.toString;function Bb(t){if(t!=null){try{return $b.call(t)}catch{}try{return t+""}catch{}}return""}var iu=Bb,Lb=Gn,Db=Rb,Fb=ut,zb=iu,Vb=/[\\^$.*+?()[\]{}|]/g,qb=/^\[object .+?Constructor\]$/,Wb=Function.prototype,Hb=Object.prototype,Ub=Wb.toString,Qb=Hb.hasOwnProperty,Zb=RegExp("^"+Ub.call(Qb).replace(Vb,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Yb(t){if(!Fb(t)||Db(t))return!1;var e=Lb(t)?Zb:qb;return e.test(zb(t))}var Xb=Yb;function Gb(t,e){return t==null?void 0:t[e]}var Kb=Gb,Jb=Xb,ew=Kb;function tw(t,e){var n=ew(t,e);return Jb(n)?n:void 0}var xt=tw,nw=xt,rw=qe,iw=nw(rw,"Map"),vo=iw,ow=xt,sw=ow(Object,"create"),qr=sw,ou=qr;function aw(){this.__data__=ou?ou(null):{},this.size=0}var cw=aw;function lw(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var uw=lw,dw=qr,hw="__lodash_hash_undefined__",pw=Object.prototype,fw=pw.hasOwnProperty;function mw(t){var e=this.__data__;if(dw){var n=e[t];return n===hw?void 0:n}return fw.call(e,t)?e[t]:void 0}var yw=mw,gw=qr,xw=Object.prototype,vw=xw.hasOwnProperty;function bw(t){var e=this.__data__;return gw?e[t]!==void 0:vw.call(e,t)}var ww=bw,Mw=qr,Ew="__lodash_hash_undefined__";function Cw(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Mw&&e===void 0?Ew:e,this}var _w=Cw,Sw=cw,Ow=uw,Nw=yw,Aw=ww,Pw=_w;function Ut(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ut.prototype.clear=Sw,Ut.prototype.delete=Ow,Ut.prototype.get=Nw,Ut.prototype.has=Aw,Ut.prototype.set=Pw;var kw=Ut,su=kw,Tw=Vr,jw=vo;function Rw(){this.size=0,this.__data__={hash:new su,map:new(jw||Tw),string:new su}}var Iw=Rw;function $w(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var Bw=$w,Lw=Bw;function Dw(t,e){var n=t.__data__;return Lw(e)?n[typeof e=="string"?"string":"hash"]:n.map}var Wr=Dw,Fw=Wr;function zw(t){var e=Fw(this,t).delete(t);return this.size-=e?1:0,e}var Vw=zw,qw=Wr;function Ww(t){return qw(this,t).get(t)}var Hw=Ww,Uw=Wr;function Qw(t){return Uw(this,t).has(t)}var Zw=Qw,Yw=Wr;function Xw(t,e){var n=Yw(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}var Gw=Xw,Kw=Iw,Jw=Vw,eM=Hw,tM=Zw,nM=Gw;function Qt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Qt.prototype.clear=Kw,Qt.prototype.delete=Jw,Qt.prototype.get=eM,Qt.prototype.has=tM,Qt.prototype.set=nM;var bo=Qt,rM=Vr,iM=vo,oM=bo,sM=200;function aM(t,e){var n=this.__data__;if(n instanceof rM){var r=n.__data__;if(!iM||r.length<sM-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new oM(r)}return n.set(t,e),this.size=n.size,this}var cM=aM,lM=Vr,uM=ob,dM=ab,hM=lb,pM=Ul,fM=cM;function Zt(t){var e=this.__data__=new lM(t);this.size=e.size}Zt.prototype.clear=uM,Zt.prototype.delete=dM,Zt.prototype.get=hM,Zt.prototype.has=pM,Zt.prototype.set=fM;let au;Ei=Zt,au="__lodash_hash_undefined__";function mM(t){return this.__data__.set(t,au),this}var yM=mM;function gM(t){return this.__data__.has(t)}var xM=gM,vM=bo,bM=yM,wM=xM;function Hr(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new vM;++e<n;)this.add(t[e])}Hr.prototype.add=Hr.prototype.push=bM,Hr.prototype.has=wM,_s=Hr;function MM(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}Ts=MM;function EM(t,e){return t.has(e)}let cu,lu,uu,du,hu;Ss=EM,cu=_s,lu=Ts,uu=Ss,du=1,hu=2;function CM(t,e,n,r,i,o){var s=n&du,a=t.length,c=e.length;if(a!=c&&!(s&&c>a))return!1;var l=o.get(t),u=o.get(e);if(l&&u)return l==e&&u==t;var d=-1,h=!0,p=n&hu?new cu:void 0;for(o.set(t,e),o.set(e,t);++d<a;){var f=t[d],m=e[d];if(r)var y=s?r(m,f,d,e,t,o):r(f,m,d,t,e,o);if(y!==void 0){if(y)continue;h=!1;break}if(p){if(!lu(e,function(g,b){if(!uu(p,b)&&(f===g||i(f,g,n,r,o)))return p.push(b)})){h=!1;break}}else if(!(f===m||i(f,m,n,r,o))){h=!1;break}}return o.delete(t),o.delete(e),h}let wo,pu,fu;wo=CM,pu=qe,fu=pu.Uint8Array,qs=fu;function _M(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}var SM=_M;function OM(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}let Mo,Eo,mu,yu,gu,xu,vu,bu,wu,Mu,Eu,Cu,_u,Su,Ou,Nu,Au,Pu,ku,Co,Ur;Cs=OM,Mo=ln,Eo=qs,mu=Yn,yu=wo,gu=SM,xu=Cs,vu=1,bu=2,wu="[object Boolean]",Mu="[object Date]",Eu="[object Error]",Cu="[object Map]",_u="[object Number]",Su="[object RegExp]",Ou="[object Set]",Nu="[object String]",Au="[object Symbol]",Pu="[object ArrayBuffer]",ku="[object DataView]",Co=Mo?Mo.prototype:void 0,Ur=Co?Co.valueOf:void 0;function NM(t,e,n,r,i,o,s){switch(n){case ku:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Pu:return!(t.byteLength!=e.byteLength||!o(new Eo(t),new Eo(e)));case wu:case Mu:case _u:return mu(+t,+e);case Eu:return t.name==e.name&&t.message==e.message;case Su:case Nu:return t==e+"";case Cu:var a=gu;case Ou:var c=r&vu;if(a||(a=xu),t.size!=e.size&&!c)return!1;var l=s.get(t);if(l)return l==e;r|=bu,s.set(t,e);var u=yu(a(t),a(e),r,i,o,s);return s.delete(t),u;case Au:if(Ur)return Ur.call(t)==Ur.call(e)}return!1}var AM=NM;function PM(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}let Tu,ju,Ru;hi=PM,Tu=Array.isArray,Xe=Tu,ju=hi,Ru=Xe;function kM(t,e,n){var r=e(t);return Ru(t)?r:ju(r,n(t))}var Iu=kM;function TM(t,e){for(var n=-1,r=t==null?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o}var jM=TM;function RM(){return[]}let _o,$u,Bu,Lu,Du,So,Fu;_o=RM,$u=jM,Bu=_o,Lu=Object.prototype,Du=Lu.propertyIsEnumerable,So=Object.getOwnPropertySymbols,Fu=So?function(t){return t==null?[]:(t=Object(t),$u(So(t),function(e){return Du.call(t,e)}))}:Bu,wi=Fu;function IM(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var $M=IM;function BM(t){return t!=null&&typeof t=="object"}let zu,Vu,qu;kt=BM,zu=Nt,Vu=kt,qu="[object Arguments]";function LM(t){return Vu(t)&&zu(t)==qu}let Wu,Oo,Hu,No,Uu,Qu,Zu,Tn;Wu=LM,Oo=Wu,Hu=kt,No=Object.prototype,Uu=No.hasOwnProperty,Qu=No.propertyIsEnumerable,Zu=Oo(function(){return arguments}())?Oo:function(t){return Hu(t)&&Uu.call(t,"callee")&&!Qu.call(t,"callee")},di=Zu,Tn={exports:{}};function DM(){return!1}var FM=DM;Tn.exports,function(t,e){var n=qe,r=FM,i=e&&!e.nodeType&&e,o=i&&!0&&t&&!t.nodeType&&t,s=o&&o.exports===i,a=s?n.Buffer:void 0,c=a?a.isBuffer:void 0,l=c||r;t.exports=l}(Tn,Tn.exports);let Yu,Xu;xi=Tn.exports,Yu=9007199254740991,Xu=/^(?:0|[1-9]\d*)$/;function zM(t,e){var n=typeof t;return e=e??Yu,!!e&&(n=="number"||n!="symbol"&&Xu.test(t))&&t>-1&&t%1==0&&t<e}let Gu;Xn=zM,Gu=9007199254740991;function VM(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Gu}var Ao=VM,qM=Nt,WM=Ao,HM=kt,UM="[object Arguments]",QM="[object Array]",ZM="[object Boolean]",YM="[object Date]",XM="[object Error]",GM="[object Function]",KM="[object Map]",JM="[object Number]",eE="[object Object]",tE="[object RegExp]",nE="[object Set]",rE="[object String]",iE="[object WeakMap]",oE="[object ArrayBuffer]",sE="[object DataView]",aE="[object Float32Array]",cE="[object Float64Array]",lE="[object Int8Array]",uE="[object Int16Array]",dE="[object Int32Array]",hE="[object Uint8Array]",pE="[object Uint8ClampedArray]",fE="[object Uint16Array]",mE="[object Uint32Array]",ge={};ge[aE]=ge[cE]=ge[lE]=ge[uE]=ge[dE]=ge[hE]=ge[pE]=ge[fE]=ge[mE]=!0,ge[UM]=ge[QM]=ge[oE]=ge[ZM]=ge[sE]=ge[YM]=ge[XM]=ge[GM]=ge[KM]=ge[JM]=ge[eE]=ge[tE]=ge[nE]=ge[rE]=ge[iE]=!1;function yE(t){return HM(t)&&WM(t.length)&&!!ge[qM(t)]}var gE=yE;function xE(t){return function(e){return t(e)}}let jn;As=xE,jn={exports:{}},jn.exports,function(t,e){var n=mo,r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,o=i&&i.exports===r,s=o&&n.process,a=function(){try{var c=i&&i.require&&i.require("util").types;return c||s&&s.binding&&s.binding("util")}catch{}}();t.exports=a}(jn,jn.exports);let Ku,Ju,Po,ko,ed,td,nd,rd,id,od,sd,ad,cd;Hs=jn.exports,Ku=gE,Ju=As,Po=Hs,ko=Po&&Po.isTypedArray,ed=ko?Ju(ko):Ku,vi=ed,td=$M,nd=di,rd=Xe,id=xi,od=Xn,sd=vi,ad=Object.prototype,cd=ad.hasOwnProperty;function vE(t,e){var n=rd(t),r=!n&&nd(t),i=!n&&!r&&id(t),o=!n&&!r&&!i&&sd(t),s=n||r||i||o,a=s?td(t.length,String):[],c=a.length;for(var l in t)(e||cd.call(t,l))&&!(s&&(l=="length"||i&&(l=="offset"||l=="parent")||o&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||od(l,c)))&&a.push(l);return a}var ld=vE,bE=Object.prototype;function wE(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||bE;return t===n}Mi=wE;function ME(t,e){return function(n){return t(e(n))}}var ud=ME,EE=ud,CE=EE(Object.keys,Object),_E=CE,SE=Mi,OE=_E,NE=Object.prototype,AE=NE.hasOwnProperty;function PE(t){if(!SE(t))return OE(t);var e=[];for(var n in Object(t))AE.call(t,n)&&n!="constructor"&&e.push(n);return e}var kE=PE,TE=Gn,jE=Ao;function RE(t){return t!=null&&jE(t.length)&&!TE(t)}let dd,hd,pd;mi=RE,dd=ld,hd=kE,pd=mi;function IE(t){return pd(t)?dd(t):hd(t)}let fd,md,yd;pi=IE,fd=Iu,md=wi,yd=pi;function $E(t){return fd(t,yd,md)}let To,gd,xd,vd;Rs=$E,To=Rs,gd=1,xd=Object.prototype,vd=xd.hasOwnProperty;function BE(t,e,n,r,i,o){var s=n&gd,a=To(t),c=a.length,l=To(e),u=l.length;if(c!=u&&!s)return!1;for(var d=c;d--;){var h=a[d];if(!(s?h in e:vd.call(e,h)))return!1}var p=o.get(t),f=o.get(e);if(p&&f)return p==e&&f==t;var m=!0;o.set(t,e),o.set(e,t);for(var y=s;++d<c;){h=a[d];var g=t[h],b=e[h];if(r)var x=s?r(b,g,h,e,t,o):r(g,b,h,t,e,o);if(!(x===void 0?g===b||i(g,b,n,r,o):x)){m=!1;break}y||(y=h=="constructor")}if(m&&!y){var v=t.constructor,C=e.constructor;v!=C&&"constructor"in t&&"constructor"in e&&!(typeof v=="function"&&v instanceof v&&typeof C=="function"&&C instanceof C)&&(m=!1)}return o.delete(t),o.delete(e),m}let bd,wd,Md,Ed,Cd,_d,Sd,Od,Nd,Ad,Pd,kd,Td,jd,Rd,Id,Qr,Zr,Yr,Xr,Gr,jo,vt,Ro,$d,Io,$o,Bo,Lo,Bd,Ld,Dd,Fd,zd,ct;bd=BE,wd=xt,Md=qe,Ed=wd(Md,"DataView"),Cd=Ed,_d=xt,Sd=qe,Od=_d(Sd,"Promise"),Nd=Od,Ad=xt,Pd=qe,kd=Ad(Pd,"Set"),Ms=kd,Td=xt,jd=qe,Rd=Td(jd,"WeakMap"),Id=Rd,Qr=Cd,Zr=vo,Yr=Nd,Xr=Ms,Gr=Id,jo=Nt,vt=iu,Ro="[object Map]",$d="[object Object]",Io="[object Promise]",$o="[object Set]",Bo="[object WeakMap]",Lo="[object DataView]",Bd=vt(Qr),Ld=vt(Zr),Dd=vt(Yr),Fd=vt(Xr),zd=vt(Gr),ct=jo,(Qr&&ct(new Qr(new ArrayBuffer(1)))!=Lo||Zr&&ct(new Zr)!=Ro||Yr&&ct(Yr.resolve())!=Io||Xr&&ct(new Xr)!=$o||Gr&&ct(new Gr)!=Bo)&&(ct=function(t){var e=jo(t),n=e==$d?t.constructor:void 0,r=n?vt(n):"";if(r)switch(r){case Bd:return Lo;case Ld:return Ro;case Dd:return Io;case Fd:return $o;case zd:return Bo}return e});let Kr,Vd,qd,Wd,Do,Fo,zo,Hd,Ud,Vo,qo,Rn,Qd,Wo;Ws=ct,Kr=Ei,Vd=wo,qd=AM,Wd=bd,Do=Ws,Fo=Xe,zo=xi,Hd=vi,Ud=1,Vo="[object Arguments]",qo="[object Array]",Rn="[object Object]",Qd=Object.prototype,Wo=Qd.hasOwnProperty;function LE(t,e,n,r,i,o){var s=Fo(t),a=Fo(e),c=s?qo:Do(t),l=a?qo:Do(e);c=c==Vo?Rn:c,l=l==Vo?Rn:l;var u=c==Rn,d=l==Rn,h=c==l;if(h&&zo(t)){if(!zo(e))return!1;s=!0,u=!1}if(h&&!u)return o||(o=new Kr),s||Hd(t)?Vd(t,e,n,r,i,o):qd(t,e,c,n,r,i,o);if(!(n&Ud)){var p=u&&Wo.call(t,"__wrapped__"),f=d&&Wo.call(e,"__wrapped__");if(p||f){var m=p?t.value():t,y=f?e.value():e;return o||(o=new Kr),i(m,y,n,r,o)}}return h?(o||(o=new Kr),Wd(t,e,n,r,i,o)):!1}var DE=LE,FE=DE,Zd=kt;function Yd(t,e,n,r,i){return t===e?!0:t==null||e==null||!Zd(t)&&!Zd(e)?t!==t&&e!==e:FE(t,e,n,r,Yd,i)}let Xd,Gd,Kd,Jd;gi=Yd,Xd=Ei,Gd=gi,Kd=1,Jd=2;function zE(t,e,n,r){var i=n.length,o=i,s=!r;if(t==null)return!o;for(t=Object(t);i--;){var a=n[i];if(s&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<o;){a=n[i];var c=a[0],l=t[c],u=a[1];if(s&&a[2]){if(l===void 0&&!(c in t))return!1}else{var d=new Xd;if(r)var h=r(l,u,c,t,e,d);if(!(h===void 0?Gd(u,l,Kd|Jd,r,d):h))return!1}}return!0}var VE=zE,qE=ut;function WE(t){return t===t&&!qE(t)}var eh=WE,HE=eh,UE=pi;function QE(t){for(var e=UE(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,HE(i)]}return e}var ZE=QE;function YE(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}var th=YE,XE=VE,GE=ZE,KE=th;function JE(t){var e=GE(t);return e.length==1&&e[0][2]?KE(e[0][0],e[0][1]):function(n){return n===t||XE(n,t,e)}}var e2=JE,t2=Nt,n2=kt,r2="[object Symbol]";function i2(t){return typeof t=="symbol"||n2(t)&&t2(t)==r2}let nh,rh,ih,oh;Qn=i2,nh=Xe,rh=Qn,ih=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,oh=/^\w*$/;function o2(t,e){if(nh(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||rh(t)?!0:oh.test(t)||!ih.test(t)||e!=null&&t in Object(e)}var Ho=o2,sh=bo,s2="Expected a function";function Uo(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(s2);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=t.apply(this,r);return n.cache=o.set(i,s)||o,s};return n.cache=new(Uo.Cache||sh),n}Uo.Cache=sh;var ah=Uo;ff=Ze(ah);var a2=ah,c2=500;function l2(t){var e=a2(t,function(r){return n.size===c2&&n.clear(),r}),n=e.cache;return e}var u2=l2,d2=u2,h2=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,p2=/\\(\\)?/g,f2=d2(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(h2,function(n,r,i,o){e.push(i?o.replace(p2,"$1"):r||n)}),e}),m2=f2;function y2(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}let Qo,ch,lh,uh,dh,Zo,Yo;yi=y2,Qo=ln,ch=yi,lh=Xe,uh=Qn,dh=1/0,Zo=Qo?Qo.prototype:void 0,Yo=Zo?Zo.toString:void 0;function hh(t){if(typeof t=="string")return t;if(lh(t))return ch(t,hh)+"";if(uh(t))return Yo?Yo.call(t):"";var e=t+"";return e=="0"&&1/t==-dh?"-0":e}var g2=hh,x2=g2;function v2(t){return t==null?"":x2(t)}let ph,fh,mh,yh;ws=v2,ph=Xe,fh=Ho,mh=m2,yh=ws;function b2(t,e){return ph(t)?t:fh(t,e)?[t]:mh(yh(t))}let gh,xh;un=b2,gh=Qn,xh=1/0;function w2(t){if(typeof t=="string"||gh(t))return t;var e=t+"";return e=="0"&&1/t==-xh?"-0":e}let vh,bh;Pt=w2,vh=un,bh=Pt;function M2(t,e){e=vh(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[bh(e[n++])];return n&&n==r?t:void 0}let wh;Zn=M2,wh=Zn;function E2(t,e,n){var r=t==null?void 0:wh(t,e);return r===void 0?n:r}var Mh=E2;Tf=Ze(Mh);function C2(t,e){return t!=null&&e in Object(t)}var _2=C2,S2=un,O2=di,N2=Xe,A2=Xn,P2=Ao,k2=Pt;function T2(t,e,n){e=S2(e,t);for(var r=-1,i=e.length,o=!1;++r<i;){var s=k2(e[r]);if(!(o=t!=null&&n(t,s)))break;t=t[s]}return o||++r!=i?o:(i=t==null?0:t.length,!!i&&P2(i)&&A2(s,i)&&(N2(t)||O2(t)))}var j2=T2,R2=_2,I2=j2;function $2(t,e){return t!=null&&I2(t,e,R2)}let Eh,Ch,_h,Sh,Oh,Nh,Ah,Ph,kh;Ls=$2,Eh=gi,Ch=Mh,_h=Ls,Sh=Ho,Oh=eh,Nh=th,Ah=Pt,Ph=1,kh=2;function B2(t,e){return Sh(t)&&Oh(e)?Nh(Ah(t),e):function(n){var r=Ch(n,t);return r===void 0&&r===e?_h(n,t):Eh(e,r,Ph|kh)}}var L2=B2;function D2(t){return t}Ps=D2;function F2(t){return function(e){return e==null?void 0:e[t]}}var z2=F2,V2=Zn;function q2(t){return function(e){return V2(e,t)}}var W2=q2,H2=z2,U2=W2,Q2=Ho,Z2=Pt;function Y2(t){return Q2(t)?H2(Z2(t)):U2(t)}var X2=Y2,G2=e2,K2=L2,J2=Ps,eC=Xe,tC=X2;function nC(t){return typeof t=="function"?t:t==null?J2:typeof t=="object"?eC(t)?K2(t[0],t[1]):G2(t):tC(t)}let Th;ui=nC,Th="Expected a function";function rC(t){if(typeof t!="function")throw new TypeError(Th);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}let jh,Rh,Ih,Xo;jh=rC,Rh=xt,Ih=function(){try{var t=Rh(Object,"defineProperty");return t({},"",{}),t}catch{}}(),vs=Ih,Xo=vs;function iC(t,e,n){e=="__proto__"&&Xo?Xo(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}let $h,Bh,Lh,Dh;js=iC,$h=js,Bh=Yn,Lh=Object.prototype,Dh=Lh.hasOwnProperty;function oC(t,e,n){var r=t[e];(!(Dh.call(t,e)&&Bh(r,n))||n===void 0&&!(e in t))&&$h(t,e,n)}let Fh,zh,Vh,Go,qh;Fs=oC,Fh=Fs,zh=un,Vh=Xn,Go=ut,qh=Pt;function sC(t,e,n,r){if(!Go(t))return t;e=zh(e,t);for(var i=-1,o=e.length,s=o-1,a=t;a!=null&&++i<o;){var c=qh(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=s){var u=a[c];l=r?r(u,c,a):void 0,l===void 0&&(l=Go(u)?u:Vh(e[i+1])?[]:{})}Fh(a,c,l),a=a[c]}return t}var aC=sC,cC=Zn,lC=aC,uC=un;function dC(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var s=e[r],a=cC(t,s);n(a,s)&&lC(o,uC(s,t),a)}return o}let Wh,Hh,Uh,Qh,Zh,Yh,Xh,Gh;Bs=dC,Wh=ud,Hh=Wh(Object.getPrototypeOf,Object),ks=Hh,Uh=hi,Qh=ks,Zh=wi,Yh=_o,Xh=Object.getOwnPropertySymbols,Gh=Xh?function(t){for(var e=[];t;)Uh(e,Zh(t)),t=Qh(t);return e}:Yh,Vs=Gh;function hC(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var pC=hC,fC=ut,mC=Mi,yC=pC,gC=Object.prototype,xC=gC.hasOwnProperty;function vC(t){if(!fC(t))return yC(t);var e=mC(t),n=[];for(var r in t)r=="constructor"&&(e||!xC.call(t,r))||n.push(r);return n}var bC=vC,wC=ld,MC=bC,EC=mi;function CC(t){return EC(t)?wC(t,!0):MC(t)}let Kh,Jh,ep;zs=CC,Kh=Iu,Jh=Vs,ep=zs;function _C(t){return Kh(t,ep,Jh)}let tp,np,rp,ip;Is=_C,tp=yi,np=ui,rp=Bs,ip=Is;function SC(t,e){if(t==null)return{};var n=tp(ip(t),function(r){return[r]});return e=np(e),rp(t,n,function(r,i){return e(r,i[0])})}var OC=SC,NC=ui,AC=jh,PC=OC;function kC(t,e){return PC(t,AC(NC(e)))}var TC=kC;tr=Ze(TC);function jC(t){return t===void 0}var RC=jC;nr=Ze(RC);var IC=function(t){return $C(t)&&!BC(t)};function $C(t){return!!t&&typeof t=="object"}function BC(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||FC(t)}var LC=typeof Symbol=="function"&&Symbol.for,DC=LC?Symbol.for("react.element"):60103;function FC(t){return t.$$typeof===DC}function zC(t){return Array.isArray(t)?[]:{}}function In(t,e){return e.clone!==!1&&e.isMergeableObject(t)?Yt(zC(t),t,e):t}function VC(t,e,n){return t.concat(e).map(function(r){return In(r,n)})}function qC(t,e){if(!e.customMerge)return Yt;var n=e.customMerge(t);return typeof n=="function"?n:Yt}function WC(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter(function(e){return Object.propertyIsEnumerable.call(t,e)}):[]}function op(t){return Object.keys(t).concat(WC(t))}function sp(t,e){try{return e in t}catch{return!1}}function HC(t,e){return sp(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))}function UC(t,e,n){var r={};return n.isMergeableObject(t)&&op(t).forEach(function(i){r[i]=In(t[i],n)}),op(e).forEach(function(i){HC(t,i)||(sp(t,i)&&n.isMergeableObject(e[i])?r[i]=qC(i,n)(t[i],e[i],n):r[i]=In(e[i],n))}),r}function Yt(t,e,n){n=n||{},n.arrayMerge=n.arrayMerge||VC,n.isMergeableObject=n.isMergeableObject||IC,n.cloneUnlessOtherwiseSpecified=In;var r=Array.isArray(e),i=Array.isArray(t),o=r===i;return o?r?n.arrayMerge(t,e,n):UC(t,e,n):In(e,n)}Yt.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(n,r){return Yt(n,r,e)},{})};var QC=Yt,ZC=QC;Jn=Ze(ZC);var ap;(function(t){(function(e){var n=typeof globalThis=="object"?globalThis:typeof an=="object"?an:typeof self=="object"?self:typeof this=="object"?this:a(),r=i(t);typeof n.Reflect<"u"&&(r=i(n.Reflect,r)),e(r,n),typeof n.Reflect>"u"&&(n.Reflect=t);function i(c,l){return function(u,d){Object.defineProperty(c,u,{configurable:!0,writable:!0,value:d}),l&&l(u,d)}}function o(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return o()||s()}})(function(e,n){var r=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",o=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,u={create:a?function(){return Un(Object.create(null))}:c?function(){return Un({__proto__:null})}:function(){return Un({})},has:l?function(O,k){return r.call(O,k)}:function(O,k){return k in O},get:l?function(O,k){return r.call(O,k)?O[k]:void 0}:function(O,k){return O[k]}},d=Object.getPrototypeOf(Function),h=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:sn(),p=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ps(),f=typeof WeakMap=="function"?WeakMap:Hn(),m=i?Symbol.for("@reflect-metadata:registry"):void 0,y=Ct(),g=Wn(y);function b(O,k,D,U){if(I(D)){if(!ce(O))throw new TypeError;if(!he(k))throw new TypeError;return z(O,k)}else{if(!ce(O))throw new TypeError;if(!q(k))throw new TypeError;if(!q(U)&&!I(U)&&!J(U))throw new TypeError;return J(U)&&(U=void 0),D=oe(D),F(O,k,D,U)}}e("decorate",b);function x(O,k){function D(U,ie){if(!q(U))throw new TypeError;if(!I(ie)&&!me(ie))throw new TypeError;N(O,k,U,ie)}return D}e("metadata",x);function v(O,k,D,U){if(!q(D))throw new TypeError;return I(U)||(U=oe(U)),N(O,k,D,U)}e("defineMetadata",v);function C(O,k,D){if(!q(k))throw new TypeError;return I(D)||(D=oe(D)),w(O,k,D)}e("hasMetadata",C);function T(O,k,D){if(!q(k))throw new TypeError;return I(D)||(D=oe(D)),A(O,k,D)}e("hasOwnMetadata",T);function S(O,k,D){if(!q(k))throw new TypeError;return I(D)||(D=oe(D)),_(O,k,D)}e("getMetadata",S);function j(O,k,D){if(!q(k))throw new TypeError;return I(D)||(D=oe(D)),R(O,k,D)}e("getOwnMetadata",j);function $(O,k){if(!q(O))throw new TypeError;return I(k)||(k=oe(k)),P(O,k)}e("getMetadataKeys",$);function B(O,k){if(!q(O))throw new TypeError;return I(k)||(k=oe(k)),L(O,k)}e("getOwnMetadataKeys",B);function V(O,k,D){if(!q(k))throw new TypeError;if(I(D)||(D=oe(D)),!q(k))throw new TypeError;I(D)||(D=oe(D));var U=Ve(k,D,!1);return I(U)?!1:U.OrdinaryDeleteMetadata(O,k,D)}e("deleteMetadata",V);function z(O,k){for(var D=O.length-1;D>=0;--D){var U=O[D],ie=U(k);if(!I(ie)&&!J(ie)){if(!he(ie))throw new TypeError;k=ie}}return k}function F(O,k,D,U){for(var ie=O.length-1;ie>=0;--ie){var Ce=O[ie],we=Ce(k,D,U);if(!I(we)&&!J(we)){if(!q(we))throw new TypeError;U=we}}return U}function w(O,k,D){var U=A(O,k,D);if(U)return!0;var ie=Mt(k);return J(ie)?!1:w(O,ie,D)}function A(O,k,D){var U=Ve(k,D,!1);return I(U)?!1:H(U.OrdinaryHasOwnMetadata(O,k,D))}function _(O,k,D){var U=A(O,k,D);if(U)return R(O,k,D);var ie=Mt(k);if(!J(ie))return _(O,ie,D)}function R(O,k,D){var U=Ve(k,D,!1);if(!I(U))return U.OrdinaryGetOwnMetadata(O,k,D)}function N(O,k,D,U){var ie=Ve(D,U,!0);ie.OrdinaryDefineOwnMetadata(O,k,D,U)}function P(O,k){var D=L(O,k),U=Mt(O);if(U===null)return D;var ie=P(U,k);if(ie.length<=0)return D;if(D.length<=0)return ie;for(var Ce=new p,we=[],le=0,Z=D;le<Z.length;le++){var G=Z[le],K=Ce.has(G);K||(Ce.add(G),we.push(G))}for(var te=0,de=ie;te<de.length;te++){var G=de[te],K=Ce.has(G);K||(Ce.add(G),we.push(G))}return we}function L(O,k){var D=Ve(O,k,!1);return D?D.OrdinaryOwnMetadataKeys(O,k):[]}function W(O){if(O===null)return 1;switch(typeof O){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return O===null?1:6;default:return 6}}function I(O){return O===void 0}function J(O){return O===null}function X(O){return typeof O=="symbol"}function q(O){return typeof O=="object"?O!==null:typeof O=="function"}function ee(O,k){switch(W(O)){case 0:return O;case 1:return O;case 2:return O;case 3:return O;case 4:return O;case 5:return O}var D="string",U=rt(O,o);if(U!==void 0){var ie=U.call(O,D);if(q(ie))throw new TypeError;return ie}return ne(O)}function ne(O,k){var D,U;{var ie=O.toString;if(se(ie)){var U=ie.call(O);if(!q(U))return U}var D=O.valueOf;if(se(D)){var U=D.call(O);if(!q(U))return U}}throw new TypeError}function H(O){return!!O}function ae(O){return""+O}function oe(O){var k=ee(O);return X(k)?k:ae(k)}function ce(O){return Array.isArray?Array.isArray(O):O instanceof Object?O instanceof Array:Object.prototype.toString.call(O)==="[object Array]"}function se(O){return typeof O=="function"}function he(O){return typeof O=="function"}function me(O){switch(W(O)){case 3:return!0;case 4:return!0;default:return!1}}function Te(O,k){return O===k||O!==O&&k!==k}function rt(O,k){var D=O[k];if(D!=null){if(!se(D))throw new TypeError;return D}}function nn(O){var k=rt(O,s);if(!se(k))throw new TypeError;var D=k.call(O);if(!q(D))throw new TypeError;return D}function rn(O){return O.value}function on(O){var k=O.next();return k.done?!1:k}function lt(O){var k=O.return;k&&k.call(O)}function Mt(O){var k=Object.getPrototypeOf(O);if(typeof O!="function"||O===d||k!==d)return k;var D=O.prototype,U=D&&Object.getPrototypeOf(D);if(U==null||U===Object.prototype)return k;var ie=U.constructor;return typeof ie!="function"||ie===O?k:ie}function Et(){var O;!I(m)&&typeof n.Reflect<"u"&&!(m in n.Reflect)&&typeof n.Reflect.defineMetadata=="function"&&(O=_t(n.Reflect));var k,D,U,ie=new f,Ce={registerProvider:we,getProvider:Z,setProvider:K};return Ce;function we(te){if(!Object.isExtensible(Ce))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case O===te:break;case I(k):k=te;break;case k===te:break;case I(D):D=te;break;case D===te:break;default:U===void 0&&(U=new p),U.add(te);break}}function le(te,de){if(!I(k)){if(k.isProviderFor(te,de))return k;if(!I(D)){if(D.isProviderFor(te,de))return k;if(!I(U))for(var pe=nn(U);;){var be=on(pe);if(!be)return;var $e=rn(be);if($e.isProviderFor(te,de))return lt(pe),$e}}}if(!I(O)&&O.isProviderFor(te,de))return O}function Z(te,de){var pe=ie.get(te),be;return I(pe)||(be=pe.get(de)),I(be)&&(be=le(te,de),I(be)||(I(pe)&&(pe=new h,ie.set(te,pe)),pe.set(de,be))),be}function G(te){if(I(te))throw new TypeError;return k===te||D===te||!I(U)&&U.has(te)}function K(te,de,pe){if(!G(pe))throw new Error("Metadata provider not registered.");var be=Z(te,de);if(be!==pe){if(!I(be))return!1;var $e=ie.get(te);I($e)&&($e=new h,ie.set(te,$e)),$e.set(de,pe)}return!0}}function Ct(){var O;return!I(m)&&q(n.Reflect)&&Object.isExtensible(n.Reflect)&&(O=n.Reflect[m]),I(O)&&(O=Et()),!I(m)&&q(n.Reflect)&&Object.isExtensible(n.Reflect)&&Object.defineProperty(n.Reflect,m,{enumerable:!1,configurable:!1,writable:!1,value:O}),O}function Wn(O){var k=new f,D={isProviderFor:function(G,K){var te=k.get(G);return I(te)?!1:te.has(K)},OrdinaryDefineOwnMetadata:we,OrdinaryHasOwnMetadata:ie,OrdinaryGetOwnMetadata:Ce,OrdinaryOwnMetadataKeys:le,OrdinaryDeleteMetadata:Z};return y.registerProvider(D),D;function U(G,K,te){var de=k.get(G),pe=!1;if(I(de)){if(!te)return;de=new h,k.set(G,de),pe=!0}var be=de.get(K);if(I(be)){if(!te)return;if(be=new h,de.set(K,be),!O.setProvider(G,K,D))throw de.delete(K),pe&&k.delete(G),new Error("Wrong provider for target.")}return be}function ie(G,K,te){var de=U(K,te,!1);return I(de)?!1:H(de.has(G))}function Ce(G,K,te){var de=U(K,te,!1);if(!I(de))return de.get(G)}function we(G,K,te,de){var pe=U(te,de,!0);pe.set(G,K)}function le(G,K){var te=[],de=U(G,K,!1);if(I(de))return te;for(var pe=de.keys(),be=nn(pe),$e=0;;){var ai=on(be);if(!ai)return te.length=$e,te;var fs=rn(ai);try{te[$e]=fs}catch(ms){try{lt(be)}finally{throw ms}}$e++}}function Z(G,K,te){var de=U(K,te,!1);if(I(de)||!de.delete(G))return!1;if(de.size===0){var pe=k.get(K);I(pe)||(pe.delete(te),pe.size===0&&k.delete(pe))}return!0}}function _t(O){var k=O.defineMetadata,D=O.hasOwnMetadata,U=O.getOwnMetadata,ie=O.getOwnMetadataKeys,Ce=O.deleteMetadata,we=new f,le={isProviderFor:function(Z,G){var K=we.get(Z);return!I(K)&&K.has(G)?!0:ie(Z,G).length?(I(K)&&(K=new p,we.set(Z,K)),K.add(G),!0):!1},OrdinaryDefineOwnMetadata:k,OrdinaryHasOwnMetadata:D,OrdinaryGetOwnMetadata:U,OrdinaryOwnMetadataKeys:ie,OrdinaryDeleteMetadata:Ce};return le}function Ve(O,k,D){var U=y.getProvider(O,k);if(!I(U))return U;if(D){if(y.setProvider(O,k,g))return g;throw new Error("Illegal state.")}}function sn(){var O={},k=[],D=function(){function le(Z,G,K){this._index=0,this._keys=Z,this._values=G,this._selector=K}return le.prototype["@@iterator"]=function(){return this},le.prototype[s]=function(){return this},le.prototype.next=function(){var Z=this._index;if(Z>=0&&Z<this._keys.length){var G=this._selector(this._keys[Z],this._values[Z]);return Z+1>=this._keys.length?(this._index=-1,this._keys=k,this._values=k):this._index++,{value:G,done:!1}}return{value:void 0,done:!0}},le.prototype.throw=function(Z){throw this._index>=0&&(this._index=-1,this._keys=k,this._values=k),Z},le.prototype.return=function(Z){return this._index>=0&&(this._index=-1,this._keys=k,this._values=k),{value:Z,done:!0}},le}(),U=function(){function le(){this._keys=[],this._values=[],this._cacheKey=O,this._cacheIndex=-2}return Object.defineProperty(le.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),le.prototype.has=function(Z){return this._find(Z,!1)>=0},le.prototype.get=function(Z){var G=this._find(Z,!1);return G>=0?this._values[G]:void 0},le.prototype.set=function(Z,G){var K=this._find(Z,!0);return this._values[K]=G,this},le.prototype.delete=function(Z){var G=this._find(Z,!1);if(G>=0){for(var K=this._keys.length,te=G+1;te<K;te++)this._keys[te-1]=this._keys[te],this._values[te-1]=this._values[te];return this._keys.length--,this._values.length--,Te(Z,this._cacheKey)&&(this._cacheKey=O,this._cacheIndex=-2),!0}return!1},le.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=O,this._cacheIndex=-2},le.prototype.keys=function(){return new D(this._keys,this._values,ie)},le.prototype.values=function(){return new D(this._keys,this._values,Ce)},le.prototype.entries=function(){return new D(this._keys,this._values,we)},le.prototype["@@iterator"]=function(){return this.entries()},le.prototype[s]=function(){return this.entries()},le.prototype._find=function(Z,G){if(!Te(this._cacheKey,Z)){this._cacheIndex=-1;for(var K=0;K<this._keys.length;K++)if(Te(this._keys[K],Z)){this._cacheIndex=K;break}}return this._cacheIndex<0&&G&&(this._cacheIndex=this._keys.length,this._keys.push(Z),this._values.push(void 0)),this._cacheIndex},le}();return U;function ie(le,Z){return le}function Ce(le,Z){return Z}function we(le,Z){return[le,Z]}}function ps(){var O=function(){function k(){this._map=new h}return Object.defineProperty(k.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),k.prototype.has=function(D){return this._map.has(D)},k.prototype.add=function(D){return this._map.set(D,D),this},k.prototype.delete=function(D){return this._map.delete(D)},k.prototype.clear=function(){this._map.clear()},k.prototype.keys=function(){return this._map.keys()},k.prototype.values=function(){return this._map.keys()},k.prototype.entries=function(){return this._map.entries()},k.prototype["@@iterator"]=function(){return this.keys()},k.prototype[s]=function(){return this.keys()},k}();return O}function Hn(){var O=16,k=u.create(),D=U();return function(){function Z(){this._key=U()}return Z.prototype.has=function(G){var K=ie(G,!1);return K!==void 0?u.has(K,this._key):!1},Z.prototype.get=function(G){var K=ie(G,!1);return K!==void 0?u.get(K,this._key):void 0},Z.prototype.set=function(G,K){var te=ie(G,!0);return te[this._key]=K,this},Z.prototype.delete=function(G){var K=ie(G,!1);return K!==void 0?delete K[this._key]:!1},Z.prototype.clear=function(){this._key=U()},Z}();function U(){var Z;do Z="@@WeakMap@@"+le();while(u.has(k,Z));return k[Z]=!0,Z}function ie(Z,G){if(!r.call(Z,D)){if(!G)return;Object.defineProperty(Z,D,{value:u.create()})}return Z[D]}function Ce(Z,G){for(var K=0;K<G;++K)Z[K]=Math.random()*255|0;return Z}function we(Z){if(typeof Uint8Array=="function"){var G=new Uint8Array(Z);return typeof crypto<"u"?crypto.getRandomValues(G):typeof msCrypto<"u"?msCrypto.getRandomValues(G):Ce(G,Z),G}return Ce(new Array(Z),Z)}function le(){var Z=we(O);Z[6]=Z[6]&79|64,Z[8]=Z[8]&191|128;for(var G="",K=0;K<O;++K){var te=Z[K];(K===4||K===6||K===8)&&(G+="-"),te<16&&(G+="0"),G+=te.toString(16).toLowerCase()}return G}}function Un(O){return O.__=void 0,delete O.__,O}})})(ap||(ap={})),bi=globalThis||void 0||self,typeof window<"u"&&(window.Buffer=OO.Buffer),typeof bi<"u"&&typeof require<"u"&&(bi.Buffer=require("buffer/").Buffer);class Ee{static isObject(e){return e!==null&&typeof e=="object"}static isObjectWithName(e){return e!==null&&typeof e=="object"&&e.name!==void 0}static assign(e,...n){for(const r of n)for(const i of Object.getOwnPropertyNames(r))e[i]=r[i]}static mixedListToArray(e){return e!==null&&typeof e=="object"?Object.keys(e).map(n=>e[n]):e}}class Y extends Error{get name(){return this.constructor.name}constructor(e){super(e),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}class Xt extends Y{constructor(){super("Locking not supported on given driver.")}}class Ko extends Y{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}class fe{static isMssqlParameter(e){return this.check(e,"MssqlParameter")}static isEntityMetadata(e){return this.check(e,"EntityMetadata")}static isColumnMetadata(e){return this.check(e,"ColumnMetadata")}static isSelectQueryBuilder(e){return this.check(e,"SelectQueryBuilder")}static isInsertQueryBuilder(e){return this.check(e,"InsertQueryBuilder")}static isDeleteQueryBuilder(e){return this.check(e,"DeleteQueryBuilder")}static isUpdateQueryBuilder(e){return this.check(e,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(e){return this.check(e,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(e){return this.check(e,"RelationQueryBuilder")}static isBrackets(e){return this.check(e,"Brackets")||this.check(e,"NotBrackets")}static isNotBrackets(e){return this.check(e,"NotBrackets")}static isSubject(e){return this.check(e,"Subject")}static isRdbmsSchemaBuilder(e){return this.check(e,"RdbmsSchemaBuilder")}static isMongoEntityManager(e){return this.check(e,"MongoEntityManager")}static isSqljsEntityManager(e){return this.check(e,"SqljsEntityManager")}static isEntitySchema(e){return this.check(e,"EntitySchema")}static isBaseEntityConstructor(e){return typeof e=="function"&&typeof e.hasId=="function"&&typeof e.save=="function"&&typeof e.useDataSource=="function"}static isFindOperator(e){return this.check(e,"FindOperator")||this.check(e,"EqualOperator")}static isEqualOperator(e){return this.check(e,"EqualOperator")}static isQuery(e){return this.check(e,"Query")}static isTable(e){return this.check(e,"Table")}static isTableCheck(e){return this.check(e,"TableCheck")}static isTableColumn(e){return this.check(e,"TableColumn")}static isTableExclusion(e){return this.check(e,"TableExclusion")}static isTableForeignKey(e){return this.check(e,"TableForeignKey")}static isTableIndex(e){return this.check(e,"TableIndex")}static isTableUnique(e){return this.check(e,"TableUnique")}static isView(e){return this.check(e,"View")}static isDataSource(e){return this.check(e,"DataSource")}static check(e,n){return typeof e=="object"&&e!==null&&e["@instanceof"]===Symbol.for(n)}}class YC extends Y{constructor(e,n){super(),this.entityClass=e,this.criteria=n,this.message=`Could not find any entity of type "${this.stringifyTarget(e)}" matching: ${this.stringifyCriteria(n)}`}stringifyTarget(e){return fe.isEntitySchema(e)?e.options.name:typeof e=="function"||Ee.isObject(e)&&"name"in e?e.name:e}stringifyCriteria(e){try{return JSON.stringify(e,null,4)}catch{}return""+e}}class cp extends Y{constructor(e,n,r){super(`The optimistic lock on entity ${e} failed, version ${n} was expected, but is actually ${r}.`)}}class lp extends Y{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}class XC extends Y{constructor(e){super(`Entity "${e.name}" does not have delete date columns.`)}}class Jr extends Y{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}class Ue extends Y{constructor(e,n){super(e),Object.setPrototypeOf(this,Ue.prototype),this.message=`Property "${e}" was not found in "${n.targetName}". Make sure your query is correct.`}}class GC extends Y{constructor(e){super(`Entity ${e} does not have version or update date columns.`)}}class KC extends Y{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}class $n extends Y{constructor(){super("The optimistic lock can be used only with getOne() method.")}}class JC extends Y{constructor(e){super(),e.length===1?this.message=`Relation "${e[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${e.map(n=>`"${n}"`).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}class e_ extends Y{constructor(){super("An open transaction is required for pessimistic lock.")}}class t_ extends Y{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}class up{constructor(e){Ee.assign(this,e||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(e){this._metadata=e}get metadata(){if(!this._metadata)throw new Y(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}class Qe{static isAliasProperty(e){if(typeof e!="string"||e.indexOf(".")===-1)return!1;const[n,r]=e.split(".");return!(!n||!r||e.indexOf("(")!==-1||e.indexOf(")")!==-1)}}var dp={exports:{}},Jo={exports:{}};typeof Object.create=="function"?Jo.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Jo.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}};var Gt=Jo.exports,es={exports:{}};(function(t,e){var n=NO(),r=n.Buffer;function i(s,a){for(var c in s)a[c]=s[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(i(n,e),e.Buffer=o);function o(s,a,c){return r(s,a,c)}o.prototype=Object.create(r.prototype),i(r,o),o.from=function(s,a,c){if(typeof s=="number")throw new TypeError("Argument must not be a number");return r(s,a,c)},o.alloc=function(s,a,c){if(typeof s!="number")throw new TypeError("Argument must be a number");var l=r(s);return a!==void 0?typeof c=="string"?l.fill(a,c):l.fill(a):l.fill(0),l},o.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return r(s)},o.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(s)}})(es,es.exports);var bt=es.exports,hp=bt.Buffer;function ei(t,e){this._block=hp.alloc(t),this._finalSize=e,this._blockSize=t,this._len=0}ei.prototype.update=function(t,e){typeof t=="string"&&(e=e||"utf8",t=hp.from(t,e));for(var n=this._block,r=this._blockSize,i=t.length,o=this._len,s=0;s<i;){for(var a=o%r,c=Math.min(i-s,r-a),l=0;l<c;l++)n[a+l]=t[s+l];o+=c,s+=c,o%r===0&&this._update(n)}return this._len+=i,this},ei.prototype.digest=function(t){var e=this._len%this._blockSize;this._block[e]=128,this._block.fill(0,e+1),e>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=this._len*8;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(n&4294967295)>>>0,i=(n-r)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var o=this._hash();return t?o.toString(t):o},ei.prototype._update=function(){throw new Error("_update must be implemented by subclass")};var Kt=ei,n_=Gt,pp=Kt,r_=bt.Buffer,i_=[1518500249,1859775393,-1894007588,-899497514],o_=new Array(80);function Bn(){this.init(),this._w=o_,pp.call(this,64,56)}n_(Bn,pp),Bn.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function s_(t){return t<<5|t>>>27}function a_(t){return t<<30|t>>>2}function c_(t,e,n,r){return t===0?e&n|~e&r:t===2?e&n|e&r|n&r:e^n^r}Bn.prototype._update=function(t){for(var e=this._w,n=this._a|0,r=this._b|0,i=this._c|0,o=this._d|0,s=this._e|0,a=0;a<16;++a)e[a]=t.readInt32BE(a*4);for(;a<80;++a)e[a]=e[a-3]^e[a-8]^e[a-14]^e[a-16];for(var c=0;c<80;++c){var l=~~(c/20),u=s_(n)+c_(l,r,i,o)+s+e[c]+i_[l]|0;s=o,o=i,i=a_(r),r=n,n=u}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=o+this._d|0,this._e=s+this._e|0},Bn.prototype._hash=function(){var t=r_.allocUnsafe(20);return t.writeInt32BE(this._a|0,0),t.writeInt32BE(this._b|0,4),t.writeInt32BE(this._c|0,8),t.writeInt32BE(this._d|0,12),t.writeInt32BE(this._e|0,16),t};var l_=Bn,u_=Gt,fp=Kt,d_=bt.Buffer,h_=[1518500249,1859775393,-1894007588,-899497514],p_=new Array(80);function Ln(){this.init(),this._w=p_,fp.call(this,64,56)}u_(Ln,fp),Ln.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function f_(t){return t<<1|t>>>31}function m_(t){return t<<5|t>>>27}function y_(t){return t<<30|t>>>2}function g_(t,e,n,r){return t===0?e&n|~e&r:t===2?e&n|e&r|n&r:e^n^r}Ln.prototype._update=function(t){for(var e=this._w,n=this._a|0,r=this._b|0,i=this._c|0,o=this._d|0,s=this._e|0,a=0;a<16;++a)e[a]=t.readInt32BE(a*4);for(;a<80;++a)e[a]=f_(e[a-3]^e[a-8]^e[a-14]^e[a-16]);for(var c=0;c<80;++c){var l=~~(c/20),u=m_(n)+g_(l,r,i,o)+s+e[c]+h_[l]|0;s=o,o=i,i=y_(r),r=n,n=u}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=o+this._d|0,this._e=s+this._e|0},Ln.prototype._hash=function(){var t=d_.allocUnsafe(20);return t.writeInt32BE(this._a|0,0),t.writeInt32BE(this._b|0,4),t.writeInt32BE(this._c|0,8),t.writeInt32BE(this._d|0,12),t.writeInt32BE(this._e|0,16),t};var x_=Ln,v_=Gt,mp=Kt,b_=bt.Buffer,w_=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],M_=new Array(64);function Dn(){this.init(),this._w=M_,mp.call(this,64,56)}v_(Dn,mp),Dn.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function E_(t,e,n){return n^t&(e^n)}function C_(t,e,n){return t&e|n&(t|e)}function __(t){return(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10)}function S_(t){return(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7)}function O_(t){return(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3}function N_(t){return(t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10}Dn.prototype._update=function(t){for(var e=this._w,n=this._a|0,r=this._b|0,i=this._c|0,o=this._d|0,s=this._e|0,a=this._f|0,c=this._g|0,l=this._h|0,u=0;u<16;++u)e[u]=t.readInt32BE(u*4);for(;u<64;++u)e[u]=N_(e[u-2])+e[u-7]+O_(e[u-15])+e[u-16]|0;for(var d=0;d<64;++d){var h=l+S_(s)+E_(s,a,c)+w_[d]+e[d]|0,p=__(n)+C_(n,r,i)|0;l=c,c=a,a=s,s=o+h|0,o=i,i=r,r=n,n=h+p|0}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=o+this._d|0,this._e=s+this._e|0,this._f=a+this._f|0,this._g=c+this._g|0,this._h=l+this._h|0},Dn.prototype._hash=function(){var t=b_.allocUnsafe(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t};var yp=Dn,A_=Gt,P_=yp,k_=Kt,T_=bt.Buffer,j_=new Array(64);function ti(){this.init(),this._w=j_,k_.call(this,64,56)}A_(ti,P_),ti.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},ti.prototype._hash=function(){var t=T_.allocUnsafe(28);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t};var R_=ti,I_=Gt,gp=Kt,$_=bt.Buffer,xp=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],B_=new Array(160);function Fn(){this.init(),this._w=B_,gp.call(this,128,112)}I_(Fn,gp),Fn.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function vp(t,e,n){return n^t&(e^n)}function bp(t,e,n){return t&e|n&(t|e)}function wp(t,e){return(t>>>28|e<<4)^(e>>>2|t<<30)^(e>>>7|t<<25)}function Mp(t,e){return(t>>>14|e<<18)^(t>>>18|e<<14)^(e>>>9|t<<23)}function L_(t,e){return(t>>>1|e<<31)^(t>>>8|e<<24)^t>>>7}function D_(t,e){return(t>>>1|e<<31)^(t>>>8|e<<24)^(t>>>7|e<<25)}function F_(t,e){return(t>>>19|e<<13)^(e>>>29|t<<3)^t>>>6}function z_(t,e){return(t>>>19|e<<13)^(e>>>29|t<<3)^(t>>>6|e<<26)}function Oe(t,e){return t>>>0<e>>>0?1:0}Fn.prototype._update=function(t){for(var e=this._w,n=this._ah|0,r=this._bh|0,i=this._ch|0,o=this._dh|0,s=this._eh|0,a=this._fh|0,c=this._gh|0,l=this._hh|0,u=this._al|0,d=this._bl|0,h=this._cl|0,p=this._dl|0,f=this._el|0,m=this._fl|0,y=this._gl|0,g=this._hl|0,b=0;b<32;b+=2)e[b]=t.readInt32BE(b*4),e[b+1]=t.readInt32BE(b*4+4);for(;b<160;b+=2){var x=e[b-30],v=e[b-15*2+1],C=L_(x,v),T=D_(v,x);x=e[b-2*2],v=e[b-2*2+1];var S=F_(x,v),j=z_(v,x),$=e[b-7*2],B=e[b-7*2+1],V=e[b-16*2],z=e[b-16*2+1],F=T+B|0,w=C+$+Oe(F,T)|0;F=F+j|0,w=w+S+Oe(F,j)|0,F=F+z|0,w=w+V+Oe(F,z)|0,e[b]=w,e[b+1]=F}for(var A=0;A<160;A+=2){w=e[A],F=e[A+1];var _=bp(n,r,i),R=bp(u,d,h),N=wp(n,u),P=wp(u,n),L=Mp(s,f),W=Mp(f,s),I=xp[A],J=xp[A+1],X=vp(s,a,c),q=vp(f,m,y),ee=g+W|0,ne=l+L+Oe(ee,g)|0;ee=ee+q|0,ne=ne+X+Oe(ee,q)|0,ee=ee+J|0,ne=ne+I+Oe(ee,J)|0,ee=ee+F|0,ne=ne+w+Oe(ee,F)|0;var H=P+R|0,ae=N+_+Oe(H,P)|0;l=c,g=y,c=a,y=m,a=s,m=f,f=p+ee|0,s=o+ne+Oe(f,p)|0,o=i,p=h,i=r,h=d,r=n,d=u,u=ee+H|0,n=ne+ae+Oe(u,ee)|0}this._al=this._al+u|0,this._bl=this._bl+d|0,this._cl=this._cl+h|0,this._dl=this._dl+p|0,this._el=this._el+f|0,this._fl=this._fl+m|0,this._gl=this._gl+y|0,this._hl=this._hl+g|0,this._ah=this._ah+n+Oe(this._al,u)|0,this._bh=this._bh+r+Oe(this._bl,d)|0,this._ch=this._ch+i+Oe(this._cl,h)|0,this._dh=this._dh+o+Oe(this._dl,p)|0,this._eh=this._eh+s+Oe(this._el,f)|0,this._fh=this._fh+a+Oe(this._fl,m)|0,this._gh=this._gh+c+Oe(this._gl,y)|0,this._hh=this._hh+l+Oe(this._hl,g)|0},Fn.prototype._hash=function(){var t=$_.allocUnsafe(64);function e(n,r,i){t.writeInt32BE(n,i),t.writeInt32BE(r,i+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),t};var Ep=Fn,V_=Gt,q_=Ep,W_=Kt,H_=bt.Buffer,U_=new Array(160);function ni(){this.init(),this._w=U_,W_.call(this,128,112)}V_(ni,q_),ni.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},ni.prototype._hash=function(){var t=H_.allocUnsafe(48);function e(n,r,i){t.writeInt32BE(n,i),t.writeInt32BE(r,i+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),t};var Q_=ni,wt=dp.exports=function(t){t=t.toLowerCase();var e=wt[t];if(!e)throw new Error(t+" is not supported (we accept pull requests)");return new e};wt.sha=l_,wt.sha1=x_,wt.sha224=R_,wt.sha256=yp,wt.sha384=Q_,wt.sha512=Ep;var Z_=dp.exports;const Y_=Ze(Z_);function X_(t,e={}){const{segmentLength:n=4,separator:r="__",termLength:i=2}=e;return t.split(r).reduce((o,s)=>{const a=s.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),c=a.length>1?i:n,l=a.map(u=>u.substr(0,c)).join("");return o.push(l),o},[]).join(r)}function G_(t,e={}){const n=Y_("sha1");n.update(t,"utf8");const r=n.digest("hex");return e.length?r.slice(0,e.length):r}class K_{static isGreaterOrEqual(e,n){const r=Cp(e),i=Cp(n);return r[0]>i[0]||r[0]===i[0]&&r[1]>i[1]||r[0]===i[0]&&r[1]===i[1]&&r[2]>=i[2]}}function Cp(t=""){const e=[0,0,0];return t.split(".").forEach((n,r)=>e[r]=parseInt(n,10)),e}class Q{static isSQLiteFamily(e){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(e.options.type)}static isMySQLFamily(e){return["mysql","mariadb"].includes(e.options.type)}static isReleaseVersionOrGreater(e,n){return e.version!=null&&K_.isGreaterOrEqual(e.version,n)}static isPostgresFamily(e){return["postgres","aurora-postgres","cockroachdb"].includes(e.options.type)}static buildDriverOptions(e,n){if(e.url){const r=this.parseConnectionUrl(e.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const i of Object.keys(r))typeof r[i]>"u"&&delete r[i];return Object.assign({},e,r)}return Object.assign({},e)}static buildMongoDBDriverOptions(e,n){if(e.url){const r=this.parseMongoDBConnectionUrl(e.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const i of Object.keys(r))typeof r[i]>"u"&&delete r[i];return Object.assign({},e,r)}return Object.assign({},e)}static buildAlias({maxAliasLength:e},n,...r){const i=n&&n.joiner?n.joiner:"_";let o=r.length===1?r[0]:r.join(i);if(e&&e>0&&o.length>e){if(n&&n.shorten===!0){const s=X_(o);if(s.length<e)return s}return G_(o,{length:e})}return o}static buildColumnAlias({maxAliasLength:e},n,...r){return typeof n=="string"?(r.unshift(n),n={shorten:!1,joiner:"_"}):n=Object.assign({shorten:!1,joiner:"_"},n),this.buildAlias({maxAliasLength:e},n,...r)}static parseConnectionUrl(e){const n=e.split(":")[0],r=e.indexOf("//"),i=e.substr(r+2),o=i.indexOf("/"),s=o!==-1?i.substr(0,o):i;let a=o!==-1?i.substr(o+1):void 0;a&&a.indexOf("?")!==-1&&(a=a.substr(0,a.indexOf("?")));const c=s.lastIndexOf("@"),l=s.substr(0,c),u=s.substr(c+1);let d=l,h="";const p=l.indexOf(":");p!==-1&&(d=l.substr(0,p),h=l.substr(p+1));const[f,m]=u.split(":");return{type:n,host:f,username:decodeURIComponent(d),password:decodeURIComponent(h),port:m?parseInt(m):void 0,database:a||void 0}}static parseMongoDBConnectionUrl(e){const n=e.split(":")[0],r=e.indexOf("//"),i=e.substr(r+2),o=i.indexOf("/"),s=o!==-1?i.substr(0,o):i;let a=o!==-1?i.substr(o+1):void 0,c="",l,u,d,h,p={};if(a&&a.indexOf("?")!==-1){c=a.substr(a.indexOf("?")+1,a.length);const C=c.split("&");let T,S;C.forEach(j=>{T=j.split("=")[0],S=j.split("=")[1],p[T]=S}),h=p.replicaSet,a=a.substr(0,a.indexOf("?"))}const f=s.lastIndexOf("@"),m=s.substr(0,f),y=s.substr(f+1);let g=m,b="";const x=m.indexOf(":");x!==-1&&(g=m.substr(0,x),b=m.substr(x+1)),h?d=y:[l,u]=y.split(":");let v={type:n,host:l,hostReplicaSet:d,username:decodeURIComponent(g),password:decodeURIComponent(b),port:u?parseInt(u):void 0,database:a||void 0};for(const[C,T]of Object.entries(p))v[C]=T;return v}}class _p{constructor(e,n,r){this.connection=e,this.queryExpressionMap=n,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,r&&Ee.assign(this,r)}get isMany(){return this.isMappingMany!==void 0?this.isMappingMany:this.relation?this.relation.isManyToMany||this.relation.isOneToMany:!1}get isSelected(){if(!this.isSelectedEvaluated){let e=()=>{for(const n of this.queryExpressionMap.selects)if(n.selection===this.alias.name||this.metadata&&this.metadata.columns.find(r=>n.selection===this.alias.name+"."+r.propertyPath))return!0;return!1};this.isSelectedCache=e(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(Qe.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(Qe.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let e=()=>{if(!Qe.isAliasProperty(this.entityOrProperty))return;const n=this.queryExpressionMap.findAliasByName(this.parentAlias);let r=n.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(r||n.metadata.parentEntityMetadata&&(r=n.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),r))return r;throw new Y(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=e.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){if(this.relation)return this.relation.inverseEntityMetadata;if(this.connection.hasMetadata(this.entityOrProperty))return this.connection.getMetadata(this.entityOrProperty);if(this.mapAsEntity&&this.connection.hasMetadata(this.mapAsEntity))return this.connection.getMetadata(this.mapAsEntity)}get junctionAlias(){if(!this.relation)throw new Y("Cannot get junction table for join without relation.");if(typeof this.entityOrProperty!="string")throw new Y("Junction property is not defined.");const e=this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."));return this.relation.isOwning?Q.buildAlias(this.connection.driver,void 0,e,this.alias.name):Q.buildAlias(this.connection.driver,void 0,this.alias.name,e)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}class ts{constructor(e,n){this.queryExpressionMap=e,this.disableMixedMap=!1,Ee.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!Qe.isAliasProperty(this.relationName))throw new Y("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!Qe.isAliasProperty(this.relationName))throw new Y("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!Qe.isAliasProperty(this.relationName))throw new Y("Given value must be a string representation of alias property");const e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Y(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return e}get junctionAlias(){const[e,n]=this.relationName.split(".");return e+"_"+n+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}class ns{constructor(e,n){this.expressionMap=e,Ee.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!Qe.isAliasProperty(this.relationName))throw new Y("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!Qe.isAliasProperty(this.relationName))throw new Y("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[e,n]=this.relationName.split(".");return e+"_"+n+"_rc"}get relation(){if(!Qe.isAliasProperty(this.relationName))throw new Y("Given value is a string representation of alias property");const[e,n]=this.relationName.split("."),r=this.expressionMap.findAliasByName(e).metadata.findRelationWithPropertyPath(n);if(!r)throw new Y(`Relation with property path ${n} in entity was not found.`);return r}get metadata(){if(!Qe.isAliasProperty(this.relationName))throw new Y("Given value is a string representation of alias property");const e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}class rs{constructor(e){var n;this.connection=e,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],e.options.relationLoadStrategy&&(this.relationLoadStrategy=e.options.relationLoadStrategy),this.timeTravel=((n=e.options)==null?void 0:n.timeTravelQueries)||!1}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&this.options.indexOf("disable-global-order")===-1){const e=this.mainAlias.metadata.orderBy||{};return Object.keys(e).reduce((n,r)=>(n[this.mainAlias.name+"."+r]=e[r],n),{})}return this.orderBys}setMainAlias(e){return this.mainAlias=e,e}createAlias(e){let n=e.name;!n&&e.tablePath&&(n=e.tablePath),!n&&typeof e.target=="function"&&(n=e.target.name),!n&&typeof e.target=="string"&&(n=e.target);const r=new up;return r.type=e.type,n&&(r.name=n),e.metadata&&(r.metadata=e.metadata),e.target&&!r.hasMetadata&&(r.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(r.tablePath=e.tablePath),e.subQuery&&(r.subQuery=e.subQuery),this.aliases.push(r),r}findAliasByName(e){const n=this.aliases.find(r=>r.name===e);if(!n)throw new Y(`"${e}" alias was not found. Maybe you forgot to join it?`);return n}findColumnByAliasExpression(e){const[n,r]=e.split(".");return this.findAliasByName(n).metadata.findColumnWithPropertyName(r)}get relationMetadata(){if(!this.mainAlias)throw new Y("Entity to work with is not specified!");const e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Y(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return e}clone(){const e=new rs(this.connection);return e.queryType=this.queryType,e.selects=this.selects.map(n=>n),e.maxExecutionTime=this.maxExecutionTime,e.selectDistinct=this.selectDistinct,e.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(n=>e.aliases.push(new up(n))),e.relationLoadStrategy=this.relationLoadStrategy,e.mainAlias=this.mainAlias,e.valuesSet=this.valuesSet,e.returning=this.returning,e.onConflict=this.onConflict,e.onIgnore=this.onIgnore,e.onUpdate=this.onUpdate,e.joinAttributes=this.joinAttributes.map(n=>new _p(this.connection,this,n)),e.relationIdAttributes=this.relationIdAttributes.map(n=>new ts(this,n)),e.relationCountAttributes=this.relationCountAttributes.map(n=>new ns(this,n)),e.wheres=this.wheres.map(n=>({...n})),e.havings=this.havings.map(n=>({...n})),e.orderBys=Object.assign({},this.orderBys),e.groupBys=this.groupBys.map(n=>n),e.limit=this.limit,e.offset=this.offset,e.skip=this.skip,e.take=this.take,e.lockMode=this.lockMode,e.onLocked=this.onLocked,e.lockVersion=this.lockVersion,e.lockTables=this.lockTables,e.withDeleted=this.withDeleted,e.parameters=Object.assign({},this.parameters),e.disableEscaping=this.disableEscaping,e.enableRelationIdValues=this.enableRelationIdValues,e.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,e.subQuery=this.subQuery,e.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,e.cache=this.cache,e.cacheId=this.cacheId,e.cacheDuration=this.cacheDuration,e.relationPropertyPath=this.relationPropertyPath,e.of=this.of,e.insertColumns=this.insertColumns,e.whereEntities=this.whereEntities,e.updateEntity=this.updateEntity,e.callListeners=this.callListeners,e.useTransaction=this.useTransaction,e.timeTravel=this.timeTravel,e.nativeParameters=Object.assign({},this.nativeParameters),e.comment=this.comment,e.commonTableExpressions=this.commonTableExpressions.map(n=>({alias:n.alias,queryBuilder:typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.clone(),options:n.options})),e}}class Sp{constructor(e){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=e}}class is{static transformFrom(e,n){return Array.isArray(e)?e.slice().reverse().reduce((r,i)=>i.from(r),n):e.from(n)}static transformTo(e,n){return Array.isArray(e)?e.reduce((r,i)=>i.to(r),n):e.to(n)}}class zn{constructor(e,n,r=!0,i=!1,o,s){this["@instanceof"]=Symbol.for("FindOperator"),this._type=e,this._value=n,this._useParameter=r,this._multipleParameters=i,this._getSql=o,this._objectLiteralParameters=s}get useParameter(){return fe.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return fe.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return fe.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return fe.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(fe.isFindOperator(this._value))return this._value}get getSql(){return fe.isFindOperator(this._value)?this._value.getSql:this._getSql}transformValue(e){this._value instanceof zn?this._value.transformValue(e):this._value=Array.isArray(this._value)&&this._multipleParameters?this._value.map(n=>e&&is.transformTo(e,n)):is.transformTo(e,this._value)}}li=function(t){return new zn("in",t,!0,!0)};const J_=/[.*+\-?^${}()|[\]\\]/g,eS=t=>t.replace(J_,"\\$&");class ve{constructor(e,n){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,fe.isDataSource(e)?(this.connection=e,this.queryRunner=n,this.expressionMap=new rs(this.connection)):(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone())}static registerQueryBuilderClass(e,n){ve.queryBuilderRegistry[e]=n}get alias(){if(!this.expressionMap.mainAlias)throw new Y("Main alias is not set");return this.expressionMap.mainAlias.name}select(e,n){return this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map(r=>({selection:r})):e&&(this.expressionMap.selects=[{selection:e,aliasName:n}]),fe.isSelectQueryBuilder(this)?this:ve.queryBuilderRegistry.SelectQueryBuilder(this)}insert(){return this.expressionMap.queryType="insert",fe.isInsertQueryBuilder(this)?this:ve.queryBuilderRegistry.InsertQueryBuilder(this)}update(e,n){const r=n||e;if(e=fe.isEntitySchema(e)?e.options.name:e,typeof e=="function"||typeof e=="string"){const i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}return this.expressionMap.queryType="update",this.expressionMap.valuesSet=r,fe.isUpdateQueryBuilder(this)?this:ve.queryBuilderRegistry.UpdateQueryBuilder(this)}delete(){return this.expressionMap.queryType="delete",fe.isDeleteQueryBuilder(this)?this:ve.queryBuilderRegistry.DeleteQueryBuilder(this)}softDelete(){return this.expressionMap.queryType="soft-delete",fe.isSoftDeleteQueryBuilder(this)?this:ve.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}restore(){return this.expressionMap.queryType="restore",fe.isSoftDeleteQueryBuilder(this)?this:ve.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}relation(e,n){const r=arguments.length===2?e:void 0,i=arguments.length===2?n:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){const o=this.createFromAlias(r);this.expressionMap.setMainAlias(o)}return fe.isRelationQueryBuilder(this)?this:ve.queryBuilderRegistry.RelationQueryBuilder(this)}hasRelation(e,n){const r=this.connection.getMetadata(e);return(Array.isArray(n)?n:[n]).every(i=>!!r.findRelationWithPropertyPath(i))}hasParameter(e){var n;return((n=this.parentQueryBuilder)==null?void 0:n.hasParameter(e))||e in this.expressionMap.parameters}setParameter(e,n){if(typeof n=="function")throw new Y(`Function parameter isn't supported in the parameters. Please check "${e}" parameter.`);if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new Y("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,n),this.expressionMap.parameters[e]=n,this}setParameters(e){for(const[n,r]of Object.entries(e))this.setParameter(n,r);return this}createParameter(e){let n;do n=`orm_param_${this.parameterIndex++}`;while(this.hasParameter(n));return this.setParameter(n,e),`:${n}`}setNativeParameters(e){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(n=>{this.expressionMap.nativeParameters[n]=e[n]}),this}getParameters(){const e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const n=this.expressionMap.mainAlias.metadata;if(n.discriminatorColumn&&n.parentEntityMetadata){const r=n.childEntityMetadatas.filter(i=>i.discriminatorColumn).map(i=>i.discriminatorValue);r.push(n.discriminatorValue),e.discriminatorColumnValues=r}}return e}printSql(){const[e,n]=this.getQueryAndParameters();return this.connection.logger.logQuery(e,n),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const e=this.getQuery(),n=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,n,this.expressionMap.nativeParameters)}async execute(){const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();try{return await r.query(e,n)}finally{r!==this.queryRunner&&await r.release()}}createQueryBuilder(e){return new this.constructor(this.connection,e??this.queryRunner)}clone(){return new this.constructor(this)}comment(e){return this.expressionMap.comment=e,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e}setQueryRunner(e){return this.queryRunner=e,this}callListeners(e){return this.expressionMap.callListeners=e,this}useTransaction(e){return this.expressionMap.useTransaction=e,this}addCommonTableExpression(e,n,r){return this.expressionMap.commonTableExpressions.push({queryBuilder:e,alias:n,options:r||{}}),this}getTableName(e){return e.split(".").map(n=>n===""?n:this.escape(n)).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new Y('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(e,n){if(this.connection.hasMetadata(e)){const r=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:n,metadata:this.connection.getMetadata(e),tablePath:r.tablePath})}else{if(typeof e=="string"){const o=e.substr(0,1)==="("&&e.substr(-1)===")";return this.expressionMap.createAlias({type:"from",name:n,tablePath:o?void 0:e,subQuery:o?e:void 0})}const r=e(this.subQuery());this.setParameters(r.getParameters());const i=r.getQuery();return this.expressionMap.createAlias({type:"from",name:n,subQuery:i})}}replacePropertyNames(e){return e}replacePropertyNamesForTheWholeQuery(e){const n={};for(const o of this.expressionMap.aliases){if(!o.hasMetadata)continue;const s=this.expressionMap.aliasNamePrefixingEnabled&&o.name?`${o.name}.`:"";n[s]||(n[s]={});for(const a of o.metadata.relations)a.joinColumns.length>0&&(n[s][a.propertyPath]=a.joinColumns[0].databaseName);for(const a of o.metadata.relations){const c=[...a.joinColumns,...a.inverseJoinColumns];for(const l of c){const u=`${a.propertyPath}.${l.referencedColumn.propertyPath}`;n[s][u]=l.databaseName}}for(const a of o.metadata.columns)n[s][a.databaseName]=a.databaseName;for(const a of o.metadata.columns)n[s][a.propertyName]=a.databaseName;for(const a of o.metadata.columns)n[s][a.propertyPath]=a.databaseName}const r=Object.keys(n),i=r.map(o=>eS(o)).join("|");return r.length>0&&(e=e.replace(new RegExp(`([ =(]|^.{0})${i?"("+i+")":""}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),(...o)=>{let s,a,c;if(i){if(s=o[0],a=o[1],c=o[3],n[o[2]][c])return`${a}${this.escape(o[2].substring(0,o[2].length-1))}.${this.escape(n[o[2]][c])}`}else if(s=o[0],a=o[1],c=o[2],n[""][c])return`${a}${this.escape(n[""][c])}`;return s})),e}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace(/\*\//g,"")} */ `:""}createTimeTravelQuery(){return this.expressionMap.queryType==="select"&&this.expressionMap.timeTravel?` AS OF SYSTEM TIME ${this.expressionMap.timeTravel}`:""}createWhereExpression(){const e=[],n=this.createWhereClausesExpression(this.expressionMap.wheres);if(n.length>0&&n!=="1=1"&&e.push(this.replacePropertyNames(n)),this.expressionMap.mainAlias.hasMetadata){const i=this.expressionMap.mainAlias.metadata;if(this.expressionMap.queryType==="select"&&!this.expressionMap.withDeleted&&i.deleteDateColumn){const o=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+i.deleteDateColumn.propertyName:i.deleteDateColumn.propertyName,s=`${this.replacePropertyNames(o)} IS NULL`;e.push(s)}if(i.discriminatorColumn&&i.parentEntityMetadata){const o=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+i.discriminatorColumn.databaseName:i.discriminatorColumn.databaseName,s=`${this.replacePropertyNames(o)} IN (:...discriminatorColumnValues)`;e.push(s)}}if(this.expressionMap.extraAppendedAndWhereCondition){const i=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(i)}let r="";return r+=this.createTimeTravelQuery(),e.length?e.length===1?r+=` WHERE ${e[0]}`:r+=` WHERE ( ${e.join(" ) AND ( ")} )`:r+="",r}createReturningExpression(e){const n=this.getReturningColumns(),r=this.connection.driver;if(typeof this.expressionMap.returning!="string"&&this.expressionMap.extraReturningColumns.length>0&&r.isReturningSqlSupported(e)&&n.push(...this.expressionMap.extraReturningColumns.filter(i=>n.indexOf(i)===-1)),n.length){let i=n.map(o=>{const s=this.escape(o.databaseName);return r.options.type==="mssql"?this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update"||this.expressionMap.queryType==="soft-delete"||this.expressionMap.queryType==="restore"?"INSERTED."+s:this.escape(this.getMainTableName())+"."+s:s}).join(", ");return r.options.type==="oracle"&&(i+=" INTO "+n.map(o=>this.createParameter({type:r.columnTypeToNativeParameter(o.type),dir:r.oracle.BIND_OUT})).join(", ")),r.options.type==="mssql"&&(this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update")&&(i+=" INTO @OutputTable"),i}else if(typeof this.expressionMap.returning=="string")return this.expressionMap.returning;return""}getReturningColumns(){const e=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(n=>{this.expressionMap.mainAlias.hasMetadata&&e.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n))}),e}createWhereClausesExpression(e){return e.map((n,r)=>{const i=this.createWhereConditionExpression(n.condition);switch(n.type){case"and":return(r>0?"AND ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${i}${this.connection.options.isolateWhereStatements?")":""}`;case"or":return(r>0?"OR ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${i}${this.connection.options.isolateWhereStatements?")":""}`}return i}).join(" ").trim()}createWhereConditionExpression(e,n=!1){if(typeof e=="string")return e;if(Array.isArray(e))return e.length===0?"1=1":e.length===1&&!n?this.createWhereClausesExpression(e):"("+this.createWhereClausesExpression(e)+")";const{driver:r}=this.connection;switch(e.operator){case"lessThan":return`${e.parameters[0]} < ${e.parameters[1]}`;case"lessThanOrEqual":return`${e.parameters[0]} <= ${e.parameters[1]}`;case"arrayContains":return`${e.parameters[0]} @> ${e.parameters[1]}`;case"jsonContains":return`${e.parameters[0]} ::jsonb @> ${e.parameters[1]}`;case"arrayContainedBy":return`${e.parameters[0]} <@ ${e.parameters[1]}`;case"arrayOverlap":return`${e.parameters[0]} && ${e.parameters[1]}`;case"moreThan":return`${e.parameters[0]} > ${e.parameters[1]}`;case"moreThanOrEqual":return`${e.parameters[0]} >= ${e.parameters[1]}`;case"notEqual":return`${e.parameters[0]} != ${e.parameters[1]}`;case"equal":return`${e.parameters[0]} = ${e.parameters[1]}`;case"ilike":return r.options.type==="postgres"||r.options.type==="cockroachdb"?`${e.parameters[0]} ILIKE ${e.parameters[1]}`:`UPPER(${e.parameters[0]}) LIKE UPPER(${e.parameters[1]})`;case"like":return`${e.parameters[0]} LIKE ${e.parameters[1]}`;case"between":return`${e.parameters[0]} BETWEEN ${e.parameters[1]} AND ${e.parameters[2]}`;case"in":return e.parameters.length<=1?"0=1":`${e.parameters[0]} IN (${e.parameters.slice(1).join(", ")})`;case"any":return r.options.type==="cockroachdb"?`${e.parameters[0]}::STRING = ANY(${e.parameters[1]}::STRING[])`:`${e.parameters[0]} = ANY(${e.parameters[1]})`;case"isNull":return`${e.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(e.condition)})`;case"brackets":return`${this.createWhereConditionExpression(e.condition,!0)}`;case"and":return"("+e.parameters.join(" AND ")+")";case"or":return"("+e.parameters.join(" OR ")+")"}throw new TypeError(`Unsupported FindOperator ${zn.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const e=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map(n=>{const r=typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.getQuery();if(typeof n.queryBuilder!="string"){if(n.queryBuilder.hasCommonTableExpressions())throw new Y(`Nested CTEs aren't supported (CTE: ${n.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!fe.isSelectQueryBuilder(n.queryBuilder))throw new Y(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${n.alias})`);this.setParameters(n.queryBuilder.getParameters())}let i=this.escape(n.alias);if(n.options.columnNames){const a=n.options.columnNames.map(c=>this.escape(c));if(fe.isSelectQueryBuilder(n.queryBuilder)&&n.queryBuilder.expressionMap.selects.length&&n.options.columnNames.length!==n.queryBuilder.expressionMap.selects.length)throw new Y(`cte.options.columnNames length (${n.options.columnNames.length}) doesn't match subquery select list length ${n.queryBuilder.expressionMap.selects.length} (CTE: ${n.alias})`);i+=`(${a.join(", ")})`}const o=n.options.recursive&&e?"RECURSIVE":"";let s="";return this.connection.driver.cteCapabilities.materializedHint&&n.options.materialized!==void 0&&(s=n.options.materialized?"MATERIALIZED":"NOT MATERIALIZED"),[o,i,"AS",s,`(${r})`].filter(Boolean).join(" ")}).join(", ")+" "}getWhereInIdsCondition(e){const n=this.expressionMap.mainAlias.metadata,r=(Array.isArray(e)?e:[e]).map(i=>n.ensureEntityIdMap(i));if(!n.hasMultiplePrimaryKeys){const i=n.primaryColumns[0];if(!i.transformer&&!i.relationMetadata&&!i.embeddedMetadata)return{[i.propertyName]:li(r.map(o=>i.getEntityValue(o,!1)))}}return new Sp(i=>{for(const o of r)i.orWhere(new Sp(s=>s.where(o)))})}getExistsCondition(e){const n=e.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select("1").setOption("disable-global-order");return[`EXISTS (${n.getQuery()})`,n.getParameters()]}findColumnsForPropertyPath(e){let n=this.expressionMap.mainAlias;const r=[],i=e.split(".");for(;i.length>1;){const a=i[0];if(!(n!=null&&n.hasMetadata))break;if(n.metadata.hasEmbeddedWithPropertyPath(a)){i.unshift(`${i.shift()}.${i.shift()}`);continue}if(n.metadata.hasRelationWithPropertyPath(a)){const c=this.expressionMap.joinAttributes.find(l=>l.relationPropertyPath===a);if(!(c!=null&&c.alias)){const l=r.length>0?`${r.join(".")}.${a}`:a;throw new Error(`Cannot find alias for relation at ${l}`)}n=c.alias,r.push(...a.split(".")),i.shift();continue}break}if(!n)throw new Error(`Cannot find alias for property ${e}`);const o=i.join("."),s=n.metadata.findColumnsWithPropertyPath(o);if(!s.length)throw new Ue(e,n.metadata);return[n,r,s]}createPropertyPath(e,n,r=""){const i=[];for(const o of Object.keys(n)){const s=r?`${r}.${o}`:o;if(n[o]===null||typeof n[o]!="object"||fe.isFindOperator(n[o])){i.push(s);continue}if(e.hasEmbeddedWithPropertyPath(s)){const a=this.createPropertyPath(e,n[o],s);i.push(...a);continue}if(e.hasRelationWithPropertyPath(s)){const a=e.findRelationWithPropertyPath(s);if(a.relationType==="one-to-one"||a.relationType==="many-to-one"){const u=a.joinColumns.map(d=>d.referencedColumn).filter(d=>!!d);if(u.length>0&&u.every(d=>d.getEntityValue(n[o],!1))){i.push(s);continue}}if(a.relationType==="one-to-many"||a.relationType==="many-to-many")throw new Error(`Cannot query across ${a.relationType} for property ${s}`);const c=a.inverseEntityMetadata.primaryColumns;if(c.length>0&&c.every(u=>u.getEntityValue(n[o],!1))){const u=c.map(d=>`${s}.${d.propertyPath}`);i.push(...u);continue}const l=this.createPropertyPath(a.inverseEntityMetadata,n[o]).map(u=>`${s}.${u}`);i.push(...l);continue}i.push(s)}return i}*getPredicates(e){if(this.expressionMap.mainAlias.hasMetadata){const n=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e);for(const r of n){const[i,o,s]=this.findColumnsForPropertyPath(r);for(const a of s){let c=e;for(const d of o){if(!c||!(d in c)){c={};break}c=c[d]}const l=this.expressionMap.aliasNamePrefixingEnabled?`${i.name}.${a.propertyPath}`:a.propertyPath,u=a.getEntityValue(c,!0);yield[l,u]}}}else for(const n of Object.keys(e)){const r=e[n];yield[this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${n}`:n,r]}}getWherePredicateCondition(e,n){if(fe.isFindOperator(n)){let r=[];if(n.useParameter)if(n.objectLiteralParameters)this.setParameters(n.objectLiteralParameters);else if(n.multipleParameters)for(const i of n.value)r.push(this.createParameter(i));else r.push(this.createParameter(n.value));if(n.type==="raw")return n.getSql?n.getSql(e):{operator:"equal",parameters:[e,n.value]};if(n.type==="not")return n.child?{operator:n.type,condition:this.getWherePredicateCondition(e,n.child)}:{operator:"notEqual",parameters:[e,...r]};if(n.type==="and"){const i=n.value;return{operator:n.type,parameters:i.map(o=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,o)))}}else if(n.type==="or"){const i=n.value;return{operator:n.type,parameters:i.map(o=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,o)))}}else return{operator:n.type,parameters:[e,...r]}}else return{operator:"equal",parameters:[e,this.createParameter(n)]}}getWhereCondition(e){if(typeof e=="string")return e;if(fe.isBrackets(e)){const i=this.createQueryBuilder();return i.parentQueryBuilder=this,i.expressionMap.mainAlias=this.expressionMap.mainAlias,i.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,i.expressionMap.parameters=this.expressionMap.parameters,i.expressionMap.nativeParameters=this.expressionMap.nativeParameters,i.expressionMap.wheres=[],e.whereFactory(i),{operator:fe.isNotBrackets(e)?"not":"brackets",condition:i.expressionMap.wheres}}if(typeof e=="function")return e(this);const n=Array.isArray(e)?e:[e],r=[];for(const i of n){const o=[];for(const[s,a]of this.getPredicates(i))o.push({type:"and",condition:this.getWherePredicateCondition(s,a)});r.push({type:"or",condition:o})}return r.length===1?r[0].condition:r}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}ve.queryBuilderRegistry={};class tS{static from(e){const n=new this;return n.raw=e.records,n.affected=e.affected,n}}class nS extends ve{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createDeleteExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let i=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),i=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const o=await r.query(e,n,!0),s=tS.from(o);return this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),i&&await r.commitTransaction(),s}catch(o){if(i)try{await r.rollbackTransaction()}catch{}throw o}finally{r!==this.queryRunner&&await r.release()}}from(e,n){e=fe.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new Jr;return this.expressionMap.returning=e,this}createDeleteExpression(){const e=this.getTableName(this.getMainTableName()),n=this.createWhereExpression(),r=this.createReturningExpression("delete");return r===""?`DELETE FROM ${e}${n}`:this.connection.driver.options.type==="mssql"?`DELETE FROM ${e} OUTPUT ${r}${n}`:`DELETE FROM ${e}${n} RETURNING ${r}`}}let ri;const rS=new Uint8Array(16);function iS(){if(!ri&&(ri=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ri))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ri(rS)}const Ae=[];for(let t=0;t<256;++t)Ae.push((t+256).toString(16).slice(1));function oS(t,e=0){return Ae[t[e+0]]+Ae[t[e+1]]+Ae[t[e+2]]+Ae[t[e+3]]+"-"+Ae[t[e+4]]+Ae[t[e+5]]+"-"+Ae[t[e+6]]+Ae[t[e+7]]+"-"+Ae[t[e+8]]+Ae[t[e+9]]+"-"+Ae[t[e+10]]+Ae[t[e+11]]+Ae[t[e+12]]+Ae[t[e+13]]+Ae[t[e+14]]+Ae[t[e+15]]}const sS=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Op={randomUUID:sS};function aS(t,e,n){if(Op.randomUUID&&!e&&!t)return Op.randomUUID();t=t||{};const r=t.random||(t.rng||iS)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,oS(r)}class Np{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}class Ap{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(e){const n=new this;return n.raw=e.raw,n}}class os{constructor(e,n){this.queryRunner=e,this.expressionMap=n}async update(e,n){const r=this.expressionMap.mainAlias.metadata;await Promise.all(n.map(async(i,o)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((c,l,u)=>(c[this.expressionMap.extraReturningColumns[u].databaseName]=l[0],c),{}));const s=Array.isArray(e.raw)?e.raw[o]:e.raw,a=this.queryRunner.connection.driver.createGeneratedMap(r,s);a&&(this.queryRunner.manager.merge(r.target,i,a),e.generatedMaps.push(a))}else{const s=this.expressionMap.extraReturningColumns;if(s.length>0){const a=this.expressionMap.mainAlias.metadata.getEntityIdMap(i);if(!a)throw new Y("Cannot update entity because entity id is not set in the entity.");const c=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(l=>r.targetName+"."+l.propertyPath)).addSelect(s.map(l=>r.targetName+"."+l.propertyPath)).from(r.target,r.targetName).where(a).withDeleted().setOption("create-pojo").getOne();c&&(this.queryRunner.manager.merge(r.target,i,c),e.generatedMaps.push(c))}}}))}async insert(e,n){const r=this.expressionMap.mainAlias.metadata;let i=r.getInsertionReturningColumns();const o=this.queryRunner.connection.driver.isReturningSqlSupported("insert");i=i.filter(a=>a.isGenerated?o===!0:!0);const s=n.map((a,c)=>{this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((d,h,p)=>(d[this.expressionMap.extraReturningColumns[p].databaseName]=h[0],d),{}));const l=Array.isArray(e.raw)?e.raw[c]:e.raw,u=this.queryRunner.connection.driver.createGeneratedMap(r,l,c,n.length)||{};return c in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(r.target,u,this.expressionMap.locallyGenerated[c]),this.queryRunner.manager.merge(r.target,a,u),u});if(i.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const a=n.map(l=>{const u=r.getEntityIdMap(l);if(!u)throw new Y("Cannot update entity because entity id is not set in the entity.");return u}),c=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(l=>r.targetName+"."+l.propertyPath)).addSelect(i.map(l=>r.targetName+"."+l.propertyPath)).from(r.target,r.targetName).where(a).setOption("create-pojo").getMany();n.forEach((l,u)=>{this.queryRunner.manager.merge(r.target,s[u],c[u]),this.queryRunner.manager.merge(r.target,l,c[u])})}n.forEach((a,c)=>{const l=r.getEntityIdMap(a);e.identifiers.push(l),e.generatedMaps.push(s[c])})}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion)}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion||e.isDeleteDate)}}class cS extends ve{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createInsertExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.getValueSets();if(e.length===0)return new Ap;const n=this.obtainQueryRunner();let r=!1;try{if(this.expressionMap.useTransaction===!0&&n.isTransactionActive===!1&&(await n.startTransaction(),r=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const p=new Np;e.forEach(f=>{n.broadcaster.broadcastBeforeInsertEvent(p,this.expressionMap.mainAlias.metadata,f)}),await p.wait()}let i=null,o=null;const s=new os(n,this.expressionMap),a=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const p of this.expressionMap.returning)a.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(p));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver.options.type==="oracle"||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),a.push(...this.expressionMap.extraReturningColumns.filter(p=>!a.includes(p)))),a.length>0&&this.connection.driver.options.type==="mssql"&&(i=this.connection.driver.buildTableVariableDeclaration("@OutputTable",a),o="SELECT * FROM @OutputTable");const[c,l]=this.getQueryAndParameters(),u=[i,c,o].filter(p=>p!=null).join(`;

`),d=await n.query(u,l,!0),h=Ap.from(d);if(this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&await s.insert(h,e),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const p=new Np;e.forEach(f=>{n.broadcaster.broadcastAfterInsertEvent(p,this.expressionMap.mainAlias.metadata,f)}),await p.wait()}return r&&await n.commitTransaction(),h}catch(i){if(r)try{await n.rollbackTransaction()}catch{}throw i}finally{n!==this.queryRunner&&await n.release()}}into(e,n){e=fe.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e);return this.expressionMap.setMainAlias(r),this.expressionMap.insertColumns=n||[],this}values(e){return this.expressionMap.valuesSet=e,this}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new Jr;return this.expressionMap.returning=e,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}onConflict(e){return this.expressionMap.onConflict=e,this}orIgnore(e=!0){return this.expressionMap.onIgnore=!!e,this}orUpdate(e,n,r){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:n,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,indexPredicate:r==null?void 0:r.indexPredicate,upsertType:r==null?void 0:r.upsertType},this):(this.expressionMap.onUpdate={conflict:e==null?void 0:e.conflict_target,columns:e==null?void 0:e.columns,overwrite:e==null?void 0:e.overwrite,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,upsertType:r==null?void 0:r.upsertType},this)}createInsertExpression(){var s,a;const e=this.getTableName(this.getMainTableName()),n=this.createValuesExpression(),r=this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),i=this.createColumnNamesExpression();let o="INSERT ";if(((s=this.expressionMap.onUpdate)==null?void 0:s.upsertType)==="primary-key"&&(o="UPSERT "),(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(o+=`${this.expressionMap.onIgnore?" IGNORE ":""}`),o+=`INTO ${e}`,this.alias!==this.getMainTableName()&&Q.isPostgresFamily(this.connection.driver)&&(o+=` AS "${this.alias}"`),i?o+=`(${i})`:!n&&(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(o+="()"),r&&this.connection.driver.options.type==="mssql"&&(o+=` OUTPUT ${r}`),n?(this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="sap")&&this.getValueSets().length>1?o+=` ${n}`:o+=` VALUES ${n}`:Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"?o+=" VALUES ()":o+=" DEFAULT VALUES",((a=this.expressionMap.onUpdate)==null?void 0:a.upsertType)!=="primary-key"){if(this.connection.driver.supportedUpsertTypes.includes("on-conflict-do-update")){if(this.expressionMap.onIgnore)o+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)o+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:c,columns:l,conflict:u,skipUpdateIfNoValuesChanged:d,indexPredicate:h}=this.expressionMap.onUpdate;let p="ON CONFLICT";if(Array.isArray(u)){if(p+=` ( ${u.map(m=>this.escape(m)).join(", ")} )`,h&&!Q.isPostgresFamily(this.connection.driver))throw new Y("indexPredicate option is not supported by the current database driver");h&&Q.isPostgresFamily(this.connection.driver)&&(p+=` WHERE ( ${h} )`)}else u&&(p+=` ON CONSTRAINT ${this.escape(u)}`);const f=[];Array.isArray(c)?f.push(...c.map(m=>`${this.escape(m)} = EXCLUDED.${this.escape(m)}`)):l&&f.push(...l.map(m=>`${this.escape(m)} = :${m}`)),f.length>0&&(o+=` ${p} DO UPDATE SET `,f.push(...this.expressionMap.mainAlias.metadata.columns.filter(m=>m.isUpdateDate&&!(c!=null&&c.includes(m.databaseName))&&!(this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")).map(m=>`${this.escape(m.databaseName)} = DEFAULT`)),o+=f.join(", "),o+=" "),Array.isArray(c)&&d&&Q.isPostgresFamily(this.connection.driver)&&(o+=" WHERE (",o+=c.map(m=>`${e}.${this.escape(m)} IS DISTINCT FROM EXCLUDED.${this.escape(m)}`).join(" OR "),o+=") ")}}else if(this.connection.driver.supportedUpsertTypes.includes("on-duplicate-key-update")){if(this.expressionMap.onUpdate){const{overwrite:c,columns:l}=this.expressionMap.onUpdate;Array.isArray(c)?(o+=" ON DUPLICATE KEY UPDATE ",o+=c.map(u=>`${this.escape(u)} = VALUES(${this.escape(u)})`).join(", "),o+=" "):Array.isArray(l)&&(o+=" ON DUPLICATE KEY UPDATE ",o+=l.map(u=>`${this.escape(u)} = :${u}`).join(", "),o+=" ")}}else if(this.expressionMap.onUpdate)throw new Y("onUpdate is not supported by the current database driver")}return r&&(Q.isPostgresFamily(this.connection.driver)||this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="cockroachdb"||Q.isMySQLFamily(this.connection.driver))&&(o+=` RETURNING ${r}`),this.connection.driver.options.type==="mssql"&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter(c=>this.expressionMap.insertColumns.length>0?this.expressionMap.insertColumns.indexOf(c.propertyPath)!==-1:c.isInsert).some(c=>this.isOverridingAutoIncrementBehavior(c))&&(o=`SET IDENTITY_INSERT ${e} ON; ${o}; SET IDENTITY_INSERT ${e} OFF`),o}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(e=>this.expressionMap.insertColumns.length?this.expressionMap.insertColumns.indexOf(e.propertyPath)!==-1:!(!e.isInsert||e.isGenerated&&e.generationStrategy==="increment"&&this.connection.driver.options.type!=="spanner"&&this.connection.driver.options.type!=="oracle"&&!Q.isSQLiteFamily(this.connection.driver)&&!Q.isMySQLFamily(this.connection.driver)&&this.connection.driver.options.type!=="aurora-mysql"&&!(this.connection.driver.options.type==="mssql"&&this.isOverridingAutoIncrementBehavior(e)))):[]}createColumnNamesExpression(){const e=this.getInsertedColumns();if(e.length>0)return e.map(n=>this.escape(n.databaseName)).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const n=this.getValueSets();if(n.length===1)return Object.keys(n[0]).map(r=>this.escape(r)).join(", ")}return this.expressionMap.insertColumns.map(n=>this.escape(n)).join(", ")}createValuesExpression(){const e=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){let r="";return e.forEach((i,o)=>{n.forEach((s,a)=>{a===0&&(this.connection.driver.options.type==="oracle"&&e.length>1||this.connection.driver.options.type==="sap"&&e.length>1?r+=" SELECT ":r+="(");let c=s.getEntityValue(i);if(typeof c!="function"&&(c=this.connection.driver.preparePersistentValue(c,s)),s.isVersion&&c===void 0)r+="1";else if(s.isDiscriminator)r+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(s.isGenerated&&s.generationStrategy==="uuid"&&!this.connection.driver.isUUIDGenerationSupported()&&c===void 0)c=aS(),r+=this.createParameter(c),o in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[o]={}),s.setEntityValue(this.expressionMap.locallyGenerated[o],c);else if(c===void 0)this.connection.driver.options.type==="oracle"&&e.length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?s.default!==void 0&&s.default!==null?r+=this.connection.driver.normalizeDefault(s):r+="NULL":r+="DEFAULT";else if(c===null&&this.connection.driver.options.type==="spanner")r+="NULL";else if(typeof c=="function")r+=c();else{this.connection.driver.options.type==="mssql"&&(c=this.connection.driver.parametrizeValue(s,c));const l=this.createParameter(c);if((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1){const u=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";s.srid!=null?r+=`${u}(${l}, ${s.srid})`:r+=`${u}(${l})`}else Q.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1?s.srid!=null?r+=`ST_SetSRID(ST_GeomFromGeoJSON(${l}), ${s.srid})::${s.type}`:r+=`ST_GeomFromGeoJSON(${l})::${s.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(s.type)!==-1?r+=s.type+"::STGeomFromText("+l+", "+(s.srid||"0")+")":r+=l}a===n.length-1?o===e.length-1?this.connection.driver.options.type==="oracle"&&e.length>1?r+=" FROM DUAL ":this.connection.driver.options.type==="sap"&&e.length>1?r+=" FROM dummy ":r+=")":this.connection.driver.options.type==="oracle"&&e.length>1?r+=" FROM DUAL UNION ALL ":this.connection.driver.options.type==="sap"&&e.length>1?r+=" FROM dummy UNION ALL ":r+="), ":r+=", "})}),r==="()"?"":r}else{let r="";return e.forEach((i,o)=>{Object.keys(i).forEach((s,a)=>{a===0&&(r+="(");const c=i[s];typeof c=="function"?r+=c():c===void 0?this.connection.driver.options.type==="oracle"&&e.length>1||Q.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?r+="NULL":r+="DEFAULT":c===null&&this.connection.driver.options.type==="spanner"||(r+=this.createParameter(c)),a===Object.keys(i).length-1?o===e.length-1?r+=")":r+="), ":r+=", "})}),r==="()"?"":r}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(Ee.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new KC}isOverridingAutoIncrementBehavior(e){return e.isPrimary&&e.isGenerated&&e.generationStrategy==="increment"&&this.getValueSets().some(n=>e.getEntityValue(n)!==void 0&&e.getEntityValue(n)!==null)}}class Pp{constructor(e,n){this.queryBuilder=e,this.expressionMap=n}async update(e){const n=this.expressionMap.relationMetadata;if(n.isManyToOne||n.isOneToOneOwner){const r=n.joinColumns.reduce((i,o)=>{const s=Ee.isObject(e)?o.referencedColumn.getEntityValue(e):e;return o.setEntityValue(i,s),i},{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(n.entityMetadata.target).set(r).whereInIds(this.expressionMap.of).execute()}else if((n.isOneToOneNotOwner||n.isOneToMany)&&e===null){const r={};n.inverseRelation.joinColumns.forEach(c=>{r[c.propertyName]=null});const i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o={},s=[];i.forEach((c,l)=>{n.inverseRelation.joinColumns.map((u,d)=>{const h="joinColumn_"+l+"_"+d;o[h]=Ee.isObject(c)?u.referencedColumn.getEntityValue(c):c,s.push(`${u.propertyPath} = :${h}`)})});const a=s.map(c=>"("+c+")").join(" OR ");if(!a)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(r).where(a).setParameters(o).execute()}else if(n.isOneToOneNotOwner||n.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new Y("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const r=this.expressionMap.of,i=n.inverseRelation.joinColumns.reduce((o,s)=>{const a=Ee.isObject(r)?s.referencedColumn.getEntityValue(r):r;return s.setEntityValue(o,a),o},{});if(!e||Array.isArray(e)&&!e.length)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(i).whereInIds(e).execute()}else{const r=n.junctionEntityMetadata,i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(e)?e:[e],s=n.isManyToManyOwner?i:o,a=n.isManyToManyOwner?o:i,c=[];if(s.forEach(l=>{a.forEach(u=>{const d={};r.ownerColumns.forEach(h=>{d[h.databaseName]=Ee.isObject(l)?h.referencedColumn.getEntityValue(l):l}),r.inverseColumns.forEach(h=>{d[h.databaseName]=Ee.isObject(u)?h.referencedColumn.getEntityValue(u):u}),c.push(d)})}),!c.length)return;this.queryBuilder.connection.driver.options.type==="oracle"||this.queryBuilder.connection.driver.options.type==="sap"?await Promise.all(c.map(l=>this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(l).execute())):await this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(c).execute()}}}class lS{constructor(e,n){this.queryBuilder=e,this.expressionMap=n}async remove(e){const n=this.expressionMap.relationMetadata;if(n.isOneToMany){const r=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i=Array.isArray(e)?e:[e],o={};n.inverseRelation.joinColumns.forEach(l=>{o[l.propertyName]=null});const s={},a=[];r.forEach((l,u)=>{a.push(...i.map((d,h)=>[...n.inverseRelation.joinColumns.map((p,f)=>{const m="joinColumn_"+u+"_"+h+"_"+f;return s[m]=Ee.isObject(l)?p.referencedColumn.getEntityValue(l):l,`${p.propertyPath} = :${m}`}),...n.inverseRelation.entityMetadata.primaryColumns.map((p,f)=>{const m="primaryColumn_"+h+"_"+h+"_"+f;return s[m]=Ee.isObject(d)?p.getEntityValue(d):d,`${p.propertyPath} = :${m}`})].join(" AND ")))});const c=a.map(l=>"("+l+")").join(" OR ");if(!c)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(o).where(c).setParameters(s).execute()}else{const r=n.junctionEntityMetadata,i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(e)?e:[e],s=n.isManyToManyOwner?i:o,a=n.isManyToManyOwner?o:i,c={},l=[];s.forEach((d,h)=>{l.push(...a.map((p,f)=>[...r.ownerColumns.map((m,y)=>{const g="firstValue_"+h+"_"+f+"_"+y;return c[g]=Ee.isObject(d)?m.referencedColumn.getEntityValue(d):d,`${m.databaseName} = :${g}`}),...r.inverseColumns.map((m,y)=>{const g="secondValue_"+h+"_"+f+"_"+y;return c[g]=Ee.isObject(p)?m.referencedColumn.getEntityValue(p):p,`${m.databaseName} = :${g}`})].join(" AND ")))});const u=l.map(d=>"("+d+")").join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(r.tableName).where(u).setParameters(c).execute()}}}class uS extends ve{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(e){return this.expressionMap.of=e,this}async set(e){const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new Y("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToMany||n.isOneToMany)throw new Y(`Set operation is only supported for many-to-one and one-to-one relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .add() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!Ee.isObject(e)||Object.keys(e).length<n.joinColumns.length))throw new Y('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new Pp(this,this.expressionMap).update(e)}async add(e){if(Array.isArray(e)&&e.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new Y("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new Y(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!Ee.isObject(e)||Object.keys(e).length<n.joinColumns.length))throw new Y('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new Pp(this,this.expressionMap).update(e)}async remove(e){if(Array.isArray(e)&&e.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new Y("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new Y(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set(null) method instead.`);return new lS(this,this.expressionMap).remove(e)}async addAndRemove(e,n){await this.remove(n),await this.add(e)}async loadOne(){return this.loadMany().then(e=>e[0])}async loadMany(){let e=this.expressionMap.of;if(!Ee.isObject(e)){const n=this.expressionMap.mainAlias.metadata;if(n.hasMultiplePrimaryKeys)throw new Y("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=n.primaryColumns[0].createValueMap(e)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)}}class Pe{static chunk(e,n){return Array.from(Array(Math.ceil(e.length/n)),(r,i)=>e.slice(i*n,i*n+n))}static splitClassesAndStrings(e){return[e.filter(n=>typeof n!="string"),e.filter(n=>typeof n=="string")]}static groupBy(e,n){return e.reduce((r,i)=>{const o=n(i);let s=r.find(a=>a.id===o);return s||(s={id:o,items:[]},r.push(s)),s.items.push(i),r},[])}static uniq(e,n){return e.reduce((r,i)=>{let o=!1;if(typeof n=="function"){const s=n(i);o=!!r.find(a=>n(a)===s)}else typeof n=="string"?o=!!r.find(s=>s[n]===i[n]):o=r.indexOf(i)!==-1;return o||r.push(i),r},[])}static isPlainObject(e){return e==null?!1:!e.constructor||e.constructor===Object}static mergeArrayKey(e,n,r,i){if(i.has(r)){e[n]=i.get(r);return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){e[n]=r;return}e[n]||(e[n]=Array.isArray(r)?[]:{}),i.set(r,e[n]),this.merge(e[n],r,i),i.delete(r)}}static mergeObjectKey(e,n,r,i){if(i.has(r)){Object.assign(e,{[n]:i.get(r)});return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){Object.assign(e,{[n]:r});return}e[n]||Object.assign(e,{[n]:Array.isArray(r)?[]:{}}),i.set(r,e[n]),this.merge(e[n],r,i),i.delete(r)}}static merge(e,n,r=new Map){if(this.isPlainObject(e)&&this.isPlainObject(n))for(const i of Object.keys(n))i!=="__proto__"&&this.mergeObjectKey(e,i,n[i],r);if(Array.isArray(e)&&Array.isArray(n))for(let i=0;i<n.length;i++)this.mergeArrayKey(e,i,n[i],r)}static mergeDeep(e,...n){if(!n.length)return e;for(const r of n)Pe.merge(e,r);return e}static deepCompare(...e){let n,r,i,o;if(arguments.length<1)return!0;for(n=1,r=arguments.length;n<r;n++)if(i=[],o=[],!this.compare2Objects(i,o,arguments[0],arguments[n]))return!1;return!0}static deepValue(e,n){const r=n.split(".");for(let i=0,o=r.length;i<o;i++)e=e[r[i]];return e}static replaceEmptyObjectsWithBooleans(e){for(let n in e)e[n]&&typeof e[n]=="object"&&(Object.keys(e[n]).length===0?e[n]=!0:this.replaceEmptyObjectsWithBooleans(e[n]))}static propertyPathsToTruthyObject(e){let n={};for(let r of e){const i=r.split(".");if(!i.length)continue;(!n[i[0]]||n[i[0]]===!0)&&(n[i[0]]={});let o=n[i[0]];for(let[s,a]of i.entries())s!==0&&(o[a]?o=o[a]:s===i.length-1?(o[a]={},o=null):(o[a]={},o=o[a]))}return this.replaceEmptyObjectsWithBooleans(n),n}static compareIds(e,n){return e==null||n===void 0||n===null?!1:(typeof e.id=="string"&&typeof n.id=="string"||typeof e.id=="number"&&typeof n.id=="number")&&Object.keys(e).length===1&&Object.keys(n).length===1?e.id===n.id:Pe.deepCompare(e,n)}static toBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e==="true"||e==="1":typeof e=="number"?e>0:!1}static zipObject(e,n){return e.reduce((r,i,o)=>(r[i]=n[o],r),{})}static isArraysEqual(e,n){return e.length!==n.length?!1:e.every(r=>n.indexOf(r)!==-1)}static areMutuallyExclusive(...e){return!e.some(n=>{const r=e.filter(i=>i!==n);return n.some(i=>r.some(o=>o.includes(i)))})}static parseSqlCheckExpression(e,n){const r=e.match(new RegExp(`"${n}" varchar CHECK\\s*\\(\\s*"${n}"\\s+IN\\s*`));if(r&&r.index){const i=e.substring(r.index+r[0].length);let o="",s="";const a=[];for(let c=0;c<i.length;c++){const l=i[c];switch(l){case",":o==""?(a.push(s),s=""):s+=l;break;case"'":o==l?i[c+1]===l?(s+=l,c+=1):o="":o=l;break;case")":if(o=="")return a.push(s),a;s+=l;break;default:o!=""&&(s+=l)}}}}static compare2Objects(e,n,r,i){let o;if(Number.isNaN(r)&&Number.isNaN(i)||r===i)return!0;if(r===null||i===null||r===void 0||i===void 0)return!1;if((typeof r.equals=="function"||typeof r.equals=="function")&&r.equals(i))return!0;if(typeof r=="function"&&typeof i=="function"||r instanceof Date&&i instanceof Date||r instanceof RegExp&&i instanceof RegExp||typeof r=="string"&&typeof i=="string"||typeof r=="number"&&typeof i=="number")return r.toString()===i.toString();if(!(typeof r=="object"&&typeof i=="object")||Object.prototype.isPrototypeOf.call(r,i)||Object.prototype.isPrototypeOf.call(i,r)||r.constructor!==i.constructor||r.prototype!==i.prototype||e.indexOf(r)>-1||n.indexOf(i)>-1)return!1;for(o in i)if(i.hasOwnProperty(o)!==r.hasOwnProperty(o)||typeof i[o]!=typeof r[o])return!1;for(o in r){if(i.hasOwnProperty(o)!==r.hasOwnProperty(o)||typeof i[o]!=typeof r[o])return!1;switch(typeof r[o]){case"object":case"function":if(e.push(r),n.push(i),!this.compare2Objects(e,n,r[o],i[o]))return!1;e.pop(),n.pop();break;default:if(r[o]!==i[o])return!1;break}}return!0}}class dS{constructor(e,n,r,i,o){this.expressionMap=e,this.driver=n,this.rawRelationIdResults=r,this.rawRelationCountResults=i,this.queryRunner=o}transform(e,n){const r=this.group(e,n),i=[];return r.forEach(o=>{const s=this.transformRawResultsGroup(o,n);s!==void 0&&!Object.values(s).every(a=>a===null)&&i.push(s)}),i}group(e,n){const r=new Map,i=[];return n.metadata.tableType==="view"?i.push(...n.metadata.columns.map(o=>Q.buildAlias(this.driver,void 0,n.name,o.databaseName))):i.push(...n.metadata.primaryColumns.map(o=>Q.buildAlias(this.driver,void 0,n.name,o.databaseName))),e.forEach(o=>{const s=i.map(c=>{const l=o[c];return cf.isBuffer(l)?l.toString("hex"):Ee.isObject(l)?JSON.stringify(l):l}).join("_"),a=r.get(s);a?a.push(o):r.set(s,[o])}),r}transformRawResultsGroup(e,n){let r=n.metadata;if(r.discriminatorColumn){const l=e.map(d=>d[Q.buildAlias(this.driver,void 0,n.name,n.metadata.discriminatorColumn.databaseName)]),u=r.childEntityMetadatas.find(d=>typeof l.find(h=>h===d.discriminatorValue)<"u");u&&(r=u)}let i=r.create(this.queryRunner,{fromDeserializer:!0,pojo:this.expressionMap.options.indexOf("create-pojo")!==-1});const o=this.transformColumns(e,n,i,r),s=this.transformJoins(e,i,n,r),a=this.transformRelationIds(e,n,i,r),c=this.transformRelationCounts(e,n,i);if(o||r.primaryColumns.filter(l=>l.isVirtual===!1).length===0&&(s||a||c))return i}transformColumns(e,n,r,i){let o=!1;return i.columns.forEach(s=>{if(i.childEntityMetadatas.length>0&&i.childEntityMetadatas.findIndex(c=>c.target===s.target)!==-1)return;const a=e[0][Q.buildAlias(this.driver,void 0,n.name,s.databaseName)];a===void 0||s.isVirtual||this.expressionMap.selects.find(c=>c.selection===n.name||c.selection===n.name+"."+s.propertyPath)&&(s.setEntityValue(r,this.driver.prepareHydratedValue(a,s)),a!==null&&(o=!0))}),o}transformJoins(e,n,r,i){let o=!1;return this.expressionMap.joinAttributes.forEach(s=>{if(!s.metadata||!s.isSelected||s.relation&&!i.relations.find(c=>c===s.relation))return;if(s.mapToProperty){if(s.mapToPropertyParentAlias!==r.name)return}else if(!s.relation||s.parentAlias!==r.name||s.relationPropertyPath!==s.relation.propertyPath)return;let a=this.transform(e,s.alias);a=s.isMany?a:a[0],a=!s.isMany&&a===void 0?null:a,a!==void 0&&(s.mapToPropertyPropertyName?n[s.mapToPropertyPropertyName]=a:s.relation.setEntityValue(n,a),o=!0)}),o}transformRelationIds(e,n,r,i){let o=!1;return this.rawRelationIdResults.forEach((s,a)=>{if(s.relationIdAttribute.parentAlias!==n.name)return;const c=s.relationIdAttribute.relation,l=this.createValueMapFromJoinColumns(c,s.relationIdAttribute.parentAlias,e);if(l==null)return;this.prepareDataForTransformRelationIds();const u=this.hashEntityIds(c,l),d=this.relationIdMaps[a][u]||[],h=s.relationIdAttribute.mapToPropertyPropertyPath.split("."),p=(f,m,y)=>{const g=f.shift();if(g&&f.length===0)return m[g]=y,m;if(g&&f.length>0)p(f,m[g],y);else return m};c.isOneToOne||c.isManyToOne?d[0]!==void 0&&(p(h,r,d[0]),o=!0):(p(h,r,d),o=o||d.length>0)}),o}transformRelationCounts(e,n,r){let i=!1;return this.rawRelationCountResults.filter(o=>o.relationCountAttribute.parentAlias===n.name).forEach(o=>{const s=o.relationCountAttribute.relation;let a;s.isOneToMany?a=s.inverseRelation.joinColumns[0].referencedColumn.databaseName:a=s.isOwning?s.joinColumns[0].referencedColumn.databaseName:s.inverseRelation.joinColumns[0].referencedColumn.databaseName;const c=e[0][Q.buildAlias(this.driver,void 0,n.name,a)];c!=null&&(r[o.relationCountAttribute.mapToPropertyPropertyName]=0,o.results.filter(l=>l.parentId===c).forEach(l=>{r[o.relationCountAttribute.mapToPropertyPropertyName]=parseInt(l.cnt),i=!0}))}),i}createValueMapFromJoinColumns(e,n,r){let i;return e.isManyToOne||e.isOneToOneOwner?i=e.entityMetadata.primaryColumns.map(o=>o):e.isOneToMany||e.isOneToOneNotOwner?i=e.inverseRelation.joinColumns.map(o=>o):e.isOwning?i=e.joinColumns.map(o=>o):i=e.inverseRelation.inverseJoinColumns.map(o=>o),i.reduce((o,s)=>(r.forEach(a=>{e.isManyToOne||e.isOneToOneOwner?o[s.databaseName]=this.driver.prepareHydratedValue(a[Q.buildAlias(this.driver,void 0,n,s.databaseName)],s):o[s.databaseName]=this.driver.prepareHydratedValue(a[Q.buildAlias(this.driver,void 0,n,s.referencedColumn.databaseName)],s.referencedColumn)}),o),{})}extractEntityPrimaryIds(e,n){let r;return e.isManyToOne||e.isOneToOneOwner?r=e.entityMetadata.primaryColumns.map(i=>i):e.isOneToMany||e.isOneToOneNotOwner?r=e.inverseRelation.joinColumns.map(i=>i):e.isOwning?r=e.joinColumns.map(i=>i):r=e.inverseRelation.inverseJoinColumns.map(i=>i),r.reduce((i,o)=>(i[o.databaseName]=n[o.databaseName],i),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map(e=>{const n=e.relationIdAttribute.relation;let r;return n.isManyToOne||n.isOneToOneOwner?r=n.joinColumns:n.isOneToMany||n.isOneToOneNotOwner?r=n.inverseEntityMetadata.primaryColumns:n.isOwning?r=n.inverseJoinColumns:r=n.inverseRelation.joinColumns,e.results.reduce((i,o)=>{let s=r.reduce((a,c)=>{let l=o[c.databaseName];return n.isOneToMany||n.isOneToOneNotOwner?(c.isVirtual&&c.referencedColumn&&c.referencedColumn.propertyName!==c.propertyName&&(l=c.referencedColumn.createValueMap(l)),Pe.mergeDeep(a,c.createValueMap(l))):(!c.isPrimary&&c.referencedColumn.referencedColumn&&(l=c.referencedColumn.referencedColumn.createValueMap(l)),Pe.mergeDeep(a,c.referencedColumn.createValueMap(l)))},{});if(r.length===1&&!e.relationIdAttribute.disableMixedMap&&(n.isOneToMany||n.isOneToOneNotOwner?s=r[0].getEntityValue(s):s=r[0].referencedColumn.getEntityValue(s)),s!==void 0){const a=this.hashEntityIds(n,o);i[a]?i[a].push(s):i[a]=[s]}return i},{})}))}hashEntityIds(e,n){const r=this.extractEntityPrimaryIds(e,n);return JSON.stringify(r)}}let hS=class{constructor(t,e,n){this.connection=t,this.queryRunner=e,this.relationIdAttributes=n}async load(t){const e=this.relationIdAttributes.map(async n=>{if(n.relation.isManyToOne||n.relation.isOneToOneOwner){if(n.queryBuilderFactory)throw new Y("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const r={},i=t.map(o=>{const s={},a=[];n.relation.joinColumns.forEach(l=>{s[l.databaseName]=this.connection.driver.prepareHydratedValue(o[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,l.databaseName)],l.referencedColumn);const u=`${l.databaseName}:${s[l.databaseName]}`;a.indexOf(u)===-1&&a.push(u)}),n.relation.entityMetadata.primaryColumns.forEach(l=>{s[l.databaseName]=this.connection.driver.prepareHydratedValue(o[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,l.databaseName)],l);const u=`${l.databaseName}:${s[l.databaseName]}`;a.indexOf(u)===-1&&a.push(u)}),a.sort();const c=a.join("::");return r[c]?null:(r[c]=!0,s)}).filter(o=>o);return{relationIdAttribute:n,results:i}}else if(n.relation.isOneToMany||n.relation.isOneToOneNotOwner){const r=n.relation,i=r.isOwning?r.joinColumns:r.inverseRelation.joinColumns,o=r.inverseEntityMetadata.target,s=r.inverseEntityMetadata.tableName,a=n.alias||s,c={},l={},u=t.map((p,f)=>{const m=[],y={},g=i.map(x=>{const v=x.databaseName+f,C=p[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,x.referencedColumn.databaseName)],T=`${a}:${x.propertyPath}:${C}`;return m.indexOf(T)!==-1?"":(m.push(T),y[v]=C,a+"."+x.propertyPath+" = :"+v)}).filter(x=>x).join(" AND ");m.sort();const b=m.join("::");return c[b]?"":(c[b]=!0,Object.assign(l,y),g)}).filter(p=>p).map(p=>"("+p+")").join(" OR ");if(!u)return{relationIdAttribute:n,results:[]};const d=this.connection.createQueryBuilder(this.queryRunner);Pe.uniq([...i,...r.inverseRelation.entityMetadata.primaryColumns],p=>p.propertyPath).forEach(p=>{d.addSelect(a+"."+p.propertyPath,p.databaseName)}),d.from(o,a).where("("+u+")").setParameters(l),n.queryBuilderFactory&&n.queryBuilderFactory(d);const h=await d.getRawMany();return h.forEach(p=>{i.forEach(f=>{p[f.databaseName]=this.connection.driver.prepareHydratedValue(p[f.databaseName],f.referencedColumn)}),r.inverseRelation.entityMetadata.primaryColumns.forEach(f=>{p[f.databaseName]=this.connection.driver.prepareHydratedValue(p[f.databaseName],f)})}),{relationIdAttribute:n,results:h}}else{const r=n.relation,i=r.isOwning?r.joinColumns:r.inverseRelation.inverseJoinColumns,o=r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns,s=n.junctionAlias,a=n.joinInverseSideMetadata.tableName,c=n.alias||a,l=r.isOwning?r.junctionEntityMetadata.tableName:r.inverseRelation.junctionEntityMetadata.tableName,u=t.map(b=>i.reduce((x,v)=>(x[v.propertyPath]=b[Q.buildAlias(this.connection.driver,void 0,n.parentAlias,v.referencedColumn.databaseName)],x),{}));if(u.length===0)return{relationIdAttribute:n,results:[]};const d={},h={},p=u.map((b,x)=>{const v=[],C={},T=Object.keys(b).map(j=>{const $=j+x,B=b[j],V=`${s}:${j}:${B}`;return v.indexOf(V)!==-1?"":(v.push(V),C[$]=B,s+"."+j+" = :"+$)}).filter(j=>j).join(" AND ");v.sort();const S=v.join("::");return h[S]?"":(h[S]=!0,Object.assign(d,C),T)}).filter(b=>b),f=o.map(b=>s+"."+b.propertyPath+" = "+c+"."+b.referencedColumn.propertyPath).join(" AND "),m=p.map(b=>"("+b+" AND "+f+")").join(" OR "),y=this.connection.createQueryBuilder(this.queryRunner);o.forEach(b=>{y.addSelect(s+"."+b.propertyPath,b.databaseName).addOrderBy(s+"."+b.propertyPath)}),i.forEach(b=>{y.addSelect(s+"."+b.propertyPath,b.databaseName).addOrderBy(s+"."+b.propertyPath)}),y.from(a,c).innerJoin(l,s,m).setParameters(d),n.queryBuilderFactory&&n.queryBuilderFactory(y);const g=await y.getRawMany();return g.forEach(b=>{[...i,...o].forEach(x=>{b[x.databaseName]=this.connection.driver.prepareHydratedValue(b[x.databaseName],x.referencedColumn)})}),{relationIdAttribute:n,results:g}}});return Promise.all(e)}};class pS{constructor(e,n){this.connection=e,this.queryRunner=n}load(e,n,r){const i=Array.isArray(n)?n:[n],o=Array.isArray(r)?r:r?[r]:void 0;return e.isManyToMany?this.loadForManyToMany(e,i,o):e.isManyToOne||e.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(e,i,o):this.loadForOneToManyAndOneToOneNotOwner(e,i,o)}async loadManyToManyRelationIdsAndGroup(e,n,r,i){const o=e.isManyToMany||e.isOneToMany,s=Array.isArray(n)?n:[n];if(!r&&(r=await this.connection.relationLoader.load(e,n,this.queryRunner,i),!r.length))return s.map(d=>({entity:d,related:o?[]:void 0}));const a=await this.load(e,n,r),c=Array.isArray(r)?r:[r];let l=[],u=[];return e.isManyToManyOwner?(l=e.junctionEntityMetadata.inverseColumns.map(d=>d.referencedColumn),u=e.junctionEntityMetadata.ownerColumns.map(d=>d.referencedColumn)):e.isManyToManyNotOwner?(l=e.junctionEntityMetadata.ownerColumns.map(d=>d.referencedColumn),u=e.junctionEntityMetadata.inverseColumns.map(d=>d.referencedColumn)):e.isManyToOne||e.isOneToOneOwner?(l=e.joinColumns.map(d=>d.referencedColumn),u=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(l=e.inverseRelation.entityMetadata.primaryColumns,u=e.inverseRelation.joinColumns.map(d=>d.referencedColumn)),s.map(d=>{const h={entity:d,related:o?[]:void 0},p=a.filter(f=>u.every(m=>m.compareEntityValue(d,f[m.entityMetadata.name+"_"+m.propertyAliasName])));return p.length&&c.forEach(f=>{p.forEach(m=>{l.every(y=>y.compareEntityValue(f,m[Q.buildAlias(this.connection.driver,void 0,y.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+y.propertyPath.replace(".","_"))]))&&(o?h.related.push(f):h.related=f)})}),h})}loadForManyToMany(e,n,r){const i=e.junctionEntityMetadata,o=i.name,s=e.isOwning?i.ownerColumns:i.inverseColumns,a=e.isOwning?i.inverseColumns:i.ownerColumns,c=this.connection.createQueryBuilder(this.queryRunner);s.forEach(h=>{const p=Q.buildAlias(this.connection.driver,void 0,h.referencedColumn.entityMetadata.name+"_"+h.referencedColumn.propertyPath.replace(".","_"));c.addSelect(o+"."+h.propertyPath,p)}),a.forEach(h=>{const p=Q.buildAlias(this.connection.driver,void 0,h.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+h.referencedColumn.propertyPath.replace(".","_"));c.addSelect(o+"."+h.propertyPath,p)});let l="";if(s.length===1){const h=n.map(p=>s[0].referencedColumn.getEntityValue(p));h.every(p=>typeof p=="number")?l=`${o}.${s[0].propertyPath} IN (${h.join(", ")})`:(c.setParameter("values1",h),l=o+"."+s[0].propertyPath+" IN (:...values1)")}else l="("+n.map((h,p)=>s.map(f=>{const m="entity1_"+p+"_"+f.propertyName;return c.setParameter(m,f.referencedColumn.getEntityValue(h)),o+"."+f.propertyPath+" = :"+m}).join(" AND ")).map(h=>"("+h+")").join(" OR ")+")";let u="";if(r)if(a.length===1){const h=r.map(p=>a[0].referencedColumn.getEntityValue(p));h.every(p=>typeof p=="number")?u=`${o}.${a[0].propertyPath} IN (${h.join(", ")})`:(c.setParameter("values2",h),u=o+"."+a[0].propertyPath+" IN (:...values2)")}else u="("+r.map((h,p)=>a.map(f=>{const m="entity2_"+p+"_"+f.propertyName;return c.setParameter(m,f.referencedColumn.getEntityValue(h)),o+"."+f.propertyPath+" = :"+m}).join(" AND ")).map(h=>"("+h+")").join(" OR ")+")";const d=[l,u].filter(h=>h.length>0).join(" AND ");return c.from(i.target,o).where(d).getRawMany()}loadForManyToOneAndOneToOneOwner(e,n,r){const i=e.entityMetadata.targetName,o=e.joinColumns.every(c=>!!e.entityMetadata.nonVirtualColumns.find(l=>l===c));if(r&&o){let c=[];if(n.forEach(l=>{let u={};e.entityMetadata.primaryColumns.forEach(d=>{const h=d.entityMetadata.name+"_"+d.propertyPath.replace(".","_");u[h]=d.getEntityValue(l)}),r.forEach(d=>{e.joinColumns.forEach(h=>{const p=h.getEntityValue(l),f=h.referencedColumn.getEntityValue(d);if(!(p===void 0||f===void 0)&&p===f){const m=h.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+h.referencedColumn.propertyPath.replace(".","_");u[m]=f}})}),Object.keys(u).length===e.entityMetadata.primaryColumns.length+e.joinColumns.length&&c.push(u)}),c.length===n.length)return Promise.resolve(c)}const s=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(c=>{const l=Q.buildAlias(this.connection.driver,void 0,c.entityMetadata.name+"_"+c.propertyPath.replace(".","_"));s.addSelect(i+"."+c.propertyPath,l)}),e.joinColumns.forEach(c=>{const l=Q.buildAlias(this.connection.driver,void 0,c.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+c.referencedColumn.propertyPath.replace(".","_"));s.addSelect(i+"."+c.propertyPath,l)});let a="";if(e.entityMetadata.primaryColumns.length===1){const c=n.map(l=>e.entityMetadata.primaryColumns[0].getEntityValue(l));c.every(l=>typeof l=="number")?a=`${i}.${e.entityMetadata.primaryColumns[0].propertyPath} IN (${c.join(", ")})`:(s.setParameter("values",c),a=i+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else a=n.map((c,l)=>e.entityMetadata.primaryColumns.map((u,d)=>{const h="entity"+l+"_"+d;return s.setParameter(h,u.getEntityValue(c)),i+"."+u.propertyPath+" = :"+h}).join(" AND ")).map(c=>"("+c+")").join(" OR ");return s.from(e.entityMetadata.target,i).where(a).getRawMany()}loadForOneToManyAndOneToOneNotOwner(e,n,r){if(e=e.inverseRelation,e.entityMetadata.primaryColumns.length===e.joinColumns.length&&e.entityMetadata.primaryColumns.every(a=>e.joinColumns.indexOf(a)!==-1))return Promise.resolve(n.map(a=>{const c={};return e.joinColumns.forEach(function(l){const u=l.referencedColumn.getEntityValue(a),d=l.referencedColumn.entityMetadata.name+"_"+l.referencedColumn.propertyPath.replace(".","_"),h=l.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+l.propertyPath.replace(".","_");c[d]=u,c[h]=u}),c}));const i=e.entityMetadata.targetName,o=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(a=>{const c=Q.buildAlias(this.connection.driver,void 0,a.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+a.propertyPath.replace(".","_"));o.addSelect(i+"."+a.propertyPath,c)}),e.joinColumns.forEach(a=>{const c=Q.buildAlias(this.connection.driver,void 0,a.referencedColumn.entityMetadata.name+"_"+a.referencedColumn.propertyPath.replace(".","_"));o.addSelect(i+"."+a.propertyPath,c)});let s="";if(e.joinColumns.length===1){const a=n.map(c=>e.joinColumns[0].referencedColumn.getEntityValue(c));a.every(c=>typeof c=="number")?s=`${i}.${e.joinColumns[0].propertyPath} IN (${a.join(", ")})`:(o.setParameter("values",a),s=i+"."+e.joinColumns[0].propertyPath+" IN (:...values)")}else s=n.map((a,c)=>e.joinColumns.map((l,u)=>{const d="entity"+c+"_"+u;return o.setParameter(d,l.referencedColumn.getEntityValue(a)),i+"."+l.propertyPath+" = :"+d}).join(" AND ")).map(a=>"("+a+")").join(" OR ");return o.from(e.entityMetadata.target,i).where(s).getRawMany()}}class fS{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(e=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationIds.forEach(n=>{const r=this.metadataToAttribute(e.alias.name,n);this.expressionMap.relationIdAttributes.push(r)})})}metadataToAttribute(e,n){return new ts(this.expressionMap,{relationName:e+"."+n.relation.propertyName,mapToProperty:e+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class mS{constructor(e,n,r){this.connection=e,this.queryRunner=n,this.relationCountAttributes=r}async load(e){const n=(i,o,s)=>s.indexOf(i)===o,r=this.relationCountAttributes.map(async i=>{if(i.relation.isOneToMany){const o=i.relation,s=o.inverseRelation,a=s.joinColumns[0].referencedColumn.propertyName,c=o.inverseEntityMetadata.target,l=o.inverseEntityMetadata.tableName,u=i.alias||l,d=s.propertyName;let h=e.map(f=>f[i.parentAlias+"_"+a]).filter(f=>!!f);if(h=h.filter(n),h.length===0)return{relationCountAttribute:i,results:[]};const p=this.connection.createQueryBuilder(this.queryRunner);return p.select(u+"."+d,"parentId").addSelect("COUNT(*)","cnt").from(c,u).where(u+"."+d+" IN (:...ids)").addGroupBy(u+"."+d).setParameter("ids",h),i.queryBuilderFactory&&i.queryBuilderFactory(p),{relationCountAttribute:i,results:await p.getRawMany()}}else{let o,s,a,c;i.relation.isOwning?(o=i.relation.joinColumns[0].referencedColumn.databaseName,s=i.relation.inverseJoinColumns[0].referencedColumn.databaseName,a=i.relation.junctionEntityMetadata.columns[0],c=i.relation.junctionEntityMetadata.columns[1]):(o=i.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,s=i.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,a=i.relation.junctionEntityMetadata.columns[1],c=i.relation.junctionEntityMetadata.columns[0]);let l=e.map(y=>y[i.parentAlias+"_"+o]).filter(y=>!!y);if(l=l.filter(n),l.length===0)return{relationCountAttribute:i,results:[]};const u=i.junctionAlias,d=i.joinInverseSideMetadata.tableName,h=i.alias||d,p=i.relation.junctionEntityMetadata.tableName,f=u+"."+a.propertyName+" IN ("+l.map(y=>isNaN(y)?"'"+y+"'":y)+") AND "+u+"."+c.propertyName+" = "+h+"."+s,m=this.connection.createQueryBuilder(this.queryRunner);return m.select(u+"."+a.propertyName,"parentId").addSelect("COUNT("+m.escape(h)+"."+m.escape(s)+")","cnt").from(d,h).innerJoin(p,u,f).addGroupBy(u+"."+a.propertyName),i.queryBuilderFactory&&i.queryBuilderFactory(m),{relationCountAttribute:i,results:await m.getRawMany()}}});return Promise.all(r)}}class yS{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(e=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationCounts.forEach(n=>{const r=this.metadataToAttribute(e.alias.name,n);this.expressionMap.relationCountAttributes.push(r)})})}metadataToAttribute(e,n){return new ns(this.expressionMap,{relationName:e+"."+n.relation.propertyName,mapToProperty:e+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class ss{static isFindOneOptions(e){const n=e;return n&&(Array.isArray(n.select)||Array.isArray(n.relations)||typeof n.select=="object"||typeof n.relations=="object"||typeof n.where=="object"||typeof n.join=="object"||typeof n.order=="object"||typeof n.cache=="object"||typeof n.cache=="boolean"||typeof n.cache=="number"||typeof n.comment=="string"||typeof n.lock=="object"||typeof n.loadRelationIds=="object"||typeof n.loadRelationIds=="boolean"||typeof n.loadEagerRelations=="boolean"||typeof n.withDeleted=="boolean"||typeof n.relationLoadStrategy=="string"||typeof n.transaction=="boolean")}static isFindManyOptions(e){const n=e;return n&&(this.isFindOneOptions(n)||typeof n.skip=="number"||typeof n.take=="number"||typeof n.skip=="string"||typeof n.take=="string")}static extractFindManyOptionsAlias(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias}static applyOptionsToTreeQueryBuilder(e,n){if(n!=null&&n.relations){const r=[...n.relations];if(ss.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),r.length>0)throw new JC(r)}return e}static applyRelationsRecursively(e,n,r,i,o){let s=[];if(o){const a=new RegExp("^"+o.replace(".","\\.")+"\\.");s=n.filter(c=>c.match(a)).map(c=>i.findRelationWithPropertyPath(c.replace(a,""))).filter(c=>c)}else s=n.map(a=>i.findRelationWithPropertyPath(a)).filter(a=>a);s.forEach(a=>{let c=Q.buildAlias(e.connection.driver,{joiner:"__"},r,a.propertyPath);const l=r+"."+a.propertyPath;e.expressionMap.relationLoadStrategy==="query"?e.concatRelationMetadata(a):e.leftJoinAndSelect(l,c),n.splice(n.indexOf(o?o+"."+a.propertyPath:a.propertyPath),1);let u,d;if(e.expressionMap.relationLoadStrategy==="query")u=a.inverseEntityMetadata,d=c;else{const h=e.expressionMap.joinAttributes.find(p=>p.entityOrProperty===l);u=h.metadata,d=h.alias.name}if(!d||!u)throw new Ue(a.propertyPath,i);if(this.applyRelationsRecursively(e,n,d,u,o?o+"."+a.propertyPath:a.propertyPath),e.expressionMap.relationLoadStrategy==="join"){const h=i.relations.find(p=>p.propertyName===a.propertyPath);h&&this.joinEagerRelations(e,c,h.inverseEntityMetadata)}})}static joinEagerRelations(e,n,r){r.eagerRelations.forEach(i=>{let o=Q.buildAlias(e.connection.driver,{joiner:"__"},n,i.propertyName),s=!0;for(const l of e.expressionMap.joinAttributes)if(!(l.condition!==void 0||l.mapToProperty!==void 0||l.isMappingMany!==void 0||l.direction!=="LEFT"||l.entityOrProperty!==`${n}.${i.propertyPath}`)){s=!1,o=l.alias.name;break}const a=!!e.expressionMap.joinAttributes.find(l=>l.alias.name===o);s&&!a&&e.leftJoin(n+"."+i.propertyPath,o);let c=!0;for(const l of e.expressionMap.selects)if(!(l.aliasName!==void 0||l.virtual!==void 0||l.selection!==o)){c=!1;break}c&&e.addSelect(o),this.joinEagerRelations(e,o,i.inverseEntityMetadata)})}}class as extends ve{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),this.replacePropertyNamesForTheWholeQuery(e)}setFindOptions(e){return this.findOptions=e,this.applyFindOptions(),this}subQuery(){const e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e}select(e,n){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map(r=>({selection:r}));else if(typeof e=="function"){const r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:n}]);return this}addSelect(e,n){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map(r=>({selection:r})));else if(typeof e=="function"){const r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else e&&this.expressionMap.selects.push({selection:e,aliasName:n});return this}maxExecutionTime(e){return this.expressionMap.maxExecutionTime=e,this}distinct(e=!0){return this.expressionMap.selectDistinct=e,this}distinctOn(e){return this.expressionMap.selectDistinctOn=e,this}fromDummy(){return this.from(this.connection.driver.dummyTableName??"(SELECT 1 AS dummy_column)","dummy_table")}from(e,n){const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}addFrom(e,n){const r=this.createFromAlias(e,n);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(r),this}innerJoin(e,n,r,i){return this.join("INNER",e,n,r,i),this}leftJoin(e,n,r,i){return this.join("LEFT",e,n,r,i),this}innerJoinAndSelect(e,n,r,i){return this.addSelect(n),this.innerJoin(e,n,r,i),this}leftJoinAndSelect(e,n,r,i){return this.addSelect(n),this.leftJoin(e,n,r,i),this}innerJoinAndMapMany(e,n,r,i,o){return this.addSelect(r),this.join("INNER",n,r,i,o,e,!0),this}innerJoinAndMapOne(e,n,r,i,o,s){return this.addSelect(r),this.join("INNER",n,r,i,o,e,!1,s),this}leftJoinAndMapMany(e,n,r,i,o){return this.addSelect(r),this.join("LEFT",n,r,i,o,e,!0),this}leftJoinAndMapOne(e,n,r,i,o,s){return this.addSelect(r),this.join("LEFT",n,r,i,o,e,!1,s),this}loadRelationIdAndMap(e,n,r,i){const o=new ts(this.expressionMap);return o.mapToProperty=e,o.relationName=n,typeof r=="string"&&(o.alias=r),typeof r=="object"&&r.disableMixedMap&&(o.disableMixedMap=!0),o.queryBuilderFactory=i,this.expressionMap.relationIdAttributes.push(o),o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(e,n,r,i){const o=new ns(this.expressionMap);return o.mapToProperty=e,o.relationName=n,o.alias=r,o.queryBuilderFactory=i,this.expressionMap.relationCountAttributes.push(o),this.expressionMap.createAlias({type:"other",name:o.junctionAlias}),o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata}),this}loadAllRelationIds(e){return this.expressionMap.mainAlias.metadata.relations.forEach(n=>{e!==void 0&&e.relations!==void 0&&e.relations.indexOf(n.propertyPath)===-1||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+n.propertyPath,this.expressionMap.mainAlias.name+"."+n.propertyPath,e)}),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereExists(e){return this.where(...this.getExistsCondition(e))}andWhereExists(e){return this.andWhere(...this.getExistsCondition(e))}orWhereExists(e){return this.orWhere(...this.getExistsCondition(e))}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}having(e,n){return this.expressionMap.havings.push({type:"simple",condition:e}),n&&this.setParameters(n),this}andHaving(e,n){return this.expressionMap.havings.push({type:"and",condition:e}),n&&this.setParameters(n),this}orHaving(e,n){return this.expressionMap.havings.push({type:"or",condition:e}),n&&this.setParameters(n),this}groupBy(e){return e?this.expressionMap.groupBys=[e]:this.expressionMap.groupBys=[],this}addGroupBy(e){return this.expressionMap.groupBys.push(e),this}timeTravelQuery(e){return this.connection.driver.options.type==="cockroachdb"&&(e===void 0?this.expressionMap.timeTravel="follower_read_timestamp()":this.expressionMap.timeTravel=e),this}orderBy(e,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new Y('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new Y('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new Y('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new Y('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){if(this.expressionMap.limit=this.normalizeNumber(e),this.expressionMap.limit!==void 0&&isNaN(this.expressionMap.limit))throw new Y('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(e){if(this.expressionMap.offset=this.normalizeNumber(e),this.expressionMap.offset!==void 0&&isNaN(this.expressionMap.offset))throw new Y('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(e){if(this.expressionMap.take=this.normalizeNumber(e),this.expressionMap.take!==void 0&&isNaN(this.expressionMap.take))throw new Y('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(e){if(this.expressionMap.skip=this.normalizeNumber(e),this.expressionMap.skip!==void 0&&isNaN(this.expressionMap.skip))throw new Y('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(e){return this.expressionMap.useIndex=e,this}setLock(e,n,r){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=n,this.expressionMap.lockTables=r,this}setOnLocked(e){return this.expressionMap.onLocked=e,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if(this.expressionMap.lockMode==="optimistic")throw new $n;this.expressionMap.queryEntity=!1;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0);const r=await this.loadRawResults(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getRawAndEntities(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getOne(){const e=(await this.getRawAndEntities()).entities[0];if(e&&this.expressionMap.lockMode==="optimistic"&&this.expressionMap.lockVersion){const n=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const r=n.updateDateColumn.getEntityValue(e);if(r.getTime()!==this.expressionMap.lockVersion.getTime())throw new cp(n.name,this.expressionMap.lockVersion,r)}else{const r=n.versionColumn.getEntityValue(e);if(r!==this.expressionMap.lockVersion)throw new cp(n.name,this.expressionMap.lockVersion,r)}}return e===void 0?null:e}async getOneOrFail(){const e=await this.getOne();if(!e)throw new YC(this.expressionMap.mainAlias.target,this.expressionMap.parameters);return e}async getMany(){if(this.expressionMap.lockMode==="optimistic")throw new $n;return(await this.getRawAndEntities()).entities}async getCount(){if(this.expressionMap.lockMode==="optimistic")throw new $n;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeCountQuery(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getExists(){if(this.expressionMap.lockMode==="optimistic")throw new $n;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeExistsQuery(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getManyAndCount(){if(this.expressionMap.lockMode==="optimistic")throw new $n;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(e);this.expressionMap.queryEntity=!1;const i=this.expressionMap.cacheId;this.expressionMap.cacheId=i&&`${i}-count`;const o=await this.executeCountQuery(e),s=[r.entities,o];return n&&await e.commitTransaction(),s}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async stream(){this.expressionMap.queryEntity=!1;const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let i=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),i=!0);const o=()=>{if(r!==this.queryRunner)return r.release()},s=r.stream(e,n,o,o);return i&&await r.commitTransaction(),s}catch(o){if(i)try{await r.rollbackTransaction()}catch{}throw o}}cache(e,n){return typeof e=="boolean"?this.expressionMap.cache=e:typeof e=="number"?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):(typeof e=="string"||typeof e=="number")&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),n&&(this.expressionMap.cacheDuration=n),this}setOption(e){return this.expressionMap.options.push(e),this}join(e,n,r,i,o,s,a,c){o&&this.setParameters(o);const l=new _p(this.connection,this.expressionMap);l.direction=e,l.mapAsEntity=c,l.mapToProperty=s,l.isMappingMany=a,l.entityOrProperty=n,l.condition=i,this.expressionMap.joinAttributes.push(l);const u=l.metadata;if(u){if(u.deleteDateColumn&&!this.expressionMap.withDeleted){const d=`${r}.${u.deleteDateColumn.propertyName} IS NULL`;l.condition=l.condition?` ${l.condition} AND ${d}`:`${d}`}l.alias=this.expressionMap.createAlias({type:"join",name:r,metadata:u}),l.relation&&l.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:l.junctionAlias,metadata:l.relation.junctionEntityMetadata})}else{let d="";if(typeof n=="function"){const p=n(this.subQuery());this.setParameters(p.getParameters()),d=p.getQuery()}else d=n;const h=typeof n=="function"||n.substr(0,1)==="("&&n.substr(-1)===")";l.alias=this.expressionMap.createAlias({type:"join",name:r,tablePath:h===!1?n:void 0,subQuery:h===!0?d:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new Y("Cannot build query because main alias is not set (call qb#from method)");const e=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){const a=this.expressionMap.mainAlias.metadata;e.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,a)),n.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,a))}this.expressionMap.joinAttributes.forEach(a=>{if(a.metadata)e.push(...this.buildEscapedEntityColumnSelects(a.alias.name,a.metadata)),n.push(...this.findEntityColumnSelects(a.alias.name,a.metadata));else if(this.expressionMap.selects.some(c=>c.selection===a.alias.name)){e.push({selection:this.escape(a.alias.name)+".*"});const c=this.expressionMap.selects.find(l=>l.selection===a.alias.name);n.push(c)}}),this.expressionMap.selects.filter(a=>n.indexOf(a)===-1).forEach(a=>e.push({selection:this.replacePropertyNames(a.selection),aliasName:a.aliasName})),e.length===0&&e.push({selection:"*"});let r="";this.expressionMap.useIndex&&Q.isMySQLFamily(this.connection.driver)&&(r=` USE INDEX (${this.expressionMap.useIndex})`);const i=this.expressionMap.aliases.filter(a=>a.type==="from"&&(a.tablePath||a.subQuery)).map(a=>a.subQuery?a.subQuery+" "+this.escape(a.name):this.getTableName(a.tablePath)+" "+this.escape(a.name)),o=this.createSelectDistinctExpression(),s=e.map(a=>a.selection+(a.aliasName?" AS "+this.escape(a.aliasName):"")).join(", ");return o+s+" FROM "+i.join(", ")+this.createTableLockExpression()+r}createSelectDistinctExpression(){const{selectDistinct:e,selectDistinctOn:n,maxExecutionTime:r}=this.expressionMap,{driver:i}=this.connection;let o="SELECT ";return r>0&&Q.isMySQLFamily(i)&&(o+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),Q.isPostgresFamily(i)&&n.length>0?o=`SELECT DISTINCT ON (${n.map(s=>this.replacePropertyNames(s)).join(", ")}) `:e&&(o="SELECT DISTINCT "),o}createJoinExpression(){return this.expressionMap.joinAttributes.map(e=>{const n=e.relation,r=e.tablePath,i=e.alias.name;let o=e.condition?" AND ("+e.condition+")":"";const s=e.parentAlias;if(!s||!n){const a=e.alias.subQuery?e.alias.subQuery:this.getTableName(r);return" "+e.direction+" JOIN "+a+" "+this.escape(i)+this.createTableLockExpression()+(e.condition?" ON "+this.replacePropertyNames(e.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){const a=n.joinColumns.map(c=>i+"."+c.referencedColumn.propertyPath+"="+s+"."+n.propertyPath+"."+c.referencedColumn.propertyPath).join(" AND ");return" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(a+o)}else if(n.isOneToMany||n.isOneToOneNotOwner){const a=n.inverseRelation.joinColumns.map(c=>(n.inverseEntityMetadata.tableType==="entity-child"&&n.inverseEntityMetadata.discriminatorColumn&&(o+=" AND "+i+"."+n.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+n.inverseEntityMetadata.discriminatorValue+"'"),i+"."+n.inverseRelation.propertyPath+"."+c.referencedColumn.propertyPath+"="+s+"."+c.referencedColumn.propertyPath)).join(" AND ");if(!a)throw new Y(`Relation ${n.entityMetadata.name}.${n.propertyName} does not have join columns.`);return" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(a+o)}else{const a=n.junctionEntityMetadata.tablePath,c=e.junctionAlias;let l="",u="";return n.isOwning?(l=n.joinColumns.map(d=>c+"."+d.propertyPath+"="+s+"."+d.referencedColumn.propertyPath).join(" AND "),u=n.inverseJoinColumns.map(d=>i+"."+d.referencedColumn.propertyPath+"="+c+"."+d.propertyPath).join(" AND ")):(l=n.inverseRelation.inverseJoinColumns.map(d=>c+"."+d.propertyPath+"="+s+"."+d.referencedColumn.propertyPath).join(" AND "),u=n.inverseRelation.joinColumns.map(d=>i+"."+d.referencedColumn.propertyPath+"="+c+"."+d.propertyPath).join(" AND "))," "+e.direction+" JOIN "+this.getTableName(a)+" "+this.escape(c)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(l)+" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(u+o)}}).join(" ")}createGroupByExpression(){return!this.expressionMap.groupBys||!this.expressionMap.groupBys.length?"":" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", "))}createOrderByExpression(){const e=this.expressionMap.allOrderBys;return Object.keys(e).length===0?"":" ORDER BY "+Object.keys(e).map(n=>{const r=typeof e[n]=="string"?e[n]:e[n].order+" "+e[n].nulls,i=this.expressionMap.selects.find(o=>o.selection===n);if(i&&!i.aliasName&&n.indexOf(".")!==-1){const o=n.split("."),s=o[0],a=o.slice(1).join("."),c=this.expressionMap.aliases.find(l=>l.name===s);if(c){const l=c.metadata.findColumnWithPropertyPath(a);if(l){const u=Q.buildAlias(this.connection.driver,void 0,s,l.databaseName);return this.escape(u)+" "+r}}}return this.replacePropertyNames(n)+" "+r}).join(", ")}createLimitOffsetExpression(){let e=this.expressionMap.offset,n=this.expressionMap.limit;if(!e&&!n&&this.expressionMap.joinAttributes.length===0&&(e=this.expressionMap.skip,n=this.expressionMap.take),this.connection.driver.options.type==="mssql"){let r="";if((n||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(r=" ORDER BY (SELECT NULL)"),n&&e)return r+" OFFSET "+e+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return r+" OFFSET 0 ROWS FETCH NEXT "+n+" ROWS ONLY";if(e)return r+" OFFSET "+e+" ROWS"}else if(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)throw new t_}else if(Q.isSQLiteFamily(this.connection.driver)){if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver.options.type==="oracle"){if(n&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return" FETCH NEXT "+n+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)return" OFFSET "+e}return""}createTableLockExpression(){if(this.connection.driver.options.type==="mssql")switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const e=this.connection.driver;let n="";if(this.expressionMap.lockTables){if(!(Q.isPostgresFamily(e)||e.options.type==="cockroachdb"))throw new Y("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new Y("lockTables cannot be an empty array");n=" OF "+this.expressionMap.lockTables.join(", ")}let r="";switch(this.expressionMap.onLocked==="nowait"?r=" NOWAIT":this.expressionMap.onLocked==="skip_locked"&&(r=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if(e.options.type==="mysql"||e.options.type==="aurora-mysql")return Q.isReleaseVersionOrGreater(e,"8.0.0")?" FOR SHARE"+n+r:" LOCK IN SHARE MODE";if(e.options.type==="mariadb")return" LOCK IN SHARE MODE";if(Q.isPostgresFamily(e))return" FOR SHARE"+n+r;if(e.options.type==="oracle")return" FOR UPDATE";if(e.options.type==="mssql")return"";throw new Xt;case"pessimistic_write":if(Q.isMySQLFamily(e)||e.options.type==="aurora-mysql"||e.options.type==="oracle")return" FOR UPDATE"+r;if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+n+r;if(e.options.type==="mssql")return"";throw new Xt;case"pessimistic_partial_write":if(Q.isPostgresFamily(e))return" FOR UPDATE"+n+" SKIP LOCKED";if(Q.isMySQLFamily(e))return" FOR UPDATE SKIP LOCKED";throw new Xt;case"pessimistic_write_or_fail":if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+n+" NOWAIT";if(Q.isMySQLFamily(e))return" FOR UPDATE NOWAIT";throw new Xt;case"for_no_key_update":if(Q.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR NO KEY UPDATE"+n+r;throw new Xt;case"for_key_share":if(Q.isPostgresFamily(e))return" FOR KEY SHARE"+n+r;throw new Xt;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const e=this.expressionMap.havings.map((n,r)=>{switch(n.type){case"and":return(r>0?"AND ":"")+this.replacePropertyNames(n.condition);case"or":return(r>0?"OR ":"")+this.replacePropertyNames(n.condition);default:return this.replacePropertyNames(n.condition)}}).join(" ");return e.length?" HAVING "+e:""}buildEscapedEntityColumnSelects(e,n){const r=this.expressionMap.selects.some(l=>l.selection===e),i=[];if(r&&i.push(...n.columns.filter(l=>l.isSelect===!0)),i.push(...n.columns.filter(l=>this.expressionMap.selects.some(u=>u.selection===e+"."+l.propertyPath))),i.length===0)return[];const o=this.expressionMap.queryEntity?n.primaryColumns.filter(l=>i.indexOf(l)===-1):[],s=[...i,...o],a=[],c=this.escape(e);return s.forEach(l=>{let u=c+"."+this.escape(l.databaseName);l.isVirtualProperty&&l.query&&(u=`(${l.query(c)})`),this.connection.driver.spatialTypes.indexOf(l.type)!==-1&&((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(u=`${this.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText"}(${u})`),Q.isPostgresFamily(this.connection.driver)&&(l.precision?u=`ST_AsGeoJSON(${u}, ${l.precision})::json`:u=`ST_AsGeoJSON(${u})::json`),this.connection.driver.options.type==="mssql"&&(u=`${u}.ToString()`));const d=this.expressionMap.selects.filter(h=>h.selection===e+"."+l.propertyPath);if(d.length)d.forEach(h=>{a.push({selection:u,aliasName:h.aliasName?h.aliasName:Q.buildAlias(this.connection.driver,void 0,e,l.databaseName),virtual:h.virtual})});else{if(l.isVirtualProperty)return;a.push({selection:u,aliasName:Q.buildAlias(this.connection.driver,void 0,e,l.databaseName),virtual:r})}}),a}findEntityColumnSelects(e,n){const r=this.expressionMap.selects.find(i=>i.selection===e);return r?[r]:this.expressionMap.selects.filter(i=>n.columns.some(o=>i.selection===e+"."+o.propertyPath))}computeCountExpression(){const e=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata.primaryColumns,r=this.escape(e);if(this.expressionMap.joinAttributes.length===0&&this.expressionMap.relationIdAttributes.length===0&&this.expressionMap.relationCountAttributes.length===0)return"COUNT(1)";if(this.connection.driver.options.type==="cockroachdb"||Q.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(", ")+"))";if(Q.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(", ")+")";if(this.connection.driver.options.type==="mssql"){const i=n.map(o=>`${r}.${this.escape(o.databaseName)}`).join(", '|;|', ");return n.length===1?`COUNT(DISTINCT(${i}))`:`COUNT(DISTINCT(CONCAT(${i})))`}return this.connection.driver.options.type==="spanner"?n.length===1?`COUNT(DISTINCT(${r}.${this.escape(n[0].databaseName)}))`:`COUNT(DISTINCT(CONCAT(${n.map(i=>`CAST(${r}.${this.escape(i.databaseName)} AS STRING)`).join(", '|;|', ")})))`:"COUNT(DISTINCT("+n.map(i=>`${r}.${this.escape(i.databaseName)}`).join(" || '|;|' || ")+"))"}async executeCountQuery(e){const n=this.computeCountExpression(),r=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(n,"cnt").setOption("disable-global-order").loadRawResults(e);return!r||!r[0]||!r[0].cnt?0:parseInt(r[0].cnt)}async executeExistsQuery(e){return(await this.connection.createQueryBuilder().fromDummy().select("1","row_exists").whereExists(this).limit(1).loadRawResults(e)).length>0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const e=Array.isArray(this.findOptions.select)?Pe.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(e,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const e=Array.isArray(this.findOptions.relations)?Pe.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.findOptions.loadEagerRelations!==!1&&this.expressionMap.relationLoadStrategy==="join"&&this.buildEagerRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere(this.conditions.substr(0,1)!=="("?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach(e=>{e.select&&!e.selection?e.type==="inner"?this.innerJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):e.type==="inner"?this.innerJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias)}),this.findOptions.skip!==void 0&&this.skip(this.findOptions.skip),this.findOptions.take!==void 0&&this.take(this.findOptions.take),typeof this.findOptions.cache=="number"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="boolean"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="object"&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach(e=>{this.leftJoin(this.findOptions.join.leftJoin[e],e)}),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach(e=>{this.innerJoin(this.findOptions.join.innerJoin[e],e)}),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach(e=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[e],e)}),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach(e=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[e],e)})),this.findOptions.lock){if(this.findOptions.lock.mode==="optimistic")this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if(this.findOptions.lock.mode==="pessimistic_read"||this.findOptions.lock.mode==="pessimistic_write"||this.findOptions.lock.mode==="dirty_read"||this.findOptions.lock.mode==="pessimistic_partial_write"||this.findOptions.lock.mode==="pessimistic_write_or_fail"||this.findOptions.lock.mode==="for_no_key_update"||this.findOptions.lock.mode==="for_key_share"){const e=this.findOptions.lock.tables?this.findOptions.lock.tables.map(n=>{const r=this.expressionMap.aliases.find(i=>i.metadata.tableNameWithoutPrefix===n);if(!r)throw new Y(`"${n}" is not part of this query`);return this.escape(r.name)}):void 0;this.setLock(this.findOptions.lock.mode,void 0,e),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}}this.findOptions.loadRelationIds===!0?this.loadAllRelationIds():typeof this.findOptions.loadRelationIds=="object"&&this.loadAllRelationIds(this.findOptions.loadRelationIds),this.findOptions.loadEagerRelations!==!1&&ss.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),this.findOptions.transaction===!0&&(this.expressionMap.useTransaction=!0)}}concatRelationMetadata(e){this.relationMetadatas.push(e)}async executeEntitiesAndRawResults(e){if(!this.expressionMap.mainAlias)throw new Y('Alias is not set. Use "from" method to set an alias.');if((this.expressionMap.lockMode==="pessimistic_read"||this.expressionMap.lockMode==="pessimistic_write"||this.expressionMap.lockMode==="pessimistic_partial_write"||this.expressionMap.lockMode==="pessimistic_write_or_fail"||this.expressionMap.lockMode==="for_no_key_update"||this.expressionMap.lockMode==="for_key_share")&&!e.isTransactionActive)throw new e_;if(this.expressionMap.lockMode==="optimistic"){const s=this.expressionMap.mainAlias.metadata;if(!s.versionColumn&&!s.updateDateColumn)throw new GC(s.name)}const n=new hS(this.connection,e,this.expressionMap.relationIdAttributes),r=new mS(this.connection,e,this.expressionMap.relationCountAttributes);new fS(this.expressionMap).transform(),new yS(this.expressionMap).transform();let i=[],o=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[s,a]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),c=this.expressionMap.mainAlias.metadata,l=this.expressionMap.mainAlias.name,u=c.primaryColumns.map(p=>{const f=this.escape("distinctAlias"),m=this.escape(Q.buildAlias(this.connection.driver,void 0,l,p.databaseName));a[m]||(a[m]="ASC");const y=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,p.databaseName);return`${f}.${m} AS ${this.escape(y)}`}),d=this.clone(),h=d.expressionMap.timeTravel;if(i=await new as(this.connection,e).select(`DISTINCT ${u.join(", ")}`).addSelect(s).from(`(${d.orderBy().timeTravelQuery(!1).getQuery()})`,"distinctAlias").timeTravelQuery(h).offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(a).cache(this.expressionMap.cache&&this.expressionMap.cacheId?`${this.expressionMap.cacheId}-pagination`:this.expressionMap.cache,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),i.length>0){let p="";const f={};if(c.hasMultiplePrimaryKeys)p=i.map((m,y)=>c.primaryColumns.map(g=>{const b=`orm_distinct_ids_${y}_${g.databaseName}`,x=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,g.databaseName);return f[b]=m[x],`${l}.${g.propertyPath}=:${b}`}).join(" AND ")).join(" OR ");else{const m=Q.buildAlias(this.connection.driver,void 0,"ids_"+l,c.primaryColumns[0].databaseName),y=i.map(g=>g[m]);y.every(g=>typeof g=="number")?p=`${l}.${c.primaryColumns[0].propertyPath} IN (${y.join(", ")})`:(f.orm_distinct_ids=y,p=l+"."+c.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}i=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:p}).setParameters(f).loadRawResults(e)}}else i=await this.loadRawResults(e);if(i.length>0){const s=await n.load(i),a=await r.load(i);o=new dS(this.expressionMap,this.connection.driver,s,a,this.queryRunner).transform(i,this.expressionMap.mainAlias),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,o)}if(this.expressionMap.relationLoadStrategy==="query"){const s=new pS(this.connection,e);await Promise.all(this.relationMetadatas.map(async a=>{const c=a.inverseEntityMetadata.target,l=a.inverseEntityMetadata.targetName,u=Array.isArray(this.findOptions.select)?Pe.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,d=Array.isArray(this.findOptions.relations)?Pe.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,h=this.createQueryBuilder(e).select(l).from(c,l).setFindOptions({select:u?Pe.deepValue(u,a.propertyPath):void 0,order:this.findOptions.order?Pe.deepValue(this.findOptions.order,a.propertyPath):void 0,relations:d?Pe.deepValue(d,a.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(o.length>0){const p=await s.loadManyToManyRelationIdsAndGroup(a,o,void 0,h);o.forEach(f=>{const m=p.find(y=>y.entity===f);if(m){const y=m.related===void 0?null:m.related;a.setEntityValue(f,y)}})}}))}return{raw:i,entities:o}}createOrderByCombinedWithSelectExpression(e){const n=this.expressionMap.allOrderBys,r=Object.keys(n).map(o=>{if(o.indexOf(".")!==-1){const s=o.split("."),a=s[0],c=s.slice(1).join("."),l=this.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyPath(c);return this.escape(e)+"."+this.escape(Q.buildAlias(this.connection.driver,void 0,a,l.databaseName))}else return this.expressionMap.selects.find(s=>s.selection===o||s.aliasName===o)?this.escape(e)+"."+this.escape(o):""}).join(", "),i={};return Object.keys(n).forEach(o=>{if(o.indexOf(".")!==-1){const s=o.split("."),a=s[0],c=s.slice(1).join("."),l=this.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyPath(c);i[this.escape(e)+"."+this.escape(Q.buildAlias(this.connection.driver,void 0,a,l.databaseName))]=n[o]}else this.expressionMap.selects.find(s=>s.selection===o||s.aliasName===o)?i[this.escape(e)+"."+this.escape(o)]=n[o]:i[o]=n[o]}),[r,i]}async loadRawResults(e){const[n,r]=this.getQueryAndParameters(),i=n+" -- PARAMETERS: "+JSON.stringify(r,(u,d)=>typeof d=="bigint"?d.toString():d),o=typeof this.connection.options.cache=="object"?this.connection.options.cache:{};let s;const a=o.alwaysEnabled&&this.expressionMap.cache!==!1||this.expressionMap.cache===!0;let c=!1;if(this.connection.queryResultCache&&a)try{if(s=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:i,duration:this.expressionMap.cacheDuration||o.duration||1e3},e),s&&!this.connection.queryResultCache.isExpired(s))return JSON.parse(s.result)}catch(u){if(!o.ignoreErrors)throw u;c=!0}const l=await e.query(n,r,!0);if(!c&&this.connection.queryResultCache&&a)try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:i,time:new Date().getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(l.records)},s,e)}catch(u){if(!o.ignoreErrors)throw u}return l.records}mergeExpressionMap(e){return Ee.assign(this.expressionMap,e),this}normalizeNumber(e){return typeof e=="number"||e===void 0||e===null?e:Number(e)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner(this.connection.defaultReplicationModeForReads())}buildSelect(e,n,r,i){for(let o in e){if(e[o]===void 0||e[o]===!1)continue;const s=i?i+"."+o:o,a=n.findColumnWithPropertyPathStrict(s),c=n.findEmbeddedWithPropertyPath(s),l=n.findRelationWithPropertyPath(s);if(!c&&!a&&!l)throw new Ue(s,n);a?this.selects.push(r+"."+s):c&&this.buildSelect(e[o],n,r,s)}}buildRelations(e,n,r,i,o){e&&Object.keys(e).forEach(s=>{const a=e[s],c=o?o+"."+s:s,l=r.findEmbeddedWithPropertyPath(c),u=r.findRelationWithPropertyPath(c);if(!l&&!u)throw new Ue(c,r);if(l)this.buildRelations(a,typeof n=="object"?Pe.deepValue(n,l.propertyPath):void 0,r,i,c);else if(u){let d=i+"_"+c.replace(".","_");d=Q.buildAlias(this.connection.driver,{joiner:"__"},i,d),(a===!0||typeof a=="object")&&(this.expressionMap.relationLoadStrategy==="query"?this.concatRelationMetadata(u):(this.joins.push({type:"left",select:!0,selection:n&&typeof n[s]=="object"?n[s]:void 0,alias:d,parentAlias:i,relationMetadata:u}),n&&typeof n[s]=="object"&&this.buildSelect(n[s],u.inverseEntityMetadata,d))),typeof a=="object"&&this.expressionMap.relationLoadStrategy==="join"&&this.buildRelations(a,typeof n=="object"?Pe.deepValue(n,u.propertyPath):void 0,u.inverseEntityMetadata,d,void 0)}})}buildEagerRelations(e,n,r,i,o){e&&Object.keys(e).forEach(s=>{const a=e[s],c=o?o+"."+s:s,l=r.findEmbeddedWithPropertyPath(c),u=r.findRelationWithPropertyPath(c);if(!l&&!u)throw new Ue(c,r);if(l)this.buildEagerRelations(a,typeof n=="object"?Pe.deepValue(n,l.propertyPath):void 0,r,i,c);else if(u){let d=i+"_"+c.replace(".","_");d=Q.buildAlias(this.connection.driver,{joiner:"__"},i,d),(a===!0||typeof a=="object")&&u.inverseEntityMetadata.eagerRelations.forEach(h=>{let p=d+"_"+h.propertyPath.replace(".","_");p=Q.buildAlias(this.connection.driver,{joiner:"__"},d,p),this.joins.find(f=>f.alias===p)||this.joins.push({type:"left",select:!0,alias:p,parentAlias:d,selection:void 0,relationMetadata:h}),n&&typeof n[s]=="object"&&this.buildSelect(n[s],u.inverseEntityMetadata,d)}),typeof a=="object"&&this.buildEagerRelations(a,typeof n=="object"?Pe.deepValue(n,u.propertyPath):void 0,u.inverseEntityMetadata,d,void 0)}})}buildOrder(e,n,r,i){for(let o in e){if(e[o]===void 0)continue;const s=i?i+"."+o:o,a=n.findColumnWithPropertyPathStrict(s),c=n.findEmbeddedWithPropertyPath(s),l=n.findRelationWithPropertyPath(s);if(!c&&!a&&!l)throw new Ue(s,n);if(a){let u=typeof e[o]=="object"?e[o].direction:e[o];u=u==="DESC"||u==="desc"||u===-1?"DESC":"ASC";let d=typeof e[o]=="object"?e[o].nulls:void 0;d=(d==null?void 0:d.toLowerCase())==="first"?"NULLS FIRST":(d==null?void 0:d.toLowerCase())==="last"?"NULLS LAST":void 0;let h=`${r}.${s}`;this.addOrderBy(h,u,d)}else if(c)this.buildOrder(e[o],n,r,s);else if(l){let u=r+"_"+s.replace(".","_");u=Q.buildAlias(this.connection.driver,{joiner:"__"},r,u),this.joins.find(d=>d.alias===u)||this.joins.push({type:"left",select:!1,alias:u,parentAlias:r,selection:void 0,relationMetadata:l}),this.buildOrder(e[o],l.inverseEntityMetadata,u)}}}buildWhere(e,n,r,i){let o="";if(Array.isArray(e))e.length&&(o=e.map(s=>this.buildWhere(s,n,r,i)).filter(s=>!!s).map(s=>"("+s+")").join(" OR "));else{let s=[];for(let a in e){if(e[a]===void 0||e[a]===null)continue;const c=i?i+"."+a:a,l=n.findColumnWithPropertyPathStrict(c),u=n.findEmbeddedWithPropertyPath(c),d=n.findRelationWithPropertyPath(c);if(!u&&!l&&!d)throw new Ue(c,n);if(l){let h=`${r}.${c}`;l.isVirtualProperty&&l.query&&(h=`(${l.query(r)})`);let p=e[a];fe.isEqualOperator(e[a])&&(p=e[a].value),l.transformer&&(p instanceof zn?p.transformValue(l.transformer):p=is.transformTo(l.transformer,p)),s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(h,p)))}else if(u){const h=this.buildWhere(e[a],n,r,c);h&&s.push(h)}else if(d){if(typeof e[a]=="object"&&Object.keys(e[a]).every(h=>e[a][h]===void 0))continue;if(fe.isFindOperator(e[a]))if(e[a].type==="moreThan"||e[a].type==="lessThan"||e[a].type==="moreThanOrEqual"||e[a].type==="lessThanOrEqual"){let h="";e[a].type==="moreThan"?h=">":e[a].type==="lessThan"?h="<":e[a].type==="moreThanOrEqual"?h=">=":e[a].type==="lessThanOrEqual"&&(h="<=");const p=this.subQuery();if(d.isManyToManyOwner)p.select("COUNT(*)").from(d.joinTableName,d.joinTableName).where(d.joinColumns.map(f=>`${d.joinTableName}.${f.propertyName} = ${r}.${f.referencedColumn.propertyName}`).join(" AND "));else if(d.isManyToManyNotOwner)p.select("COUNT(*)").from(d.inverseRelation.joinTableName,d.inverseRelation.joinTableName).where(d.inverseRelation.inverseJoinColumns.map(f=>`${d.inverseRelation.joinTableName}.${f.propertyName} = ${r}.${f.referencedColumn.propertyName}`).join(" AND "));else if(d.isOneToMany)p.select("COUNT(*)").from(d.inverseEntityMetadata.target,d.inverseEntityMetadata.tableName).where(d.inverseRelation.joinColumns.map(f=>`${d.inverseEntityMetadata.tableName}.${f.propertyName} = ${r}.${f.referencedColumn.propertyName}`).join(" AND "));else throw new Error("This relation isn't supported by given find operator");this.andWhere(p.getSql()+" "+h+" "+parseInt(e[a].value))}else if(d.isManyToOne||d.isOneToOne&&d.isOneToOneOwner){const h=`${r}.${c}`;s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(h,e[a])))}else throw new Error("This relation isn't supported by given find operator");else{let h=r+"_"+d.propertyPath.replace(".","_");h=Q.buildAlias(this.connection.driver,{joiner:"__"},r,h),this.joins.find(f=>f.alias===h)||this.joins.push({type:"left",select:!1,selection:void 0,alias:h,parentAlias:r,relationMetadata:d});const p=this.buildWhere(e[a],d.inverseEntityMetadata,h);p&&s.push(p)}}}o=s.length?"("+s.join(") AND (")+")":s.join(" AND ")}return o.length?"("+o+")":o}}class kp{constructor(){this.generatedMaps=[]}static from(e){const n=new this;return n.raw=e.records,n.affected=e.affected,n}}class gS extends ve{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createUpdateExpression();return e+=this.createCteExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const r=new os(e,this.expressionMap);this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=r.getSoftDeletionReturningColumns());const[i,o]=this.getQueryAndParameters(),s=await e.query(i,o,!0),a=kp.from(s);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await r.update(a,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),n&&await e.commitTransaction(),a}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}from(e,n){e=fe.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new Jr;return this.expressionMap.returning=e,this}orderBy(e,n="ASC",r){return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new Y(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(e)?e:[e];return n.forEach(r=>{const i=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!i)throw new Y("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(i)}),this.expressionMap.whereEntities=n,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new Y(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!e.deleteDateColumn)throw new XC(e);const n=[];switch(this.expressionMap.queryType){case"soft-delete":n.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":n.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new Y('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&n.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&n.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),n.length<=0)throw new Ko;const r=this.createWhereExpression(),i=this.createReturningExpression("update");return i===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")} OUTPUT ${i}${r}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r} RETURNING ${i}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(n=>typeof e[n]=="string"?this.replacePropertyNames(n)+" "+e[n]:this.replacePropertyNames(n)+" "+e[n].order+" "+e[n].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(Q.isMySQLFamily(this.connection.driver))return" LIMIT "+e;throw new lp}return""}}class xS extends ve{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let r=null,i=null;const o=new os(e,this.expressionMap),s=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const h of this.expressionMap.returning)s.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(h));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=o.getUpdationReturningColumns(),s.push(...this.expressionMap.extraReturningColumns.filter(h=>!s.includes(h)))),s.length>0&&this.connection.driver.options.type==="mssql"&&(r=this.connection.driver.buildTableVariableDeclaration("@OutputTable",s),i="SELECT * FROM @OutputTable");const[a,c]=this.getQueryAndParameters(),l=[r,a,i],u=await e.query(l.filter(h=>h!=null).join(`;

`),c,!0),d=kp.from(u);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await o.update(d,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),n&&await e.commitTransaction(),d}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}set(e){return this.expressionMap.valuesSet=e,this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new Jr;return this.expressionMap.returning=e,this}orderBy(e,n="ASC",r){return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new Y(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(e)?e:[e];return n.forEach(r=>{const i=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!i)throw new Y("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(i)}),this.expressionMap.whereEntities=n,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r={};for(let c in e)e[c]!==void 0&&(r[c]=e[c]);const i=[],o=[];if(n?(this.createPropertyPath(n,r).forEach(c=>{const l=n.findColumnsWithPropertyPath(c);if(l.length<=0)throw new Ue(c,n);l.forEach(u=>{if(!u.isUpdate||o.includes(u))return;o.push(u);let d=u.getEntityValue(r);if(u.referencedColumn&&typeof d=="object"&&!(d instanceof Date)&&d!==null&&!cf.isBuffer(d)?d=u.referencedColumn.getEntityValue(d):typeof d!="function"&&(d=this.connection.driver.preparePersistentValue(d,u)),typeof d=="function")i.push(this.escape(u.databaseName)+" = "+d());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&d===null)i.push(this.escape(u.databaseName)+" = NULL");else{this.connection.driver.options.type==="mssql"&&(d=this.connection.driver.parametrizeValue(u,d));const h=this.createParameter(d);let p=null;if((Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1){const f=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";u.srid!=null?p=`${f}(${h}, ${u.srid})`:p=`${f}(${h})`}else Q.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1?u.srid!=null?p=`ST_SetSRID(ST_GeomFromGeoJSON(${h}), ${u.srid})::${u.type}`:p=`ST_GeomFromGeoJSON(${h})::${u.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1?p=u.type+"::STGeomFromText("+h+", "+(u.srid||"0")+")":p=h;i.push(this.escape(u.databaseName)+" = "+p)}})}),(i.length>0||Object.keys(r).length===0)&&(n.versionColumn&&o.indexOf(n.versionColumn)===-1&&i.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&o.indexOf(n.updateDateColumn)===-1&&i.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(r).map(c=>{let l=r[c];if(typeof l=="function")i.push(this.escape(c)+" = "+l());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&l===null)i.push(this.escape(c)+" = NULL");else{const u=this.createParameter(l);i.push(this.escape(c)+" = "+u)}}),i.length<=0)throw new Ko;const s=this.createWhereExpression(),a=this.createReturningExpression("update");return a===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")}${s}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")} OUTPUT ${a}${s}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")}${s} RETURNING ${a}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(n=>typeof e[n]=="string"?this.replacePropertyNames(n)+" "+e[n]:this.replacePropertyNames(n)+" "+e[n].order+" "+e[n].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(Q.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")return" LIMIT "+e;throw new lp}return""}getValueSet(){if(typeof this.expressionMap.valuesSet=="object")return this.expressionMap.valuesSet;throw new Ko}}function vS(){ve.registerQueryBuilderClass("DeleteQueryBuilder",t=>new nS(t)),ve.registerQueryBuilderClass("InsertQueryBuilder",t=>new cS(t)),ve.registerQueryBuilderClass("RelationQueryBuilder",t=>new uS(t)),ve.registerQueryBuilderClass("SelectQueryBuilder",t=>new as(t)),ve.registerQueryBuilderClass("SoftDeleteQueryBuilder",t=>new gS(t)),ve.registerQueryBuilderClass("UpdateQueryBuilder",t=>new xS(t))}var Tp;(function(t){t.VIEW="VIEW",t.MATERIALIZED_VIEW="MATERIALIZED_VIEW",t.GENERATED_COLUMN="GENERATED_COLUMN"})(Tp||(Tp={}));var jp={exports:{}},cs,Rp;function bS(){if(Rp)return cs;Rp=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,o=r*365.25;cs=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return s(u);if(h==="number"&&isFinite(u))return d.long?c(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function s(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),p=(d[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*o;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*n;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=n?Math.round(u/n)+"h":d>=e?Math.round(u/e)+"m":d>=t?Math.round(u/t)+"s":u+"ms"}function c(u){var d=Math.abs(u);return d>=r?l(u,d,r,"day"):d>=n?l(u,d,n,"hour"):d>=e?l(u,d,e,"minute"):d>=t?l(u,d,t,"second"):u+" ms"}function l(u,d,h,p){var f=d>=h*1.5;return Math.round(u/h)+" "+p+(f?"s":"")}return cs}function wS(t){n.debug=n,n.default=n,n.coerce=c,n.disable=o,n.enable=i,n.enabled=s,n.humanize=bS(),n.destroy=l,Object.keys(t).forEach(u=>{n[u]=t[u]}),n.names=[],n.skips=[],n.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return n.colors[Math.abs(d)%n.colors.length]}n.selectColor=e;function n(u){let d,h=null,p,f;function m(...y){if(!m.enabled)return;const g=m,b=Number(new Date),x=b-(d||b);g.diff=x,g.prev=d,g.curr=b,d=b,y[0]=n.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let v=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(C,T)=>{if(C==="%%")return"%";v++;const S=n.formatters[T];if(typeof S=="function"){const j=y[v];C=S.call(g,j),y.splice(v,1),v--}return C}),n.formatArgs.call(g,y),(g.log||n.log).apply(g,y)}return m.namespace=u,m.useColors=n.useColors(),m.color=n.selectColor(u),m.extend=r,m.destroy=n.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==n.namespaces&&(p=n.namespaces,f=n.enabled(u)),f),set:y=>{h=y}}),typeof n.init=="function"&&n.init(m),m}function r(u,d){const h=n(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){n.save(u),n.namespaces=u,n.names=[],n.skips=[];let d;const h=(typeof u=="string"?u:"").split(/[\s,]+/),p=h.length;for(d=0;d<p;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?n.skips.push(new RegExp("^"+u.slice(1)+"$")):n.names.push(new RegExp("^"+u+"$")))}function o(){const u=[...n.names.map(a),...n.skips.map(a).map(d=>"-"+d)].join(",");return n.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=n.skips.length;d<h;d++)if(n.skips[d].test(u))return!1;for(d=0,h=n.names.length;d<h;d++)if(n.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var MS=wS;(function(t,e){var n={};e.formatArgs=i,e.save=o,e.load=s,e.useColors=r,e.storage=a(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let d=0,h=0;l[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(d++,p==="%c"&&(h=d))}),l.splice(h,0,u)}e.log=console.debug||console.log||(()=>{});function o(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof lf<"u"&&"env"in lf&&(l=n.DEBUG),l}function a(){try{return localStorage}catch{}}t.exports=MS(e);const{formatters:c}=t.exports;c.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(jp,jp.exports),vS();let ls,Ip,us,ii,oi,si,Vn,$p,Bp,Lp,Dp,Fp,zp,Vp,qp,Wp,Hp,Up,Qp,Zp,Yp,Xp;ls=(t,e)=>({id:t.id,type:t.node_type,position:{x:t.x||0,y:t.y||0},width:t.width||void 0,height:t.height||void 0,data:{loading:!1,flowNode:t,...e}}),Ip=t=>({id:t.id,target:t.target,source:t.target,targetHandle:t.targetHandle,sourceHandle:t.sourceHandle}),us=t=>({id:t.id,source:t.source,target:t.target,targetHandle:t.targetHandle,sourceHandle:t.sourceHandle}),Nf=t=>t.filter(e=>"edgeId"in e?`${e.edgeId}`.startsWith("xy-edge__"):!1),ii=(t,e,n)=>{const r=[];return{changes:t.map(i=>{var c;const o=e.find(l=>i.id===l.id);o||r.push(i.id);const s=(c=n==null?void 0:n[i.source_type])==null?void 0:c.find(l=>(l==null?void 0:l.id)===i.source_id),a=ls(i,{...o==null?void 0:o.data,entity:s});return{type:o?"replace":"add",id:i.id,item:o?Jn({...o||{},data:void 0},tr(a,nr)):a}}),newIds:[]}},oi=(t,e)=>{const n=[],r=[],i=t.map(o=>{const s=e.find(a=>o.source===a.source&&o.target===a.target);return!s||s.id!==o.id?(s&&r.push(s.id),{type:"add",item:us(o)}):(n.push(o.id),{type:"replace",item:us(o)})});return e.forEach(o=>{n.includes(o.id)||r.push(o.id)}),{changes:i,updatedIds:n,deletedIds:r}},si={width:440,height:360},Vn={width:380,height:650},dn={[Ne.Toolbox]:"toolbox",[Ne.SessionInfo]:"session-info",[Ne.DefaultEmbeddingModel]:"default-embedding-model",[Ne.ApplicationBar]:"application-bar"},$p={id:dn[Ne.Toolbox],type:Ne.Toolbox,position:{x:10+Vn.width+20,y:10},measured:si,data:{}},Bp={id:dn[Ne.SessionInfo],type:Ne.SessionInfo,position:{x:10,y:10},measured:Vn,data:{}},Lp={id:dn[Ne.DefaultEmbeddingModel],type:Ne.DefaultEmbeddingModel,position:{x:10+Vn.width+si.width+40,y:10},data:{model:AO}},Dp={id:dn[Ne.ApplicationBar],type:Ne.ApplicationBar,position:{x:10+Vn.width+si.width+40,y:80},data:{}},Fp=[$p,Bp,Lp,Dp],vf=[Ne.Toolbox,Ne.SessionInfo,Ne.ApplicationBar,Ne.EditorApp,Ne.CodeContainerApp],Qs={flowNodes:[],flowEdges:[],ready:!0,flowEdgeLoading:!1,flowNodeLoading:!1,syncedNodes:[],syncedEdges:[],syncNodeQueue:[],syncEdgeQueue:[],edges:[],nodes:Fp},Ds=async t=>{const e=await _e("FlowNode").find(t),n=e.reduce((i,o)=>{var s;return i[o.source_type]||(i[o.source_type]=[]),(s=i[o.source_type])==null||s.push(o),i},{}),r={};return await Promise.all(Object.entries(n).map(async([i,o])=>{const s=i;r[s]=await _e(s).find({where:{id:li(o.map(a=>a.source_id))}})})),{flowNodes:e,entityGroups:n,flowNodeDatas:r}},Cf=(t,e)=>({reset:()=>{t(Qs)},setNodes:n=>{if(typeof n=="function"){t({nodes:n(e().nodes)});return}t({nodes:n})},setEdges:n=>{if(typeof n=="function"){t({edges:n(e().edges)});return}t({edges:n})},updateNodes:n=>{const r=e().nodes;t({nodes:dt(n,r)})},updateEdges:n=>{const r=e().edges;t({edges:kn(n,r)})},addConnectionToEdges:n=>{const r=e().edges;t({edges:mc(n,r)})},flowNodesToNodes:(n,r={})=>{const i=e().nodes,{changes:o}=ii(n,i,r);t({nodes:dt(o,i)})},flowEdgesToEdges:n=>{const r=e().edges,{changes:i,updatedIds:o,deletedIds:s}=oi(n,r);r.forEach(a=>{o.includes(a.id)||s.push(a.id)}),s.forEach(a=>{i.push({type:"remove",id:a})}),t({edges:kn(i,r)})},getNodes:n=>e().nodes.filter(r=>n.includes(r.id)),removeSyncNodeQueue:n=>{const{syncNodeQueue:r}=e();for(const i of n){const o=r.findIndex(s=>s.timestamp===i);o>-1&&r.splice(o,1)}t({syncNodeQueue:r})},removeSyncEdgeQueue:n=>{const{syncEdgeQueue:r}=e();for(const i of n){const o=r.findIndex(s=>s.timestamp===i);o>-1&&r.splice(o,1)}t({syncEdgeQueue:r})},pushSyncNodeQueue:(n,r)=>{const{syncNodeQueue:i}=e();t({syncNodeQueue:[...i,{query:r,timestamp:Date.now(),syncType:n}]})},pushSyncEdgeQueue:()=>{const{syncEdgeQueue:n}=e();t({syncEdgeQueue:[...n,{timestamp:Date.now()}]})},findFlowNodesWithSource:async(n,r)=>{try{t({flowNodeLoading:!0});const{flowNodes:i,flowNodeDatas:o}=await Ds(n);if(r!=null&&r.clean)t({flowNodes:i,nodes:i.map(s=>{var c;const a=(c=o==null?void 0:o[s.source_type])==null?void 0:c.find(l=>l.id===s.source_id);return ls(s,{data:a})})});else{const s=e().flowNodes,a=i.map(u=>u.id),c=e().nodes,{changes:l}=ii(i,c,o);t({flowNodes:[...s.filter(u=>!a.includes(u.id)),...i],nodes:dt(l,c)})}return i}finally{t({flowNodeLoading:!1})}},findFlowEdges:async(n,r)=>{try{t({flowEdgeLoading:!0});const i=await _e("FlowEdge").find(n),o=e().flowEdges,s=i.map(a=>a.id);if(r!=null&&r.clean)t({flowEdges:i,edges:i.map(a=>Ip(a))});else{const a=e().edges,{changes:c}=oi(i,a);t({flowEdges:[...o.filter(l=>!s.includes(l.id)),...i],edges:kn(c,a)})}return i}finally{t({flowEdgeLoading:!1})}},deleteFlowNode:async n=>{try{if(!n.id&&!n.source_type&&!n.source_id)throw new Error("Missing flow node indentify");const r=await _e("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}});if(r){await _e("FlowNode").delete(r.id);const i=e().flowNodes;r.source_type&&r.source_id&&await _e(r.source_type).delete(r.source_id).catch(s=>{St("Failed to delete source entity",r.source_type,r.source_id,s)});const o=e().nodes;t({flowNodes:i.filter(s=>s.id!==r.id),nodes:dt([{type:"remove",id:r.id}],o)})}}catch(r){St("Failed to delete flow node",r)}},deleteFlowEdge:async n=>{try{if(!n.id&&!n.source&&!n.target)throw new Error("Missing flow edge indentify");const r=await _e("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}});if(r){await _e("FlowEdge").delete(r.id);const i=e().flowEdges;t({flowEdges:i.filter(o=>o.id!==r.id)})}}catch(r){St("Failed to delete flow edge",r)}},updateFlowNode:async(n,r)=>{var i;try{if(!((i=gs.getState().currentSession)!=null&&i.id))throw new Error("Session not found");if(!n.id)throw new Error("Missing flow node indentify");await _e("FlowNode").update(n.id,n);const o=e().flowNodes.map(s=>s.id===n.id?{...s,...n}:s);t({flowNodes:r!=null&&r.silent?o:[...o]})}catch(o){St("Failed to create or update flow node",o,n)}},createOrUpdateFlowNode:async(n,r)=>{var i;try{const o=gs.getState().currentSession;if(!(o!=null&&o.id))throw new Error("Session not found");if(!n.id&&(!n.source_type||!n.source_id))throw new Error("Missing flow node indentify");let s,a=n!=null&&n.id?e().flowNodes.find(p=>p.id===n.id):void 0;if(!a&&(n.id||n.source_type&&n.source_id)&&(a=await _e("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}})),a)s=Jn(a,tr(n,nr)),r!=null&&r.lazy?_e("FlowNode").update(a.id,s):await _e("FlowNode").update(a.id,s);else if(n.source_id&&n.source_type)s={...n,source_id:`${n.source_id}`,source_type:`${n.source_type}`,node_type:n.node_type||"NEW_MESSAGE",session_id:n.session_id||(o==null?void 0:o.id)},r!=null&&r.lazy?(s.id=uf(),_e("FlowNode").save(s)):s=await _e("FlowNode").save(s);else throw new Error("Missing source id and type");let c;const l=e().nodes.find(p=>p.id===s.id);s.source_type&&!l?c=await _e(s.source_type).findOne({where:{id:n.source_id}}):s.source_type&&l&&(c=(i=l==null?void 0:l.data)==null?void 0:i.entity);const u=e().flowNodes,d=e().nodes,{changes:h}=ii([s],d,{[s.source_type]:[c]});return t({flowNodes:[...u.filter(p=>p.id!==s.id),s],nodes:dt(h,d)}),s}catch(o){St("Failed to create or update flow node",o,n)}},createOrUpdateFlowEdge:async(n,r)=>{try{const i=gs.getState().currentSession;if(!(i!=null&&i.id))throw new Error("Session not found");if(!n.id&&(!n.source||!n.target))throw new Error("Missing flow node indentify");let o,s=n!=null&&n.id?e().flowEdges.find(l=>l.id===n.id):void 0;if(s&&(n.id||n.source&&n.target)&&(s=await _e("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}})),s)o=Jn(s,tr(n,nr)),r!=null&&r.lazy?_e("FlowEdge").update(s.id,o):await _e("FlowEdge").update(s.id,o);else if(n.source&&n.target)o={...n,source:`${n.source}`,target:`${n.target}`,session_id:n.session_id||(i==null?void 0:i.id)},r!=null&&r.lazy?(o.id=uf(),_e("FlowEdge").save(o)):o=await _e("FlowEdge").save(o);else throw new Error("Missing source and target");const a=e().flowEdges,c=e().edges;return t({flowEdges:[...a.filter(l=>l.id!==o.id),o],edges:kn(oi([o],c).changes,c)}),o}catch(i){St("Failed to create or update flow node",i)}}}),zp=t=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"none",height:192,viewBox:"0 0 150 150",width:192,...t},M.createElement("clipPath",{id:"a"},M.createElement("path",{d:"m0 0h150v150h-150z"})),M.createElement("g",{clipPath:"url(#a)"},M.createElement("path",{d:"m150 0h-150v150h150z",fill:"#29b5e8"}),M.createElement("path",{clipRule:"evenodd",d:"m130.375 67.2532-14.096 8.1221 14.096 8.0536c.843.4872 1.581 1.1357 2.174 1.9084.592.7727 1.026 1.6545 1.278 2.5951.251.9406.315 1.9215.188 2.8867-.128.9652-.444 1.8959-.931 2.7388-.488.843-1.136 1.5817-1.909 2.174s-1.654 1.0267-2.595 1.2782-1.921.3154-2.887.1878c-.965-.1275-1.896-.444-2.739-.9312l-25.2559-14.5496c-1.1575-.6696-2.1128-1.6394-2.765-2.8068-.6523-1.1674-.9773-2.4893-.9408-3.826.0198-.5792.1089-1.1538.2653-1.7117.517-1.8711 1.7458-3.4654 3.4234-4.4419l25.256-14.4983c.847-.4892 1.782-.8067 2.751-.9343.97-.1275 1.955-.0627 2.899.1909.945.2536 1.83.6909 2.605 1.287.775.596 1.425 1.3391 1.913 2.1866.49.8402.808 1.7693.935 2.7334.128.964.063 1.9439-.191 2.8826-.254.9388-.692 1.8177-1.288 2.5859-.597.7681-1.34 1.4101-2.186 1.8887zm-13.343 39.3698-25.2478-14.5243c-1.1296-.6483-2.4091-.9896-3.7115-.9902s-2.5823.3397-3.7124.987c-1.1301.6472-2.0712 1.579-2.7297 2.7026-.6585 1.1237-1.0115 2.4001-1.0239 3.7024v29.0135c.0654 1.928.8772 3.755 2.264 5.095 1.3869 1.341 3.2403 2.09 5.1691 2.09 1.9289 0 3.7823-.749 5.1691-2.09 1.3868-1.34 2.1986-3.167 2.264-5.095v-16.261l14.1301 8.122c.843.488 1.774.805 2.739.933.966.128 1.947.064 2.888-.187s1.823-.685 2.596-1.277c.774-.592 1.423-1.331 1.91-2.174.488-.843.805-1.773.933-2.739.128-.965.065-1.946-.186-2.887s-.685-1.824-1.277-2.597-1.331-1.422-2.174-1.91zm-29.0992-28.3806-10.527 10.3986c-.3601.3349-.8269.5319-1.318.5563h-3.0897c-.49-.0294-.9551-.2257-1.318-.5563l-10.4671-10.4329c-.3274-.3573-.521-.817-.5478-1.3009v-3.081c.0283-.4861.2215-.9481.5478-1.3095l10.4671-10.4329c.3637-.3281.829-.5214 1.318-.5477h3.0897c.4899.0228.9562.2166 1.318.5477l10.4928 10.4329c.3237.3623.514.8243.5392 1.3095v3.081c-.0237.483-.2143.9428-.5392 1.3009zm-8.3874-2.8928c-.0404-.499-.2485-.9696-.5905-1.3352l-3.0383-3.004c-.3641-.3275-.8291-.5207-1.318-.5478h-.1113c-.4867.0255-.9495.2191-1.3094.5478l-3.0383 3.004c-.3262.3676-.5165.8358-.5392 1.3266v.1113c.0215.4834.2124.9439.5392 1.3009l3.0554 2.9955c.3607.3274.823.5208 1.3094.5477h.1113c.4889-.027.9539-.2203 1.318-.5477l3.0383-3.0212c.3282-.3576.5244-.8166.5563-1.3009zm-47.4914-31.2217 25.2563 14.4811c1.1308.648 2.4115.989 3.7149.9889 1.3033 0 2.584-.3409 3.7148-.989 1.1309-.648 2.0725-1.5806 2.7314-2.7051.659-1.1245 1.0123-2.4018 1.0249-3.7051v-28.9879c-.0654-1.9277-.8772-3.7546-2.264-5.0952s-3.2402-2.0899-5.1691-2.0899c-1.9288 0-3.7822.7493-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v16.2613l-14.1473-8.1307c-.8429-.4877-1.7737-.8047-2.7392-.9328-.9654-.1281-1.9466-.0647-2.8876.1864s-1.8232.6852-2.5965 1.2773c-.7732.5921-1.4222 1.3307-1.91 2.1736-.4878.843-.8048 1.7738-.9329 2.7392-.128.9655-.0647 1.9467.1864 2.8876.2512.941.6852 1.8233 1.2773 2.5965.5921.7733 1.3307 1.4223 2.1737 1.9101zm55.4252 15.4739c1.4914.118 2.9836-.2193 4.2793-.9671l25.2475-14.5496c.843-.4877 1.582-1.1368 2.174-1.91s1.026-1.6555 1.277-2.5965.315-1.9222.187-2.8876c-.128-.9655-.445-1.8962-.933-2.7392-.488-.8429-1.137-1.5816-1.91-2.1737-.774-.5921-1.656-1.0261-2.597-1.2772-1.9-.5072-3.924-.2387-5.627.7464l-14.1298 8.1991v-16.2613c-.0654-1.9277-.8772-3.7546-2.264-5.0952-1.3868-1.3405-3.2402-2.0899-5.1691-2.0899-1.9288 0-3.7822.7494-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v29.0136c-.0023 1.8784.7086 3.6876 1.9892 5.0619 1.2805 1.3743 3.0351 2.2111 4.909 2.3412zm-25.8554 31.5298c-1.4916-.1213-2.9847.2162-4.2793.9671l-25.2905 14.4893c-1.7024.985-2.9438 2.607-3.451 4.507s-.2387 3.924.7465 5.627c.9851 1.702 2.6061 2.943 4.5065 3.451 1.9004.507 3.9244.238 5.6268-.747l14.1473-8.122v16.261c.0654 1.928.8772 3.755 2.2641 5.096 1.3868 1.34 3.2402 2.09 5.169 2.09 1.9289 0 3.7823-.75 5.1691-2.09 1.3868-1.341 2.1986-3.168 2.264-5.096v-29.0645c-.0038-1.869-.7144-3.6673-1.9891-5.0341s-3.0192-2.2009-4.8834-2.3348zm-6.8468-13.5825c.4875-1.6032.414-3.3247-.2083-4.8806-.6224-1.5559-1.7564-2.8532-3.2152-3.6779l-25.2306-14.541c-1.704-.976-3.7248-1.2385-5.6216-.7303-1.8968.5083-3.5155 1.7461-4.5032 3.4433-.4889.84-.8065 1.7686-.9343 2.732-.1278.9635-.0632 1.9428.1899 2.8811.2531.9384.6897 1.8173 1.2846 2.5858.595.7686 1.3364 1.4115 2.1814 1.8917l14.096 8.1221-14.096 8.0536c-.8429.4861-1.5819 1.1334-2.1746 1.9051-.5928.7717-1.0277 1.6526-1.2801 2.5923-.2523.9398-.317 1.9201-.1905 2.8849s.4418 1.8952.9279 2.7382c.4861.8429 1.1335 1.5819 1.9051 2.1746.7717.5928 1.6526 1.0277 2.5924 1.2801.9397.2523 1.92.317 2.8848.1905s1.8952-.4418 2.7382-.9279l25.2306-14.5496c1.6248-.9071 2.8451-2.3965 3.4149-4.168z",fill:"#fff",fillRule:"evenodd"}))),Vp=t=>M.createElement("svg",{className:"mr-2 w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:48,height:48,...t},M.createElement("path",{fill:"#fbc02d",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20 s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),M.createElement("path",{fill:"#e53935",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039 l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),M.createElement("path",{fill:"#4caf50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36 c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),M.createElement("path",{fill:"#1565c0",d:"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571 c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})),qp=t=>M.createElement("svg",{className:"mr-2 w-5 h-5",width:1024,height:1024,viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},M.createElement("path",{d:"M44.522 44.5217H489.739V489.739H44.522V44.5217Z",fill:"#F35325"}),M.createElement("path",{d:"M534.261 44.5217H979.478V489.739H534.261V44.5217Z",fill:"#81BC06"}),M.createElement("path",{d:"M44.522 534.261H489.739V979.478H44.522V534.261Z",fill:"#05A6F0"}),M.createElement("path",{d:"M534.261 534.261H979.478V979.478H534.261V534.261Z",fill:"#FFBA08"})),Wp=t=>M.createElement("svg",{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 287.56 191",...t},M.createElement("defs",null,M.createElement("style",null,".cls-1{fill:#0081fb;}.cls-2{fill:url(#linear-gradient);}.cls-3{fill:url(#linear-gradient-2);}"),M.createElement("linearGradient",{id:"linear-gradient",x1:62.34,y1:101.45,x2:260.34,y2:91.45,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},M.createElement("stop",{offset:0,stopColor:"#0064e1"}),M.createElement("stop",{offset:.4,stopColor:"#0064e1"}),M.createElement("stop",{offset:.83,stopColor:"#0073ee"}),M.createElement("stop",{offset:1,stopColor:"#0082fb"})),M.createElement("linearGradient",{id:"linear-gradient-2",x1:41.42,y1:53,x2:41.42,y2:126,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},M.createElement("stop",{offset:0,stopColor:"#0082fb"}),M.createElement("stop",{offset:1,stopColor:"#0064e0"}))),M.createElement("title",null,"facebook-meta"),M.createElement("path",{className:"cls-1",d:"M31.06,126c0,11,2.41,19.41,5.56,24.51A19,19,0,0,0,53.19,160c8.1,0,15.51-2,29.79-21.76,11.44-15.83,24.92-38,34-52l15.36-23.6c10.67-16.39,23-34.61,37.18-47C181.07,5.6,193.54,0,206.09,0c21.07,0,41.14,12.21,56.5,35.11,16.81,25.08,25,56.67,25,89.27,0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191V160c17.63,0,22-16.2,22-34.74,0-26.42-6.16-55.74-19.73-76.69-9.63-14.86-22.11-23.94-35.84-23.94-14.85,0-26.8,11.2-40.23,31.17-7.14,10.61-14.47,23.54-22.7,38.13l-9.06,16c-18.2,32.27-22.81,39.62-31.91,51.75C84.74,183,71.12,191,53.19,191c-21.27,0-34.72-9.21-43-23.09C3.34,156.6,0,141.76,0,124.85Z"}),M.createElement("path",{className:"cls-2",d:"M24.49,37.3C38.73,15.35,59.28,0,82.85,0c13.65,0,27.22,4,41.39,15.61,15.5,12.65,32,33.48,52.63,67.81l7.39,12.32c17.84,29.72,28,45,33.93,52.22,7.64,9.26,13,12,19.94,12,17.63,0,22-16.2,22-34.74l27.4-.86c0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191c-12.8,0-24.14-2.78-36.68-14.61-9.64-9.08-20.91-25.21-29.58-39.71L146.08,93.6c-12.94-21.62-24.81-37.74-31.68-45C107,40.71,97.51,31.23,82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78Z"}),M.createElement("path",{className:"cls-3",d:"M82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78C38.61,71.62,31.06,99.34,31.06,126c0,11,2.41,19.41,5.56,24.51L10.14,167.91C3.34,156.6,0,141.76,0,124.85,0,94.1,8.44,62.05,24.49,37.3,38.73,15.35,59.28,0,82.85,0Z"})),Hp=t=>M.createElement("svg",{className:"mr-2 w-5 h-5",width:256,height:233,viewBox:"0 0 256 233",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},M.createElement("path",{d:"M186.182 0h46.545v46.545h-46.545z"}),M.createElement("path",{fill:"#f7d046",d:"M209.455 0H256v46.545h-46.545z"}),M.createElement("path",{d:"M0 0h46.545v46.545H0zm0 46.545h46.545V93.09H0zm0 46.546h46.545v46.545H0zm0 46.545h46.545v46.545H0zm0 46.546h46.545v46.545H0z"}),M.createElement("path",{fill:"#f7d046",d:"M23.273 0h46.545v46.545H23.273z"}),M.createElement("path",{fill:"#f2a73b",d:"M209.455 46.545H256V93.09h-46.545zm-186.182 0h46.545V93.09H23.273z"}),M.createElement("path",{d:"M139.636 46.545h46.545V93.09h-46.545z"}),M.createElement("path",{fill:"#f2a73b",d:"M162.909 46.545h46.545V93.09h-46.545zm-93.091 0h46.545V93.09H69.818z"}),M.createElement("path",{fill:"#ee792f",d:"M116.364 93.091h46.545v46.545h-46.545zm46.545 0h46.545v46.545h-46.545zm-93.091 0h46.545v46.545H69.818z"}),M.createElement("path",{d:"M93.091 139.636h46.545v46.545H93.091z"}),M.createElement("path",{fill:"#eb5829",d:"M116.364 139.636h46.545v46.545h-46.545z"}),M.createElement("path",{fill:"#ee792f",d:"M209.455 93.091H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"}),M.createElement("path",{d:"M186.182 139.636h46.545v46.545h-46.545z"}),M.createElement("path",{fill:"#eb5829",d:"M209.455 139.636H256v46.545h-46.545z"}),M.createElement("path",{d:"M186.182 186.182h46.545v46.545h-46.545z"}),M.createElement("path",{fill:"#eb5829",d:"M23.273 139.636h46.545v46.545H23.273z"}),M.createElement("path",{fill:"#ea3326",d:"M209.455 186.182H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"})),Up="/NoLLMChat/assets/qwen-B-gSh3_v.webp",Qp="/NoLLMChat/assets/smollm-CikBjd4F.png",Zp="/NoLLMChat/assets/stablelm-BquePdQ7.png",Yp="/NoLLMChat/assets/nomic-BjJqoFji.webp",Xp="/NoLLMChat/assets/joshua-ByaReJuI.webp",_f=M.memo(({name:t,className:e,...n})=>(t=t.toLowerCase(),t.includes("gemma")?E.jsx(Vp,{className:Se("w-5 h-5",e),...n}):t!=null&&t.includes("qwen")?E.jsx("img",{className:Se("w-5 h-5",e),src:Up,alt:"qwen",...n}):t!=null&&t.includes("phi")?E.jsx(qp,{className:Se("w-5 h-5",e),...n}):t!=null&&t.includes("llama")?E.jsx(Wp,{className:Se("w-5 h-5",e),...n}):t!=null&&t.includes("smollm")?E.jsx("img",{className:Se("w-5 h-5",e),src:Qp,alt:"smollm",...n}):t!=null&&t.includes("mistral")?E.jsx(Hp,{className:Se("w-5 h-5",e),...n}):t!=null&&t.includes("snowflake")?E.jsx(zp,{className:Se("w-5 h-5 rounded-full",e),...n}):t!=null&&t.includes("stablelm")?E.jsx("img",{className:Se("w-5 h-5 rounded-full",e),src:Zp,alt:"stablelm",...n}):t!=null&&t.includes("nomic")?E.jsx("img",{className:Se("w-5 h-5 rounded-full",e),src:Yp,alt:"nomic",...n}):t!=null&&t.includes("Xenova")||t!=null&&t.includes("janus")?E.jsx("img",{className:Se("w-5 h-5 rounded-full",e),src:Xp,alt:"Xenova",...n}):E.jsx(ci,{className:Se("w-5 h-5",e),name:"brain"}))),Ns=["Qwen2.5-1.5B-Instruct-q4f32_1-MLC","Qwen2.5-Coder-1.5B-Instruct-q4f16_1-MLC","stablelm-2-zephyr-1_6b-q4f16_1-MLC-1k","Phi-3.5-mini-instruct-q4f16_1-MLC-1k","Llama-3.2-3B-Instruct-q4f32_1-MLC"],Sf=M.memo(t=>{var a;const{name:e,model:n,isCached:r,isFunctionCalling:i}=t,{t:o}=PO("atoms"),s=M.useCallback(c=>c===1?"llm_info.model_types.embedding":c===2?"llm_info.model_types.vlm":"llm_info.model_types.llm",[]);if(n)return E.jsxs(E.Fragment,{children:[E.jsx(Ot,{className:"",children:o(s(n.model_type))}),Ns.some(c=>e&&c.includes(e))?E.jsx(Ot,{className:"",variant:"outline",children:o("llm_info.recommended")}):null,r?E.jsx(Ot,{className:"",variant:"outline",children:o("llm_info.cached")}):null,i?E.jsx(Ot,{className:"",variant:"outline",children:o("llm_info.function_calling")}):null,n!=null&&n.low_resource_required?E.jsx(Ot,{className:"",variant:"outline",children:o("llm_info.low_resource_required")}):null,(a=n==null?void 0:n.overrides)!=null&&a.context_window_size?E.jsxs(Ot,{className:"",variant:"outline",children:[n.overrides.context_window_size.toLocaleString("en-US")," Tokens"]}):null,n!=null&&n.vram_required_MB?E.jsxs(Ot,{className:"",variant:"outline",children:["VRAM: ",n.vram_required_MB.toLocaleString("en-US")," MB"]}):null]})}),fi=M.forwardRef(({className:t,...e},n)=>E.jsx("textarea",{className:Se("flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...e})),fi.displayName="Textarea";let Gp;Gp=kO("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),bs=M.forwardRef(({className:t,variant:e,...n},r)=>E.jsx("div",{ref:r,role:"alert",className:Se(Gp({variant:e}),t),...n})),bs.displayName="Alert",Xs=M.forwardRef(({className:t,...e},n)=>E.jsx("h5",{ref:n,className:Se("mb-1 font-medium leading-none tracking-tight",t),...e})),Xs.displayName="AlertTitle",Gs=M.forwardRef(({className:t,...e},n)=>E.jsx("div",{ref:n,className:Se("text-sm [&_p]:leading-relaxed",t),...e})),Gs.displayName="AlertDescription";function ES({minHeight:t,maxHeight:e}){const n=M.useRef(null),r=M.useCallback(i=>{const o=n.current;if(!o)return;if(i){o.style.height=`${t}px`;return}o.style.height=`${t}px`;const s=Math.max(t,Math.min(o.scrollHeight,e??Number.POSITIVE_INFINITY));o.style.height=`${s}px`},[t,e]);return M.useEffect(()=>{const i=n.current;i&&(i.style.height=`${t}px`)},[t]),M.useEffect(()=>{const i=()=>r();return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[r]),{textareaRef:n,adjustHeight:r}}const CS=48,Kp=164;Af=function({onSubmit:t,disabled:e,enableTool:n,enableFile:r,placeholder:i,minHeight:o,maxHeight:s,className:a,onChange:c,value:l}){const[u,d]=M.useState(!1),[h,p]=M.useState(""),{textareaRef:f,adjustHeight:m}=ES({minHeight:o||CS,maxHeight:s||Kp}),[y,g]=M.useState(!0),b=async x=>{try{d(!0),await t(h,x)}finally{d(!1)}};return E.jsx("div",{className:Se("w-full py-4 max-w-xl",a),children:E.jsx("div",{className:"relative w-full mx-auto",children:E.jsxs("div",{className:"relative flex flex-col",children:[E.jsx("div",{className:"overflow-y-auto",style:{maxHeight:`${s||Kp}px`},children:E.jsx(fi,{id:"ai-input-04",value:(c?l:h)||"",disabled:e||u,placeholder:i,className:"w-full rounded-xl rounded-b-none px-4 py-3 bg-black/5 dark:bg-white/5 border-none dark:text-white placeholder:text-black/70 dark:placeholder:text-white/70 resize-none focus-visible:ring-0 leading-[1.2]",ref:f,onKeyDown:x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),b(x))},onChange:x=>{c||p(x.target.value),m(),c==null||c(x)}})}),E.jsxs("div",{className:"h-12 bg-black/5 dark:bg-white/5 rounded-b-xl",children:[E.jsxs("div",{className:"absolute left-3 bottom-3 flex items-center gap-2",children:[r?E.jsxs("label",{className:"cursor-pointer rounded-lg p-2 bg-black/5 dark:bg-white/5",children:[E.jsx("input",{type:"file",className:"hidden"}),E.jsx(ci,{name:"paperclip",className:"w-4 h-4 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors"})]}):void 0,n?E.jsxs("button",{type:"button",onClick:()=>{g(!y)},className:Se("rounded-full transition-all flex items-center gap-2 px-1.5 py-1 border h-8",y?"bg-sky-500/15 border-sky-400 text-sky-500":"bg-black/5 dark:bg-white/5 border-transparent text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:[E.jsx("div",{className:"w-4 h-4 flex items-center justify-center flex-shrink-0",children:E.jsx(df.div,{animate:{rotate:y?180:0,scale:y?1.1:1},whileHover:{rotate:y?180:15,scale:1.1,transition:{type:"spring",stiffness:300,damping:10}},transition:{type:"spring",stiffness:260,damping:25},children:E.jsx(ci,{name:"globe",className:Se("w-4 h-4",y?"text-sky-500":"text-inherit")})})}),E.jsx(Bf,{children:y&&E.jsx(df.span,{initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"text-sm overflow-hidden whitespace-nowrap text-sky-500 flex-shrink-0",children:"Search"})})]}):void 0]}),E.jsx("div",{className:"absolute right-3 bottom-3",children:E.jsx("button",{type:"button",disabled:e||u,onClick:x=>{b(x)},className:Se("rounded-lg p-2",c&&l||h?"bg-sky-500/15 text-sky-500":"bg-black/5 dark:bg-white/5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:E.jsx(ci,{name:"send",className:"w-4 h-4"})})})]})]})})})};var _S=Object.prototype.toString,Jt=Array.isArray||function(t){return _S.call(t)==="[object Array]"};function ds(t){return typeof t=="function"}function SS(t){return Jt(t)?"array":typeof t}function hs(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Jp(t,e){return t!=null&&typeof t=="object"&&e in t}function OS(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var NS=RegExp.prototype.test;function AS(t,e){return NS.call(t,e)}var PS=/\S/;function kS(t){return!AS(PS,t)}var TS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function jS(t){return String(t).replace(/[&<>"'`=\/]/g,function(e){return TS[e]})}var RS=/\s*/,IS=/\s+/,ef=/\s*=/,$S=/\s*\}/,BS=/#|\^|\/|>|\{|&|=|!/;function LS(t,e){if(!t)return[];var n=!1,r=[],i=[],o=[],s=!1,a=!1,c="",l=0;function u(){if(s&&!a)for(;o.length;)delete i[o.pop()];else o=[];s=!1,a=!1}var d,h,p;function f(j){if(typeof j=="string"&&(j=j.split(IS,2)),!Jt(j)||j.length!==2)throw new Error("Invalid tags: "+j);d=new RegExp(hs(j[0])+"\\s*"),h=new RegExp("\\s*"+hs(j[1])),p=new RegExp("\\s*"+hs("}"+j[1]))}f(e||Be.tags);for(var m=new qn(t),y,g,b,x,v,C;!m.eos();){if(y=m.pos,b=m.scanUntil(d),b)for(var T=0,S=b.length;T<S;++T)x=b.charAt(T),kS(x)?(o.push(i.length),c+=x):(a=!0,n=!0,c+=" "),i.push(["text",x,y,y+1]),y+=1,x===`
`&&(u(),c="",l=0,n=!1);if(!m.scan(d))break;if(s=!0,g=m.scan(BS)||"name",m.scan(RS),g==="="?(b=m.scanUntil(ef),m.scan(ef),m.scanUntil(h)):g==="{"?(b=m.scanUntil(p),m.scan($S),m.scanUntil(h),g="&"):b=m.scanUntil(h),!m.scan(h))throw new Error("Unclosed tag at "+m.pos);if(g==">"?v=[g,b,y,m.pos,c,l,n]:v=[g,b,y,m.pos],l++,i.push(v),g==="#"||g==="^")r.push(v);else if(g==="/"){if(C=r.pop(),!C)throw new Error('Unopened section "'+b+'" at '+y);if(C[1]!==b)throw new Error('Unclosed section "'+C[1]+'" at '+y)}else g==="name"||g==="{"||g==="&"?a=!0:g==="="&&f(b)}if(u(),C=r.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+m.pos);return FS(DS(i))}function DS(t){for(var e=[],n,r,i=0,o=t.length;i<o;++i)n=t[i],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(e.push(n),r=n));return e}function FS(t){for(var e=[],n=e,r=[],i,o,s=0,a=t.length;s<a;++s)switch(i=t[s],i[0]){case"#":case"^":n.push(i),r.push(i),n=i[4]=[];break;case"/":o=r.pop(),o[5]=i[2],n=r.length>0?r[r.length-1][4]:e;break;default:n.push(i)}return e}function qn(t){this.string=t,this.tail=t,this.pos=0}qn.prototype.eos=function(){return this.tail===""},qn.prototype.scan=function(t){var e=this.tail.match(t);if(!e||e.index!==0)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},qn.prototype.scanUntil=function(t){var e=this.tail.search(t),n;switch(e){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,e),this.tail=this.tail.substring(e)}return this.pos+=n.length,n};function en(t,e){this.view=t,this.cache={".":this.view},this.parent=e}en.prototype.push=function(t){return new en(t,this)},en.prototype.lookup=function(t){var e=this.cache,n;if(e.hasOwnProperty(t))n=e[t];else{for(var r=this,i,o,s,a=!1;r;){if(t.indexOf(".")>0)for(i=r.view,o=t.split("."),s=0;i!=null&&s<o.length;)s===o.length-1&&(a=Jp(i,o[s])||OS(i,o[s])),i=i[o[s++]];else i=r.view[t],a=Jp(r.view,t);if(a){n=i;break}r=r.parent}e[t]=n}return ds(n)&&(n=n.call(this.view)),n};function ke(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}ke.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()},ke.prototype.parse=function(t,e){var n=this.templateCache,r=t+":"+(e||Be.tags).join(":"),i=typeof n<"u",o=i?n.get(r):void 0;return o==null&&(o=LS(t,e),i&&n.set(r,o)),o},ke.prototype.render=function(t,e,n,r){var i=this.getConfigTags(r),o=this.parse(t,i),s=e instanceof en?e:new en(e,void 0);return this.renderTokens(o,s,n,t,r)},ke.prototype.renderTokens=function(t,e,n,r,i){for(var o="",s,a,c,l=0,u=t.length;l<u;++l)c=void 0,s=t[l],a=s[0],a==="#"?c=this.renderSection(s,e,n,r,i):a==="^"?c=this.renderInverted(s,e,n,r,i):a===">"?c=this.renderPartial(s,e,n,i):a==="&"?c=this.unescapedValue(s,e):a==="name"?c=this.escapedValue(s,e,i):a==="text"&&(c=this.rawValue(s)),c!==void 0&&(o+=c);return o},ke.prototype.renderSection=function(t,e,n,r,i){var o=this,s="",a=e.lookup(t[1]);function c(d){return o.render(d,e,n,i)}if(a){if(Jt(a))for(var l=0,u=a.length;l<u;++l)s+=this.renderTokens(t[4],e.push(a[l]),n,r,i);else if(typeof a=="object"||typeof a=="string"||typeof a=="number")s+=this.renderTokens(t[4],e.push(a),n,r,i);else if(ds(a)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");a=a.call(e.view,r.slice(t[3],t[5]),c),a!=null&&(s+=a)}else s+=this.renderTokens(t[4],e,n,r,i);return s}},ke.prototype.renderInverted=function(t,e,n,r,i){var o=e.lookup(t[1]);if(!o||Jt(o)&&o.length===0)return this.renderTokens(t[4],e,n,r,i)},ke.prototype.indentPartial=function(t,e,n){for(var r=e.replace(/[^ \t]/g,""),i=t.split(`
`),o=0;o<i.length;o++)i[o].length&&(o>0||!n)&&(i[o]=r+i[o]);return i.join(`
`)},ke.prototype.renderPartial=function(t,e,n,r){if(n){var i=this.getConfigTags(r),o=ds(n)?n(t[1]):n[t[1]];if(o!=null){var s=t[6],a=t[5],c=t[4],l=o;a==0&&c&&(l=this.indentPartial(o,c,s));var u=this.parse(l,i);return this.renderTokens(u,e,n,l,r)}}},ke.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(n!=null)return n},ke.prototype.escapedValue=function(t,e,n){var r=this.getConfigEscape(n)||Be.escape,i=e.lookup(t[1]);if(i!=null)return typeof i=="number"&&r===Be.escape?String(i):r(i)},ke.prototype.rawValue=function(t){return t[1]},ke.prototype.getConfigTags=function(t){return Jt(t)?t:t&&typeof t=="object"?t.tags:void 0},ke.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!Jt(t))return t.escape};let tn;Be={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){tn.templateCache=t},get templateCache(){return tn.templateCache}},tn=new ke,Be.clearCache=function(){return tn.clearCache()},Be.parse=function(t,e){return tn.parse(t,e)},Be.render=function(t,e,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+SS(t)+'" was given as the first argument for mustache#render(template, view, partials)');return tn.render(t,e,n,r)},Be.escape=jS,Be.Scanner=qn,Be.Context=en,Be.Writer=ke;let tf;tf=async(t,e)=>{let n="",r="",i;const o=[];await t;for await(const s of t)s&&(Array.isArray(s)?(o.push(...s.map(a=>a.content)),o!=null&&o.length&&(r=o.join(""),e==null||e({chunk:s,content:r}))):(n=typeof s=="object"&&"content"in s?`${s.content}`:`${s}`,e==null||e({chunk:s,content:n})),i=s);return{lastChunk:i,content:n}},Pf=()=>{const t=xs(r=>r.toolsCallingStream),e=xs(r=>r.structuredStream),n=xs(r=>r.stream);return{stream:M.useCallback(async(r,{tools:i,schemas:o,onMessageUpdate:s,onMessageFinish:a})=>{var d,h,p,f;o&&(o==null?void 0:o.length)>1&&St("Multiple schemas are not supported");let c;if(o!=null&&o.length){const m=(p=(h=(d=o==null?void 0:o[0])==null?void 0:d.node)==null?void 0:h.data)==null?void 0:p.entity;if(!((f=m==null?void 0:m.schema_items)!=null&&f.length))throw new Error("Schema is not found");c=e(m.schema_items,r)}else i!=null&&i.length?c=t(i.reduce((m,y)=>{var x,v,C,T,S;const g=(x=y.node.data)==null?void 0:x.entity,b=(T=(C=(v=y==null?void 0:y.connectedNodes)==null?void 0:v.find(j=>j.type===Ne.Schema))==null?void 0:C.data)==null?void 0:T.entity;return g&&((S=b==null?void 0:b.schema_items)!=null&&S.length)&&m.push({name:g.name,description:g.description,schemaItems:b.schema_items}),m},[]),r):c=n(r);if(!c)throw new Error("Stream is not supported");const{lastChunk:l,content:u}=await tf(c,s);return a==null||a({content:u,lastChunk:l}),{lastChunk:l,content:u}},[n,e,t])}}});export{vs as $,bs as A,hf as B,pf as C,ws as D,Ms as E,Es as F,Cs as G,cn as H,li as I,_s as J,Ss as K,Os as L,ui as M,ln as N,di as O,re as P,hi as Q,Ns as R,pi as S,fi as T,mi as U,Qn as V,yi as W,Zn as X,As as Y,Ps as Z,Nt as _,RO as __tla,At as a,Yn as a0,Xn as a1,ut as a2,qe as a3,gi as a4,ks as a5,Ts as a6,js as a7,ff as a8,mf as a9,xi as aA,Rs as aB,Is as aC,un as aD,Pt as aE,Gn as aF,vi as aG,$s as aH,Bs as aI,Ls as aJ,yf as aK,Kn as aa,ue as ab,ye as ac,gf as ad,xf as ae,dn as af,vf as ag,Jn as ah,dt as ai,bf as aj,ht as ak,wf as al,it as am,Mf as an,Ef as ao,Ds as ap,bi as aq,Fs as ar,zs as as,wi as at,Vs as au,qs as av,Mi as aw,Ws as ax,Hs as ay,Ei as az,Ci as b,_i as c,Us as d,Qs as e,Zs as f,Cf as g,Ys as h,Ye as i,_f as j,Sf as k,er as l,Of as m,Nf as n,Xs as o,Gs as p,Af as q,Be as r,Si as s,Pf as t,kf as u,tr as v,nr as w,Xe as x,kt as y,Tf as z};
